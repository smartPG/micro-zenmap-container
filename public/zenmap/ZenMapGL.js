function expose(){var t=window.P;P.noConflict=function(){return window.P=t,this},window.P=P}!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).zmapboxgl=e()}(this,function(){"use strict";var r,n,s;function t(t,e){var i,o;r?n?(i="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",r(o={}),s=e(o),"undefined"!=typeof window&&(s.workerUrl=window.URL.createObjectURL(new Blob([i],{type:"text/javascript"})))):n=e:r=e}return t(0,function(t){var n="2.4.0-dev",s=e;function e(t,e,i,o){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=o,this.p2x=i,this.p2y=o}e.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},e.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},e.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},e.prototype.solveCurveX=function(t,e){var i,o,r,n,s;for(void 0===e&&(e=1e-6),r=t,s=0;s<8;s++){if(n=this.sampleCurveX(r)-t,Math.abs(n)<e)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=n/a}if((r=t)<(i=0))return i;if(r>(o=1))return o;for(;i<o;){if(n=this.sampleCurveX(r),Math.abs(n-t)<e)return r;n<t?i=r:o=r,r=.5*(o-i)+i}return r},e.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var z=i;function i(t,e){this.x=t,this.y=e}i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,t=t.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),t=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=t,this},_rotateAround:function(t,e){var i=Math.cos(t),o=Math.sin(t),t=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=t,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(t){return!(t instanceof i)&&Array.isArray(t)?new i(t[0],t[1]):t};var c="undefined"!=typeof self?self:{};const o=Math.pow(2,53)-1,r=Math.PI/180,a=180/Math.PI;function T(t){return t*r}const l=[[0,0],[1,0],[1,1],[0,1]];function h(t){if(t<=0)return 0;if(1<=t)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function p(t,e,i,o){const r=new s(t,e,i,o);return function(t){return r.solve(t)}}var u=p(.25,.1,.25,1);function d(t,e,i){return Math.min(i,Math.max(e,t))}function f(t,e,i){var o=i-e,o=((t-e)%o+o)%o+e;return o===e?i:o}function g(t,e,o){if(!t.length)return o(null,[]);let r=t.length;const n=new Array(t.length);let s=null;t.forEach((t,i)=>{e(t,(t,e)=>{t&&(s=t),n[i]=e,0==--r&&o(s,n)})})}function _(t){const e=[];for(const i in t)e.push(t[i]);return e}function v(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let y=1;function m(){return y++}function b(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function x(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function w(t){return t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function M(t,e){t.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function P(t,e){return-1!==t.indexOf(e,t.length-e.length)}function E(t,e,i){const o={};for(const r in t)o[r]=e.call(i||this,t[r],r,t);return o}function S(t,e,i){const o={};for(const r in t)e.call(i||this,t[r],r,t)&&(o[r]=t[r]);return o}function A(t){return Array.isArray(t)?t.map(A):"object"==typeof t&&t?E(t,A):t}const C={};function Z(t){C[t]||("undefined"!=typeof console&&console.warn(t),C[t]=!0)}function I(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function L(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function O(t){const n={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,e,i,o)=>{const r=i||o;return n[e]=!r||r.toLowerCase(),""}),n["max-age"]){const t=parseInt(n["max-age"],10);isNaN(t)?delete n["max-age"]:n["max-age"]=t}return n}let R,D,k,F=null;function N(t){if(null==F){const e=t.navigator?t.navigator.userAgent:null;F=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return F}function U(t){try{const e=c[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}const B={now:()=>void 0!==k?k:c.performance.now(),setNow(t){k=t},restoreNow(){k=void 0},frame(t){const e=c.requestAnimationFrame(t);return{cancel:()=>c.cancelAnimationFrame(e)}},getImageData(t,e=0){const i=c.document.createElement("canvas"),o=i.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return i.width=t.width,i.height=t.height,o.drawImage(t,0,0,t.width,t.height),o.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(R=R||c.document.createElement("a"),R.href=t,R.href),get devicePixelRatio(){return c.devicePixelRatio},get prefersReducedMotion(){return!!c.matchMedia&&(null==D&&(D=c.matchMedia("(prefers-reduced-motion: reduce)")),D.matches)}};let j;const G={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==j){var e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{j=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch(t){j=e}}return j},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},V={supported:!1,testSupport:function(t){!q&&H&&(Y?X(t):W=t)}};let W,H,q=!1,Y=!1;function X(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,H),t.isContextLost())return;V.supported=!0}catch(t){}t.deleteTexture(e),q=!0}c.document&&(H=c.document.createElement("img"),H.onload=function(){W&&X(W),W=null,Y=!0},H.onerror=function(){q=!0,W=null},H.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const K="01",$="NO_ACCESS_TOKEN";function J(t){return 0===t.indexOf("mapbox:")}function Q(t){return G.API_URL_REGEX.test(t)}const tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function et(t){const e=t.match(tt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function it(t){var e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function ot(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(c.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(t){return null}}class rt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){var e=ot(G.ACCESS_TOKEN),i=e&&e.u?c.btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,(t,e)=>String.fromCharCode(Number("0x"+e)))):G.ACCESS_TOKEN||"";return t?`mapbox.eventData.${t}:${i}`:`mapbox.eventData:${i}`}fetchEventData(){const t=U("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{const t=c.localStorage.getItem(e);t&&(this.eventData=JSON.parse(t));var o=c.localStorage.getItem(i);o&&(this.anonId=o)}catch(t){Z("Unable to read from LocalStorage")}}saveEventData(){var t=U("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{c.localStorage.setItem(i,this.anonId),1<=Object.keys(this.eventData).length&&c.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){Z("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,e,i,o){if(G.EVENTS_URL){const r=et(G.EVENTS_URL);r.params.push(`access_token=${o||G.ACCESS_TOKEN||""}`);t={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:n,skuId:K,userId:this.anonId},t=e?v(t,e):t,t={url:it(r),headers:{"Content-Type":"text/plain"},body:JSON.stringify([t])};this.pendingRequest=Et(t,t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(o)})}}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const nt=new class extends rt{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){G.EVENTS_URL&&G.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>J(t)||Q(t))&&this.queueRequest(Date.now(),e)}processRequests(e){if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=ot(G.ACCESS_TOKEN),o=i?i.u:G.ACCESS_TOKEN;let t=o!==this.eventData.tokenU;w(this.anonId)||(this.anonId=b(),t=!0);const r=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),i=new Date(r),o=(r-this.eventData.lastSuccess)/864e5;t=t||1<=o||o<-1||e.getDate()!==i.getDate()}else t=!0;if(!t)return this.processRequests();this.postEvent(r,{"enabled.telemetry":!1},t=>{t||(this.eventData.lastSuccess=r,this.eventData.tokenU=o)},e)}}},st=nt.postTurnstileEvent.bind(nt),at=new class extends rt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,o){this.skuToken=e,this.errorCb=o,G.EVENTS_URL&&(i||G.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error($)))}processRequests(t){if(!this.pendingRequest&&0!==this.queue.length){const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),w(this.anonId)||(this.anonId=b()),this.postEvent(i,{skuToken:this.skuToken},t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t))}}},lt=at.postMapLoadEvent.bind(at),ht=new class extends rt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,o){if(G.API_URL&&G.SESSION_PATH){const r=et(G.API_URL+G.SESSION_PATH);r.params.push(`sku=${e||""}`),r.params.push(`access_token=${o||G.ACCESS_TOKEN||""}`);e={url:it(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=St(e,t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(o)})}}getSessionAPI(t,e,i,o){this.skuToken=e,this.errorCb=o,G.SESSION_PATH&&G.API_URL&&(i||G.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error($)))}processRequests(t){if(!this.pendingRequest&&0!==this.queue.length){const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t)}}},pt=ht.getSessionAPI.bind(ht),ct=new Set,ut="mapbox-tiles";let dt,ft,gt=500,yt=50;function mt(){c.caches&&!dt&&(dt=c.caches.open(ut))}function _t(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}let vt=1/0;const bt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(bt);class xt extends Error{constructor(t,e,i){401===e&&Q(i)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const wt=L()?()=>self.worker&&self.worker.referrer:()=>("blob:"===c.location.protocol?c.parent:c).location.href,Mt=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(wt())&&!/^\w+:/.test(i))){if(c.fetch&&c.Request&&c.AbortController&&c.Request.prototype.hasOwnProperty("signal"))return function(r,n){const t=new c.AbortController,s=new c.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:wt(),signal:t.signal});let a=!1,l=!1;const h=0<(e=s.url).indexOf("sku=")&&Q(e);var e;"json"===r.type&&s.headers.set("Accept","application/json");const i=(t,e,i)=>{if(!l){if(t&&"SecurityError"!==t.message&&Z(t),e&&i)return p(e);const o=Date.now();c.fetch(s).then(t=>{if(t.ok){const r=h?t.clone():null;return p(t,r,o)}return n(new xt(t.statusText,t.status,r.url))}).catch(t=>{20!==t.code&&n(new Error(t.message))})}},p=(e,i,o)=>{("arrayBuffer"===r.type?e.arrayBuffer():"json"===r.type?e.json():e.text()).then(t=>{l||(i&&o&&function(i,t,e){if(mt(),dt){const r={status:t.status,statusText:t.statusText,headers:new c.Headers};t.headers.forEach((t,e)=>r.headers.set(e,t));var o=O(t.headers.get("Cache-Control")||"");o["no-store"]||(o["max-age"]&&r.headers.set("Expires",new Date(e+1e3*o["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-e<42e4||function(t,e){if(void 0===ft)try{new Response(new ReadableStream),ft=!0}catch(t){ft=!1}ft?e(t.body):t.blob().then(e)}(t,t=>{const e=new c.Response(t,r);mt(),dt&&dt.then(t=>t.put(_t(i.url),e)).catch(t=>Z(t.message))}))}}(s,i,o),a=!0,n(null,t,e.headers.get("Cache-Control"),e.headers.get("Expires")))}).catch(t=>{l||n(new Error(t.message))})};return h?function(t,o){if(mt(),!dt)return o(null);const r=_t(t.url);dt.then(i=>{i.match(r).then(t=>{var e=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),t=O(t.headers.get("Cache-Control")||"");return e>Date.now()&&!t["no-cache"]}(t);i.delete(r),e&&i.put(r,t.clone()),o(null,t,e)}).catch(o)}).catch(o)}(s,i):i(null,null),{cancel:()=>{l=!0,a||t.abort()}}}(t,e);if(L()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(e,i){const o=new c.XMLHttpRequest;o.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(o.responseType="arraybuffer");for(const i in e.headers)o.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(o.responseType="text",o.setRequestHeader("Accept","application/json")),o.withCredentials="include"===e.credentials,o.onerror=()=>{i(new Error(o.statusText))},o.onload=()=>{if((200<=o.status&&o.status<300||0===o.status)&&null!==o.response){let t=o.response;if("json"===e.type)try{t=JSON.parse(o.response)}catch(t){return i(t)}i(null,t,o.getResponseHeader("Cache-Control"),o.getResponseHeader("Expires"))}else i(new xt(o.statusText,o.status,e.url))},o.send(e.body),{cancel:()=>o.abort()}}(t,e)},Pt=function(t,e){return Mt(v(t,{type:"arrayBuffer"}),e)},Et=function(t,e){return Mt(v(t,{method:"POST"}),e)},St=function(t,e){return Mt(v(t,{method:"GET"}),e)};const Tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let At,Ct;At=[],Ct=0;const It=function(t,n){if(V.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ct>=G.MAX_PARALLEL_IMAGE_REQUESTS){const o={requestParameters:t,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return At.push(o),o}Ct++;let o=!1;const s=()=>{if(!o)for(o=!0,Ct--;At.length&&Ct<G.MAX_PARALLEL_IMAGE_REQUESTS;){const t=At.shift(),{requestParameters:e,callback:o,cancelled:i}=t;i||(t.cancel=It(e,o).cancel)}},e=Pt(t,(t,e,i,o)=>{var r;s(),t?n(t):e&&(c.createImageBitmap?(r=(t,e)=>n(t,e,i,o),t=new c.Blob([new Uint8Array(e)],{type:"image/png"}),c.createImageBitmap(t).then(t=>{r(null,t)}).catch(t=>{r(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})):function(t,e){const i=new c.Image,o=c.URL;i.onload=()=>{e(null,i),o.revokeObjectURL(i.src),i.onload=null,c.requestAnimationFrame(()=>{i.src=Tt})},i.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));var r=new c.Blob([new Uint8Array(t)],{type:"image/png"});i.src=t.byteLength?o.createObjectURL(r):Tt}(e,(t,e)=>n(t,e,i,o)))});return{cancel:()=>{e.cancel(),s()}}};function Lt(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function Ot(t,e,i){i&&i[t]&&(-1!==(e=i[t].indexOf(e))&&i[t].splice(e,1))}class Rt{constructor(t,e={}){v(this,e),this.type=t}}class Dt extends Rt{constructor(t,e={}){super("error",v({error:t},e))}}class kt{on(t,e){return this._listeners=this._listeners||{},Lt(t,e,this._listeners),this}off(t,e){return Ot(t,e,this._listeners),Ot(t,e,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Lt(e,t,this._oneTimeListeners),this):new Promise(t=>this.once(e,t))}fire(t,e){const i=(t="string"==typeof t?new Rt(t,e||{}):t).type;if(this.listens(i)){const e=(t.target=this)._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);for(const e of this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[])Ot(i,e,this._oneTimeListeners),e.call(this,t);const o=this._eventedParent;o&&(v(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),o.fire(t))}else t instanceof Dt&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&0<this._listeners[t].length||this._oneTimeListeners&&this._oneTimeListeners[t]&&0<this._oneTimeListeners[t].length||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var zt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{},wmts:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{},wmts:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-basecolor":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ft{constructor(t,e,i,o){this.message=(t?`${t}: `:"")+i,o&&(this.identifier=o),null!=e&&e.__line__&&(this.line=e.__line__)}}function Nt(t){var e=t.value;return e?[new Ft(t.key,e,"constants have been deprecated as of v8")]:[]}function Ut(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}function Bt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function jt(t){if(Array.isArray(t))return t.map(jt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=jt(t[i]);return e}return Bt(t)}class Zt extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class Gt{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new Gt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Vt={kind:"null"},Wt={kind:"number"},Ht={kind:"string"},qt={kind:"boolean"},Yt={kind:"color"},Xt={kind:"object"},Kt={kind:"value"},$t={kind:"collator"},Jt={kind:"formatted"},Qt={kind:"resolvedImage"};function te(t,e){return{kind:"array",itemType:t,N:e}}function ee(t){if("array"!==t.kind)return t.kind;var e=ee(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}const ie=[Vt,Wt,Ht,qt,Yt,Jt,Xt,te(Kt),Qt];function oe(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!oe(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of ie)if(!oe(t,e))return null}return`Expected ${ee(t)} but found ${ee(e)} instead.`}function re(e,t){return t.some(t=>t.kind===e.kind)}function ne(e,t){return t.some(t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e)}function se(t){var e={exports:{}};return t(e,e.exports),e.exports}var ae=se(function(t,e){var h={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(t){return(t=Math.round(t))<0?0:255<t?255:t}function c(t){return p("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function u(t){return(t="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:1<t?1:t}function d(t,e,i){return i<0?i+=1:1<i&&--i,6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{e.parseCSSColor=function(t){var e=t.replace(/ /g,"").toLowerCase();if(e in h)return h[e].slice();if("#"===e[0])return 4===e.length?0<=(o=parseInt(e.substr(1),16))&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===e.length&&0<=(o=parseInt(e.substr(1),16))&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var i=e.indexOf("("),t=e.indexOf(")");if(-1!==i&&t+1===e.length){var o=e.substr(0,i),r=e.substr(i+1,t-(i+1)).split(","),n=1;switch(o){case"rgba":if(4!==r.length)return null;n=u(r.pop());case"rgb":return 3!==r.length?null:[c(r[0]),c(r[1]),c(r[2]),n];case"hsla":if(4!==r.length)return null;n=u(r.pop());case"hsl":if(3!==r.length)return null;var s=(parseFloat(r[0])%360+360)%360/360,a=u(r[1]),l=u(r[2]),a=l<=.5?l*(a+1):l+a-l*a,l=2*l-a;return[p(255*d(l,a,s+1/3)),p(255*d(l,a,s)),p(255*d(l,a,s-1/3)),n];default:return null}}return null}}catch(t){}});class le{constructor(t,e,i,o=1){this.r=t,this.g=e,this.b=i,this.a=o}static parse(t){if(t){if(t instanceof le)return t;if("string"==typeof t){t=ae.parseCSSColor(t);return t?new le(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}}}toString(){var[t,e,i,o]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${o})`}toArray(){var{r:t,g:e,b:i,a:o}=this;return 0===o?[0,0,0,0]:[255*t/o,255*e/o,255*i/o,o]}}le.black=new le(0,0,0,1),le.white=new le(1,1,1,1),le.transparent=new le(0,0,0,0),le.red=new le(1,0,0,1),le.blue=new le(0,0,1,1);class he{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale||[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale||[]).resolvedOptions().locale}}class pe{constructor(t,e,i,o,r){this.text=t,this.image=e,this.scale=i,this.fontStack=o,this.textColor=r}}class ce{constructor(t){this.sections=t}static fromString(t){return new ce([new pe(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof ce?t:ce.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const e of this.sections)if(e.image)t.push(["image",e.image.name]);else{t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(i)}return t}}class ue{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ue({name:t,available:!1}):null}serialize(){return["image",this.name]}}function de(t,e,i,o){return"number"==typeof t&&0<=t&&t<=255&&"number"==typeof e&&0<=e&&e<=255&&"number"==typeof i&&0<=i&&i<=255?void 0===o||"number"==typeof o&&0<=o&&o<=1?null:`Invalid rgba value [${[t,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof o?[t,e,i,o]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fe(t){if(null===t)return 1;if("string"==typeof t)return 1;if("boolean"==typeof t)return 1;if("number"==typeof t)return 1;if(t instanceof le)return 1;if(t instanceof he)return 1;if(t instanceof ce)return 1;if(t instanceof ue)return 1;if(Array.isArray(t)){for(const e of t)if(!fe(e))return;return 1}if("object"==typeof t){for(const i in t)if(!fe(t[i]))return;return 1}}function ge(e){if(null===e)return Vt;if("string"==typeof e)return Ht;if("boolean"==typeof e)return qt;if("number"==typeof e)return Wt;if(e instanceof le)return Yt;if(e instanceof he)return $t;if(e instanceof ce)return Jt;if(e instanceof ue)return Qt;if(Array.isArray(e)){var i=e.length;let t;for(const o of e){const e=ge(o);if(t){if(t===e)continue;t=Kt;break}t=e}return te(t||Kt,i)}return Xt}function ye(t){var e=typeof t;return null===t?"":"string"==e||"number"==e||"boolean"==e?String(t):t instanceof le||t instanceof ce||t instanceof ue?t.toString():JSON.stringify(t)}class me{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!fe(t[1]))return e.error("invalid value");t=t[1];let i=ge(t);e=e.expectedType;return"array"!==i.kind||0!==i.N||!e||"array"!==e.kind||"number"==typeof e.N&&0!==e.N||(i=e),new me(i,t)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof le?["rgba"].concat(this.value.toArray()):this.value instanceof ce?this.value.serialize():this.value}}class _e{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ve={string:Ht,number:Wt,boolean:qt,object:Xt};class be{constructor(t,e){this.type=t,this.args=e}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");let r,n=1;var t=i[0];if("array"===t){let t,e;if(2<i.length){const r=i[1];if("string"!=typeof r||!(r in ve)||"object"===r)return o.error('The item type argument of "array" must be one of string, number, boolean',1);t=ve[r],n++}else t=Kt;if(3<i.length){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return o.error('The length argument to "array" must be a positive integer literal',2);e=i[2],n++}r=te(t,e)}else r=ve[t];const e=[];for(;n<i.length;n++){const r=o.parse(i[n],n,Kt);if(!r)return null;e.push(r)}return new be(r,e)}evaluate(e){for(let t=0;t<this.args.length;t++){var i=this.args[t].evaluate(e);if(!oe(this.type,ge(i)))return i;if(t===this.args.length-1)throw new _e(`Expected value to be of type ${ee(this.type)}, but found ${ee(ge(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,e=[t.kind];var i;return"array"===t.kind&&("string"!==(i=t.itemType).kind&&"number"!==i.kind&&"boolean"!==i.kind||(e.push(i.kind),("number"==typeof(i=t.N)||1<this.args.length)&&e.push(i))),e.concat(this.args.map(t=>t.serialize()))}}class xe{constructor(t){this.type=Jt,this.sections=t}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");var t=e[1];if(!Array.isArray(t)&&"object"==typeof t)return o.error("First argument must be an image or text section.");const r=[];let n=!1;for(let t=1;t<=e.length-1;++t){var s=e[t];if(n&&"object"==typeof s&&!Array.isArray(s)){n=!1;let t=null;if(s["font-scale"]&&(t=o.parse(s["font-scale"],1,Wt),!t))return null;let e=null;if(s["text-font"]&&(e=o.parse(s["text-font"],1,te(Ht)),!e))return null;let i=null;if(s["text-color"]&&(i=o.parse(s["text-color"],1,Yt),!i))return null;const a=r[r.length-1];a.scale=t,a.font=e,a.textColor=i}else{var i=o.parse(e[t],1,Kt);if(!i)return null;s=i.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:i,scale:null,font:null,textColor:null})}}return new xe(r)}evaluate(i){return new ce(this.sections.map(t=>{var e=t.content.evaluate(i);return ge(e)===Qt?new pe("",e,null,null,null):new pe(ye(e),null,t.scale?t.scale.evaluate(i):null,t.font?t.font.evaluate(i).join(","):null,t.textColor?t.textColor.evaluate(i):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class we{constructor(t){this.type=Qt,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");t=e.parse(t[1],1,Ht);return t?new we(t):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=ue.fromString(e);return i&&t.availableImages&&(i.available=-1<t.availableImages.indexOf(e)),i}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Me={"to-boolean":qt,"to-color":Yt,"to-number":Wt,"to-string":Ht};class Pe{constructor(t,e){this.type=t,this.args=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");var t=e[0];if(("to-boolean"===t||"to-string"===t)&&2!==e.length)return i.error("Expected one argument.");const o=Me[t],r=[];for(let t=1;t<e.length;t++){const o=i.parse(e[t],t,Kt);if(!o)return null;r.push(o)}return new Pe(o,r)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let t,e;for(const r of this.args){if(t=r.evaluate(i),e=null,t instanceof le)return t;if("string"==typeof t){var o=i.parseColor(t);if(o)return o}else if(Array.isArray(t)&&(e=t.length<3||4<t.length?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:de(t[0],t[1],t[2],t[3]),!e))return new le(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new _e(e||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"!==this.type.kind)return"formatted"===this.type.kind?ce.fromString(ye(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?ue.fromString(ye(this.args[0].evaluate(i))):ye(this.args[0].evaluate(i));{let t=null;for(const n of this.args){if(t=n.evaluate(i),null===t)return 0;var e=Number(t);if(!isNaN(e))return e}throw new _e(`Could not convert ${JSON.stringify(t)} to number.`)}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new xe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new we(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}const Ee=["Unknown","Point","LineString","Polygon"];class Se{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ee[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e=e||(this._parseColorCache[t]=le.parse(t)),e}}class Te{constructor(t,e,i,o){this.name=t,this.type=e,this._evaluate=i,this.args=o}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(i,o){const r=i[0],n=Te.definitions[r];if(!n)return o.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(n)?n[0]:n.type,a=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,l=a.filter(([t])=>!Array.isArray(t)||t.length===i.length-1);let h=null;for(const[n,a]of l){h=new We(o.registry,o.path,null,o.scope);const l=[];let e=!1;for(let t=1;t<i.length;t++){const r=i[t],s=Array.isArray(n)?n[t-1]:n.type,a=h.parse(r,1+l.length,s);if(!a){e=!0;break}l.push(a)}if(!e)if(Array.isArray(n)&&n.length!==l.length)h.error(`Expected ${n.length} arguments, but found ${l.length} instead.`);else{for(let t=0;t<l.length;t++){const o=Array.isArray(n)?n[t]:n.type,r=l[t];h.concat(t+1).checkSubtype(o,r.type)}if(0===h.errors.length)return new Te(r,s,a,l)}}if(1===l.length)o.errors.push(...h.errors);else{const r=(l.length?l:a).map(([t])=>{return t=t,Array.isArray(t)?`(${t.map(ee).join(", ")})`:`(${ee(t.type)}...)`}).join(" | "),n=[];for(let t=1;t<i.length;t++){const s=o.parse(i[t],1+n.length);if(!s)return null;n.push(ee(s.type))}o.error(`Expected arguments of type ${r}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){for(const i in Te.definitions=e)t[i]=Te}}class Ae{constructor(t,e,i){this.type=$t,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");var i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");var o=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,qt);if(!o)return null;t=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,qt);if(!t)return null;let r=null;return i.locale&&(r=e.parse(i.locale,1,Ht),!r)?null:new Ae(o,t,r)}evaluate(t){return new he(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Ce=8192;function Ie(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Le(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Oe(i,o){let r=!1;for(let t=0,e=o.length;t<e;t++){var n=o[t];for(let t=0,e=n.length;t<e-1;t++){if(s=n[t],h=n[t+1],l=a=void 0,a=i[0]-s[0],l=i[1]-s[1],s=i[0]-h[0],h=i[1]-h[1],a*h-s*l==0&&a*s<=0&&l*h<=0)return;(l=n[t])[1]>i[1]!=(h=n[t+1])[1]>i[1]&&i[0]<(h[0]-l[0])*(i[1]-l[1])/(h[1]-l[1])+l[0]&&(r=!r)}}var s,a,l,h;return r}function Re(t,e,i,o){var r=o[0]-i[0],o=o[1]-i[1],t=(t[0]-i[0])*o-r*(t[1]-i[1]),i=(e[0]-i[0])*o-r*(e[1]-i[1]);return 0<t&&i<0||t<0&&0<i}function De(e,i){for(let t=0;t<e.length;++t)if(!Oe(e[t],i))return;for(let t=0;t<e.length-1;++t)if(function(e,i,t){for(const h of t)for(let t=0;t<h.length-1;++t)if(0!=(a=[(s=h[t+1])[0]-(n=h[t])[0],s[1]-n[1]])[0]*(l=[(r=i)[0]-(o=e)[0],r[1]-o[1]])[1]-a[1]*l[0]&&Re(o,r,n,s)&&Re(n,s,o,r))return 1;var o,r,n,s,a,l}(e[t],e[t+1],i))return;return 1}function ke(i,o,r){const t=[];for(let e=0;e<i.length;e++){const l=[];for(let t=0;t<i[e].length;t++){s=(n=i[e][t],s=r,a=void 0,a=(180+n[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,s=Math.pow(2,s.z),[Math.round(a*s*Ce),Math.round(n*s*Ce)]);Ie(o,s),l.push(s)}t.push(l)}var n,s,a;return t}function ze(e,i,o){const r=[];for(let t=0;t<e.length;t++){var n=ke(e[t],i,o);r.push(n)}return r}function Fe(e,i,o,r){if(e[0]<o[0]||e[0]>o[2]){const i=.5*r;let t=e[0]-o[0]>i?-r:o[0]-e[0]>i?r:0;0===t&&(t=e[0]-o[2]>i?-r:o[2]-e[0]>i?r:0),e[0]+=t}Ie(i,e)}function Ne(t,e,i,o){const r=Math.pow(2,o.z)*Ce,n=[o.x*Ce,o.y*Ce],s=[];for(const o of t)for(const t of o){const o=[t.x+n[0],t.y+n[1]];Fe(o,e,i,r),s.push(o)}return s}function Ue(t,e,i,o){const r=Math.pow(2,o.z)*Ce,n=[o.x*Ce,o.y*Ce],s=[];for(const i of t){const a=[];for(const o of i){const i=[o.x+n[0],o.y+n[1]];Ie(e,i),a.push(i)}s.push(a)}if(e[2]-e[0]<=r/2){(t=e)[0]=t[1]=1/0,t[2]=t[3]=-1/0;for(const a of s)for(const o of a)Fe(o,e,i,r)}return s}class Be{constructor(t,e){this.type=qt,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(fe(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){var i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Be(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Be(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Be(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var i=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){var n=ke(e.coordinates,o,r),s=Ne(t.geometry(),i,o,r);if(!Le(i,o))return!1;for(const t of s)if(!Oe(t,n))return!1}if("MultiPolygon"===e.type){var a=ze(e.coordinates,o,r),r=Ne(t.geometry(),i,o,r);if(!Le(i,o))return!1;for(const t of r)if(!function(e,i){for(let t=0;t<i.length;t++)if(Oe(e,i[t]))return 1}(t,a))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var i=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){var n=ke(e.coordinates,o,r),s=Ue(t.geometry(),i,o,r);if(!Le(i,o))return!1;for(const t of s)if(!De(t,n))return!1}if("MultiPolygon"===e.type){var a=ze(e.coordinates,o,r),r=Ue(t.geometry(),i,o,r);if(!Le(i,o))return!1;for(const t of r)if(!function(e,i){for(let t=0;t<i.length;t++)if(De(e,i[t]))return 1}(t,a))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function je(t){if(t instanceof Te){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Be)return!1;let e=!0;return t.eachChild(t=>{e&&!je(t)&&(e=!1)}),e}function Ze(t){if(!(t instanceof Te&&"feature-state"===t.name)){let e=!0;return t.eachChild(t=>{e&&!Ze(t)&&(e=!1)}),e}}function Ge(t,e){if(t instanceof Te&&0<=e.indexOf(t.name))return!1;let i=!0;return t.eachChild(t=>{i&&!Ge(t,e)&&(i=!1)}),i}class Ve{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");t=t[1];return e.scope.has(t)?new Ve(t,e.scope.get(t)):e.error(`Unknown variable "${t}". Make sure "${t}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class We{constructor(t,e=[],i,o=new Gt,r=[]){this.registry=t,this.path=e,this.key=e.map(t=>`[${t}]`).join(""),this.scope=o,this.errors=r,this.expectedType=i}parse(t,e,i,o,r={}){return(e?this.concat(e,i,o):this)._parse(t,r)}_parse(e,i){function o(t,e,i){return"assert"===i?new be(e,[t]):"coerce"===i?new Pe(e,[t]):t}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var t=e[0];if("string"!=typeof t)return this.error(`Expression name must be a string, but found ${typeof t} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[t];if(r){let t=r.parse(e,this);if(!t)return null;if(this.expectedType){const e=this.expectedType,n=t.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else t=o(t,e,i.typeAnnotation||"coerce");else t=o(t,e,i.typeAnnotation||"assert")}if(!(t instanceof me)&&"resolvedImage"!==t.type.kind&&function e(t){if(t instanceof Ve)return e(t.boundExpression);if(t instanceof Te&&"error"===t.name)return!1;if(t instanceof Ae)return!1;if(t instanceof Be)return!1;const i=t instanceof Pe||t instanceof be;let o=!0;return t.eachChild(t=>{o=i?o&&e(t):o&&t instanceof me}),!!o&&je(t)&&Ge(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}(t)){const e=new Se;try{t=new me(t.type,t.evaluate(e))}catch(e){return this.error(e.message),null}}return t}return this.error(`Unknown expression "${t}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(t,e,i){t="number"==typeof t?this.path.concat(t):this.path,i=i?this.scope.concat(i):this.scope;return new We(this.registry,t,e||null,i,this.errors)}error(t,...e){e=`${this.key}${e.map(t=>`[${t}]`).join("")}`;this.errors.push(new Zt(e,t))}checkSubtype(t,e){e=oe(t,e);return e&&this.error(e),e}}function He(t,e){var i=t.length-1;let o,r,n=0,s=i,a;for(;n<=s;)if(o=t[a=Math.floor((n+s)/2)],r=t[a+1],o<=e){if(a===i||e<r)return a;n=a+1}else{if(!(e<o))throw new _e("Input is not a number.");s=a-1}return 0}class qe{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");var t=i.parse(e[1],1,Wt);if(!t)return null;const o=[];let r=null;i.expectedType&&"value"!==i.expectedType.kind&&(r=i.expectedType);for(let t=1;t<e.length;t+=2){var n=1===t?-1/0:e[t],s=e[t+1],a=t,l=t+1;if("number"!=typeof n)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(o.length&&o[o.length-1][0]>=n)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);l=i.parse(s,l,r);if(!l)return null;r=r||l.type,o.push([n,l])}return new qe(r,t,o)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var o=this.input.evaluate(t);if(o<=e[0])return i[0].evaluate(t);var r=e.length;return(o>=e[r-1]?i[r-1]:i[He(e,o)]).evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)0<t&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}function Ye(t,e,i){return t*(1-i)+e*i}var Xe=Object.freeze({__proto__:null,number:Ye,color:function(t,e,i){return new le(Ye(t.r,e.r,i),Ye(t.g,e.g,i),Ye(t.b,e.b,i),Ye(t.a,e.a,i))},array:function(t,i,o){return t.map((t,e)=>Ye(t,i[e],o))}});const Ke=4/29,$e=6/29,Je=3*$e*$e,Qe=Math.PI/180,ti=180/Math.PI;function ei(t){return.008856451679035631<t?Math.pow(t,1/3):t/Je+Ke}function ii(t){return t>$e?t*t*t:Je*(t-Ke)}function oi(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ri(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ni(t){var e=ri(t.r),i=ri(t.g),o=ri(t.b),r=ei((.4124564*e+.3575761*i+.1804375*o)/.95047),n=ei(.2126729*e+.7151522*i+.072175*o);return{l:116*n-16,a:500*(r-n),b:200*(n-ei((.0193339*e+.119192*i+.9503041*o)/1.08883)),alpha:t.a}}function si(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=+ii(e),i=.95047*ii(i),o=1.08883*ii(o),new le(oi(3.2404542*i-1.5371385*e-.4985314*o),oi(-.969266*i+1.8760108*e+.041556*o),oi(.0556434*i-.2040259*e+1.0572252*o),t.alpha)}const ai={forward:ni,reverse:si,interpolate:function(t,e,i){return{l:Ye(t.l,e.l,i),a:Ye(t.a,e.a,i),b:Ye(t.b,e.b,i),alpha:Ye(t.alpha,e.alpha,i)}}},li={forward:function(t){var{l:e,a:i,b:o}=ni(t),r=Math.atan2(o,i)*ti;return{h:r<0?360+r:r,c:Math.sqrt(i*i+o*o),l:e,alpha:t.a}},reverse:function(t){var e=t.h*Qe,i=t.c;return si({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:(o=t.h,r=e.h,o+i*(180<(r-=o)||r<-180?r-360*Math.round(r/360):r)),c:Ye(t.c,e.c,i),l:Ye(t.l,e.l,i),alpha:Ye(t.alpha,e.alpha,i)};var o,r}};var hi=Object.freeze({__proto__:null,lab:ai,hcl:li});class pi{constructor(t,e,i,o,r){this.type=t,this.operator=e,this.interpolation=i,this.input=o,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,o){let r=0;return"exponential"===t.name?r=ci(e,t.base,i,o):"linear"===t.name?r=ci(e,1,i,o):"cubic-bezier"===t.name&&(t=t.controlPoints,r=new s(t[0],t[1],t[2],t[3]).solve(ci(e,1,i,o))),r}static parse(t,e){let[i,o,r,...n]=t;if(!Array.isArray(o)||0===o.length)return e.error("Expected an interpolation type expression.",1);if("linear"===o[0])o={name:"linear"};else if("exponential"===o[0]){const t=o[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:t}}else{if("cubic-bezier"!==o[0])return e.error(`Unknown interpolation type ${String(o[0])}`,1,0);{const t=o.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||1<t))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,Wt),!r)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=Yt:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<n.length;t+=2){const i=n[t],o=n[t+1],r=t+3,h=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);var l=e.parse(o,h,a);if(!l)return null;a=a||l.type,s.push([i,l])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new pi(a,i,o,r,s):e.error(`Type ${ee(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var o=this.input.evaluate(t);if(o<=e[0])return i[0].evaluate(t);var r=e.length;if(o>=e[r-1])return i[r-1].evaluate(t);var n=He(e,o),r=pi.interpolationFactor(this.interpolation,o,e[n],e[n+1]),o=i[n].evaluate(t),t=i[n+1].evaluate(t);return"interpolate"===this.operator?Xe[this.type.kind.toLowerCase()](o,t,r):"interpolate-hcl"===this.operator?li.reverse(li.interpolate(li.forward(o),li.forward(t),r)):ai.reverse(ai.interpolate(ai.forward(o),ai.forward(t),r))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){var t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function ci(t,e,i,o){o-=i,i=t-i;return 0==o?0:1===e?i/o:(Math.pow(e,i)-1)/(Math.pow(e,o)-1)}class ui{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const o=e.expectedType;o&&"value"!==o.kind&&(i=o);const r=[];for(const o of t.slice(1)){const n=e.parse(o,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!n)return null;i=i||n.type,r.push(n)}t=o&&r.some(t=>oe(o,t.type));return new ui(t?Kt:i,r)}evaluate(t){let e,i=null,o=0;for(const r of this.args)if(o++,i=r.evaluate(t),i&&i instanceof ue&&!i.available&&(e=e||i.name,i=null,o===this.args.length&&(i=e)),null!==i)break;return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}class di{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let t=1;t<e.length-1;t+=2){var r=e[t];if("string"!=typeof r)return i.error(`Expected string, but found ${typeof r} instead.`,t);if(/[^a-zA-Z0-9_]/.test(r))return i.error("Variable names must contain only alphanumeric characters or '_'.",t);var n=i.parse(e[t+1],t+1);if(!n)return null;o.push([r,n])}var t=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return t?new di(o,t):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(var[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}function fi(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function gi(t,e,i,o){return 0===o.compare(e,i)}function yi(o,r,n){const a="=="!==o&&"!="!==o;return class s{constructor(t,e,i){this.type=qt,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var i=t[0];let o=e.parse(t[1],1,Kt);if(!o)return null;if(!fi(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${ee(o.type)}'.`);let r=e.parse(t[2],2,Kt);if(!r)return null;if(!fi(i,r.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${ee(r.type)}'.`);if(o.type.kind!==r.type.kind&&"value"!==o.type.kind&&"value"!==r.type.kind)return e.error(`Cannot compare types '${ee(o.type)}' and '${ee(r.type)}'.`);a&&("value"===o.type.kind&&"value"!==r.type.kind?o=new be(r.type,[o]):"value"!==o.type.kind&&"value"===r.type.kind&&(r=new be(o.type,[r])));let n=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==r.type.kind&&"value"!==o.type.kind&&"value"!==r.type.kind)return e.error("Cannot use collator to compare non-string types.");if(n=e.parse(t[3],3,$t),!n)return null}return new s(o,r,n)}evaluate(t){var e=this.lhs.evaluate(t),i=this.rhs.evaluate(t);if(a&&this.hasUntypedArgument){const r=ge(e),n=ge(i);if(r.kind!==n.kind||"string"!==r.kind&&"number"!==r.kind)throw new _e(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${r.kind}, ${n.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const o=ge(e),n=ge(i);if("string"!==o.kind||"string"!==n.kind)return r(t,e,i)}return this.collator?n(t,e,i,this.collator.evaluate(t)):r(t,e,i)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[o];return this.eachChild(t=>{e.push(t.serialize())}),e}}}var mi=yi("==",function(t,e,i){return e===i},gi),_i=yi("!=",function(t,e,i){return e!==i},function(t,e,i,o){return!gi(0,e,i,o)}),vi=yi("<",function(t,e,i){return e<i},function(t,e,i,o){return o.compare(e,i)<0}),bi=yi(">",function(t,e,i){return i<e},function(t,e,i,o){return 0<o.compare(e,i)}),xi=yi("<=",function(t,e,i){return e<=i},function(t,e,i,o){return o.compare(e,i)<=0});const wi={"==":mi,"!=":_i,">":bi,"<":vi,">=":yi(">=",function(t,e,i){return i<=e},function(t,e,i,o){return 0<=o.compare(e,i)}),"<=":xi,array:be,at:class o{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);var i=e.parse(t[1],1,Wt),e=e.parse(t[2],2,te(e.expectedType||Kt));return i&&e?new o(e.type.itemType,i,e):null}evaluate(t){var e=this.index.evaluate(t),t=this.input.evaluate(t);if(e<0)throw new _e(`Array index out of bounds: ${e} < 0.`);if(e>=t.length)throw new _e(`Array index out of bounds: ${e} > ${t.length-1}.`);if(e!==Math.floor(e))throw new _e(`Array index must be an integer, but found ${e} instead.`);return t[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}},boolean:be,case:class a{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&"value"!==i.expectedType.kind&&(o=i.expectedType);const r=[];for(let t=1;t<e.length-1;t+=2){var n=i.parse(e[t],t,qt);if(!n)return null;var s=i.parse(e[t+1],t+1,o);if(!s)return null;r.push([n,s]),o=o||s.type}var t=i.parse(e[e.length-1],e.length-1,o);return t?new a(o,r,t):null}evaluate(t){for(var[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(var[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every(([,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}},coalesce:ui,collator:Ae,format:xe,image:we,in:class o{constructor(t,e){this.type=qt,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);var i=e.parse(t[1],1,Kt),t=e.parse(t[2],2,Kt);return i&&t?re(i.type,[qt,Ht,Wt,Vt,Kt])?new o(i,t):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ee(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!i)return!1;if(!ne(e,["boolean","string","number","null"]))throw new _e(`Expected first argument to be of type boolean, string, number or null, but found ${ee(ge(e))} instead.`);if(!ne(i,["string","array"]))throw new _e(`Expected second argument to be of type array or string, but found ${ee(ge(i))} instead.`);return 0<=i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}},"index-of":class r{constructor(t,e,i){this.type=Wt,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||5<=t.length)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);var i=e.parse(t[1],1,Kt),o=e.parse(t[2],2,Kt);return i&&o?re(i.type,[qt,Ht,Wt,Vt,Kt])?4!==t.length?new r(i,o):(t=e.parse(t[3],3,Wt))?new r(i,o,t):null:e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ee(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!ne(e,["boolean","string","number","null"]))throw new _e(`Expected first argument to be of type boolean, string, number or null, but found ${ee(ge(e))} instead.`);if(!ne(i,["string","array"]))throw new _e(`Expected second argument to be of type array or string, but found ${ee(ge(i))} instead.`);return this.fromIndex?(t=this.fromIndex.evaluate(t),i.indexOf(e,t)):i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null==this.fromIndex||void 0===this.fromIndex)return["index-of",this.needle.serialize(),this.haystack.serialize()];var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}},interpolate:pi,"interpolate-hcl":pi,"interpolate-lab":pi,length:class i{constructor(t){this.type=Wt,this.input=t}static parse(t,e){return 2!==t.length?e.error(`Expected 1 argument, but found ${t.length-1} instead.`):(t=e.parse(t[1],1))?"array"!==t.type.kind&&"string"!==t.type.kind&&"value"!==t.type.kind?e.error(`Expected argument of type string or array, but found ${ee(t.type)} instead.`):new i(t):null}evaluate(t){if("string"==typeof(t=this.input.evaluate(t)))return t.length;if(Array.isArray(t))return t.length;throw new _e(`Expected value to be of type string or array, but found ${ee(ge(t))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}},let:di,literal:me,match:class p{constructor(t,e,i,o,r,n){this.inputType=t,this.type=e,this.input=i,this.cases=o,this.outputs=r,this.otherwise=n}static parse(i,o){if(i.length<5)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return o.error("Expected an even number of arguments.");let r,n;o.expectedType&&"value"!==o.expectedType.kind&&(n=o.expectedType);const s={},a=[];for(let e=2;e<i.length-1;e+=2){let t=i[e];var l=i[e+1];Array.isArray(t)||(t=[t]);const h=o.concat(e);if(0===t.length)return h.error("Expected at least one branch label.");for(const i of t){if("number"!=typeof i&&"string"!=typeof i)return h.error("Branch labels must be numbers or strings.");if("number"==typeof i&&Math.abs(i)>Number.MAX_SAFE_INTEGER)return h.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof i&&Math.floor(i)!==i)return h.error("Numeric branch labels must be integer values.");if(r){if(h.checkSubtype(r,ge(i)))return null}else r=ge(i);if(void 0!==s[String(i)])return h.error("Branch labels must be unique.");s[String(i)]=a.length}if(!(l=o.parse(l,e,n)))return null;n=n||l.type,a.push(l)}var t=o.parse(i[1],1,Kt);if(!t)return null;var e=o.parse(i[i.length-1],i.length-1,n);return!e||"value"!==t.type.kind&&o.concat(1).checkSubtype(r,t.type)?null:new p(r,n,t,s,a,e)}evaluate(t){var e=this.input.evaluate(t);return(ge(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],o={};for(const t of e){const e=o[this.cases[t]];void 0===e?(o[this.cases[t]]=i.length,i.push([this.cases[t],[t]])):i[e][1].push(t)}var r=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,o]of i)t.push(1===o.length?r(o[0]):o.map(r)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}},number:be,"number-format":class a{constructor(t,e,i,o,r){this.type=Ht,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=o,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");var i=e.parse(t[1],1,Wt);if(!i)return null;if("object"!=typeof(t=t[2])||Array.isArray(t))return e.error("NumberFormat options argument must be an object.");let o=null;if(t.locale&&(o=e.parse(t.locale,1,Ht),!o))return null;let r=null;if(t.currency&&(r=e.parse(t.currency,1,Ht),!r))return null;let n=null;if(t["min-fraction-digits"]&&(n=e.parse(t["min-fraction-digits"],1,Wt),!n))return null;let s=null;return t["max-fraction-digits"]&&(s=e.parse(t["max-fraction-digits"],1,Wt),!s)?null:new a(i,o,r,n,s)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}},object:be,slice:class r{constructor(t,e,i,o){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=o}static parse(t,e){if(t.length<=2||5<=t.length)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);var i=e.parse(t[1],1,Kt),o=e.parse(t[2],2,Wt);return i&&o?re(i.type,[te(Kt),Ht,Kt])?4!==t.length?new r(i.type,i,o):(t=e.parse(t[3],3,Wt))?new r(i.type,i,o,t):null:e.error(`Expected first argument to be of type array or string, but found ${ee(i.type)} instead`):null}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!ne(e,["string","array"]))throw new _e(`Expected first argument to be of type array or string, but found ${ee(ge(e))} instead.`);return this.endIndex?(t=this.endIndex.evaluate(t),e.slice(i,t)):e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null==this.endIndex||void 0===this.endIndex)return["slice",this.input.serialize(),this.beginIndex.serialize()];var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}},step:qe,string:be,"to-boolean":Pe,"to-color":Pe,"to-number":Pe,"to-string":Pe,var:Ve,within:Be};function Mi(t,[e,i,o,r]){e=e.evaluate(t),i=i.evaluate(t),o=o.evaluate(t);r=r?r.evaluate(t):1,t=de(e,i,o,r);if(t)throw new _e(t);return new le(e/255*r,i/255*r,o/255*r,r)}function Pi(t,e){t=e[t];return void 0===t?null:t}function Ei(t){return{type:t}}function Si(t){return{result:"success",value:t}}function Ti(t){return{result:"error",value:t}}function Ai(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Ci(t){return t.expression&&-1<t.expression.parameters.indexOf("zoom")}function Ii(t){return t.expression&&t.expression.interpolated}function Li(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Oi(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Ri(t){return t}function Di(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function ki(t,e,i,o,r){return Di(typeof i===r?o[i]:void 0,t.default,e.default)}function zi(t,e,i){if("number"!==Li(i))return Di(t.default,e.default);e=t.stops.length;if(1===e)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[e-1][0])return t.stops[e-1][1];i=He(t.stops.map(t=>t[0]),i);return t.stops[i][1]}function Fi(t,i,e){var o=void 0!==t.base?t.base:1;if("number"!==Li(e))return Di(t.default,i.default);var r,n=t.stops.length;if(1===n)return t.stops[0][1];if(e<=t.stops[0][0])return t.stops[0][1];if(e>=t.stops[n-1][0])return t.stops[n-1][1];const s=He(t.stops.map(t=>t[0]),e),a=(r=o,n=t.stops[s][0],o=t.stops[s+1][0]-n,n=e-n,0==o?0:1===r?n/o:(Math.pow(r,n)-1)/(Math.pow(r,o)-1)),l=t.stops[s][1],h=t.stops[s+1][1];let p=Xe[i.type]||Ri;if(t.colorSpace&&"rgb"!==t.colorSpace){const i=hi[t.colorSpace];p=(t,e)=>i.reverse(i.interpolate(i.forward(t),i.forward(e),a))}return"function"==typeof l.evaluate?{evaluate(...t){var e=l.evaluate.apply(void 0,t),t=h.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==t)return p(e,t,a)}}:p(l,h,a)}function Ni(t,e,i){return"color"===e.type?i=le.parse(i):"formatted"===e.type?i=ce.fromString(i.toString()):"resolvedImage"===e.type?i=ue.fromString(i.toString()):Li(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Di(i,t.default,e.default)}Te.register(wi,{error:[{kind:"error"},[Ht],(t,[e])=>{throw new _e(e.evaluate(t))}],typeof:[Ht,[Kt],(t,[e])=>ee(ge(e.evaluate(t)))],"to-rgba":[te(Wt,4),[Yt],(t,[e])=>e.evaluate(t).toArray()],rgb:[Yt,[Wt,Wt,Wt],Mi],rgba:[Yt,[Wt,Wt,Wt,Wt],Mi],has:{type:qt,overloads:[[[Ht],(t,[e])=>e.evaluate(t)in t.properties()],[[Ht,Xt],(t,[e,i])=>e.evaluate(t)in i.evaluate(t)]]},get:{type:Kt,overloads:[[[Ht],(t,[e])=>Pi(e.evaluate(t),t.properties())],[[Ht,Xt],(t,[e,i])=>Pi(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Kt,[Ht],(t,[e])=>Pi(e.evaluate(t),t.featureState||{})],properties:[Xt,[],t=>t.properties()],"geometry-type":[Ht,[],t=>t.geometryType()],id:[Kt,[],t=>t.id()],zoom:[Wt,[],t=>t.globals.zoom],"heatmap-density":[Wt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Wt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Wt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Kt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Wt,Ei(Wt),(t,e)=>{let i=0;for(const o of e)i+=o.evaluate(t);return i}],"*":[Wt,Ei(Wt),(t,e)=>{let i=1;for(const o of e)i*=o.evaluate(t);return i}],"-":{type:Wt,overloads:[[[Wt,Wt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Wt],(t,[e])=>-e.evaluate(t)]]},"/":[Wt,[Wt,Wt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Wt,[Wt,Wt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Wt,[Wt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Wt,[Wt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Wt,[Wt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Wt,[Wt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Wt,[Wt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Wt,[Wt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Wt,[Wt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Wt,[Wt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Wt,[Wt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Wt,[Wt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Wt,Ei(Wt),(e,t)=>Math.min(...t.map(t=>t.evaluate(e)))],max:[Wt,Ei(Wt),(e,t)=>Math.max(...t.map(t=>t.evaluate(e)))],abs:[Wt,[Wt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Wt,[Wt],(t,[e])=>{t=e.evaluate(t);return t<0?-Math.round(-t):Math.round(t)}],floor:[Wt,[Wt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Wt,[Wt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[qt,[Ht,Kt],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[qt,[Kt],(t,[e])=>t.id()===e.value],"filter-type-==":[qt,[Ht],(t,[e])=>t.geometryType()===e.value],"filter-<":[qt,[Ht,Kt],(t,[e,i])=>{e=t.properties()[e.value],i=i.value;return typeof e==typeof i&&e<i}],"filter-id-<":[qt,[Kt],(t,[e])=>{t=t.id(),e=e.value;return typeof t==typeof e&&t<e}],"filter->":[qt,[Ht,Kt],(t,[e,i])=>{e=t.properties()[e.value],i=i.value;return typeof e==typeof i&&i<e}],"filter-id->":[qt,[Kt],(t,[e])=>{t=t.id(),e=e.value;return typeof t==typeof e&&e<t}],"filter-<=":[qt,[Ht,Kt],(t,[e,i])=>{e=t.properties()[e.value],i=i.value;return typeof e==typeof i&&e<=i}],"filter-id-<=":[qt,[Kt],(t,[e])=>{t=t.id(),e=e.value;return typeof t==typeof e&&t<=e}],"filter->=":[qt,[Ht,Kt],(t,[e,i])=>{e=t.properties()[e.value],i=i.value;return typeof e==typeof i&&i<=e}],"filter-id->=":[qt,[Kt],(t,[e])=>{t=t.id(),e=e.value;return typeof t==typeof e&&e<=t}],"filter-has":[qt,[Kt],(t,[e])=>e.value in t.properties()],"filter-has-id":[qt,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[qt,[te(Ht)],(t,[e])=>0<=e.value.indexOf(t.geometryType())],"filter-id-in":[qt,[te(Kt)],(t,[e])=>0<=e.value.indexOf(t.id())],"filter-in-small":[qt,[Ht,te(Kt)],(t,[e,i])=>0<=i.value.indexOf(t.properties()[e.value])],"filter-in-large":[qt,[Ht,te(Kt)],(t,[e,i])=>function(t,e,i,o){for(;i<=o;){var r=i+o>>1;if(e[r]===t)return!0;e[r]>t?o=r-1:i=1+r}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:qt,overloads:[[[qt,qt],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Ei(qt),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:qt,overloads:[[[qt,qt],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Ei(qt),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[qt,[qt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[qt,[Ht],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Ht,[Ht],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ht,[Ht],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ht,Ei(Kt),(e,t)=>t.map(t=>ye(t.evaluate(e))).join("")],"resolved-locale":[Ht,[$t],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Ui{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new Se,this._defaultValue=e?"color"===(t=e).type&&Oi(t.default)?new le(0,0,0,0):"color"===t.type?le.parse(t.default)||null:void 0===t.default?null:t.default:null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,o,r,n){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=o,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=n,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,o,r,n){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=o,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=n||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new _e(`Expected value to be one of ${Object.keys(this._enumValues).map(t=>JSON.stringify(t)).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function Bi(t){return Array.isArray(t)&&0<t.length&&"string"==typeof t[0]&&t[0]in wi}function ji(t,e){const i=new We(wi,[],e?(r=e,n={color:Yt,string:Ht,number:Wt,enum:Ht,boolean:qt,formatted:Jt,resolvedImage:Qt},"array"===r.type?te(n[r.value]||Kt,r.length):n[r.type]):void 0),o=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);var r,n;return o?Si(new Ui(o,e)):Ti(i.errors)}class Zi{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Ze(e.expression)}evaluateWithoutErrorHandling(t,e,i,o,r,n){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,o,r,n)}evaluate(t,e,i,o,r,n){return this._styleExpression.evaluate(t,e,i,o,r,n)}}class Gi{constructor(t,e,i,o){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Ze(e.expression),this.interpolationType=o}evaluateWithoutErrorHandling(t,e,i,o,r,n){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,o,r,n)}evaluate(t,e,i,o,r,n){return this._styleExpression.evaluate(t,e,i,o,r,n)}interpolationFactor(t,e,i){return this.interpolationType?pi.interpolationFactor(this.interpolationType,t,e,i):0}}function Vi(t,e){if("error"===(t=ji(t,e)).result)return t;var i=t.value.expression,o=je(i);if(!o&&!Ai(e))return Ti([new Zt("","data expressions not supported")]);var r=Ge(i,["zoom"]);if(!r&&!Ci(e))return Ti([new Zt("","zoom expressions not supported")]);i=function i(t){let o=null;if(t instanceof di)o=i(t.result);else if(t instanceof ui){for(const e of t.args)if(o=i(e),o)break}else(t instanceof qe||t instanceof pi)&&t.input instanceof Te&&"zoom"===t.input.name&&(o=t);return o instanceof Zt||t.eachChild(t=>{const e=i(t);e instanceof Zt?o=e:!o&&e?o=new Zt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&e&&o!==e&&(o=new Zt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}(i);return i||r?i instanceof Zt?Ti([i]):i instanceof pi&&!Ii(e)?Ti([new Zt("",'"interpolate" expressions cannot be used with this property')]):Si(i?new Gi(o?"camera":"composite",t.value,i.labels,i instanceof pi?i.interpolation:void 0):new Zi(o?"constant":"source",t.value)):Ti([new Zt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Wi{constructor(t,e){this._parameters=t,this._specification=e,Ut(this,function t(i,o){const e="color"===o.type,r=i.stops&&"object"==typeof i.stops[0][0],n=r||!(r||void 0!==i.property),s=i.type||(Ii(o)?"exponential":"interval");if(e&&((i=Ut({},i)).stops&&(i.stops=i.stops.map(t=>[t[0],le.parse(t[1])])),i.default=le.parse(i.default||o.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!hi[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let a,l,h;if("exponential"===s)a=Fi;else if("interval"===s)a=zi;else if("categorical"===s){a=ki,l=Object.create(null);for(const o of i.stops)l[o[0]]=o[1];h=typeof i.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);a=Ni}if(r){const e={},r=[];for(let t=0;t<i.stops.length;t++){const n=i.stops[t],s=n[0].zoom;void 0===e[s]&&(e[s]={zoom:s,type:i.type,property:i.property,default:i.default,stops:[]},r.push(s)),e[s].stops.push([n[0].value,n[1]])}const n=[];for(const i of r)n.push([e[i].zoom,t(e[i],o)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:pi.interpolationFactor.bind(void 0,s),zoomStops:n.map(t=>t[0]),evaluate:({zoom:t},e)=>Fi({stops:n,base:i.base},o,t).evaluate(t,e)}}if(n){const e="exponential"===s?{name:"exponential",base:void 0!==i.base?i.base:1}:null;return{kind:"camera",interpolationType:e,interpolationFactor:pi.interpolationFactor.bind(void 0,e),zoomStops:i.stops.map(t=>t[0]),evaluate:({zoom:t})=>a(i,o,t,l,h)}}return{kind:"source",evaluate(t,e){return void 0===(e=e&&e.properties?e.properties[i.property]:void 0)?Di(i.default,o.default):a(i,o,e,l,h)}}}(this._parameters,this._specification))}static deserialize(t){return new Wi(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Hi(e){var i=e.key,o=e.value,r=e.valueSpec||{},n=e.objectElementValidators||{},s=e.style,a=e.styleSpec;let l=[];const h=Li(o);if("object"!==h)return[new Ft(i,o,`object expected, ${h} found`)];for(const e in o){const h=e.split(".")[0],p=r[h]||r["*"];let t;if(n[h])t=n[h];else if(r[h])t=bo;else if(n["*"])t=n["*"];else{if(!r["*"]){l.push(new Ft(i,o[e],`unknown property "${e}"`));continue}t=bo}l=l.concat(t({key:(i&&`${i}.`)+e,value:o[e],valueSpec:p,style:s,styleSpec:a,object:o,objectKey:e},o))}for(const e in r)n[e]||r[e].required&&void 0===r[e].default&&void 0===o[e]&&l.push(new Ft(i,o,`missing required property "${e}"`));return l}function qi(t){const e=t.value,i=t.valueSpec,o=t.style,r=t.styleSpec,n=t.key,s=t.arrayElementValidator||bo;if("array"!==Li(e))return[new Ft(n,e,`array expected, ${Li(e)} found`)];if(i.length&&e.length!==i.length)return[new Ft(n,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Ft(n,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum};r.$version<7&&(a.function=i.function),"object"===Li(i.value)&&(a=i.value);let l=[];for(let t=0;t<e.length;t++)l=l.concat(s({array:e,arrayIndex:t,value:e[t],valueSpec:a,style:o,styleSpec:r,key:`${n}[${t}]`}));return l}function Yi(e){var i=e.key,o=e.value,r=e.valueSpec;let t=Li(o);if("number"===t&&o!=o&&(t="NaN"),"number"!==t)return[new Ft(i,o,`number expected, ${t} found`)];if("minimum"in r){let t=r.minimum;if("array"===Li(r.minimum)&&(t=r.minimum[e.arrayIndex]),o<t)return[new Ft(i,o,`${o} is less than the minimum value ${t}`)]}if("maximum"in r){let t=r.maximum;if("array"===Li(r.maximum)&&(t=r.maximum[e.arrayIndex]),o>t)return[new Ft(i,o,`${o} is greater than the maximum value ${t}`)]}return[]}function Xi(t){const r=t.valueSpec,n=Bt(t.value.type);let s,a,l,h={};const e="categorical"!==n&&void 0===t.value.property,i=!e,p="array"===Li(t.value.stops)&&"array"===Li(t.value.stops[0])&&"object"===Li(t.value.stops[0][0]),o=Hi({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new Ft(t.key,t.value,'identity function may not have a "stops" property')];let e=[];var i=t.value;return e=e.concat(qi({key:t.key,value:i,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:c})),"array"===Li(i)&&0===i.length&&e.push(new Ft(t.key,i,"array must have at least one stop")),e},default:function(t){return bo({key:t.key,value:t.value,valueSpec:r,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&e&&o.push(new Ft(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||o.push(new Ft(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!Ii(t.valueSpec)&&o.push(new Ft(t.key,t.value,"exponential functions not supported")),8<=t.styleSpec.$version&&(i&&!Ai(t.valueSpec)?o.push(new Ft(t.key,t.value,"property functions not supported")):e&&!Ci(t.valueSpec)&&o.push(new Ft(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!p||void 0!==t.value.property||o.push(new Ft(t.key,t.value,'"property" property is required')),o;function c(t){let e=[];var i=t.value,o=t.key;if("array"!==Li(i))return[new Ft(o,i,`array expected, ${Li(i)} found`)];if(2!==i.length)return[new Ft(o,i,`array length 2 expected, length ${i.length} found`)];if(p){if("object"!==Li(i[0]))return[new Ft(o,i,`object expected, ${Li(i[0])} found`)];if(void 0===i[0].zoom)return[new Ft(o,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new Ft(o,i,"object stop key must have value")];if(l&&l>Bt(i[0].zoom))return[new Ft(o,i[0].zoom,"stop zoom values must appear in ascending order")];Bt(i[0].zoom)!==l&&(l=Bt(i[0].zoom),a=void 0,h={}),e=e.concat(Hi({key:`${o}[0]`,value:i[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Yi,value:u}}))}else e=e.concat(u({key:`${o}[0]`,value:i[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},i));return Bi(jt(i[1]))?e.concat([new Ft(`${o}[1]`,i[1],"expressions are not allowed in function stops.")]):e.concat(bo({key:`${o}[1]`,value:i[1],valueSpec:r,style:t.style,styleSpec:t.styleSpec}))}function u(e,i){var o=Li(e.value),t=Bt(e.value),i=null!==e.value?e.value:i;if(s){if(o!==s)return[new Ft(e.key,i,`${o} stop domain type must match previous stop domain type ${s}`)]}else s=o;if("number"!==o&&"string"!==o&&"boolean"!==o)return[new Ft(e.key,i,"stop domain value must be a number, string, or boolean")];if("number"===o||"categorical"===n)return"categorical"!==n||"number"!==o||isFinite(t)&&Math.floor(t)===t?"categorical"!==n&&"number"===o&&void 0!==a&&t<a?[new Ft(e.key,i,"stop domain values must appear in ascending order")]:(a=t,"categorical"===n&&t in h?[new Ft(e.key,i,"stop domain values must be unique")]:(h[t]=!0,[])):[new Ft(e.key,i,`integer expected, found ${t}`)];{let t=`number expected, ${o} found`;return Ai(r)&&void 0===n&&(t+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ft(e.key,i,t)]}}}function Ki(e){const t=("property"===e.expressionContext?Vi:ji)(jt(e.value),e.valueSpec);if("error"===t.result)return t.value.map(t=>new Ft(`${e.key}${t.key}`,e.value,t.message));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new Ft(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Ze(i))return[new Ft(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Ze(i))return[new Ft(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Ge(i,["zoom","feature-state"]))return[new Ft(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!je(i))return[new Ft(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $i(t){const e=t.key,i=t.value,o=t.valueSpec,r=[];return Array.isArray(o.values)?-1===o.values.indexOf(Bt(i))&&r.push(new Ft(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(o.values).indexOf(Bt(i))&&r.push(new Ft(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function Ji(t){if(!0===t||!1===t)return 1;if(Array.isArray(t)&&0!==t.length)switch(t[0]){case"has":return 2<=t.length&&"$id"!==t[1]&&"$type"!==t[1];case"in":return 3<=t.length&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Ji(e)&&"boolean"!=typeof e)return;return 1;default:return 1}}const Qi={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function to(t){if(null==t)return{filter:()=>!0,needGeometry:!1};const o=ji(t=!Ji(t)?io(t):t,Qi);if("error"===o.result)throw new Error(o.value.map(t=>`${t.key}: ${t.message}`).join(", "));return{filter:(t,e,i)=>o.value.evaluate(t,e,{},i),needGeometry:function e(i){if(!Array.isArray(i))return!1;if("within"===i[0])return!0;for(let t=1;t<i.length;t++)if(e(i[t]))return!0;return!1}(t)}}function eo(t,e){return t<e?-1:e<t?1:0}function io(t){if(!t)return!0;var e,i=t[0];return t.length<=1?"any"!==i:"=="===i?oo(t[1],t[2],"=="):"!="===i?so(oo(t[1],t[2],"==")):"<"===i||">"===i||"<="===i||">="===i?oo(t[1],t[2],i):"any"===i?(e=t.slice(1),["any"].concat(e.map(io))):"all"===i?["all"].concat(t.slice(1).map(io)):"none"===i?["all"].concat(t.slice(1).map(io).map(so)):"in"===i?ro(t[1],t.slice(2)):"!in"===i?so(ro(t[1],t.slice(2))):"has"===i?no(t[1]):"!has"===i?so(no(t[1])):"within"!==i||t}function oo(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function ro(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return 200<e.length&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",t,["literal",e.sort(eo)]]:["filter-in-small",t,["literal",e]]}}function no(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function so(t){return["!",t]}function ao(t){return Ji(jt(t.value))?Ki(Ut({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function e(i){const o=i.value,r=i.key;if("array"!==Li(o))return[new Ft(r,o,`array expected, ${Li(o)} found`)];const n=i.styleSpec;let s,a=[];if(o.length<1)return[new Ft(r,o,"filter array must have at least 1 element")];switch(a=a.concat($i({key:`${r}[0]`,value:o[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),Bt(o[0])){case"<":case"<=":case">":case">=":2<=o.length&&"$type"===Bt(o[1])&&a.push(new Ft(r,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&a.push(new Ft(r,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":2<=o.length&&(s=Li(o[1]),"string"!==s&&a.push(new Ft(`${r}[1]`,o[1],`string expected, ${s} found`)));for(let t=2;t<o.length;t++)s=Li(o[t]),"$type"===Bt(o[1])?a=a.concat($i({key:`${r}[${t}]`,value:o[t],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):"string"!==s&&"number"!==s&&"boolean"!==s&&a.push(new Ft(`${r}[${t}]`,o[t],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let t=1;t<o.length;t++)a=a.concat(e({key:`${r}[${t}]`,value:o[t],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":s=Li(o[1]),2!==o.length?a.push(new Ft(r,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==s&&a.push(new Ft(`${r}[1]`,o[1],`string expected, ${s} found`));break;case"within":s=Li(o[1]),2!==o.length?a.push(new Ft(r,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==s&&a.push(new Ft(`${r}[1]`,o[1],`object expected, ${s} found`))}return a}(t)}function lo(t,e){const i=t.key,o=t.style,r=t.styleSpec,n=t.value,s=t.objectKey,a=r[`${e}_${t.layerType}`];if(!a)return[];var l=s.match(/^(.*)-transition$/);if("paint"===e&&l&&a[l[1]]&&a[l[1]].transition)return bo({key:i,value:n,valueSpec:r.transition,style:o,styleSpec:r});l=t.valueSpec||a[s];if(!l)return[new Ft(i,n,`unknown property "${s}"`)];let h;if("string"===Li(n)&&Ai(l)&&!l.tokens&&(h=/^{([^}]+)}$/.exec(n)))return[new Ft(i,n,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const p=[];return"symbol"===t.layerType&&("text-field"===s&&o&&!o.glyphs&&p.push(new Ft(i,n,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Oi(jt(n))&&"identity"===Bt(n.type)&&p.push(new Ft(i,n,'"text-font" does not support identity functions'))),p.concat(bo({key:t.key,value:n,valueSpec:l,style:o,styleSpec:r,expressionContext:"property",propertyType:e,propertyKey:s}))}function ho(t){return lo(t,"paint")}function po(t){return lo(t,"layout")}function co(e){let i=[];const o=e.value,r=e.key,n=e.style,s=e.styleSpec;o.type||o.ref||i.push(new Ft(r,o,'either "type" or "ref" is required'));let a=Bt(o.type);const l=Bt(o.ref);if(o.id){const s=Bt(o.id);for(let t=0;t<e.arrayIndex;t++){const e=n.layers[t];Bt(e.id)===s&&i.push(new Ft(r,o.id,`duplicate layer id "${o.id}", previously used at line ${e.id.__line__}`))}}if("ref"in o){let e;["type","source","source-layer","filter","layout"].forEach(t=>{t in o&&i.push(new Ft(r,o[t],`"${t}" is prohibited for ref layers`))}),n.layers.forEach(t=>{Bt(t.id)===l&&(e=t)}),e?e.ref?i.push(new Ft(r,o.ref,"ref cannot reference another ref layer")):a=Bt(e.type):i.push(new Ft(r,o.ref,`ref layer "${l}" not found`))}else if("background"!==a&&"sky"!==a)if(o.source){const e=n.sources&&n.sources[o.source],s=e&&Bt(e.type);e?"vector"===s&&"raster"===a?i.push(new Ft(r,o.source,`layer "${o.id}" requires a raster source`)):"raster"===s&&"raster"!==a?i.push(new Ft(r,o.source,`layer "${o.id}" requires a vector source`)):"vector"!==s||o["source-layer"]?"raster-dem"===s&&"hillshade"!==a?i.push(new Ft(r,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==a||!o.paint||!o.paint["line-gradient"]||"geojson"===s&&e.lineMetrics||i.push(new Ft(r,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Ft(r,o,`layer "${o.id}" must specify a "source-layer"`)):i.push(new Ft(r,o.source,`source "${o.source}" not found`))}else i.push(new Ft(r,o,'missing required property "source"'));return i=i.concat(Hi({key:r,value:o,valueSpec:s.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>bo({key:`${r}.type`,value:o.type,valueSpec:s.layer.type,style:e.style,styleSpec:e.styleSpec,object:o,objectKey:"type"}),filter:ao,layout:t=>Hi({layer:o,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>po(Ut({layerType:a},t))}}),paint:t=>Hi({layer:o,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>ho(Ut({layerType:a},t))}})}})),i}function uo(t){var e=t.value,i=t.key,t=Li(e);return"string"!==t?[new Ft(i,e,`string expected, ${t} found`)]:[]}const fo={promoteId:function({key:t,value:e}){if("string"===Li(e))return uo({key:t,value:e});{const i=[];for(const o in e)i.push(...uo({key:`${t}.${o}`,value:e[o]}));return i}}};function go(t){const e=t.value,i=t.key,o=t.styleSpec,r=t.style;if(!e.type)return[new Ft(i,e,'"type" is required')];const n=Bt(e.type);let s;switch(n){case"vector":case"raster":case"raster-dem":return s=Hi({key:i,value:e,valueSpec:o[`source_${n.replace("-","_")}`],style:t.style,styleSpec:o,objectElementValidators:fo}),s;case"geojson":if(s=Hi({key:i,value:e,valueSpec:o.source_geojson,style:r,styleSpec:o,objectElementValidators:fo}),e.cluster)for(const t in e.clusterProperties){const[o,r]=e.clusterProperties[t],n="string"==typeof o?[o,["accumulated"],["get",t]]:o;s.push(...Ki({key:`${i}.${t}.map`,value:r,expressionContext:"cluster-map"})),s.push(...Ki({key:`${i}.${t}.reduce`,value:n,expressionContext:"cluster-reduce"}))}return s;case"video":return Hi({key:i,value:e,valueSpec:o.source_video,style:r,styleSpec:o});case"image":return Hi({key:i,value:e,valueSpec:o.source_image,style:r,styleSpec:o});case"canvas":return[new Ft(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $i({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:o})}}function yo(t){var e=t.value,i=t.styleSpec,o=i.light,r=t.style;let n=[];const s=Li(e);if(void 0===e)return n;if("object"!==s)return n=n.concat([new Ft("light",e,`object expected, ${s} found`)]),n;for(const t in e){const s=t.match(/^(.*)-transition$/);n=n.concat(s&&o[s[1]]&&o[s[1]].transition?bo({key:t,value:e[t],valueSpec:i.transition,style:r,styleSpec:i}):o[t]?bo({key:t,value:e[t],valueSpec:o[t],style:r,styleSpec:i}):[new Ft(t,e[t],`unknown property "${t}"`)])}return n}function mo(t){const e=t.value,i=t.key,o=t.style,r=t.styleSpec,n=r.terrain;let s=[];t=Li(e);if(void 0===e)return s;if("object"!==t)return s=s.concat([new Ft("terrain",e,`object expected, ${t} found`)]),s;for(const a in e){const i=a.match(/^(.*)-transition$/);s=s.concat(i&&n[i[1]]&&n[i[1]].transition?bo({key:a,value:e[a],valueSpec:r.transition,style:o,styleSpec:r}):n[a]?bo({key:a,value:e[a],valueSpec:n[a],style:o,styleSpec:r}):[new Ft(a,e[a],`unknown property "${a}"`)])}if(e.source){const a=o.sources&&o.sources[e.source],r=a&&Bt(a.type);a?"raster-dem"!==r&&s.push(new Ft(i,e.source,`terrain cannot be used with a source of type ${r}, it only be used with a "raster-dem" source type`)):s.push(new Ft(i,e.source,`source "${e.source}" not found`))}else s.push(new Ft(i,e,'terrain is missing required property "source"'));return s}function _o(t){var e=t.value,i=t.style,o=t.styleSpec,r=o.fog;let n=[];const s=Li(e);if(void 0===e)return n;if("object"!==s)return n=n.concat([new Ft("fog",e,`object expected, ${s} found`)]),n;e.range&&!Bi(jt(e.range))&&e.range[0]>=e.range[1]&&(n=n.concat([new Ft("fog",e,"fog.range[0] can't be greater than or equal to fog.range[1]")]));for(const t in e){const s=t.match(/^(.*)-transition$/);n=n.concat(s&&r[s[1]]&&r[s[1]].transition?bo({key:t,value:e[t],valueSpec:o.transition,style:i,styleSpec:o}):r[t]?bo({key:t,value:e[t],valueSpec:r[t],style:i,styleSpec:o}):[new Ft(t,e[t],`unknown property "${t}"`)])}return n}const vo={"*":()=>[],array:qi,boolean:function(t){var e=t.value,i=t.key,t=Li(e);return"boolean"!==t?[new Ft(i,e,`boolean expected, ${t} found`)]:[]},number:Yi,color:function(t){var e=t.key,i=t.value,t=Li(i);return"string"!==t?[new Ft(e,i,`color expected, ${t} found`)]:null===ae.parseCSSColor(i)?[new Ft(e,i,`color expected, "${i}" found`)]:[]},constants:Nt,enum:$i,filter:ao,function:Xi,layer:co,object:Hi,source:go,light:yo,terrain:mo,fog:_o,string:uo,formatted:function(t){return 0===uo(t).length?[]:Ki(t)},resolvedImage:function(t){return 0===uo(t).length?[]:Ki(t)}};function bo(t){var e=t.value,i=t.valueSpec,o=t.styleSpec;return i.expression&&Oi(Bt(e))?Xi(t):i.expression&&Bi(jt(e))?Ki(t):i.type&&vo[i.type]?vo[i.type](t):Hi(Ut({},t,{valueSpec:i.type?o[i.type]:i}))}function xo(t){const e=t.value,i=t.key,o=uo(t);return o.length||(-1===e.indexOf("{fontstack}")&&o.push(new Ft(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&o.push(new Ft(i,e,'"glyphs" url must include a "{range}" token'))),o}function wo(t,e=zt){let i=[];return i=i.concat(bo({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:xo,"*":()=>[]}})),t.constants&&(i=i.concat(Nt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Mo(i)}function Mo(t){return[].concat(t).sort((t,e)=>t.line-e.line)}function Po(e){return function(...t){return Mo(e.apply(this,t))}}wo.source=Po(go),wo.light=Po(yo),wo.terrain=Po(mo),wo.fog=Po(_o),wo.layer=Po(co),wo.filter=Po(ao),wo.paintProperty=Po(ho),wo.layoutProperty=Po(po);const Eo=wo,So=Eo.light,To=Eo.fog,Ao=Eo.paintProperty,Co=Eo.layoutProperty;function Io(t,e){let i=!1;if(e&&e.length)for(const o of e)t.fire(new Dt(new Error(o.message))),i=!0;return i}var Lo=Oo;function Oo(t,e,i){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(i=r[2]);for(var n=0;n<this.d*this.d;n++){var s=r[3+n],a=r[3+n+1];o.push(s===a?null:r.subarray(s,a))}var l=r[3+o.length+1];this.keys=r.subarray(r[3+o.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var h=0;h<this.d*this.d;h++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;e=i/e*t;this.min=-e,this.max=t+e}Oo.prototype.insert=function(t,e,i,o,r){this._forEachCell(e,i,o,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(r)},Oo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Oo.prototype._insertCell=function(t,e,i,o,r,n){this.cells[r].push(n)},Oo.prototype.query=function(t,e,i,o,r){var n=this.min,s=this.max;if(t<=n&&e<=n&&s<=i&&s<=o&&!r)return Array.prototype.slice.call(this.keys);s=[];return this._forEachCell(t,e,i,o,this._queryCell,s,{},r),s},Oo.prototype._queryCell=function(t,e,i,o,r,n,s,a){var l=this.cells[r];if(null!==l)for(var h=this.keys,p=this.bboxes,c=0;c<l.length;c++){var u,d=l[c];void 0===s[d]&&(u=4*d,(a?a(p[0+u],p[1+u],p[2+u],p[3+u]):t<=p[2+u]&&e<=p[3+u]&&i>=p[0+u]&&o>=p[1+u])?(s[d]=!0,n.push(h[d])):s[d]=!1)}},Oo.prototype._forEachCell=function(t,e,i,o,r,n,s,a){for(var l=this._convertToCellCoord(t),h=this._convertToCellCoord(e),p=this._convertToCellCoord(i),c=this._convertToCellCoord(o),u=l;u<=p;u++)for(var d=h;d<=c;d++){var f=this.d*d+u;if((!a||a(this._convertFromCellCoord(u),this._convertFromCellCoord(d),this._convertFromCellCoord(u+1),this._convertFromCellCoord(d+1)))&&r.call(this,t,e,i,o,f,n,s,a))return}},Oo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Oo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Oo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,o=0;o<this.cells.length;o++)i+=this.cells[o].length;var r=new Int32Array(e+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var n=e,s=0;s<t.length;s++){var a=t[s];r[3+s]=n,r.set(a,n),n+=a.length}return r[3+t.length]=n,r.set(this.keys,n),r[3+t.length+1]=n+=this.keys.length,r.set(this.bboxes,n),n+=this.bboxes.length,r.buffer};const{ImageData:Ro,ImageBitmap:Do}=c,ko={};function zo(t,e,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),ko[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}zo("Object",Object),Lo.serialize=function(t,e){t=t.toArrayBuffer();return e&&e.push(t),{buffer:t}},Lo.deserialize=function(t){return new Lo(t.buffer)},zo("Grid",Lo),zo("Color",le),zo("Error",Error),zo("ResolvedImage",ue),zo("StylePropertyFunction",Wi),zo("StyleExpression",Ui,{omit:["_evaluator"]}),zo("ZoomDependentExpression",Gi),zo("ZoomConstantExpression",Zi),zo("CompoundExpression",Te,{omit:["_evaluate"]});for(const t in wi)wi[t]._classRegistryKey||zo(`Expression_${t}`,wi[t]);function Fo(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function No(t){return Do&&t instanceof Do}function Uo(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Fo(t)||No(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var i=t;return e&&e.push(i.buffer),i}if(t instanceof Ro)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const n of t)r.push(Uo(n,e));return r}if("object"!=typeof t)throw new Error("can't serialize object of type "+typeof t);{const s=t.constructor,a=s._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");const l=s.serialize?s.serialize(t,e):{};if(!s.serialize){for(const h in t){var o;t.hasOwnProperty(h)&&(0<=ko[a].omit.indexOf(h)||(o=t[h],l[h]=0<=ko[a].shallow.indexOf(h)?o:Uo(o,e)))}t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==a&&(l.$name=a),l}}function Bo(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Fo(t)||No(t)||ArrayBuffer.isView(t)||t instanceof Ro)return t;if(Array.isArray(t))return t.map(Bo);if("object"!=typeof t)throw new Error("can't deserialize object of type "+typeof t);{const i=t.$name||"Object",{klass:o}=ko[i];if(!o)throw new Error(`can't deserialize unregistered class ${i}`);if(o.deserialize)return o.deserialize(t);const r=Object.create(o.prototype);for(const n of Object.keys(t)){var e;"$name"!==n&&(e=t[n],r[n]=0<=ko[i].shallow.indexOf(n)?e:Bo(e))}return r}}class jo{constructor(){this.first=!0}update(t,e){var i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))}}const Zo=t=>1536<=t&&t<=1791,Go=t=>1872<=t&&t<=1919,Vo=t=>2208<=t&&t<=2303,Wo=t=>11904<=t&&t<=12031,Ho=t=>12032<=t&&t<=12255,qo=t=>12272<=t&&t<=12287,Yo=t=>12288<=t&&t<=12351,Xo=t=>12352<=t&&t<=12447,Ko=t=>12448<=t&&t<=12543,$o=t=>12544<=t&&t<=12591,Jo=t=>12704<=t&&t<=12735,Qo=t=>12736<=t&&t<=12783,tr=t=>12784<=t&&t<=12799,er=t=>12800<=t&&t<=13055,ir=t=>13056<=t&&t<=13311,or=t=>13312<=t&&t<=19903,rr=t=>19968<=t&&t<=40959,nr=t=>40960<=t&&t<=42127,sr=t=>42128<=t&&t<=42191,ar=t=>44032<=t&&t<=55215,lr=t=>63744<=t&&t<=64255,hr=t=>64336<=t&&t<=65023,pr=t=>65040<=t&&t<=65055,cr=t=>65072<=t&&t<=65103,ur=t=>65104<=t&&t<=65135,dr=t=>65136<=t&&t<=65279,fr=t=>65280<=t&&t<=65519;function gr(t){for(const e of t)if(mr(e.charCodeAt(0)))return!0;return!1}function yr(t){for(const i of t)if(e=i.charCodeAt(0),Zo(e)||Go(e)||Vo(e)||hr(e)||dr(e))return;var e;return 1}function mr(t){return 746===t||747===t||!(t<4352)&&(Jo(t)||$o(t)||cr(t)&&!(65097<=t&&t<=65103)||lr(t)||ir(t)||Wo(t)||Qo(t)||!(!Yo(t)||12296<=t&&t<=12305||12308<=t&&t<=12319||12336===t)||or(t)||rr(t)||er(t)||12592<=t&&t<=12687||43360<=t&&t<=43391||55216<=t&&t<=55295||4352<=t&&t<=4607||ar(t)||Xo(t)||qo(t)||12688<=t&&t<=12703||Ho(t)||tr(t)||Ko(t)&&12540!==t||!(!fr(t)||65288===t||65289===t||65293===t||65306<=t&&t<=65310||65339===t||65341===t||65343===t||65371<=t&&t<=65503||65507===t||65512<=t&&t<=65519)||!(!ur(t)||65112<=t&&t<=65118||65123<=t&&t<=65126)||5120<=t&&t<=5759||6320<=t&&t<=6399||pr(t)||19904<=t&&t<=19967||nr(t)||sr(t))}function _r(t){return!(mr(t)||(128<=(t=t)&&t<=255&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||8192<=t&&t<=8303&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||8448<=t&&t<=8527||8528<=t&&t<=8591||8960<=t&&t<=9215&&(8960<=t&&t<=8967||8972<=t&&t<=8991||8996<=t&&t<=9e3||9003===t||9085<=t&&t<=9114||9150<=t&&t<=9165||9167===t||9169<=t&&t<=9179||9186<=t&&t<=9215)||9216<=t&&t<=9279&&9251!==t||9280<=t&&t<=9311||9312<=t&&t<=9471||9632<=t&&t<=9727||9728<=t&&t<=9983&&!(9754<=t&&t<=9759)||11008<=t&&t<=11263&&(11026<=t&&t<=11055||11088<=t&&t<=11097||11192<=t&&t<=11243)||Yo(t)||Ko(t)||57344<=t&&t<=63743||cr(t)||ur(t)||fr(t)||8734===t||8756===t||8757===t||9984<=t&&t<=10087||10102<=t&&t<=10131||65532===t||65533===t))}function vr(t){return 1424<=t&&t<=2303||hr(t)||dr(t)}const br="deferred",xr="loading",wr="loaded";let Mr=null,Pr="unavailable",Er=null;const Sr=function(t){t&&"string"==typeof t&&-1<t.indexOf("NetworkError")&&(Pr="error"),Mr&&Mr(t)};function Tr(){Ar.fire(new Rt("pluginStateChange",{pluginStatus:Pr,pluginURL:Er}))}const Ar=new kt,Cr=function(){return Pr},Ir=function(){if(Pr!==br||!Er)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Pr=xr,Tr(),Er&&Pt({url:Er},t=>{t?Sr(t):(Pr=wr,Tr())})},Lr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Pr===wr||null!=Lr.applyArabicShaping,isLoading:()=>Pr===xr,setState(t){Pr=t.pluginStatus,Er=t.pluginURL},isParsed:()=>null!=Lr.applyArabicShaping&&null!=Lr.processBidirectionalText&&null!=Lr.processStyledBidirectionalText,getPluginURL:()=>Er};class Or{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new jo,this.transition={})}isSupportedScript(t){return function(t,e){for(const r of t)if(i=r.charCodeAt(0),o=e,!o&&vr(i)||2304<=i&&i<=3583||3840<=i&&i<=4255||6016<=i&&i<=6143)return!1;var i,o;return!0}(t,Lr.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){var t=this.zoom,e=t-Math.floor(t),i=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*e}}}class Rr{constructor(t,e){this.property=t,this.value=e,this.expression=function(e,i){if(Oi(e))return new Wi(e,i);if(Bi(e)){const t=Vi(e,i);if("error"===t.result)throw new Error(t.value.map(t=>`${t.key}: ${t.message}`).join(", "));return t.value}{let t=e;return"string"==typeof e&&"color"===i.type&&(t=le.parse(e)),{kind:"constant",evaluate:()=>t}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class Dr{constructor(t){this.property=t,this.value=new Rr(t,void 0)}transitioned(t,e){return new zr(this.property,this.value,e,v({},t.transition,this.transition),t.now)}untransitioned(){return new zr(this.property,this.value,null,{},0)}}class kr{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return A(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Dr(this._values[t].property)),this._values[t].value=new Rr(this._values[t].property,null===e?void 0:A(e))}getTransition(t){return A(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Dr(this._values[t].property)),this._values[t].transition=A(e)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){var e=this.getValue(i);void 0!==e&&(t[i]=e);e=this.getTransition(i);void 0!==e&&(t[`${i}-transition`]=e)}return t}transitioned(t,e){const i=new Fr(this._properties);for(const o of Object.keys(this._values))i._values[o]=this._values[o].transitioned(t,e._values[o]);return i}untransitioned(){const t=new Fr(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class zr{constructor(t,e,i,o,r){var n=o.delay||0,s=o.duration||0;r=r||0,this.property=t,this.value=e,this.begin=r+n,this.end=this.begin+s,t.specification.transition&&(o.delay||o.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const o=t.now||0,r=this.value.possiblyEvaluate(t,e,i),n=this.prior;if(n){if(o>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(o<this.begin)return n.possiblyEvaluate(t,e,i);var s=(o-this.begin)/(this.end-this.begin);return this.property.interpolate(n.possiblyEvaluate(t,e,i),r,h(s))}return r}}class Fr{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const o=new Br(this._properties);for(const r of Object.keys(this._values))o._values[r]=this._values[r].possiblyEvaluate(t,e,i);return o}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Nr{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return A(this._values[t].value)}setValue(t,e){this._values[t]=new Rr(this._values[t].property,null===e?void 0:A(e))}serialize(){const t={};for(const i of Object.keys(this._values)){var e=this.getValue(i);void 0!==e&&(t[i]=e)}return t}possiblyEvaluate(t,e,i){const o=new Br(this._properties);for(const r of Object.keys(this._values))o._values[r]=this._values[r].possiblyEvaluate(t,e,i);return o}}class Ur{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,o){return this.property.evaluate(this.value,this.parameters,t,e,i,o)}}class Br{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class jr{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,i){const o=Xe[this.specification.type];return o?o(t,e,i):t}}class Zr{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,o){return new Ur(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,o)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Ur(this,{kind:"constant",value:void 0},t.parameters);const o=Xe[this.specification.type];return o?new Ur(this,{kind:"constant",value:o(t.value.value,e.value.value,i)},t.parameters):t}evaluate(t,e,i,o,r,n){return"constant"===t.kind?t.value:t.evaluate(e,i,o,r,n)}}class Gr extends Zr{possiblyEvaluate(t,e,i,o){if(void 0===t.value)return new Ur(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){o=t.expression.evaluate(e,null,{},i,o),o="resolvedImage"===t.property.specification.type&&"string"!=typeof o?o.name:o,o=this._calculate(o,o,o,e);return new Ur(this,{kind:"constant",value:o},e)}if("camera"!==t.expression.kind)return new Ur(this,t.expression,e);{const i=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new Ur(this,{kind:"constant",value:i},e)}}evaluate(t,e,i,o,r,n){if("source"!==t.kind)return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},i,o),t.evaluate({zoom:Math.floor(e.zoom)},i,o),t.evaluate({zoom:Math.floor(e.zoom)+1},i,o),e):t.value;n=t.evaluate(e,i,o,r,n);return this._calculate(n,n,n,e)}_calculate(t,e,i,o){return o.zoom>o.zoomHistory.lastIntegerZoom?{from:t,to:e,other:i}:{from:i,to:e,other:t}}interpolate(t){return t}}class Vr{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,o){if(void 0!==t.value){if("constant"!==t.expression.kind)return this._calculate(t.expression.evaluate(new Or(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Or(Math.floor(e.zoom),e)),t.expression.evaluate(new Or(Math.floor(e.zoom+1),e)),e);o=t.expression.evaluate(e,null,{},i,o);return this._calculate(o,o,o,e)}}_calculate(t,e,i,o){return o.zoom>o.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class Wr{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,o){return!!t.expression.evaluate(e,null,{},i,o)}interpolate(){return!1}}class Hr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in t){var e=t[i];e.specification.overridable&&this.overridableProperties.push(i);const o=this.defaultPropertyValues[i]=new Rr(e,void 0),r=this.defaultTransitionablePropertyValues[i]=new Dr(e);this.defaultTransitioningPropertyValues[i]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=o.possiblyEvaluate({})}}}function qr(t,e){return 256*(t=d(Math.floor(t),0,255))+d(Math.floor(e),0,255)}zo("DataDrivenProperty",Zr),zo("DataConstantProperty",jr),zo("CrossFadedDataDrivenProperty",Gr),zo("CrossFadedProperty",Vr),zo("ColorRampProperty",Wr);const Yr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xr{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Kr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){t>this.capacity&&(this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement),t=this.uint8,this._refreshViews(),t&&this.uint8.set(t))}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function $r(t,r=1){let n=0,s=0;return{members:t.map(t=>{var e=Yr[t.type].BYTES_PER_ELEMENT,i=n=Jr(n,Math.max(r,e)),o=t.components||1;return s=Math.max(s,e),n+=e*o,{name:t.name,type:t.type,components:o,offset:i}}),size:Jr(n,Math.max(s,r)),alignment:r}}function Jr(t,e){return Math.ceil(t/e)*e}class Qr extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){var i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){var o=2*t;return this.int16[0+o]=e,this.int16[1+o]=i,t}}Qr.prototype.bytesPerElement=4,zo("StructArrayLayout2i4",Qr);class tn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,o){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,o)}emplace(t,e,i,o,r){var n=4*t;return this.int16[0+n]=e,this.int16[1+n]=i,this.int16[2+n]=o,this.int16[3+n]=r,t}}tn.prototype.bytesPerElement=8,zo("StructArrayLayout4i8",tn);class en extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,o,r,n,s){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,o,r,n,s)}emplace(t,e,i,o,r,n,s,a){var l=6*t,h=12*t,p=3*t;return this.int16[0+l]=e,this.int16[1+l]=i,this.uint8[4+h]=o,this.uint8[5+h]=r,this.uint8[6+h]=n,this.uint8[7+h]=s,this.float32[2+p]=a,t}}en.prototype.bytesPerElement=12,zo("StructArrayLayout2i4ub1f12",en);class on extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){var i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){var o=2*t;return this.float32[0+o]=e,this.float32[1+o]=i,t}}on.prototype.bytesPerElement=8,zo("StructArrayLayout2f8",on);class rn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,o,r,n,s,a,l,h){var p=this.length;return this.resize(p+1),this.emplace(p,t,e,i,o,r,n,s,a,l,h)}emplace(t,e,i,o,r,n,s,a,l,h,p){var c=10*t;return this.uint16[0+c]=e,this.uint16[1+c]=i,this.uint16[2+c]=o,this.uint16[3+c]=r,this.uint16[4+c]=n,this.uint16[5+c]=s,this.uint16[6+c]=a,this.uint16[7+c]=l,this.uint16[8+c]=h,this.uint16[9+c]=p,t}}rn.prototype.bytesPerElement=20,zo("StructArrayLayout10ui20",rn);class nn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,o,r,n,s,a){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,i,o,r,n,s,a)}emplace(t,e,i,o,r,n,s,a,l){var h=8*t;return this.uint16[0+h]=e,this.uint16[1+h]=i,this.uint16[2+h]=o,this.uint16[3+h]=r,this.uint16[4+h]=n,this.uint16[5+h]=s,this.uint16[6+h]=a,this.uint16[7+h]=l,t}}nn.prototype.bytesPerElement=16,zo("StructArrayLayout8ui16",nn);class sn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,o,r,n,s,a,l,h,p,c){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,o,r,n,s,a,l,h,p,c)}emplace(t,e,i,o,r,n,s,a,l,h,p,c,u){var d=12*t;return this.int16[0+d]=e,this.int16[1+d]=i,this.int16[2+d]=o,this.int16[3+d]=r,this.uint16[4+d]=n,this.uint16[5+d]=s,this.uint16[6+d]=a,this.uint16[7+d]=l,this.int16[8+d]=h,this.int16[9+d]=p,this.int16[10+d]=c,this.int16[11+d]=u,t}}sn.prototype.bytesPerElement=24,zo("StructArrayLayout4i4ui4i24",sn);class an extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,i)}emplace(t,e,i,o){var r=3*t;return this.float32[0+r]=e,this.float32[1+r]=i,this.float32[2+r]=o,t}}an.prototype.bytesPerElement=12,zo("StructArrayLayout3f12",an);class ln extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[+t+0]=e,t}}ln.prototype.bytesPerElement=4,zo("StructArrayLayout1ul4",ln);class hn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,o,r,n,s,a,l,h){var p=this.length;return this.resize(p+1),this.emplace(p,t,e,i,o,r,n,s,a,l,h)}emplace(t,e,i,o,r,n,s,a,l,h,p){var c=16*t,u=8*t;return this.int16[0+c]=e,this.int16[1+c]=i,this.float32[1+u]=o,this.float32[2+u]=r,this.float32[3+u]=n,this.float32[4+u]=s,this.int16[10+c]=a,this.uint32[6+u]=l,this.uint16[14+c]=h,this.uint16[15+c]=p,t}}hn.prototype.bytesPerElement=32,zo("StructArrayLayout2i4f1i1ul2ui32",hn);class pn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,o,r,n){var s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,o,r,n)}emplace(t,e,i,o,r,n,s){var a=6*t;return this.int16[0+a]=e,this.int16[1+a]=i,this.int16[2+a]=o,this.int16[3+a]=r,this.int16[4+a]=n,this.int16[5+a]=s,t}}pn.prototype.bytesPerElement=12,zo("StructArrayLayout2i2i2i12",pn);class cn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,o,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,o,r)}emplace(t,e,i,o,r,n){var s=4*t,a=8*t;return this.float32[0+s]=e,this.float32[1+s]=i,this.float32[2+s]=o,this.int16[6+a]=r,this.int16[7+a]=n,t}}cn.prototype.bytesPerElement=16,zo("StructArrayLayout2f1f2i16",cn);class un extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,o){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,o)}emplace(t,e,i,o,r){var n=12*t,s=3*t;return this.uint8[0+n]=e,this.uint8[1+n]=i,this.float32[1+s]=o,this.float32[2+s]=r,t}}un.prototype.bytesPerElement=12,zo("StructArrayLayout2ub2f12",un);class dn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,i)}emplace(t,e,i,o){var r=3*t;return this.uint16[0+r]=e,this.uint16[1+r]=i,this.uint16[2+r]=o,t}}dn.prototype.bytesPerElement=6,zo("StructArrayLayout3ui6",dn);class fn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,o,r,n,s,a,l,h,p,c,u,d,f,g,y,m){var _=this.length;return this.resize(_+1),this.emplace(_,t,e,i,o,r,n,s,a,l,h,p,c,u,d,f,g,y,m)}emplace(t,e,i,o,r,n,s,a,l,h,p,c,u,d,f,g,y,m,_){var v=24*t,b=12*t,x=48*t;return this.int16[0+v]=e,this.int16[1+v]=i,this.uint16[2+v]=o,this.uint16[3+v]=r,this.uint32[2+b]=n,this.uint32[3+b]=s,this.uint32[4+b]=a,this.uint16[10+v]=l,this.uint16[11+v]=h,this.uint16[12+v]=p,this.float32[7+b]=c,this.float32[8+b]=u,this.uint8[36+x]=d,this.uint8[37+x]=f,this.uint8[38+x]=g,this.uint32[10+b]=y,this.int16[22+v]=m,this.uint8[46+x]=_,t}}fn.prototype.bytesPerElement=48,zo("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i1ub48",fn);class gn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,o,r,n,s,a,l,h,p,c,u,d,f,g,y,m,_,v,b,x,w,M,P,E,S){var T=this.length;return this.resize(T+1),this.emplace(T,t,e,i,o,r,n,s,a,l,h,p,c,u,d,f,g,y,m,_,v,b,x,w,M,P,E,S)}emplace(t,e,i,o,r,n,s,a,l,h,p,c,u,d,f,g,y,m,_,v,b,x,w,M,P,E,S,T){var A=32*t,C=16*t;return this.int16[0+A]=e,this.int16[1+A]=i,this.int16[2+A]=o,this.int16[3+A]=r,this.int16[4+A]=n,this.int16[5+A]=s,this.int16[6+A]=a,this.int16[7+A]=l,this.uint16[8+A]=h,this.uint16[9+A]=p,this.uint16[10+A]=c,this.uint16[11+A]=u,this.uint16[12+A]=d,this.uint16[13+A]=f,this.uint16[14+A]=g,this.uint16[15+A]=y,this.uint16[16+A]=m,this.uint16[17+A]=_,this.uint16[18+A]=v,this.uint16[19+A]=b,this.uint16[20+A]=x,this.uint16[21+A]=w,this.uint16[22+A]=M,this.uint32[12+C]=P,this.float32[13+C]=E,this.float32[14+C]=S,this.float32[15+C]=T,t}}gn.prototype.bytesPerElement=64,zo("StructArrayLayout8i15ui1ul3f64",gn);class yn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[+t+0]=e,t}}yn.prototype.bytesPerElement=4,zo("StructArrayLayout1f4",yn);class mn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,i)}emplace(t,e,i,o){var r=3*t;return this.int16[0+r]=e,this.int16[1+r]=i,this.int16[2+r]=o,t}}mn.prototype.bytesPerElement=6,zo("StructArrayLayout3i6",mn);class _n extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,o){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,o)}emplace(t,e,i,o,r){var n=6*t;return this.uint32[3*t+0]=e,this.uint16[2+n]=i,this.uint16[3+n]=o,this.uint16[4+n]=r,t}}_n.prototype.bytesPerElement=12,zo("StructArrayLayout1ul3ui12",_n);class vn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){var i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){var o=2*t;return this.uint16[0+o]=e,this.uint16[1+o]=i,t}}vn.prototype.bytesPerElement=4,zo("StructArrayLayout2ui4",vn);class bn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[+t+0]=e,t}}bn.prototype.bytesPerElement=2,zo("StructArrayLayout1ui2",bn);class xn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,o){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,o)}emplace(t,e,i,o,r){var n=4*t;return this.float32[0+n]=e,this.float32[1+n]=i,this.float32[2+n]=o,this.float32[3+n]=r,t}}xn.prototype.bytesPerElement=16,zo("StructArrayLayout4f16",xn);class wn extends Xr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.float32[this._pos4+1]}get y1(){return this._structArray.float32[this._pos4+2]}get x2(){return this._structArray.float32[this._pos4+3]}get y2(){return this._structArray.float32[this._pos4+4]}get padding(){return this._structArray.int16[this._pos2+10]}get featureIndex(){return this._structArray.uint32[this._pos4+6]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+14]}get bucketIndex(){return this._structArray.uint16[this._pos2+15]}get anchorPoint(){return new z(this.anchorPointX,this.anchorPointY)}}wn.prototype.size=32;class Mn extends hn{get(t){return new wn(this,t)}}zo("CollisionBoxArray",Mn);class Pn extends Xr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}get flipState(){return this._structArray.uint8[this._pos1+46]}set flipState(t){this._structArray.uint8[this._pos1+46]=t}}Pn.prototype.size=48;class En extends fn{get(t){return new Pn(this,t)}}zo("PlacedSymbolArray",En);class Sn extends Xr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textOffset0(){return this._structArray.float32[this._pos4+13]}get textOffset1(){return this._structArray.float32[this._pos4+14]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+15]}}Sn.prototype.size=64;class Tn extends gn{get(t){return new Sn(this,t)}}zo("SymbolInstanceArray",Tn);class An extends yn{getoffsetX(t){return this.float32[+t+0]}}zo("GlyphOffsetArray",An);class Cn extends mn{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}zo("SymbolLineVertexArray",Cn);class In extends Xr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}In.prototype.size=12;class Ln extends _n{get(t){return new In(this,t)}}zo("FeatureIndexArray",Ln);class On extends Xr{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}On.prototype.size=4;class Rn extends vn{get(t){return new On(this,t)}}zo("FillExtrusionCentroidArray",Rn);const Dn=$r([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),kn=$r([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var zn=se(function(t){t.exports=function(t,e){for(var i,o,r,n=t.length-(i=3&t.length),s=e,a=3432918353,l=461845907,h=0;h<n;)r=255&t.charCodeAt(h)|(255&t.charCodeAt(++h))<<8|(255&t.charCodeAt(++h))<<16|(255&t.charCodeAt(++h))<<24,++h,s=27492+(65535&(o=5*(65535&(s=(s^=r=(65535&(r=(r=(65535&r)*a+(((r>>>16)*a&65535)<<16)&4294967295)<<15|r>>>17))*l+(((r>>>16)*l&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(r=0,i){case 3:r^=(255&t.charCodeAt(h+2))<<16;case 2:r^=(255&t.charCodeAt(h+1))<<8;case 1:s^=r=(65535&(r=(r=(65535&(r^=255&t.charCodeAt(h)))*a+(((r>>>16)*a&65535)<<16)&4294967295)<<15|r>>>17))*l+(((r>>>16)*l&65535)<<16)&4294967295}return s^=t.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0}}),Fn=se(function(t){t.exports=function(t,e){for(var i,o=t.length,r=e^o,n=0;4<=o;)i=1540483477*(65535&(i=255&t.charCodeAt(n)|(255&t.charCodeAt(++n))<<8|(255&t.charCodeAt(++n))<<16|(255&t.charCodeAt(++n))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16),o-=4,++n;switch(o){case 3:r^=(255&t.charCodeAt(n+2))<<16;case 2:r^=(255&t.charCodeAt(n+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(n)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}}),Nn=zn,mi=Fn;Nn.murmur3=zn,Nn.murmur2=mi;class Un{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,i,o){this.ids.push(Bn(t)),this.positions.push(e,i,o)}getPositions(t){var e=Bn(t);let i=0,o=this.ids.length-1;for(;i<o;){const t=i+o>>1;this.ids[t]>=e?o=t:i=1+t}const r=[];for(;this.ids[i]===e;)r.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return r}static serialize(t,e){var i=new Float64Array(t.ids),t=new Uint32Array(t.positions);return function i(o,r,n,s){for(;n<s;){const a=o[n+s>>1];let t=n-1,e=s+1;for(;;){for(;t++,o[t]<a;);for(;e--,o[e]>a;);if(t>=e)break;jn(o,t,e),jn(r,3*t,3*e),jn(r,3*t+1,3*e+1),jn(r,3*t+2,3*e+2)}e-n<s-e?(i(o,r,n,e),n=e+1):(i(o,r,e+1,s),s=e)}}(i,t,0,i.length-1),e&&e.push(i.buffer,t.buffer),{ids:i,positions:t}}static deserialize(t){const e=new Un;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function Bn(t){var e=+t;return!isNaN(e)&&e<=o?e:Nn(String(t))}function jn(t,e,i){var o=t[e];t[e]=t[i],t[i]=o}zo("FeaturePositionMap",Un);class Zn{constructor(t,e){this.gl=t.gl,this.location=e}}class Gn extends Zn{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Vn extends Zn{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Wn extends Zn{constructor(t,e){super(t,e),this.current=le.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Hn=new Float32Array(16),qn=new Float32Array(9);function Yn(t){return[qr(255*t.r,255*t.g),qr(255*t.b,255*t.a)]}class Xn{constructor(t,e,i){this.value=t,this.uniformNames=e.map(t=>`u_${t}`),this.type=i}setUniform(t,e,i){t.set(i.constantOr(this.value))}getBinding(t,e,i){return new("color"===this.type?Wn:Gn)(t,e)}}class Kn{constructor(t,e){this.uniformNames=e.map(t=>`u_${t}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tl.concat(e.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,e,i,o){o="u_pattern_to"===o||"u_dash_to"===o?this.patternTo:"u_pattern_from"===o||"u_dash_from"===o?this.patternFrom:"u_pixel_ratio_to"===o?this.pixelRatioTo:"u_pixel_ratio_from"===o?this.pixelRatioFrom:null;o&&t.set(o)}getBinding(t,e,i){return new("u_pattern_from"===i||"u_pattern_to"===i||"u_dash_from"===i||"u_dash_to"===i?Vn:Gn)(t,e)}}class $n{constructor(t,e,i,o){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0})),this.paintVertexArray=new o}populatePaintArray(t,e,i,o,r){var n=this.paintVertexArray.length,r=this.expression.evaluate(new Or(0),e,{},o,[],r);this.paintVertexArray.resize(t),this._setPaintValue(n,t,r)}updatePaintArray(t,e,i,o){o=this.expression.evaluate({zoom:0},i,o);this._setPaintValue(t,e,o)}_setPaintValue(e,i,o){if("color"===this.type){var r=Yn(o);for(let t=e;t<i;t++)this.paintVertexArray.emplace(t,r[0],r[1])}else{for(let t=e;t<i;t++)this.paintVertexArray.emplace(t,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jn{constructor(t,e,i,o,r,n){this.expression=t,this.uniformNames=e.map(t=>`u_${t}_t`),this.type=i,this.useIntegerZoom=o,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0})),this.paintVertexArray=new n}populatePaintArray(t,e,i,o,r){var n=this.expression.evaluate(new Or(this.zoom),e,{},o,[],r),o=this.expression.evaluate(new Or(this.zoom+1),e,{},o,[],r),r=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(r,t,n,o)}updatePaintArray(t,e,i,o){var r=this.expression.evaluate({zoom:this.zoom},i,o),o=this.expression.evaluate({zoom:this.zoom+1},i,o);this._setPaintValue(t,e,r,o)}_setPaintValue(e,i,o,r){if("color"===this.type){var n=Yn(o),s=Yn(r);for(let t=e;t<i;t++)this.paintVertexArray.emplace(t,n[0],n[1],s[0],s[1])}else{for(let t=e;t<i;t++)this.paintVertexArray.emplace(t,o,r);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){e=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,e=d(this.expression.interpolationFactor(e,this.zoom,this.zoom+1),0,1);t.set(e)}getBinding(t,e,i){return new Gn(t,e)}}class Qn{constructor(t,e,i,o,r,n,s){this.expression=t,this.type=i,this.useIntegerZoom=o,this.zoom=r,this.layerId=s,this.paintVertexAttributes=("array"===i?kn:Dn).members;for(let t=0;t<e.length;++t);this.zoomInPaintVertexArray=new n,this.zoomOutPaintVertexArray=new n}populatePaintArray(t,e,i){var o=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(o,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,o,r){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],r)}_setPaintValues(e,i,t,o){if(o&&t){var{min:r,mid:n,max:t}=t,s=o[r],a=o[n],l=o[t];if(s&&a&&l)for(let t=e;t<i;t++)this._setPaintValue(this.zoomInPaintVertexArray,t,a,s),this._setPaintValue(this.zoomOutPaintVertexArray,t,a,l)}}_setPaintValue(t,e,i,o){t.emplace(e,i.tl[0],i.tl[1],i.br[0],i.br[1],o.tl[0],o.tl[1],o.br[0],o.br[1],i.pixelRatio,o.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ts{constructor(t,e,i=()=>!0){this.binders={},this._buffers=[];const o=[];for(const p in t.paint._values)if(i(p)){var r=t.paint.get(p);if(r instanceof Ur&&Ai(r.property.specification)){var n=(l=p,h=t.type,is[l]||[l.replace(`${h}-`,"").replace(/-/g,"_")]),s=r.value,a=r.property.specification.type,l=r.property.useIntegerZoom,h=r.property.specification["property-type"],r="cross-faded"===h||"cross-faded-data-driven"===h,h="line-dasharray"===String(p)&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==s.kind||h)if("source"===s.kind||h||r){const i=ns(p,a,"source");this.binders[p]=r?new Qn(s,n,a,l,e,i,t.id):new $n(s,n,a,i),o.push(`/a_${p}`)}else{const t=ns(p,a,"composite");this.binders[p]=new Jn(s,n,a,l,e,t),o.push(`/z_${p}`)}else this.binders[p]=r?new Kn(s.value,n):new Xn(s.value,n,a),o.push(`/u_${p}`)}}var l,h;this.cacheKey=o.sort().join("")}getMaxValue(t){t=this.binders[t];return t instanceof $n||t instanceof Jn?t.maxValue:0}populatePaintArrays(t,e,i,o,r){for(const n in this.binders){const s=this.binders[n];(s instanceof $n||s instanceof Jn||s instanceof Qn)&&s.populatePaintArray(t,e,i,o,r)}}setConstantPatternPositions(t,e){for(const i in this.binders){const o=this.binders[i];o instanceof Kn&&o.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,i,o,r){let n=!1;for(const h in t){var s=e.getPositions(h);for(const e of s){var a,l=i.feature(e.index);for(const i in this.binders){const p=this.binders[i];(p instanceof $n||p instanceof Jn||p instanceof Qn)&&!0===p.expression.isStateDependent&&(a=o.paint.get(i),p.expression=a.value,p.updatePaintArray(e.start,e.end,l,t[h],r),n=!0)}}}return n}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Xn||i instanceof Kn)&&t.push(...i.uniformNames.map(t=>`#define HAS_UNIFORM_${t}`))}return t}getBinderAttributes(){const e=[];for(const t in this.binders){var i=this.binders[t];if(i instanceof $n||i instanceof Jn||i instanceof Qn)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const t=[];for(const i in this.binders){var e=this.binders[i];if(e instanceof Xn||e instanceof Kn||e instanceof Jn)for(const o of e.uniformNames)t.push(o)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const i=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Xn||n instanceof Kn||n instanceof Jn)for(const s of n.uniformNames){var o;e[s]&&(o=n.getBinding(t,e[s],s),i.push({name:s,property:r,binding:o}))}}return i}setUniforms(t,e,i,o){for(const{name:t,property:r,binding:n}of e)this.binders[r].setUniform(n,o,i.get(r),t)}updatePaintBuffers(t){this._buffers=[];for(const o in this.binders){var e,i=this.binders[o];t&&i instanceof Qn?(e=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer)&&this._buffers.push(e):(i instanceof $n||i instanceof Jn)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof $n||i instanceof Jn||i instanceof Qn)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof $n||e instanceof Jn||e instanceof Qn)&&e.destroy()}}}class es{constructor(t,e,i=()=>!0){this.programConfigurations={};for(const o of t)this.programConfigurations[o.id]=new ts(o,e,i);this.needsUpload=!1,this._featureMap=new Un,this._bufferOffset=0}populatePaintArrays(t,e,i,o,r,n){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,o,r,n);void 0!==e.id&&this._featureMap.add(e.id,i,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,o){for(const r of i)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(t,this._featureMap,e,r,o)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const is={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};const os={"line-pattern":{source:rn,composite:rn},"fill-pattern":{source:rn,composite:rn},"fill-extrusion-pattern":{source:rn,composite:rn},"line-dasharray":{source:nn,composite:nn}},rs={color:{source:on,composite:xn},number:{source:yn,composite:on}};function ns(t,e,i){t=os[t];return t&&t[i]||rs[e][i]}zo("ConstantBinder",Xn),zo("CrossFadedConstantBinder",Kn),zo("SourceExpressionBinder",$n),zo("CrossFadedCompositeBinder",Qn),zo("CompositeExpressionBinder",Jn),zo("ProgramConfiguration",ts,{omit:["_buffers"]}),zo("ProgramConfigurationSet",es);const ss="-transition";class as extends kt{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new Nr(e.layout)),e.paint)){this._transitionablePaint=new kr(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Br(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,i={}){null!=e&&this._validate(Co,`layers.${this.id}.layout.${t}`,t,e,i)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return P(t,ss)?this._transitionablePaint.getTransition(t.slice(0,-ss.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,i={}){if(null!=e&&this._validate(Ao,`layers.${this.id}.paint.${t}`,t,e,i))return!1;if(P(t,ss))return this._transitionablePaint.setTransition(t.slice(0,-ss.length),e||void 0),!1;{const i=this._transitionablePaint._values[t],o="cross-faded-data-driven"===i.property.specification["property-type"],r=i.value.isDataDriven(),n=i.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const s=this._transitionablePaint._values[t].value;return s.isDataDriven()||r||o||this._handleOverridablePaintPropertyUpdate(t,n,s)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),S(t,(t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length))}_validate(t,e,i,o,r={}){return(!r||!1!==r.validate)&&Io(this,t.call(Eo,{key:e,layerType:this.type,objectKey:i,value:o,styleSpec:zt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){var t=this.paint.get(e);if(t instanceof Ur&&Ai(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}const ls=$r([{name:"a_pos",components:2,type:"Int16"}],4),{members:hs}=ls;class ps{constructor(t=[]){this.segments=t}prepareSegment(t,e,i,o){let r=this.segments[this.segments.length-1];return t>ps.MAX_VERTEX_ARRAY_LENGTH&&Z(`Max vertices per segment is ${ps.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!r||r.vertexLength+t>ps.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==o)&&(r={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==o&&(r.sortKey=o),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,o){return new ps([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:o,vaos:{},sortKey:0}])}}ps.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zo("SegmentVector",ps);var cs=8192;const us=Math.pow(2,14)-1,ds=-us-1;function fs(t){const e=cs/t.extent,i=t.loadGeometry();for(let t=0;t<i.length;t++){var o=i[t];for(let t=0;t<o.length;t++){const i=o[t],r=Math.round(i.x*e),n=Math.round(i.y*e);i.x=d(r,ds,us),i.y=d(n,ds,us),(r<i.x||r>i.x+1||n<i.y||n>i.y+1)&&Z("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function gs(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?fs(t):[]}}function ys(t,e,i,o,r){t.emplaceBack(2*e+(o+1)/2,2*i+(r+1)/2)}class ms{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Qr,this.indexArray=new dn,this.segments=new ps,this.programConfigurations=new es(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,i){const o=this.layers[0],r=[];let n=null;"circle"===o.type&&(n=o.layout.get("circle-sort-key"));for(const{feature:e,id:o,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,h=gs(e,t);var s;this.layers[0]._featureFilter.filter(new Or(this.zoom),h,i)&&(s=n?n.evaluate(h,{},i):void 0,s={id:o,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?h.geometry:fs(e),patterns:{},sortKey:s},r.push(s))}n&&r.sort((t,e)=>t.sortKey-e.sortKey);for(const o of r){const{geometry:r,index:n,sourceLayerIndex:p}=o,c=t[n].feature;this.addFeature(o,r,n,i),e.featureIndex.insert(c,r,n,p,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,o){for(const i of e)for(const e of i){const i=e.x,o=e.y;if(!(i<0||i>=cs||o<0||o>=cs)){const r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),n=r.vertexLength;ys(this.layoutVertexArray,i,o,-1,-1),ys(this.layoutVertexArray,i,o,1,-1),ys(this.layoutVertexArray,i,o,1,1),ys(this.layoutVertexArray,i,o,-1,1),this.indexArray.emplaceBack(n,n+1,n+2),this.indexArray.emplaceBack(n,n+3,n+2),r.vertexLength+=4,r.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},o)}}function _s(e,i){for(let t=0;t<e.length;t++)if(Ps(i,e[t]))return!0;for(let t=0;t<i.length;t++)if(Ps(e,i[t]))return!0;return!!bs(e,i)}function vs(e,i){if(1===e.length)return Ms(i,e[0]);for(let t=0;t<i.length;t++){var o=i[t];for(let t=0;t<o.length;t++)if(Ps(e,o[t]))return!0}for(let t=0;t<e.length;t++)if(Ms(i,e[t]))return!0;for(let t=0;t<i.length;t++)if(bs(e,i[t]))return!0;return!1}function bs(e,i){var o,r,n,s;if(0!==e.length&&0!==i.length)for(let t=0;t<e.length-1;t++){var a=e[t],l=e[t+1];for(let t=0;t<i.length-1;t++)if(o=a,r=l,n=i[t],s=i[t+1],I(o,n,s)!==I(r,n,s)&&I(o,r,n)!==I(o,r,s))return 1}}function xs(e,i,t){var o=t*t;if(1===i.length)return e.distSqr(i[0])<o;for(let t=1;t<i.length;t++)if(ws(e,i[t-1],i[t])<o)return 1}function ws(t,e,i){var o=e.distSqr(i);if(0===o)return t.distSqr(e);o=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/o;return t.distSqr(o<0?e:1<o?i:i.sub(e)._mult(o)._add(e))}function Ms(o,r){let n,s,a,l=!1;for(let i=0;i<o.length;i++)for(let t=0,e=(n=o[i]).length-1;t<n.length;e=t++)s=n[t],a=n[e],s.y>r.y!=a.y>r.y&&r.x<(a.x-s.x)*(r.y-s.y)/(a.y-s.y)+s.x&&(l=!l);return l}function Ps(i,o){let r=!1;for(let t=0,e=i.length-1;t<i.length;e=t++){var n=i[t],s=i[e];n.y>o.y!=s.y>o.y&&o.x<(s.x-n.x)*(o.y-n.y)/(s.y-n.y)+n.x&&(r=!r)}return r}function Es(e,t,i,o,r){for(const z of e)if(t<=z.x&&i<=z.y&&o>=z.x&&r>=z.y)return!0;var n=[new z(t,i),new z(t,r),new z(o,r),new z(o,i)];if(2<e.length)for(const t of n)if(Ps(e,t))return!0;for(let t=0;t<e.length-1;t++)if(function(t,e,i){var o=i[0],r=i[2];if(t.x<o.x&&e.x<o.x||t.x>r.x&&e.x>r.x||t.y<o.y&&e.y<o.y||t.y>r.y&&e.y>r.y)return!1;r=I(t,e,i[0]);return r!==I(t,e,i[1])||r!==I(t,e,i[2])||r!==I(t,e,i[3])}(e[t],e[t+1],n))return!0;return!1}function Ss(t,e,i){var o=e.paint.get(t).value;return"constant"===o.kind?o.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Ts(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function As(e,t,i,o,r){if(!t[0]&&!t[1])return e;const n=z.convert(t)._mult(r);"viewport"===i&&n._rotate(-o);const s=[];for(let t=0;t<e.length;t++)s.push(e[t].sub(n));return s}function Cs(t,e,i,o){const r=z.convert(t)._mult(o);return"viewport"===e&&r._rotate(-i),r}zo("CircleBucket",ms,{omit:["layers"]});var _i=new Hr({"circle-sort-key":new Zr(zt.layout_circle["circle-sort-key"])}),Is={paint:new Hr({"circle-radius":new Zr(zt.paint_circle["circle-radius"]),"circle-color":new Zr(zt.paint_circle["circle-color"]),"circle-blur":new Zr(zt.paint_circle["circle-blur"]),"circle-opacity":new Zr(zt.paint_circle["circle-opacity"]),"circle-translate":new jr(zt.paint_circle["circle-translate"]),"circle-translate-anchor":new jr(zt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jr(zt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jr(zt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Zr(zt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Zr(zt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Zr(zt.paint_circle["circle-stroke-opacity"])}),layout:_i},Ls="undefined"!=typeof Float32Array?Float32Array:Array;function Os(){var t=new Ls(9);return Ls!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Rs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ds(t,e,i){var o=e[0],r=e[1],n=e[2],s=e[3],a=e[4],l=e[5],h=e[6],p=e[7],c=e[8],u=e[9],d=e[10],f=e[11],g=e[12],y=e[13],m=e[14],_=e[15],v=i[0],b=i[1],x=i[2],e=i[3];return t[0]=v*o+b*a+x*c+e*g,t[1]=v*r+b*l+x*u+e*y,t[2]=v*n+b*h+x*d+e*m,t[3]=v*s+b*p+x*f+e*_,t[4]=(v=i[4])*o+(b=i[5])*a+(x=i[6])*c+(e=i[7])*g,t[5]=v*r+b*l+x*u+e*y,t[6]=v*n+b*h+x*d+e*m,t[7]=v*s+b*p+x*f+e*_,t[8]=(v=i[8])*o+(b=i[9])*a+(x=i[10])*c+(e=i[11])*g,t[9]=v*r+b*l+x*u+e*y,t[10]=v*n+b*h+x*d+e*m,t[11]=v*s+b*p+x*f+e*_,t[12]=(v=i[12])*o+(b=i[13])*a+(x=i[14])*c+(e=i[15])*g,t[13]=v*r+b*l+x*u+e*y,t[14]=v*n+b*h+x*d+e*m,t[15]=v*s+b*p+x*f+e*_,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});bi=Ds;function ks(){var t=new Ls(3);return Ls!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function zs(t){return Math.hypot(t[0],t[1],t[2])}function Fs(t,e,i){var o=new Ls(3);return o[0]=t,o[1]=e,o[2]=i,o}function Ns(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Us(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Bs(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t}function js(t,e){var i=e[0],o=e[1],r=e[2],r=i*i+o*o+r*r;return 0<r&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Zs(t,e,i){var o=i[0],r=i[1],n=i[2],s=e[0],a=e[1],l=e[2],h=r*l-n*a,p=n*s-o*l,c=o*a-r*s,e=r*c-n*p,n=n*h-o*c,r=o*p-r*h,i=2*i[3];return p*=i,c*=i,n*=2,r*=2,t[0]=s+(h*=i)+(e*=2),t[1]=a+p+n,t[2]=l+c+r,t}vi=Ns,xi=Us,Fn=zs;function Gs(t,e,i){var o=e[0],r=e[1],n=e[2],e=e[3];return t[0]=i[0]*o+i[4]*r+i[8]*n+i[12]*e,t[1]=i[1]*o+i[5]*r+i[9]*n+i[13]*e,t[2]=i[2]*o+i[6]*r+i[10]*n+i[14]*e,t[3]=i[3]*o+i[7]*r+i[11]*n+i[15]*e,t}function Vs(){var t=new Ls(4);return Ls!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ws(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Hs(t,e,i){i*=.5;var o=e[0],r=e[1],n=e[2],s=e[3],e=Math.sin(i),i=Math.cos(i);return t[0]=o*i+s*e,t[1]=r*i+n*e,t[2]=n*i-r*e,t[3]=s*i-o*e,t}ks(),zn=new Ls(4),Ls!=Float32Array&&(zn[0]=0,zn[1]=0,zn[2]=0,zn[3]=0),ks(),Fs(1,0,0),Fs(0,1,0),Vs(),Vs(),Os();const qs=Fs(0,0,0),Ys=Fs(0,0,1);class Xs extends ms{}function Ks(t,{width:e,height:i},o,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==e*i*o)throw new RangeError("mismatched image size")}else r=new Uint8Array(e*i*o);return t.width=e,t.height=i,t.data=r,t}function $s(t,{width:e,height:i},o){var r;e===t.width&&i===t.height||(Js(t,r=Ks({},{width:e,height:i},o),{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,i)},o),t.width=e,t.height=i,t.data=r.data)}function Js(e,i,o,r,n,s){if(0===n.width||0===n.height)return i;if(n.width>e.width||n.height>e.height||o.x>e.width-n.width||o.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>i.width||n.height>i.height||r.x>i.width-n.width||r.y>i.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const a=e.data,l=i.data;for(let t=0;t<n.height;t++){var h=((o.y+t)*e.width+o.x)*s,p=((r.y+t)*i.width+r.x)*s;for(let t=0;t<n.width*s;t++)l[p+t]=a[h+t]}return i}zo("HeatmapBucket",Xs,{omit:["layers"]});class Qs{constructor(t,e){Ks(this,t,1,e)}resize(t){$s(this,t,1)}clone(){return new Qs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,o,r){Js(t,e,i,o,r,1)}}class ta{constructor(t,e){Ks(this,t,4,e)}resize(t){$s(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ta({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,o,r){Js(t,e,i,o,r,4)}}zo("AlphaImage",Qs),zo("RGBAImage",ta);var ea={paint:new Hr({"heatmap-radius":new Zr(zt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Zr(zt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jr(zt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Wr(zt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jr(zt.paint_heatmap["heatmap-opacity"])})};function ia(r){const o={},n=r.resolution||256,t=r.clips?r.clips.length:1,s=r.image||new ta({width:n,height:t}),a=(t,e,i)=>{o[r.evaluationKey]=i;i=r.expression.evaluate(o);s.data[t+e+0]=Math.floor(255*i.r/i.a),s.data[t+e+1]=Math.floor(255*i.g/i.a),s.data[t+e+2]=Math.floor(255*i.b/i.a),s.data[t+e+3]=Math.floor(255*i.a)};if(r.clips)for(let i=0,o=0;i<t;++i,o+=4*n)for(let t=0,e=0;t<n;t++,e+=4){var l=t/(n-1),{start:h,end:p}=r.clips[i];a(o,e,h*(1-l)+p*l)}else for(let t=0,e=0;t<n;t++,e+=4)a(0,e,t/(n-1));return s}var oa={paint:new Hr({"hillshade-illumination-direction":new jr(zt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jr(zt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jr(zt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jr(zt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jr(zt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jr(zt.paint_hillshade["hillshade-accent-color"])})};const ra=$r([{name:"a_pos",components:2,type:"Int16"}],4),{members:na}=ra;var sa=aa,mi=aa;function aa(t,e,i){i=i||2;var o,r,n,s,a,l=e&&e.length,h=l?e[0]*i:t.length,p=la(t,0,h,i,!0),c=[];if(!p||p.next===p.prev)return c;if(l&&(p=function(t,e,i,o){for(var r,n,s,a=[],l=0,h=e.length;l<h;l++)(r=la(t,e[l]*o,l<h-1?e[l+1]*o:t.length,o,!1))===r.next&&(r.steiner=!0),a.push(function(t){var e=t,i=t;for(;(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next,e!==t;);return i}(r));for(a.sort(ca),l=0;l<a.length;l++)n=a[l],(s=function(t,e){var i,o=e,r=t.x,n=t.y,s=-1/0;do{if(n<=o.y&&n>=o.next.y&&o.next.y!==o.y){var a=o.x+(n-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(a<=r&&s<a){if((s=a)===r){if(n===o.y)return o;if(n===o.next.y)return o.next}i=o.x<o.next.x?o:o.next}}}while((o=o.next)!==e);if(!i)return null;if(r===s)return i;for(var l,h,p,c=i,u=i.x,d=i.y,f=1/0,o=i;r>=o.x&&o.x>=u&&r!==o.x&&da(n<d?r:s,n,u,d,n<d?s:r,n,o.x,o.y)&&(l=Math.abs(n-o.y)/(r-o.x),va(o,t)&&(l<f||l===f&&(o.x>i.x||o.x===i.x&&(p=o,fa((h=i).prev,h,p.prev)<0&&fa(p.next,h,h.next)<0)))&&(i=o,f=l)),(o=o.next)!==c;);return i}(n,s=i))&&(n=ba(s,n),ha(s,s.next),ha(n,n.next)),i=ha(i,i.next);return i}(t,e,p,i)),t.length>80*i){for(var u=o=t[0],d=r=t[1],f=i;f<h;f+=i)(n=t[f])<u&&(u=n),(s=t[f+1])<d&&(d=s),o<n&&(o=n),r<s&&(r=s);a=0!==(a=Math.max(o-u,r-d))?1/a:0}return pa(p,c,i,u,d,a),c}function la(t,e,i,o,r){var n,s;if(r===0<Pa(t,e,i,o))for(n=e;n<i;n+=o)s=xa(n,t[n],t[n+1],s);else for(n=i-o;e<=n;n-=o)s=xa(n,t[n],t[n+1],s);return s&&ga(s,s.next)&&(wa(s),s=s.next),s}function ha(t,e){if(!t)return t;e=e||t;var i,o=t;do{if(i=!1,o.steiner||!ga(o,o.next)&&0!==fa(o.prev,o,o.next))o=o.next;else{if(wa(o),(o=e=o.prev)===o.next)break;i=!0}}while(i||o!==e);return e}function pa(t,e,i,o,r,n,s){if(t){!s&&n&&function(t,e,i,o){for(var r=t;null===r.z&&(r.z=ua(r.x,r.y,e,i,o)),r.prevZ=r.prev,r.nextZ=r.next,(r=r.next)!==t;);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,o,r,n,s,a,l,h=1;do{for(i=t,n=t=null,s=0;i;){for(s++,o=i,e=a=0;e<h&&(a++,o=o.nextZ);e++);for(l=h;0<a||0<l&&o;)0!==a&&(0===l||!o||i.z<=o.z)?(i=(r=i).nextZ,a--):(o=(r=o).nextZ,l--),n?n.nextZ=r:t=r,r.prevZ=n,n=r;i=o}}while(n.nextZ=null,h*=2,1<s)}(r)}(t,o,r,n);for(var a,l,h=t;t.prev!==t.next;)if(a=t.prev,l=t.next,n?function(t,e,i,o){var r=t.prev,n=t,s=t.next;if(0<=fa(r,n,s))return!1;for(var a=(r.x>n.x?r.x>s.x?r:s:n.x>s.x?n:s).x,l=(r.y>n.y?r.y>s.y?r:s:n.y>s.y?n:s).y,h=ua((r.x<n.x?r.x<s.x?r:s:n.x<s.x?n:s).x,(r.y<n.y?r.y<s.y?r:s:n.y<s.y?n:s).y,e,i,o),p=ua(a,l,e,i,o),c=t.prevZ,u=t.nextZ;c&&c.z>=h&&u&&u.z<=p;){if(c!==t.prev&&c!==t.next&&da(r.x,r.y,n.x,n.y,s.x,s.y,c.x,c.y)&&0<=fa(c.prev,c,c.next))return!1;if(c=c.prevZ,u!==t.prev&&u!==t.next&&da(r.x,r.y,n.x,n.y,s.x,s.y,u.x,u.y)&&0<=fa(u.prev,u,u.next))return!1;u=u.nextZ}for(;c&&c.z>=h;){if(c!==t.prev&&c!==t.next&&da(r.x,r.y,n.x,n.y,s.x,s.y,c.x,c.y)&&0<=fa(c.prev,c,c.next))return!1;c=c.prevZ}for(;u&&u.z<=p;){if(u!==t.prev&&u!==t.next&&da(r.x,r.y,n.x,n.y,s.x,s.y,u.x,u.y)&&0<=fa(u.prev,u,u.next))return!1;u=u.nextZ}return!0}(t,o,r,n):function(t){var e=t.prev,i=t,o=t.next;if(0<=fa(e,i,o))return!1;for(var r=t.next.next;r!==t.prev;){if(da(e.x,e.y,i.x,i.y,o.x,o.y,r.x,r.y)&&0<=fa(r.prev,r,r.next))return!1;r=r.next}return!0}(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),wa(t),t=l.next,h=l.next;else if((t=l)===h){s?1===s?pa(t=function(t,e,i){var o=t;do{var r=o.prev,n=o.next.next}while(!ga(r,n)&&ya(r,o,o.next,n)&&va(r,n)&&va(n,r)&&(e.push(r.i/i),e.push(o.i/i),e.push(n.i/i),wa(o),wa(o.next),o=t=n),o=o.next,o!==t);return ha(o)}(ha(t),e,i),e,i,o,r,n,2):2===s&&function(t,e,i,o,r,n){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&ya(i,i.next,t,e))return 1}while((i=i.next)!==t)}(t,e)&&(va(t,e)&&va(e,t)&&function(t,e){for(var i=t,o=!1,r=(t.x+e.x)/2,n=(t.y+e.y)/2;i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(o=!o),(i=i.next)!==t;);return o}(t,e)&&(fa(t.prev,t,e.prev)||fa(t,e.prev,e))||ga(t,e)&&0<fa(t.prev,t,t.next)&&0<fa(e.prev,e,e.next))}(s,a)){var l=ba(s,a);return s=ha(s,s.next),l=ha(l,l.next),pa(s,e,i,o,r,n),pa(l,e,i,o,r,n)}a=a.next}}while(s=s.next,s!==t)}(t,e,i,o,r,n):pa(ha(t),e,i,o,r,n,1);break}}}function ca(t,e){return t.x-e.x}function ua(t,e,i,o,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-o)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function da(t,e,i,o,r,n,s,a){return 0<=(r-s)*(e-a)-(t-s)*(n-a)&&0<=(t-s)*(o-a)-(i-s)*(e-a)&&0<=(i-s)*(n-a)-(r-s)*(o-a)}function fa(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ga(t,e){return t.x===e.x&&t.y===e.y}function ya(t,e,i,o){var r=_a(fa(t,e,i)),n=_a(fa(t,e,o)),s=_a(fa(i,o,t)),a=_a(fa(i,o,e));return r!==n&&s!==a||0===r&&ma(t,i,e)||0===n&&ma(t,o,e)||0===s&&ma(i,t,o)||0===a&&ma(i,e,o)}function ma(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function _a(t){return 0<t?1:t<0?-1:0}function va(t,e){return fa(t.prev,t,t.next)<0?0<=fa(t,e,t.next)&&0<=fa(t,t.prev,e):fa(t,e,t.prev)<0||fa(t,t.next,e)<0}function ba(t,e){var i=new Ma(t.i,t.x,t.y),o=new Ma(e.i,e.x,e.y),r=t.next,n=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(o.next=i).prev=o,(n.next=o).prev=n,o}function xa(t,e,i,o){i=new Ma(t,e,i);return o?(i.next=o.next,(i.prev=o).next.prev=i,o.next=i):(i.prev=i).next=i,i}function wa(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ma(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pa(t,e,i,o){for(var r=0,n=e,s=i-o;n<i;n+=o)r+=(t[s]-t[n])*(t[n+1]+t[s+1]),s=n;return r}function Ea(t,e,i,o,r){!function t(e,i,o,r,n){for(;o<r;){var s,a,l,h;600<r-o&&(s=r-o+1,a=i-o+1,h=Math.log(s),l=.5*Math.exp(2*h/3),h=.5*Math.sqrt(h*l*(s-l)/s)*(a-s/2<0?-1:1),t(e,i,Math.max(o,Math.floor(i-a*l/s+h)),Math.min(r,Math.floor(i+(s-a)*l/s+h)),n));var p=e[i],c=o,u=r;for(Sa(e,o,i),0<n(e[r],p)&&Sa(e,o,r);c<u;){for(Sa(e,c,u),c++,u--;n(e[c],p)<0;)c++;for(;0<n(e[u],p);)u--}0===n(e[o],p)?Sa(e,o,u):Sa(e,++u,r),u<=i&&(o=u+1),i<=u&&(r=u-1)}}(t,e,i||0,o||t.length-1,r||Ta)}function Sa(t,e,i){var o=t[e];t[e]=t[i],t[i]=o}function Ta(t,e){return t<e?-1:e<t?1:0}function Aa(e,i){const o=e.length;if(o<=1)return[e];const r=[];let n,s;for(let t=0;t<o;t++){const o=function(n){let s=0;for(let t,e,i=0,o=n.length,r=o-1;i<o;r=i++)t=n[i],e=n[r],s+=(e.x-t.x)*(t.y+e.y);return s}(e[t]);0!==o&&(e[t].area=Math.abs(o),void 0===s&&(s=o<0),s===o<0?(n&&r.push(n),n=[e[t]]):n.push(e[t]))}if(n&&r.push(n),1<i)for(let t=0;t<r.length;t++)r[t].length<=i||(Ea(r[t],i,1,r[t].length-1,Ca),r[t]=r[t].slice(0,i));return r}function Ca(t,e){return e.area-t.area}function Ia(t,e,i){const o=i.patternDependencies;let r=!1;for(const i of e){const e=i.paint.get(`${t}-pattern`);e.isConstant()||(r=!0);var n=e.constantOr(null);n&&(r=!0,o[n.to]=!0,o[n.from]=!0)}return r}function La(t,o,r,n,s){const a=s.patternDependencies;for(const l of o){const o=l.paint.get(`${t}-pattern`).value;if("constant"!==o.kind){let t=o.evaluate({zoom:n-1},r,{},s.availableImages),e=o.evaluate({zoom:n},r,{},s.availableImages),i=o.evaluate({zoom:n+1},r,{},s.availableImages);t=t&&t.name?t.name:t,e=e&&e.name?e.name:e,i=i&&i.name?i.name:i,a[t]=!0,a[e]=!0,a[i]=!0,r.patterns[l.id]={min:t,mid:e,max:i}}}return r}aa.deviation=function(t,e,i,o){var r=e&&e.length,n=Math.abs(Pa(t,0,r?e[0]*i:t.length,i));if(r)for(var s=0,a=e.length;s<a;s++)n-=Math.abs(Pa(t,e[s]*i,s<a-1?e[s+1]*i:t.length,i));for(var l=0,s=0;s<o.length;s+=3){var h=o[s]*i,p=o[s+1]*i,c=o[s+2]*i;l+=Math.abs((t[h]-t[c])*(t[1+p]-t[1+h])-(t[h]-t[p])*(t[1+c]-t[1+h]))}return 0===n&&0===l?0:Math.abs((l-n)/n)},aa.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},o=0,r=0;r<t.length;r++){for(var n=0;n<t[r].length;n++)for(var s=0;s<e;s++)i.vertices.push(t[r][n][s]);0<r&&i.holes.push(o+=t[r-1].length)}return i},sa.default=mi;class Oa{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qr,this.indexArray=new dn,this.indexArray2=new vn,this.programConfigurations=new es(t.layers,t.zoom),this.segments=new ps,this.segments2=new ps,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,i){this.hasPattern=Ia("fill",this.layers,e);const o=this.layers[0].layout.get("fill-sort-key"),r=[];for(var{feature:n,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,p=gs(n,t);var h;this.layers[0]._featureFilter.filter(new Or(this.zoom),p,i)&&(h=o?o.evaluate(p,{},i,e.availableImages):void 0,h={id:s,properties:n.properties,type:n.type,sourceLayerIndex:l,index:a,geometry:t?p.geometry:fs(n),patterns:{},sortKey:h},r.push(h))}o&&r.sort((t,e)=>t.sortKey-e.sortKey);for(const o of r){const{geometry:r,index:c,sourceLayerIndex:u}=o;if(this.hasPattern){const t=La("fill",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,r,c,i,{});e.featureIndex.insert(t[c].feature,r,c,u,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,na),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,r,n){for(const e of Aa(i,500)){let t=0;for(const o of e)t+=o.length;const o=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),r=o.vertexLength,n=[],a=[];for(const i of e)if(0!==i.length){i!==e[0]&&a.push(n.length/2);const o=this.segments2.prepareSegment(i.length,this.layoutVertexArray,this.indexArray2),r=o.vertexLength;this.layoutVertexArray.emplaceBack(i[0].x,i[0].y),this.indexArray2.emplaceBack(r+i.length-1,r),n.push(i[0].x),n.push(i[0].y);for(let t=1;t<i.length;t++)this.layoutVertexArray.emplaceBack(i[t].x,i[t].y),this.indexArray2.emplaceBack(r+t-1,r+t),n.push(i[t].x),n.push(i[t].y);o.vertexLength+=i.length,o.primitiveLength+=i.length}var s=sa(n,a);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(r+s[t],r+s[t+1],r+s[t+2]);o.vertexLength+=t,o.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,n,r)}}zo("FillBucket",Oa,{omit:["layers","patternFeatures"]});var _i=new Hr({"fill-sort-key":new Zr(zt.layout_fill["fill-sort-key"])}),Ra={paint:new Hr({"fill-antialias":new jr(zt.paint_fill["fill-antialias"]),"fill-opacity":new Zr(zt.paint_fill["fill-opacity"]),"fill-color":new Zr(zt.paint_fill["fill-color"]),"fill-outline-color":new Zr(zt.paint_fill["fill-outline-color"]),"fill-translate":new jr(zt.paint_fill["fill-translate"]),"fill-translate-anchor":new jr(zt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gr(zt.paint_fill["fill-pattern"])}),layout:_i};const Da=$r([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ka=$r([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:za}=Da;var Fa=Na;function Na(t,e,i,o,r){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=r,t.readFields(Ua,this,e)}function Ua(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var o=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[o]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}Na.types=["Unknown","Point","LineString","Polygon"],Na.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i,o=t.readVarint()+t.pos,r=1,n=0,s=0,a=0,l=[];t.pos<o;)if(n<=0&&(r=7&(i=t.readVarint()),n=i>>3),n--,1===r||2===r)s+=t.readSVarint(),a+=t.readSVarint(),1===r&&(e&&l.push(e),e=[]),e.push(new z(s,a));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}return e&&l.push(e),l},Na.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,o=1,r=0,n=0,s=0,a=1/0,l=-1/0,h=1/0,p=-1/0;t.pos<i;)if(r<=0&&(o=7&(e=t.readVarint()),r=e>>3),r--,1===o||2===o)(n+=t.readSVarint())<a&&(a=n),l<n&&(l=n),(s+=t.readSVarint())<h&&(h=s),p<s&&(p=s);else if(7!==o)throw new Error("unknown command "+o);return[a,h,l,p]},Na.prototype.toGeoJSON=function(t,e,i){var o,r=this.extent*Math.pow(2,i),n=this.extent*t,s=this.extent*e,a=this.loadGeometry(),e=Na.types[this.type];function l(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+n)/r-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+s)/r)*Math.PI/180))-90]}}switch(this.type){case 1:for(var h=[],p=0;p<a.length;p++)h[p]=a[p][0];l(a=h);break;case 2:for(p=0;p<a.length;p++)l(a[p]);break;case 3:for(a=function(t){var e=t.length;if(e<=1)return[t];for(var i,o,r=[],n=0;n<e;n++){var s=function(t){for(var e,i,o=0,r=0,n=t.length,s=n-1;r<n;s=r++)o+=((i=t[s]).x-(e=t[r]).x)*(e.y+i.y);return o}(t[n]);0!==s&&((o=void 0===o?s<0:o)===s<0?(i&&r.push(i),i=[t[n]]):i.push(t[n]))}return i&&r.push(i),r}(a),p=0;p<a.length;p++)for(o=0;o<a[p].length;o++)l(a[p][o])}1===a.length?a=a[0]:e="Multi"+e;e={type:"Feature",geometry:{type:e,coordinates:a},properties:this.properties};return"id"in this&&(e.id=this.id),e};var Ba=ja;function ja(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Za,this,e),this.length=this._features.length}function Za(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;)var o=t.readVarint()>>3,e=1==o?t.readString():2==o?t.readFloat():3==o?t.readDouble():4==o?t.readVarint64():5==o?t.readVarint():6==o?t.readSVarint():7==o?t.readBoolean():null;return e}(i))}function Ga(t,e,i){3!==t||(i=new Ba(i,i.readVarint()+i.pos)).length&&(e[i.name]=i)}ja.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];t=this._pbf.readVarint()+this._pbf.pos;return new Fa(this._pbf,t,this.extent,this._keys,this._values)};var Va={VectorTile:function(t,e){this.layers=t.readFields(Ga,{},e)},VectorTileFeature:Fa,VectorTileLayer:Ba};const Wa=Va.VectorTileFeature.types,Ha=Math.pow(2,13);function qa(t,e,i,o,r,n,s,a){t.emplaceBack((e<<1)+s,(i<<1)+n,(Math.floor(o*Ha)<<1)+r,Math.round(a))}class Ya{constructor(){this.acc=new z(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new z(t.x,t.y),this.max=new z(t.x,t.y))}append(t,e){this.currentPolyCount.edges++,this.acc._add(t);let i=!!this.borders;const o=this.min,r=this.max;t.x<o.x?(o.x=t.x,i=!0):t.x>r.x&&(r.x=t.x,i=!0),t.y<o.y?(o.y=t.y,i=!0):t.y>r.y&&(r.y=t.y,i=!0),((0===t.x||t.x===cs)&&t.x===e.x)!=((0===t.y||t.y===cs)&&t.y===e.y)&&this.processBorderOverlap(t,e),i&&this.checkBorderIntersection(t,e)}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,Ye(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>cs!=t.x>cs&&this.addBorderIntersection(1,Ye(e.y,t.y,(cs-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,Ye(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>cs!=t.y>cs&&this.addBorderIntersection(3,Ye(e.x,t.x,(cs-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[t];e<i[0]&&(i[0]=e),e>i[1]&&(i[1]=e)}processBorderOverlap(t,e){var i;t.x===e.x?t.y!==e.y&&(i=0===t.x?0:1,this.addBorderIntersection(i,e.y),this.addBorderIntersection(i,t.y)):(i=0===t.y?2:3,this.addBorderIntersection(i,e.x),this.addBorderIntersection(i,t.x))}centroid(){var t=this.polyCount.reduce((t,e)=>t+e.edges,0);return 0!==t?this.acc.div(t)._round():new z(0,0)}span(){return new z(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,e)=>t+ +(e[0]!==Number.MAX_VALUE),0)}}class Xa{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new tn,this.centroidVertexArray=new Rn,this.indexArray=new dn,this.programConfigurations=new es(t.layers,t.zoom),this.segments=new ps,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=t.enableTerrain}populate(t,e,i){var o,r,n,s,a,l,h,p;this.features=[],this.hasPattern=Ia("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=(o=i,80150034*(r=Math.exp(Math.PI*(1-o.y/(1<<o.z)*2)))/(r*r+1)/cs/(1<<o.z));for({feature:n,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=gs(n,t);this.layers[0]._featureFilter.filter(new Or(this.zoom),c,i)&&(h={id:s,sourceLayerIndex:l,index:a,geometry:t?c.geometry:fs(n),properties:n.properties,type:n.type,patterns:{}},p=this.layoutVertexArray.length,this.hasPattern?this.features.push(La("fill-extrusion",this.layers,h,this.zoom,e)):this.addFeature(h,h.geometry,a,i,{}),e.featureIndex.insert(n,h.geometry,a,l,this.index,p))}this.sortBorders()}addFeatures(t,e,i){for(const t of this.features){var{geometry:o}=t;this.addFeature(t,o,t.index,e,i)}this.sortBorders()}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,za),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,ka.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,n,s,t,a){const l=this.enableTerrain&&r.properties&&"Polygon"===Wa[r.type]?new Ya:null;for(const s of Aa(n,500)){let i=0,o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(!(0===s.length||(c=s[0]).every(t=>t.x<=0)||c.every(t=>t.x>=cs)||c.every(t=>t.y<=0)||c.every(t=>t.y>=cs))){for(let t=0;t<s.length;t++){const a=s[t];if(0!==a.length){i+=a.length;let e=0;l&&l.startRing(a[0]);for(let t=0;t<a.length;t++){const n=a[t];if(1<=t){const s=a[t-1];if(h=n,p=s,!(h.x===p.x&&(h.x<0||h.x>cs)||h.y===p.y&&(h.y<0||h.y>cs))){l&&l.append(n,s),o.vertexLength+4>ps.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const r=n.sub(s)._perp(),a=r.x/(Math.abs(r.x)+Math.abs(r.y)),u=0<r.y?1:0,d=s.dist(n);32768<e+d&&(e=0),qa(this.layoutVertexArray,n.x,n.y,a,u,0,0,e),qa(this.layoutVertexArray,n.x,n.y,a,u,0,1,e),e+=d,qa(this.layoutVertexArray,s.x,s.y,a,u,0,0,e),qa(this.layoutVertexArray,s.x,s.y,a,u,0,1,e);h=o.vertexLength;this.indexArray.emplaceBack(h,h+2,h+1),this.indexArray.emplaceBack(h+1,h+2,h+3),o.vertexLength+=4,o.primitiveLength+=2}}}}}if(o.vertexLength+i>ps.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(i,this.layoutVertexArray,this.indexArray)),"Polygon"===Wa[r.type]){const a=[],f=[],g=o.vertexLength;for(let t=0;t<s.length;t++){const n=s[t];if(0!==n.length){n!==s[0]&&f.push(a.length/2);for(let t=0;t<n.length;t++){const s=n[t];qa(this.layoutVertexArray,s.x,s.y,0,0,1,1,0),a.push(s.x),a.push(s.y),l&&l.currentPolyCount.top++}}}var e=sa(a,f);for(let t=0;t<e.length;t+=3)this.indexArray.emplaceBack(g+e[t],g+e[t+2],g+e[t+1]);o.primitiveLength+=e.length/3,o.vertexLength+=i}}}var h,p,c;if(l&&0<l.polyCount.length){if(l.borders){l.vertexArrayOffset=this.centroidVertexArray.length;const r=l.borders,n=this.featuresOnBorder.push(l)-1;for(let t=0;t<4;t++)r[t][0]!==Number.MAX_VALUE&&this.borders[t].push(n)}this.encodeCentroid(l.borders?void 0:l.centroid(),l)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,s,a,t)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((t,e)=>this.featuresOnBorder[t].borders[i][0]-this.featuresOnBorder[e].borders[i][0])}encodeCentroid(e,t,i=!0){let o,r;if(e)if(0!==e.y){const i=t.span()._mult(this.tileToMeter);o=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(i.x/10)),r=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(i.y/10))}else o=Math.ceil(7*(e.x+450)),r=0;else o=0,r=+i;let n=i?this.centroidVertexArray.length:t.vertexArrayOffset;for(const e of t.polyCount){i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*e.edges+e.top);for(let t=0;t<2*e.edges;t++)this.centroidVertexArray.emplace(n++,0,r),this.centroidVertexArray.emplace(n++,o,r);for(let t=0;t<e.top;t++)this.centroidVertexArray.emplace(n++,o,r)}}}zo("FillExtrusionBucket",Xa,{omit:["layers","features"]}),zo("PartMetadata",Ya);var Ka={paint:new Hr({"fill-extrusion-opacity":new jr(zt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Zr(zt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-basecolor":new Zr(zt["paint_fill-extrusion"]["fill-extrusion-basecolor"]),"fill-extrusion-translate":new jr(zt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jr(zt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gr(zt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Zr(zt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Zr(zt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jr(zt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function $a(t,e){return t.x*e.x+t.y*e.y}function Ja(i,o){if(1===i.length){let t=0;const r=o[t++];let e;for(;!e||r.equals(e);)if(e=o[t++],!e)return 1/0;for(;t<o.length;t++){const n=o[t],s=i[0],a=e.sub(r),l=n.sub(r),h=s.sub(r),p=$a(a,a),c=$a(a,l),u=$a(l,l),d=$a(h,a),f=$a(h,l),g=p*u-c*c,y=(u*d-c*f)/g,m=(p*f-c*d)/g,_=r.z*(1-y-m)+e.z*y+n.z*m;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const e of o)t=Math.min(t,e.z);return t}}function Qa(t){const e=new z(t[0],t[1]);return e.z=t[2],e}const tl=$r([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:el}=tl,il=$r([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ol}=il,rl=Va.VectorTileFeature.types,nl=Math.cos(Math.PI/180*37.5);class sl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new en,this.layoutVertexArray2=new on,this.indexArray=new dn,this.programConfigurations=new es(t.layers,t.zoom),this.segments=new ps,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,i){this.hasPattern=Ia("line",this.layers,e);const o=this.layers[0].layout.get("line-sort-key"),r=[];for(const{feature:e,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,h=gs(e,t);var n;this.layers[0]._featureFilter.filter(new Or(this.zoom),h,i)&&(n=o?o.evaluate(h,{},i):void 0,n={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?h.geometry:fs(e),patterns:{},sortKey:n},r.push(n))}o&&r.sort((t,e)=>t.sortKey-e.sortKey);const{lineAtlas:s,featureIndex:a}=e,l=this.addConstantDashes(s);for(const o of r){const{geometry:r,index:p,sourceLayerIndex:c}=o;if(l&&this.addFeatureDashes(o,s),this.hasPattern){const t=La("line",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,r,p,i,s.positions);a.insert(t[p].feature,r,p,c,this.index)}}addConstantDashes(t){let e=!1;for(const r of this.layers){var i=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==o.kind)e=!0;else{const e=o.value,n=i.value;n&&(t.addDash(n.from,e),t.addDash(n.to,e),n.other&&t.addDash(n.other,e))}}return e}addFeatureDashes(s,a){var l=this.zoom;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,f=u.layout.get("line-cap").value;if("constant"!==d.kind||"constant"!==f.kind){let t,e,i,o,r,n;if("constant"===d.kind){const s=d.value;if(!s)continue;t=s.other||s.to,e=s.to,i=s.from}else t=d.evaluate({zoom:l-1},s),e=d.evaluate({zoom:l},s),i=d.evaluate({zoom:l+1},s);"constant"===f.kind?o=r=n=f.value:(o=f.evaluate({zoom:l-1},s),r=f.evaluate({zoom:l},s),n=f.evaluate({zoom:l+1},s)),a.addDash(t,o),a.addDash(e,r),a.addDash(i,n);var h=a.getKey(t,o),p=a.getKey(e,r),c=a.getKey(i,n);s.patterns[u.id]={min:h,mid:p,max:c}}}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,ol)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,el),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,o,r){const n=this.layers[0].layout,s=n.get("line-join").evaluate(t,{}),a=n.get("line-cap").evaluate(t,{}),l=n.get("line-miter-limit"),h=n.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,s,a,l,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,o)}addLine(l,h,p,c,u,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<l.length-1;t++)this.totalDistance+=l[t].dist(l[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}var f="Polygon"===rl[h.type];let g=l.length;for(;2<=g&&l[g-1].equals(l[g-2]);)g--;let y=0;for(;y<g-1&&l[y].equals(l[y+1]);)y++;if(!(g<(f?3:2))){"bevel"===p&&(u=1.05);var m=this.overscaling<=16?122880/(512*this.overscaling):0,_=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let o,r,n,s,a;this.e1=this.e2=-1,f&&(o=l[g-2],a=l[y].sub(o)._unit()._perp());for(let i=y;i<g;i++)if(n=i===g-1?f?l[y+1]:void 0:l[i+1],!n||!l[i].equals(n)){a&&(s=a),o&&(r=o),o=l[i],a=n?n.sub(o)._unit()._perp():s,s=s||a;let t=s.add(a);0===t.x&&0===t.y||t._unit();var v=s.x*a.x+s.y*a.y,b=t.x*a.x+t.y*a.y,x=0!=b?1/b:1/0,w=2*Math.sqrt(2-2*b),M=b<nl&&r&&n,P=0<s.x*a.y-s.y*a.x;if(M&&i>y){const l=o.dist(r);if(l>2*m){const h=o.sub(o.sub(r)._mult(m/l)._round());this.updateDistance(r,h),this.addCurrentVertex(h,s,0,0,_),r=h}}b=r&&n;let e=b?p:f?"butt":c;if(b&&"round"===e&&(x<d?e="miter":x<=2&&(e="fakeround")),"miter"===e&&u<x&&(e="bevel"),"bevel"===e&&(2<x&&(e="flipbevel"),x<u&&(e="miter")),r&&this.updateDistance(r,o),"miter"===e)t._mult(x),this.addCurrentVertex(o,t,0,0,_);else if("flipbevel"===e){if(100<x)t=a.mult(-1);else{const l=x*s.add(a).mag()/s.sub(a).mag();t._perp()._mult(l*(P?-1:1))}this.addCurrentVertex(o,t,0,0,_),this.addCurrentVertex(o,t.mult(-1),0,0,_)}else if("bevel"===e||"fakeround"===e){const l=-Math.sqrt(x*x-1),h=P?l:0,p=P?0:l;if(r&&this.addCurrentVertex(o,s,h,p,_),"fakeround"===e){const l=Math.round(180*w/Math.PI/20);for(let e=1;e<l;e++){let t=e/l;if(.5!==t){const l=t-.5;t+=t*l*(t-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*l*l+(.848013+v*(.215638*v-1.06021)))}const c=a.sub(s)._mult(t)._add(s)._unit()._mult(P?-1:1);this.addHalfVertex(o,c.x,c.y,!1,P,0,_)}}n&&this.addCurrentVertex(o,a,-h,-p,_)}else if("butt"===e)this.addCurrentVertex(o,t,0,0,_);else if("square"===e){const l=r?1:-1;r||this.addCurrentVertex(o,t,l,l,_),this.addCurrentVertex(o,t,0,0,_),r&&this.addCurrentVertex(o,t,l,l,_)}else"round"===e&&(r&&(this.addCurrentVertex(o,s,0,0,_),this.addCurrentVertex(o,s,1,1,_,!0)),n&&(this.addCurrentVertex(o,a,-1,-1,_,!0),this.addCurrentVertex(o,a,0,0,_)));if(M&&i<g-1){const l=o.dist(n);if(l>2*m){const h=o.add(n.sub(o)._mult(m/l)._round());this.updateDistance(o,h),this.addCurrentVertex(h,a,0,0,_),o=h}}}}}addCurrentVertex(t,e,i,o,r,n=!1){var s=e.y*o-e.x,a=-e.y-e.x*o;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,n,!1,i,r),this.addHalfVertex(t,s,a,n,!0,-o,r)}addHalfVertex({x:t,y:e},i,o,r,n,s,a){this.layoutVertexArray.emplaceBack((t<<1)+(r?1:0),(e<<1)+(n?1:0),Math.round(63*i)+128,Math.round(63*o)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length);s=a.vertexLength++;0<=this.e1&&0<=this.e2&&(this.indexArray.emplaceBack(this.e1,this.e2,s),a.primitiveLength++),n?this.e2=s:this.e1=s}updateScaledDistance(){var t;this.lineClips?(t=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}zo("LineBucket",sl,{omit:["layers","patternFeatures"]});var zn=new Hr({"line-cap":new Zr(zt.layout_line["line-cap"]),"line-join":new Zr(zt.layout_line["line-join"]),"line-miter-limit":new jr(zt.layout_line["line-miter-limit"]),"line-round-limit":new jr(zt.layout_line["line-round-limit"]),"line-sort-key":new Zr(zt.layout_line["line-sort-key"])}),al={paint:new Hr({"line-opacity":new Zr(zt.paint_line["line-opacity"]),"line-color":new Zr(zt.paint_line["line-color"]),"line-translate":new jr(zt.paint_line["line-translate"]),"line-translate-anchor":new jr(zt.paint_line["line-translate-anchor"]),"line-width":new Zr(zt.paint_line["line-width"]),"line-gap-width":new Zr(zt.paint_line["line-gap-width"]),"line-offset":new Zr(zt.paint_line["line-offset"]),"line-blur":new Zr(zt.paint_line["line-blur"]),"line-dasharray":new Gr(zt.paint_line["line-dasharray"]),"line-pattern":new Gr(zt.paint_line["line-pattern"]),"line-gradient":new Wr(zt.paint_line["line-gradient"])}),layout:zn};const ll=new class extends Zr{possiblyEvaluate(t,e){return e=new Or(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,o){return e=v({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,o)}}(al.paint.properties["line-width"].specification);function hl(t,e){return 0<e?e+2*t:t}ll.useIntegerZoom=!0;const pl=$r([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),cl=$r([{name:"a_projected_pos",components:3,type:"Float32"}],4);$r([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ul=$r([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),dl=$r([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);$r([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const fl=$r([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),gl=$r([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);$r([{name:"triangle",components:3,type:"Uint16"}]),$r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),$r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),$r([{type:"Float32",name:"offsetX"}]),$r([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var yl=24;const ml=128;function _l(i,o){const{expression:r}=o;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new Or(i+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:a}=r;let t=0;for(;t<s.length&&s[t]<=i;)t++;t=Math.max(0,t-1);let e=t;for(;e<s.length&&s[e]<i+1;)e++;e=Math.min(s.length-1,e);var n=s[t],o=s[e];return"composite"===r.kind?{kind:"composite",minZoom:n,maxZoom:o,interpolationType:a}:{kind:"camera",minZoom:n,maxZoom:o,minSize:r.evaluate(new Or(n)),maxSize:r.evaluate(new Or(o)),interpolationType:a}}}function vl(t,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:r}){return"source"===t.kind?o/ml:"composite"===t.kind?Ye(o/ml,r/ml,i):e}function bl(t,e){let i=0,o=0;var r,n,s;return"constant"===t.kind?o=t.layoutSize:"source"!==t.kind&&({interpolationType:r,minZoom:n,maxZoom:s}=t,s=r?d(pi.interpolationFactor(r,e,n,s),0,1):0,"camera"===t.kind?o=Ye(t.minSize,t.maxSize,s):i=s),{uSizeT:i,uSize:o}}mi=Object.freeze({__proto__:null,getSizeData:_l,evaluateSizeForFeature:vl,evaluateSizeForZoom:bl,SIZE_PACK_FACTOR:ml});const xl={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function wl(t,e,i,o,r){var n,s,a=8*r-o-1,l=(1<<a)-1,h=l>>1,p=-7,c=i?r-1:0,u=i?-1:1,i=t[e+c];for(c+=u,n=i&(1<<-p)-1,i>>=-p,p+=a;0<p;n=256*n+t[e+c],c+=u,p-=8);for(s=n&(1<<-p)-1,n>>=-p,p+=o;0<p;s=256*s+t[e+c],c+=u,p-=8);if(0===n)n=1-h;else{if(n===l)return s?NaN:1/0*(i?-1:1);s+=Math.pow(2,o),n-=h}return(i?-1:1)*s*Math.pow(2,n-o)}function Ml(t,e,i,o,r,n){var s,a,l=8*n-r-1,h=(1<<l)-1,p=h>>1,c=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,u=o?0:n-1,d=o?1:-1,n=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(o=Math.pow(2,-s))<1&&(s--,o*=2),2<=(e+=1<=s+p?c/o:c*Math.pow(2,1-p))*o&&(s++,o/=2),h<=s+p?(a=0,s=h):1<=s+p?(a=(e*o-1)*Math.pow(2,r),s+=p):(a=e*Math.pow(2,p-1)*Math.pow(2,r),s=0));8<=r;t[i+u]=255&a,u+=d,a/=256,r-=8);for(s=s<<r|a,l+=r;0<l;t[i+u]=255&s,u+=d,s/=256,l-=8);t[i+u-d]|=128*n}var Pl=El;function El(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}El.Varint=0,El.Fixed64=1,El.Bytes=2,El.Fixed32=5;var Sl=4294967296,Tl=1/Sl,Al="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Cl(t){return t.type===El.Bytes?t.readVarint()+t.pos:t.pos+1}function Il(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Ll(t,e,i){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(var r=i.pos-1;t<=r;r--)i.buf[r+o]=i.buf[r]}function Ol(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Rl(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Dl(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function kl(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function zl(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Fl(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Nl(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Ul(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Bl(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function jl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Zl(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Gl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Vl(t,e,i){1===t&&i.readMessage(Wl,e)}function Wl(t,e,i){if(3===t){const{id:t,bitmap:o,width:r,height:n,left:s,top:a,advance:l}=i.readMessage(Hl,{});e.push({id:t,bitmap:new Qs({width:r+6,height:n+6},o),metrics:{width:r,height:n,left:s,top:a,advance:l}})}}function Hl(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}function ql(t){let e=0,i=0;for(const o of t)e+=o.w*o.h,i=Math.max(i,o.w);t.sort((t,e)=>e.h-t.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let r=0,n=0;for(const e of t)for(let t=o.length-1;0<=t;t--){const i=o[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,n=Math.max(n,e.y+e.h),r=Math.max(r,e.x+e.w),e.w===i.w&&e.h===i.h){const e=o.pop();t<o.length&&(o[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):(e.w===i.w||o.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:r,h:n,fill:e/(r*n)||0}}El.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),r=o>>3,n=this.pos;this.type=7&o,t(r,e,this),this.pos===n&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=jl(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Gl(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=jl(this.buf,this.pos)+jl(this.buf,this.pos+4)*Sl;return this.pos+=8,t},readSFixed64:function(){var t=jl(this.buf,this.pos)+Gl(this.buf,this.pos+4)*Sl;return this.pos+=8,t},readFloat:function(){var t=wl(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=wl(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i=this.buf,o=127&(e=i[this.pos++]);return e<128?o:(o|=(127&(e=i[this.pos++]))<<7,e<128?o:(o|=(127&(e=i[this.pos++]))<<14,e<128?o:(o|=(127&(e=i[this.pos++]))<<21,e<128?o:function(t,e,i){var o,r=i.buf,n=(112&(o=r[i.pos++]))>>4;if(o<128)return Il(t,n,e);if(n|=(127&(o=r[i.pos++]))<<3,o<128)return Il(t,n,e);if(n|=(127&(o=r[i.pos++]))<<10,o<128)return Il(t,n,e);if(n|=(127&(o=r[i.pos++]))<<17,o<128)return Il(t,n,e);if(n|=(127&(o=r[i.pos++]))<<24,o<128)return Il(t,n,e);if(n|=(1&(o=r[i.pos++]))<<31,o<128)return Il(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&i[this.pos])<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t,e=this.readVarint()+this.pos,p=this.pos;return 12<=(this.pos=e)-p&&Al?(t=this.buf,Al.decode(t.subarray(p,e))):function(t,e){for(var i="",o=p;o<e;){var r,n,s,a=t[o],l=null,h=239<a?4:223<a?3:191<a?2:1;if(e<o+h)break;1===h?a<128&&(l=a):2===h?128==(192&(r=t[o+1]))&&(l=(31&a)<<6|63&r)<=127&&(l=null):3===h?(n=t[o+2],128==(192&(r=t[o+1]))&&128==(192&n)&&((l=(15&a)<<12|(63&r)<<6|63&n)<=2047||55296<=l&&l<=57343)&&(l=null)):4===h&&(n=t[o+2],s=t[o+3],128==(192&(r=t[o+1]))&&128==(192&n)&&128==(192&s)&&((l=(15&a)<<18|(63&r)<<12|(63&n)<<6|63&s)<=65535||1114112<=l)&&(l=null)),null===l?(l=65533,h=1):65535<l&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),o+=h}return i}(this.buf,e)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==El.Bytes)return t.push(this.readVarint(e));var i=Cl(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==El.Bytes)return t.push(this.readSVarint());var e=Cl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==El.Bytes)return t.push(this.readBoolean());var e=Cl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==El.Bytes)return t.push(this.readFloat());var e=Cl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==El.Bytes)return t.push(this.readDouble());var e=Cl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==El.Bytes)return t.push(this.readFixed32());var e=Cl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==El.Bytes)return t.push(this.readSFixed32());var e=Cl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==El.Bytes)return t.push(this.readFixed64());var e=Cl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==El.Bytes)return t.push(this.readSFixed64());var e=Cl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){t&=7;if(t===El.Varint)for(;127<this.buf[this.pos++];);else if(t===El.Bytes)this.pos=this.readVarint()+this.pos;else if(t===El.Fixed32)this.pos+=4;else{if(t!==El.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e,i=this.length||16;i<this.pos+t;)i*=2;i!==this.length&&((e=new Uint8Array(i)).set(this.buf),this.buf=e,this.length=i)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Zl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Zl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Zl(this.buf,-1&t,this.pos),Zl(this.buf,Math.floor(t*Tl),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Zl(this.buf,-1&t,this.pos),Zl(this.buf,Math.floor(t*Tl),this.pos+4),this.pos+=8},writeVarint:function(r){268435455<(r=+r||0)||r<0?function(t){var e,i,o;if(0<=r?(o=r%4294967296|0,e=r/4294967296|0):(e=~(-r/4294967296),4294967295^(o=~(-r%4294967296))?o=o+1|0:e=e+1|(o=0)),0x10000000000000000<=r||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),i=o,(o=t).buf[o.pos++]=127&i|128,i>>>=7,o.buf[o.pos++]=127&i|128,i>>>=7,o.buf[o.pos++]=127&i|128,i>>>=7,o.buf[o.pos++]=127&i|128,o.buf[o.pos]=127&(i>>>=7),e=(7&(i=e))<<4,(t=t).buf[t.pos++]|=e|((i>>>=3)?128:0),i&&(t.buf[t.pos++]=127&i|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=127&i|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=127&i|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=127&i|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=127&i)))))}(this):(this.realloc(4),this.buf[this.pos++]=127&r|(127<r?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(127<r?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(127<r?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var o,r,n=0;n<e.length;n++){if(55295<(o=e.charCodeAt(n))&&o<57344){if(!r){56319<o||n+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=o;continue}if(o<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=o;continue}o=r-55296<<10|o-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);o<128?t[i++]=o:(o<2048?t[i++]=o>>6|192:(o<65536?t[i++]=o>>12|224:(t[i++]=o>>18|240,t[i++]=o>>12&63|128),t[i++]=o>>6&63|128),t[i++]=63&o|128)}return i}(this.buf,t,this.pos);t=this.pos-e;128<=t&&Ll(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(t){this.realloc(4),Ml(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ml(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);e=this.pos-i;128<=e&&Ll(i,e,this),this.pos=i-1,this.writeVarint(e),this.pos+=e},writeMessage:function(t,e,i){this.writeTag(t,El.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ol,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Rl,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,zl,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Dl,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,kl,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Fl,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Nl,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Ul,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Bl,e)},writeBytesField:function(t,e){this.writeTag(t,El.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,El.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,El.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,El.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,El.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,El.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,El.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,El.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,El.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,El.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Yl{constructor(t,{pixelRatio:e,version:i,stretchX:o,stretchY:r,content:n}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=o,this.stretchY=r,this.content=n,this.version=i}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Xl{constructor(t,e){const i={},o={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,i,r),this.addImages(e,o,r);const{w:n,h:s}=ql(r),a=new ta({width:n||1,height:s||1});for(const e in t){const o=t[e],r=i[e].paddedRect;ta.copy(o.data,a,{x:0,y:0},{x:r.x+1,y:r.y+1},o.data)}for(const t in e){const i=e[t],r=o[t].paddedRect,n=r.x+1,s=r.y+1,l=i.data.width,h=i.data.height;ta.copy(i.data,a,{x:0,y:0},{x:n,y:s},i.data),ta.copy(i.data,a,{x:0,y:h-1},{x:n,y:s-1},{width:l,height:1}),ta.copy(i.data,a,{x:0,y:0},{x:n,y:s+h},{width:l,height:1}),ta.copy(i.data,a,{x:l-1,y:0},{x:n-1,y:s},{width:1,height:h}),ta.copy(i.data,a,{x:0,y:0},{x:n+l,y:s},{width:1,height:h})}this.image=a,this.iconPositions=i,this.patternPositions=o}addImages(t,e,i){for(const n in t){var o=t[n],r={x:0,y:0,w:o.data.width+2,h:o.data.height+2};i.push(r),e[n]=new Yl(r,o),o.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in t.updatedImages)this.patchUpdatedImage(this.iconPositions[i],t.getImage(i),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i),e)}patchUpdatedImage(t,e,i){var o;t&&e&&t.version!==e.version&&(t.version=e.version,[o,t]=t.tl,i.update(e.data,void 0,{x:o,y:t}))}}zo("ImagePosition",Yl),zo("ImageAtlas",Xl);const Kl={horizontal:1,vertical:2,horizontalOnly:3},$l=-17;class Jl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new Jl;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new Jl;return e.imageName=t,e}}class Ql{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new Ql;for(let t=0;t<e.sections.length;t++){var r=e.sections[t];r.image?o.addImageSection(r):o.addTextSection(r,i)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(e){let i="";for(let t=0;t<e.length;t++){var o=e.charCodeAt(t+1)||null,r=e.charCodeAt(t-1)||null;i+=o&&_r(o)&&!xl[e[t+1]]||r&&_r(r)&&!xl[e[t-1]]||!xl[e[t]]?e[t]:xl[e[t]]}return i}(this.text)}trim(){let e=0;for(let t=0;t<this.text.length&&eh[this.text.charCodeAt(t)];t++)e++;let i=this.text.length;for(let t=this.text.length-1;0<=t&&t>=e&&eh[this.text.charCodeAt(t)];t--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(t,e){const i=new Ql;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,e)=>Math.max(t,this.sections[e].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Jl.forText(e.scale,e.fontStack||t));var i=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(i)}addImageSection(t){var e=t.image?t.image.name:"";0!==e.length?(t=this.getNextImageSectionCharCode())?(this.text+=String.fromCharCode(t),this.sections.push(Jl.forImage(e)),this.sectionIndex.push(this.sections.length-1)):Z("Reached maximum number of images 6401"):Z("Can't add FormattedSection with an empty image.")}getNextImageSectionCharCode(){return this.imageSectionID?63743<=this.imageSectionID?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function th(e,i,t,o,r,n,s,a,l,h,p,c,u,d,f,g){const y=Ql.fromFeature(e,r);let m;c===Kl.vertical&&y.verticalizePunctuation();const{processBidirectionalText:_,processStyledBidirectionalText:v}=Lr;if(_&&1===y.sections.length){m=[];const e=_(y.toString(),sh(y,h,n,i,o,d,f));for(const i of e){const e=new Ql;e.text=i,e.sections=y.sections;for(let t=0;t<i.length;t++)e.sectionIndex.push(0);m.push(e)}}else if(v){m=[];const e=v(y.text,y.sectionIndex,sh(y,h,n,i,o,d,f));for(const i of e){const e=new Ql;e.text=i[0],e.sectionIndex=i[1],e.sections=y.sections,m.push(e)}}else m=function(t,e){const i=[],o=t.text;let r=0;for(const o of e)i.push(t.substring(r,o)),r=o;return r<o.length&&i.push(t.substring(r,o.length)),i}(y,sh(y,h,n,i,o,d,f));var b=[],p={positionedLines:b,text:y.toString(),top:p[1],bottom:p[1],left:p[0],right:p[0],writingMode:c,iconsInText:!1,verticalizable:!1};return function(a,l,h,p,c,u,d,f,g,y,m,_){let v=0,b=$l,x=0,w=0;const M="right"===f?1:"left"===f?0:.5;let t=0;for(const d of c){d.trim();const c=d.getMaxScale(),f=(c-1)*yl,i={positionedGlyphs:[],lineOffset:0};a.positionedLines[t]=i;const E=i.positionedGlyphs;let s=0;if(d.length()){for(let n=0;n<d.length();n++){const x=d.getSection(n),w=d.getSectionIndex(n),M=d.getCharCode(n);let t=0,e=null,i=null,o=null,r=yl;P=!(g===Kl.horizontal||!m&&!mr(M)||m&&(eh[M]||(P=M,Zo(P)||Go(P)||Vo(P)||hr(P)||dr(P))));if(x.imageName){const l=p[x.imageName];if(!l)continue;o=x.imageName,a.iconsInText=a.iconsInText||!0,i=l.paddedRect;const h=l.displaySize;x.scale=x.scale*yl/_,e={width:h[0],height:h[1],left:1,top:-3,advance:P?h[1]:h[0],localGlyph:!1},t=f+(yl-h[1]*x.scale),r=e.advance;const u=P?h[0]*x.scale-yl*c:h[1]*x.scale-yl*c;0<u&&u>s&&(s=u)}else{const a=h[x.fontStack],p=a&&a[M];if(p&&p.rect)i=p.rect,e=p.metrics;else{const a=l[x.fontStack],h=a&&a[M];if(!h)continue;e=h.metrics}t=(c-x.scale)*yl}P?(a.verticalizable=!0,E.push({glyph:M,imageName:o,x:v,y:b+t,vertical:P,scale:x.scale,localGlyph:e.localGlyph,fontStack:x.fontStack,sectionIndex:w,metrics:e,rect:i}),v+=r*x.scale+y):(E.push({glyph:M,imageName:o,x:v,y:b+t,vertical:P,scale:x.scale,localGlyph:e.localGlyph,fontStack:x.fontStack,sectionIndex:w,metrics:e,rect:i}),v+=e.advance*x.scale+y)}0!==E.length&&(x=Math.max(v-y,x),function(e,i,o,t,r){if(t||r){var n=e[o],s=(e[o].x+n.metrics.advance*n.scale)*t;for(let t=i;t<=o;t++)e[t].x-=s,e[t].y+=r}}(E,0,E.length-1,M,s)),v=0;var e=u*c+s;i.lineOffset=Math.max(s,f),b+=e,w=Math.max(e,w),++t}else b+=u,++t}var P;const i=b-$l,{horizontalAlign:E,verticalAlign:o}=ah(d);(function(t,e,i,o,r,n,s,a,l){var h=(e-i)*r,p=n!==s?-a*o-$l:(-o*l+.5)*s;for(const e of t)for(const t of e.positionedGlyphs)t.x+=h,t.y+=p})(a.positionedLines,M,E,o,x,w,u,i,c.length),a.top+=-o*i,a.bottom=a.top+i,a.left+=-E*x,a.right=a.left+x}(p,i,t,o,m,s,a,l,c,h,u,g),!function(){for(const t of b)if(0!==t.positionedGlyphs.length)return;return 1}()&&p}const eh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ih={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function oh(t,e,i,o,r,n){if(e.imageName){const t=o[e.imageName];return t?t.displaySize[0]*e.scale*yl/n+r:0}{const o=i[e.fontStack],n=o&&o[t];return n?n.metrics.advance*e.scale+r:0}}function rh(t,e,i,o){var r=Math.pow(t-e,2);return o?t<e?r/2:2*r:r+Math.abs(i)*i}function nh(t,e,i,o,r,n){let s=null,a=rh(e,i,r,n);for(const t of o){const o=rh(e-t.x,i,r,n)+t.badness;o<=a&&(s=t,a=o)}return{index:t,x:e,priorBreak:s,badness:a}}function sh(e,i,t,o,r,n,s){if("point"!==n)return[];if(!e)return[];const a=[],l=function(e,i,t,o,r,n){let s=0;for(let t=0;t<e.length();t++){var a=e.getSection(t);s+=oh(e.getCharCode(t),a,o,r,i,n)}return s/Math.max(1,Math.ceil(s/t))}(e,i,t,o,r,s),h=0<=e.text.indexOf("");let p=0;for(let t=0;t<e.length();t++){const n=e.getSection(t),u=e.getCharCode(t);if(eh[u]||(p+=oh(u,n,o,r,i,s)),t<e.length()-1){const i=!((c=u)<11904||!(Jo(c)||$o(c)||cr(c)||lr(c)||ir(c)||Wo(c)||Qo(c)||Yo(c)||or(c)||rr(c)||er(c)||fr(c)||Xo(c)||qo(c)||Ho(c)||tr(c)||Ko(c)||pr(c)||sr(c)||nr(c)));(ih[u]||i||n.imageName)&&a.push(nh(t+1,p,l,a,function(t,e,i){let o=0;return 10===t&&(o-=1e4),i&&(o+=150),40!==t&&65288!==t||(o+=50),41!==e&&65289!==e||(o+=50),o}(u,e.getCharCode(t+1),i&&h),!1))}}var c;return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(nh(e.length(),p,l,a,0,!0))}function ah(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function lh(t,e,i,o,r,n){var s=t.image;let a;if(s.content){const d=s.content,e=s.pixelRatio||1;a=[d[0]/e,d[1]/e,s.displaySize[0]-d[2]/e,s.displaySize[1]-d[3]/e]}var l=e.left*n,t=e.right*n;let h,p,c,u;p="width"===i||"both"===i?(u=r[0]+l-o[3],r[0]+t+o[1]):(u=r[0]+(l+t-s.displaySize[0])/2,u+s.displaySize[0]);t=e.top*n,n=e.bottom*n;return c="height"===i||"both"===i?(h=r[1]+t-o[0],r[1]+n+o[2]):(h=r[1]+(t+n-s.displaySize[1])/2,h+s.displaySize[1]),{image:s,top:h,right:p,bottom:c,left:u,collisionPadding:a}}class hh extends z{constructor(t,e,i,o){super(t,e),this.angle=i,void 0!==o&&(this.segment=o)}clone(){return new hh(this.x,this.y,this.angle,this.segment)}}function ph(t,e,i,o,r){if(void 0===e.segment)return 1;let n=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return;a-=t[s].dist(n),n=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let h=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return;var p=t[s-1].angleTo(e)-e.angleTo(i),p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI);for(l.push({distance:a,angleDelta:p}),h+=p;a-l[0].distance>o;)h-=l.shift().angleDelta;if(h>r)return;s++,a+=e.dist(i)}return 1}function ch(e){let i=0;for(let t=0;t<e.length-1;t++)i+=e[t].dist(e[t+1]);return i}function uh(t,e,i){return t?.6*e*i:0}function dh(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function fh(t,e,i,o,r,n,s,a,l){var h=uh(o,n,s),p=dh(o,r),o=p*s,r=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-o<e/4&&(e=o+e/4),function t(e,i,o,r,n,s,a,l,h){const p=s/2,c=ch(e);let u=0,d=i-o,f=[];for(let t=0;t<e.length-1;t++){const a=e[t],l=e[t+1],g=a.dist(l),y=l.angleTo(a);for(;d+o<u+g;){d+=o;const m=(d-u)/g,_=Ye(a.x,l.x,m),v=Ye(a.y,l.y,m);if(0<=_&&_<h&&0<=v&&v<h&&0<=d-p&&d+p<=c){const o=new hh(_,v,y,t);o._round(),r&&!ph(e,o,s,r,n)||f.push(o)}}u+=g}return l||f.length||a||(f=t(e,u/2,o,r,n,s,a,!0,h)),f}(t,r?e/2*a%e:(p/2+2*n)*s*a%e,e,h,i,o,r,!1,l)}function gh(e,r,n,s,a){const l=[];for(let t=0;t<e.length;t++){var h=e[t];let o;for(let i=0;i<h.length-1;i++){let t=h[i],e=h[i+1];t.x<r&&e.x<r||(t.x<r?t=new z(r,t.y+(r-t.x)/(e.x-t.x)*(e.y-t.y))._round():e.x<r&&(e=new z(r,t.y+(r-t.x)/(e.x-t.x)*(e.y-t.y))._round()),t.y<n&&e.y<n||(t.y<n?t=new z(t.x+(n-t.y)/(e.y-t.y)*(e.x-t.x),n)._round():e.y<n&&(e=new z(t.x+(n-t.y)/(e.y-t.y)*(e.x-t.x),n)._round()),t.x>=s&&e.x>=s||(t.x>=s?t=new z(s,t.y+(s-t.x)/(e.x-t.x)*(e.y-t.y))._round():e.x>=s&&(e=new z(s,t.y+(s-t.x)/(e.x-t.x)*(e.y-t.y))._round()),t.y>=a&&e.y>=a||(t.y>=a?t=new z(t.x+(a-t.y)/(e.y-t.y)*(e.x-t.x),a)._round():e.y>=a&&(e=new z(t.x+(a-t.y)/(e.y-t.y)*(e.x-t.x),a)._round()),o&&t.equals(o[o.length-1])||(o=[t],l.push(o)),o.push(e)))))}}return l}zo("Anchor",hh);var _i=mh,zn=mh,yh=1e20;function mh(t,e,i,o,r,n){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=o||.25,this.fontFamily=r||"sans-serif",this.fontWeight=n||"normal",this.radius=i||8;n=this.size=this.fontSize+2*this.buffer,i=n+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=n,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(i*i),this.gridInner=new Float64Array(i*i),this.f=new Float64Array(i),this.z=new Float64Array(i+1),this.v=new Uint16Array(i),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(n/2*(0<=navigator.userAgent.indexOf("Gecko/")?1.2:1))}function _h(t,e,i,o,r,n){for(var s=0;s<e;s++)vh(t,s,e,i,o,r,n);for(var a=0;a<i;a++)vh(t,a*e,1,e,o,r,n)}function vh(t,e,i,o,r,n,s){var a,l,h,p;for(s[n[0]=0]=-yh,s[1]=yh,a=0;a<o;a++)r[a]=t[e+a*i];for(a=1,h=l=0;a<o;a++){for(;(h=(r[a]-r[p=n[l]]+a*a-p*p)/(a-p)/2)<=s[l]&&-1<--l;);n[++l]=a,s[l]=h,s[l+1]=yh}for(l=a=0;a<o;a++){for(;s[l+1]<a;)l++;t[e+a*i]=r[p=n[l]]+(a-p)*(a-p)}}mh.prototype._draw=function(t,e){var i,o,r,n,s,a,l,h,p=this.ctx.measureText(t),c=p.width,u=2*this.buffer;e&&this.useMetrics?(s=Math.floor(p.actualBoundingBoxAscent),l=this.buffer+Math.ceil(p.actualBoundingBoxAscent),d=this.buffer,a=this.buffer,i=(o=Math.min(this.size,Math.ceil(p.actualBoundingBoxRight-p.actualBoundingBoxLeft)))+u,r=(n=Math.min(this.size-d,Math.ceil(p.actualBoundingBoxAscent+p.actualBoundingBoxDescent)))+u,this.ctx.textBaseline="alphabetic"):(i=o=this.size,r=n=this.size,s=19*this.fontSize/24,d=a=0,l=this.middle,this.ctx.textBaseline="middle"),o&&n&&(this.ctx.clearRect(a,d,o,n),this.ctx.fillText(t,this.buffer,l),h=this.ctx.getImageData(a,d,o,n));var d=new Uint8ClampedArray(i*r);return function(t,e,i,o,r,n,s){n.fill(yh,0,e*i),s.fill(0,0,e*i);for(var a=(e-o)/2,l=0;l<r;l++)for(var h=0;h<o;h++){var p,c=(l+a)*e+h+a,u=t.data[4*(l*o+h)+3]/255;1==u?(n[c]=0,s[c]=yh):0==u?(n[c]=yh,s[c]=0):(p=Math.max(0,.5-u),u=Math.max(0,u-.5),n[c]=p*p,s[c]=u*u)}}(h,i,r,o,n,this.gridOuter,this.gridInner),_h(this.gridOuter,i,r,this.f,this.v,this.z),_h(this.gridInner,i,r,this.f,this.v,this.z),function(t,e,i,o,r,n,s){for(var a=0;a<e*i;a++){var l=Math.sqrt(o[a])-Math.sqrt(r[a]);t[a]=Math.round(255-255*(l/n+s))}}(d,i,r,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:d,metrics:{width:o,height:n,sdfWidth:i,sdfHeight:r,top:s,left:0,advance:c}}},mh.prototype.draw=function(t){return this._draw(t,!1).data},mh.prototype.drawWithMetrics=function(t){return this._draw(t,!0)},_i.default=zn;const bh={none:0,ideographs:1,all:2};class xh{constructor(t,e,i){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=i,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,r){const e=[];for(const r in t)for(const i of t[r])e.push({stack:r,id:i});g(e,({stack:i,id:r},n)=>{let s=this.entries[i];s=s||(this.entries[i]={glyphs:{},requests:{},ranges:{}});let t=s.glyphs[r];if(void 0===t){if(t=this._tinySDF(s,i,r),t)return s.glyphs[r]=t,void n(null,{stack:i,id:r,glyph:t});const a=Math.floor(r/256);if(65535<256*a)n(new Error("glyphs > 65535 not supported"));else if(s.ranges[a])n(null,{stack:i,id:r,glyph:t});else{let o=s.requests[a];o||(o=s.requests[a]=[],xh.loadGlyphRange(i,a,this.url,this.requestManager,(t,e)=>{if(e){for(const t in e)this._doesCharSupportLocalGlyph(+t)||(s.glyphs[+t]=e[+t]);s.ranges[a]=!0}for(const i of o)i(t,e);delete s.requests[a]})),o.push((t,e)=>{t?n(t):e&&n(null,{stack:i,id:r,glyph:e[r]||null})})}}else n(null,{stack:i,id:r,glyph:t})},(t,e)=>{if(t)r(t);else if(e){const t={};for(const{stack:r,id:i,glyph:o}of e)(t[r]||(t[r]={}))[i]=o&&{id:o.id,bitmap:o.bitmap.clone(),metrics:o.metrics};r(null,t)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==bh.none&&(this.localGlyphMode===bh.all?!!this.localFontFamily:!!this.localFontFamily&&(rr(t)||ar(t)||Xo(t)||Ko(t)))}_tinySDF(i,o,t){var r=this.localFontFamily;if(r&&this._doesCharSupportLocalGlyph(t)){let e=i.tinySDF;if(!e){let t="400";/bold/i.test(o)?t="900":/medium/i.test(o)?t="500":/light/i.test(o)&&(t="200"),e=i.tinySDF=new xh.TinySDF(48,6,16,.25,r,t)}if(this.localGlyphs[e.fontWeight][t])return this.localGlyphs[e.fontWeight][t];var{data:n,metrics:s}=e.drawWithMetrics(String.fromCharCode(t)),{sdfWidth:a,sdfHeight:l,width:h,height:o,left:i,top:r,advance:s}=s;return this.localGlyphs[e.fontWeight][t]={id:t,bitmap:new Qs({width:a,height:l},n),metrics:{width:h/2,height:o/2,left:i/2,top:r/2-27,advance:s/2,localGlyph:!0}}}}}function wh(v,b,x,e){const i=[],w=v.image,M=w.pixelRatio,t=w.paddedRect.w-2,o=w.paddedRect.h-2,P=v.right-v.left,E=v.bottom-v.top,r=w.stretchX||[[0,t]],n=w.stretchY||[[0,o]],s=(t,e)=>t+e[1]-e[0],S=r.reduce(s,0),T=n.reduce(s,0),a=t-S,l=o-T;let A=0,C=S,I=0,L=T,O=0,R=a,D=0,k=l;if(w.content&&e){const v=w.content;A=Mh(r,0,v[0]),I=Mh(n,0,v[1]),C=Mh(r,v[0],v[2]),L=Mh(n,v[1],v[3]),O=v[0]-A,D=v[1]-I,R=v[2]-v[0]-C,k=v[3]-v[1]-L}var h=(t,e,i,o)=>{const r=(t.stretch-A)/C*P+v.left,n=t.fixed-O-R*t.stretch/S,s=(e.stretch-I)/L*E+v.top,a=e.fixed-D-k*e.stretch/T,l=(i.stretch-A)/C*P+v.left,h=i.fixed-O-R*i.stretch/S,p=(o.stretch-I)/L*E+v.top,c=o.fixed-D-k*o.stretch/T,u=new z(r,s),d=new z(l,s),f=new z(l,p),g=new z(r,p),y=new z(n/M,a/M),m=new z(h/M,c/M),_=b*Math.PI/180;if(_){const v=Math.sin(_),b=Math.cos(_),x=[b,-v,v,b];u._matMult(x),d._matMult(x),g._matMult(x),f._matMult(x)}t=t.stretch+t.fixed,e=e.stretch+e.fixed;return{tl:u,tr:d,bl:g,br:f,tex:{x:w.paddedRect.x+1+t,y:w.paddedRect.y+1+e,w:i.stretch+i.fixed-t,h:o.stretch+o.fixed-e},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:y,pixelOffsetBR:m,minFontScaleX:R/M/P,minFontScaleY:k/M/E,isSDF:x}};if(e&&(w.stretchX||w.stretchY)){const v=Ph(r,a,S),b=Ph(n,l,T);for(let t=0;t<v.length-1;t++){const e=v[t],z=v[t+1];for(let t=0;t<b.length-1;t++)i.push(h(e,b[t],z,b[t+1]))}}else i.push(h({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:1+t},{fixed:0,stretch:1+o}));return i}function Mh(t,e,i){let o=0;for(const r of t)o+=Math.max(e,Math.min(i,r[1]))-Math.max(e,Math.min(i,r[0]));return o}function Ph(t,e,i){const o=[{fixed:-1,stretch:0}];for(const[e,i]of t){const t=o[o.length-1];o.push({fixed:e-t.stretch,stretch:t.stretch}),o.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return o.push({fixed:e+1,stretch:i}),o}xh.loadGlyphRange=function(t,e,i,o,r){var n=256*e,e=255+n,e=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${n}-${e}`),bt.Glyphs);Pt(e,(t,e)=>{if(t)r(t);else if(e){const t={};for(const i of new Pl(e).readFields(Vl,[]))t[i.id]=i;r(null,t)}})},xh.TinySDF=_i;class Eh{constructor(t=[],e=function(t,e){return t<e?-1:e<t?1:0}){if(this.data=t,this.length=this.data.length,this.compare=e,0<this.length)for(let t=(this.length>>1)-1;0<=t;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,0<this.length&&(this.data[0]=e,this._down(0)),t}}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,o=e[t];for(;0<t;){var r=t-1>>1,n=e[r];if(0<=i(o,n))break;e[t]=n,t=r}e[t]=o}_down(i){const{data:o,compare:r}=this,t=this.length>>1,n=o[i];for(;i<t;){let t=1+(i<<1),e=o[t];var s=t+1;if(s<this.length&&r(o[s],e)<0&&(t=s,e=o[s]),0<=r(e,n))break;o[i]=e,i=t}o[i]=n}}function Sh(t,e){return e.max-t.max}function Th(t,e,i,o){this.p=new z(t,e),this.h=i,this.d=function(o,e){let r=!1,n=1/0;for(let t=0;t<e.length;t++){var s=e[t];for(let t=0,e=s.length,i=e-1;t<e;i=t++){var a=s[t],l=s[i];a.y>o.y!=l.y>o.y&&o.x<(l.x-a.x)*(o.y-a.y)/(l.y-a.y)+a.x&&(r=!r),n=Math.min(n,ws(o,a,l))}}return(r?1:-1)*Math.sqrt(n)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const Ah=Number.POSITIVE_INFINITY;function Ch(t,e){return e[1]!==Ah?function(t,e,i){let o=0,r=0;switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":r=i-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-i}switch(t){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}return[o,r]}(t,e[0],e[1]):function(t,e){let i=0,o=0;var r=(e=e<0?0:e)/Math.sqrt(2);switch(t){case"top-right":case"top-left":o=r-7;break;case"bottom-right":case"bottom-left":o=7-r;break;case"bottom":o=7-e;break;case"top":o=e-7}switch(t){case"top-right":case"bottom-right":i=-r;break;case"top-left":case"bottom-left":i=r;break;case"left":i=e;break;case"right":i=-e}return[i,o]}(t,e[0])}function Ih(o,r,n,s,a,l,h,p){o.createArrays(),o.tilePixelRatio=cs/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const c=o.layers[0].layout,u=o.layers[0]._unevaluatedLayout._values,d={};if("composite"===o.textSizeData.kind){const{minZoom:r,maxZoom:n}=o.textSizeData;d.compositeTextSizes=[u["text-size"].possiblyEvaluate(new Or(r),h),u["text-size"].possiblyEvaluate(new Or(n),h)]}if("composite"===o.iconSizeData.kind){const{minZoom:r,maxZoom:n}=o.iconSizeData;d.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new Or(r),h),u["icon-size"].possiblyEvaluate(new Or(n),h)]}d.layoutTextSize=u["text-size"].possiblyEvaluate(new Or(p+1),h),d.layoutIconSize=u["icon-size"].possiblyEvaluate(new Or(p+1),h),d.textMaxSize=u["text-size"].possiblyEvaluate(new Or(18),h);const f="map"===c.get("text-rotation-alignment")&&"point"!==c.get("symbol-placement"),g=c.get("text-keep-upright"),y=c.get("text-size");for(const l of o.features){const p=c.get("text-font").evaluate(l,{},h).join(","),u=y.evaluate(l,{},h),_=d.layoutTextSize.evaluate(l,{},h),v=(d.layoutIconSize.evaluate(l,{},h),{horizontal:{},vertical:void 0}),b=l.text;let t,i=[0,0];if(b){const s=b.toString(),d=c.get("text-letter-spacing").evaluate(l,{},h)*yl,y=c.get("text-line-height").evaluate(l,{},h)*yl,x=yr(s)?d:0,w=c.get("text-anchor").evaluate(l,{},h),M=c.get("text-variable-anchor");if(!M){const o=c.get("text-radial-offset").evaluate(l,{},h);i=o?Ch(w,[o*yl,Ah]):c.get("text-offset").evaluate(l,{},h).map(t=>t*yl)}let t=f?"center":c.get("text-justify").evaluate(l,{},h);const P=c.get("symbol-placement"),E="point"===P?c.get("text-max-width").evaluate(l,{},h)*yl:0,S=()=>{o.allowVerticalPlacement&&gr(s)&&(v.vertical=th(b,r,n,a,p,E,y,w,"left",x,i,Kl.vertical,!0,P,_,u))};if(!f&&M){const o="auto"===t?M.map(t=>Lh(t)):[t];let e=!1;for(let t=0;t<o.length;t++){const h=o[t];if(!v.horizontal[h])if(e)v.horizontal[h]=v.horizontal[0];else{const o=th(b,r,n,a,p,E,y,"center",h,x,i,Kl.horizontal,!1,P,_,u);o&&(v.horizontal[h]=o,e=1===o.positionedLines.length)}}S()}else{"auto"===t&&(t=Lh(w));const o=th(b,r,n,a,p,E,y,w,t,x,i,Kl.horizontal,!1,P,_,u);o&&(v.horizontal[t]=o),S(),gr(s)&&f&&g&&(v.vertical=th(b,r,n,a,p,E,y,w,t,x,i,Kl.vertical,!1,P,_,u))}}let e=!1;if(l.icon&&l.icon.name){const r=s[l.icon.name];r&&(t=function(t,e,i){var{horizontalAlign:o,verticalAlign:i}=ah(i),o=e[0]-t.displaySize[0]*o,i=e[1]-t.displaySize[1]*i;return{image:t,top:i,bottom:i+t.displaySize[1],left:o,right:o+t.displaySize[0]}}(a[l.icon.name],c.get("icon-offset").evaluate(l,{},h),c.get("icon-anchor").evaluate(l,{},h)),e=r.sdf,void 0===o.sdfIcons?o.sdfIcons=r.sdf:o.sdfIcons!==r.sdf&&Z("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),r.pixelRatio===o.pixelRatio&&0===c.get("icon-rotate").constantOr(1)||(o.iconsNeedLinear=!0))}var m=Dh(v.horizontal)||v.vertical;o.iconsInText||(o.iconsInText=!!m&&m.iconsInText),(m||t)&&function(i,o,r,n,s,a,l,h,p,c){let t=a.textMaxSize.evaluate(o,{},c);void 0===t&&(t=l);const e=i.layers[0].layout,u=e.get("icon-offset").evaluate(o,{},c),d=Dh(r.horizontal),f=l/24,g=i.tilePixelRatio*t/24,y=i.tilePixelRatio*e.get("symbol-spacing"),m=e.get("text-padding")*i.tilePixelRatio,_=e.get("icon-padding")*i.tilePixelRatio,v=T(e.get("text-max-angle")),b="map"===e.get("text-rotation-alignment")&&"point"!==e.get("symbol-placement"),x="map"===e.get("icon-rotation-alignment")&&"point"!==e.get("symbol-placement"),w=e.get("symbol-placement"),M=y/2,P=e.get("icon-text-fit");let E;n&&"none"!==P&&(i.allowVerticalPlacement&&r.vertical&&(E=lh(n,r.vertical,P,e.get("icon-text-fit-padding"),u,f)),d&&(n=lh(n,d,P,e.get("icon-text-fit-padding"),u,f)));var S=(t,e)=>{e.x<0||e.x>=cs||e.y<0||e.y>=cs||function(e,i,o,r,n,s,a,l,h,p,c,u,d,f,t,g,y,m,_,v,b,x,w){var M=e.addToLineVertexArray(i,o);let P,E,S,T,A,C,I,L=0,O=0,R=0,D=0,k=-1,z=-1;var F={};let N=Nn(""),U=0,B=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[U,B]=l.layout.get("text-offset").evaluate(_,{},x).map(t=>t*yl):(U=l.layout.get("text-radial-offset").evaluate(_,{},x)*yl,B=Ah),e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(f)C=zh(e),a&&(I=zh(a));else{const o=l.layout.get("text-rotate").evaluate(_,{},x)+90;S=kh(h,i,p,c,u,e,d,o),a&&(T=kh(h,i,p,c,u,a,g,o))}}if(n){const o=l.layout.get("icon-rotate").evaluate(_,{},x),r="none"!==l.layout.get("icon-text-fit"),s=wh(n,o,b,r),d=a?wh(a,o,b,r):void 0;E=kh(h,i,p,c,u,n,g,o),L=4*s.length;const f=e.iconSizeData;let t=null;"source"===f.kind?(t=[ml*l.layout.get("icon-size").evaluate(_,{},x)],t[0]>Oh&&Z(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===f.kind&&(t=[ml*v.compositeIconSizes[0].evaluate(_,{},x),ml*v.compositeIconSizes[1].evaluate(_,{},x)],(t[0]>Oh||t[1]>Oh)&&Z(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,t,m,y,_,!1,i,M.lineStartIndex,M.lineLength,-1,x),k=e.icon.placedSymbolArray.length-1,d&&(O=4*d.length,e.addSymbols(e.icon,d,t,m,y,_,Kl.vertical,i,M.lineStartIndex,M.lineLength,-1,x),z=e.icon.placedSymbolArray.length-1)}for(const o in r.horizontal){const n=r.horizontal[o];P||(N=Nn(n.text),f?A=zh(n):P=kh(h,i,p,c,u,n,d,l.layout.get("text-rotate").evaluate(_,{},x)));const a=1===n.positionedLines.length;if(R+=Rh(e,i,n,s,l,f,_,t,M,r.vertical?Kl.horizontal:Kl.horizontalOnly,a?Object.keys(r.horizontal):[o],F,k,v,x),a)break}r.vertical&&(D+=Rh(e,i,r.vertical,s,l,f,_,t,M,Kl.vertical,["vertical"],F,z,v,x));let j=-1;y=(t,e)=>t?Math.max(t,e):e;j=y(A,j),j=y(C,j),j=y(I,j);y=-1<j?1:0;y&&(j*=w/yl),e.glyphOffsetArray.length>=Vh.MAX_GLYPHS&&Z("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==_.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,_.sortKey),e.symbolInstances.emplaceBack(i.x,i.y,0<=F.right?F.right:-1,0<=F.center?F.center:-1,0<=F.left?F.left:-1,F.vertical||-1,k,z,N,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,void 0!==S?S:e.collisionBoxArray.length,void 0!==S?S+1:e.collisionBoxArray.length,void 0!==E?E:e.collisionBoxArray.length,void 0!==E?E+1:e.collisionBoxArray.length,T||e.collisionBoxArray.length,T?T+1:e.collisionBoxArray.length,p,R,D,L,O,y,0,U,B,j)}(i,e,t,r,n,s,E,i.layers[0],i.collisionBoxArray,o.index,o.sourceLayerIndex,i.index,m,b,h,_,x,u,o,a,p,c,l)};if("line"===w)for(const s of gh(o.geometry,0,0,cs,cs)){const o=fh(s,y,v,r.vertical||d,n,24,g,i.overscaling,cs);for(const r of o){const o=d;o&&function(e,t,i,o){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;0<=t;t--)if(o.dist(e[t])<i)return!0}else r[t]=[];return r[t].push(o),!1}(i,o.text,M,r)||S(s,r)}}else if("line-center"===w){for(const i of o.geometry)if(1<i.length){const o=function(e,i,t,o,r,n){var s=uh(t,r,n),a=dh(t,o)*n;let l=0;var h=ch(e)/2;for(let t=0;t<e.length-1;t++){const o=e[t],r=e[t+1],n=o.dist(r);if(l+n>h){const p=(h-l)/n,c=Ye(o.x,r.x,p),u=Ye(o.y,r.y,p),d=new hh(c,u,r.angleTo(o),t);return d._round(),!s||ph(e,d,a,s,i)?d:void 0}l+=n}}(i,v,r.vertical||d,n,24,g);o&&S(i,o)}}else if("Polygon"===o.type)for(const i of Aa(o.geometry,0)){const o=function(i,e,t=!1){let o=1/0,r=1/0,n=-1/0,s=-1/0;var a=i[0];for(let t=0;t<a.length;t++){const e=a[t];(!t||e.x<o)&&(o=e.x),(!t||e.y<r)&&(r=e.y),(!t||e.x>n)&&(n=e.x),(!t||e.y>s)&&(s=e.y)}var l=Math.min(n-o,s-r);let h=l/2;const p=new Eh([],Sh);if(0===l)return new z(o,r);for(let e=o;e<n;e+=l)for(let t=r;t<s;t+=l)p.push(new Th(e+h,t+h,h,i));let c=function(t){let o=0,r=0,n=0;var s=t[0];for(let t=0,e=s.length,i=e-1;t<e;i=t++){var a=s[t],l=s[i],h=a.x*l.y-l.x*a.y;r+=(a.x+l.x)*h,n+=(a.y+l.y)*h,o+=3*h}return new Th(r/o,n/o,0,t)}(i),u=p.length;for(;p.length;){const o=p.pop();(o.d>c.d||!c.d)&&(c=o,t&&console.log("found best %d after %d probes",Math.round(1e4*o.d)/1e4,u)),o.max-c.d<=e||(h=o.h/2,p.push(new Th(o.p.x-h,o.p.y-h,h,i)),p.push(new Th(o.p.x+h,o.p.y-h,h,i)),p.push(new Th(o.p.x-h,o.p.y+h,h,i)),p.push(new Th(o.p.x+h,o.p.y+h,h,i)),u+=4)}return t&&(console.log(`num probes: ${u}`),console.log(`best distance: ${c.d}`)),c.p}(i,16);S(i[0],new hh(o.x,o.y,0))}else if("LineString"===o.type)for(const i of o.geometry)S(i,new hh(i[0].x,i[0].y,0));else if("Point"===o.type)for(const i of o.geometry)for(const o of i)S([o],new hh(o.x,o.y,0))}(o,l,v,t,s,d,_,i,e,h)}l&&o.generateCollisionDebugBuffers(p,o.collisionBoxArray)}function Lh(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}const Oh=32640;function Rh(t,e,i,o,r,n,s,a,l,h,p,c,u,d,f){i=function(s,a,l,h,p,c,u){const d=l.layout.get("text-rotate").evaluate(p,{})*Math.PI/180,f=[];for(const _ of s.positionedLines)for(const l of _.positionedGlyphs)if(l.rect){const p=l.rect||{};let t=4,e=!0,i=1,o=0;var g=(h||u)&&l.vertical,y=l.metrics.advance*l.scale/2;if(u&&s.verticalizable){const s=(l.scale-1)*yl,a=(yl-l.metrics.width*l.scale)/2;o=_.lineOffset/2-(l.imageName?-a:s)}if(l.imageName){const _=c[l.imageName];e=_.sdf,i=_.pixelRatio,t=1/i}var m=h?[l.x+y,l.y]:[0,0];let r=h?[0,0]:[l.x+y+a[0],l.y+a[1]-o],n=[0,0];g&&(n=r,r=[0,0]);const v=(l.metrics.left-t)*l.scale-y+r[0],b=(-l.metrics.top-t)*l.scale+r[1],x=v+p.w*l.scale/(i*(l.localGlyph?2:1)),w=b+p.h*l.scale/(i*(l.localGlyph?2:1)),M=new z(v,b),P=new z(x,b),E=new z(v,w),S=new z(x,w);if(g){const _=new z(-y,y-$l),s=-Math.PI/2,a=12-y,h=new z(22-a,-(l.imageName?a:0)),p=new z(...n);M._rotateAround(s,_)._add(h)._add(p),P._rotateAround(s,_)._add(h)._add(p),E._rotateAround(s,_)._add(h)._add(p),S._rotateAround(s,_)._add(h)._add(p)}if(d){const _=Math.sin(d),s=Math.cos(d),a=[s,-_,_,s];M._matMult(a),P._matMult(a),E._matMult(a),S._matMult(a)}g=new z(0,0),y=new z(0,0);f.push({tl:M,tr:P,bl:E,br:S,tex:p,writingMode:s.writingMode,glyphOffset:m,sectionIndex:l.sectionIndex,isSDF:e,pixelOffsetTL:g,pixelOffsetBR:y,minFontScaleX:0,minFontScaleY:0})}return f}(i,a,r,n,s,o,t.allowVerticalPlacement),o=t.textSizeData;let g=null;"source"===o.kind?(g=[ml*r.layout.get("text-size").evaluate(s,{},f)],g[0]>Oh&&Z(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===o.kind&&(g=[ml*d.compositeTextSizes[0].evaluate(s,{},f),ml*d.compositeTextSizes[1].evaluate(s,{},f)],(g[0]>Oh||g[1]>Oh)&&Z(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,i,g,a,n,s,h,e,l.lineStartIndex,l.lineLength,u,f);for(const e of p)c[e]=t.text.placedSymbolArray.length-1;return 4*i.length}function Dh(t){for(const e in t)return t[e];return null}function kh(t,e,i,o,r,n,s,a){let l=n.top,h=n.bottom,p=n.left,c=n.right;n=n.collisionPadding;if(n&&(p-=n[0],l-=n[1],c+=n[2],h+=n[3]),a){const t=new z(p,l),e=new z(c,l),i=new z(p,h),o=new z(c,h),r=T(a);t._rotate(r),e._rotate(r),i._rotate(r),o._rotate(r),p=Math.min(t.x,e.x,i.x,o.x),c=Math.max(t.x,e.x,i.x,o.x),l=Math.min(t.y,e.y,i.y,o.y),h=Math.max(t.y,e.y,i.y,o.y)}return t.emplaceBack(e.x,e.y,p,l,c,h,s,i,o,r),t.length-1}function zh(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);t=t.bottom-t.top;return 0<t?Math.max(10,t):null}const Fh=Va.VectorTileFeature.types,Nh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Uh(t,e,i,o,r,n,s,a,l,h,p,c,u){var d=a?Math.min(Oh,Math.round(a[0])):0,a=a?Math.min(Oh,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*o),Math.round(32*r),n,s,(d<<1)+(l?1:0),a,16*h,16*p,256*c,256*u)}function Bh(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function jh(t){for(const e of t.sections)if(function(t){for(const e of t)if(vr(e.charCodeAt(0)))return 1}(e.text))return 1}class Zh{constructor(t){this.layoutVertexArray=new sn,this.indexArray=new dn,this.programConfigurations=t,this.segments=new ps,this.dynamicLayoutVertexArray=new an,this.opacityVertexArray=new ln,this.placedSymbolArray=new En}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,i,o){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,pl.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,cl.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Nh,!0),this.opacityVertexBuffer.itemSize=1),(i||o)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}zo("SymbolBuffers",Zh);class Gh{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new ps,this.collisionVertexArray=new un,this.collisionVertexArrayExt=new an}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,ul.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,dl.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}zo("CollisionBuffers",Gh);class Vh{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rs([]),this.placementViewportMatrix=Rs([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_l(this.zoom,e["text-size"]),this.iconSizeData=_l(this.zoom,e["icon-size"]);const i=this.layers[0].layout,o=i.get("symbol-sort-key"),r=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==o.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map(t=>Kl[t])),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.sourceID=t.sourceID}createArrays(){this.text=new Zh(new es(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Zh(new es(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new An,this.lineVertexArray=new Cn,this.symbolInstances=new Tn}calculateGlyphDependencies(e,i,o,r,n){for(let t=0;t<e.length;t++)if(i[e.charCodeAt(t)]=!0,(o||r)&&n){const o=xl[e.charAt(t)];o&&(i[o.charCodeAt(0)]=!0)}}populate(i,o,r){const n=this.layers[0],s=n.layout,a=s.get("text-font"),l=s.get("text-field"),h=s.get("icon-image"),p=("constant"!==l.value.kind||l.value.value instanceof ce&&!l.value.value.isEmpty()||0<l.value.value.toString().length)&&("constant"!==a.value.kind||0<a.value.value.length),c="constant"!==h.value.kind||!!h.value.value||0<Object.keys(h.parameters).length,u=s.get("symbol-sort-key");if(this.features=[],p||c){const f=o.iconDependencies,g=o.glyphDependencies,y=o.availableImages,t=new Or(this.zoom);for(const{feature:o,id:l,index:h,sourceLayerIndex:m}of i){const i=n._featureFilter.needGeometry,_=gs(o,i);if(n._featureFilter.filter(t,_,r)){let t,e;if(i||(_.geometry=fs(o)),p){const i=n.getValueAndResolveTokens("text-field",_,r,y),o=ce.factory(i);jh(o)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Pr||this.hasRTLText&&Lr.isParsed())&&(t=function(t,i,e){return t.sections.forEach(t=>{t.text=function(t,e){e=i.layout.get("text-transform").evaluate(e,{});return"uppercase"===e?t=t.toLocaleUpperCase():"lowercase"===e&&(t=t.toLocaleLowerCase()),t=Lr.applyArabicShaping?Lr.applyArabicShaping(t):t}(t.text,e)}),t}(o,n,_))}if(c){const i=n.getValueAndResolveTokens("icon-image",_,r,y);e=i instanceof ue?i:ue.fromString(i)}if(t||e){var d=this.sortFeaturesByKey?u.evaluate(_,{},r):void 0;if(this.features.push({id:l,text:t,icon:e,index:h,sourceLayerIndex:m,geometry:_.geometry,properties:o.properties,type:Fh[o.type],sortKey:d}),e&&(f[e.name]=!0),t){const i=a.evaluate(_,{},r).join(","),o="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&0<=this.writingModes.indexOf(Kl.vertical);for(const r of t.sections)if(r.image)f[r.image.name]=!0;else{const n=gr(t.toString()),s=r.fontStack||i,a=g[s]=g[s]||{};this.calculateGlyphDependencies(r.text,a,o,this.allowVerticalPlacement,n)}}}}}"line"===s.get("symbol-placement")&&(this.features=function(e){const r={},n={},s=[];let i=0;function o(t){s.push(e[t]),i++}function a(t,e,i){var o=n[t];return delete n[t],n[e]=o,s[o].geometry[0].pop(),s[o].geometry[0]=s[o].geometry[0].concat(i[0]),o}function l(t,e,i){var o=r[e];return delete r[e],r[t]=o,s[o].geometry[0].shift(),s[o].geometry[0]=i[0].concat(s[o].geometry[0]),o}function h(t,e,i){e=i?e[0][e[0].length-1]:e[0][0];return`${t}:${e.x}:${e.y}`}for(let t=0;t<e.length;t++){const u=e[t],d=u.geometry,f=u.text?u.text.toString():null;if(f){var p=h(f,d),c=h(f,d,!0);if(p in n&&c in r&&n[p]!==r[c]){const e=l(p,c,d),i=a(p,c,s[e].geometry);delete r[p],delete n[c],n[h(f,s[i].geometry,!0)]=i,s[e].geometry=null}else p in n?a(p,c,d):c in r?l(p,c,d):(o(t),r[p]=i-1,n[c]=i-1)}else o(t)}return s.filter(t=>t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((t,e)=>t.sortKey-e.sortKey)}}update(t,e,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,i),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,r){var t=this.lineVertexArray.length;if(void 0!==o.segment){let e=o.dist(r[o.segment+1]),i=o.dist(r[o.segment]);const n={};for(let t=o.segment+1;t<r.length;t++)n[t]={x:r[t].x,y:r[t].y,tileUnitDistanceFromAnchor:e},t<r.length-1&&(e+=r[t+1].dist(r[t]));for(let t=o.segment||0;0<=t;t--)n[t]={x:r[t].x,y:r[t].y,tileUnitDistanceFromAnchor:i},0<t&&(i+=r[t-1].dist(r[t]));for(let t=0;t<r.length;t++){const r=n[t];this.lineVertexArray.emplaceBack(r.x,r.y,r.tileUnitDistanceFromAnchor)}}return{lineStartIndex:t,lineLength:this.lineVertexArray.length-t}}addSymbols(e,i,o,t,r,n,s,a,l,h,p,c){const u=e.indexArray,d=e.layoutVertexArray,f=e.segments.prepareSegment(4*i.length,d,u,this.canOverlap?n.sortKey:void 0),g=this.glyphOffsetArray.length,y=f.vertexLength,m=this.allowVerticalPlacement&&s===Kl.vertical?Math.PI/2:0,_=n.text&&n.text.sections;for(let t=0;t<i.length;t++){const{tl:r,tr:s,bl:l,br:h,tex:p,pixelOffsetTL:g,pixelOffsetBR:y,minFontScaleX:v,minFontScaleY:b,glyphOffset:x,isSDF:w,sectionIndex:M}=i[t],P=f.vertexLength,E=x[1];Uh(d,a.x,a.y,r.x,E+r.y,p.x,p.y,o,w,g.x,g.y,v,b),Uh(d,a.x,a.y,s.x,E+s.y,p.x+p.w,p.y,o,w,y.x,g.y,v,b),Uh(d,a.x,a.y,l.x,E+l.y,p.x,p.y+p.h,o,w,g.x,y.y,v,b),Uh(d,a.x,a.y,h.x,E+h.y,p.x+p.w,p.y+p.h,o,w,y.x,y.y,v,b),Bh(e.dynamicLayoutVertexArray,a,m),u.emplaceBack(P,P+1,P+2),u.emplaceBack(P+1,P+2,P+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),t!==i.length-1&&M===i[t+1].sectionIndex||e.programConfigurations.populatePaintArrays(d.length,n,n.index,{},c,_&&_[M])}e.placedSymbolArray.emplaceBack(a.x,a.y,g,this.glyphOffsetArray.length-g,y,l,h,a.segment,o?o[0]:0,o?o[1]:0,t[0],t[1],s,0,!1,0,p,0)}_commitLayoutVertex(t,e,i,o,r){t.emplaceBack(e.x,e.y,i,o,Math.round(r.x),Math.round(r.y))}_addCollisionDebugVertices(t,e,i,o,r){const n=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),s=n.vertexLength,a=r.anchorX,l=r.anchorY;for(let t=0;t<4;t++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(e,-t.padding,-t.padding),i.collisionVertexArrayExt.emplaceBack(e,t.padding,-t.padding),i.collisionVertexArrayExt.emplaceBack(e,t.padding,t.padding),i.collisionVertexArrayExt.emplaceBack(e,-t.padding,t.padding),this._commitLayoutVertex(i.layoutVertexArray,o,a,l,new z(t.x1,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,o,a,l,new z(t.x2,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,o,a,l,new z(t.x2,t.y2)),this._commitLayoutVertex(i.layoutVertexArray,o,a,l,new z(t.x1,t.y2)),n.vertexLength+=4;const h=i.indexArray;h.emplaceBack(s,s+1),h.emplaceBack(s+1,s+2),h.emplaceBack(s+2,s+3),h.emplaceBack(s+3,s),n.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,r,n,s){for(let t=r;t<n;t++){const r=o.get(t),n=this.getSymbolInstanceTextSize(e,s,i,t);this._addCollisionDebugVertices(r,n,this.textCollisionBox,r.anchorPoint,s)}}_addIconDebugCollisionBoxes(e,i,o,r,n,s){for(let t=r;t<n;t++){const r=o.get(t),n=this.getSymbolInstanceIconSize(e,i,t);this._addCollisionDebugVertices(r,n,this.iconCollisionBox,r.anchorPoint,s)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Gh(pn,fl.members,vn),this.iconCollisionBox=new Gh(pn,fl.members,vn);var o=bl(this.iconSizeData,e),r=bl(this.textSizeData,e);for(let t=0;t<this.symbolInstances.length;t++){var n=this.symbolInstances.get(t);this._addTextDebugCollisionBoxes(r,e,i,n.textBoxStartIndex,n.textBoxEndIndex,n),this._addTextDebugCollisionBoxes(r,e,i,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n),this._addIconDebugCollisionBoxes(o,e,i,n.iconBoxStartIndex,n.iconBoxEndIndex,n),this._addIconDebugCollisionBoxes(o,e,i,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n)}}getSymbolInstanceTextSize(t,e,i,o){o=this.text.placedSymbolArray.get(0<=e.rightJustifiedTextSymbolIndex?e.rightJustifiedTextSymbolIndex:0<=e.centerJustifiedTextSymbolIndex?e.centerJustifiedTextSymbolIndex:0<=e.leftJustifiedTextSymbolIndex?e.leftJustifiedTextSymbolIndex:0<=e.verticalPlacedTextSymbolIndex?e.verticalPlacedTextSymbolIndex:o),o=vl(this.textSizeData,t,o)/yl;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,e,i){i=this.icon.placedSymbolArray.get(i),i=vl(this.iconSizeData,t,i);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(t,e,i){t.emplaceBack(e,-i,-i),t.emplaceBack(e,i,-i),t.emplaceBack(e,i,i),t.emplaceBack(e,-i,i)}_updateTextDebugCollisionBoxes(e,i,o,r,n,s){for(let t=r;t<n;t++){const r=o.get(t),n=this.getSymbolInstanceTextSize(e,s,i,t);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,r.padding)}}_updateIconDebugCollisionBoxes(e,i,o,r,n){for(let t=r;t<n;t++){const r=o.get(t),n=this.getSymbolInstanceIconSize(e,i,t);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,r.padding)}}updateCollisionDebugBuffers(e,i){if(this.hasDebugData()){this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();var o=bl(this.iconSizeData,e),r=bl(this.textSizeData,e);for(let t=0;t<this.symbolInstances.length;t++){var n=this.symbolInstances.get(t);this._updateTextDebugCollisionBoxes(r,e,i,n.textBoxStartIndex,n.textBoxEndIndex,n),this._updateTextDebugCollisionBoxes(r,e,i,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n),this._updateIconDebugCollisionBoxes(o,e,i,n.iconBoxStartIndex,n.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(o,e,i,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}}_deserializeCollisionBoxesForSymbol(e,i,o,r,n,s,a,l,h){const p={};for(let t=i;t<o;t++){const i=e.get(t);p.textBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},p.textFeatureIndex=i.featureIndex;break}for(let t=r;t<n;t++){const o=e.get(t);p.verticalTextBox={x1:o.x1,y1:o.y1,x2:o.x2,y2:o.y2,padding:o.padding,anchorPointX:o.anchorPointX,anchorPointY:o.anchorPointY},p.verticalTextFeatureIndex=o.featureIndex;break}for(let t=s;t<a;t++){const o=e.get(t);p.iconBox={x1:o.x1,y1:o.y1,x2:o.x2,y2:o.y2,padding:o.padding,anchorPointX:o.anchorPointX,anchorPointY:o.anchorPointY},p.iconFeatureIndex=o.featureIndex;break}for(let t=l;t<h;t++){const o=e.get(t);p.verticalIconBox={x1:o.x1,y1:o.y1,x2:o.x2,y2:o.y2,padding:o.padding,anchorPointX:o.anchorPointX,anchorPointY:o.anchorPointY},p.verticalIconFeatureIndex=o.featureIndex;break}return p}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){var i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return 0<this.text.segments.get().length}hasIconData(){return 0<this.icon.segments.get().length}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&0<this.textCollisionBox.segments.get().length}hasIconCollisionBoxData(){return this.hasDebugData()&&0<this.iconCollisionBox.segments.get().length}addIndicesForPlacedSymbol(e,i){var i=e.placedSymbolArray.get(i),o=i.vertexStartIndex+4*i.numGlyphs;for(let t=i.vertexStartIndex;t<o;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),o=[],r=[],n=[];for(let t=0;t<this.symbolInstances.length;++t){n.push(t);var s=this.symbolInstances.get(t);o.push(0|Math.round(e*s.anchorX+i*s.anchorY)),r.push(s.featureIndex)}return n.sort((t,e)=>o[t]-o[e]||r[e]-r[t]),n}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(1<this.text.segments.get().length||1<this.icon.segments.get().length)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach((t,e,i)=>{0<=t&&i.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)}),0<=e.verticalPlacedTextSymbolIndex&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),0<=e.placedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),0<=e.verticalPlacedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}zo("SymbolBucket",Vh,{omit:["layers","collisionBoxArray","features","compareText"]}),Vh.MAX_GLYPHS=65535,Vh.addDynamicAttributes=Bh;var _i=new Hr({"symbol-placement":new jr(zt.layout_symbol["symbol-placement"]),"symbol-spacing":new jr(zt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jr(zt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Zr(zt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jr(zt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jr(zt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new jr(zt.layout_symbol["icon-ignore-placement"]),"icon-optional":new jr(zt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jr(zt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Zr(zt.layout_symbol["icon-size"]),"icon-text-fit":new jr(zt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jr(zt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Zr(zt.layout_symbol["icon-image"]),"icon-rotate":new Zr(zt.layout_symbol["icon-rotate"]),"icon-padding":new jr(zt.layout_symbol["icon-padding"]),"icon-keep-upright":new jr(zt.layout_symbol["icon-keep-upright"]),"icon-offset":new Zr(zt.layout_symbol["icon-offset"]),"icon-anchor":new Zr(zt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jr(zt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jr(zt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jr(zt.layout_symbol["text-rotation-alignment"]),"text-field":new Zr(zt.layout_symbol["text-field"]),"text-font":new Zr(zt.layout_symbol["text-font"]),"text-size":new Zr(zt.layout_symbol["text-size"]),"text-max-width":new Zr(zt.layout_symbol["text-max-width"]),"text-line-height":new Zr(zt.layout_symbol["text-line-height"]),"text-letter-spacing":new Zr(zt.layout_symbol["text-letter-spacing"]),"text-justify":new Zr(zt.layout_symbol["text-justify"]),"text-radial-offset":new Zr(zt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jr(zt.layout_symbol["text-variable-anchor"]),"text-anchor":new Zr(zt.layout_symbol["text-anchor"]),"text-max-angle":new jr(zt.layout_symbol["text-max-angle"]),"text-writing-mode":new jr(zt.layout_symbol["text-writing-mode"]),"text-rotate":new Zr(zt.layout_symbol["text-rotate"]),"text-padding":new jr(zt.layout_symbol["text-padding"]),"text-keep-upright":new jr(zt.layout_symbol["text-keep-upright"]),"text-transform":new Zr(zt.layout_symbol["text-transform"]),"text-offset":new Zr(zt.layout_symbol["text-offset"]),"text-allow-overlap":new jr(zt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new jr(zt.layout_symbol["text-ignore-placement"]),"text-optional":new jr(zt.layout_symbol["text-optional"])}),Wh={paint:new Hr({"icon-opacity":new Zr(zt.paint_symbol["icon-opacity"]),"icon-color":new Zr(zt.paint_symbol["icon-color"]),"icon-halo-color":new Zr(zt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Zr(zt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Zr(zt.paint_symbol["icon-halo-blur"]),"icon-translate":new jr(zt.paint_symbol["icon-translate"]),"icon-translate-anchor":new jr(zt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Zr(zt.paint_symbol["text-opacity"]),"text-color":new Zr(zt.paint_symbol["text-color"],{runtimeType:Yt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Zr(zt.paint_symbol["text-halo-color"]),"text-halo-width":new Zr(zt.paint_symbol["text-halo-width"]),"text-halo-blur":new Zr(zt.paint_symbol["text-halo-blur"]),"text-translate":new jr(zt.paint_symbol["text-translate"]),"text-translate-anchor":new jr(zt.paint_symbol["text-translate-anchor"])}),layout:_i};class Hh{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Vt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}zo("FormatSectionOverride",Hh,{omit:["defaultValue"]});class qh extends as{constructor(t){super(t,Wh)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const i of t)e.indexOf(i)<0&&e.push(i);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,o){const r=this.layout.get(t).evaluate(e,{},i,o),n=this._unevaluatedLayout._values[t];return n.isDataDriven()||Bi(n.value)||!r?r:(s=e.properties,r.replace(/{([^{}]+)}/g,(t,e)=>e in s?String(s[e]):""));var s}createBucket(t){return new Vh(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of Wh.paint.overridableProperties){var t,e,i;qh.hasPaintOverride(this.layout,o)&&(t=this.paint.get(o),i=new Hh(t),e=new Ui(i,t.property.specification),i=null,i="constant"===t.value.kind||"source"===t.value.kind?new Zi("source",e):new Gi("composite",e,t.value.zoomStops,t.value._interpolationType),this.paint._values[o]=new Ur(t.property,i,t.parameters))}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&qh.hasPaintOverride(this.layout,t)}static hasPaintOverride(e,t){const i=e.get("text-field"),o=Wh.paint.properties[t];let r=!1;const n=t=>{for(const e of t)if(o.overrides&&o.overrides.hasOverride(e))return void(r=!0)};if("constant"===i.value.kind&&i.value.value instanceof ce)n(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{r||(t instanceof me&&ge(t.value)===Jt?n(t.value.sections):t instanceof xe?n(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramConfiguration(t){return new ts(this,t)}}var Yh={paint:new Hr({"background-color":new jr(zt.paint_background["background-color"]),"background-pattern":new Vr(zt.paint_background["background-pattern"]),"background-opacity":new jr(zt.paint_background["background-opacity"])})},Xh={paint:new Hr({"raster-opacity":new jr(zt.paint_raster["raster-opacity"]),"raster-hue-rotate":new jr(zt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jr(zt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jr(zt.paint_raster["raster-brightness-max"]),"raster-saturation":new jr(zt.paint_raster["raster-saturation"]),"raster-contrast":new jr(zt.paint_raster["raster-contrast"]),"raster-resampling":new jr(zt.paint_raster["raster-resampling"]),"raster-fade-duration":new jr(zt.paint_raster["raster-fade-duration"])})};class Kh extends as{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var $h={paint:new Hr({"sky-type":new jr(zt.paint_sky["sky-type"]),"sky-atmosphere-sun":new jr(zt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new jr(zt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new jr(zt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new jr(zt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Wr(zt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new jr(zt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new jr(zt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new jr(zt.paint_sky["sky-opacity"])})};function Jh(t,e,i){var o=Fs(0,0,1),r=Ws(Vs());return function(t,e,i){i*=.5;var o=e[0],r=e[1],n=e[2],s=e[3],e=Math.sin(i),i=Math.cos(i);t[0]=o*i-n*e,t[1]=r*i+s*e,t[2]=n*i+o*e,t[3]=s*i-r*e}(r,r,i?-T(t)+Math.PI:T(t)),Hs(r,r,-T(e)),Zs(o,o,r),js(o,o)}const Qh={circle:class extends as{constructor(t){super(t,Is)}createBucket(t){return new ms(t)}queryRadius(t){return Ss("circle-radius",this,t)+Ss("circle-stroke-width",this,t)+Ts(this.paint.get("circle-translate"))}queryIntersectsFeature(e,i,o,r,n,s,a,l){var h,p,c="map"===this.paint.get("circle-pitch-alignment");if(c&&e.queryGeometry.isAboveHorizon)return!1;const u=Cs(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),d=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),f=c?d*e.pixelToTileUnitsFactor:d;for(const i of r)for(const o of i){const i=o.add(u),r=l&&s.elevation?s.elevation.exaggeration()*l.getElevationAt(i.x,i.y,!0):0,n=c?i:(g=i,h=r,p=a,p=Gs([],[g.x,g.y,h,1],p),new z(p[0]/p[3],p[1]/p[3])),d=c?e.tilespaceRays.map(t=>function(t,e){var i=ks();return qs[2]=e,t.intersectsPlane(qs,Ys,i),new z(i[0],i[1])}(t,r)):e.queryGeometry.screenGeometry;let t=f;var g=Gs([],[o.x,o.y,r,1],a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?t*=g[3]/s.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(t*=s.cameraToCenterDistance/g[3]),h=d,p=n,g=t,Ps(h,p)||xs(p,h,g))return!0}return!1}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new ts(this,t)}},heatmap:class extends as{createBucket(t){return new Xs(t)}constructor(t){super(t,ea),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ia({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new ts(this,t)}},hillshade:class extends as{constructor(t){super(t,oa)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new ts(this,t)}},fill:class extends as{constructor(t){super(t,Ra)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new ts(this,t)}recalculate(t,e){super.recalculate(t,e);e=this.paint._values["fill-outline-color"];"constant"===e.value.kind&&void 0===e.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Oa(t)}queryRadius(){return Ts(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,o,r,n){return!t.queryGeometry.isAboveHorizon&&vs(As(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),n.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends as{constructor(t){super(t,Ka)}createBucket(t){return new Xa(t)}queryRadius(){return Ts(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new ts(this,t)}queryIntersectsFeature(t,e,i,o,r,n,s,a,l){const h=Cs(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),n.angle,t.pixelToTileUnitsFactor),p=this.paint.get("fill-extrusion-height").evaluate(e,i),c=this.paint.get("fill-extrusion-base").evaluate(e,i),u=[0,0],d=a&&n.elevation,f=n.elevation?n.elevation.exaggeration():1;if(d){const _=t.tile.getBucket(this).centroidVertexArray,v=l+1;if(v<_.length){const t=_.get(v);u[0]=t.a_centroid_pos0,u[1]=t.a_centroid_pos1}}if(0===u[0]&&1===u[1])return!1;const g=(m=o,e=c,i=p,l=h,o=s,s=d?a:null,a=u,n=n.center.lat,s?function(t,e,i,o,r,n,s,a,l){const h=[],p=[],c=[0,0,0,1];for(const T of t){const t=[],A=[];for(const h of T){const p=h.x+o.x,C=h.y+o.y,I=(u=p,d=C,f=e,g=i,m=s,v=l,S=E=P=M=w=x=b=void 0,P=(_=a)*(y=n).getElevationAt(u,d,!0,!0),E=0!==m[0],S=E?0===m[1]?_*(m[0]/7-450):_*(b=y,x=m,w=v,M=Math.floor(x[0]/8),u=Math.floor(x[1]/8),d=10*(x[0]-8*M),S=10*(x[1]-8*u),_=b.getElevationAt(M,u,!0,!0),y=b.getMeterToDEM(w),m=Math.floor(.5*(d*y-1)),v=Math.floor(.5*(S*y-1)),x=b.tileCoordToPixel(M,u),w=2*m+1,M=2*v+1,u=b,b=x.x-m,m=x.y-v,x=w,v=M,x=[u.getElevationAtPixel(b,m,!0),u.getElevationAtPixel(b+v,m,!0),u.getElevationAtPixel(b,m+v,!0),u.getElevationAtPixel(b+x,m+v,!0)],m=Math.abs(x[0]-x[1]),v=Math.abs(x[2]-x[3]),x=Math.abs(x[0]-x[2])+Math.abs(x[1]-x[3]),w=Math.min(.25,.5*y*(m+v)/w),M=Math.min(.25,.5*y*x/M),_+Math.max(w*d,M*S)):P,{base:P+(0===f)?-1:f,top:E?Math.max(S+g,P+f+2):P+g});c[0]=p,c[1]=C,c[2]=I.base,c[3]=1,Gs(c,c,r),c[3]=Math.max(c[3],1e-5);P=Qa([c[0]/c[3],c[1]/c[3],c[2]/c[3]]);c[0]=p,c[1]=C,c[2]=I.top,c[3]=1,Gs(c,c,r),c[3]=Math.max(c[3],1e-5);g=Qa([c[0]/c[3],c[1]/c[3],c[2]/c[3]]);t.push(P),A.push(g)}h.push(t),p.push(A)}var u,d,f,g,y,m,_,v,b,x,w,M,P,E,S;return[h,p]}(m,e,i,l,o,s,a,f,n):function(t,e,i,o,r){const n=[],s=[],a=r[8]*e,l=r[9]*e,h=r[10]*e,p=r[11]*e,c=r[8]*i,u=r[9]*i,d=r[10]*i,f=r[11]*i;for(const e of t){const t=[],i=[];for(const n of e){const e=n.x+o.x,s=n.y+o.y,g=r[0]*e+r[4]*s+r[12],y=r[1]*e+r[5]*s+r[13],m=r[2]*e+r[6]*s+r[14],_=r[3]*e+r[7]*s+r[15],v=g+a,b=y+l,x=m+h,w=Math.max(_+p,1e-5),M=g+c,P=y+u,E=m+d,S=Math.max(_+f,1e-5),T=new z(v/w,b/w);T.z=x/w,t.push(T);const A=new z(M/S,P/S);A.z=E/S,i.push(A)}n.push(t),s.push(i)}return[n,s]}(m,e,i,l,o)),y=t.queryGeometry;var m;return function(e,i,o){let r=1/0;vs(o,i)&&(r=Ja(o,i[0]));for(let t=0;t<i.length;t++){var n=i[t],s=e[t];for(let t=0;t<n.length-1;t++){const i=n[t],a=[i,n[t+1],s[t+1],s[t],i];_s(o,a)&&(r=Math.min(r,Ja(o,a)))}}return r!==1/0&&r}(g[0],g[1],y.isPointQuery()?y.screenBounds:y.screenGeometry)}},line:class extends as{constructor(t){super(t,al),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof qe,this.gradientVersion=(this.gradientVersion+1)%o}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=ll.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new sl(t)}getProgramIds(){var t=this.paint.get("line-dasharray"),e=this.paint.get("line-pattern").constantOr(1),i=this.paint.get("line-gradient");return[e?"linePattern":t?"lineSDF":i?"lineGradient":"line"]}getProgramConfiguration(t){return new ts(this,t)}queryRadius(t){var e=t,t=hl(Ss("line-width",this,e),Ss("line-gap-width",this,e)),e=Ss("line-offset",this,e);return t/2+Math.abs(e)+Ts(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,o,r,n){if(t.queryGeometry.isAboveHorizon)return!1;var s=As(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),n.angle,t.pixelToTileUnitsFactor),n=t.pixelToTileUnitsFactor/2*hl(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),i=this.paint.get("line-offset").evaluate(e,i);return function(e,i,o){for(let t=0;t<i.length;t++){var r=i[t];if(3<=e.length)for(let t=0;t<r.length;t++)if(Ps(e,r[t]))return!0;if(function(e,i,o){if(1<e.length){if(bs(e,i))return 1;for(let t=0;t<i.length;t++)if(xs(i[t],e,o))return 1}for(let t=0;t<e.length;t++)if(xs(e[t],i,o))return 1}(e,r,o))return!0}return!1}(s,o=i?function(e,i){const o=[],r=new z(0,0);for(let t=0;t<e.length;t++){const n=e[t],s=[];for(let t=0;t<n.length;t++){const o=n[t-1],z=n[t],a=n[t+1],l=0===t?r:z.sub(o)._unit()._perp(),h=t===n.length-1?r:a.sub(z)._unit()._perp(),p=l._add(h)._unit();p._mult(1/(p.x*h.x+p.y*h.y)),s.push(p._mult(i)._add(z))}o.push(s)}return o}(o,i*t.pixelToTileUnitsFactor):o,n)}isTileClipped(){return!0}},symbol:qh,background:class extends as{constructor(t){super(t,Yh)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends as{constructor(t){super(t,Xh)}getProgramIds(){return["raster"]}},sky:class extends as{constructor(t){super(t,$h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ia({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){t=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}}getCenter(t,e){const i=this.paint.get("sky-type");if("atmosphere"===i){const i=this.paint.get("sky-atmosphere-sun"),o=!i,r=t.style.light,n=r.properties.get("position");return o&&"viewport"===r.properties.get("anchor")&&Z("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),o?Jh(n.azimuthal,90-n.polar,e):Jh(i[0],90-i[1],e)}if("gradient"===i){const t=this.paint.get("sky-gradient-center");return Jh(t[0],90-t[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){var t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}},{HTMLImageElement:tp,HTMLCanvasElement:ep,HTMLVideoElement:ip,ImageData:op,ImageBitmap:rp}=c;class np{constructor(t,e,i,o){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,o)}update(t,e,i){const{width:o,height:r}=t,n=!(this.size&&this.size[0]===o&&this.size[1]===r||i),{context:s}=this,{gl:a}=s;if(this.useMipmap=Boolean(e&&e.useMipmap),a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!e||!1!==e.premultiply)),n)this.size=[o,r],t instanceof tp||t instanceof ep||t instanceof ip||t instanceof op||rp&&t instanceof rp?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,t):a.texImage2D(a.TEXTURE_2D,0,this.format,o,r,0,this.format,a.UNSIGNED_BYTE,t.data);else{const{x:e,y:n}=i||{x:0,y:0};t instanceof tp||t instanceof ep||t instanceof ip||t instanceof op||rp&&t instanceof rp?a.texSubImage2D(a.TEXTURE_2D,0,e,n,a.RGBA,a.UNSIGNED_BYTE,t):a.texSubImage2D(a.TEXTURE_2D,0,e,n,o,r,a.RGBA,a.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&a.generateMipmap(a.TEXTURE_2D)}bind(t,e,i){const{context:o}=this,{gl:r}=o;r.bindTexture(r.TEXTURE_2D,this.texture),i!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class sp{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof lp?new lp(t.lng,t.lat):lp.convert(t),this}setSouthWest(t){return this._sw=t instanceof lp?new lp(t.lng,t.lat):lp.convert(t),this}extend(t){const e=this._sw,i=this._ne;let o,r;if(t instanceof lp)o=t,r=t;else{if(!(t instanceof sp))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(sp.convert(t)):this.extend(lp.convert(t)):this;if(o=t._sw,r=t._ne,!o||!r)return this}return e||i?(e.lng=Math.min(o.lng,e.lng),e.lat=Math.min(o.lat,e.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new lp(o.lng,o.lat),this._ne=new lp(r.lng,r.lat)),this}getCenter(){return new lp((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new lp(this.getWest(),this.getNorth())}getSouthEast(){return new lp(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){var{lng:e,lat:t}=lp.convert(t);let i=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=t&&t<=this._ne.lat&&i}static convert(t){return!t||t instanceof sp?t:new sp(t)}}const ap=6371008.8;class lp{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new lp(f(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){var e=Math.PI/180,i=this.lat*e,o=t.lat*e,e=Math.sin(i)*Math.sin(o)+Math.cos(i)*Math.cos(o)*Math.cos((t.lng-this.lng)*e);return ap*Math.acos(Math.min(e,1))}toBounds(t=0){var e=360*t/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new sp(new lp(this.lng-t,this.lat-e),new lp(this.lng+t,this.lat+e))}static convert(t){if(t instanceof lp)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new lp(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new lp(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const hp=2*Math.PI*ap;function pp(t){return hp*Math.cos(t*Math.PI/180)}function cp(t){return(180+t)/360}function up(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function dp(t,e){return t/pp(e)}function fp(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function gp(t,e){return t*pp(fp(e))}class yp{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){t=lp.convert(t);return new yp(cp(t.lng),up(t.lat),dp(e,t.lat))}toLngLat(){return new lp(360*this.x-180,fp(this.y))}toAltitude(){return gp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/hp*(t=fp(this.y),1/Math.cos(t*Math.PI/180));var t}}class mp{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new Qs({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){e=this.getKey(t,e);return this.positions[e]}trim(){var t=this.width,e=this.height=x(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(e,t,i){const o=[];let r=e.length%2==1?-e[e.length-1]*i:0,n=e[0]*i,s=!0;o.push({left:r,right:n,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;var l=e[t];r=a*i,a+=l,n=a*i,o.push({left:r,right:n,isDash:s,zeroLength:0===l})}return o}addRoundDash(n,t,s){var a=t/2;for(let r=-s;r<=s;r++){var l=this.width*(this.nextRow+s+r);let i=0,o=n[i];for(let e=0;e<this.width;e++){1<e/o.right&&(o=n[++i]);var h=Math.abs(e-o.left),p=Math.abs(e-o.right),h=Math.min(h,p);let t;p=r/s*(1+a);if(o.isDash){const n=a-Math.abs(p);t=Math.sqrt(h*h+n*n)}else t=a-Math.sqrt(h*h+p*p);this.image.data[l+e]=Math.max(0,Math.min(255,t+128))}}}addRegularDash(e,i){for(let t=e.length-1;0<=t;--t){const o=e[t],r=e[t+1];o.zeroLength?e.splice(t,1):r&&r.isDash===o.isDash&&(r.left=o.left,e.splice(t,1))}const o=e[0],r=e[e.length-1];o.isDash===r.isDash&&(o.left=r.left-this.width,r.right=o.right+this.width);var n=this.width*this.nextRow;let s=0,a=e[s];for(let t=0;t<this.width;t++){1<t/a.right&&(a=e[++s]);const r=Math.abs(t-a.left),l=Math.abs(t-a.right),h=Math.min(r,l);this.image.data[n+t]=Math.max(0,Math.min(255,(a.isDash?h:-h)+i+128))}}addDash(e,t){const i=this.getKey(e,t);if(this.positions[i])return this.positions[i];const o="round"===t,r=o?7:0,n=2*r+1;if(this.nextRow+n>this.height)return Z("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let t=0;t<e.length;t++)e[t]<0&&(Z("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),s+=e[t];if(0!==s){const i=this.width/s,n=this.getDashRanges(e,this.width,i);o?this.addRoundDash(n,i,r):this.addRegularDash(n,"square"===t?.5*i:0)}t=this.nextRow+r;this.nextRow+=n;t={tl:[t,r],br:[s,0]};return this.positions[i]=t}}zo("LineAtlas",mp);class _p{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const vp=c.performance;function bp(t){t=t?t.url.toString():void 0;return vp.getEntriesByName(t)}class xp{constructor(){this.tasks={},this.taskQueue=[],M(["process"],this),this.invoker=new _p(this.process),this.nextId=0}add(t,e){const i=this.nextId++,o=([{type:r,isSymbolTile:n,zoom:s}]=[e],s=s||0,"message"===r?0:"maybePrepare"!==r||n?"parseTile"!==r||n?"parseTile"===r&&n?300-s:"maybePrepare"===r&&n?400-s:500:200-s:100-s);var r,n,s;return 0==o?(L(),t(),{cancel:()=>{}}):(this.tasks[i]={fn:t,metadata:e,priority:o,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}})}process(){L();{if(this.taskQueue=this.taskQueue.filter(t=>!!this.tasks[t]),!this.taskQueue.length)return;var t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}}pick(){let e=null,i=1/0;for(let t=0;t<this.taskQueue.length;t++){var o=this.tasks[this.taskQueue[t]];o.priority<i&&(i=o.priority,e=t)}if(null===e)return null;var t=this.taskQueue[e];return this.taskQueue.splice(e,1),t}remove(){this.invoker.remove()}}function wp(t,e,i){i=2*Math.PI*6378137/256/Math.pow(2,i);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}class Mp{constructor(t,e,i){this.z=t,this.x=e,this.y=i,this.key=Sp(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){var i,o,r,r=(o=this.y,n=this.z,r=wp(256*(i=this.x),256*(o=Math.pow(2,n)-o-1),n),n=wp(256*(i+1),256*(1+o),n),r[0]+","+r[1]+","+n[0]+","+n[1]),n=function(e,i,o){let r,n="";for(let t=e;0<t;t--)r=1<<t-1,n+=(i&r?1:0)+(o&r?2:0);return n}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("wmts"===e?this.y-Math.pow(2,this.z-2):"tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)}url4bd(t,e){var i=this.z,o=Math.pow(2,this.z-1),r=this.x-o;r<0&&(r="-"+-r);o=this.y-o+1;return 0<o?o="-"+o:o<0&&(o=-o),t[0].replace("{z}",i).replace("{x}",r).replace("{y}",o)}getTilePoint(t){var e=Math.pow(2,this.z);return new z((t.x*e-this.x)*cs,(t.y*e-this.y)*cs)}getTileVec3(t){var e=Math.pow(2,this.z);return Fs((t.x*e-this.x)*cs,(t.y*e-this.y)*cs,gp(t.z,t.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pp{constructor(t,e){this.wrap=t,this.canonical=e,this.key=Sp(t,e.z,e.z,e.x,e.y)}}class Ep{constructor(t,e,i,o,r){this.overscaledZ=t,this.wrap=e,this.canonical=new Mp(i,+o,+r),this.key=0===e&&t===i?this.canonical.key:Sp(e,t,i,o,r)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){var e=this.canonical.z-t;return t>this.canonical.z?new Ep(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ep(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return Sp(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);var i=this.canonical.z-t;return Sp(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}isChildOf(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new Ep(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,i=2*this.canonical.x,t=2*this.canonical.y;return[new Ep(e,this.wrap,e,i,t),new Ep(e,this.wrap,e,1+i,t),new Ep(e,this.wrap,e,i,1+t),new Ep(e,this.wrap,e,1+i,1+t)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ep(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ep(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new yp(t.x-this.wrap,t.y))}getTileVec3(t){return this.canonical.getTileVec3(new yp(t.x-this.wrap,t.y,t.z))}}function Sp(t,e,i,o,r){var n=1<<Math.min(i,22);let s=r%n*n+o%n;return t&&i<22&&(s+=n*n*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*s+i)+(e-i)}zo("CanonicalTileID",Mp),zo("OverscaledTileID",Ep,{omit:["projMatrix"]});class Tp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){var i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class Ap{constructor(t,e,i,o,r){this.type="Feature",(this._vectorTileFeature=t)._z=e,t._x=i,t._y=o,this.properties=t.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}_i=$r([{name:"a_pos",type:"Int16",components:2}]);class Cp{constructor(t,e,i){this.tileID=t,this.uid=y++,this.uses=0,this.tileSize=e,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){t+=this.timeAdded;t<B.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(t,e,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const o of t){const t=o.layerIds.map(t=>e.getLayer(t)).filter(Boolean);if(0!==t.length){o.layers=t,o.stateDependentLayerIds&&(o.stateDependentLayers=o.stateDependentLayerIds.map(e=>t.filter(t=>t.id===e)[0]));for(const e of t)i[e.id]=o}}return i}(t.buckets,e.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const e=this.buckets[t];if(e instanceof Vh){if(this.hasSymbolBuckets=!0,!i)break;e.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const e=this.buckets[t];if(e instanceof Vh&&e.hasRTLText){this.hasRTLText=!0,Lr.isLoading()||Lr.isLoaded()||"deferred"!==Pr||Ir();break}}this.queryPadding=0;for(const t in this.buckets){const i=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(t).queryRadius(i))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Mn}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new np(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new np(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new np(t,this.lineAtlas.image,e.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,i,o,r,n,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:o,pixelPosMatrix:s,transform:n,params:r},t,e,i):{}}querySourceFeatures(e,t){const i=this.latestFeatureIndex;if(i&&i.rawTileData){const o=i.loadVTLayers(),r=t?t.sourceLayer:"",n=o._geojsonTileLayer||o[r];if(n){const s=to(t&&t.filter),{z:a,x:l,y:h}=this.tileID.canonical,p={z:a,x:l,y:h};for(let t=0;t<n.length;t++){const o=n.feature(t);if(s.needGeometry){const e=gs(o,!0);if(!s.filter(new Or(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!s.filter(new Or(this.tileID.overscaledZ),o))continue;const c=i.getId(o,r),u=new Ap(o,a,l,h,c);u.tile=p,e.push(u)}}}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const i=O(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;var o;this.expirationTime>e?t=!1:i&&!(this.expirationTime<i)&&(o=this.expirationTime-i)?this.expirationTime=e+Math.max(o,3e4):t=!0,t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var i=this.latestFeatureIndex.loadVTLayers();for(const o in this.buckets)if(e.style.hasLayer(o)){const r=this.buckets[o],n=r.layers[0].sourceLayer||"_geojsonTileLayer",s=i[n],a=t[n];if(s&&a&&0!==Object.keys(a).length){r.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(o);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<B.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=B.now()+t}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const o of e)if(t[o])return!0}return!1}clearQueryDebugViz(){}}class Ip{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,e,i){var o=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][o]=this.stateChanges[t][o]||{},v(this.stateChanges[t][o],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==o&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][o]){this.deletedStates[t][o]={};for(const e in this.state[t][o])i[e]||(this.deletedStates[t][o][e]=null)}else for(const e in i)this.deletedStates[t]&&this.deletedStates[t][o]&&null===this.deletedStates[t][o][e]&&delete this.deletedStates[t][o][e]}removeFeatureState(t,e,i){if(null!==this.deletedStates[t]){var o=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][o]&&(this.deletedStates[t][o]=this.deletedStates[t][o]||{},this.deletedStates[t][o][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][o])for(i in this.deletedStates[t][o]={},this.stateChanges[t][o])this.deletedStates[t][o][i]=null;else this.deletedStates[t][o]=null;else this.deletedStates[t]=null}}getState(t,e){const i=String(e),o=v({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const i=this.deletedStates[t][e];if(null===i)return{};for(const t in i)delete o[t]}return o}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,e){const i={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const e={};for(const i in this.stateChanges[t])this.state[t][i]||(this.state[t][i]={}),v(this.state[t][i],this.stateChanges[t][i]),e[i]=this.state[t][i];i[t]=e}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const e={};if(null===this.deletedStates[t])for(const i in this.state[t])e[i]={},this.state[t][i]={};else for(const i in this.deletedStates[t]){if(null===this.deletedStates[t][i])this.state[t][i]={};else for(const e of Object.keys(this.deletedStates[t][i]))delete this.state[t][i][e];e[i]=this.state[t][i]}i[t]=i[t]||{},v(i[t],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const o in t)t[o].setFeatureState(i,e)}}class Lp{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){e=this.toIdx(t,e);return{min:this.minimums[e],max:this.maximums[e]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function Op(o,r,n,s){let a=0,l=Number.MAX_VALUE;for(let i=0;i<3;i++)if(Math.abs(s[i])<1e-15){if(n[i]<o[i]||n[i]>r[i])return null}else{var h=1/s[i];let t=(o[i]-n[i])*h,e=(r[i]-n[i])*h;if(t>e){const o=t;t=e,e=o}if(t>a&&(a=t),e<l&&(l=e),a>l)return null}return a}function Rp(t,e,i,o,r,n,s,a,l,h,p){var c=o-t,u=r-e,d=n-i,f=s-t,o=a-e,r=l-i,n=p[1]*r-p[2]*o,s=p[2]*f-p[0]*r,a=p[0]*o-p[1]*f,l=c*n+u*s+d*a;if(Math.abs(l)<1e-15)return null;l=1/l,t=h[0]-t,e=h[1]-e,i=h[2]-i,s=(t*n+e*s+i*a)*l;if(s<0||1<s)return null;a=e*d-i*u,d=i*c-t*d,c=t*u-e*c,p=(p[0]*a+p[1]*d+p[2]*c)*l;return p<0||1<s+p?null:(f*a+o*d+r*c)*l}function Dp(t,e,i){return(t-e)/(i-e)}function kp(t,e,i,o,r,n,s,a,l){var h=1<<i,p=n-o,i=s-r,n=(t+1)/h*p+o,s=(e+0)/h*i+r,r=(e+1)/h*i+r;a[0]=(t+0)/h*p+o,a[1]=s,l[0]=n,l[1]=r}class zp{constructor(t){var e,i;this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],this.dem&&(t=(e=function(e){const t=Math.ceil(Math.log2(e.dim/8)),i=[];let o=Math.ceil(Math.pow(2,t));const r=1/o,n=(t,e,i,o,r)=>{var n=o?1:0,s=(t+1)*i-n,o=e*i,n=(e+1)*i-n;r[0]=t*i,r[1]=o,r[2]=s,r[3]=n};let s=new Lp(o);var a=[];for(let t=0;t<o*o;t++){n(t%o,Math.floor(t/o),r,!1,a);const i=Np(a[0],a[1],e),l=Np(a[2],a[1],e),h=Np(a[2],a[3],e),p=Np(a[0],a[3],e);s.minimums.push(Math.min(i,l,h,p)),s.maximums.push(Math.max(i,l,h,p)),s.leaves.push(1)}for(i.push(s),o/=2;1<=o;o/=2){const e=i[i.length-1];s=new Lp(o);for(let t=0;t<o*o;t++){n(t%o,Math.floor(t/o),2,!0,a);const i=e.getElevation(a[0],a[1]),r=e.getElevation(a[2],a[1]),c=e.getElevation(a[2],a[3]),u=e.getElevation(a[0],a[3]),d=e.isLeaf(a[0],a[1]),f=e.isLeaf(a[2],a[1]),g=e.isLeaf(a[2],a[3]),y=e.isLeaf(a[0],a[3]),m=Math.min(i.min,r.min,c.min,u.min),_=Math.max(i.max,r.max,c.max,u.max),v=d&&f&&g&&y;s.maximums.push(_),s.minimums.push(m),s.leaves.push(_-m<=5&&v?1:0)}i.push(s)}return i}(this.dem))[i=e.length-1],this._addNode(t.minimums[0],t.maximums[0],t.leaves[0]),this._construct(e,0,0,i,0))}raycastRoot(t,e,i,o,r,n,s=1){return Op([t,e,-100],[i,o,this.maximums[0]*s],r,n)}raycast(r,e,t,n,s,a,l=1){if(!this.nodeCount)return null;const h=this.raycastRoot(r,e,t,n,s,a,l);if(null==h)return null;const p=[],c=[],u=[],d=[],i=[{idx:0,t:h,nodex:0,nodey:0,depth:0}];for(;0<i.length;){const{idx:h,t:o,nodex:g,nodey:y,depth:m}=i.pop();if(this.leaves[h]){kp(g,y,m,r,e,t,n,u,d);const h=1<<m,p=(g+0)/h,c=(g+1)/h,i=(y+0)/h,_=(y+1)/h,v=Np(p,i,this.dem)*l,b=Np(c,i,this.dem)*l,x=Np(c,_,this.dem)*l,w=Np(p,_,this.dem)*l,M=Rp(u[0],u[1],v,d[0],u[1],b,d[0],d[1],x,s,a),P=Rp(d[0],d[1],x,u[0],d[1],w,u[0],u[1],v,s,a),E=Math.min(null!==M?M:Number.MAX_VALUE,null!==P?P:Number.MAX_VALUE);if(E!==Number.MAX_VALUE)return E;{const r=Bs([],s,a,o);if(Fp(v,b,w,x,Dp(r[0],u[0],d[0]),Dp(r[1],u[1],d[1]))>=r[2])return o}}else{let o=0;for(let i=0;i<this._siblingOffset.length;i++){kp((g<<1)+this._siblingOffset[i][0],(y<<1)+this._siblingOffset[i][1],m+1,r,e,t,n,u,d),u[2]=-100,d[2]=this.maximums[this.childOffsets[h]+i]*l;var f=Op(u,d,s,a);if(null!=f){const r=f;p[i]=r;let e=!1;for(let t=0;t<o&&!e;t++)r>=p[c[t]]&&(c.splice(t,0,i),e=!0);e||(c[o]=i),o++}}for(let t=0;t<o;t++){const e=c[t];i.push({idx:this.childOffsets[h]+e,t:p[e],nodex:(g<<1)+this._siblingOffset[e][0],nodey:(y<<1)+this._siblingOffset[e][1],depth:m+1})}}}return null}_addNode(t,e,i){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(o,r,n,s,a){if(1!==o[s].isLeaf(r,n)){this.childOffsets[a]||(this.childOffsets[a]=this.nodeCount);const l=s-1,h=o[l];let e,i=0;for(let t=0;t<this._siblingOffset.length;t++){const s=2*r+this._siblingOffset[t][0],a=2*n+this._siblingOffset[t][1],l=h.getElevation(s,a),p=h.isLeaf(s,a),c=this._addNode(l.min,l.max,p);p&&(i|=1<<t),e=e||c}for(let t=0;t<this._siblingOffset.length;t++)i&1<<t||this._construct(o,2*r+this._siblingOffset[t][0],2*n+this._siblingOffset[t][1],l,e+t)}}}function Fp(t,e,i,o,r,n){return Ye(Ye(t,i,n),Ye(e,o,n),r)}function Np(t,e,i){var o=i.dim,r=d(t*o-.5,0,o-1),n=d(e*o-.5,0,o-1),s=Math.floor(r),t=Math.floor(n),e=Math.min(s+1,o-1),o=Math.min(t+1,o-1);return Fp(i.get(s,t),i.get(e,t),i.get(s,o),i.get(e,o),r-s,n-t)}const Up={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Bp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,i,o=!1,r=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return Z(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;var n=this.dim=e.height-2;if(this.data=new Uint32Array(e.data.buffer),this.encoding=i||"mapbox",!(this.borderReady=o)){for(let t=0;t<n;t++)this.data[this._idx(-1,t)]=this.data[this._idx(0,t)],this.data[this._idx(n,t)]=this.data[this._idx(n-1,t)],this.data[this._idx(t,-1)]=this.data[this._idx(t,0)],this.data[this._idx(t,n)]=this.data[this._idx(t,n-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(n,-1)]=this.data[this._idx(n-1,0)],this.data[this._idx(-1,n)]=this.data[this._idx(0,n-1)],this.data[this._idx(n,n)]=this.data[this._idx(n-1,n-1)],r&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new zp(this)}get(t,e,i=!1){var o=new Uint8Array(this.data.buffer);i&&(t=d(t,-1,this.dim),e=d(e,-1,this.dim));e=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(o[e],o[1+e],o[2+e])}static getUnpackVector(t){return Up[t]}get unpackVector(){return Up[this.encoding]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}_unpackMapbox(t,e,i){return(256*t*256+256*e+i)/10-1e4}_unpackTerrarium(t,e,i){return 256*t+e+i/256-32768}static pack(t,e){const i=[0,0,0,0],o=Bp.getUnpackVector(e);t=Math.floor((t+o[3])/o[2]);return i[2]=t%256,t=Math.floor(t/256),i[1]=t%256,t=Math.floor(t/256),i[0]=t,i}getPixels(){return new ta({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,t,e){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let o=t*this.dim,r=t*this.dim+this.dim,n=e*this.dim,s=e*this.dim+this.dim;switch(t){case-1:o=r-1;break;case 1:r=o+1}switch(e){case-1:n=s-1;break;case 1:s=n+1}var a=-t*this.dim,l=-e*this.dim;for(let e=n;e<s;e++)for(let t=o;t<r;t++)this.data[this._idx(t,e)]=i.data[this._idx(t+a,e+l)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}zo("DEMData",Bp),zo("DemMinMaxQuadTree",zp,{omit:["dem"]});class jp{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){var o=t.wrapped().key;void 0===this.data[o]&&(this.data[o]=[]);const r={value:e,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout(()=>{this.remove(t,r)},i)),this.data[o].push(r),this.order.push(o),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){t=this.data[t];return t?t[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;var i=t.wrapped().key,t=void 0===e?0:this.data[i].indexOf(e),e=this.data[i][t];return this.data[i].splice(t,1),e.timeout&&clearTimeout(e.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(e.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const o of this.data[i])t(o.value)||e.push(o);for(const t of e)this.remove(t.value.tileID,t)}}class Zp{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}Zp.ReadOnly=!1,Zp.ReadWrite=!0,Zp.disabled=new Zp(519,Zp.ReadOnly,[0,1]);class Gp{constructor(t,e,i,o,r,n){this.test=t,this.ref=e,this.mask=i,this.fail=o,this.depthFail=r,this.pass=n}}Gp.disabled=new Gp({func:519,mask:0},0,0,7680,7680,7680);class Vp{constructor(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i}}Vp.disabled=new Vp(Vp.Replace=[1,0],le.transparent,[!1,!1,!1,!1]),Vp.unblended=new Vp(Vp.Replace,le.transparent,[!0,!0,!0,!0]),Vp.alphaBlended=new Vp([1,771],le.transparent,[!0,!0,!0,!0]);class Wp{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}Wp.disabled=new Wp(!1,1029,2305),Wp.backCCW=new Wp(!0,1029,2305),Wp.backCW=new Wp(!0,1029,2304),Wp.frontCW=new Wp(!0,1028,2304),Wp.frontCCW=new Wp(!0,1028,2305);class Hp extends kt{constructor(t,e,i){super(),this.id=t,this._onlySymbols=i,e.on("data",t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),e.on("error",()=>{this._sourceErrored=!0}),this._source=e,this._tiles={},this._cache=new jp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ip}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){var t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){var t;this._paused&&(t=this._shouldReloadOnResume,this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform))}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager)}}getIds(){return _(this._tiles).map(t=>t.tileID).sort(qp).map(t=>t.key)}getRenderableIds(t){const e=[];for(const i in this._tiles)this._isIdRenderable(+i,t)&&e.push(this._tiles[i]);return t?e.sort((t,e)=>{var i=t.tileID,o=e.tileID,t=new z(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),e=new z(o.canonical.x,o.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-o.overscaledZ||e.y-t.y||e.x-t.x}).map(t=>t.tileID.key):e.map(t=>t.tileID).sort(qp).map(t=>t.key)}hasRenderableParent(t){t=this.findLoadedParent(t,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))}_tileLoaded(t,e,i,o){if(o)return t.state="errored",void(404!==o.status?this._source.fire(new Dt(o,{tile:t})):this.update(this.transform));t.timeAdded=B.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Rt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let t=0;t<i.length;t++){var o=i[t];if(e.neighboringTiles&&e.neighboringTiles[o]){const i=this.getTileByID(o);r(e,i),r(i,e)}}function r(e,i){if(e.dem&&!e.dem.borderReady){e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let t=i.tileID.canonical.x-e.tileID.canonical.x;var o=i.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),n=i.tileID.key;0===t&&0==o||1<Math.abs(o)||(1<Math.abs(t)&&(1===Math.abs(t+r)?t+=r:1===Math.abs(t-r)&&(t-=r)),i.dem&&e.dem&&(e.dem.backfillBorder(i.dem,t,o),e.neighboringTiles&&e.neighboringTiles[n]&&(e.neighboringTiles[n].backfilled=!0)))}}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(o,r,t,n){for(const e in this._tiles){let i=this._tiles[e];if(!(n[e]||!i.hasData()||i.tileID.overscaledZ<=r||i.tileID.overscaledZ>t)){let t=i.tileID;for(;i&&i.tileID.overscaledZ>r+1;){const o=i.tileID.scaledTo(i.tileID.overscaledZ-1);i=this._tiles[o.key],i&&i.hasData()&&(t=o)}let e=t;for(;e.overscaledZ>r;)if(e=e.scaledTo(e.overscaledZ-1),o[e.key]){n[t.key]=t;break}}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){var t=this._loadedParentTiles[e.key];return t&&t.tileID.overscaledZ>=i?t:null}for(let t=e.overscaledZ-1;t>=i;t--){const i=e.scaledTo(t),o=this._getLoadedTile(i);if(o)return o}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey((this._source.reparseOverscaled?t.wrapped():t.canonical).key)}updateCacheSize(t,e){e=e||this._source.tileSize;var i=Math.ceil(t.width/e)+1,e=Math.ceil(t.height/e)+1,e=Math.floor(i*e*5),e="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,e):e;this._cache.setMaxSize(e)}handleWrapJump(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const o=this._tiles[i];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+e),t[o.tileID.key]=o}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(e,i,o){if(this.transform=e,this._sourceLoaded&&!this._paused&&!this.transform.freezeTileCoverage&&(!this.usedForTerrain||o)){let t;this.updateCacheSize(e,i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?t=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new Ep(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)):(t=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(t=t.filter(t=>this._source.hasTile(t)))):t=[];const n=this._updateRetainedTiles(t);if(Yp(this._source.type)&&0!==t.length){const e={},i={},o=Object.keys(n);for(const t of o){const o=n[t],s=this._tiles[t];var r;!s||s.fadeEndTime&&s.fadeEndTime<=B.now()||((r=this.findLoadedParent(o,Math.max(o.overscaledZ-Hp.maxOverzooming,this._source.minzoom)))&&(this._addTile(r.tileID),e[r.tileID.key]=r.tileID),i[t]=o)}const s=t[t.length-1].overscaledZ;for(const e in this._tiles){const o=this._tiles[e];if(!n[e]&&o.hasData()){let t=o.tileID;for(;t.overscaledZ>s;){t=t.scaledTo(t.overscaledZ-1);const s=this._tiles[t.key];if(s&&s.hasData()&&i[t.key]){n[e]=o.tileID;break}}}}for(const i in e)n[i]||(this._coveredTiles[i]=!0,n[i]=e[i])}for(const e in n)this._tiles[e].clearFadeHold();const s=function(t,e){const i=[];for(const o in t)o in e||i.push(o);return i}(this._tiles,n);for(const e of s){const i=this._tiles[e];i.hasSymbolBuckets&&!i.holdingForFade()?i.setHoldDuration(this.map._fadeDuration):i.hasSymbolBuckets&&!i.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const o={};if(0===t.length)return o;const r={},n=t[t.length-1].overscaledZ,e=t[0].overscaledZ,s=Math.max(e-Hp.maxOverzooming,this._source.minzoom),i=Math.max(e+Hp.maxUnderzooming,this._source.minzoom),a={};for(const r of t){const t=this._addTile(r);o[r.key]=r,t.hasData()||n<this._source.maxzoom&&(a[r.key]=r)}this._retainLoadedChildren(a,n,i,o);for(const n of t){let i=this._tiles[n.key];if(!i.hasData()){if(n.canonical.z>=this._source.maxzoom){const t=n.children(this._source.maxzoom)[0],r=this.getTile(t);if(r&&r.hasData()){o[t.key]=t;continue}}else{const t=n.children(this._source.maxzoom);if(o[t[0].key]&&o[t[1].key]&&o[t[2].key]&&o[t[3].key])continue}let e=i.wasRequested();for(let t=n.overscaledZ-1;t>=s;--t){const s=n.scaledTo(t);if(r[s.key])break;if(r[s.key]=!0,i=this.getTile(s),!i&&e&&(i=this._addTile(s)),i&&(o[s.key]=s,e=i.wasRequested(),i.hasData()))break}}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const r=[];let t,e=this._tiles[o].tileID;for(;0<e.overscaledZ;){if(e.key in this._loadedParentTiles){t=this._loadedParentTiles[e.key];break}r.push(e.key);var i=e.scaledTo(e.overscaledZ-1);if(t=this._getLoadedTile(i),t)break;e=i}for(const n of r)this._loadedParentTiles[n]=t}}_addTile(t){let e=this._tiles[t.key];if(e)return e;e=this._cache.getAndRemove(t),e&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));var i=Boolean(e);return i||(e=new Cp(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))),e?(e.uses++,this._tiles[t.key]=e,i||this._source.fire(new Rt("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);e=e.getExpiryTimeout();e&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},e))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),0<e.uses||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._cache.reset()}tilesIn(t,e,i){const o=[],r=this.transform;if(!r)return o;for(const s in this._tiles){const a=this._tiles[s];var n;i&&a.clearQueryDebugViz(),a.holdingForFade()||(n=t.containsTile(a,r,e))&&o.push(n)}return o}getVisibleCoordinates(t){t=this.getRenderableIds(t).map(t=>this._tiles[t].tileID);for(const e of t)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(Yp(this._source.type))for(const e in this._tiles){var t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=B.now())return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const o=this._tiles[t];o&&o.setDependencies(e,i)}reloadTilesForDependencies(e,i){for(const t in this._tiles)this._tiles[t].hasDependency(e,i)&&this._reloadTile(+t,"reloading");this._cache.filter(t=>!t.hasDependency(e,i))}}function qp(t,e){var i=Math.abs(2*t.wrap)-(t.wrap<0),o=Math.abs(2*e.wrap)-(e.wrap<0);return t.overscaledZ-e.overscaledZ||o-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Yp(t){return"raster"===t||"image"===t||"video"===t}Hp.maxOverzooming=10,Hp.maxUnderzooming=3;class Xp{constructor(t,e,i){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=i}static create(t,e,i){var o=i||t.findDEMTileFor(e);if(o&&o.dem){var r=o.dem,i=o.tileID,t=1<<e.canonical.z-i.canonical.z;return new Xp(o,o.tileSize/cs/t,[(e.canonical.x/t-i.canonical.x)*r.dim,(e.canonical.y/t-i.canonical.y)*r.dim])}}tileCoordToPixel(t,e){e=e*this._scale+this._offset[1],t=Math.floor(t*this._scale+this._offset[0]),e=Math.floor(e);return new z(t,e)}getElevationAt(t,e,i,o){const r=t*this._scale+this._offset[0],n=e*this._scale+this._offset[1],s=Math.floor(r),a=Math.floor(n),l=this._dem;return o=!!o,i?Ye(Ye(l.get(s,a,o),l.get(s,a+1,o),n-a),Ye(l.get(s+1,a,o),l.get(s+1,a+1,o),n-a),r-s):l.get(s,a,o)}getElevationAtPixel(t,e,i){return this._dem.get(t,e,!!i)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*dp(1,t)*this._dem.stride}}class Kp{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Lo(cs,16,0),this.featureIndexArray=new Ln,this.promoteId=e}insert(t,e,i,o,r,n=0){var s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,o,r,n);const a=this.grid;for(let t=0;t<e.length;t++){const i=e[t],o=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];o[0]=Math.min(o[0],e.x),o[1]=Math.min(o[1],e.y),o[2]=Math.max(o[2],e.x),o[3]=Math.max(o[3],e.y)}o[0]<cs&&o[1]<cs&&0<=o[2]&&0<=o[3]&&a.insert(s,o[0],o[1],o[2],o[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Va.VectorTile(new Pl(this.rawTileData)).layers,this.sourceLayerCoder=new Tp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,e,i,o){this.loadVTLayers();const s=n.params||{},a=to(s.filter),l=n.tileResult,t=n.transform,h=l.bufferedTilespaceBounds,r=this.grid.query(h.min.x,h.min.y,h.max.x,h.max.y,(t,e,i,o)=>Es(l.bufferedTilespaceGeometry,t,e,i,o));r.sort(Jp);let p=null;t.elevation&&0<r.length&&(p=Xp.create(t.elevation,this.tileID));var c={};let u;for(let t=0;t<r.length;t++){const h=r[t];if(h!==u){u=h;var d=this.featureIndexArray.get(h);let r=null;this.loadMatchingFeature(c,d,a,s.layers,s.availableImages,e,i,o,(t,e,i,o=0)=>(r=r||fs(t),e.queryIntersectsFeature(l,t,i,r,this.z,n.transform,n.pixelPosMatrix,p,o)))}}return c}loadMatchingFeature(e,t,i,o,r,n,s,a,l){const{featureIndex:h,bucketIndex:p,sourceLayerIndex:c,layoutVertexArrayOffset:u}=t,d=this.bucketLayerIDs[p];if(!o||function(e,i){for(let t=0;t<e.length;t++)if(0<=i.indexOf(e[t]))return 1}(o,d)){const y=this.sourceLayerCoder.decode(c),m=this.vtLayers[y].feature(h);if(i.needGeometry){const e=gs(m,!0);if(!i.filter(new Or(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!i.filter(new Or(this.tileID.overscaledZ),m))return;var f=this.getId(m,y);for(let t=0;t<d.length;t++){const i=d[t];if(!(o&&o.indexOf(i)<0)){const p=n[i];if(p){let t={};void 0!==f&&a&&(t=a.getState(p.sourceLayer||"_geojsonTileLayer",f));const y=v({},s[i]);y.paint=$p(y.paint,p.paint,m,t,r),y.layout=$p(y.layout,p.layout,m,t,r);var g=!l||l(m,p,t,u);if(g){const _=new Ap(m,this.z,this.x,this.y,f);_.layer=y;let t=e[i];void 0===t&&(t=e[i]=[]),t.push({featureIndex:h,feature:_,intersectionZ:g})}}}}}}lookupSymbolFeatures(t,e,i,o,r,n,s,a){var l={};this.loadVTLayers();var h=to(r);for(const r of t)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:o,featureIndex:r,layoutVertexArrayOffset:0},h,n,s,a,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;return this.promoteId&&(i=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof i&&(i=Number(i))),i}}function $p(t,o,r,n,s){return E(t,(t,e)=>{const i=o instanceof Br?o.get(e):null;return i&&i.evaluate?i.evaluate(r,n,s):i})}function Jp(t,e){return e-t}zo("FeatureIndex",Kp,{omit:["rawTileData","sourceLayerCoder"]});class Qp{constructor(t){const e={},i=[];for(const o in t){const r=t[o],n=e[o]={};for(const t in r){const e=r[+t];if(e&&0!==e.bitmap.width&&0!==e.bitmap.height){const o=e.metrics.localGlyph?2:1,l={x:0,y:0,w:e.bitmap.width+2*o,h:e.bitmap.height+2*o};i.push(l),n[t]={rect:l,metrics:e.metrics}}}}const{w:o,h:r}=ql(i),n=new Qs({width:o||1,height:r||1});for(const i in t){const o=t[i];for(const t in o){const r=o[+t];var s,a;r&&0!==r.bitmap.width&&0!==r.bitmap.height&&(s=e[i][t].rect,a=r.metrics.localGlyph?2:1,Qs.copy(r.bitmap,n,{x:0,y:0},{x:s.x+a,y:s.y+a},r.bitmap))}}this.image=n,this.positions=e}}zo("GlyphAtlas",Qp);class tc{constructor(t){this.tileID=new Ep(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile}parse(i,t,o,r,n){this.status="parsing",this.data=i,this.collisionBoxArray=new Mn;const s=new Tp(Object.keys(i.layers).sort()),a=new Kp(this.tileID,this.promoteId);a.bucketLayerIDs=[];const l={},h=new mp(256,256),p={featureIndex:a,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:h,availableImages:o},c=t.familiesBySource[this.source];for(const m in c){const r=i.layers[m];if(r){let t=!1,e=!1;for(const i of c[m])"symbol"===i[0].type?t=!0:e=!0;if((!0!==this.isSymbolTile||t)&&(!1!==this.isSymbolTile||e)){1===r.version&&Z(`Vector tile source "${this.source}" layer "${m}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const u=s.encode(m),d=[];for(let t=0;t<r.length;t++){const o=r.feature(t),n=a.getId(o,m);d.push({feature:o,id:n,index:t,sourceLayerIndex:u})}for(const i of c[m]){const m=i[0];void 0!==this.isSymbolTile&&"symbol"===m.type!==this.isSymbolTile||m.minzoom&&this.zoom<Math.floor(m.minzoom)||m.maxzoom&&this.zoom>=m.maxzoom||"none"!==m.visibility&&(ec(i,this.zoom,o),(l[m.id]=m.createBucket({index:a.bucketLayerIDs.length,layers:i,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:u,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(d,p,this.tileID.canonical),a.bucketLayerIDs.push(i.map(t=>t.id)))}}}}let u,d,f,g;h.trim();var e={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},t=E(p.glyphDependencies,t=>Object.keys(t).map(Number));Object.keys(t).length?r.send("getGlyphs",{uid:this.uid,stacks:t},(t,e)=>{u||(u=t,d=e,y.call(this))},void 0,!1,e):d={};t=Object.keys(p.iconDependencies);t.length?r.send("getImages",{icons:t,source:this.source,tileID:this.tileID,type:"icons"},(t,e)=>{u||(u=t,f=e,y.call(this))},void 0,!1,e):f={};t=Object.keys(p.patternDependencies);function y(){if(u)return n(u);if(d&&f&&g){var t=new Qp(d),e=new Xl(f,g);for(const i in l){const n=l[i];n instanceof Vh?(ec(n.layers,this.zoom,o),Ih(n,d,t.positions,f,e.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):n.hasPattern&&(n instanceof sl||n instanceof Oa||n instanceof Xa)&&(ec(n.layers,this.zoom,o),n.addFeatures(p,this.tileID.canonical,e.patternPositions))}this.status="done",n(null,{buckets:_(l).filter(t=>!t.isEmpty()),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:h,imageAtlas:e,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?t.positions:null})}}t.length?r.send("getImages",{icons:t,source:this.source,tileID:this.tileID,type:"patterns"},(t,e)=>{u||(u=t,g=e,y.call(this))},void 0,!1,e):g={},y.call(this)}}function ec(t,e,i){var o=new Or(e);for(const e of t)e.recalculate(o,i)}class ic{constructor(t){this.entries={},this.scheduler=t}request(i,o,t,e){const r=this.entries[i]=this.entries[i]||{callbacks:[]};if(r.result){const[i,t]=r.result;return this.scheduler?this.scheduler.add(()=>{e(i,t)},o):e(i,t),()=>{}}return r.callbacks.push(e),r.cancel||(r.cancel=t((t,e)=>{r.result=[t,e];for(const i of r.callbacks)this.scheduler?this.scheduler.add(()=>{i(t,e)},o):i(t,e);setTimeout(()=>delete this.entries[i],3e3)})),()=>{r.result||(r.callbacks=r.callbacks.filter(t=>t!==e),r.callbacks.length||(r.cancel(),delete this.entries[i]))}}}function oc(e,t,n){const i=JSON.stringify(e.request),s=e.request.url;let a=!1;return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},r=>{const t=Pt(e.request,(t,e,i,o)=>{var p;t?r(t):e&&(p=e?e.byteLength:0,"minedata"===function(t,e){for(var i="",o=p-8;o<e;){var r,n,s,a=t[o],l=null,h=239<a?4:223<a?3:191<a?2:1;if(e<o+h)break;1===h?a<128&&(l=a):2===h?128==(192&(r=t[o+1]))&&(l=(31&a)<<6|63&r)<=127&&(l=null):3===h?(n=t[o+2],128==(192&(r=t[o+1]))&&128==(192&n)&&((l=(15&a)<<12|(63&r)<<6|63&n)<=2047||55296<=l&&l<=57343)&&(l=null)):4===h&&(n=t[o+2],s=t[o+3],128==(192&(r=t[o+1]))&&128==(192&n)&&128==(192&s)&&((l=(15&a)<<18|(63&r)<<12|(63&n)<<6|63&s)<=65535||1114112<=l)&&(l=null)),null===l?(l=65533,h=1):65535<l&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),o+=h}return i}(t=new Uint8Array(e),p).toLowerCase()&&(function(t,e){var i=t.length-8;if(i<=e)for(var o=0;o<i/2;o++){var r=t[o];t[o]=t[i-o-1],t[i-o-1]=r}else for(var n=parseInt(i/e),s=parseInt(e/2),a=0;a<n;a++)for(var l=a*e,h=(a+1)*e-1,p=l,c=0;p<l+s;p++,c++){var u=h-c,d=t[p];t[p]=t[u],t[u]=d}}(t,function(t){for(var e=0,i=t.length,o=0;o<i;o++)e+=t.charCodeAt(o);return parseInt(e/i)}(rc(s,"token")||rc(s,"appKey")||"25cc55a69ea7422182d00d6b7c0ffa93")),e=e.slice(0,p-8),a=!0),r(null,{vectorTile:n&&!a?void 0:new Va.VectorTile(new Pl(e)),rawData:e,cacheControl:i,expires:o}))});return()=>{t.cancel(),r()}},t)}function rc(t,e){if(-1<t.indexOf("?"))for(var i=t.split("?")[1].split("&"),o=0;o<i.length;o++){var r=i[o].split("=");if(r[0]==e)return r[1]}return null}t.ARRAY_TYPE=Ls,t.AUTH_ERR_MSG=$,t.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},M(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=L()?t:c,this.scheduler=new xp}send(t,e,i,o,r=!1,n){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=n,this.callbacks[s]=i);n=N(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:t,hasCallback:!!i,targetMapId:o,mustQueue:r,sourceMapId:this.mapId,data:Uo(e,n)},n),{cancel:()=>{i&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[i];delete this.cancelCallbacks[i],t&&t.cancel()}else if(e.mustQueue||L()){const t=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),t&&t.metadata||{type:"message"})}else this.processTask(i,e)}processTask(i,t){if("<response>"===t.type){const e=this.callbacks[i];delete this.callbacks[i],e&&(t.error?e(Bo(t.error)):e(null,Bo(t.data)))}else{const o=N(this.globalScope)?void 0:[],r=t.hasCallback?(t,e)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:t?Uo(t):null,data:Uo(e,o)},o)}:t=>{},n=Bo(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,n,r);else if(this.parent.getWorkerSource){const i=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,i[0],n.source)[i[1]](n,r)}else r(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.CanonicalTileID=Mp,t.Color=le,t.ColorMode=Vp,t.CullFaceMode=Wp,t.DEMData=Bp,t.DataConstantProperty=jr,t.DedupedRequest=ic,t.DepthMode=Zp,t.EXTENT=cs,t.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){null==e&&(e=null);const o=this._source();if(!o)return e;if(t.y<0||1<t.y)return e;var r=o.getSource().maxzoom,n=1<<r,s=Math.floor(t.x),a=t.x-s,n=new Ep(r,s,r,Math.floor(a*n),Math.floor(t.y*n)),n=this.findDEMTileFor(n);if(!n||!n.dem)return e;const l=n.dem,h=1<<n.tileID.canonical.z,p=(a*h-n.tileID.canonical.x)*l.dim,c=(t.y*h-n.tileID.canonical.y)*l.dim,u=Math.floor(p),d=Math.floor(c);return(i?this.exaggeration():1)*Ye(Ye(l.get(u,d),l.get(u,d+1),c-d),Ye(l.get(u+1,d),l.get(u+1,d+1),c-d),p-u)}getAtTileOffset(t,e,i){var o=1<<t.canonical.z;return this.getAtPointOrZero(new yp(t.wrap+(t.canonical.x+e/cs)/o,(t.canonical.y+i/cs)/o))}getForTilePoints(t,e,i,o){const r=Xp.create(this,t,o);return!!r&&(e.forEach(t=>{t[2]=this.exaggeration()*r.getElevationAt(t[0],t[1],i)}),!0)}getMinMaxForTile(e){var t=this.findDEMTileFor(e);if(!t||!t.dem)return null;var i=t.dem.tree,o=t.tileID,t=1<<e.canonical.z-o.canonical.z;let r=e.canonical.x/t-o.canonical.x,n=e.canonical.y/t-o.canonical.y,s=0;for(let t=0;t<e.canonical.z-o.canonical.z&&!i.leaves[s];t++){r*=2,n*=2;const e=2*Math.floor(n)+Math.floor(r);s=i.childOffsets[s]+e,r%=1,n%=1}return{min:this.exaggeration()*i.minimums[s],max:this.exaggeration()*i.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},t.ErrorEvent=Dt,t.EvaluationParameters=Or,t.Event=Rt,t.Evented=kt,t.GlyphManager=xh,t.ImagePosition=Yl,t.LineAtlas=mp,t.LngLat=lp,t.LngLatBounds=sp,t.LocalGlyphMode=bh,t.MAX_SAFE_INTEGER=o,t.MercatorCoordinate=yp,t.ONE_EM=yl,t.OverscaledTileID=Ep,t.Properties=Hr,t.RGBAImage=ta,t.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){var t=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",K,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!J(t))return t;const i=et(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!J(t))return t;const i=et(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!J(t))return t;const i=et(t);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,o){const r=et(t);return J(t)?(r.path=`/styles/v1${r.path}/sprite${e}${i}`,this._makeAPIURL(r,this._customAccessToken||o)):(r.path+=`${e}${i}`,it(r))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!J(t))return t;const o=et(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==o.authority&&512===i?"@2x":""}${V.supported?".webp":"$1"}`),"raster"===o.authority?o.path=`/${G.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${G.TILE_URL_VERSION}${o.path}`);i=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(o.params)||G.ACCESS_TOKEN;return G.REQUIRE_ACCESS_TOKEN&&i&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,i)}canonicalizeTileURL(t,e){const i=et(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let o="mapbox://";i.path.match(/^\/raster\/v1\//)?o+=`raster/${i.path.replace(`/${G.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${i.path.replace(`/${G.TILE_URL_VERSION}/`,"")}`;let r=i.params;return e&&(r=r.filter(t=>!t.match(/^access_token=/))),r.length&&(o+=`?${r.join("&")}`),o}canonicalizeTileset(t,e){const i=!!e&&J(e),o=[];for(const e of t.tiles||[])Q(e)?o.push(this.canonicalizeTileURL(e,i)):o.push(e);return o}_makeAPIURL(t,e){var i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",o=et(G.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,"http"===t.protocol){const e=t.params.indexOf("secure");0<=e&&t.params.splice(e,1)}if("/"!==o.path&&(t.path=`${o.path}${t.path}`),!G.REQUIRE_ACCESS_TOKEN)return it(t);if(e=e||G.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(t=>-1===t.indexOf("access_token")),t.params.push(`access_token=${e||""}`),it(t)}},t.ResourceType=bt,t.SegmentVector=ps,t.SourceCache=Hp,t.StencilMode=Gp,t.StructArrayLayout1ui2=bn,t.StructArrayLayout2f1f2i16=cn,t.StructArrayLayout2i4=Qr,t.StructArrayLayout2ui4=vn,t.StructArrayLayout3f12=an,t.StructArrayLayout3ui6=dn,t.StructArrayLayout4i8=tn,t.Texture=np,t.Tile=Cp,t.Transitionable=kr,t.Uniform1f=Gn,t.Uniform1i=class extends Zn{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.Uniform2f=class extends Zn{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.Uniform3f=class extends Zn{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.Uniform4f=Vn,t.UniformColor=Wn,t.UniformMatrix3f=class extends Zn{constructor(t,e){super(t,e),this.current=qn}set(e){for(let t=0;t<9;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix3fv(this.location,!1,e);break}}},t.UniformMatrix4f=class extends Zn{constructor(t,e){super(t,e),this.current=Hn}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},t.UnwrappedTileID=Pp,t.ValidationError=Ft,t.VectorTileWorkerSource=class extends kt{constructor(t,e,i,o,r){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=r||oc,this.loading={},this.loaded={},this.deduped=new ic(t.scheduler),this.isSpriteLoaded=o,this.scheduler=t.scheduler}loadTile(s,a){const l=s.uid,h=s&&s.request,p=h&&h.collectResourceTiming,c=this.loading[l]=new tc(s);c.abort=this.loadVectorData(s,(t,e)=>{var i=!this.loading[l];if(delete this.loading[l],i||t||!e)return c.status="done",i||(this.loaded[l]=c),a(t);const o=e.rawData,r={};e.expires&&(r.expires=e.expires),e.cacheControl&&(r.cacheControl=e.cacheControl),c.vectorTile=e.vectorTile||new Va.VectorTile(new Pl(o));const n=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(t,e)=>{if(t||!e)return a(t);const i={};if(p){const t=bp(h);0<t.length&&(i.resourceTiming=JSON.parse(JSON.stringify(t)))}a(null,v({rawTileData:o.slice(0)},e,r,i))})};this.isSpriteLoaded?n():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(n,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):n()}),this.loaded=this.loaded||{},this.loaded[l]=c})}reloadTile(t,o){const e=this.loaded,i=t.uid,r=this;if(e&&e[i]){const n=e[i];n.showCollisionBoxes=t.showCollisionBoxes,n.enableTerrain=!!t.enableTerrain;t=(t,e)=>{var i=n.reloadCallback;i&&(delete n.reloadCallback,n.parse(n.vectorTile,r.layerIndex,this.availableImages,r.actor,i)),o(t,e)};"parsing"===n.status?n.reloadCallback=t:"done"===n.status&&(n.vectorTile?n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor,t):t())}}abortTile(t,e){const i=t.uid,o=this.loading[i];o&&(o.abort&&o.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,o=t.uid;i&&i[o]&&delete i[o],e()}},t.WritingMode=Kl,t.ZoomHistory=jo,t.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},t.addDynamicAttributes=Bh,t.altitudeFromMercatorZ=gp,t.asyncAll=g,t.bezier=p,t.bindAll=M,t.bufferConvexPolygon=function(e,i){const o=[];for(let t=0;t<e.length;t++){const r=f(t-1,-1,e.length-1),n=f(t+1,-1,e.length-1),s=e[t],a=e[n],l=e[r].sub(s).unit(),h=a.sub(s).unit(),p=h.angleWithSep(l.x,l.y),c=l.add(h).unit().mult(-1*i/Math.sin(p/2));o.push(s.add(c))}return o},t.cacheEntryPossiblyAdded=function(t){vt++,vt>yt&&(t.getActor().send("enforceCacheSizeLimit",gt),vt=0)},t.clamp=d,t.clearTileCache=function(t){const e=c.caches.delete(ut);t&&e.catch(t).then(()=>t())},t.clipLine=gh,t.clone=function(t){var e=new Ls(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.clone$1=function(t){var e=new Ls(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$2=A,t.collisionCircleLayout=gl,t.config=G,t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.create=ks,t.create$1=function(){var t=new Ls(16);return Ls!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$2=Os,t.createCommonjsModule=se,t.createExpression=ji,t.createFilter=to,t.createLayout=$r,t.createStyleLayer=function(t){return new("custom"===t.type?Kh:Qh[t.type])(t)},t.cross=function(t,e,i){var o=e[0],r=e[1],n=e[2],s=i[0],e=i[1],i=i[2];return t[0]=r*i-n*e,t[1]=n*s-o*i,t[2]=o*e-r*s,t},t.degToRad=T,t.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=u,t.easeCubicInOut=h,t.emitValidationErrors=Io,t.endsWith=P,t.enforceCacheSizeLimit=function(o){mt(),dt&&dt.then(i=>{i.keys().then(e=>{for(let t=0;t<e.length-o;t++)i.delete(e[t])})})},t.evaluateSizeForFeature=vl,t.evaluateSizeForZoom=bl,t.evaluateVariableOffset=Ch,t.evented=Ar,t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},t.exported=B,t.exported$1=V,t.extend=v,t.filterObject=S,t.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},t.fromQuat=function(t,e){var i=e[0],o=e[1],r=e[2],n=e[3],s=i+i,a=o+o,l=r+r,h=i*s,p=o*s,e=o*a,i=r*s,o=r*a,r=r*l,s=n*s,a=n*a,l=n*l;return t[0]=1-e-r,t[1]=p+l,t[2]=i-a,t[3]=0,t[4]=p-l,t[5]=1-h-r,t[6]=o+s,t[7]=0,t[8]=i+a,t[9]=o-s,t[10]=1-h-e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e);return t[0]=e,t[1]=i,t[2]=0,t[3]=-i,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.furthestTileCorner=function(t){t=Math.round((t+45+360)%360/90)%4;return l[t]},t.getAABBPointSquareDist=function(e,i,o){let r=0;for(let t=0;t<2;++t){var n=o?o[t]:0;e[t]>n&&(r+=(e[t]-n)*(e[t]-n)),i[t]<n&&(r+=(n-i[t])*(n-i[t]))}return r},t.getAnchorAlignment=ah,t.getAnchorJustification=Lh,t.getBounds=function(t){let e=1/0,i=1/0,o=-1/0,r=-1/0;for(const z of t)e=Math.min(e,z.x),i=Math.min(i,z.y),o=Math.max(o,z.x),r=Math.max(r,z.y);return{min:new z(e,i),max:new z(o,r)}},t.getDefaultExportFromCjs=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t},t.getImage=It,t.getJSON=function(t,e){return Mt(v(t,{type:"json"}),e)},t.getMapSessionAPI=pt,t.getPerformanceMeasurement=bp,t.getRTLTextPluginStatus=Cr,t.getReferrer=wt,t.getVideo=function(e,t){const i=c.document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let t=0;t<e.length;t++){const o=c.document.createElement("source");!function(t){const e=c.document.createElement("a");return e.href=t,e.protocol===c.document.location.protocol&&e.host===c.document.location.host}(e[t])&&(i.crossOrigin="Anonymous"),o.src=e[t],i.appendChild(o)}return{cancel:()=>{}}},t.identity=Rs,t.identity$1=Ws,t.invert=function(t,e){var i=e[0],o=e[1],r=e[2],n=e[3],s=e[4],a=e[5],l=e[6],h=e[7],p=e[8],c=e[9],u=e[10],d=e[11],f=e[12],g=e[13],y=e[14],m=e[15],_=i*a-o*s,v=i*l-r*s,b=i*h-n*s,x=o*l-r*a,w=o*h-n*a,M=r*h-n*l,P=p*g-c*f,E=p*y-u*f,S=p*m-d*f,T=c*y-u*g,A=c*m-d*g,C=u*m-d*y,e=_*C-v*A+b*T+x*S-w*E+M*P;return e?(t[0]=(a*C-l*A+h*T)*(e=1/e),t[1]=(r*A-o*C-n*T)*e,t[2]=(g*M-y*w+m*x)*e,t[3]=(u*w-c*M-d*x)*e,t[4]=(l*S-s*C-h*E)*e,t[5]=(i*C-r*S+n*E)*e,t[6]=(y*b-f*M-m*v)*e,t[7]=(p*M-u*b+d*v)*e,t[8]=(s*A-a*S+h*P)*e,t[9]=(o*S-i*A-n*P)*e,t[10]=(f*w-g*b+m*_)*e,t[11]=(c*b-p*w-d*_)*e,t[12]=(a*E-s*T-l*P)*e,t[13]=(i*T-o*E+r*P)*e,t[14]=(g*v-f*x-y*_)*e,t[15]=(p*x-c*v+u*_)*e,t):null},t.isMapAuthenticated=function(t){return ct.has(t)},t.isMapboxURL=J,t.latFromMercatorY=fp,t.len=Fn,t.length=zs,t.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},t.loadVectorTile=oc,t.makeRequest=Mt,t.mercatorXfromLng=cp,t.mercatorYfromLat=up,t.mercatorZfromAltitude=dp,t.mul=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},t.mul$1=bi,t.mul$2=xi,t.multiply=Ds,t.multiply$1=Us,t.nextPowerOfTwo=x,t.normalize=js,t.normalize$1=function(t,e){var i=e[0],o=e[1],r=e[2],n=e[3],e=i*i+o*o+r*r+n*n;return 0<e&&(e=1/Math.sqrt(e)),t[0]=i*e,t[1]=o*e,t[2]=r*e,t[3]=n*e,t},t.number=Ye,t.ortho=function(t,e,i,o,r,n,s){var a=1/(e-i),l=1/(o-r),h=1/(n-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*a,t[13]=(r+o)*l,t[14]=(s+n)*h,t[15]=1,t},t.pbf=Pl,t.perspective=function(t,e,i,o,r){var e=1/Math.tan(e/2);return t[0]=e/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+o)*(e=1/(o-r)),t[14]=2*r*o*e):(t[10]=-1,t[14]=-2*o),t},t.pick=function(e,i){const o={};for(let t=0;t<i.length;t++){var r=i[t];r in e&&(o[r]=e[r])}return o},t.plugin=Lr,t.pointGeometry=z,t.polygonIntersectsBox=Es,t.polygonIntersectsPolygon=_s,t.polygonizeBounds=function(t,e,i=0,o=!0){const r=new z(i,i),n=t.sub(r),s=e.add(r),a=[n,new z(s.x,n.y),s,new z(n.x,s.y)];return o&&a.push(n),a},t.posAttributes=_i,t.postMapLoadEvent=lt,t.postTurnstileEvent=st,t.potpack=ql,t.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.radToDeg=function(t){return t*a},t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.registerForPluginStateChange=function(t){return t({pluginStatus:Pr,pluginURL:Er}),Ar.on("pluginStateChange",t),t},t.removeAuthState=function(t){ct.delete(t)},t.renderColorRamp=ia,t.rotateX=function(t,e,i){var o=Math.sin(i),r=Math.cos(i),n=e[4],s=e[5],a=e[6],l=e[7],h=e[8],p=e[9],c=e[10],i=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*r+h*o,t[5]=s*r+p*o,t[6]=a*r+c*o,t[7]=l*r+i*o,t[8]=h*r-n*o,t[9]=p*r-s*o,t[10]=c*r-a*o,t[11]=i*r-l*o,t},t.rotateX$1=Hs,t.rotateY=function(t,e,i){var o=Math.sin(i),r=Math.cos(i),n=e[0],s=e[1],a=e[2],l=e[3],h=e[8],p=e[9],c=e[10],i=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r-h*o,t[1]=s*r-p*o,t[2]=a*r-c*o,t[3]=l*r-i*o,t[8]=n*o+h*r,t[9]=s*o+p*r,t[10]=a*o+c*r,t[11]=l*o+i*r,t},t.rotateZ=function(t,e,i){var o=Math.sin(i),r=Math.cos(i),n=e[0],s=e[1],a=e[2],l=e[3],h=e[4],p=e[5],c=e[6],i=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r+h*o,t[1]=s*r+p*o,t[2]=a*r+c*o,t[3]=l*r+i*o,t[4]=h*r-n*o,t[5]=p*r-s*o,t[6]=c*r-a*o,t[7]=i*r-l*o,t},t.rotateZ$1=function(t,e,i){i*=.5;var o=e[0],r=e[1],n=e[2],s=e[3],e=Math.sin(i),i=Math.cos(i);return t[0]=o*i+r*e,t[1]=r*i-o*e,t[2]=n*i+s*e,t[3]=s*i-n*e,t},t.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},t.scale$1=function(t,e,i){var o=i[0],r=i[1],i=i[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$2=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},t.scaleAndAdd=Bs,t.setCacheLimits=function(t,e){gt=t,yt=e},t.setRTLTextPlugin=function(t,e,i=!1){if(Pr===br||Pr===xr||Pr===wr)throw new Error("setRTLTextPlugin cannot be called multiple times.");Er=B.resolveURL(t),Pr=br,Mr=e,Tr(),i||Ir()},t.smoothstep=function(t,e,i){return(i=d((i-t)/(e-t),0,1))*i*(3-2*i)},t.spec=zt,t.storeAuthState=function(t,e){e?ct.add(t):ct.delete(t)},t.sub=vi,t.subtract=Ns,t.symbolSize=mi,t.transformMat3=function(t,e,i){var o=e[0],r=e[1],e=e[2];return t[0]=o*i[0]+r*i[3]+e*i[6],t[1]=o*i[1]+r*i[4]+e*i[7],t[2]=o*i[2]+r*i[5]+e*i[8],t},t.transformMat4=Gs,t.transformMat4$1=function(t,e,i){var o=e[0],r=e[1],n=e[2],e=i[3]*o+i[7]*r+i[11]*n+i[15];return t[0]=(i[0]*o+i[4]*r+i[8]*n+i[12])/(e=e||1),t[1]=(i[1]*o+i[5]*r+i[9]*n+i[13])/e,t[2]=(i[2]*o+i[6]*r+i[10]*n+i[14])/e,t},t.transformQuat=Zs,t.translate=function(t,e,i){var o,r,n,s,a,l,h,p,c,u,d,f=i[0],g=i[1],y=i[2];return e===t?(t[12]=e[0]*f+e[4]*g+e[8]*y+e[12],t[13]=e[1]*f+e[5]*g+e[9]*y+e[13],t[14]=e[2]*f+e[6]*g+e[10]*y+e[14],t[15]=e[3]*f+e[7]*g+e[11]*y+e[15]):(o=e[1],r=e[2],n=e[3],s=e[4],a=e[5],l=e[6],h=e[7],p=e[8],c=e[9],u=e[10],d=e[11],t[0]=i=e[0],t[1]=o,t[2]=r,t[3]=n,t[4]=s,t[5]=a,t[6]=l,t[7]=h,t[8]=p,t[9]=c,t[10]=u,t[11]=d,t[12]=i*f+s*g+p*y+e[12],t[13]=o*f+a*g+c*y+e[13],t[14]=r*f+l*g+u*y+e[14],t[15]=n*f+h*g+d*y+e[15]),t},t.triggerPluginCompletionEvent=Sr,t.uniqueId=m,t.validateCustomStyleLayer=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateFog=To,t.validateLight=So,t.validateStyle=Eo,t.values=_,t.vectorTile=Va,t.version=n,t.warnOnce=Z,t.window=c,t.wrap=f}),t(0,function(l){function s(t){let e="";for(const i of l.refProperties)e+=`/${function e(i){var t=typeof i;if("number"==t||"boolean"==t||"string"==t||null==i)return JSON.stringify(i);if(Array.isArray(i)){let t="[";for(const o of i)t+=`${e(o)},`;return`${t}]`}const o=Object.keys(i).sort();let r="{";for(let t=0;t<o.length;t++)r+=`${JSON.stringify(o[t])}:${e(i[o[t]])},`;return`${r}}`}(t[i])}`;return e}class i{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(i,t){for(const s of i){this._layerConfigs[s.id]=s;const i=this._layers[s.id]=l.createStyleLayer(s);i._featureFilter=l.createFilter(i.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(const l of t)delete this.keyCache[l],delete this._layerConfigs[l],delete this._layers[l];this.familiesBySource={};t=function(i,o){const r={};for(let e=0;e<i.length;e++){var n=o&&o[i[e].id]||s(i[e]);o&&(o[i[e].id]=n);let t=r[n];t=t||(r[n]=[]),t.push(i[e])}const t=[];for(const i in r)t.push(r[i]);return t}(l.values(this._layerConfigs),this.keyCache);for(const l of t){const i=l.map(t=>this._layers[t.id]),s=i[0];if("none"!==s.visibility){const r=s.source||"";let t=this.familiesBySource[r];t=t||(this.familiesBySource[r]={});var o=s.sourceLayer||"_geojsonTileLayer";let e=t[o];e=e||(t[o]=[]),e.push(i)}}}}const{ImageBitmap:a}=l.window;class o{loadTile(t,e){var{uid:i,encoding:o,rawImageData:r,padding:n,buildQuadTree:t}=t,r=a&&r instanceof a?this.getImageData(r,n):r;e(null,new l.DEMData(i,r,o,n<1,t))}getImageData(t,e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);e=this.offscreenCanvasContext.getImageData(-e,-e,t.width+2*e,t.height+2*e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:e.width,height:e.height},e.data)}}function h(t,e){var i,o=t&&t.type;if("FeatureCollection"===o)for(i=0;i<t.features.length;i++)h(t.features[i],e);else if("GeometryCollection"===o)for(i=0;i<t.geometries.length;i++)h(t.geometries[i],e);else if("Feature"===o)h(t.geometry,e);else if("Polygon"===o)r(t.coordinates,e);else if("MultiPolygon"===o)for(i=0;i<t.coordinates.length;i++)r(t.coordinates[i],e);return t}function r(t,e){if(0!==t.length){n(t[0],e);for(var i=1;i<t.length;i++)n(t[i],!e)}}function n(t,e){for(var i=0,o=0,r=t.length,n=r-1;o<r;n=o++)i+=(t[o][0]-t[n][0])*(t[n][1]+t[o][1]);0<=i!=!!e&&t.reverse()}const p=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class e{constructor(t){this._feature=t,this.extent=l.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const e of this._feature.geometry)t.push([new l.pointGeometry(e[0],e[1])]);return t}{const i=[];for(const o of this._feature.geometry){const r=[];for(const n of o)r.push(new l.pointGeometry(n[0],n[1]));i.push(r)}return i}}toGeoJSON(t,e,i){return p.call(this,t,e,i)}}class c{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=t.length,this._features=t}feature(t){return new e(this._features[t])}}var t=l.vectorTile.VectorTileFeature,u=d;function d(t,e){this.options=e||{},this.features=t,this.length=t.length}function f(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}d.prototype.feature=function(t){return new f(this.features[t],this.options.extent)},f.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],o=[],r=0;r<i.length;r++)o.push(new l.pointGeometry(i[r][0],i[r][1]));this.geometry.push(o)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,o=1/0,r=-1/0,n=0;n<t.length;n++)for(var s=t[n],a=0;a<s.length;a++)var l=s[a],e=Math.min(e,l.x),i=Math.max(i,l.x),o=Math.min(o,l.y),r=Math.max(r,l.y);return[e,o,i,r]},f.prototype.toGeoJSON=t.prototype.toGeoJSON;var g,y=m,t=u;function m(t){var e=new l.pbf;return function(t,e){for(var i in t.layers)e.writeMessage(3,_,t.layers[i])}(t,e),e.finish()}function _(t,e){e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);for(var i={keys:[],values:[],keycache:{},valuecache:{}},o=0;o<t.length;o++)i.feature=t.feature(o),e.writeMessage(2,v,i);var r=i.keys;for(o=0;o<r.length;o++)e.writeStringField(3,r[o]);var n=i.values;for(o=0;o<n.length;o++)e.writeMessage(4,P,n[o])}function v(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,b,t),e.writeVarintField(3,i.type),e.writeMessage(4,M,i)}function b(t,e){var i,o=t.feature,r=t.keys,n=t.values,s=t.keycache,a=t.valuecache;for(i in o.properties){var l=s[i];void 0===l&&(r.push(i),s[i]=l=r.length-1),e.writeVarint(l);var h=o.properties[i],p=typeof h,l=p+":"+(h="string"!=p&&"boolean"!=p&&"number"!=p?JSON.stringify(h):h),p=a[l];void 0===p&&(n.push(h),a[l]=p=n.length-1),e.writeVarint(p)}}function x(t,e){return(e<<3)+(7&t)}function w(t){return t<<1^t>>31}function M(t,e){for(var i=t.loadGeometry(),o=t.type,r=0,n=0,s=i.length,a=0;a<s;a++){var l=i[a],h=1;1===o&&(h=l.length),e.writeVarint(x(1,h));for(var p=3===o?l.length-1:l.length,c=0;c<p;c++){1===c&&1!==o&&e.writeVarint(x(2,p-1));var u=l[c].x-r,d=l[c].y-n;e.writeVarint(w(u)),e.writeVarint(w(d)),r+=u,n+=d}3===o&&e.writeVarint(15)}}function P(t,e){var i=typeof t;"string"==i?e.writeStringField(1,t):"boolean"==i?e.writeBooleanField(7,t):"number"==i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function E(t,e,i,o,r,n){var s;r-o<=i||(function i(o,r,n,s,a,l){for(;s<a;){if(600<a-s){const p=a-s+1,c=n-s+1,u=Math.log(p),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(p-d)/p)*(c-p/2<0?-1:1);i(o,r,n,Math.max(s,Math.floor(n-c*d/p+f)),Math.min(a,Math.floor(n+(p-c)*d/p+f)),l)}const h=r[2*n+l];let t=s,e=a;for(S(o,r,s,n),r[2*a+l]>h&&S(o,r,s,a);t<e;){for(S(o,r,t,e),t++,e--;r[2*t+l]<h;)t++;for(;r[2*e+l]>h;)e--}r[2*s+l]===h?S(o,r,s,e):(e++,S(o,r,e,a)),e<=n&&(s=e+1),n<=e&&(a=e-1)}}(t,e,s=o+r>>1,o,r,n%2),E(t,e,i,o,s-1,n+1),E(t,e,i,1+s,r,n+1))}function S(t,e,i,o){T(t,i,o),T(e,2*i,2*o),T(e,2*i+1,2*o+1)}function T(t,e,i){var o=t[e];t[e]=t[i],t[i]=o}function A(t,e,i,o){i=t-i,o=e-o;return i*i+o*o}y.fromVectorTileJs=m,y.fromGeojsonVt=function(t,e){e=e||{};var i,o={};for(i in t)o[i]=new u(t[i].features,e),o[i].name=i,o[i].version=e.version,o[i].extent=e.extent;return m({layers:o})},y.GeoJSONWrapper=t;class C{constructor(e,i=t=>t[0],o=t=>t[1],t=64,r=Float64Array){this.nodeSize=t;const n=(this.points=e).length<65536?Uint16Array:Uint32Array,s=this.ids=new n(e.length),a=this.coords=new r(2*e.length);for(let t=0;t<e.length;t++)s[t]=t,a[2*t]=i(e[t]),a[2*t+1]=o(e[t]);E(s,a,t,0,s.length-1,0)}range(t,e,i,o){return function(e,i,o,r,n,s,t){const a=[0,e.length-1,0],l=[];let h,p;for(;a.length;){var c=a.pop(),u=a.pop(),d=a.pop();if(u-d<=t)for(let t=d;t<=u;t++)h=i[2*t],p=i[2*t+1],h>=o&&h<=n&&p>=r&&p<=s&&l.push(e[t]);else{var f=Math.floor((d+u)/2);h=i[2*f],p=i[2*f+1],h>=o&&h<=n&&p>=r&&p<=s&&l.push(e[f]);var g=(c+1)%2;(0===c?o<=h:r<=p)&&(a.push(d),a.push(f-1),a.push(g)),(0===c?n>=h:s>=p)&&(a.push(f+1),a.push(u),a.push(g))}}return l}(this.ids,this.coords,t,e,i,o,this.nodeSize)}within(t,e,i){return function(e,i,o,r,t,n){const s=[0,e.length-1,0],a=[],l=t*t;for(;s.length;){var h=s.pop(),p=s.pop(),c=s.pop();if(p-c<=n)for(let t=c;t<=p;t++)A(i[2*t],i[2*t+1],o,r)<=l&&a.push(e[t]);else{var u=Math.floor((c+p)/2),d=i[2*u],f=i[2*u+1];A(d,f,o,r)<=l&&a.push(e[u]);var g=(h+1)%2;(0===h?o-t<=d:r-t<=f)&&(s.push(c),s.push(u-1),s.push(g)),(0===h?d<=o+t:f<=r+t)&&(s.push(u+1),s.push(p),s.push(g))}}return a}(this.ids,this.coords,t,e,i,this.nodeSize)}}const I={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},L=Math.fround||(g=new Float32Array(1),t=>(g[0]=+t,g[0]));class O{constructor(t){this.options=F(Object.create(I),t),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:i,minZoom:o,maxZoom:r,nodeSize:n}=this.options;i&&console.time("total time");var t=`prepare ${e.length} points`;i&&console.time(t),this.points=e;let s=[];for(let t=0;t<e.length;t++)e[t].geometry&&s.push(function(t,e){var[i,t]=t.geometry.coordinates;return{x:L(k(i)),y:L(z(t)),zoom:1/0,index:e,parentId:-1}}(e[t],t));this.trees[r+1]=new C(s,N,U,n,Float32Array),i&&console.timeEnd(t);for(let t=r;t>=o;t--){const o=+Date.now();s=this._cluster(s,t),this.trees[t]=new C(s,N,U,n,Float32Array),i&&console.log("z%d: %d clusters in %dms",t,s.length,+Date.now()-o)}return i&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;var o=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;var n=Math.max(-90,Math.min(90,t[3]));if(360<=t[2]-t[0])i=-180,r=180;else if(i>r){const t=this.getClusters([i,o,180,n],e),s=this.getClusters([-180,o,r,n],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(k(i),z(n),k(r),z(o)),l=[];for(const t of a){const e=s.points[t];l.push(e.numPoints?R(e):this.points[e.index])}return l}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),o="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(o);var n=r.points[e];if(!n)throw new Error(o);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=r.within(n.x,n.y,s),l=[];for(const e of a){const i=r.points[e];i.parentId===t&&l.push(i.numPoints?R(i):this.points[i.index])}if(0===l.length)throw new Error(o);return l}getLeaves(t,e,i){var o=[];return this._appendLeaves(o,t,e=e||10,i=i||0,0),o}getTile(t,e,i){const o=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:n,radius:s}=this.options,a=s/n,l=(i-a)/r,h=(i+1+a)/r,p={features:[]};return this._addTileFeatures(o.range((e-a)/r,l,(e+1+a)/r,h),o.points,e,i,r,p),0===e&&this._addTileFeatures(o.range(1-a/r,l,1,h),o.points,r,i,r,p),e===r-1&&this._addTileFeatures(o.range(0,l,a/r,h),o.points,-1,i,r,p),p.features.length?p:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){var i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,o,r){const n=this.getChildren(e);for(const e of n){const n=e.properties;if(n&&n.cluster?r+n.point_count<=o?r+=n.point_count:r=this._appendLeaves(t,n.cluster_id,i,o,r):r<o?r++:t.push(e),t.length===i)break}return r}_addTileFeatures(r,n,s,a,l,h){for(const p of r){const r=n[p],c=r.numPoints;let t,e,i;if(c)t=D(r),e=r.x,i=r.y;else{const n=this.points[r.index];t=n.properties,e=k(n.geometry.coordinates[0]),i=z(n.geometry.coordinates[1])}const u={type:1,geometry:[[Math.round(this.options.extent*(e*l-s)),Math.round(this.options.extent*(i*l-a))]],tags:t};let o;c?o=r.id:this.options.generateId?o=r.index:this.points[r.index].id&&(o=this.points[r.index].id),void 0!==o&&(u.id=o),h.features.push(u)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,n){const s=[],{radius:a,extent:l,reduce:h,minPoints:e}=this.options,i=a/(l*Math.pow(2,n));for(let r=0;r<t.length;r++){const l=t[r];if(!(l.zoom<=n)){l.zoom=n;const m=this.trees[n+1],_=m.within(l.x,l.y,i),v=l.numPoints||1;let o=v;for(const t of _){const s=m.points[t];s.zoom>n&&(o+=s.numPoints||1)}if(o>=e){let t=l.x*v,e=l.y*v,i=h&&1<v?this._map(l,!0):null;var p,c=(r<<5)+(n+1)+this.points.length;for(const s of _){const a=m.points[s];a.zoom<=n||(a.zoom=n,p=a.numPoints||1,t+=a.x*p,e+=a.y*p,a.parentId=c,h&&(i=i||this._map(l,!0),h(i,this._map(a))))}l.parentId=c,s.push((u=t/o,d=e/o,f=c,g=o,y=i,{x:L(u),y:L(d),zoom:1/0,id:f,parentId:-1,numPoints:g,properties:y}))}else if(s.push(l),1<o)for(const t of _){const a=m.points[t];a.zoom<=n||(a.zoom=n,s.push(a))}}}var u,d,f,g,y;return s}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?F({},t.properties):t.properties;var i=this.points[t.index].properties,t=this.options.map(i);return e&&t===i?F({},t):t}}function R(t){return{type:"Feature",id:t.id,properties:D(t),geometry:{type:"Point",coordinates:[360*(t.x-.5),function(t){t=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}(t.y)]}}}function D(t){var e=t.numPoints,i=1e4<=e?`${Math.round(e/1e3)}k`:1e3<=e?Math.round(e/100)/10+"k":e;return F(F({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:i})}function k(t){return t/360+.5}function z(t){t=Math.sin(t*Math.PI/180),t=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return t<0?0:1<t?1:t}function F(t,e){for(const i in e)t[i]=e[i];return t}function N(t){return t.x}function U(t){return t.y}function B(t,e,i,o){for(var r,n=o,s=i-e>>1,a=i-e,l=t[e],h=t[e+1],p=t[i],c=t[i+1],u=e+3;u<i;u+=3){var d=function(t,e,i,o,r,n){var s=r-i,a=n-o;{var l;0===s&&0===a||(1<(l=((t-i)*s+(e-o)*a)/(s*s+a*a))?(i=r,o=n):0<l&&(i+=s*l,o+=a*l))}return(s=t-i)*s+(a=e-o)*a}(t[u],t[u+1],l,h,p,c);n<d?(r=u,n=d):d!==n||(d=Math.abs(u-s))<a&&(r=u,a=d)}o<n&&(3<r-e&&B(t,e,r,o),t[r+2]=n,3<i-r&&B(t,r,i,o))}function j(t,e,i,o){o={id:void 0===t?null:t,type:e,geometry:i,tags:o,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)Z(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var o=0;o<e.length;o++)Z(t,e[o]);else if("MultiPolygon"===i)for(o=0;o<e.length;o++)for(var r=0;r<e[o].length;r++)Z(t,e[o][r])}(o),o}function Z(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function G(t,e,i,o){if(e.geometry){var r=e.geometry.coordinates,n=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=o||0),"Point"===n)V(r,a);else if("MultiPoint"===n)for(var h=0;h<r.length;h++)V(r[h],a);else if("LineString"===n)W(r,a,s,!1);else if("MultiLineString"===n){if(i.lineMetrics){for(h=0;h<r.length;h++)W(r[h],a=[],s,!1),t.push(j(l,"LineString",a,e.properties));return}H(r,a,s,!1)}else if("Polygon"===n)H(r,a,s,!0);else{if("MultiPolygon"!==n){if("GeometryCollection"!==n)throw new Error("Input data is not a valid GeoJSON object.");for(h=0;h<e.geometry.geometries.length;h++)G(t,{id:l,geometry:e.geometry.geometries[h],properties:e.properties},i,o);return}for(h=0;h<r.length;h++){var p=[];H(r[h],p,s,!0),a.push(p)}}t.push(j(l,n,a,e.properties))}}function V(t,e){e.push(q(t[0])),e.push(Y(t[1])),e.push(0)}function W(t,e,i,o){for(var r,n,s=0,a=0;a<t.length;a++){var l=q(t[a][0]),h=Y(t[a][1]);e.push(l),e.push(h),e.push(0),0<a&&(s+=o?(r*h-l*n)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(h-n,2))),r=l,n=h}var p=e.length-3;e[2]=1,B(e,0,p,i),e[2+p]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function H(t,e,i,o){for(var r=0;r<t.length;r++){var n=[];W(t[r],n,i,o),e.push(n)}}function q(t){return t/360+.5}function Y(t){t=Math.sin(t*Math.PI/180),t=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return t<0?0:1<t?1:t}function X(t,e,i,o,r,n,s,a){if(o/=e,n>=(i/=e)&&s<o)return t;if(s<i||o<=n)return null;for(var l=[],h=0;h<t.length;h++){var p=t[h],c=p.geometry,u=p.type,d=0===r?p.minX:p.minY,f=0===r?p.maxX:p.maxY;if(i<=d&&f<o)l.push(p);else if(!(f<i||o<=d)){var g=[];if("Point"===u||"MultiPoint"===u)!function(t,e,i,o,r){for(var n=0;n<t.length;n+=3){var s=t[n+r];i<=s&&s<=o&&(e.push(t[n]),e.push(t[n+1]),e.push(t[n+2]))}}(c,g,i,o,r);else if("LineString"===u)K(c,g,i,o,r,!1,a.lineMetrics);else if("MultiLineString"===u)J(c,g,i,o,r,!1);else if("Polygon"===u)J(c,g,i,o,r,!0);else if("MultiPolygon"===u)for(var y=0;y<c.length;y++){var m=[];J(c[y],m,i,o,r,!0),m.length&&g.push(m)}if(g.length)if(a.lineMetrics&&"LineString"===u)for(y=0;y<g.length;y++)l.push(j(p.id,u,g[y],p.tags));else"LineString"!==u&&"MultiLineString"!==u||(1===g.length?(u="LineString",g=g[0]):u="MultiLineString"),"Point"!==u&&"MultiPoint"!==u||(u=3===g.length?"Point":"MultiPoint"),l.push(j(p.id,u,g,p.tags))}}return l.length?l:null}function K(t,e,i,o,r,n,s){for(var a,l,h=$(t),p=0===r?tt:et,c=t.start,u=0;u<t.length-3;u+=3){var d=t[u],f=t[u+1],g=t[u+2],y=t[u+3],m=t[u+4],_=0===r?d:f,v=0===r?y:m,b=!1;s&&(a=Math.sqrt(Math.pow(d-y,2)+Math.pow(f-m,2))),_<i?i<v&&(l=p(h,d,f,y,m,i),s&&(h.start=c+a*l)):o<_?v<o&&(l=p(h,d,f,y,m,o),s&&(h.start=c+a*l)):Q(h,d,f,g),v<i&&i<=_&&(l=p(h,d,f,y,m,i),b=!0),o<v&&_<=o&&(l=p(h,d,f,y,m,o),b=!0),!n&&b&&(s&&(h.end=c+a*l),e.push(h),h=$(t)),s&&(c+=a)}var x=t.length-3,d=t[x],f=t[1+x],g=t[2+x];(_=0===r?d:f)>=i&&_<=o&&Q(h,d,f,g),x=h.length-3,n&&3<=x&&(h[x]!==h[0]||h[1+x]!==h[1])&&Q(h,h[0],h[1],h[2]),h.length&&e.push(h)}function $(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function J(t,e,i,o,r,n){for(var s=0;s<t.length;s++)K(t[s],e,i,o,r,n,!1)}function Q(t,e,i,o){t.push(e),t.push(i),t.push(o)}function tt(t,e,i,o,r,n){e=(n-e)/(o-e);return t.push(n),t.push(i+(r-i)*e),t.push(1),e}function et(t,e,i,o,r,n){i=(n-i)/(r-i);return t.push(e+(o-e)*i),t.push(n),t.push(1),i}function it(t,e){for(var i=[],o=0;o<t.length;o++){var r=t[o],n=r.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)s=ot(r.geometry,e);else if("MultiLineString"===n||"Polygon"===n)for(var s=[],a=0;a<r.geometry.length;a++)s.push(ot(r.geometry[a],e));else if("MultiPolygon"===n)for(s=[],a=0;a<r.geometry.length;a++){for(var l=[],h=0;h<r.geometry[a].length;h++)l.push(ot(r.geometry[a][h],e));s.push(l)}i.push(j(r.id,n,s,r.tags))}return i}function ot(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var o=0;o<t.length;o+=3)i.push(t[o]+e,t[o+1],t[o+2]);return i}function rt(t,e){if(t.transformed)return t;for(var i,o=1<<t.z,r=t.x,n=t.y,s=0;s<t.features.length;s++){var a=t.features[s],l=a.geometry,h=a.type;if(a.geometry=[],1===h)for(i=0;i<l.length;i+=2)a.geometry.push(nt(l[i],l[i+1],e,o,r,n));else for(i=0;i<l.length;i++){for(var p=[],c=0;c<l[i].length;c+=2)p.push(nt(l[i][c],l[i][c+1],e,o,r,n));a.geometry.push(p)}}return t.transformed=!0,t}function nt(t,e,i,o,r,n){return[Math.round(i*(t*o-r)),Math.round(i*(e*o-n))]}function st(t,e,i,o,r){for(var n=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:o,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,function(t,e,i,o){var r=e.geometry,n=e.type,s=[];if("Point"===n||"MultiPoint"===n)for(var a=0;a<r.length;a+=3)s.push(r[a]),s.push(r[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===n)at(s,r,t,i,!1,!1);else if("MultiLineString"===n||"Polygon"===n)for(a=0;a<r.length;a++)at(s,r[a],t,i,"Polygon"===n,0===a);else if("MultiPolygon"===n)for(var l=0;l<r.length;l++){var h=r[l];for(a=0;a<h.length;a++)at(s,h[a],t,i,!0,0===a)}if(s.length){var p=e.tags||null;if("LineString"===n&&o.lineMetrics){for(var c in p={},e.tags)p[c]=e.tags[c];p.mapbox_clip_start=r.start/r.size,p.mapbox_clip_end=r.end/r.size}o={geometry:s,type:"Polygon"===n||"MultiPolygon"===n?3:"LineString"===n||"MultiLineString"===n?2:1,tags:p};null!==e.id&&(o.id=e.id),t.features.push(o)}}(s,t[a],n,r);var l=t[a].minX,h=t[a].minY,p=t[a].maxX,c=t[a].maxY;l<s.minX&&(s.minX=l),h<s.minY&&(s.minY=h),p>s.maxX&&(s.maxX=p),c>s.maxY&&(s.maxY=c)}return s}function at(t,e,i,o,r,n){var s=o*o;if(0<o&&e.size<(r?s:o))i.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===o||e[l+2]>s)&&(i.numSimplified++,a.push(e[l]),a.push(e[l+1])),i.numPoints++;r&&function(t,e){for(var i=0,o=0,r=t.length,n=r-2;o<r;n=o,o+=2)i+=(t[o]-t[n])*(t[o+1]+t[n+1]);if(0<i===e)for(o=0,r=t.length;o<r/2;o+=2){var s=t[o],a=t[o+1];t[o]=t[r-2-o],t[o+1]=t[r-1-o],t[r-2-o]=s,t[r-1-o]=a}}(a,n),t.push(a)}}function lt(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||24<e.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var o,r,n,s,a=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var o=0;o<t.features.length;o++)G(i,t.features[o],e,o);else G(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),o=a,n=(r=e).buffer/r.extent,t=X(s=o,1,-1-n,n,0,-1,2,r),e=X(o,1,1-n,2+n,0,-1,2,r),(t||e)&&(s=X(o,1,-n,1+n,0,-1,2,r)||[],t&&(s=it(t,1).concat(s)),e&&(s=s.concat(it(e,-1)))),(a=s).length&&this.splitTile(a,0,0,0),i&&(a.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ht(t,e,i){return 32*((1<<t)*i+e)+t}function pt(t,e){t=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);t=this._geoJSONIndex.getTile(t.z,t.x,t.y);if(!t)return e(null,null);t=new c(t.features);let i=y(t);0===i.byteOffset&&i.byteLength===i.buffer.byteLength||(i=new Uint8Array(i)),e(null,{vectorTile:t,rawData:i.buffer})}lt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},lt.prototype.splitTile=function(t,e,i,o,r,n,s){for(var a=[t,e,i,o],l=this.options,h=l.debug;a.length;){o=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();var p,c,u,d,f,g,y,m,_=1<<e,v=ht(e,i,o),b=this.tiles[v];if(!b&&(1<h&&console.time("creation"),b=this.tiles[v]=st(t,e,i,o,l),this.tileCoords.push({z:e,x:i,y:o}),h)&&(1<h&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,o,b.numFeatures,b.numPoints,b.numSimplified),console.timeEnd("creation")),this.stats[m="z"+e]=(this.stats[m]||0)+1,this.total++),b.source=t,r){if(e===l.maxZoom||e===r)continue;var x=1<<r-e;if(i!==Math.floor(n/x)||o!==Math.floor(s/x))continue}else if(e===l.indexMaxZoom||b.numPoints<=l.indexMaxPoints)continue;b.source=null,0!==t.length&&(1<h&&console.time("clipping"),f=.5-(d=.5*l.buffer/l.extent),g=1+d,y=p=c=u=null,m=X(t,_,i-d,i+(v=.5+d),0,b.minX,b.maxX,l),x=X(t,_,i+f,i+g,0,b.minX,b.maxX,l),t=null,m&&(y=X(m,_,o-d,o+v,1,b.minY,b.maxY,l),p=X(m,_,o+f,o+g,1,b.minY,b.maxY,l),m=null),x&&(c=X(x,_,o-d,o+v,1,b.minY,b.maxY,l),u=X(x,_,o+f,o+g,1,b.minY,b.maxY,l),x=null),1<h&&console.timeEnd("clipping"),a.push(y||[],e+1,2*i,2*o),a.push(p||[],e+1,2*i,2*o+1),a.push(c||[],e+1,2*i+1,2*o),a.push(u||[],e+1,2*i+1,2*o+1))}},lt.prototype.getTile=function(t,e,i){var o=this.options,r=o.extent,n=o.debug;if(t<0||24<t)return null;o=1<<t,o=ht(t,e=(e%o+o)%o,i);if(this.tiles[o])return rt(this.tiles[o],r);1<n&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var s,a=t,l=e,h=i;!s&&0<a;)a--,l=Math.floor(l/2),h=Math.floor(h/2),s=this.tiles[ht(a,l,h)];return s&&s.source?(1<n&&console.log("found parent tile z%d-%d-%d",a,l,h),1<n&&console.time("drilling down"),this.splitTile(s.source,a,l,h,t,e,i),1<n&&console.timeEnd("drilling down"),this.tiles[o]?rt(this.tiles[o],r):null):null};class ct extends l.VectorTileWorkerSource{constructor(t,e,i,o,r){super(t,e,i,o,pt),r&&(this.loadGeoJSON=r)}loadData(o,r){const n=o&&o.request,s=n&&n.collectResourceTiming;this.loadGeoJSON(o,(t,e)=>{if(t||!e)return r(t);if("object"!=typeof e)return r(new Error(`Input data given to '${o.source}' is not a valid GeoJSON object.`));{h(e,!0);try{if(o.filter){const r=l.createExpression(o.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===r.result)throw new Error(r.value.map(t=>`${t.key}: ${t.message}`).join(", "));const n=e.features.filter(t=>r.value.evaluate({zoom:0},t));e={type:"FeatureCollection",features:n}}this._geoJSONIndex=o.cluster?new O(function({superclusterOptions:t,clusterProperties:e}){if(!e||!t)return t;const i={},o={},r={accumulated:null,zoom:0},n={properties:null},s=Object.keys(e);for(const t of s){const[r,n]=e[t],s=l.createExpression(n),a=l.createExpression("string"==typeof r?[r,["accumulated"],["get",t]]:r);i[t]=s.value,o[t]=a.value}return t.map=t=>{n.properties=t;const e={};for(const t of s)e[t]=i[t].evaluate(r,n);return e},t.reduce=(t,e)=>{n.properties=e;for(const e of s)r.accumulated=t[e],t[e]=o[e].evaluate(r,n)},t}(o)).load(e.features):new lt(e,o.geojsonVtOptions)}catch(t){return r(t)}this.loaded={};const i={};if(s){const r=l.getPerformanceMeasurement(n);r&&(i.resourceTiming={},i.resourceTiming[o.source]=JSON.parse(JSON.stringify(r)))}r(null,i)}})}reloadTile(t,e){var i=this.loaded;return i&&i[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,i){if(e.request)l.getJSON(e.request,i);else{if("string"!=typeof e.data)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class ut{constructor(t){this.self=t,this.actor=new l.Actor(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:ct},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=t=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=t.applyArabicShaping,l.plugin.processBidirectionalText=t.processBidirectionalText,l.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}checkIfReady(t,e,i){i()}setReferrer(t,e){this.referrer=e}spriteLoaded(t,e){this.isSpriteLoaded=e;for(const i in this.workerSources[t]){const o=this.workerSources[t][i];for(const t in o)o[t]instanceof l.VectorTileWorkerSource&&(o[t].isSpriteLoaded=e,o[t].fire(new l.Event("isSpriteLoaded")))}}setImages(t,e,i){this.availableImages[t]=e;for(const i in this.workerSources[t]){const o=this.workerSources[t][i];for(const t in o)o[t].availableImages=e}i()}enableTerrain(t,e,i){this.terrain=e,i()}setLayers(t,e,i){this.getLayerIndex(t).replace(e),i()}updateLayers(t,e,i){this.getLayerIndex(t).update(e.layers,e.removedIds),i()}loadTile(t,e,i){var o=this.enableTerrain?l.extend({enableTerrain:this.terrain},e):e;this.getWorkerSource(t,e.type,e.source).loadTile(o,i)}loadDEMTile(t,e,i){var o=this.enableTerrain?l.extend({buildQuadTree:this.terrain},e):e;this.getDEMWorkerSource(t,e.source).loadTile(o,i)}reloadTile(t,e,i){var o=this.enableTerrain?l.extend({enableTerrain:this.terrain},e):e;this.getWorkerSource(t,e.type,e.source).reloadTile(o,i)}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source).abortTile(e,i)}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source).removeTile(e,i)}removeSource(t,e,i){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){const o=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==o.removeSource?o.removeSource(e,i):i()}}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}}syncRTLPluginState(t,e,i){try{l.plugin.setState(e);const t=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&null!=t){this.self.importScripts(t);const e=l.plugin.isParsed();i(e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),e)}}catch(t){i(t.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e=e||[],e}getLayerIndex(t){let e=this.layerIndexes[t];return e=e||(this.layerIndexes[t]=new i),e}getWorkerSource(s,t,e){return this.workerSources[s]||(this.workerSources[s]={}),this.workerSources[s][t]||(this.workerSources[s][t]={}),this.workerSources[s][t][e]||(this.workerSources[s][t][e]=new this.workerSourceTypes[t]({send:(t,e,i,o,r,n)=>{this.actor.send(t,e,i,s,r,n)},scheduler:this.actor.scheduler},this.getLayerIndex(s),this.getAvailableImages(s),this.isSpriteLoaded)),this.workerSources[s][t][e]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new o),this.demWorkerSources[t][e]}enforceCacheSizeLimit(t,e){l.enforceCacheSizeLimit(e)}getWorkerPerformanceMetrics(t,e,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new ut(self)),ut}),t(0,function(K){var e=n;function n(t){return t=t,!("undefined"==typeof window||"undefined"==typeof document||(!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||(!Function.prototype||!Function.prototype.bind||(!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||(!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||(!function(){if("Worker"in window&&"Blob"in window&&"URL"in window){var t,e,i=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(i);try{e=new Worker(i),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(i),t}}()||(!("Uint8ClampedArray"in window)||(!ArrayBuffer.isView||(!function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(e){e=e.getImageData(0,0,1,1);return e&&e.width===t.width}}()||(void 0===i[r=t&&t.failIfMajorPerformanceCaveat]&&(i[r]=function(){var t,e,i,o,o=(e=r,i=document.createElement("canvas"),(o=Object.create(n.webGLContextAttributes)).failIfMajorPerformanceCaveat=e,i.getContext("webgl",o)||i.getContext("experimental-webgl",o));if(!o)return!1;try{t=o.createShader(o.VERTEX_SHADER)}catch(t){return!1}return!(!t||o.isContextLost())&&(o.shaderSource(t,"void main() {}"),o.compileShader(t),!0===o.getShaderParameter(t,o.COMPILE_STATUS))}()),!i[r]||!!document.documentMode))))))))));var r}var i={};function y(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return;for(let t=0;t<e.length;t++)if(!y(e[t],i[t]))return;return 1}if("object"!=typeof e||null===e||null===i)return e===i;if("object"==typeof i&&Object.keys(e).length===Object.keys(i).length){for(const t in e)if(!y(e[t],i[t]))return;return 1}}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const d={create:function(t,e,i){const o=K.window.document.createElement(t);return void 0!==e&&(o.className=e),i&&i.appendChild(o),o},createNS:function(t,e){return K.window.document.createElementNS(t,e)}},t=K.window.document&&K.window.document.documentElement.style,o=t&&void 0!==t.userSelect?"userSelect":"WebkitUserSelect";let r;d.disableDrag=function(){t&&o&&(r=t[o],t[o]="none")},d.enableDrag=function(){t&&o&&(t[o]=r)};let s=!(d.setTransform=function(t,e){t.style.transform=e});try{const e=Object.defineProperty({},"passive",{get(){s=!0}});K.window.addEventListener("test",e,e),K.window.removeEventListener("test",e,e)}catch(K){s=!1}d.addEventListener=function(t,e,i,o={}){t.addEventListener(e,i,"passive"in o&&s?o:o.capture)},d.removeEventListener=function(t,e,i,o={}){t.removeEventListener(e,i,"passive"in o&&s?o:o.capture)};const a=function(t){t.preventDefault(),t.stopPropagation(),K.window.removeEventListener("click",a,!0)};function l(t,e,i){t=t.offsetWidth===e.width?1:t.offsetWidth/e.width;return new K.pointGeometry((i.clientX-e.left)*t,(i.clientY-e.top)*t)}d.suppressClick=function(){K.window.addEventListener("click",a,!0),K.window.setTimeout(()=>{K.window.removeEventListener("click",a,!0)},0)},d.mousePos=function(t,e){var i=t.getBoundingClientRect();return l(t,i,e)},d.touchPos=function(e,i){const o=e.getBoundingClientRect(),r=[];for(let t=0;t<i.length;t++)r.push(l(e,o,i[t]));return r},d.mouseButton=function(t){return void 0!==K.window.InstallTrigger&&2===t.button&&t.ctrlKey&&0<=K.window.navigator.platform.toUpperCase().indexOf("MAC")?0:t.button},d.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};class c{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,i){var o=K.dot(e,this.dir);if(Math.abs(o)<1e-6)return!1;o=K.dot(K.sub(K.create(),t,this.pos),e)/o,o=K.scaleAndAdd(K.create(),this.pos,this.dir,o);return K.copy(i,o),!0}}class E{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(i,o,t){const r=Math.pow(2,t),n=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(t=>{var e=K.transformMat4([],t,i),t=1/e[3]/o*r;return K.mul(e,e,[t,t,1/e[3],t])}),e=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(t=>{const e=K.sub([],n[t[0]],n[t[1]]),i=K.sub([],n[t[2]],n[t[1]]),o=K.normalize([],K.cross([],e,i)),r=-K.dot(o,n[t[1]]);return o.concat(r)});return new E(n,e)}}class S{constructor(t,e){this.min=t,this.max=e,this.center=K.scale([],K.add([],this.min,this.max),.5)}quadrant(t){const e=[t%2==0,t<2],i=K.clone(this.min),o=K.clone(this.max);for(let t=0;t<e.length;t++)i[t]=(e[t]?this.min:this.center)[t],o[t]=(e[t]?this.center:this.max)[t];return o[2]=this.max[2],new S(i,o)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}intersects(r){var i=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let o=!0;for(let t=0;t<r.planes.length;t++){var n=r.planes[t];let e=0;for(let t=0;t<i.length;t++)e+=0<=K.dot$1(n,i[t]);if(0===e)return 0;e!==i.length&&(o=!1)}if(o)return 2;for(let o=0;o<3;o++){let e=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let t=0;t<r.points.length;t++){var s=r.points[t][o]-this.min[o];e=Math.min(e,s),i=Math.max(i,s)}if(i<0||e>this.max[o]-this.min[o])return 0}return 1}}class h extends K.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new K.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t)){for(const{ids:t,callback:e}of this.requestors)this._notify(t,e);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,e){this._validate(t,e)&&(this.images[t]=e)}_validate(t,e){let i=!0;return this._validateStretch(e.stretchX,e.data&&e.data.width)||(this.fire(new K.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),i=!1),this._validateStretch(e.stretchY,e.data&&e.data.height)||(this.fire(new K.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),i=!1),this._validateContent(e.content,e)||(this.fire(new K.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),i=!1),i}_validateStretch(t,e){if(!t)return!0;let i=0;for(const o of t){if(o[0]<i||o[1]<o[0]||e<o[1])return!1;i=o[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,e){let i=!0;if(!this.isLoaded())for(const e of t)this.images[e]||(i=!1);this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e})}_notify(t,e){const i={};for(const e of t){this.images[e]||this.fire(new K.Event("styleimagemissing",{id:e}));const t=this.images[e];t?i[e]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:K.warnOnce(`Image "${e}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}e(null,i)}getPixelSize(){var{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(t){const e=this.patterns[t],i=this.getImage(t);if(!i)return null;if(e&&e.position.version===i.version)return e.position;if(e)e.position.version=i.version;else{const e={w:i.data.width+2,h:i.data.height+2,x:0,y:0},o=new K.ImagePosition(e,i);this.patterns[t]={bin:e,position:o}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){var e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new K.Texture(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const K in this.patterns)t.push(this.patterns[K].bin);const{w:e,h:i}=K.potpack(t),o=this.atlasImage;o.resize({width:e||1,height:i||1});for(const t in this.patterns){const{bin:e}=this.patterns[t],i=e.x+1,r=e.y+1,n=this.images[t].data,s=n.width,a=n.height;K.RGBAImage.copy(n,o,{x:0,y:0},{x:i,y:r},{width:s,height:a}),K.RGBAImage.copy(n,o,{x:0,y:a-1},{x:i,y:r-1},{width:s,height:1}),K.RGBAImage.copy(n,o,{x:0,y:0},{x:i,y:r+a},{width:s,height:1}),K.RGBAImage.copy(n,o,{x:s-1,y:0},{x:i-1,y:r},{width:1,height:a}),K.RGBAImage.copy(n,o,{x:0,y:0},{x:i+s,y:r},{width:1,height:a})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const e of t)if(!this.callbackDispatchedThisFrame[e]){this.callbackDispatchedThisFrame[e]=!0;const t=this.images[e];!function(t){const{userImage:e}=t;return e&&e.render&&e.render()&&(t.data.replace(new Uint8Array(e.data.buffer)),1)}(t)||this.updateImage(e,t)}}}const p=new K.Properties({anchor:new K.DataConstantProperty(K.spec.light.anchor),position:new class{constructor(){this.specification=K.spec.light.position}possiblyEvaluate(t,e){return[[i,o,r]]=[t.expression.evaluate(e)],t=K.degToRad(o+90),e=K.degToRad(r),{x:i*Math.cos(t)*Math.sin(e),y:i*Math.sin(t)*Math.sin(e),z:i*Math.cos(e),azimuthal:o,polar:r};var i,o,r}interpolate(t,e,i){return{x:K.number(t.x,e.x,i),y:K.number(t.y,e.y,i),z:K.number(t.z,e.z,i),azimuthal:K.number(t.azimuthal,e.azimuthal,i),polar:K.number(t.polar,e.polar,i)}}},color:new K.DataConstantProperty(K.spec.light.color),intensity:new K.DataConstantProperty(K.spec.light.intensity)}),u="-transition";class f extends K.Evented{constructor(t){super(),this._transitionable=new K.Transitionable(p),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,e={}){if(!this._validate(K.validateLight,t,e))for(const e in t){var i=t[e];K.endsWith(e,u)?this._transitionable.setTransition(e.slice(0,-u.length),i):this._transitionable.setValue(e,i)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,e,i){return(!i||!1!==i.validate)&&K.emitValidationErrors(this,t.call(K.validateStyle,K.extend({value:e,style:{glyphs:!0,sprite:!0},styleSpec:K.spec})))}}const g=new K.Properties({source:new K.DataConstantProperty(K.spec.terrain.source),exaggeration:new K.DataConstantProperty(K.spec.terrain.exaggeration)}),m="-transition";class _ extends K.Evented{constructor(t){super(),this._transitionable=new K.Transitionable(g),this.set(t),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(t){for(const i in t){var e=t[i];K.endsWith(i,m)?this._transitionable.setTransition(i.slice(0,-m.length),e):this._transitionable.setValue(i,e)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function v(t,e,i,o){var r=K.smoothstep(45,65,i),[i,o]=b(t,o),e=K.length(e),i=1-Math.min(1,Math.exp((e-i)/(o-i)*-6));return i*=i*i,(i=Math.min(1,1.00747*i))*r*t.alpha}function b(t,e){e=.5/Math.tan(.5*e);return[t.range[0]+e,t.range[1]+e]}const x=new K.Properties({range:new K.DataConstantProperty(K.spec.fog.range),color:new K.DataConstantProperty(K.spec.fog.color),"horizon-blend":new K.DataConstantProperty(K.spec.fog["horizon-blend"])}),w="-transition";class M extends K.Evented{constructor(t){super(),this._transitionable=new K.Transitionable(x),this.set(t),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t){if(!this._validate(K.validateFog,t))for(const i in t){var e=t[i];K.endsWith(i,w)?this._transitionable.setTransition(i.slice(0,-w.length),e):this._transitionable.setValue(i,e)}}getOpacity(t){var e=this.properties&&this.properties.get("color")||1;return K.smoothstep(45,65,t)*e.a}getOpacityAtLatLng(t,e){return i=this.state,o=e,e=K.MercatorCoordinate.fromLngLat(t),t=o.elevation?o.elevation.getAtPointOrZero(e):0,t=[e.x,e.y,t],K.transformMat4$1(t,t,o.mercatorFogMatrix),v(i,t,o.pitch,o._fov);var i,o}getFovAdjustedRange(t){return b(this.state,t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,e,i){return(!i||!1!==i.validate)&&K.emitValidationErrors(this,t.call(K.validateStyle,K.extend({value:e,style:{glyphs:!0,sprite:!0},styleSpec:K.spec})))}}class P{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=K.uniqueId();var o=this.workerPool.acquire(this.id);for(let t=0;t<o.length;t++){const e=new P.Actor(o[t],i,this.id);e.name=`Worker ${t}`,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,t){K.asyncAll(this.actors,(t,e)=>{t.send(i,o,e)},t=t||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function $(t,e,i){return e*(K.EXTENT/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}P.Actor=K.Actor;class T{constructor(t,e,i,o){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(t=>o.pointCoordinate3D(t)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,e){let i,o;var r;return o=t instanceof K.pointGeometry||"number"==typeof t[0]?(r=K.pointGeometry.convert(t),i=[K.pointGeometry.convert(t)],e.isPointAboveHorizon(r)):(r=K.pointGeometry.convert(t[0]),t=K.pointGeometry.convert(t[1]),i=[r,t],K.polygonizeBounds(r,t).every(t=>e.isPointAboveHorizon(t))),new T(i,e.getCameraPoint(),o,e)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return K.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const e=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new K.pointGeometry(1,1)):this.screenBounds[1],o=K.polygonizeBounds(e,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>e.x&&this.cameraPoint.x<i.x?o.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?o[2]=this.cameraPoint:this.cameraPoint.x<=e.x&&(o[3]=this.cameraPoint)),K.bufferConvexPolygon(o,t)}containsTile(e,t,i){const o=e.queryPadding+1,r=i?this._bufferedCameraMercator(o,t).map(t=>e.tileID.getTilePoint(t)):this._bufferedScreenMercator(o,t).map(t=>e.tileID.getTilePoint(t)),n=this.screenGeometryMercator.map(t=>e.tileID.getTileVec3(t)),s=n.map(t=>new K.pointGeometry(t[0],t[1])),a=t.getFreeCameraOptions().position||new K.MercatorCoordinate(0,0,0),l=e.tileID.getTileVec3(a),h=n.map(t=>{t=K.sub(t,t,l);return K.normalize(t,t),new c(l,t)}),p=$(e,1,t.zoom);if(K.polygonIntersectsBox(r,0,0,K.EXTENT,K.EXTENT))return{queryGeometry:this,tilespaceGeometry:s,tilespaceRays:h,bufferedTilespaceGeometry:r,bufferedTilespaceBounds:((t=K.getBounds(r)).min.x=K.clamp(t.min.x,0,K.EXTENT),t.min.y=K.clamp(t.min.y,0,K.EXTENT),t.max.x=K.clamp(t.max.x,0,K.EXTENT),t.max.y=K.clamp(t.max.y,0,K.EXTENT),t),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:p}}_bufferedScreenMercator(t,e){var i=A(t);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];t=this.bufferedScreenGeometry(t).map(t=>e.pointCoordinate3D(t));return this._screenRaycastCache[i]=t}_bufferedCameraMercator(t,e){var i=A(t);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];t=this.bufferedCameraGeometry(t).map(t=>e.pointCoordinate3D(t));return this._cameraRaycastCache[i]=t}}function A(t){return 100*t|0}function C(i,o,r){const t=function(t,e){if(t)return r(t);if(e){const t=K.pick(K.extend(e,i),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);e.vector_layers&&(t.vectorLayers=e.vector_layers,t.vectorLayerIds=t.vectorLayers.map(t=>t.id)),t.tiles=o.canonicalizeTileset(t,i.url),r(null,t)}};return i.url?K.getJSON(o.transformRequest(o.normalizeSourceURL(i.url),K.ResourceType.Source),t):K.exported.frame(()=>t(null,i))}class I{constructor(t,e,i){this.bounds=K.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=i||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){var e=Math.pow(2,t.z),i=Math.floor(K.mercatorXfromLng(this.bounds.getWest())*e),o=Math.floor(K.mercatorYfromLat(this.bounds.getNorth())*e),r=Math.ceil(K.mercatorXfromLng(this.bounds.getEast())*e),e=Math.ceil(K.mercatorYfromLat(this.bounds.getSouth())*e);return t.x>=i&&t.x<r&&t.y>=o&&t.y<e}}class L{constructor(t,e,i){const o=(this.context=t).gl;this.buffer=o.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const O={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class R{constructor(t,e,i,o){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=o;const r=(this.context=t).gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(e,i){for(let t=0;t<this.attributes.length;t++){var o=i.attributes[this.attributes[t].name];void 0!==o&&e.enableVertexAttribArray(o)}}setVertexAttribPointers(e,i,o){for(let t=0;t<this.attributes.length;t++){var r=this.attributes[t],n=i.attributes[r.name];void 0!==n&&e.vertexAttribPointer(n,r.components,e[O[r.type]],!1,this.itemSize,r.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class D{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class k extends D{getDefault(){return K.Color.transparent}set(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a&&!this.dirty||(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class z extends D{getDefault(){return 1}set(t){t===this.current&&!this.dirty||(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class F extends D{getDefault(){return 0}set(t){t===this.current&&!this.dirty||(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class N extends D{getDefault(){return[!0,!0,!0,!0]}set(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&!this.dirty||(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class U extends D{getDefault(){return!0}set(t){t===this.current&&!this.dirty||(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class B extends D{getDefault(){return 255}set(t){t===this.current&&!this.dirty||(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class j extends D{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){var e=this.current;t.func===e.func&&t.ref===e.ref&&t.mask===e.mask&&!this.dirty||(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Z extends D{getDefault(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&!this.dirty||(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class G extends D{getDefault(){return!1}set(t){if(t!==this.current||this.dirty){const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}}class V extends D{getDefault(){return[0,1]}set(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&!this.dirty||(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class W extends D{getDefault(){return!1}set(t){if(t!==this.current||this.dirty){const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}}class H extends D{getDefault(){return this.gl.LESS}set(t){t===this.current&&!this.dirty||(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class q extends D{getDefault(){return!1}set(t){if(t!==this.current||this.dirty){const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}}class Y extends D{getDefault(){var t=this.gl;return[t.ONE,t.ZERO]}set(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&!this.dirty||(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class X extends D{getDefault(){return K.Color.transparent}set(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a&&!this.dirty||(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class J extends D{getDefault(){return this.gl.FUNC_ADD}set(t){t===this.current&&!this.dirty||(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Q extends D{getDefault(){return!1}set(t){if(t!==this.current||this.dirty){const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}}class tt extends D{getDefault(){return this.gl.BACK}set(t){t===this.current&&!this.dirty||(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class et extends D{getDefault(){return this.gl.CCW}set(t){t===this.current&&!this.dirty||(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class it extends D{getDefault(){return null}set(t){t===this.current&&!this.dirty||(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ot extends D{getDefault(){return this.gl.TEXTURE0}set(t){t===this.current&&!this.dirty||(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class rt extends D{getDefault(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&!this.dirty||(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class nt extends D{getDefault(){return null}set(t){if(t!==this.current||this.dirty){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}}class st extends D{getDefault(){return null}set(t){if(t!==this.current||this.dirty){const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}}class at extends D{getDefault(){return null}set(t){if(t!==this.current||this.dirty){const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}}class lt extends D{getDefault(){return null}set(t){if(t!==this.current||this.dirty){const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}}class ht extends D{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class pt extends D{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class ct extends D{getDefault(){return 4}set(t){if(t!==this.current||this.dirty){const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}}class ut extends D{getDefault(){return!1}set(t){if(t!==this.current||this.dirty){const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}}class dt extends D{getDefault(){return!1}set(t){if(t!==this.current||this.dirty){const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}}class ft extends D{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class gt extends ft{setDirty(){this.dirty=!0}set(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}}class yt extends ft{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}}class mt extends yt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class _t{constructor(t,e,i,o){this.context=t,this.width=e,this.height=i;i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new gt(t,i),o&&(this.depthAttachment=new yt(t,i))}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class vt{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new k(this),this.clearDepth=new z(this),this.clearStencil=new F(this),this.colorMask=new N(this),this.depthMask=new U(this),this.stencilMask=new B(this),this.stencilFunc=new j(this),this.stencilOp=new Z(this),this.stencilTest=new G(this),this.depthRange=new V(this),this.depthTest=new W(this),this.depthFunc=new H(this),this.blend=new q(this),this.blendFunc=new Y(this),this.blendColor=new X(this),this.blendEquation=new J(this),this.cullFace=new Q(this),this.cullFaceSide=new tt(this),this.frontFace=new et(this),this.program=new it(this),this.activeTexture=new ot(this),this.viewport=new rt(this),this.bindFramebuffer=new nt(this),this.bindRenderbuffer=new st(this),this.bindTexture=new at(this),this.bindVertexBuffer=new lt(this),this.bindElementBuffer=new ht(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new pt(this),this.pixelStoreUnpack=new ct(this),this.pixelStoreUnpackPremultiplyAlpha=new ut(this),this.pixelStoreUnpackFlipY=new dt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new L(this,t,e)}createVertexBuffer(t,e,i){return new R(this,t,e,i)}createRenderbuffer(t,e,i){const o=this.gl,r=o.createRenderbuffer();return this.bindRenderbuffer.set(r),o.renderbufferStorage(o.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),r}createFramebuffer(t,e,i){return new _t(this,t,e,i)}clear({color:t,depth:e,stencil:i}){const o=this.gl;let r=0;t&&(r|=o.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(r|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(r|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),o.clear(r)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){y(t.blendFunction,K.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class bt extends K.Evented{constructor(t,e,i,o){super(),this.id=t,this.dispatcher=i,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=K.extend({type:"raster"},e),K.extend(this,K.pick(e,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new K.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,(t,e)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new K.ErrorEvent(t)):e&&(K.extend(this,e),e.bounds&&(this.tileBounds=new I(e.bounds,this.minzoom,this.maxzoom)),K.postTurnstileEvent(e.tiles),this.fire(new K.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new K.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return K.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(n,s){var t=2<=K.exported.devicePixelRatio;let e=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),t,this.tileSize);"baidu"===this._options.rasterType&&(e=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url4bd(this.tiles,this.scheme),t,this.tileSize)),n.request=K.getImage(this.map._requestManager.transformRequest(e,K.ResourceType.Tile),(t,e,i,o)=>{if(delete n.request,n.aborted)n.state="unloaded",s(null);else if(t)n.state="errored",s(t);else if(e){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:i,expires:o});const t=this.map.painter.context,r=t.gl;n.texture=this.map.painter.getTileTexture(e.width),n.texture?n.texture.update(e,{useMipmap:!0}):(n.texture=new K.Texture(t,e,r.RGBA,{useMipmap:!0}),n.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE,r.LINEAR_MIPMAP_NEAREST),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax)),n.state="loaded",K.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()}hasTransition(){return!1}}let xt;var wt=K.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Mt extends K.Evented{constructor(t,e,i,o){super(),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(o),this.options=e}load(i,o){this._loaded=!1,this.fire(new K.Event("dataloading",{dataType:"source"})),this.url=this.options.url,K.getImage(this.map._requestManager.transformRequest(this.url,K.ResourceType.Image),(t,e)=>{this._loaded=!0,t?this.fire(new K.ErrorEvent(t)):e&&(this.image=K.exported.getImageData(e),i&&(this.coordinates=i),o&&o(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url&&(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null})),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new K.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){const s=(this.coordinates=t).map(K.MercatorCoordinate.fromLngLat);this.tileID=function(){let t=1/0,e=1/0,i=-1/0,o=-1/0;for(const K of s)t=Math.min(t,K.x),e=Math.min(e,K.y),i=Math.max(i,K.x),o=Math.max(o,K.y);var r=Math.max(i-t,o-e),n=Math.max(0,Math.floor(-Math.log(r)/Math.LN2)),r=Math.pow(2,n);return new K.CanonicalTileID(n,Math.floor((t+i)/2*r),Math.floor((e+o)/2*r))}(),this.minzoom=this.maxzoom=this.tileID.z;t=s.map(t=>this.tileID.getTilePoint(t)._round());return this._boundsArray=new K.StructArrayLayout4i8,this._boundsArray.emplaceBack(t[0].x,t[0].y,0,0),this._boundsArray.emplaceBack(t[1].x,t[1].y,K.EXTENT,0),this._boundsArray.emplaceBack(t[3].x,t[3].y,0,K.EXTENT),this._boundsArray.emplaceBack(t[2].x,t[2].y,K.EXTENT,K.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new K.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0!==Object.keys(this.tiles).length&&this.image){const t=this.map.painter.context,e=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=K.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new K.Texture(t,this.image,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE));for(const K in this.tiles){const t=this.tiles[K];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t).buckets={}:t.state="errored",e(null)}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Pt={vector:class extends K.Evented{constructor(t,e,i,o){if(super(),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,K.extend(this,K.pick(e,["url","scheme","tileSize","promoteId"])),this._options=K.extend({type:"vector"},e),this._collectResourceTiming=e.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o),this._tileWorkers={},this._deduped=new K.DedupedRequest}load(){this._loaded=!1,this.fire(new K.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,(t,e)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new K.ErrorEvent(t)):e&&(K.extend(this,e),e.bounds&&(this.tileBounds=new I(e.bounds,this.minzoom,this.maxzoom)),K.postTurnstileEvent(e.tiles,this.map._requestManager._customAccessToken),this.fire(new K.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new K.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t();for(const t of this.map.style._getSourceCaches(this.id))t.clearTiles();this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return K.extend({},this._options)}loadTile(i,o){const t=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(t,K.ResourceType.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:K.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile};if(r.request.collectResourceTiming=this._collectResourceTiming,i.actor&&"expired"!==i.state)"loading"===i.state?i.reloadCallback=o:i.request=i.actor.send("reloadTile",r,n.bind(this));else if(i.actor=this._tileWorkers[t]=this._tileWorkers[t]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",r,n.bind(this),void 0,!0);else{const o=K.loadVectorTile.call({deduped:this._deduped},r,(t,e)=>{t||!e?n.call(this,t):(r.data={cacheControl:e.cacheControl,expires:e.expires,rawData:e.rawData.slice(0)},i.actor&&i.actor.send("loadTile",r,n.bind(this),void 0,!0))},!0);i.request={cancel:o}}function n(t,e){return delete i.request,i.aborted?o(null):t&&404!==t.status?o(t):(e&&e.resourceTiming&&(i.resourceTiming=e.resourceTiming),this.map._refreshExpiredTiles&&e&&i.setExpiryData(e),i.loadVectorData(e,this.map.painter),K.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id})}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:bt,"raster-dem":class extends bt{constructor(t,e,i,o){super(t,e,i,o),this.type="raster-dem",this.maxzoom=22,this._options=K.extend({type:"raster-dem"},e),this.encoding=e.encoding||"mapbox"}loadTile(r,n){var t=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function s(t,e){t&&(r.state="errored",n(t)),e&&(r.dem=e,r.dem.onDeserialize(),r.needsHillshadePrepare=!0,r.needsDEMTextureUpload=!0,r.state="loaded",n(null))}r.request=K.getImage(this.map._requestManager.transformRequest(t,K.ResourceType.Tile),function(t,e,i,o){if(delete r.request,r.aborted)r.state="unloaded",n(null);else if(t)r.state="errored",n(t);else if(e){this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:i,expires:o});const n=K.window.ImageBitmap&&e instanceof K.window.ImageBitmap&&(null==xt&&(xt=K.window.OffscreenCanvas&&new K.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof K.window.createImageBitmap),xt),t=1-(e.width-K.prevPowerOfTwo(e.width))/2;t<1||r.neighboringTiles||(r.neighboringTiles=this._getNeighboringTiles(r.tileID));e=n?e:K.exported.getImageData(e,t),e={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:e,encoding:this.encoding,padding:t};r.actor&&"expired"!==r.state||(r.actor=this.dispatcher.getActor(),r.actor.send("loadDEMTile",e,s.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const e=t.canonical,i=Math.pow(2,e.z),o=(e.x-1+i)%i,r=0===e.x?t.wrap-1:t.wrap,n=(e.x+1+i)%i,s=e.x+1===i?t.wrap+1:t.wrap,a={};return a[new K.OverscaledTileID(t.overscaledZ,r,e.z,o,e.y).key]={backfilled:!1},a[new K.OverscaledTileID(t.overscaledZ,s,e.z,n,e.y).key]={backfilled:!1},0<e.y&&(a[new K.OverscaledTileID(t.overscaledZ,r,e.z,o,e.y-1).key]={backfilled:!1},a[new K.OverscaledTileID(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},a[new K.OverscaledTileID(t.overscaledZ,s,e.z,n,e.y-1).key]={backfilled:!1}),e.y+1<i&&(a[new K.OverscaledTileID(t.overscaledZ,r,e.z,o,e.y+1).key]={backfilled:!1},a[new K.OverscaledTileID(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},a[new K.OverscaledTileID(t.overscaledZ,s,e.z,n,e.y+1).key]={backfilled:!1}),a}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded"}},geojson:class extends K.Evented{constructor(t,e,i,o){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(o),this._data=e.data,this._options=K.extend({},e),this._collectResourceTiming=e.collectResourceTiming,void 0!==e.maxzoom&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type),e.attribution&&(this.attribution=e.attribution),this.promoteId=e.promoteId;o=K.EXTENT/this.tileSize;this.workerOptions=K.extend({source:this.id,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(void 0!==e.buffer?e.buffer:128)*o,tolerance:(void 0!==e.tolerance?e.tolerance:.375)*o,extent:K.EXTENT,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1,generateId:e.generateId||!1},superclusterOptions:{maxZoom:void 0!==e.clusterMaxZoom?e.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,e.clusterMinPoints||2),extent:K.EXTENT,radius:(void 0!==e.clusterRadius?e.clusterRadius:50)*o,log:!1,generateId:e.generateId||!1},clusterProperties:e.clusterProperties,filter:e.filter},e.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this}getClusterLeaves(t,e,i,o){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:i},o),this}_updateWorkerData(){if(this._pendingLoad)this._coalesce=!0;else{this.fire(new K.Event("dataloading",{dataType:"source"})),this._loaded=!1;const t=K.extend({},this.workerOptions),e=this._data;"string"==typeof e?(t.request=this.map._requestManager.transformRequest(K.exported.resolveURL(e),K.ResourceType.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(e),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(t,e)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new K.ErrorEvent(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&e&&e.resourceTiming&&e.resourceTiming[this.id]&&(t.resourceTiming=e.resourceTiming[this.id]),this.fire(new K.Event("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}}loaded(){return this._loaded}loadTile(i,o){const r=i.actor?"reloadTile":"loadTile";i.actor=this.actor,i.request=this.actor.send(r,{type:this.type,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:K.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(t,e)=>(delete i.request,i.unloadVectorData(),i.aborted?o(null):t?o(t):(i.loadVectorData(e,this.map.painter,"reloadTile"==r),o(null))),void 0,"loadTile"==r)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return K.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Mt{constructor(t,e,i,o){super(t,e,i,o),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;var t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,K.ResourceType.Source).url);K.getVideo(this.urls,(t,e)=>{this._loaded=!0,t?this.fire(new K.ErrorEvent(t)):e&&(this.video=e,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const e=this.video.seekable;t<e.start(0)||t>e.end(0)?this.fire(new K.ErrorEvent(new K.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${e.start(0)} and ${e.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){const t=this.map.painter.context,e=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=K.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new K.Texture(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE));for(const K in this.tiles){const t=this.tiles[K];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Mt,canvas:class extends Mt{constructor(t,e,i,o){super(t,e,i,o),e.coordinates?Array.isArray(e.coordinates)&&4===e.coordinates.length&&!e.coordinates.some(t=>!Array.isArray(t)||2!==t.length||t.some(t=>"number"!=typeof t))||this.fire(new K.ErrorEvent(new K.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new K.ErrorEvent(new K.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),e.animate&&"boolean"!=typeof e.animate&&this.fire(new K.ErrorEvent(new K.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),e.canvas?"string"==typeof e.canvas||e.canvas instanceof K.window.HTMLCanvasElement||this.fire(new K.ErrorEvent(new K.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new K.ErrorEvent(new K.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=e,this.animate=void 0===e.animate||e.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof K.window.HTMLCanvasElement?this.options.canvas:K.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new K.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){const e=this.map.painter.context,i=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=K.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new K.Texture(e,this.canvas,i.RGBA,{premultiply:!0});for(const K in this.tiles){const t=this.tiles[K];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}},Et=function(t,e,i,o){o=new Pt[e.type](t,e,i,o);if(o.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${o.id}`);return K.bindAll(["load","abort","unload","serialize","prepare"],o),o};function St(o,t,e,i,r,n,s,a=!1){const l=o.tilesIn(i,s,a);l.sort(Tt);const h=[];for(const i of l)h.push({wrappedTileID:i.tile.tileID.wrapped().key,queryResults:i.tile.queryRenderedFeatures(t,e,o._state,i,r,n,(p=o.transform,c=i.tile.tileID,u=void 0,u=K.identity([]),K.scale$1(u,u,[.5*p.width,.5*-p.height,1]),K.translate(u,u,[1,-1,0]),K.multiply(u,u,p.calculateProjMatrix(c.toUnwrapped()))),a)});var p,c,u;const d=function(t){const e={},i={};for(const o of t){const t=o.queryResults,r=o.wrappedTileID,n=i[r]=i[r]||{};for(const i in t){const s=t[i],a=n[i]=n[i]||{},l=e[i]=e[i]||[];for(const t of s)a[t.featureIndex]||(a[t.featureIndex]=!0,l.push(t))}}return e}(h);for(const t in d)d[t].forEach(t=>{const e=t.feature,i=o.getFeatureState(e.layer["source-layer"],e.id);e.source=e.layer.source,e.layer["source-layer"]&&(e.sourceLayer=e.layer["source-layer"]),e.state=i});return d}function Tt(t,e){t=t.tileID,e=e.tileID;return t.overscaledZ-e.overscaledZ||t.canonical.y-e.canonical.y||t.wrap-e.wrap||t.canonical.x-e.canonical.x}function At(){return null!=Pr.workerClass?new Pr.workerClass:new K.window.Worker(Pr.workerUrl)}const Ct="zmapboxgl_preloaded_worker_pool";class It{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<It.workerCount;)this.workers.push(new At);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(t=>{t.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ct]}numActive(){return Object.keys(this.active).length}}let Lt;function Ot(){return Lt=Lt||new It,Lt}function Rt(e){e=e.slice();const i=Object.create(null);for(let t=0;t<e.length;t++)i[e[t].id]=e[t];for(let t=0;t<e.length;t++)"ref"in e[t]&&(e[t]=function(t,e){const i={};for(const K in t)"ref"!==K&&(i[K]=t[K]);return K.refProperties.forEach(t=>{t in e&&(i[t]=e[t])}),i}(e[t],i[e[t].ref]));return e}It.workerCount=2;const Dt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function kt(t,e,i){i.push({command:Dt.addSource,args:[t,e[t]]})}function zt(t,e,i){e.push({command:Dt.removeSource,args:[t]}),i[t]=!0}function Ft(t,e,i,o,r,n){let s;for(s in e=e||{},t=t||{})t.hasOwnProperty(s)&&(y(t[s],e[s])||i.push({command:n,args:[o,s,e[s],r]}));for(s in e)e.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(y(t[s],e[s])||i.push({command:n,args:[o,s,e[s],r]}))}function Nt(t){return t.id}function Ut(t,e){return t[e.id]=e,t}class Bt{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=K.clamp(t,0,1);let e=1,i=this._distances[e];for(var o=t*this.paddedLength+this.padding;i<o&&e<this._distances.length;)i=this._distances[++e];var r=e-1,n=this._distances[r],t=i-n,t=0<t?(o-n)/t:0;return this.points[r].mult(1-t).add(this.points[e].mult(t))}}class jt{constructor(t,e,i){const o=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)o.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,o,r){this._forEachCell(e,i,o,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(r)}insertCircle(t,e,i,o){this._forEachCell(e-o,i-o,e+o,i+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(o)}_insertBoxCell(t,e,i,o,r,n){this.boxCells[r].push(n)}_insertCircleCell(t,e,i,o,r,n){this.circleCells[r].push(n)}_query(t,e,i,o,r,n){if(i<0||t>this.width||o<0||e>this.height)return!r&&[];const s=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=o){if(r)return!0;for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],o=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-o,y1:i-o,x2:e+o,y2:i+o})}return n?s.filter(n):s}return this._forEachCell(t,e,i,o,this._queryCell,s,{hitTest:r,seenUids:{box:{},circle:{}}},n),r?0<s.length:s}_queryCircle(t,e,i,o,r){var n=t-i,s=t+i,a=e-i,l=e+i;if(s<0||n>this.width||l<0||a>this.height)return!o&&[];var h=[];return this._forEachCell(n,a,s,l,this._queryCellCircle,h,{hitTest:o,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},r),o?0<h.length:h}query(t,e,i,o,r){return this._query(t,e,i,o,!1,r)}hitTest(t,e,i,o,r){return this._query(t,e,i,o,!0,r)}hitTestCircle(t,e,i,o){return this._queryCircle(t,e,i,!0,o)}_queryCell(t,e,i,o,r,n,s,a){const l=s.seenUids,h=this.boxCells[r];if(null!==h){const r=this.bboxes;for(const p of h)if(!l.box[p]){l.box[p]=!0;const h=4*p;if(t<=r[2+h]&&e<=r[3+h]&&i>=r[0+h]&&o>=r[1+h]&&(!a||a(this.boxKeys[p]))){if(s.hitTest)return n.push(!0),!0;n.push({key:this.boxKeys[p],x1:r[h],y1:r[1+h],x2:r[2+h],y2:r[3+h]})}}}const p=this.circleCells[r];if(null!==p){const r=this.circles;for(const h of p)if(!l.circle[h]){l.circle[h]=!0;const p=3*h;if(this._circleAndRectCollide(r[p],r[1+p],r[2+p],t,e,i,o)&&(!a||a(this.circleKeys[h]))){if(s.hitTest)return n.push(!0),!0;{const t=r[p],e=r[1+p],i=r[2+p];n.push({key:this.circleKeys[h],x1:t-i,y1:e-i,x2:t+i,y2:e+i})}}}}}_queryCellCircle(t,e,i,o,r,n,s,a){const l=s.circle,h=s.seenUids,p=this.boxCells[r];if(null!==p){const t=this.bboxes;for(const e of p)if(!h.box[e]){h.box[e]=!0;const i=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[0+i],t[1+i],t[2+i],t[3+i])&&(!a||a(this.boxKeys[e])))return n.push(!0),!0}}r=this.circleCells[r];if(null!==r){const t=this.circles;for(const e of r)if(!h.circle[e]){h.circle[e]=!0;const i=3*e;if(this._circlesCollide(t[i],t[1+i],t[2+i],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[e])))return n.push(!0),!0}}}_forEachCell(i,o,r,n,s,a,l,h){var t=this._convertToXCellCoord(i),p=this._convertToYCellCoord(o),c=this._convertToXCellCoord(r),u=this._convertToYCellCoord(n);for(let e=t;e<=c;e++)for(let t=p;t<=u;t++)if(s.call(this,i,o,r,n,this.xCellCount*t+e,a,l,h))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,o,r,n){t=o-t,e=r-e,n=i+n;return t*t+e*e<n*n}_circleAndRectCollide(t,e,i,o,r,n,s){n=(n-o)/2,o=Math.abs(t-(o+n));if(n+i<o)return!1;s=(s-r)/2,r=Math.abs(e-(r+s));if(s+i<r)return!1;if(o<=n||r<=s)return!0;n=o-n,s=r-s;return n*n+s*s<=i*i}}const Zt=Math.tan(85*Math.PI/180);function Gt(t,e,i,o,r){var n=K.create$1();return e?(K.scale$1(n,n,[1/r,1/r,1]),i||K.rotateZ(n,n,o.angle)):K.multiply(n,o.labelPlaneMatrix,t),n}function Vt(t,e,i,o,r){if(e){const e=K.clone$1(t);return K.scale$1(e,e,[r,r,1]),i||K.rotateZ(e,e,-o.angle),e}return o.glCoordMatrix}function Wt(t,e,i=0){t=[t.x,t.y,i,1];i?K.transformMat4(t,t,e):ee(t,t,e);e=t[3];return{point:new K.pointGeometry(t[0]/e,t[1]/e),signedDistanceFromCamera:e}}function Ht(t,e){return Math.min(.5+t/e*.5,1.5)}function qt(e,i,o,t,r,n,s,a,l){const h=t?e.textSizeData:e.iconSizeData,p=K.evaluateSizeForZoom(h,o.transform.zoom),c=[256/o.width*2+1,256/o.height*2+1],u=(t?e.text:e.icon).dynamicLayoutVertexArray;u.clear();const d=e.lineVertexArray,f=(t?e.text:e.icon).placedSymbolArray,g=o.transform.width/o.transform.height;let y=!1;for(let t=0;t<f.length;t++){var m=f.get(t);if(m.hidden||m.writingMode===K.WritingMode.vertical&&!y)te(m.numGlyphs,u);else{y=!1;var _=l?l({x:m.anchorX,y:m.anchorY}):0,v=[m.anchorX,m.anchorY,_,1];if(K.transformMat4(v,v,i),x=c,w=void 0,w=(b=v)[0]/b[3],b=b[1]/b[3],w>=-x[0]&&w<=x[0]&&b>=-x[1]&&b<=x[1]){w=Ht(o.transform.cameraToCenterDistance,v[3]),b=K.evaluateSizeForFeature(h,p,m),x=s?b/w:b*w,v=new K.pointGeometry(m.anchorX,m.anchorY),b=Wt(v,r,_);if(b.signedDistanceFromCamera<=0)te(m.numGlyphs,u);else{w=b.point;let t={};_=s?null:l,b=Kt(m,x,!1,a,i,r,n,e.glyphOffsetArray,d,u,w,v,t,g,_);y=b.useVertical,_&&b.needsFlipping&&(t={}),(b.notEnoughRoom||y||b.needsFlipping&&Kt(m,x,!0,a,i,r,n,e.glyphOffsetArray,d,u,w,v,t,g,_).notEnoughRoom)&&te(m.numGlyphs,u)}}else te(m.numGlyphs,u)}}var b,x,w;(t?e.text:e.icon).dynamicLayoutVertexBuffer.updateData(u)}function Yt(t,e,i,o,r,n,s,a,l,h,p,c,u){var d=a.glyphStartIndex+a.numGlyphs,f=a.lineStartIndex,g=a.lineStartIndex+a.lineLength,y=e.getoffsetX(a.glyphStartIndex),d=e.getoffsetX(d-1),y=Jt(t*y,i,o,r,n,s,a.segment,f,g,l,h,p,c,u,!0);if(!y)return null;u=Jt(t*d,i,o,r,n,s,a.segment,f,g,l,h,p,c,u,!0);return u?{first:y,last:u}:null}function Xt(t,e,i,o){return t.writingMode===K.WritingMode.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*o?{useVertical:!0}:t.writingMode===K.WritingMode.vertical?e.y<i.y?{needsFlipping:!0}:null:0!==t.flipState&&(0==(o=(i.x-e.x)*o)||Math.abs((i.y-e.y)/o)>Zt)?1===t.flipState?{needsFlipping:!0}:null:e.x>i.x?{needsFlipping:!0}:null}function Kt(e,t,i,o,r,n,s,a,l,h,p,c,u,d,f){var g=t/24,y=e.lineOffsetX*g,m=e.lineOffsetY*g;let _;if(1<e.numGlyphs){const K=e.glyphStartIndex+e.numGlyphs,v=e.lineStartIndex,r=e.lineStartIndex+e.lineLength,h=Yt(g,a,y,m,i,p,c,e,l,n,u,f);if(!h)return{notEnoughRoom:!0};t=Wt(h.first.point,s).point,s=Wt(h.last.point,s).point;if(o&&!i){const K=Xt(e,t,s,d);if(e.flipState=K&&K.needsFlipping?1:2,K)return K}_=[h.first];for(let t=e.glyphStartIndex+1;t<K-1;t++)_.push(Jt(g*a.getoffsetX(t),y,m,i,p,c,e.segment,v,r,l,n,u,f));_.push(h.last)}else{if(o&&!i){const v=Wt(c,r).point,i=e.lineStartIndex+e.segment+1,o=new K.pointGeometry(l.getx(i),l.gety(i)),n=Wt(o,r),b=Xt(e,v,0<n.signedDistanceFromCamera?n.point:$t(c,o,v,1,r),d);if(e.flipState=b&&b.needsFlipping?1:2,b)return b}const v=Jt(g*a.getoffsetX(e.glyphStartIndex),y,m,i,p,c,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,n,u,f);if(!v)return{notEnoughRoom:!0};_=[v]}for(const e of _)K.addDynamicAttributes(h,e.point,e.angle);return{}}function $t(t,e,i,o,r,n){const s=t.add(t.sub(e)._unit()),a=Wt(s,r,n?n(s):0).point,l=i.sub(a);return i.add(l._mult(o/l.mag()))}function Jt(t,e,i,o,r,n,s,a,l,h,p,c,u,d,f){e=o?t-e:t+e;let g=0<e?1:-1,y=0;o&&(g*=-1,y=Math.PI),g<0&&(y+=Math.PI);let m=0<g?a+s:a+s+1,_=r,v=r,b=0,x=0;const w=Math.abs(e),M=[],P=[];let E=n;const S=()=>{var t=m-g;return 0===b?n:new K.pointGeometry(h.getx(t),h.gety(t))},T=()=>$t(S(),E,v,w-b+1,p,u);for(;b+x<=w;){if(m+=g,m<a||m>=l)return null;if(v=_,M.push(_),d&&P.push(E||S()),_=c[m],void 0===_){E=new K.pointGeometry(h.getx(m),h.gety(m));const t=Wt(E,p,u?u(E):0);_=0<t.signedDistanceFromCamera?c[m]=t.point:T()}else E=null;b+=x,x=v.dist(_)}f&&u&&(E=E||new K.pointGeometry(h.getx(m),h.gety(m)),c[m]=_=void 0===c[m]?_:T(),x=v.dist(_));const A=(w-b)/x,C=_.sub(v),I=C.mult(A)._add(v);i&&I._add(C._unit()._perp()._mult(i*g));r=y+Math.atan2(_.y-v.y,_.x-v.x);return M.push(I),d&&(E=E||new K.pointGeometry(h.getx(m),h.gety(m)),P.push((e=0<P.length?P[P.length-1]:E,f=E,i=1-A,new K.pointGeometry(e.x*i+f.x*A,e.y*i+f.y*A)))),{point:I,angle:r,path:M,tilePath:P}}const Qt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function te(e,i){for(let t=0;t<e;t++){const e=i.length;i.resize(e+4),i.float32.set(Qt,3*e)}}function ee(t,e,i){var o=e[0],e=e[1];return t[0]=i[0]*o+i[4]*e+i[12],t[1]=i[1]*o+i[5]*e+i[13],t[3]=i[3]*o+i[7]*e+i[15],t}class ie{constructor(t,e,i=new jt(t.width+200,t.height+200,25),o=new jt(t.width+200,t.height+200,25)){this.transform=t,this.grid=i,this.ignoredGrid=o,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,i,o,r,n,s){var a=this.projectAndGetPerspectiveRatio(n,e.anchorPointX,e.anchorPointY,e.elevation,e.tileID),l=r*a.perspectiveRatio,h=(e.x1*t+i.x-e.padding)*l+a.point.x,n=(e.y1*t+i.y-e.padding)*l+a.point.y,r=(e.x2*t+i.x+e.padding)*l+a.point.x,l=(e.y2*t+i.y+e.padding)*l+a.point.y,a=a.perspectiveRatio<=.55||a.aboveHorizon;return!this.isInsideGrid(h,n,r,l)||!o&&this.grid.hitTest(h,n,r,l,s)||a?{box:[],offscreen:!1}:{box:[h,n,r,l],offscreen:this.isOffscreen(h,n,r,l)}}placeCollisionCircles(i,o,r,n,s,a,l,h,p,c,u,d,f,g){const y=[],m=this.transform.elevation,_=m?t=>m.getAtTileOffset(g,t.x,t.y):t=>0,t=new K.pointGeometry(o.anchorX,o.anchorY),e=_(t),v=this.projectAndGetPerspectiveRatio(a,t.x,t.y,e,g),{perspectiveRatio:b}=v,x=(c?s/b:s*b)/K.ONE_EM,w=Wt(t,l,e).point,M=0<v.signedDistanceFromCamera?Yt(x,n,o.lineOffsetX*x,o.lineOffsetY*x,!1,w,t,o,r,l,{},m&&!c?_:null,c&&!!m):null;let P=!1,E=!1,S=!0;if(M&&!v.aboveHorizon){const o=.5*d*b+f,r=new K.pointGeometry(-100,-100),n=new K.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),s=new Bt,a=M.first,l=M.last;let e=[];for(let t=a.path.length-1;1<=t;t--)e.push(a.path[t]);for(let t=1;t<l.path.length;t++)e.push(l.path[t]);const g=2.5*o;if(h){const K=e.map(m?(t,e)=>{e=_(e<a.path.length-1?a.tilePath[a.path.length-1-e]:l.tilePath[e-a.path.length+2]);return Wt(t,h,e)}:t=>Wt(t,h));e=K.some(t=>t.signedDistanceFromCamera<=0)?[]:K.map(t=>t.point)}let t=[];if(0<e.length){const i=e[0].clone(),o=e[0].clone();for(let t=1;t<e.length;t++)i.x=Math.min(i.x,e[t].x),i.y=Math.min(i.y,e[t].y),o.x=Math.max(o.x,e[t].x),o.y=Math.max(o.y,e[t].y);t=i.x>=r.x&&o.x<=n.x&&i.y>=r.y&&o.y<=n.y?[e]:o.x<r.x||i.x>n.x||o.y<r.y||i.y>n.y?[]:K.clipLine([e],r.x,r.y,n.x,n.y)}for(const K of t){s.reset(K,.25*o);var T=s.length<=.5*o?1:Math.ceil(s.paddedLength/g)+1;for(let t=0;t<T;t++){const n=t/Math.max(T-1,1),a=s.lerp(n),l=a.x+100,h=a.y+100;y.push(l,h,o,0);const c=l-o,d=h-o,f=l+o,g=h+o;if(S=S&&this.isOffscreen(c,d,f,g),E=E||this.isInsideGrid(c,d,f,g),!i&&this.grid.hitTestCircle(l,h,o,u)&&(P=!0,!p))return{circles:[],offscreen:!1,collisionDetected:P}}}}return{circles:!p&&P||!E?[]:y,offscreen:S,collisionDetected:P}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const e=[];let i=1/0,o=1/0,r=-1/0,n=-1/0;for(const s of t){const t=new K.pointGeometry(s.x+100,s.y+100);i=Math.min(i,t.x),o=Math.min(o,t.y),r=Math.max(r,t.x),n=Math.max(n,t.y),e.push(t)}const s=this.grid.query(i,o,r,n).concat(this.ignoredGrid.query(i,o,r,n)),a={},l={};for(const t of s){const i=t.key;if(void 0===a[i.bucketInstanceId]&&(a[i.bucketInstanceId]={}),!a[i.bucketInstanceId][i.featureIndex]){const o=[new K.pointGeometry(t.x1,t.y1),new K.pointGeometry(t.x2,t.y1),new K.pointGeometry(t.x2,t.y2),new K.pointGeometry(t.x1,t.y2)];K.polygonIntersectsPolygon(e,o)&&(a[i.bucketInstanceId][i.featureIndex]=!0,void 0===l[i.bucketInstanceId]&&(l[i.bucketInstanceId]=[]),l[i.bucketInstanceId].push(i.featureIndex))}}return l}insertCollisionBox(t,e,i,o,r){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:o,collisionGroupID:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(e,t,i,o,r){const n=t?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:o,collisionGroupID:r};for(let t=0;t<e.length;t+=4)n.insertCircle(s,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(e,i,o,r,n){var s=[i,o,r||0,1];let a=!1;if(r||0<this.transform.pitch){K.transformMat4(s,s,e);let t=!1;this.fogState&&n&&(t=.9<function(t,e,i,o,r,n){r=n.calculateFogTileMatrix(r),o=[e,i,o];return K.transformMat4$1(o,o,r),v(t,o,n.pitch,n._fov)}(this.fogState,i,o,r||0,n.toUnwrapped(),this.transform)),a=s[3]<s[2]||t}else ee(s,s,e);return{point:new K.pointGeometry((s[0]/s[3]+1)/2*this.transform.width+100,(-s[1]/s[3]+1)/2*this.transform.height+100),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/s[3]*.5,1.5),signedDistanceFromCamera:s[3],aboveHorizon:a}}isOffscreen(t,e,i,o){return i<100||t>=this.screenRightBoundary||o<100||e>this.screenBottomBoundary}isInsideGrid(t,e,i,o){return 0<=i&&t<this.gridRightBoundary&&0<=o&&e<this.gridBottomBoundary}getViewportMatrix(){var t=K.identity([]);return K.translate(t,t,[-100,-100,0]),t}}class oe{constructor(t,e,i,o){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):o&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class re{constructor(t,e,i,o,r){this.text=new oe(t?t.text:null,e,i,r),this.icon=new oe(t?t.icon:null,e,o,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ne{constructor(t,e,i){this.text=t,this.icon=e,this.skipFade=i}}class se{constructor(){this.invProjMatrix=K.create$1(),this.viewportMatrix=K.create$1(),this.circles=[]}}class ae{constructor(t,e,i,o,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=o,this.tileID=r}}class le{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function he(t,e,i,o,r){var{horizontalAlign:n,verticalAlign:s}=K.getAnchorAlignment(t),e=-(n-.5)*e,i=-(s-.5)*i,o=K.evaluateVariableOffset(t,o);return new K.pointGeometry(e+o[0]*r,i+o[1]*r)}function pe(t,e,i,o,r){const n=new K.pointGeometry(t,e);return i&&n._rotate(o?r:-r),n}class ce{constructor(t,e,i,o,r){this.transform=t.clone(),this.collisionIndex=new ie(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new le(i),this.collisionCircleArrays={},(this.prevPlacement=o)&&(o.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,o,r){var n=o.getBucket(i),s=o.latestFeatureIndex;if(n&&s&&i.id===n.layerIds[0]){const l=o.collisionBoxArray,h=n.layers[0].layout,p=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),c=o.tileSize/K.EXTENT,u=this.transform.calculateProjMatrix(o.tileID.toUnwrapped()),d="map"===h.get("text-pitch-alignment"),f="map"===h.get("text-rotation-alignment"),g=$(o,1,this.transform.zoom),y=Gt(u,d,f,this.transform,g);let t=null;if(d){const e=Vt(u,d,f,this.transform,g);t=K.multiply([],this.transform.labelPlaneMatrix,e)}this.retainedQueryData[n.bucketInstanceId]=new ae(n.bucketInstanceId,s,n.sourceLayerIndex,n.index,o.tileID);var a={bucket:n,layout:h,posMatrix:u,textLabelPlaneMatrix:y,labelToScreenMatrix:t,scale:p,textPixelRatio:c,holdingForFade:o.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:K.evaluateSizeForZoom(n.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:K.evaluateSizeForZoom(n.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(n.sourceID)};if(r)for(const K of n.sortKeyRanges){const{sortKey:i,symbolInstanceStart:o,symbolInstanceEnd:r}=K;e.push({sortKey:i,symbolInstanceStart:o,symbolInstanceEnd:r,parameters:a})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:n.symbolInstances.length,parameters:a})}}attemptAnchorPlacement(e,i,o,r,n,t,s,a,l,h,p,c,u,d,f,g,y,m){var _=[c.textOffset0,c.textOffset1],v=he(e,o,r,_,n),i=this.collisionIndex.placeCollisionBox(n,i,pe(v.x,v.y,t,s,this.transform.angle),p,a,l,h.predicate);if((!g||0!==this.collisionIndex.placeCollisionBox(d.getSymbolInstanceIconSize(m,this.transform.zoom,u),g,pe(v.x,v.y,t,s,this.transform.angle),p,a,l,h.predicate).box.length)&&0<i.box.length){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[c.crossTileID]&&this.prevPlacement.placements[c.crossTileID]&&this.prevPlacement.placements[c.crossTileID].text&&(t=this.prevPlacement.variableOffsets[c.crossTileID].anchor),this.variableOffsets[c.crossTileID]={textOffset:_,width:o,height:r,anchor:e,textScale:n,prevAnchor:t},this.markUsedJustification(d,e,c,f),d.allowVerticalPlacement&&(this.markUsedOrientation(d,f,c),this.placedOrientations[c.crossTileID]=f),{shift:v,placedGlyphBoxes:i}}}placeLayerBucketPart(e,v,b){const{bucket:x,layout:w,posMatrix:M,textLabelPlaneMatrix:P,labelToScreenMatrix:E,textPixelRatio:S,holdingForFade:T,collisionBoxArray:t,partiallyEvaluatedTextSize:A,partiallyEvaluatedIconSize:C,collisionGroup:I}=e.parameters,L=w.get("text-optional"),O=w.get("icon-optional"),R=w.get("text-allow-overlap"),D=w.get("icon-allow-overlap"),k="map"===w.get("text-rotation-alignment"),z="map"===w.get("text-pitch-alignment"),F="none"!==w.get("icon-text-fit"),i="viewport-y"===w.get("symbol-z-order"),N=R&&(D||!x.hasIconData()||O),U=D&&(R||!x.hasTextData()||L);!x.collisionArrays&&t&&x.deserializeCollisionBoxes(t),b&&x.updateCollisionDebugBuffers(this.transform.zoom,t);var o=(u,d,f)=>{if(!v[u.crossTileID])if(T)this.placements[u.crossTileID]=new ne(!1,!1,!1);else{let p=!1,t=!1,e=!0,c=null,i={box:null,offscreen:null},o={box:null,offscreen:null},r,n=null,s=null,a=0,l=0,h=0;f.textFeatureIndex?a=f.textFeatureIndex:u.useRuntimeCollisionCircles&&(a=u.featureIndex),f.verticalTextFeatureIndex&&(l=f.verticalTextFeatureIndex);const m=t=>{t.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||t.elevation)&&(t.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,t.anchorPointX,t.anchorPointY):0)},_=f.textBox;if(_){m(_);const v=t=>{let e=K.WritingMode.horizontal;if(x.allowVerticalPlacement&&!t&&this.prevPlacement){const K=this.prevPlacement.placedOrientations[u.crossTileID];K&&(this.placedOrientations[u.crossTileID]=K,e=K,this.markUsedOrientation(x,e,u))}return e},b=(t,e)=>{if(x.allowVerticalPlacement&&0<u.numVerticalGlyphVertices&&f.verticalTextBox){for(const u of x.writingModes)if(u===K.WritingMode.vertical?(i=e(),o=i):i=t(),i&&i.box&&i.box.length)break}else i=t()};if(w.get("text-variable-anchor")){let h=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[u.crossTileID]){const K=this.prevPlacement.variableOffsets[u.crossTileID];0<h.indexOf(K.anchor)&&(h=h.filter(t=>t!==K.anchor),h.unshift(K.anchor))}const E=(e,t,i)=>{var o=x.getSymbolInstanceTextSize(A,u,this.transform.zoom,d),r=(e.x2-e.x1)*o+2*e.padding,n=(e.y2-e.y1)*o+2*e.padding,s=F&&!D?t:null;s&&m(s);let a={box:[],offscreen:!1};var l=R?2*h.length:h.length;for(let t=0;t<l;++t){const R=this.attemptAnchorPlacement(h[t%h.length],e,r,n,o,k,z,S,M,I,t>=h.length,u,d,x,i,s,A,C);if(R&&(a=R.placedGlyphBoxes,a&&a.box&&a.box.length)){p=!0,c=R.shift;break}}return a};b(()=>E(_,f.iconBox,K.WritingMode.horizontal),()=>{var t=f.verticalTextBox;return t&&m(t),x.allowVerticalPlacement&&!(i&&i.box&&i.box.length)&&0<u.numVerticalGlyphVertices&&t?E(t,f.verticalIconBox,K.WritingMode.vertical):{box:null,offscreen:null}}),i&&(p=i.box,e=i.offscreen);const T=v(i&&i.box);if(!p&&this.prevPlacement){const K=this.prevPlacement.variableOffsets[u.crossTileID];K&&(this.variableOffsets[u.crossTileID]=K,this.markUsedJustification(x,K.anchor,u,T))}}else{const w=(t,e)=>{var i=x.getSymbolInstanceTextSize(A,u,this.transform.zoom,d),t=this.collisionIndex.placeCollisionBox(i,t,new K.pointGeometry(0,0),R,S,M,I.predicate);return t&&t.box&&t.box.length&&(this.markUsedOrientation(x,e,u),this.placedOrientations[u.crossTileID]=e),t};b(()=>w(_,K.WritingMode.horizontal),()=>{var t=f.verticalTextBox;return x.allowVerticalPlacement&&0<u.numVerticalGlyphVertices&&t?(m(t),w(t,K.WritingMode.vertical)):{box:null,offscreen:null}}),v(i&&i.box&&i.box.length)}}if(r=i,p=r&&r.box&&0<r.box.length,e=r&&r.offscreen,u.useRuntimeCollisionCircles){const v=x.text.placedSymbolArray.get(u.centerJustifiedTextSymbolIndex),S=K.evaluateSizeForFeature(x.textSizeData,A,v),T=w.get("text-padding");n=this.collisionIndex.placeCollisionCircles(R,v,x.lineVertexArray,x.glyphOffsetArray,S,M,P,E,b,z,I.predicate,u.collisionCircleDiameter,T,this.retainedQueryData[x.bucketInstanceId].tileID),p=R||0<n.circles.length&&!n.collisionDetected,e=e&&n.offscreen}if(f.iconFeatureIndex&&(h=f.iconFeatureIndex),f.iconBox){const u=t=>{m(t);var e=F&&c?pe(c.x,c.y,k,z,this.transform.angle):new K.pointGeometry(0,0),i=x.getSymbolInstanceIconSize(C,this.transform.zoom,d);return this.collisionIndex.placeCollisionBox(i,t,e,D,S,M,I.predicate)};t=(s=o&&o.box&&o.box.length&&f.verticalIconBox?u(f.verticalIconBox):u(f.iconBox),0<s.box.length),e=e&&s.offscreen}var g=L||0===u.numHorizontalGlyphVertices&&0===u.numVerticalGlyphVertices,y=O||0===u.numIconVertices;if(g||y?y?g||(t=t&&p):p=t&&p:t=p=t&&p,p&&r&&r.box&&this.collisionIndex.insertCollisionBox(r.box,w.get("text-ignore-placement"),x.bucketInstanceId,o&&o.box&&l?l:a,I.ID),t&&s&&this.collisionIndex.insertCollisionBox(s.box,w.get("icon-ignore-placement"),x.bucketInstanceId,h,I.ID),n&&(p&&this.collisionIndex.insertCollisionCircles(n.circles,w.get("text-ignore-placement"),x.bucketInstanceId,a,I.ID),b)){const K=x.bucketInstanceId;let e=this.collisionCircleArrays[K];void 0===e&&(e=this.collisionCircleArrays[K]=new se);for(let t=0;t<n.circles.length;t+=4)e.circles.push(n.circles[t+0]),e.circles.push(n.circles[t+1]),e.circles.push(n.circles[t+2]),e.circles.push(n.collisionDetected?1:0)}this.placements[u.crossTileID]=new ne(p||N,t||U,e||x.justReloaded),v[u.crossTileID]=!0}};if(i){const K=x.getSortedSymbolIndexes(this.transform.angle);for(let t=K.length-1;0<=t;--t){const v=K[t];o(x.symbolInstances.get(v),v,x.collisionArrays[v])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)o(x.symbolInstances.get(t),t,x.collisionArrays[t]);if(b&&x.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[x.bucketInstanceId];K.invert(e.invProjMatrix,M),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,e,i,o){var r=o===K.WritingMode.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[K.getAnchorJustification(e)];for(const K of[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex])0<=K&&(t.text.placedSymbolArray.get(K).crossTileID=0<=r&&K!==r?0:i.crossTileID)}markUsedOrientation(t,e,i){var o=e===K.WritingMode.horizontal||e===K.WritingMode.horizontalOnly?e:0,e=e===K.WritingMode.vertical?e:0;for(const K of[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex])t.text.placedSymbolArray.get(K).placedOrientation=o;i.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=e)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const o=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},n=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],n=r[t];i=n?(this.opacities[t]=new re(n,o,e.text,e.icon),i||e.text!==n.text.placed||e.icon!==n.icon.placed):(this.opacities[t]=new re(null,o,e.text,e.icon,e.skipFade),i||e.text||e.icon)}for(const t in r){const e=r[t];if(!this.opacities[t]){const r=new re(e,o,!1,!1);r.isHidden()||(this.opacities[t]=r,i=i||e.text.placed||e.icon.placed)}}for(const t in n)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=n[t]);for(const t in s)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=s[t]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){var i={};for(const o of e){const e=o.getBucket(t);e&&o.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,i,o.collisionBoxArray)}}updateBucketOpacities(o,r,e){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const n=o.layers[0].layout,s=new re(null,0,!1,!1,!0),a=n.get("text-allow-overlap"),l=n.get("icon-allow-overlap"),h=n.get("text-variable-anchor"),p="map"===n.get("text-rotation-alignment"),c="map"===n.get("text-pitch-alignment"),u="none"!==n.get("icon-text-fit"),d=new re(null,0,a&&(l||!o.hasIconData()||n.get("icon-optional")),l&&(a||!o.hasTextData()||n.get("text-optional")),!0);!o.collisionArrays&&e&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(e);var f=(e,i,o)=>{for(let t=0;t<i/4;t++)e.opacityVertexArray.emplaceBack(o)};for(let t=0;t<o.symbolInstances.length;t++){const n=o.symbolInstances.get(t),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:l,crossTileID:g}=n;let i=this.opacities[g];r[g]?i=s:i||(i=d,this.opacities[g]=i),r[g]=!0;const y=0<n.numIconVertices,m=this.placedOrientations[n.crossTileID],_=m===K.WritingMode.vertical,v=m===K.WritingMode.horizontal||m===K.WritingMode.horizontalOnly;if(0<a||0<l){const K=be(i.text);f(o.text,a,_?xe:K),f(o.text,l,v?xe:K);const r=i.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach(t=>{0<=t&&(o.text.placedSymbolArray.get(t).hidden=r||_?1:0)}),0<=n.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=r||v?1:0);const e=this.variableOffsets[n.crossTileID];e&&this.markUsedJustification(o,e.anchor,n,m);const s=this.placedOrientations[n.crossTileID];s&&(this.markUsedJustification(o,"left",n,s),this.markUsedOrientation(o,s,n))}if(y){const K=be(i.icon),r=!(u&&n.verticalPlacedIconSymbolIndex&&_);0<=n.placedIconSymbolIndex&&(f(o.icon,n.numIconVertices,r?K:xe),o.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=i.icon.isHidden()),0<=n.verticalPlacedIconSymbolIndex&&(f(o.icon,n.numVerticalIconVertices,r?xe:K),o.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=i.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const r=o.collisionArrays[t];if(r){let e=new K.pointGeometry(0,0);if(r.textBox||r.verticalTextBox){let t=!0;if(h){const o=this.variableOffsets[g];o?(e=he(o.anchor,o.width,o.height,o.textOffset,o.textScale),p&&e._rotate(c?this.transform.angle:-this.transform.angle)):t=!1}r.textBox&&ue(o.textCollisionBox.collisionVertexArray,i.text.placed,!t||_,e.x,e.y),r.verticalTextBox&&ue(o.textCollisionBox.collisionVertexArray,i.text.placed,!t||v,e.x,e.y)}const n=Boolean(!v&&r.verticalIconBox);r.iconBox&&ue(o.iconCollisionBox.collisionVertexArray,i.icon.placed,n,u?e.x:0,u?e.y:0),r.verticalIconBox&&ue(o.iconCollisionBox.collisionVertexArray,i.icon.placed,!n,u?e.x:0,u?e.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=K.invProjMatrix,o.placementViewportMatrix=K.viewportMatrix,o.collisionCircleArray=K.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){var i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function ue(t,e,i,o,r){t.emplaceBack(e?1:0,i?1:0,o||0,r||0),t.emplaceBack(e?1:0,i?1:0,o||0,r||0),t.emplaceBack(e?1:0,i?1:0,o||0,r||0),t.emplaceBack(e?1:0,i?1:0,o||0,r||0)}const de=Math.pow(2,25),fe=Math.pow(2,24),ge=Math.pow(2,17),ye=Math.pow(2,16),me=Math.pow(2,9),_e=Math.pow(2,8),ve=Math.pow(2,1);function be(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,t=Math.floor(127*t.opacity);return t*de+e*fe+t*ge+e*ye+t*me+e*_e+t*ve+e}const xe=0;class we{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,i,o,r){const n=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(n,o,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,n.sort((t,e)=>t.sortKey-e.sortKey));this._currentPartIndex<n.length;)if(e.placeLayerBucketPart(n[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,r())return!0;return!1}}class Me{constructor(t,e,i,o,r,n,s,a){this.placement=new ce(t,r,n,s,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=o,this._done=!1}isDone(){return this._done}continuePlacement(t,e,i){const o=K.exported.now(),r=()=>{var t=K.exported.now()-o;return!this._forceFullPlacement&&2<t};for(;0<=this._currentPlacementIndex;){const K=e[t[this._currentPlacementIndex]],o=this.placement.collisionIndex.transform.zoom;if("symbol"===K.type&&(!K.minzoom||K.minzoom<=o)&&(!K.maxzoom||K.maxzoom>o)){if(this._inProgressLayer||(this._inProgressLayer=new we(K)),this._inProgressLayer.continuePlacement(i[K.source],this.placement,this._showCollisionBoxes,K,r))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Pe=512/K.EXTENT/2;class Ee{constructor(e,i,t){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=t;for(let t=0;t<i.length;t++){var o=i.get(t),r=o.key;this.indexedSymbolInstances[r]||(this.indexedSymbolInstances[r]=[]),this.indexedSymbolInstances[r].push({crossTileID:o.crossTileID,coord:this.getScaledCoordinates(o,e)})}}getScaledCoordinates(t,e){var i=Pe/Math.pow(2,e.canonical.z-this.tileID.canonical.z);return{x:Math.floor((e.canonical.x*K.EXTENT+t.anchorX)*i),y:Math.floor((e.canonical.y*K.EXTENT+t.anchorY)*i)}}findMatches(e,i,o){var r=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let t=0;t<e.length;t++){const a=e.get(t);if(!a.crossTileID){var n=this.indexedSymbolInstances[a.key];if(n){var s=this.getScaledCoordinates(a,i);for(const e of n)if(Math.abs(e.coord.x-s.x)<=r&&Math.abs(e.coord.y-s.y)<=r&&!o[e.crossTileID]){o[e.crossTileID]=!0,a.crossTileID=e.crossTileID;break}}}}}}class Se{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Te{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],o={};for(const t in i){const r=i[t];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),o[r.tileID.key]=r}this.indexes[t]=o}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const o=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){var r=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in r){const n=r[i];n.tileID.isChildOf(t)&&n.findMatches(e.symbolInstances,t,o)}else{const s=r[t.scaledTo(Number(i)).key];s&&s.findMatches(e.symbolInstances,t,o)}}for(let t=0;t<e.symbolInstances.length;t++){const a=e.symbolInstances.get(t);a.crossTileID||(a.crossTileID=i.generate(),o[a.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ee(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i in e.indexedSymbolInstances)for(const o of e.indexedSymbolInstances[i])delete this.usedCrossTileIDs[t][o.crossTileID]}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const o=this.indexes[i];for(const r in o)t[o[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,o[r]),delete o[r],e=!0)}return e}}class Ae{constructor(){this.layerIndexes={},this.crossTileIDs=new Se,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i){let o=this.layerIndexes[t.id];void 0===o&&(o=this.layerIndexes[t.id]=new Te);let r=!1;const n={};o.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(i.tileID,e,this.crossTileIDs)&&(r=!0),n[e.bucketInstanceId]=!0)}return o.removeStaleBuckets(n)&&(r=!0),r}pruneUnusedLayers(t){const e={};t.forEach(t=>{e[t]=!0});for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}const Ce=(t,e)=>K.emitValidationErrors(t,e&&e.filter(t=>"source.canvas"!==t.identifier)),Ie=K.pick(Dt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),Le=K.pick(Dt,["setCenter","setZoom","setBearing","setPitch"]),Oe=function(){const t={},e=K.spec.$version;for(const r in K.spec.$root){var i,o=K.spec.$root[r];!o.required||(i=null)!=(i="version"===r?e:"array"===o.type?[]:{})&&(t[r]=i)}return t}(),Re={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class De extends K.Evented{constructor(t,e={}){super(),this.map=t,this.dispatcher=new P(Ot(),this),this.imageManager=new h,this.imageManager.setEventedParent(this),this.glyphManager=new K.GlyphManager(t._requestManager,e.localFontFamily?K.LocalGlyphMode.all:e.localIdeographFontFamily?K.LocalGlyphMode.ideographs:K.LocalGlyphMode.none,e.localFontFamily||e.localIdeographFontFamily),this.lineAtlas=new K.LineAtlas(256,512),this.crossTileSymbolIndex=new Ae,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new K.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",K.getReferrer());const i=this;this._rtlTextPluginCallback=De.registerForPluginStateChange(t=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(t,e)=>{if(K.triggerPluginCompletionEvent(t),e&&e.every(t=>t))for(const K in i._sourceCaches){const t=i._sourceCaches[K],e=t.getSource().type;"vector"!==e&&"geojson"!==e||t.reload()}})}),this.on("data",t=>{if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=this.getSource(t.sourceId);if(e&&e.vectorLayerIds)for(const t in this._layers){var i=this._layers[t];i.source===e.id&&this._validateLayer(i)}}})}loadURL(t,e={}){this.fire(new K.Event("dataloading",{dataType:"style"}));const i="boolean"==typeof e.validate?e.validate:!K.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,e.accessToken);t=this.map._requestManager.transformRequest(t,K.ResourceType.Style);this._request=K.getJSON(t,(t,e)=>{this._request=null,t?this.fire(new K.ErrorEvent(t)):e&&this._load(e,i)})}loadJSON(t,e={}){this.fire(new K.Event("dataloading",{dataType:"style"})),this._request=K.exported.frame(()=>{this._request=null,this._load(t,!1!==e.validate)})}loadEmpty(){this.fire(new K.Event("dataloading",{dataType:"style"})),this._load(Oe,!1)}_updateLayerCount(t,e){e=e?1:-1;t.is3D()&&(this._num3DLayers+=e),"circle"===t.type&&(this._numCircleLayers+=e),"symbol"===t.type&&(this._numSymbolLayers+=e)}_load(t,e){if(!e||!Ce(this,K.validateStyle(t))){this._loaded=!0;for(const K in(this.stylesheet=t).sources)this.addSource(K,t.sources[K],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const o=Rt(this.stylesheet.layers);this._order=o.map(t=>t.id),this._layers={},this._serializedLayers={};for(var i of o)i=K.createStyleLayer(i),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i,this._serializedLayers[i.id]=i.serialize(),this._updateLayerCount(i,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new f(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new K.Event("data",{dataType:"style"})),this.fire(new K.Event("style.load"))}}_loadSprite(t){this._spriteRequest=function(t,e,p){let c,u,d;var i=1<K.exported.devicePixelRatio?"@2x":"";let o=K.getJSON(e.transformRequest(e.normalizeSpriteURL(t,i,".json"),K.ResourceType.SpriteJSON),(t,e)=>{o=null,d||(d=t,c=e,n())}),r=K.getImage(e.transformRequest(e.normalizeSpriteURL(t,i,".png"),K.ResourceType.SpriteImage),(t,e)=>{r=null,d||(d=t,u=e,n())});function n(){if(d)p(d);else if(c&&u){const t=K.exported.getImageData(u),e={};for(const p in c){const{width:u,height:d,x:i,y:o,sdf:r,pixelRatio:n,stretchX:s,stretchY:a,content:l}=c[p],h=new K.RGBAImage({width:u,height:d});K.RGBAImage.copy(t,h,{x:i,y:o},{x:0,y:0},{width:u,height:d}),e[p]={data:h,pixelRatio:n,sdf:r,stretchX:s,stretchY:a,content:l}}p(null,e)}}return{cancel(){o&&(o.cancel(),o=null),r&&(r.cancel(),r=null)}}}(t,this.map._requestManager,(t,e)=>{if(this._spriteRequest=null,t)this.fire(new K.ErrorEvent(t));else if(e)for(const K in e)this.imageManager.addImage(K,e[K]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new K.Event("data",{dataType:"style"}))})}_validateLayer(t){const e=this.getSource(t.source);var i;!e||(i=t.sourceLayer)&&("geojson"===e.type||e.vectorLayerIds&&-1===e.vectorLayerIds.indexOf(i))&&this.fire(new K.ErrorEvent(new Error(`Source layer "${i}" does not exist on source "${e.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const e=[];for(const i of t){const t=this._layers[i];"custom"!==t.type&&e.push(t.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Re[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(this._loaded){const i=this._changed;if(this._changed){const K=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(K.length||i.length)&&this._updateWorkerLayers(K,i);for(const K in this._updatedSources){const t=this._updatedSources[K];"reload"===t?this._reloadSource(K):"clear"===t&&this._clearSource(K)}this._updateTilesForChangedImages();for(const K in this._updatedPaintProps)this._layers[K].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const o={};for(const K in this._sourceCaches){const t=this._sourceCaches[K];o[K]=t.used,t.used=!1}for(const K of this._order){const i=this._layers[K];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const K=this._getLayerSourceCache(i);K&&(K.used=!0)}const o=this.map.painter;if(o){const K=i.getProgramIds();if(K){var e=i.getProgramConfiguration(t.zoom);for(const t of K)o.useProgram(t,e)}}}for(const t in o){const i=this._sourceCaches[t];o[t]!==i.used&&i.getSource().fire(new K.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new K.Event("data",{dataType:"style"}))}}_updateTilesForChangedImages(){var t=Object.keys(this._changedImages);if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),Ce(this,K.validateStyle(t)))return!1;(t=K.clone$2(t)).layers=Rt(t.layers);const e=function(e,i){if(!e)return[{command:Dt.setStyle,args:[i]}];let o=[];try{if(!y(e.version,i.version))return[{command:Dt.setStyle,args:[i]}];y(e.center,i.center)||o.push({command:Dt.setCenter,args:[i.center]}),y(e.zoom,i.zoom)||o.push({command:Dt.setZoom,args:[i.zoom]}),y(e.bearing,i.bearing)||o.push({command:Dt.setBearing,args:[i.bearing]}),y(e.pitch,i.pitch)||o.push({command:Dt.setPitch,args:[i.pitch]}),y(e.sprite,i.sprite)||o.push({command:Dt.setSprite,args:[i.sprite]}),y(e.glyphs,i.glyphs)||o.push({command:Dt.setGlyphs,args:[i.glyphs]}),y(e.transition,i.transition)||o.push({command:Dt.setTransition,args:[i.transition]}),y(e.light,i.light)||o.push({command:Dt.setLight,args:[i.light]}),y(e.fog,i.fog)||o.push({command:Dt.setFog,args:[i.fog]});const r={},n=[];!function(t,e,i,o){let r;for(r in e=e||{},t=t||{})t.hasOwnProperty(r)&&(e.hasOwnProperty(r)||zt(r,i,o));for(r in e)e.hasOwnProperty(r)&&(t.hasOwnProperty(r)?y(t[r],e[r])||("geojson"===t[r].type&&"geojson"===e[r].type&&function(t,e,i){let o;for(o in t[i])if(t[i].hasOwnProperty(o)&&"data"!==o&&!y(t[i][o],e[i][o]))return;for(o in e[i])if(e[i].hasOwnProperty(o)&&"data"!==o&&!y(t[i][o],e[i][o]))return;return 1}(t,e,r)?i.push({command:Dt.setGeoJSONSourceData,args:[r,e[r].data]}):(n=r,s=e,a=i,l=o,zt(n,a,l),kt(n,s,a))):kt(r,e,i));var n,s,a,l}(e.sources,i.sources,n,r);const s=[];e.layers&&e.layers.forEach(t=>{r[t.source]?o.push({command:Dt.removeLayer,args:[t.id]}):s.push(t)});let t=e.terrain;t&&r[t.source]&&(o.push({command:Dt.setTerrain,args:[void 0]}),t=void 0),o=o.concat(n),y(t,i.terrain)||o.push({command:Dt.setTerrain,args:[i.terrain]}),function(t,e,i){e=e||[];const o=(t=t||[]).map(Nt),r=e.map(Nt),n=t.reduce(Ut,{}),s=e.reduce(Ut,{}),a=o.slice(),l=Object.create(null);let h,p,c,u,d,f,g;for(h=0,p=0;h<o.length;h++)c=o[h],s.hasOwnProperty(c)?p++:(i.push({command:Dt.removeLayer,args:[c]}),a.splice(a.indexOf(c,p),1));for(h=0,p=0;h<r.length;h++)c=r[r.length-1-h],a[a.length-1-h]!==c&&(n.hasOwnProperty(c)?(i.push({command:Dt.removeLayer,args:[c]}),a.splice(a.lastIndexOf(c,a.length-p),1)):p++,f=a[a.length-h],i.push({command:Dt.addLayer,args:[s[c],f]}),a.splice(a.length-h,0,c),l[c]=!0);for(h=0;h<r.length;h++)if(c=r[h],u=n[c],d=s[c],!l[c]&&!y(u,d))if(y(u.source,d.source)&&y(u["source-layer"],d["source-layer"])&&y(u.type,d.type)){for(g in Ft(u.layout,d.layout,i,c,null,Dt.setLayoutProperty),Ft(u.paint,d.paint,i,c,null,Dt.setPaintProperty),y(u.filter,d.filter)||i.push({command:Dt.setFilter,args:[c,d.filter]}),y(u.minzoom,d.minzoom)&&y(u.maxzoom,d.maxzoom)||i.push({command:Dt.setLayerZoomRange,args:[c,d.minzoom,d.maxzoom]}),u)u.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Ft(u[g],d[g],i,c,g.slice(6),Dt.setPaintProperty):y(u[g],d[g])||i.push({command:Dt.setLayerProperty,args:[c,g,d[g]]}));for(g in d)d.hasOwnProperty(g)&&!u.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Ft(u[g],d[g],i,c,g.slice(6),Dt.setPaintProperty):y(u[g],d[g])||i.push({command:Dt.setLayerProperty,args:[c,g,d[g]]}))}else i.push({command:Dt.removeLayer,args:[c]}),f=a[a.lastIndexOf(c)+1],i.push({command:Dt.addLayer,args:[d,f]})}(s,i.layers,o)}catch(e){console.warn("Unable to compute style diff:",e),o=[{command:Dt.setStyle,args:[i]}]}return o}(this.serialize(),t).filter(t=>!(t.command in Le));if(0===e.length)return!1;const i=e.filter(t=>!(t.command in Ie));if(0<i.length)throw new Error(`Unimplemented: ${i.map(t=>t.command).join(", ")}.`);return e.forEach(t=>{"setTransition"!==t.command&&this[t.command].apply(this,t.args)}),this.stylesheet=t,!0}addImage(t,e){if(this.getImage(t))return this.fire(new K.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,e),this._afterImageUpdated(t)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new K.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new K.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,t,e={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!t.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(t).join(", ")}.`);if(!(0<=["vector","raster","geojson","video","image"].indexOf(t.type)&&this._validate(K.validateStyle.source,`sources.${o}`,t,null,e))){this.map&&this.map._collectResourceTiming&&(t.collectResourceTiming=!0);const r=Et(o,t,this.dispatcher,this);r.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:r.serialize(),sourceId:o}));e=t=>{const e=(t?"symbol:":"other:")+o,i=this._sourceCaches[e]=new K.SourceCache(e,r,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[o]=i,i.style=this,i.onAdd(this.map)};e(!1),"vector"!==t.type&&"geojson"!==t.type||e(!0),r.onAdd&&r.onAdd(this.map),this._changed=!0}}removeSource(t){this._checkLoaded();const e=this.getSource(t);if(void 0===e)throw new Error("There is no source with this ID");for(const e in this._layers)if(this._layers[e].source===t)return this.fire(new K.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${e}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new K.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));var i=this._getSourceCaches(t);for(const t of i)delete this._sourceCaches[t.id],delete this._updatedSources[t.id],t.fire(new K.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles();delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],e.setEventedParent(null),e.onRemove&&e.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getSource(t).setData(e),this._changed=!0}getSource(t){const e=this._getSourceCache(t);return e&&e.getSource()}addLayer(e,i,o={}){this._checkLoaded();var r=e.id;if(this.getLayer(r))this.fire(new K.ErrorEvent(new Error(`Layer with id "${r}" already exists on this map`)));else{let t;if("custom"===e.type){if(Ce(this,K.validateCustomStyleLayer(e)))return;t=K.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=K.clone$2(e),e=K.extend(e,{source:r})),this._validate(K.validateStyle.layer,`layers.${r}`,e,{arrayIndex:-1},o))return;t=K.createStyleLayer(e),this._validateLayer(t),t.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[t.id]=t.serialize(),this._updateLayerCount(t,!0)}e=i?this._order.indexOf(i):this._order.length;if(i&&-1===e)this.fire(new K.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));else{this._order.splice(e,0,r),this._layerOrderChanged=!0,this._layers[r]=t;const n=this._getLayerSourceCache(t);if(this._removedLayers[r]&&t.source&&n&&"custom"!==t.type){const K=this._removedLayers[r];delete this._removedLayers[r],K.type!==t.type?this._updatedSources[t.source]="clear":(this._updatedSources[t.source]="reload",n.pause())}this._updateLayer(t),t.onAdd&&t.onAdd(this.map),this._updateDrapeFirstLayers()}}}moveLayer(t,e){var i;this._checkLoaded(),this._changed=!0,this._layers[t]?t!==e&&(i=this._order.indexOf(t),this._order.splice(i,1),i=e?this._order.indexOf(e):this._order.length,e&&-1===i?this.fire(new K.ErrorEvent(new Error(`Layer with id "${e}" does not exist on this map.`))):(this._order.splice(i,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())):this.fire(new K.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)))}removeLayer(t){this._checkLoaded();const e=this._layers[t];var i;e?(e.setEventedParent(null),this._updateLayerCount(e,!1),i=this._order.indexOf(t),this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=e,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],e.onRemove&&e.onRemove(this.map),this._updateDrapeFirstLayers()):this.fire(new K.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)))}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(t,e,i){this._checkLoaded();const o=this.getLayer(t);o?o.minzoom===e&&o.maxzoom===i||(null!=e&&(o.minzoom=e),null!=i&&(o.maxzoom=i),this._updateLayer(o)):this.fire(new K.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,e,i={}){this._checkLoaded();const o=this.getLayer(t);if(o){if(!y(o.filter,e))return null==e?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(K.validateStyle.filter,`layers.${o.id}.filter`,e,null,i)||(o.filter=K.clone$2(e),this._updateLayer(o)))}else this.fire(new K.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){return K.clone$2(this.getLayer(t).filter)}setLayoutProperty(t,e,i,o={}){this._checkLoaded();const r=this.getLayer(t);r?y(r.getLayoutProperty(e),i)||(r.setLayoutProperty(e,i,o),this._updateLayer(r)):this.fire(new K.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,e){const i=this.getLayer(t);if(i)return i.getLayoutProperty(e);this.fire(new K.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,e,i,o={}){this._checkLoaded();const r=this.getLayer(t);r?y(r.getPaintProperty(e),i)||(r.setPaintProperty(e,i,o)&&this._updateLayer(r),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new K.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(t,e){this._checkLoaded();var i=t.source,o=t.sourceLayer,r=this.getSource(i);if(void 0!==r){r=r.type;if("geojson"===r&&o)this.fire(new K.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));else if("vector"!==r||o){void 0===t.id&&this.fire(new K.ErrorEvent(new Error("The feature id parameter must be provided.")));for(const K of this._getSourceCaches(i))K.setFeatureState(o,t.id,e)}else this.fire(new K.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new K.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)))}removeFeatureState(t,e){this._checkLoaded();var i=t.source,o=this.getSource(i);if(void 0!==o){var o=o.type,r="vector"===o?t.sourceLayer:void 0;if("vector"!==o||r)if(e&&"string"!=typeof t.id&&"number"!=typeof t.id)this.fire(new K.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));else for(const K of this._getSourceCaches(i))K.removeFeatureState(r,t.id,e);else this.fire(new K.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new K.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)))}getFeatureState(t){this._checkLoaded();var e=t.source,i=t.sourceLayer,o=this.getSource(e);if(void 0!==o){if("vector"!==o.type||i)return void 0===t.id&&this.fire(new K.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(e)[0].getFeatureState(i,t.id);this.fire(new K.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new K.ErrorEvent(new Error(`The source '${e}' does not exist in the map's style.`)))}getTransition(){return K.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const K in this._sourceCaches){const e=this._sourceCaches[K].getSource();t[e.id]||(t[e.id]=e.serialize())}return K.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t,layers:this._serializeLayers(this._order)},t=>void 0!==t)}_updateLayer(t){this._updatedLayers[t.id]=!0;const e=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&e&&"raster"!==e.getSource().type&&(this._updatedSources[t.source]="reload",e.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(i){const o=t=>"fill-extrusion"===this._layers[t].type,r={},n=[];for(let t=this._order.length-1;0<=t;t--){var e=this._order[t];if(o(e)){r[e]=t;for(const o of i){const i=o[e];if(i)for(const o of i)n.push(o)}}}n.sort((t,e)=>e.intersectionZ-t.intersectionZ);const s=[];for(let e=this._order.length-1;0<=e;e--){var t=this._order[e];if(o(t))for(let t=n.length-1;0<=t;t--){const o=n[t].feature;if(r[o.layer.id]<e)break;s.push(o),n.pop()}else for(const o of i){const i=o[t];if(i)for(const o of i)s.push(o.feature)}}return s}queryRenderedFeatures(t,e,i){e&&e.filter&&this._validate(K.validateStyle.filter,"queryRenderedFeatures.filter",e.filter,null,e);const o={};if(e&&e.layers){if(!Array.isArray(e.layers))return this.fire(new K.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const t of e.layers){const e=this._layers[t];if(!e)return this.fire(new K.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];o[e.source]=!0}}const r=[];e.availableImages=this._availableImages;var n=e&&e.layers?e.layers.some(t=>{const e=this.getLayer(t);return e&&e.is3D()}):this.has3DLayers(),s=T.createFromScreenPoints(t,i);for(const K in this._sourceCaches){const t=this._sourceCaches[K].getSource().id;e.layers&&!o[t]||r.push(St(this._sourceCaches[K],this._layers,this._serializedLayers,s,e,i,n,!!this.map._showQueryGeometry))}return this.placement&&r.push(function(o,r,n,t,e,i,s){const a={},l=i.queryRenderedSymbols(t),h=[];for(const o of Object.keys(l).map(Number))h.push(s[o]);h.sort(Tt);for(const n of h){const t=n.featureIndex.lookupSymbolFeatures(l[n.bucketInstanceId],r,n.bucketIndex,n.sourceLayerIndex,e.filter,e.layers,e.availableImages,o);for(const o in t){const r=a[o]=a[o]||[],e=t[o];e.sort((t,e)=>{const i=n.featureSortOrder;if(i){const n=i.indexOf(t.featureIndex);return i.indexOf(e.featureIndex)-n}return e.featureIndex-t.featureIndex});for(const o of e)r.push(o)}}for(const r in a)a[r].forEach(t=>{const e=t.feature,i=n(o[r]).getFeatureState(e.layer["source-layer"],e.id);e.source=e.layer.source,e.layer["source-layer"]&&(e.sourceLayer=e.layer["source-layer"]),e.state=i});return a}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),s.screenGeometry,e,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(r)}querySourceFeatures(t,e){e&&e.filter&&this._validate(K.validateStyle.filter,"querySourceFeatures.filter",e.filter,null,e);let i=[];for(const K of this._getSourceCaches(t))i=i.concat(function(e,i){const o=e.getRenderableIds().map(t=>e.getTileByID(t)),r=[],n={};for(let t=0;t<o.length;t++){const s=o[t],a=s.tileID.canonical.key;n[a]||(n[a]=!0,s.querySourceFeatures(r,i))}return r}(K,e));return i}addSourceType(t,e,i){return De.getSourceType(t)?i(new Error(`A source type called "${t}" already exists.`)):(De.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(t,e={}){this._checkLoaded();var i,o=this.light.getLight();let r=!1;for(const K in t)if(!y(t[K],o[K])){r=!0;break}r&&(i={now:K.exported.now(),transition:K.extend({duration:300,delay:0},this.stylesheet.transition)},this.light.setLight(t,e),this.light.updateTransitions(i))}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);var e;if("object"==typeof t.source&&(this.addSource(e="terrain-dem-src",t.source),t=K.clone$2(t),t=K.extend(t,{source:e})),!this._validate(K.validateStyle.terrain,"terrain",t)){if(this.terrain){const o=this.terrain,r=o.get();for(const n in t)if(!y(t[n],r[n])){o.set(t),this.stylesheet.terrain=t;var i={now:K.exported.now(),transition:K.extend({duration:0},this.stylesheet.transition)};o.updateTransitions(i);break}}else this._createTerrain(t);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(t){const e=this.fog=new M(t);this.stylesheet.fog=t;t={now:K.exported.now(),transition:K.extend({duration:0},this.stylesheet.transition)};e.updateTransitions(t)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog,o=i.get();for(const r in t)if(!y(t[r],o[r])){i.set(t),this.stylesheet.fog=t;var e={now:K.exported.now(),transition:K.extend({duration:0},this.stylesheet.transition)};i.updateTransitions(e);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){var t,e;this.map._optimizeForTerrain&&this.terrain&&(t=this._order.filter(t=>this.isLayerDraped(this._layers[t])),e=this._order.filter(t=>!this.isLayerDraped(this._layers[t])),this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e))}_createTerrain(t){const e=this.terrain=new _(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();t={now:K.exported.now(),transition:K.extend({duration:0},this.stylesheet.transition)};e.updateTransitions(t)}_force3DLayerUpdate(){for(const e in this._layers){var t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_validate(t,e,i,o,r={}){return(!r||!1!==r.validate)&&Ce(this,t.call(K.validateStyle,K.extend({key:e,style:this.serialize(),value:i,styleSpec:K.spec},o)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),K.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const K in this._layers)this._layers[K].setEventedParent(null);for(const K in this._sourceCaches)this._sourceCaches[K].clearTiles(),this._sourceCaches[K].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){t=this._getSourceCaches(t);for(const e of t)e.clearTiles()}_reloadSource(t){t=this._getSourceCaches(t);for(const e of t)e.resume(),e.reload()}_updateSources(t){for(const e in this._sourceCaches)this._sourceCaches[e].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(t,e,i,o,r=!1){let n=!1,s=!1;const a={};for(const K of this._order){const e=this._layers[K];if("symbol"===e.type){if(!a[e.source]){const K=this._getLayerSourceCache(e);if(!K)continue;a[e.source]=K.getRenderableIds(!0).map(t=>K.getTileByID(t)).sort((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1))}const i=this.crossTileSymbolIndex.addLayer(e,a[e.source],t.center.lng);n=n||i}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),r=r||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new K.Event("neworder")),(r||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(K.exported.now(),t.zoom))&&(this.pauseablePlacement=new Me(t,this._order,r,e,i,o,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,a),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(K.exported.now()),s=!0),n&&this.pauseablePlacement.placement.setStale()),s||n)for(const K of this._order){const t=this._layers[K];"symbol"===t.type&&this.placement.updateLayerOpacities(t,a[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(K.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,e,i){this.imageManager.getImages(e.icons,i),this._updateTilesForChangedImages();i=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};i(this._otherSourceCaches[e.source]),i(this._symbolSourceCaches[e.source])}getGlyphs(t,e,i){this.glyphManager.getGlyphs(e.stacks,i)}getResource(t,e,i){return K.makeRequest(e,i)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return("symbol"===t.type?this._symbolSourceCaches:this._otherSourceCaches)[t.source]}_getSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}has3DLayers(){return 0<this._num3DLayers}hasSymbolLayers(){return 0<this._numSymbolLayers}hasCircleLayers(){return 0<this._numCircleLayers}}De.getSourceType=function(t){return Pt[t]},De.setSourceType=function(t,e){Pt[t]=e},De.registerForPluginStateChange=K.registerForPluginStateChange;var ke="\n#define EPSILON 0.0000001\r\n#define PI 3.141592653589793\r\n#ifdef FOG\r\nuniform mediump vec4 u_fog_color;\r\nuniform mediump vec2 u_fog_range;\r\nuniform mediump float u_fog_horizon_blend;\r\nvarying vec3 v_fog_pos;\r\nfloat fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);\r\n}float fog_horizon_blending(vec3 camera_dir) {\r\nfloat t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);\r\n}float fog_opacity(float t) {\r\nconst float decay=6.0;\r\nfloat falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);\r\n}\r\n#endif",ze="attribute highp vec3 a_pos_3f;\r\nuniform lowp mat4 u_matrix;\r\nvarying highp vec3 v_uv;\r\nvoid main() {\r\nconst mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);\r\nv_uv=half_neg_pi_around_x*a_pos_3f;\r\nvec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;\r\n}";let Fe={},Ne={};Fe=Ze("","\n#define ELEVATION_SCALE 7.0\r\n#define ELEVATION_OFFSET 450.0\r\n#ifdef TERRAIN\r\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\r\nuniform highp sampler2D u_dem;\r\nuniform highp sampler2D u_dem_prev;\r\n#else\r\nuniform sampler2D u_dem;\r\nuniform sampler2D u_dem_prev;\r\n#endif\r\nuniform vec4 u_dem_unpack;\r\nuniform vec2 u_dem_tl;\r\nuniform vec2 u_dem_tl_prev;\r\nuniform float u_dem_scale;\r\nuniform float u_dem_scale_prev;\r\nuniform float u_dem_size;\r\nuniform float u_dem_lerp;\r\nuniform float u_exaggeration;\r\nuniform float u_meter_to_dem;\r\nuniform mat4 u_label_plane_matrix_inv;\r\nuniform sampler2D u_depth;\r\nuniform vec2 u_depth_size_inv;\r\nvec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {\r\nvec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;\r\nvec2 f=fract(pos);\r\nreturn vec4((pos-f+0.5)/(dem_size+2.0),f);\r\n}\r\nfloat decodeElevation(vec4 v) {\r\nreturn dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);\r\n}\r\nfloat currentElevation(vec2 apos) {\r\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\r\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);\r\nreturn u_exaggeration*texture2D(u_dem,pos).a;\r\n#else\r\nfloat dd=1.0/(u_dem_size+2.0);\r\nvec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);\r\nvec2 pos=r.xy;\r\nvec2 f=r.zw;\r\nfloat tl=decodeElevation(texture2D(u_dem,pos));\r\n#ifdef TERRAIN_DEM_NEAREST_FILTER\r\nreturn u_exaggeration*tl;\r\n#endif\r\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));\r\nfloat bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));\r\nfloat br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));\r\nreturn u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\r\n#endif\r\n}\r\nfloat prevElevation(vec2 apos) {\r\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\r\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);\r\nreturn u_exaggeration*texture2D(u_dem_prev,pos).a;\r\n#else\r\nfloat dd=1.0/(u_dem_size+2.0);\r\nvec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);\r\nvec2 pos=r.xy;\r\nvec2 f=r.zw;\r\nfloat tl=decodeElevation(texture2D(u_dem_prev,pos));\r\nfloat tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));\r\nfloat bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));\r\nfloat br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));\r\nreturn u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\r\n#endif\r\n}\r\n#ifdef TERRAIN_VERTEX_MORPHING\r\nfloat elevation(vec2 apos) {\r\nfloat nextElevation=currentElevation(apos);\r\nfloat prevElevation=prevElevation(apos);\r\nreturn mix(prevElevation,nextElevation,u_dem_lerp);\r\n}\r\n#else\r\nfloat elevation(vec2 apos) {\r\nreturn currentElevation(apos);\r\n}\r\n#endif\nfloat unpack_depth(vec4 rgba_depth)\r\n{\r\nconst vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);\r\nreturn dot(rgba_depth,bit_shift)*2.0-1.0;\r\n}\r\nbool isOccluded(vec4 frag) {\r\nvec3 coord=frag.xyz/frag.w;\r\nfloat depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));\r\nreturn coord.z > depth+0.0005;\r\n}\r\nfloat occlusionFade(vec4 frag) {\r\nvec3 coord=frag.xyz/frag.w;\r\nvec3 df=vec3(5.0*u_depth_size_inv,0.0);\r\nvec2 uv=0.5*coord.xy+0.5;\r\nvec4 depth=vec4(\r\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\r\n);\r\nreturn dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));\r\n}vec4 fourSample(vec2 pos,vec2 off) {\r\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\r\nfloat tl=texture2D(u_dem,pos).a;\r\nfloat tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;\r\nfloat bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;\r\nfloat br=texture2D(u_dem,pos+off).a;\r\n#else\r\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);\r\nfloat tl=dot(demtl,u_dem_unpack);\r\nvec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);\r\nfloat tr=dot(demtr,u_dem_unpack);\r\nvec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);\r\nfloat bl=dot(dembl,u_dem_unpack);\r\nvec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);\r\nfloat br=dot(dembr,u_dem_unpack);\r\n#endif\r\nreturn vec4(tl,tr,bl,br);\r\n}\r\nfloat flatElevation(vec2 pack) {\r\nvec2 apos=floor(pack/8.0);\r\nvec2 span=10.0*(pack-apos*8.0);\r\nvec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;\r\nfloat size=u_dem_size+2.0;\r\nfloat dd=1.0/size;\r\nvec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;\r\nvec2 f=fract(pos);\r\npos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));\r\nfloat z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);\r\nvec2 w=floor(0.5*(span*u_meter_to_dem-1.0));\r\nvec2 d=dd*w;\r\nvec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));\r\nvec4 diff=abs(h.xzxy-h.ywzw);\r\nvec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));\r\nvec2 fix=slope*span;\r\nfloat base=z+max(fix.x,fix.y);\r\nreturn u_exaggeration*base;\r\n}\r\nfloat elevationFromUint16(float word) {\r\nreturn u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);\r\n}\n#else\r\nfloat elevation(vec2 pos) { return 0.0; }\r\nbool isOccluded(vec4 frag) { return false; }\r\nfloat occlusionFade(vec4 frag) { return 1.0; }\r\n#endif",!0),Ne=Ze("#ifdef FOG\r\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {\r\nfloat depth=length(pos);\r\nreturn fog_opacity(fog_range(depth));\r\n}\r\nvec3 fog_apply(vec3 color,vec3 pos) {\r\nfloat depth=length(pos);\r\nfloat opacity=fog_opacity(fog_range(depth));\r\nopacity*=fog_horizon_blending(pos/depth);\r\nreturn mix(color,u_fog_color.rgb,opacity);\r\n}vec3 fog_apply_from_vert(vec3 color,float fog_opac) {\r\nreturn mix(color,u_fog_color.rgb,fog_opac);\r\n}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {\r\nfloat horizon_blend=fog_horizon_blending(normalize(camera_ray));\r\nreturn mix(sky_color,u_fog_color.rgb,horizon_blend);\r\n}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {\r\nfloat alpha=EPSILON+color.a;\r\ncolor.rgb/=alpha;\r\ncolor.rgb=fog_apply(color.rgb,pos);\r\ncolor.rgb*=alpha;\r\nreturn color;\r\n}\r\nvec3 fog_dither(vec3 color) {\r\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;\r\nreturn dither(color,dither_seed);\r\n}\r\nvec4 fog_dither(vec4 color) {\r\nreturn vec4(fog_dither(color.rgb),color.a);\r\n}\r\n#endif","#ifdef FOG\r\nuniform mat4 u_fog_matrix;\r\nvec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;\r\n}\r\nvec3 fog_position(vec2 pos) {\r\nreturn fog_position(vec3(pos,0.0));\r\n}\r\nfloat fog(vec3 pos) {\r\nfloat depth=length(pos);\r\nfloat opacity=fog_opacity(fog_range(depth));\r\nreturn opacity*fog_horizon_blending(pos/depth);\r\n}\r\n#endif",!0);const Ue=Ze("#ifdef GL_ES\r\nprecision mediump float;\r\n#else\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n#endif\r\nhighp vec3 hash(highp vec2 p) {\r\nhighp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));\r\np3+=dot(p3,p3.yxz+19.19);\r\nreturn fract((p3.xxy+p3.yzz)*p3.zyx);\r\n}\r\nvec3 dither(vec3 color,highp vec2 seed) {\r\nvec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;\r\nreturn color+rnd/255.0;\r\n}","#ifdef GL_ES\r\nprecision highp float;\r\n#else\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n#endif\nvec2 unpack_float(const float packedValue) {\r\nint packedIntValue=int(packedValue);\r\nint v0=packedIntValue/256;\r\nreturn vec2(v0,packedIntValue-v0*256);\r\n}\r\nvec2 unpack_opacity(const float packedOpacity) {\r\nint intOpacity=int(packedOpacity)/2;\r\nreturn vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));\r\n}vec4 decode_color(const vec2 encodedColor) {\r\nreturn vec4(\r\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\r\n);\r\n}float unpack_mix_vec2(const vec2 packedValue,const float t) {\r\nreturn mix(packedValue[0],packedValue[1],t);\r\n}vec4 unpack_mix_color(const vec4 packedColors,const float t) {\r\nvec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));\r\nvec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));\r\nreturn mix(minColor,maxColor,t);\r\n}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {\r\nvec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);\r\nreturn (tile_units_to_pixels*pos+offset)/pattern_size;\r\n}\r\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Be=ke;var je={background:Ze("uniform vec4 u_color;\r\nuniform float u_opacity;\r\nvoid main() {\r\nvec4 out_color=u_color;\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*u_opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","attribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}"),backgroundPattern:Ze("uniform vec2 u_pattern_tl_a;\r\nuniform vec2 u_pattern_br_a;\r\nuniform vec2 u_pattern_tl_b;\r\nuniform vec2 u_pattern_br_b;\r\nuniform vec2 u_texsize;\r\nuniform float u_mix;\r\nuniform float u_opacity;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvoid main() {\r\nvec2 imagecoord=mod(v_pos_a,1.0);\r\nvec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);\r\nvec4 color1=texture2D(u_image,pos);\r\nvec2 imagecoord_b=mod(v_pos_b,1.0);\r\nvec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);\r\nvec4 color2=texture2D(u_image,pos2);\r\nvec4 out_color=mix(color1,color2,u_mix);\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*u_opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_pattern_size_a;\r\nuniform vec2 u_pattern_size_b;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_scale_a;\r\nuniform float u_scale_b;\r\nuniform float u_tile_units_to_pixels;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);\r\nv_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}"),circle:Ze("varying vec3 v_data;\r\nvarying float v_visibility;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define mediump float radius\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define highp vec4 stroke_color\r\n#pragma mapbox: define mediump float stroke_width\r\n#pragma mapbox: define lowp float stroke_opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize mediump float radius\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize highp vec4 stroke_color\r\n#pragma mapbox: initialize mediump float stroke_width\r\n#pragma mapbox: initialize lowp float stroke_opacity\r\nvec2 extrude=v_data.xy;\r\nfloat extrude_length=length(extrude);\r\nlowp float antialiasblur=v_data.z;\r\nfloat antialiased_blur=-max(blur,antialiasblur);\r\nfloat opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);\r\nfloat color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\r\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\r\n);\r\nvec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\r\n#ifdef FOG\r\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\r\n#endif\r\ngl_FragColor=out_color*(v_visibility*opacity_t);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","#define NUM_VISIBILITY_RINGS 2\r\n#define INV_SQRT2 0.70710678\r\n#define ELEVATION_BIAS 0.0001\r\n#define NUM_SAMPLES_PER_RING 16\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_extrude_scale;\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform highp float u_camera_to_center_distance;\r\nattribute vec2 a_pos;\r\nvarying vec3 v_data;\r\nvarying float v_visibility;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define mediump float radius\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define highp vec4 stroke_color\r\n#pragma mapbox: define mediump float stroke_width\r\n#pragma mapbox: define lowp float stroke_opacity\r\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {\r\nreturn extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;\r\n}\r\nfloat cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {\r\nvec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);\r\nvec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);\r\nvec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);\r\nvec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);\r\nfloat h1=elevation(c1)+ELEVATION_BIAS;\r\nfloat h2=elevation(c2)+ELEVATION_BIAS;\r\nfloat h3=elevation(c3)+ELEVATION_BIAS;\r\nfloat h4=elevation(c4)+ELEVATION_BIAS;\r\nreturn max(h4,max(h3,max(h1,h2)));\r\n}\r\nfloat circle_elevation(vec2 pos) {\r\n#if defined(TERRAIN)\r\nreturn elevation(pos)+ELEVATION_BIAS;\r\n#else\r\nreturn 0.0;\r\n#endif\r\n}\r\nvec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {\r\nvec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\r\n#ifdef PITCH_WITH_MAP\r\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\r\n#else\r\nreturn projected_center+vec4(sample_offset,0,0);\r\n#endif\r\n}\r\nfloat get_sample_step() {\r\n#ifdef PITCH_WITH_MAP\r\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\r\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\r\n#endif\r\n}\r\nvoid main(void) {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize mediump float radius\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize highp vec4 stroke_color\r\n#pragma mapbox: initialize mediump float stroke_width\r\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);\r\nvec4 world_center=vec4(circle_center,height,1);\r\nvec4 projected_center=u_matrix*world_center;\r\nfloat view_scale=0.0;\r\n#ifdef PITCH_WITH_MAP\r\n#ifdef SCALE_WITH_MAP\r\nview_scale=1.0;\r\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\r\n#endif\r\n#else\r\n#ifdef SCALE_WITH_MAP\r\nview_scale=u_camera_to_center_distance;\r\n#else\r\nview_scale=projected_center.w;\r\n#endif\r\n#endif\r\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);\r\nfloat visibility=0.0;\r\n#ifdef TERRAIN\r\nfloat step=get_sample_step();\r\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);\r\nvec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);\r\nvec4 occlusion_projected_center=u_matrix*occlusion_world_center;\r\n#else\r\nvec4 occlusion_world_center=world_center;\r\nvec4 occlusion_projected_center=projected_center;\r\n#endif\r\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {\r\nfloat scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);\r\nfor(int i=0; i < NUM_SAMPLES_PER_RING; i++) {\r\nvec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;\r\nvec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);\r\nvisibility+=float(!isOccluded(frag_pos));\r\n}\r\n}\r\nvisibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\r\n#else\r\nvisibility=1.0;\r\n#endif\r\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);\r\nv_data=vec3(extrude.x,extrude.y,antialiasblur);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(world_center.xyz);\r\n#endif\r\n}"),clippingMask:Ze("void main() {\r\ngl_FragColor=vec4(1.0);\r\n}","attribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\n}"),heatmap:Ze("uniform highp float u_intensity;\r\nvarying vec2 v_extrude;\r\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\r\nvoid main() {\r\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);\r\nfloat val=weight*u_intensity*GAUSS_COEF*exp(d);\r\ngl_FragColor=vec4(val,1.0,1.0,1.0);\r\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\r\n#endif\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform float u_extrude_scale;\r\nuniform float u_opacity;\r\nuniform float u_intensity;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_extrude;\r\n#pragma mapbox: define highp float weight\r\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\r\nvoid main(void) {\r\n#pragma mapbox: initialize highp float weight\r\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));\r\ngl_Position=u_matrix*vec4(pos,1);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(pos);\r\n#endif\r\n}"),heatmapTexture:Ze("uniform sampler2D u_image;\r\nuniform sampler2D u_color_ramp;\r\nuniform float u_opacity;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\nfloat t=texture2D(u_image,v_pos).r;\r\nvec4 color=texture2D(u_color_ramp,vec2(t,0.5));\r\ngl_FragColor=color*u_opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(0.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos*u_world,0,1);\r\nv_pos.x=a_pos.x;\r\nv_pos.y=1.0-a_pos.y;\r\n}"),collisionBox:Ze("varying float v_placed;\r\nvarying float v_notUsed;\r\nvoid main() {\r\nvec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;\r\ngl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));\r\n}","attribute vec2 a_pos;\r\nattribute vec2 a_anchor_pos;\r\nattribute vec2 a_extrude;\r\nattribute vec2 a_placed;\r\nattribute vec2 a_shift;\r\nattribute float a_size_scale;\r\nattribute vec2 a_padding;\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_extrude_scale;\r\nuniform float u_camera_to_center_distance;\r\nvarying float v_placed;\r\nvarying float v_notUsed;\r\nvoid main() {\r\nvec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);\r\nhighp float camera_to_anchor_distance=projectedPoint.w;\r\nhighp float collision_perspective_ratio=clamp(\r\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);\r\ngl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);\r\ngl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;\r\nv_placed=a_placed.x;\r\nv_notUsed=a_placed.y;\r\n}"),collisionCircle:Ze("varying float v_radius;\r\nvarying vec2 v_extrude;\r\nvarying float v_perspective_ratio;\r\nvarying float v_collision;\r\nvoid main() {\r\nfloat alpha=0.5*min(v_perspective_ratio,1.0);\r\nfloat stroke_radius=0.9*max(v_perspective_ratio,1.0);\r\nfloat distance_to_center=length(v_extrude);\r\nfloat distance_to_edge=abs(distance_to_center-v_radius);\r\nfloat opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);\r\nvec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);\r\ngl_FragColor=color*alpha*opacity_t;\r\n}","attribute vec2 a_pos_2f;\r\nattribute float a_radius;\r\nattribute vec2 a_flags;\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_inv_matrix;\r\nuniform vec2 u_viewport_size;\r\nuniform float u_camera_to_center_distance;\r\nvarying float v_radius;\r\nvarying vec2 v_extrude;\r\nvarying float v_perspective_ratio;\r\nvarying float v_collision;\r\nvec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);\r\nvec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);\r\nrayStart.xyz/=rayStart.w;\r\nrayEnd.xyz  /=rayEnd.w;\r\nhighp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);\r\nreturn mix(rayStart.xyz,rayEnd.xyz,t);\r\n}\r\nvoid main() {\r\nvec2 quadCenterPos=a_pos_2f;\r\nfloat radius=a_radius;\r\nfloat collision=a_flags.x;\r\nfloat vertexIdx=a_flags.y;\r\nvec2 quadVertexOffset=vec2(\r\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));\r\nvec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);\r\nvec4 clipPos=u_matrix*vec4(tilePos,1.0);\r\nhighp float camera_to_anchor_distance=clipPos.w;\r\nhighp float collision_perspective_ratio=clamp(\r\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;\r\nv_radius=radius;\r\nv_extrude=quadVertexExtent*padding_factor;\r\nv_perspective_ratio=collision_perspective_ratio;\r\nv_collision=collision;\r\ngl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);\r\n}"),debug:Ze("uniform highp vec4 u_color;\r\nuniform sampler2D u_overlay;\r\nvarying vec2 v_uv;\r\nvoid main() {\r\nvec4 overlay_color=texture2D(u_overlay,v_uv);\r\ngl_FragColor=mix(u_color,overlay_color,overlay_color.a);\r\n}","attribute vec2 a_pos;\r\nvarying vec2 v_uv;\r\nuniform mat4 u_matrix;\r\nuniform float u_overlay_scale;\r\nvoid main() {float h=elevation(a_pos);\r\nv_uv=a_pos/8192.0;\r\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\r\n}"),fill:Ze("#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float opacity\r\nvec4 out_color=color;\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","attribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float opacity\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}"),fillOutline:Ze("varying vec2 v_pos;\r\n#pragma mapbox: define highp vec4 outline_color\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 outline_color\r\n#pragma mapbox: initialize lowp float opacity\r\nfloat dist=length(v_pos-gl_FragCoord.xy);\r\nfloat alpha=1.0-smoothstep(0.0,1.0,dist);\r\nvec4 out_color=outline_color;\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","attribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\nvarying vec2 v_pos;\r\n#pragma mapbox: define highp vec4 outline_color\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 outline_color\r\n#pragma mapbox: initialize lowp float opacity\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}"),fillOutlinePattern:Ze("uniform vec2 u_texsize;\r\nuniform sampler2D u_image;\r\nuniform float u_fade;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec2 v_pos;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nvec2 imagecoord=mod(v_pos_a,1.0);\r\nvec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);\r\nvec4 color1=texture2D(u_image,pos);\r\nvec2 imagecoord_b=mod(v_pos_b,1.0);\r\nvec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);\r\nvec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);\r\nfloat alpha=1.0-smoothstep(0.0,1.0,dist);\r\nvec4 out_color=mix(color1,color2,u_fade);\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform vec3 u_scale;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec2 v_pos;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nfloat tileRatio=u_scale.x;\r\nfloat fromScale=u_scale.y;\r\nfloat toScale=u_scale.z;\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nvec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;\r\nvec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\r\nv_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);\r\nv_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);\r\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}"),fillPattern:Ze("uniform vec2 u_texsize;\r\nuniform float u_fade;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nvec2 imagecoord=mod(v_pos_a,1.0);\r\nvec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);\r\nvec4 color1=texture2D(u_image,pos);\r\nvec2 imagecoord_b=mod(v_pos_b,1.0);\r\nvec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);\r\nvec4 color2=texture2D(u_image,pos2);\r\nvec4 out_color=mix(color1,color2,u_fade);\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform vec3 u_scale;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nfloat tileZoomRatio=u_scale.x;\r\nfloat fromScale=u_scale.y;\r\nfloat toScale=u_scale.z;\r\nvec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;\r\nvec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);\r\nv_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}"),fillExtrusion:Ze("varying vec4 v_color;\r\nvoid main() {\r\nvec4 color=v_color;\r\n#ifdef FOG\r\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r\n#endif\r\ngl_FragColor=color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\nuniform float u_vertical_gradient;\r\nuniform lowp float u_opacity;\r\nattribute vec4 a_pos_normal_ed;\r\nattribute vec2 a_centroid_pos;\r\nvarying vec4 v_color;\r\n#pragma mapbox: define highp float base\r\n#pragma mapbox: define highp float height\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define highp vec4 basecolor\r\nvoid main() {\r\n#pragma mapbox: initialize highp float base\r\n#pragma mapbox: initialize highp float height\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize highp vec4 basecolor\r\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;\r\nfloat x_normal=pos_nx.z/8192.0;\r\nvec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\r\nbase=max(0.0,base);\r\nheight=max(0.0,height);\r\nfloat t=top_up_ny.x;\r\n#ifdef TERRAIN\r\nvec2 centroid_pos=a_centroid_pos;\r\nbool flat_roof=centroid_pos.x !=0.0;\r\nfloat ele=elevation(pos_nx.xy);\r\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);\r\nfloat c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);\r\nvec3 pos=vec3(pos_nx.xy,h);\r\ngl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\r\n#else\r\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\r\ngl_Position=u_matrix*vec4(pos,1);\r\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;\r\nv_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);\r\nif(basecolor.r==0.0 && basecolor.g==0.0 && basecolor.b==0.0){\r\nbasecolor=color;\r\n}\r\ncolor+=ambientlight;\r\nbasecolor+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\r\n(1.0-u_vertical_gradient)+\n(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));\r\n}float a=(t+base)*pow(height/150.0,0.5);\r\nif (height>0.0) {\r\na=(t+base)/pow(height/(base+height),0.5);\r\n}\r\ncolor.rgb=color.rgb+basecolor.rgb*(1.0-a);\r\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r\nv_color*=u_opacity;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(pos);\r\n#endif\r\n}"),fillExtrusionPattern:Ze("uniform vec2 u_texsize;\r\nuniform float u_fade;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec4 v_lighting;\r\n#pragma mapbox: define lowp float base\r\n#pragma mapbox: define lowp float height\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float base\r\n#pragma mapbox: initialize lowp float height\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nvec2 imagecoord=mod(v_pos_a,1.0);\r\nvec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);\r\nvec4 color1=texture2D(u_image,pos);\r\nvec2 imagecoord_b=mod(v_pos_b,1.0);\r\nvec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);\r\nvec4 color2=texture2D(u_image,pos2);\r\nvec4 out_color=mix(color1,color2,u_fade);\r\nout_color=out_color*v_lighting;\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_height_factor;\r\nuniform vec3 u_scale;\r\nuniform float u_vertical_gradient;\r\nuniform lowp float u_opacity;\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\nattribute vec4 a_pos_normal_ed;\r\nattribute vec2 a_centroid_pos;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec4 v_lighting;\r\n#pragma mapbox: define lowp float base\r\n#pragma mapbox: define lowp float height\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float base\r\n#pragma mapbox: initialize lowp float height\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nfloat tileRatio=u_scale.x;\r\nfloat fromScale=u_scale.y;\r\nfloat toScale=u_scale.z;\r\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;\r\nfloat x_normal=pos_nx.z/8192.0;\r\nvec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\r\nfloat edgedistance=a_pos_normal_ed.w;\r\nvec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;\r\nvec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\r\nbase=max(0.0,base);\r\nheight=max(0.0,height);\r\nfloat t=top_up_ny.x;\r\nfloat z=t > 0.0 ? height : base;\r\n#ifdef TERRAIN\r\nvec2 centroid_pos=a_centroid_pos;\r\nbool flat_roof=centroid_pos.x !=0.0;\r\nfloat ele=elevation(pos_nx.xy);\r\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);\r\nfloat c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);\r\nvec3 p=vec3(pos_nx.xy,h);\r\ngl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);\r\n#else\r\nvec3 p=vec3(pos_nx.xy,z);\r\ngl_Position=u_matrix*vec4(p,1);\r\n#endif\r\nvec2 pos=normal.z==1.0\r\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);\r\nv_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);\r\nv_lighting=vec4(0.0,0.0,0.0,1.0);\r\nfloat directional=clamp(dot(normal,u_lightpos),0.0,1.0);\r\ndirectional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);\r\nif (normal.y !=0.0) {directional*=(\r\n(1.0-u_vertical_gradient)+\n(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));\r\n}\r\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r\nv_lighting*=u_opacity;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(p);\r\n#endif\r\n}"),hillshadePrepare:Ze("#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos;\r\nuniform vec2 u_dimension;\r\nuniform float u_zoom;\r\nuniform vec4 u_unpack;\r\nfloat getElevation(vec2 coord) {\r\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\r\nreturn texture2D(u_image,coord).a/4.0;\r\n#else\nvec4 data=texture2D(u_image,coord)*255.0;\r\ndata.a=-1.0;\r\nreturn dot(data,u_unpack)/4.0;\r\n#endif\r\n}\r\nvoid main() {\r\nvec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));\r\nfloat b=getElevation(v_pos+vec2(0,-epsilon.y));\r\nfloat c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));\r\nfloat d=getElevation(v_pos+vec2(-epsilon.x,0));\r\nfloat e=getElevation(v_pos);\r\nfloat f=getElevation(v_pos+vec2(epsilon.x,0));\r\nfloat g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));\r\nfloat h=getElevation(v_pos+vec2(0,epsilon.y));\r\nfloat i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;\r\nfloat exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;\r\nvec2 deriv=vec2(\r\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\r\n)/pow(2.0,exaggeration+(19.2562-u_zoom));\r\ngl_FragColor=clamp(vec4(\r\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_dimension;\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nhighp vec2 epsilon=1.0/u_dimension;\r\nfloat scale=(u_dimension.x-2.0)/u_dimension.x;\r\nv_pos=(a_texture_pos/8192.0)*scale+epsilon;\r\n}"),hillshade:Ze("uniform sampler2D u_image;\r\nvarying vec2 v_pos;\r\nuniform vec2 u_latrange;\r\nuniform vec2 u_light;\r\nuniform vec4 u_shadow;\r\nuniform vec4 u_highlight;\r\nuniform vec4 u_accent;\r\nvoid main() {\r\nvec4 pixel=texture2D(u_image,v_pos);\r\nvec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);\r\nfloat aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);\r\nfloat intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;\r\nfloat maxValue=0.5*PI;\r\nfloat scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);\r\nfloat shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);\r\nvec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);\r\ngl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\r\n#ifdef FOG\r\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\r\n#endif\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos=a_texture_pos/8192.0;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}"),line:Ze("uniform lowp float u_device_pixel_ratio;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r\nfloat alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r\nvec4 out_color=color;\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","\n#define scale 0.015873016\r\nattribute vec2 a_pos_normal;\r\nattribute vec4 a_data;\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_units_to_pixels;\r\nuniform lowp float u_device_pixel_ratio;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define mediump float gapwidth\r\n#pragma mapbox: define lowp float offset\r\n#pragma mapbox: define mediump float width\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump float gapwidth\r\n#pragma mapbox: initialize lowp float offset\r\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r\nvec2 a_extrude=a_data.xy-128.0;\r\nfloat a_direction=mod(a_data.z,4.0)-1.0;\r\nvec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r\nnormal.y=normal.y*2.0-1.0;\r\nv_normal=normal;gapwidth=gapwidth/2.0;\r\nfloat halfwidth=width/2.0;\r\noffset=-1.0*offset;\r\nfloat inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\nfloat outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;\r\nmediump float t=1.0-abs(u);\r\nmediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\r\nvec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);\r\ngl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\r\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);\r\nfloat extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);\r\nv_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\r\n#else\r\nv_gamma_scale=1.0;\r\n#endif\r\nv_width2=vec2(outset,inset);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(pos);\r\n#endif\r\n}"),lineGradient:Ze("uniform lowp float u_device_pixel_ratio;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\nvarying highp vec2 v_uv;\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r\nfloat alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);\r\n#ifdef FOG\r\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r\n#endif\r\ngl_FragColor=color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","\n#define scale 0.015873016\r\nattribute vec2 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute float a_uv_x;\r\nattribute float a_split_index;\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform vec2 u_units_to_pixels;\r\nuniform float u_image_height;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\nvarying highp vec2 v_uv;\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define mediump float gapwidth\r\n#pragma mapbox: define lowp float offset\r\n#pragma mapbox: define mediump float width\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump float gapwidth\r\n#pragma mapbox: initialize lowp float offset\r\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r\nvec2 a_extrude=a_data.xy-128.0;\r\nfloat a_direction=mod(a_data.z,4.0)-1.0;\r\nhighp float texel_height=1.0/u_image_height;\r\nhighp float half_texel_height=0.5*texel_height;\r\nv_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\r\nvec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r\nnormal.y=normal.y*2.0-1.0;\r\nv_normal=normal;gapwidth=gapwidth/2.0;\r\nfloat halfwidth=width/2.0;\r\noffset=-1.0*offset;\r\nfloat inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\nfloat outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;\r\nmediump float t=1.0-abs(u);\r\nmediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\r\nvec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);\r\ngl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\r\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);\r\nfloat extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);\r\nv_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\r\n#else\r\nv_gamma_scale=1.0;\r\n#endif\r\nv_width2=vec2(outset,inset);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(pos);\r\n#endif\r\n}"),linePattern:Ze("uniform lowp float u_device_pixel_ratio;\r\nuniform vec2 u_texsize;\r\nuniform float u_fade;\r\nuniform mediump vec3 u_scale;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_linesofar;\r\nvarying float v_gamma_scale;\r\nvarying float v_width;\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nfloat tileZoomRatio=u_scale.x;\r\nfloat fromScale=u_scale.y;\r\nfloat toScale=u_scale.z;\r\nvec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;\r\nvec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\r\nvec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);\r\nvec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);\r\nfloat aspect_a=display_size_a.y/v_width;\r\nfloat aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r\nfloat alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r\nfloat x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);\r\nfloat x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);\r\nfloat y=0.5*v_normal.y+0.5;\r\nvec2 texel_size=1.0/u_texsize;\r\nvec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));\r\nvec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));\r\nvec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\r\n#ifdef FOG\r\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r\n#endif\r\ngl_FragColor=color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","\n#define scale 0.015873016\r\nattribute vec2 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute float a_linesofar;\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_units_to_pixels;\r\nuniform mediump float u_ratio;\r\nuniform lowp float u_device_pixel_ratio;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_linesofar;\r\nvarying float v_gamma_scale;\r\nvarying float v_width;\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float offset\r\n#pragma mapbox: define mediump float gapwidth\r\n#pragma mapbox: define mediump float width\r\n#pragma mapbox: define lowp float floorwidth\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float offset\r\n#pragma mapbox: initialize mediump float gapwidth\r\n#pragma mapbox: initialize mediump float width\r\n#pragma mapbox: initialize lowp float floorwidth\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r\nvec2 a_extrude=a_data.xy-128.0;\r\nfloat a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r\nnormal.y=normal.y*2.0-1.0;\r\nv_normal=normal;gapwidth=gapwidth/2.0;\r\nfloat halfwidth=width/2.0;\r\noffset=-1.0*offset;\r\nfloat inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\nfloat outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;\r\nmediump float t=1.0-abs(u);\r\nmediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\r\nvec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);\r\ngl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\r\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);\r\nfloat extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);\r\nv_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\r\n#else\r\nv_gamma_scale=1.0;\r\n#endif\r\nv_linesofar=a_linesofar;\r\nv_width2=vec2(outset,inset);\r\nv_width=floorwidth;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(pos);\r\n#endif\r\n}"),lineSDF:Ze("uniform lowp float u_device_pixel_ratio;\r\nuniform sampler2D u_image;\r\nuniform float u_mix;\r\nuniform vec3 u_scale;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_tex_a;\r\nvarying vec2 v_tex_b;\r\nvarying float v_gamma_scale;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define mediump float width\r\n#pragma mapbox: define lowp float floorwidth\r\n#pragma mapbox: define lowp vec4 dash_from\r\n#pragma mapbox: define lowp vec4 dash_to\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump float width\r\n#pragma mapbox: initialize lowp float floorwidth\r\n#pragma mapbox: initialize mediump vec4 dash_from\r\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r\nfloat alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r\nfloat sdfdist_a=texture2D(u_image,v_tex_a).a;\r\nfloat sdfdist_b=texture2D(u_image,v_tex_b).a;\r\nfloat sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);\r\nfloat sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);\r\nfloat sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;\r\nalpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\r\nvec4 out_color=color;\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=out_color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","\n#define EXTRUDE_SCALE 0.015873016\r\nattribute vec2 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute float a_linesofar;\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform vec2 u_units_to_pixels;\r\nuniform vec2 u_texsize;\r\nuniform mediump vec3 u_scale;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_tex_a;\r\nvarying vec2 v_tex_b;\r\nvarying float v_gamma_scale;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define mediump float gapwidth\r\n#pragma mapbox: define lowp float offset\r\n#pragma mapbox: define mediump float width\r\n#pragma mapbox: define lowp float floorwidth\r\n#pragma mapbox: define lowp vec4 dash_from\r\n#pragma mapbox: define lowp vec4 dash_to\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump float gapwidth\r\n#pragma mapbox: initialize lowp float offset\r\n#pragma mapbox: initialize mediump float width\r\n#pragma mapbox: initialize lowp float floorwidth\r\n#pragma mapbox: initialize mediump vec4 dash_from\r\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r\nvec2 a_extrude=a_data.xy-128.0;\r\nfloat a_direction=mod(a_data.z,4.0)-1.0;\r\nvec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r\nnormal.y=normal.y*2.0-1.0;\r\nv_normal=normal;gapwidth=gapwidth/2.0;\r\nfloat halfwidth=width/2.0;\r\noffset=-1.0*offset;\r\nfloat inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\nfloat outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;\r\nmediump float t=1.0-abs(u);\r\nmediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);\r\nvec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);\r\ngl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\r\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);\r\nfloat extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);\r\nv_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\r\n#else\r\nv_gamma_scale=1.0;\r\n#endif\r\nfloat tileZoomRatio=u_scale.x;\r\nfloat fromScale=u_scale.y;\r\nfloat toScale=u_scale.z;\r\nfloat scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);\r\nfloat scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);\r\nfloat heightA=dash_from.y;\r\nfloat heightB=dash_to.y;\r\nv_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);\r\nv_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\r\nv_width2=vec2(outset,inset);\r\n#ifdef FOG\r\nv_fog_pos=fog_position(pos);\r\n#endif\r\n}"),raster:Ze("uniform float u_fade_t;\r\nuniform float u_opacity;\r\nuniform sampler2D u_image0;\r\nuniform sampler2D u_image1;\r\nvarying vec2 v_pos0;\r\nvarying vec2 v_pos1;\r\nuniform float u_brightness_low;\r\nuniform float u_brightness_high;\r\nuniform float u_saturation_factor;\r\nuniform float u_contrast_factor;\r\nuniform vec3 u_spin_weights;\r\nvoid main() {vec4 color0=texture2D(u_image0,v_pos0);\r\nvec4 color1=texture2D(u_image1,v_pos1);\r\nif (color0.a > 0.0) {\r\ncolor0.rgb=color0.rgb/color0.a;\r\n}\r\nif (color1.a > 0.0) {\r\ncolor1.rgb=color1.rgb/color1.a;\r\n}\r\nvec4 color=mix(color0,color1,u_fade_t);\r\ncolor.a*=u_opacity;\r\nvec3 rgb=color.rgb;rgb=vec3(\r\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;\r\nrgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);\r\nvec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);\r\nvec3 out_color=mix(u_high_vec,u_low_vec,rgb);\r\n#ifdef FOG\r\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\r\n#endif\r\ngl_FragColor=vec4(out_color*color.a,color.a);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_tl_parent;\r\nuniform float u_scale_parent;\r\nuniform float u_buffer_scale;\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\nvarying vec2 v_pos0;\r\nvarying vec2 v_pos1;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;\r\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\r\n#ifdef FOG\r\nv_fog_pos=fog_position(a_pos);\r\n#endif\r\n}"),symbolIcon:Ze("uniform sampler2D u_texture;\r\nvarying vec2 v_tex;\r\nvarying float v_fade_opacity;\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\nlowp float alpha=opacity*v_fade_opacity;\r\ngl_FragColor=texture2D(u_texture,v_tex)*alpha;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","attribute vec4 a_pos_offset;\r\nattribute vec4 a_data;\r\nattribute vec4 a_pixeloffset;\r\nattribute vec3 a_projected_pos;\r\nattribute float a_fade_opacity;\r\nuniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;\r\nuniform highp float u_pitch;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform float u_fade_change;\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_coord_matrix;\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\nuniform vec2 u_texsize;\r\nvarying vec2 v_tex;\r\nvarying float v_fade_opacity;\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\nvec2 a_pos=a_pos_offset.xy;\r\nvec2 a_offset=a_pos_offset.zw;\r\nvec2 a_tex=a_data.xy;\r\nvec2 a_size=a_data.zw;\r\nfloat a_size_min=floor(a_size[0]*0.5);\r\nvec2 a_pxoffset=a_pixeloffset.xy;\r\nvec2 a_minFontScale=a_pixeloffset.zw/256.0;\r\nhighp float segment_angle=-a_projected_pos[2];\r\nfloat size;\r\nif (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=mix(a_size_min,a_size[1],u_size_t)/128.0;\r\n} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=a_size_min/128.0;\r\n} else {\r\nsize=u_size;\r\n}\r\nfloat h=elevation(a_pos);\r\nvec4 projectedPoint=u_matrix*vec4(a_pos,h,1);\r\nhighp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\r\ncamera_to_anchor_distance/u_camera_to_center_distance :\r\nu_camera_to_center_distance/camera_to_anchor_distance;\r\nhighp float perspective_ratio=clamp(\r\n0.5+0.5*distance_ratio,0.0,1.5);\r\nsize*=perspective_ratio;\r\nfloat fontScale=u_is_text ? size/24.0 : size;\r\nhighp float symbol_rotation=0.0;\r\nif (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);\r\nvec2 a=projectedPoint.xy/projectedPoint.w;\r\nvec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;\r\nsymbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r\n}\r\nhighp float angle_sin=sin(segment_angle+symbol_rotation);\r\nhighp float angle_cos=cos(segment_angle+symbol_rotation);\r\nmat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);\r\nfloat z=0.0;\r\nvec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\r\n#ifdef PITCH_WITH_MAP_TERRAIN\r\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);\r\nz=elevation(tile_pos.xy);\r\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));\r\nv_tex=a_tex/u_texsize;\r\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);\r\nfloat fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r\nv_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\r\n}"),symbolSDF:Ze("#define SDF_PX 8.0\r\nuniform bool u_is_halo;\r\nuniform sampler2D u_texture;\r\nuniform highp float u_gamma_scale;\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform bool u_is_text;\r\nvarying vec2 v_data0;\r\nvarying vec3 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;\r\nvec2 tex=v_data0.xy;\r\nfloat gamma_scale=v_data1.x;\r\nfloat size=v_data1.y;\r\nfloat fade_opacity=v_data1[2];\r\nfloat fontScale=u_is_text ? size/24.0 : size;\r\nlowp vec4 color=fill_color;\r\nhighp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);\r\nlowp float buff=(256.0-64.0)/256.0;\r\nif (u_is_halo) {\r\ncolor=halo_color;\r\ngamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);\r\nbuff=(6.0-halo_width/fontScale)/SDF_PX;\r\n}\r\nlowp float dist=texture2D(u_texture,tex).a;\r\nhighp float gamma_scaled=gamma*gamma_scale;\r\nhighp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);\r\ngl_FragColor=color*(alpha*opacity*fade_opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","attribute vec4 a_pos_offset;\r\nattribute vec4 a_data;\r\nattribute vec4 a_pixeloffset;\r\nattribute vec3 a_projected_pos;\r\nattribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_coord_matrix;\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\nuniform highp float u_pitch;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform highp float u_camera_to_center_distance;\r\nuniform float u_fade_change;\r\nuniform vec2 u_texsize;\r\nvarying vec2 v_data0;\r\nvarying vec3 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\nvec2 a_pos=a_pos_offset.xy;\r\nvec2 a_offset=a_pos_offset.zw;\r\nvec2 a_tex=a_data.xy;\r\nvec2 a_size=a_data.zw;\r\nfloat a_size_min=floor(a_size[0]*0.5);\r\nvec2 a_pxoffset=a_pixeloffset.xy;\r\nhighp float segment_angle=-a_projected_pos[2];\r\nfloat size;\r\nif (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=mix(a_size_min,a_size[1],u_size_t)/128.0;\r\n} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=a_size_min/128.0;\r\n} else {\r\nsize=u_size;\r\n}\r\nfloat h=elevation(a_pos);\r\nvec4 projectedPoint=u_matrix*vec4(a_pos,h,1);\r\nhighp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\r\ncamera_to_anchor_distance/u_camera_to_center_distance :\r\nu_camera_to_center_distance/camera_to_anchor_distance;\r\nhighp float perspective_ratio=clamp(\r\n0.5+0.5*distance_ratio,0.0,1.5);\r\nsize*=perspective_ratio;\r\nfloat fontScale=u_is_text ? size/24.0 : size;\r\nhighp float symbol_rotation=0.0;\r\nif (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);\r\nvec2 a=projectedPoint.xy/projectedPoint.w;\r\nvec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;\r\nsymbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r\n}\r\nhighp float angle_sin=sin(segment_angle+symbol_rotation);\r\nhighp float angle_cos=cos(segment_angle+symbol_rotation);\r\nmat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);\r\nfloat z=0.0;\r\nvec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\r\n#ifdef PITCH_WITH_MAP_TERRAIN\r\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);\r\nz=elevation(tile_pos.xy);\r\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));\r\nfloat gamma_scale=gl_Position.w;\r\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);\r\nfloat fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r\nfloat interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\r\nv_data0=a_tex/u_texsize;\r\nv_data1=vec3(gamma_scale,size,interpolated_fade_opacity);\r\n}"),symbolTextAndIcon:Ze("#define SDF_PX 8.0\r\n#define SDF 1.0\r\n#define ICON 0.0\r\nuniform bool u_is_halo;\r\nuniform sampler2D u_texture;\r\nuniform sampler2D u_texture_icon;\r\nuniform highp float u_gamma_scale;\r\nuniform lowp float u_device_pixel_ratio;\r\nvarying vec4 v_data0;\r\nvarying vec4 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\nfloat fade_opacity=v_data1[2];\r\nif (v_data1.w==ICON) {\r\nvec2 tex_icon=v_data0.zw;\r\nlowp float alpha=opacity*fade_opacity;\r\ngl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nreturn;\r\n}\r\nvec2 tex=v_data0.xy;\r\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;\r\nfloat gamma_scale=v_data1.x;\r\nfloat size=v_data1.y;\r\nfloat fontScale=size/24.0;\r\nlowp vec4 color=fill_color;\r\nhighp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);\r\nlowp float buff=(256.0-64.0)/256.0;\r\nif (u_is_halo) {\r\ncolor=halo_color;\r\ngamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);\r\nbuff=(6.0-halo_width/fontScale)/SDF_PX;\r\n}\r\nlowp float dist=texture2D(u_texture,tex).a;\r\nhighp float gamma_scaled=gamma*gamma_scale;\r\nhighp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);\r\ngl_FragColor=color*(alpha*opacity*fade_opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","attribute vec4 a_pos_offset;\r\nattribute vec4 a_data;\r\nattribute vec3 a_projected_pos;\r\nattribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_coord_matrix;\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\nuniform highp float u_pitch;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform highp float u_camera_to_center_distance;\r\nuniform float u_fade_change;\r\nuniform vec2 u_texsize;\r\nuniform vec2 u_texsize_icon;\r\nvarying vec4 v_data0;\r\nvarying vec4 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\nvec2 a_pos=a_pos_offset.xy;\r\nvec2 a_offset=a_pos_offset.zw;\r\nvec2 a_tex=a_data.xy;\r\nvec2 a_size=a_data.zw;\r\nfloat a_size_min=floor(a_size[0]*0.5);\r\nfloat is_sdf=a_size[0]-2.0*a_size_min;\r\nhighp float segment_angle=-a_projected_pos[2];\r\nfloat size;\r\nif (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=mix(a_size_min,a_size[1],u_size_t)/128.0;\r\n} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=a_size_min/128.0;\r\n} else {\r\nsize=u_size;\r\n}\r\nfloat h=elevation(a_pos);\r\nvec4 projectedPoint=u_matrix*vec4(a_pos,h,1);\r\nhighp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\r\ncamera_to_anchor_distance/u_camera_to_center_distance :\r\nu_camera_to_center_distance/camera_to_anchor_distance;\r\nhighp float perspective_ratio=clamp(\r\n0.5+0.5*distance_ratio,0.0,1.5);\r\nsize*=perspective_ratio;\r\nfloat fontScale=size/24.0;\r\nhighp float symbol_rotation=0.0;\r\nif (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);\r\nvec2 a=projectedPoint.xy/projectedPoint.w;\r\nvec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;\r\nsymbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r\n}\r\nhighp float angle_sin=sin(segment_angle+symbol_rotation);\r\nhighp float angle_cos=cos(segment_angle+symbol_rotation);\r\nmat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);\r\nfloat z=0.0;\r\nvec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\r\n#ifdef PITCH_WITH_MAP_TERRAIN\r\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);\r\nz=elevation(tile_pos.xy);\r\n#endif\r\nfloat occlusion_fade=occlusionFade(projectedPoint);\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));\r\nfloat gamma_scale=gl_Position.w;\r\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);\r\nfloat fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r\nfloat interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\r\nv_data0.xy=a_tex/u_texsize;\r\nv_data0.zw=a_tex/u_texsize_icon;\r\nv_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);\r\n}"),terrainRaster:Ze("uniform sampler2D u_image0;\r\nvarying vec2 v_pos0;\r\n#ifdef FOG\r\nvarying float v_fog_opacity;\r\n#endif\r\nvoid main() {\r\nvec4 color=texture2D(u_image0,v_pos0);\r\n#ifdef FOG\r\ncolor.rgb=fog_dither(fog_apply_from_vert(color.rgb,v_fog_opacity));\r\n#endif\r\ngl_FragColor=color;\r\n#ifdef TERRAIN_WIREFRAME\r\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\r\n#endif\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform float u_skirt_height;\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\nvarying vec2 v_pos0;\r\n#ifdef FOG\r\nvarying float v_fog_opacity;\r\n#endif\r\nconst float skirtOffset=24575.0;\r\nconst float wireframeOffset=0.00015;\r\nvoid main() {\r\nv_pos0=a_texture_pos/8192.0;\r\nfloat skirt=float(a_pos.x >=skirtOffset);\r\nfloat elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\r\n#ifdef TERRAIN_WIREFRAME\r\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\r\n#endif\r\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);\r\ngl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\r\n#ifdef FOG\r\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\r\n#endif\r\n}"),terrainDepth:Ze("#ifdef GL_ES\r\nprecision highp float;\r\n#endif\nvec4 pack_depth(float ndc_z) {\r\nfloat depth=ndc_z*0.5+0.5;\r\nconst vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);\r\nconst vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);\r\nvec4 res=fract(depth*bit_shift);\r\nres-=res.xxyz*bit_mask;\r\nreturn res;\r\n}\r\nvarying float v_depth;\r\nvoid main() {\r\ngl_FragColor=pack_depth(v_depth);\r\n}","uniform mat4 u_matrix;\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\nvarying float v_depth;\r\nvoid main() {\r\nfloat elevation=elevation(a_texture_pos);\r\ngl_Position=u_matrix*vec4(a_pos,elevation,1.0);\r\nv_depth=gl_Position.z/gl_Position.w;\r\n}"),skybox:Ze("\nvarying lowp vec3 v_uv;\r\nuniform lowp samplerCube u_cubemap;\r\nuniform lowp float u_opacity;\r\nuniform highp float u_temporal_offset;\r\nuniform highp vec3 u_sun_direction;\r\nfloat sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {\r\nhighp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;\r\nconst highp float smoothstep_delta=1e-5;\r\nreturn smoothstep(\r\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);\r\n}\r\nfloat map(float value,float start,float end,float new_start,float new_end) {\r\nreturn ((value-start)*(new_end-new_start))/(end-start)+new_start;\r\n}\r\nvoid main() {\r\nvec3 uv=v_uv;const float y_bias=0.015;\r\nuv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);\r\nvec3 sky_color=textureCube(u_cubemap,uv).rgb;\r\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\r\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);\r\ngl_FragColor=vec4(sky_color*u_opacity,u_opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}",ze),skyboxGradient:Ze("varying highp vec3 v_uv;\r\nuniform lowp sampler2D u_color_ramp;\r\nuniform highp vec3 u_center_direction;\r\nuniform lowp float u_radius;\r\nuniform lowp float u_opacity;\r\nuniform highp float u_temporal_offset;\r\nvoid main() {\r\nfloat progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;\r\nvec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\r\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\r\n#endif\r\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);\r\ngl_FragColor=color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}",ze),skyboxCapture:Ze("\nvarying highp vec3 v_position;\r\nuniform highp float u_sun_intensity;\r\nuniform highp float u_luminance;\r\nuniform lowp vec3 u_sun_direction;\r\nuniform highp vec4 u_color_tint_r;\r\nuniform highp vec4 u_color_tint_m;\r\n#ifdef GL_ES\r\nprecision highp float;\r\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\r\n#define MIE_G                   0.76\r\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\r\n#define DENSITY_STEPS           4\r\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {\r\nfloat a=dot(dir,dir);\r\nfloat b=2.0*dot(dir,orig);\r\nfloat c=dot(orig,orig)-radius*radius;\r\nfloat d=sqrt(b*b-4.0*a*c);\r\nreturn (-b+d)/(2.0*a);\r\n}\r\nvec3 extinction(vec2 density) {\r\nreturn exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));\r\n}\r\nvec2 local_density(vec3 point) {\r\nfloat height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);\r\nfloat exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);\r\nreturn vec2(exp_r,exp_m);\r\n}\r\nfloat phase_ray(float cos_angle) {\r\nreturn (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);\r\n}\r\nfloat phase_mie(float cos_angle) {\r\nreturn (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/\n((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));\r\n}\r\nvec2 density_to_atmosphere(vec3 point,vec3 light_dir) {\r\nfloat ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);\r\nfloat step_len=ray_len/float(DENSITY_STEPS);\r\nvec2 density_point_to_atmosphere=vec2(0.0);\r\nfor (int i=0; i < DENSITY_STEPS;++i) {\r\nvec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);\r\ndensity_point_to_atmosphere+=local_density(point_on_ray)*step_len;;\r\n}\r\nreturn density_point_to_atmosphere;\r\n}\r\nvec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {\r\nvec2 density_orig_to_point=vec2(0.0);\r\nvec3 scatter_r=vec3(0.0);\r\nvec3 scatter_m=vec3(0.0);\r\nvec3 origin=vec3(0.0,PLANET_RADIUS,0.0);\r\nfloat ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);\r\nfloat step_len=ray_len/float(SAMPLE_STEPS);\r\nfor (int i=0; i < SAMPLE_STEPS;++i) {\r\nvec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;\r\ndensity_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;\r\nvec3 extinction=extinction(density_orig_to_atmosphere);\r\nscatter_r+=density.x*extinction;\r\nscatter_m+=density.y*extinction;\r\n}float cos_angle=dot(ray_dir,sun_direction);\r\nfloat phase_r=phase_ray(cos_angle);\r\nfloat phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;\r\nvec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;\r\nreturn (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;\r\n}\r\nconst float A=0.15;\r\nconst float B=0.50;\r\nconst float C=0.10;\r\nconst float D=0.20;\r\nconst float E=0.02;\r\nconst float F=0.30;\r\nvec3 uncharted2_tonemap(vec3 x) {\r\nreturn ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\r\n}\r\nvoid main() {\r\nvec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;\r\nray_direction.y+=y_bias;\r\nvec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;\r\ngl_FragColor=vec4(color,1.0);\r\n}","attribute highp vec3 a_pos_3f;\r\nuniform mat3 u_matrix_3f;\r\nvarying highp vec3 v_position;\r\nfloat map(float value,float start,float end,float new_start,float new_end) {\r\nreturn ((value-start)*(new_end-new_start))/(end-start)+new_start;\r\n}\r\nvoid main() {\r\nvec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);\r\nv_position=pos.xyz;\r\nv_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);\r\ngl_Position=vec4(a_pos_3f.xy,0.0,1.0);\r\n}")};function Ze(t,e,i){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,n=e.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),s=t.match(r),a=e.match(r),l=ke.match(r);let h=a?a.concat(s):s;i||(Fe.staticUniforms&&(h=Fe.staticUniforms.concat(h)),Ne.staticUniforms&&(h=Ne.staticUniforms.concat(h))),h=h&&h.concat(l);const p={};return{fragmentSource:t=t.replace(o,(t,e,i,o,r)=>(p[r]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nvarying ${i} ${o} ${r};\n#else\nuniform ${i} ${o} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${i} ${o} ${r} = u_${r};\n#endif\n`)),vertexSource:e=e.replace(o,(t,e,i,o,r)=>{var n="float"===o?"vec2":"vec4",s=r.match(/color/)?"color":n;return p[r]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${i} ${n} a_${r};\nvarying ${i} ${o} ${r};\n#else\nuniform ${i} ${o} u_${r};\n#endif\n`:"vec4"==s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${i} ${o} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${i} ${o} ${r} = u_${r};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${i} ${n} a_${r};\n#else\nuniform ${i} ${o} u_${r};\n#endif\n`:"vec4"==s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${o} ${r} = a_${r};\n#else\n    ${i} ${o} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${o} ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${i} ${o} ${r} = u_${r};\n#endif\n`}),staticAttributes:n,staticUniforms:h}}class Ge{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,i,o,r,n,s,a){this.context=t;let l=this.boundPaintVertexBuffers.length!==o.length;for(let t=0;!l&&t<o.length;t++)this.boundPaintVertexBuffers[t]!==o[t]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===i&&!l&&this.boundIndexBuffer===r&&this.boundVertexOffset===n&&this.boundDynamicVertexBuffer===s&&this.boundDynamicVertexBuffer2===a?(t.bindVertexArrayOES.set(this.vao),s&&s.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind()):this.freshBind(e,i,o,r,n,s,a)}freshBind(t,e,i,o,r,n,s){let a;const l=t.numAttributes,h=this.context,p=h.gl;if(h.extVertexArrayObject)this.vao&&this.destroy(),this.vao=h.extVertexArrayObject.createVertexArrayOES(),h.bindVertexArrayOES.set(this.vao),a=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=o,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=n,this.boundDynamicVertexBuffer2=s;else{a=h.currentNumAttributes||0;for(let t=l;t<a;t++)p.disableVertexAttribArray(t)}e.enableAttributes(p,t);for(const e of i)e.enableAttributes(p,t);n&&n.enableAttributes(p,t),s&&s.enableAttributes(p,t),e.bind(),e.setVertexAttribPointers(p,t,r);for(const e of i)e.bind(),e.setVertexAttribPointers(p,t,r);n&&(n.bind(),n.setVertexAttribPointers(p,t,r)),o&&o.bind(),s&&(s.bind(),s.setVertexAttribPointers(p,t,r)),h.currentNumAttributes=l}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ve(t,e,i,o,r,n,s){const a=t.context,l=a.gl,h=i.fbo;if(h){t.prepareDrawTile(e);const p=t.useProgram("hillshade");a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,h.colorAttachment.get());i=((t,e,i,o)=>{var r=i.paint.get("hillshade-shadow-color"),n=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color");let a=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);var l=!t.options.moving;return{u_matrix:o||t.transform.calculateProjMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:(l=e.tileID,e=Math.pow(2,l.canonical.z),l=l.canonical.y,[new K.MercatorCoordinate(0,l/e).toLngLat().lat,new K.MercatorCoordinate(0,(l+1)/e).toLngLat().lat]),u_light:[i.paint.get("hillshade-exaggeration"),a],u_shadow:r,u_highlight:n,u_accent:s}})(t,i,o,t.terrain?e.projMatrix:null);t.prepareDrawProgram(a,p,e.toUnwrapped()),p.draw(a,l.TRIANGLES,r,n,s,K.CullFaceMode.disabled,i,o.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function We(t,e,i){if(e.needsDEMTextureUpload){const o=t.context,r=o.gl;o.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(i.stride);i=i.getPixels();e.demTexture?e.demTexture.update(i,{premultiply:!1}):e.demTexture=new K.Texture(o,i,r.RGBA,{premultiply:!1}),e.needsDEMTextureUpload=!1}}const He=(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_image0:new K.Uniform1i(t,e.u_image0),u_skirt_height:new K.Uniform1f(t,e.u_skirt_height)}),qe=(t,e)=>({u_matrix:t,u_image0:0,u_skirt_height:e}),Ye=new class{constructor(){this.operations={}}newMorphing(t,e,i,o,r){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==i.tileID.key&&(e.queued=i)}else this.operations[t]={startTime:o,phase:0,duration:r,from:e,to:i,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;t=this.operations[t];return{from:t.from,to:t.to,phase:t.phase}}update(t){for(const e in this.operations){const i=this.operations[e];for(i.phase=(t-i.startTime)/i.duration;1<=i.phase||!this._validOp(i);)if(!this._nextOp(i,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},Xe={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ke(u,d,f,g,y){const m=u.context,_=m.gl;let v,b;const o=u.options.showTerrainWireframe?2:0,x=(t,e)=>{if(b!==t){const i=[Xe[t]];e&&i.push(Xe[o]),v=u.useProgram("terrainRaster",null,i),b=t}},w=u.colorModeForRenderPass(),M=new K.DepthMode(_.LEQUAL,K.DepthMode.ReadWrite,u.depthRangeFor3D);Ye.update(y);const P=u.transform,E=6*Math.pow(1.5,22-P.zoom)*d.exaggeration();(o?[!1,!0]:[!1]).forEach(e=>{b=-1;var i,o,r=e?_.LINES:_.TRIANGLES,[n,s]=e?d.getWirefameBuffer():[d.gridIndexBuffer,d.gridSegments];for(const b of g){const g=f.getTile(b),h=K.StencilMode.disabled,p=d.prevTerrainTileForTile[b.key],c=d.terrainTileForTile[b.key];o=c,null!=(i=p)&&null!=o&&i.hasData()&&o.hasData()&&null!=i.demTexture&&null!=o.demTexture&&i.tileID.key!==o.tileID.key&&Ye.newMorphing(b.key,p,c,y,250),m.activeTexture.set(_.TEXTURE0),g.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST);var a=Ye.getMorphValuesForProxy(b.key),l=a?1:0;let t;a&&(t={morphing:{srcDemTile:a.from,dstDemTile:a.to,phase:K.easeCubicInOut(a.phase)}});a=qe(b.projMatrix,(i=b.canonical,o=P.renderWorldCopies,a=void 0,a=1<<i.z,(o||0!==i.x&&i.x!==a-1)&&0!==i.y&&i.y!==a-1?E:E/10));x(l,e),d.setupElevationDraw(g,v,t),u.prepareDrawProgram(m,v,b.toUnwrapped()),v.draw(m,r,M,h,w,K.CullFaceMode.backCCW,a,"terrain_raster",d.gridBuffer,n,s)}})}const $e=t=>({u_matrix:t});function Je(t,e,i,o,r){if(0<r){var n=K.exported.now(),s=(n-t.timeAdded)/r,r=e?(n-e.timeAdded)/r:-1,i=i.getSource(),i=o.coveringZoomLevel({tileSize:i.tileSize,roundZoom:i.roundZoom}),i=!e||Math.abs(e.tileID.overscaledZ-i)>Math.abs(t.tileID.overscaledZ-i),r=i&&t.refreshedUponExpiration?1:K.clamp(i?s:1-r,0,1);return t.refreshedUponExpiration&&1<=s&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-r}:{opacity:r,mix:0}}return{opacity:1,mix:0}}class Qe extends K.SourceCache{constructor(t){const e=Et("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new P(Ot(),null),t.style);super("proxy",e,!1),e.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,t,e){if(!i.freezeTileCoverage){var o=(this.transform=i).coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((t,e)=>{if(t[e.key]="",!this._tiles[e.key]){const t=new K.Tile(e,this._source.tileSize*e.overscaleFactor(),i.tileZoom);t.state="loaded",this._tiles[e.key]=t}return t},{});for(const K in this._tiles)K in o||(this.freeFBO(K),this._tiles[K].state="unloaded",delete this._tiles[K])}}freeFBO(t){var e=this.proxyCachedFBO[t];void 0!==e&&(e=Object.values(e),this.renderCachePool.push(...e),delete this.proxyCachedFBO[t])}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ti extends K.OverscaledTileID{constructor(t,e,i){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=i}}class ei extends K.Elevation{constructor(t,e){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,o,r]=function(){const i=new K.StructArrayLayout4i8,o=new K.StructArrayLayout3ui6,r=131;i.reserve(17161),o.reserve(33800);const n=K.EXTENT/128,s=K.EXTENT+n/2,a=s+n;for(let e=-n;e<a;e+=n)for(let t=-n;t<a;t+=n){const r=t<0||t>s||e<0||e>s?24575:0,n=K.clamp(Math.round(t),0,K.EXTENT),a=K.clamp(Math.round(e),0,K.EXTENT);i.emplaceBack(n+r,a,n,a)}const l=(t,e)=>{t=e*r+t;o.emplaceBack(t+1,t,t+r),o.emplaceBack(t+r,t+r+1,t+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach(e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)}),[i,o,32768]}(),n=t.context;this.gridBuffer=n.createVertexBuffer(i,wt.members),this.gridIndexBuffer=n.createIndexBuffer(o),this.gridSegments=K.SegmentVector.simpleSegment(0,0,i.length,o.length),this.gridNoSkirtSegments=K.SegmentVector.simpleSegment(0,0,i.length,r),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Qe(e.map),this.orthoMatrix=K.create$1(),K.ortho(this.orthoMatrix,0,K.EXTENT,0,K.EXTENT,0,1);var s=n.gl;this._overlapStencilMode=new K.StencilMode({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=e,this._useVertexMorphing=!0,this._exaggeration=1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,i,e){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const o=t.terrain.properties;this.sourceCache=t._getSourceCache(o.get("source")),this._exaggeration=o.get("exaggeration");t=()=>{this.sourceCache.used&&K.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);var t=this.sourceCache.getSource().tileSize/128,e=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(i,t*e,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,t(),this._initializing=!0),t(),i.updateElevation(!e),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){var t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&K.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){var t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(this.enabled){this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(K.MercatorCoordinate.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);var e=this.painter.options;this.renderCached=(e.zooming||e.moving||e.rotating||!!this.forceRenderCached)&&!this._invalidateRenderCache,this._invalidateRenderCache=!1;const s=this.proxyCoords=r.getIds().map(t=>{const e=r.getTileByID(t).tileID;return e.projMatrix=n.calculateProjMatrix(e.toUnwrapped()),e});!function(t,e){const i=e.transform.pointCoordinate(e.transform.getCameraPoint()),n=new K.pointGeometry(i.x,i.y);t.sort((t,e)=>{if(e.overscaledZ-t.overscaledZ)return e.overscaledZ-t.overscaledZ;const i=new K.pointGeometry(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new K.pointGeometry(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),r=n.mult(1<<t.canonical.z);return r.x-=.5,r.y-=.5,r.distSqr(i)-r.distSqr(o)})}(s,this.painter),this._previousZoom=n.zoom;var i=this.proxyToSource||{};this.proxyToSource={},s.forEach(t=>{this.proxyToSource[t.key]={}}),this.terrainTileForTile={};var o=this._style._sourceCaches;for(const K in o){const r=o[K];if(r.used&&(r!==this.sourceCache&&(this._findCoveringTileCache[r.id]={}),this._setupProxiedCoordsForOrtho(r,t[K],i),!r.usedForTerrain)){const n=t[K];r.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}}this.proxiedCoords[r.id]=s.map(t=>new ti(t,t.key,this.orthoMatrix)),this._assignTerrainTiles(s),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(i),this.renderingToTexture=!1,this._updateTimestamp=K.exported.now();const a={};this._visibleDemTiles=[];for(const K of this.proxyCoords){const t=this.terrainTileForTile[K.key];if(t){const r=t.tileID.key;r in a||(this._visibleDemTiles.push(t),a[r]=r)}}}}_assignTerrainTiles(t){this._initializing||t.forEach(t=>{var e;this.terrainTileForTile[t.key]||(e=this._findTileCoveringTileID(t,this.sourceCache))&&(this.terrainTileForTile[t.key]=e)})}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const r in this.terrainTileForTile){var i=this.terrainTileForTile[r],o=i.dem;!o||i.demTexture&&!i.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),We(this.painter,i,o))}}_prepareDemTileUniforms(t,e,i,o){if(!e||null==e.demTexture)return!1;t=t.tileID.canonical,e=Math.pow(2,e.tileID.canonical.z-t.z),o=o||"";return i[`u_dem_tl${o}`]=[t.x*e%1,t.y*e%1],i[`u_dem_scale${o}`]=e,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let i=0;var t=this._visibleDemTiles.reduce((t,e)=>{if(!e.dem)return t;e=e.dem.tree.minimums[0];return 0<e&&i++,t+e},0);return i?t/i:0}_updateEmptyDEMTexture(){const t=this.painter.context,e=t.gl;t.activeTexture.set(e.TEXTURE2);var i=this._getLoadedAreaMinimum(),i={width:1,height:1,data:new Uint8Array(K.DEMData.pack(i,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(i,{premultiply:!1}):o=this._emptyDEMTexture=new K.Texture(t,i,e.RGBA,{premultiply:!1}),o}setupElevationDraw(t,e,i){const o=this.painter.context,r=o.gl,n=(s=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:K.DEMData.getUnpackVector(s),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var s;n.u_dem_size=this.sourceCache.getSource().tileSize,n.u_exaggeration=this.exaggeration();let a=null,l=null,h=1;if(i&&i.morphing&&this._useVertexMorphing){const K=i.morphing.srcDemTile,e=i.morphing.dstDemTile;h=i.morphing.phase,K&&e&&(this._prepareDemTileUniforms(t,K,n,"_prev")&&(l=K),this._prepareDemTileUniforms(t,e,n)&&(a=e))}if(l&&a?(o.activeTexture.set(r.TEXTURE2),a.demTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE,r.NEAREST),o.activeTexture.set(r.TEXTURE4),l.demTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE,r.NEAREST),n.u_dem_lerp=h):(a=this.terrainTileForTile[t.tileID.key],o.activeTexture.set(r.TEXTURE2),(this._prepareDemTileUniforms(t,a,n)?a.demTexture:this.emptyDEMTexture).bind(r.NEAREST,r.CLAMP_TO_EDGE,r.NEAREST)),i&&i.useDepthForOcclusion&&(o.activeTexture.set(r.TEXTURE3),this._depthTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE,r.NEAREST),n.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),i&&i.useMeterToDem&&a){const t=(1<<a.tileID.canonical.z)*K.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;n.u_meter_to_dem=t}i&&i.labelPlaneMatrixInv&&(n.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),e.setTerrainUniformValues(o,n)}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const r=this.painter,n=this.painter.context,s=this.proxySourceCache,a=this.proxiedCoords[s.id],l=()=>{n.bindFramebuffer.set(null),n.viewport.set([0,0,r.width,r.height]),this.renderingToTexture=!1},h=this._drapedRenderBatches.shift();let p=[];var c=r.style.order;let u=0;for(let t=0;t<a.length;t++){const d=a[t],f=s.getTileByID(d.proxyTileKey),g=s.proxyCachedFBO[d.key]?s.proxyCachedFBO[d.key][o]:void 0;let e,i;if(e=this.currentFBO=void 0!==g?s.renderCache[g]:this.pool[u++],f.texture=e.tex,void 0===g||e.dirty){n.bindFramebuffer.set(e.fb.framebuffer),this.renderedToTile=!1,e.dirty&&(n.clear({color:K.Color.transparent}),e.dirty=!1);for(let t=h.start;t<=h.end;++t){const o=r.style._layers[c[t]];if(!o.isHidden(r.transform.zoom)){const s=r.style._getLayerSourceCache(o),a=s?this.proxyToSource[d.key][s.id]:[d];if(a){const l=a;n.viewport.set([0,0,e.fb.width,e.fb.height]),i!==(s?s.id:null)&&(this._setupStencil(a,o,s),i=s?s.id:null),r.renderLayer(r,s,o,l)}}}e.dirty=this.renderedToTile,this.renderedToTile&&p.push(f.tileID),5===u&&((u=0)<p.length&&(l(),Ke(r,this,s,p,this._updateTimestamp),this.renderingToTexture=!0,p=[]))}else p.push(f.tileID)}return l(),0<p.length&&Ke(r,this,s,p,this._updateTimestamp),h.end+1}postRender(){}renderCacheEfficiency(e){const i=e.order.length;if(0===i)return{efficiency:100};let o,r=0,n=0,s=!1;for(let t=0;t<i;++t){const i=e._layers[e.order[t]];this._style.isLayerDraped(i)?(s&&++r,++n):s||(s=!0,o=i.id)}return 0===n?{efficiency:100}:{efficiency:100*(1-r/n),firstUndrapedLayer:o}}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(t=>t.dem).forEach(t=>{e=Math.min(e,t.dem.tree.minimums[0])}),0===e?e:(e-30)*this._exaggeration}raycast(s,a,l){if(!this._visibleDemTiles)return null;const t=this._visibleDemTiles.filter(t=>t.dem).map(t=>{var e=t.tileID,i=Math.pow(2,e.overscaledZ),{x:o,y:r}=e.canonical,n=o/i,e=(o+1)/i,o=r/i,i=(r+1)/i;return{minx:n,miny:o,maxx:e,maxy:i,t:t.dem.tree.raycastRoot(n,o,e,i,s,a,l),tile:t}});t.sort((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE));for(const e of t){if(null==e.t)return null;const t=e.tile.dem.tree.raycast(e.minx,e.miny,e.maxx,e.maxy,s,a,l);if(null!=t)return t}return null}_createFBO(){const t=this.painter.context,e=t.gl,i=this.drapeBufferSize;t.activeTexture.set(e.TEXTURE0);const o=new K.Texture(t,{width:i[0],height:i[1],data:null},e.RGBA);o.bind(e.LINEAR,e.CLAMP_TO_EDGE);const r=t.createFramebuffer(i[0],i[1],!1);return r.colorAttachment.set(o.texture),r.depthAttachment=new mt(t,r.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,r.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):r.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&e.texParameterf(e.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:r,tex:o,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(!this.renderCached)return!0;if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const e=this._style._layers[t],i=e.isHidden(this.painter.transform.zoom),o=e.getCrossfadeParameters(),r=!!o&&1!==o.t,n=e.hasTransition();return"custom"!==e.type&&!i&&(r||n)})}_clearRasterFadeFromRenderCache(){let e=!1;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t]._source instanceof bt){e=!0;break}if(e)for(let t=0;t<this._style.order.length;++t){const n=this._style._layers[this._style.order[t]],s=n.isHidden(this.painter.transform.zoom),a=this._style._getLayerSourceCache(n);if("raster"===n.type&&!s&&a){var i=n.paint.get("raster-fade-duration");for(const e of this.proxyCoords){var o=this.proxyToSource[e.key][a.id];if(o)for(const e of o){var r=Je(a.getTile(e),a.findLoadedParent(e,0),a,this.painter.transform,i);1===r.opacity&&0===r.mix||this._clearRenderCacheForTile(a.id,e)}}}}}_setupDrapedRenderBatches(){const o=this._style.order,r=o.length;if(0!==r){const n=[];let t,e=0,i=this._style._layers[o[e]];for(;!this._style.isLayerDraped(i)&&i.isHidden(this.painter.transform.zoom)&&++e<r;)i=this._style._layers[o[e]];for(;e<r;++e){const r=this._style._layers[o[e]];r.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(r)?void 0===t&&(t=e):void 0!==t&&(n.push({start:t,end:e-1}),t=void 0))}void 0!==t&&n.push({start:t,end:e-1}),this._drapedRenderBatches=n}}_setupRenderCache(i){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()){if(o.renderCache.length>o.renderCachePool.length){const i=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let t=0;t<i.length;++t){const n=Object.values(i[t]);o.renderCachePool.push(...n)}}}else{this._clearRasterFadeFromRenderCache();const s=this.proxyCoords,n=this._tilesDirty;for(let t=s.length-1;0<=t;t--){var r=s[t];if(o.getTileByID(r.key),void 0!==o.proxyCachedFBO[r.key]){const s=i[r.key],e=this.proxyToSource[r.key];let t=0;for(const i in e){const o=e[i],a=s[i];if(!a||a.length!==o.length||o.some((t,e)=>t!==a[e]||n[i]&&n[i].hasOwnProperty(t.key))){t=-1;break}++t}for(const i in o.proxyCachedFBO[r.key])o.renderCache[o.proxyCachedFBO[r.key][i]].dirty=t<0||t!==Object.values(s).length}else for(let e=0;e<this._drapedRenderBatches.length;++e){const s=this._drapedRenderBatches[e];let t=o.renderCachePool.pop();void 0===t&&o.renderCache.length<50&&(t=o.renderCache.length,o.renderCache.push(this._createFBO())),void 0!==t&&(void 0===o.proxyCachedFBO[r.key]&&(o.proxyCachedFBO[r.key]={}),o.proxyCachedFBO[r.key][s.start]=t,o.renderCache[t].dirty=!0)}}this._tilesDirty={}}}_setupStencil(e,i,t){if(t&&this._sourceTilesOverlap[t.id]){const o=this.painter.context,r=o.gl;if(e.length<=1)this._overlapStencilType=!1;else{let t;if(i.isTileClipped())t=e.length,this._overlapStencilMode.test={func:r.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);t=1,this._overlapStencilMode.test={func:r.GREATER,mask:255},this._overlapStencilType="Mask"}255<this._stencilRef+t&&(o.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=t,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}}else this._overlapStencilType&&(this._overlapStencilType=!1)}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):K.StencilMode.disabled}_renderTileClippingMasks(t,e){const i=this.painter,o=this.painter.context,r=o.gl;i._tileClippingMaskIDs={},o.setColorMode(K.ColorMode.disabled),o.setDepthMode(K.DepthMode.disabled);const n=i.useProgram("clippingMask");for(const s of t){const t=i._tileClippingMaskIDs[s.key]=--e;n.draw(o,r.TRIANGLES,K.DepthMode.disabled,new K.StencilMode({func:r.ALWAYS,mask:0},t,255,r.KEEP,r.KEEP,r.REPLACE),K.ColorMode.disabled,K.CullFaceMode.disabled,$e(s.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(t){var e=this.painter.transform;if(t.x<0||t.x>e.width||t.y<0||t.y>e.height)return null;const i=[t.x,t.y,1,1];K.transformMat4(i,i,e.pixelMatrixInverse),K.scale$2(i,i,1/i[3]),i[0]/=e.worldSize,i[1]/=e.worldSize;const o=e._camera.position,r=K.mercatorZfromAltitude(1,e.center.lat),n=[o[0],o[1],o[2]/r,0],s=K.subtract([],i.slice(0,3),n);K.normalize(s,s);e=this.raycast(n,s,this._exaggeration);return null!==e&&e?(K.scaleAndAdd(n,n,s,e),n[3]=n[2],n[2]*=r,n):null}drawDepth(){const t=this.painter,e=t.context,i=this.proxySourceCache,o=Math.ceil(t.width),r=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===o&&this._depthFBO.height===r||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const t=e.gl,i=e.createFramebuffer(o,r,!0);e.activeTexture.set(t.TEXTURE0);const s=new K.Texture(e,{width:o,height:r,data:null},t.RGBA);s.bind(t.NEAREST,t.CLAMP_TO_EDGE),i.colorAttachment.set(s.texture);var n=e.createRenderbuffer(e.gl.DEPTH_COMPONENT16,o,r);i.depthAttachment.set(n),this._depthFBO=i,this._depthTexture=s}e.bindFramebuffer.set(this._depthFBO.framebuffer),e.viewport.set([0,0,o,r]),function(t,e,i,o){const r=t.context,n=r.gl;r.clear({depth:1});const s=t.useProgram("terrainDepth"),a=new K.DepthMode(n.LESS,K.DepthMode.ReadWrite,t.depthRangeFor3D);for(const t of o){const o=i.getTile(t),l=qe(t.projMatrix,0);e.setupElevationDraw(o,s),s.draw(r,n.TRIANGLES,a,K.StencilMode.disabled,K.ColorMode.unblended,K.CullFaceMode.backCCW,l,"terrain_depth",e.gridBuffer,e.gridIndexBuffer,e.gridNoSkirtSegments)}}(t,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,i,o){if(e.getSource()instanceof Mt)return this._setupProxiedCoordsForImageSource(e,i,o);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const r=this.proxiedCoords[e.id]=[],n=this.proxyCoords;for(let t=0;t<n.length;t++){const s=n[t],l=this._findTileCoveringTileID(s,e);if(l){const i=this._createProxiedId(s,l,o[s.key]&&o[s.key][e.id]);r.push(i),this.proxyToSource[s.key][e.id]=[i]}}let s=!1;for(let t=0;t<i.length;t++){const h=e.getTile(i[t]);if(h&&h.hasData()){var a=this._findTileCoveringTileID(h.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==h.tileID.canonical.z){const i=this.proxyToSource[a.tileID.key][e.id],n=this._createProxiedId(a.tileID,h,o[a.tileID.key]&&o[a.tileID.key][e.id]);i?i.splice(i.length-1,0,n):this.proxyToSource[a.tileID.key][e.id]=[n],r.push(n),s=!0}}}this._sourceTilesOverlap[e.id]=s}_setupProxiedCoordsForImageSource(e,i,o){if(e.getSource().loaded()){const r=this.proxiedCoords[e.id]=[],n=this.proxyCoords,s=e.getSource(),a=new K.pointGeometry(s.tileID.x,s.tileID.y)._div(1<<s.tileID.z),l=s.coordinates.map(K.MercatorCoordinate.fromLngLat).reduce((t,e)=>(t.min.x=Math.min(t.min.x,e.x-a.x),t.min.y=Math.min(t.min.y,e.y-a.y),t.max.x=Math.max(t.max.x,e.x-a.x),t.max.y=Math.max(t.max.y,e.y-a.y),t),{min:new K.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new K.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),h=(t,e)=>{var i=t.wrap+t.canonical.x/(1<<t.canonical.z),o=t.canonical.y/(1<<t.canonical.z),r=K.EXTENT/(1<<t.canonical.z),t=e.wrap+e.canonical.x/(1<<e.canonical.z),e=e.canonical.y/(1<<e.canonical.z);return i+r<t+l.min.x||i>t+l.max.x||o+r<e+l.min.y||o>e+l.max.y};for(let t=0;t<n.length;t++){const s=n[t];for(let t=0;t<i.length;t++){const n=e.getTile(i[t]);if(n&&n.hasData()&&!h(s,n.tileID)){const a=this._createProxiedId(s,n,o[s.key]&&o[s.key][e.id]),l=this.proxyToSource[s.key][e.id];l?l.push(a):this.proxyToSource[s.key][e.id]=[a],r.push(a)}}}}}_createProxiedId(o,r,n){let s=this.orthoMatrix;if(n){const K=n.find(t=>t.key===r.tileID.key);if(K)return K}if(r.tileID.key!==o.key){const a=o.canonical.z-r.tileID.canonical.z;let t,e,i;s=K.create$1();n=r.tileID.wrap-o.wrap<<o.overscaledZ;i=0<a?(t=K.EXTENT>>a,e=t*((r.tileID.canonical.x<<a)-o.canonical.x+n),t*((r.tileID.canonical.y<<a)-o.canonical.y)):(t=K.EXTENT<<-a,e=K.EXTENT*(r.tileID.canonical.x-(o.canonical.x+n<<-a)),K.EXTENT*(r.tileID.canonical.y-(o.canonical.y<<-a))),K.ortho(s,0,t,0,t,0,1),K.translate(s,s,[e,i,0])}return new ti(r.tileID,o.key,s)}_findTileCoveringTileID(t,e){let i=e.getTile(t);if(i&&i.hasData())return i;const o=this._findCoveringTileCache[e.id],r=o[t.key];if(i=r?e.getTileByID(r):null,i&&i.hasData()||null===r)return i;let n=i?i.tileID:t,s=n.overscaledZ;const a=e.getSource().minzoom,l=[];if(!r){const o=e.getSource().maxzoom;if(t.canonical.z>=o){const i=t.canonical.z-o;e.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,e.transform.tileZoom),n=new K.OverscaledTileID(s,t.wrap,o,t.canonical.x>>i,t.canonical.y>>i)):0!=i&&(s=o,n=new K.OverscaledTileID(s,t.wrap,o,t.canonical.x>>i,t.canonical.y>>i))}n.key!==t.key&&(l.push(n.key),i=e.getTile(n))}var h=e=>{l.forEach(t=>{o[t]=e}),l.length=0};for(--s;s>=a&&(!i||!i.hasData());s--){i&&h(i.tileID.key);const K=n.calculateScaledKey(s);if(i=e.getTileByID(K),i&&i.hasData())break;const t=o[K];if(null===t)break;void 0===t?l.push(K):i=e.getTileByID(t)}return h(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(t){this.renderedToTile||(this.renderedToTile=!0)}_clearRenderCacheForTile(t,e){let i=this._tilesDirty[t];i=i||(this._tilesDirty[t]={}),i[e.key]=!0}getWirefameBuffer(){var t;return this.wireframeSegments||(t=function(){let t,e,i;const o=new K.StructArrayLayout2ui4;for(e=1;e<129;e++){for(t=1;t<129;t++)i=131*e+t,o.emplaceBack(i,i+1),o.emplaceBack(i,i+131),o.emplaceBack(i+1,i+131),128===e&&o.emplaceBack(i+131,i+131+1);o.emplaceBack(i+1,i+1+131)}return o}(),this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=K.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)),[this.wireframeIndexBuffer,this.wireframeSegments]}}function ii(e){const i=[];for(let t=0;t<e.length;t++)if(null!==e[t]){const o=e[t].split(" ");i.push(o.pop())}return i}class oi{static cacheKey(t,e,i){let o=`${t}${i?i.cacheKey:""}`;for(const t of e)o+=`/${t}`;return o}constructor(t,e,i,o,r,n){const s=t.gl;this.program=s.createProgram();const a=ii(i.staticAttributes),l=o?o.getBinderAttributes():[],h=a.concat(l),p=i.staticUniforms?ii(i.staticUniforms):[],c=o?o.getBinderUniforms():[],u=p.concat(c),d=[];for(const K of u)d.indexOf(K)<0&&d.push(K);let f=o?o.defines():[];f=f.concat(n.map(t=>`#define ${t}`));var g=f.concat(Ue.fragmentSource,Be,Ne.fragmentSource,i.fragmentSource).join("\n"),y=f.concat(Ue.vertexSource,Be,Ne.vertexSource,Fe.vertexSource,i.vertexSource).join("\n"),i=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(i,g),s.compileShader(i),s.attachShader(this.program,i);g=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(g,y),s.compileShader(g),s.attachShader(this.program,g),this.attributes={};const m={};this.numAttributes=h.length;for(let t=0;t<this.numAttributes;t++)h[t]&&(s.bindAttribLocation(this.program,t,h[t]),this.attributes[h[t]]=t);s.linkProgram(this.program),s.deleteShader(g),s.deleteShader(i);for(let t=0;t<d.length;t++){const _=d[t];if(_&&!m[_]){const K=s.getUniformLocation(this.program,_);K&&(m[_]=K)}}this.fixedUniforms=r(t,m),this.binderUniforms=o?o.getUniforms(t,m):[],-1!==n.indexOf("TERRAIN")&&(this.terrainUniforms=(r=t,o=m,{u_dem:new K.Uniform1i(r,o.u_dem),u_dem_prev:new K.Uniform1i(r,o.u_dem_prev),u_dem_unpack:new K.Uniform4f(r,o.u_dem_unpack),u_dem_tl:new K.Uniform2f(r,o.u_dem_tl),u_dem_scale:new K.Uniform1f(r,o.u_dem_scale),u_dem_tl_prev:new K.Uniform2f(r,o.u_dem_tl_prev),u_dem_scale_prev:new K.Uniform1f(r,o.u_dem_scale_prev),u_dem_size:new K.Uniform1f(r,o.u_dem_size),u_dem_lerp:new K.Uniform1f(r,o.u_dem_lerp),u_exaggeration:new K.Uniform1f(r,o.u_exaggeration),u_depth:new K.Uniform1i(r,o.u_depth),u_depth_size_inv:new K.Uniform2f(r,o.u_depth_size_inv),u_meter_to_dem:new K.Uniform1f(r,o.u_meter_to_dem),u_label_plane_matrix_inv:new K.UniformMatrix4f(r,o.u_label_plane_matrix_inv)})),-1!==n.indexOf("FOG")&&(this.fogUniforms=(n=t,t=m,{u_fog_matrix:new K.UniformMatrix4f(n,t.u_fog_matrix),u_fog_range:new K.Uniform2f(n,t.u_fog_range),u_fog_color:new K.Uniform4f(n,t.u_fog_color),u_fog_horizon_blend:new K.Uniform1f(n,t.u_fog_horizon_blend),u_fog_temporal_offset:new K.Uniform1f(n,t.u_fog_temporal_offset)}))}}}setTerrainUniformValues(t,e){if(this.terrainUniforms){const i=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(e[t])}}}setFogUniformValues(t,e){if(this.fogUniforms){const i=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].location&&i[t].set(e[t])}}}draw(t,e,i,o,r,n,s,a,l,h,p,c,u,d,f,g){const y=t.gl;if(!this.failedToCreate){t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(o),t.setColorMode(r),t.setCullFace(n);for(const t in this.fixedUniforms)this.fixedUniforms[t].set(s[t]);d&&d.setUniforms(t,this.binderUniforms,c,{zoom:u});var m={[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[e];for(const i of p.get()){const o=i.vaos||(i.vaos={});(o[a]||(o[a]=new Ge)).bind(t,this,l,d?d.getPaintVertexBuffers():[],h,i.vertexOffset,f,g),y.drawElements(e,i.primitiveLength*m,y.UNSIGNED_SHORT,i.primitiveOffset*m*2)}}}}function ri(t,e,i){var o=1/$(i,1,e.transform.tileZoom),r=Math.pow(2,i.tileID.overscaledZ),e=i.tileSize*Math.pow(2,e.transform.tileZoom)/r,r=e*(i.tileID.canonical.x+i.tileID.wrap*r),e=e*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[o,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[r>>16,e>>16],u_pixel_coord_lower:[65535&r,65535&e]}}const ni=(t,e,i,o)=>{const r=e.style.light,n=r.properties.get("position"),s=[n.x,n.y,n.z],a=K.create$2();"viewport"===r.properties.get("anchor")&&(K.fromRotation(a,-e.transform.angle),K.transformMat3(s,s,a));e=r.properties.get("color");return{u_matrix:t,u_lightpos:s,u_lightintensity:r.properties.get("intensity"),u_lightcolor:[e.r,e.g,e.b],u_vertical_gradient:+i,u_opacity:o}},si=t=>({u_matrix:t}),ai=(t,e,i,o)=>K.extend(si(t),ri(i,e,o)),li=(t,e,i,o,r)=>K.extend(ai(t,e,i,o),{u_world:r}),hi=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),pi=(t,e,i,o)=>{var r=t.transform;return{u_matrix:ui(t,e,i,o),u_ratio:1/$(e,1,r.zoom),u_device_pixel_ratio:K.exported.devicePixelRatio,u_units_to_pixels:[1/r.pixelsToGLUnits[0],1/r.pixelsToGLUnits[1]]}};function ci(t,e){return 1/$(t,1,e.tileZoom)}function ui(t,e,i,o){return t.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const di=(t,e,i,o,r)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:i,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:0<(o=r.paint.get("raster-saturation"))?1-1/(1.001-o):-o,u_contrast_factor:0<(o=r.paint.get("raster-contrast"))?1/(1-o):1+o,u_spin_weights:function(t){t*=Math.PI/180;var e=Math.sin(t),t=Math.cos(t);return[(2*t+1)/3,(-Math.sqrt(3)*e-t+1)/3,(Math.sqrt(3)*e-t+1)/3]}(r.paint.get("raster-hue-rotate"))}};const fi=(t,e,i,o,r,n,s,a,l,h)=>{var p=r.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:p.cameraToCenterDistance,u_pitch:p.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:p.width/p.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:n,u_label_plane_matrix:s,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+o,u_texsize:h,u_texture:0}},gi=(t,e,i,o,r,n,s,a,l,h,p)=>{var{cameraToCenterDistance:c,_pitch:u}=r.transform;return K.extend(fi(t,e,i,o,r,n,s,a,l,h),{u_gamma_scale:o?c*Math.cos(r.terrain?0:u):1,u_device_pixel_ratio:K.exported.devicePixelRatio,u_is_halo:+p})},yi={fillExtrusion:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_lightpos:new K.Uniform3f(t,e.u_lightpos),u_lightintensity:new K.Uniform1f(t,e.u_lightintensity),u_lightcolor:new K.Uniform3f(t,e.u_lightcolor),u_vertical_gradient:new K.Uniform1f(t,e.u_vertical_gradient),u_opacity:new K.Uniform1f(t,e.u_opacity)}),fillExtrusionPattern:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_lightpos:new K.Uniform3f(t,e.u_lightpos),u_lightintensity:new K.Uniform1f(t,e.u_lightintensity),u_lightcolor:new K.Uniform3f(t,e.u_lightcolor),u_vertical_gradient:new K.Uniform1f(t,e.u_vertical_gradient),u_height_factor:new K.Uniform1f(t,e.u_height_factor),u_image:new K.Uniform1i(t,e.u_image),u_texsize:new K.Uniform2f(t,e.u_texsize),u_pixel_coord_upper:new K.Uniform2f(t,e.u_pixel_coord_upper),u_pixel_coord_lower:new K.Uniform2f(t,e.u_pixel_coord_lower),u_scale:new K.Uniform3f(t,e.u_scale),u_fade:new K.Uniform1f(t,e.u_fade),u_opacity:new K.Uniform1f(t,e.u_opacity)}),fill:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix)}),fillPattern:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_image:new K.Uniform1i(t,e.u_image),u_texsize:new K.Uniform2f(t,e.u_texsize),u_pixel_coord_upper:new K.Uniform2f(t,e.u_pixel_coord_upper),u_pixel_coord_lower:new K.Uniform2f(t,e.u_pixel_coord_lower),u_scale:new K.Uniform3f(t,e.u_scale),u_fade:new K.Uniform1f(t,e.u_fade)}),fillOutline:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_world:new K.Uniform2f(t,e.u_world)}),fillOutlinePattern:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_world:new K.Uniform2f(t,e.u_world),u_image:new K.Uniform1i(t,e.u_image),u_texsize:new K.Uniform2f(t,e.u_texsize),u_pixel_coord_upper:new K.Uniform2f(t,e.u_pixel_coord_upper),u_pixel_coord_lower:new K.Uniform2f(t,e.u_pixel_coord_lower),u_scale:new K.Uniform3f(t,e.u_scale),u_fade:new K.Uniform1f(t,e.u_fade)}),circle:(t,e)=>({u_camera_to_center_distance:new K.Uniform1f(t,e.u_camera_to_center_distance),u_extrude_scale:new K.Uniform2f(t,e.u_extrude_scale),u_device_pixel_ratio:new K.Uniform1f(t,e.u_device_pixel_ratio),u_matrix:new K.UniformMatrix4f(t,e.u_matrix)}),collisionBox:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_camera_to_center_distance:new K.Uniform1f(t,e.u_camera_to_center_distance),u_extrude_scale:new K.Uniform2f(t,e.u_extrude_scale)}),collisionCircle:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_inv_matrix:new K.UniformMatrix4f(t,e.u_inv_matrix),u_camera_to_center_distance:new K.Uniform1f(t,e.u_camera_to_center_distance),u_viewport_size:new K.Uniform2f(t,e.u_viewport_size)}),debug:(t,e)=>({u_color:new K.UniformColor(t,e.u_color),u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_overlay:new K.Uniform1i(t,e.u_overlay),u_overlay_scale:new K.Uniform1f(t,e.u_overlay_scale)}),clippingMask:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix)}),heatmap:(t,e)=>({u_extrude_scale:new K.Uniform1f(t,e.u_extrude_scale),u_intensity:new K.Uniform1f(t,e.u_intensity),u_matrix:new K.UniformMatrix4f(t,e.u_matrix)}),heatmapTexture:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_world:new K.Uniform2f(t,e.u_world),u_image:new K.Uniform1i(t,e.u_image),u_color_ramp:new K.Uniform1i(t,e.u_color_ramp),u_opacity:new K.Uniform1f(t,e.u_opacity)}),hillshade:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_image:new K.Uniform1i(t,e.u_image),u_latrange:new K.Uniform2f(t,e.u_latrange),u_light:new K.Uniform2f(t,e.u_light),u_shadow:new K.UniformColor(t,e.u_shadow),u_highlight:new K.UniformColor(t,e.u_highlight),u_accent:new K.UniformColor(t,e.u_accent)}),hillshadePrepare:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_image:new K.Uniform1i(t,e.u_image),u_dimension:new K.Uniform2f(t,e.u_dimension),u_zoom:new K.Uniform1f(t,e.u_zoom),u_unpack:new K.Uniform4f(t,e.u_unpack)}),line:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_ratio:new K.Uniform1f(t,e.u_ratio),u_device_pixel_ratio:new K.Uniform1f(t,e.u_device_pixel_ratio),u_units_to_pixels:new K.Uniform2f(t,e.u_units_to_pixels)}),lineGradient:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_ratio:new K.Uniform1f(t,e.u_ratio),u_device_pixel_ratio:new K.Uniform1f(t,e.u_device_pixel_ratio),u_units_to_pixels:new K.Uniform2f(t,e.u_units_to_pixels),u_image:new K.Uniform1i(t,e.u_image),u_image_height:new K.Uniform1f(t,e.u_image_height)}),linePattern:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_texsize:new K.Uniform2f(t,e.u_texsize),u_ratio:new K.Uniform1f(t,e.u_ratio),u_device_pixel_ratio:new K.Uniform1f(t,e.u_device_pixel_ratio),u_image:new K.Uniform1i(t,e.u_image),u_units_to_pixels:new K.Uniform2f(t,e.u_units_to_pixels),u_scale:new K.Uniform3f(t,e.u_scale),u_fade:new K.Uniform1f(t,e.u_fade)}),lineSDF:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_texsize:new K.Uniform2f(t,e.u_texsize),u_ratio:new K.Uniform1f(t,e.u_ratio),u_device_pixel_ratio:new K.Uniform1f(t,e.u_device_pixel_ratio),u_units_to_pixels:new K.Uniform2f(t,e.u_units_to_pixels),u_image:new K.Uniform1i(t,e.u_image),u_scale:new K.Uniform3f(t,e.u_scale),u_mix:new K.Uniform1f(t,e.u_mix)}),raster:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_tl_parent:new K.Uniform2f(t,e.u_tl_parent),u_scale_parent:new K.Uniform1f(t,e.u_scale_parent),u_buffer_scale:new K.Uniform1f(t,e.u_buffer_scale),u_fade_t:new K.Uniform1f(t,e.u_fade_t),u_opacity:new K.Uniform1f(t,e.u_opacity),u_image0:new K.Uniform1i(t,e.u_image0),u_image1:new K.Uniform1i(t,e.u_image1),u_brightness_low:new K.Uniform1f(t,e.u_brightness_low),u_brightness_high:new K.Uniform1f(t,e.u_brightness_high),u_saturation_factor:new K.Uniform1f(t,e.u_saturation_factor),u_contrast_factor:new K.Uniform1f(t,e.u_contrast_factor),u_spin_weights:new K.Uniform3f(t,e.u_spin_weights)}),symbolIcon:(t,e)=>({u_is_size_zoom_constant:new K.Uniform1i(t,e.u_is_size_zoom_constant),u_is_size_feature_constant:new K.Uniform1i(t,e.u_is_size_feature_constant),u_size_t:new K.Uniform1f(t,e.u_size_t),u_size:new K.Uniform1f(t,e.u_size),u_camera_to_center_distance:new K.Uniform1f(t,e.u_camera_to_center_distance),u_pitch:new K.Uniform1f(t,e.u_pitch),u_rotate_symbol:new K.Uniform1i(t,e.u_rotate_symbol),u_aspect_ratio:new K.Uniform1f(t,e.u_aspect_ratio),u_fade_change:new K.Uniform1f(t,e.u_fade_change),u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_label_plane_matrix:new K.UniformMatrix4f(t,e.u_label_plane_matrix),u_coord_matrix:new K.UniformMatrix4f(t,e.u_coord_matrix),u_is_text:new K.Uniform1i(t,e.u_is_text),u_pitch_with_map:new K.Uniform1i(t,e.u_pitch_with_map),u_texsize:new K.Uniform2f(t,e.u_texsize),u_texture:new K.Uniform1i(t,e.u_texture)}),symbolSDF:(t,e)=>({u_is_size_zoom_constant:new K.Uniform1i(t,e.u_is_size_zoom_constant),u_is_size_feature_constant:new K.Uniform1i(t,e.u_is_size_feature_constant),u_size_t:new K.Uniform1f(t,e.u_size_t),u_size:new K.Uniform1f(t,e.u_size),u_camera_to_center_distance:new K.Uniform1f(t,e.u_camera_to_center_distance),u_pitch:new K.Uniform1f(t,e.u_pitch),u_rotate_symbol:new K.Uniform1i(t,e.u_rotate_symbol),u_aspect_ratio:new K.Uniform1f(t,e.u_aspect_ratio),u_fade_change:new K.Uniform1f(t,e.u_fade_change),u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_label_plane_matrix:new K.UniformMatrix4f(t,e.u_label_plane_matrix),u_coord_matrix:new K.UniformMatrix4f(t,e.u_coord_matrix),u_is_text:new K.Uniform1i(t,e.u_is_text),u_pitch_with_map:new K.Uniform1i(t,e.u_pitch_with_map),u_texsize:new K.Uniform2f(t,e.u_texsize),u_texture:new K.Uniform1i(t,e.u_texture),u_gamma_scale:new K.Uniform1f(t,e.u_gamma_scale),u_device_pixel_ratio:new K.Uniform1f(t,e.u_device_pixel_ratio),u_is_halo:new K.Uniform1i(t,e.u_is_halo)}),symbolTextAndIcon:(t,e)=>({u_is_size_zoom_constant:new K.Uniform1i(t,e.u_is_size_zoom_constant),u_is_size_feature_constant:new K.Uniform1i(t,e.u_is_size_feature_constant),u_size_t:new K.Uniform1f(t,e.u_size_t),u_size:new K.Uniform1f(t,e.u_size),u_camera_to_center_distance:new K.Uniform1f(t,e.u_camera_to_center_distance),u_pitch:new K.Uniform1f(t,e.u_pitch),u_rotate_symbol:new K.Uniform1i(t,e.u_rotate_symbol),u_aspect_ratio:new K.Uniform1f(t,e.u_aspect_ratio),u_fade_change:new K.Uniform1f(t,e.u_fade_change),u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_label_plane_matrix:new K.UniformMatrix4f(t,e.u_label_plane_matrix),u_coord_matrix:new K.UniformMatrix4f(t,e.u_coord_matrix),u_is_text:new K.Uniform1i(t,e.u_is_text),u_pitch_with_map:new K.Uniform1i(t,e.u_pitch_with_map),u_texsize:new K.Uniform2f(t,e.u_texsize),u_texsize_icon:new K.Uniform2f(t,e.u_texsize_icon),u_texture:new K.Uniform1i(t,e.u_texture),u_texture_icon:new K.Uniform1i(t,e.u_texture_icon),u_gamma_scale:new K.Uniform1f(t,e.u_gamma_scale),u_device_pixel_ratio:new K.Uniform1f(t,e.u_device_pixel_ratio),u_is_halo:new K.Uniform1i(t,e.u_is_halo)}),background:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_opacity:new K.Uniform1f(t,e.u_opacity),u_color:new K.UniformColor(t,e.u_color)}),backgroundPattern:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_opacity:new K.Uniform1f(t,e.u_opacity),u_image:new K.Uniform1i(t,e.u_image),u_pattern_tl_a:new K.Uniform2f(t,e.u_pattern_tl_a),u_pattern_br_a:new K.Uniform2f(t,e.u_pattern_br_a),u_pattern_tl_b:new K.Uniform2f(t,e.u_pattern_tl_b),u_pattern_br_b:new K.Uniform2f(t,e.u_pattern_br_b),u_texsize:new K.Uniform2f(t,e.u_texsize),u_mix:new K.Uniform1f(t,e.u_mix),u_pattern_size_a:new K.Uniform2f(t,e.u_pattern_size_a),u_pattern_size_b:new K.Uniform2f(t,e.u_pattern_size_b),u_scale_a:new K.Uniform1f(t,e.u_scale_a),u_scale_b:new K.Uniform1f(t,e.u_scale_b),u_pixel_coord_upper:new K.Uniform2f(t,e.u_pixel_coord_upper),u_pixel_coord_lower:new K.Uniform2f(t,e.u_pixel_coord_lower),u_tile_units_to_pixels:new K.Uniform1f(t,e.u_tile_units_to_pixels)}),terrainRaster:He,terrainDepth:He,skybox:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_sun_direction:new K.Uniform3f(t,e.u_sun_direction),u_cubemap:new K.Uniform1i(t,e.u_cubemap),u_opacity:new K.Uniform1f(t,e.u_opacity),u_temporal_offset:new K.Uniform1f(t,e.u_temporal_offset)}),skyboxGradient:(t,e)=>({u_matrix:new K.UniformMatrix4f(t,e.u_matrix),u_color_ramp:new K.Uniform1i(t,e.u_color_ramp),u_center_direction:new K.Uniform3f(t,e.u_center_direction),u_radius:new K.Uniform1f(t,e.u_radius),u_opacity:new K.Uniform1f(t,e.u_opacity),u_temporal_offset:new K.Uniform1f(t,e.u_temporal_offset)}),skyboxCapture:(t,e)=>({u_matrix_3f:new K.UniformMatrix3f(t,e.u_matrix_3f),u_sun_direction:new K.Uniform3f(t,e.u_sun_direction),u_sun_intensity:new K.Uniform1f(t,e.u_sun_intensity),u_color_tint_r:new K.Uniform4f(t,e.u_color_tint_r),u_color_tint_m:new K.Uniform4f(t,e.u_color_tint_m),u_luminance:new K.Uniform1f(t,e.u_luminance)})};let mi;function _i(i,o,r,n,s,a,e){const l=i.context,h=l.gl,p=i.useProgram("collisionBox"),c=[];let u=0,d=0;for(let t=0;t<n.length;t++){const g=n[t],y=o.getTile(g),m=y.getBucket(r);if(m){let t=g.projMatrix;0===s[0]&&0===s[1]||(t=i.translatePosMatrix(g.projMatrix,y,s,a));const f=e?m.textCollisionBox:m.iconCollisionBox,_=m.collisionCircleArray;if(0<_.length){const o=K.create$1(),r=t;K.mul$1(o,m.placementInvProjMatrix,i.transform.glCoordMatrix),K.mul$1(o,o,m.placementViewportMatrix),c.push({circleArray:_,circleOffset:d,transform:r,invTransform:o}),u+=_.length/4,d=u}f&&(i.terrain&&i.terrain.setupElevationDraw(y,p),p.draw(l,h.LINES,K.DepthMode.disabled,K.StencilMode.disabled,i.colorModeForRenderPass(),K.CullFaceMode.disabled,((t,e,i)=>{i=K.EXTENT/i.tileSize;return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_extrude_scale:[e.pixelsToGLUnits[0]/i,e.pixelsToGLUnits[1]/i]}})(t,i.transform,y),r.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,null,i.transform.zoom,null,f.collisionVertexBuffer,f.collisionVertexBufferExt))}}if(e&&c.length){const t=i.useProgram("collisionCircle"),g=new K.StructArrayLayout2f1f2i16;g.resize(4*u),g._trim();let e=0;for(const K of c)for(let t=0;t<K.circleArray.length/4;t++){const o=4*t,r=K.circleArray[0+o],n=K.circleArray[1+o],s=K.circleArray[2+o],a=K.circleArray[3+o];g.emplace(e++,r,n,s,a,0),g.emplace(e++,r,n,s,a,1),g.emplace(e++,r,n,s,a,2),g.emplace(e++,r,n,s,a,3)}(!mi||mi.length<2*u)&&(mi=function(e){const i=2*e,o=new K.StructArrayLayout3ui6;o.resize(i),o._trim();for(let t=0;t<i;t++){const e=6*t;o.uint16[0+e]=4*t+0,o.uint16[1+e]=4*t+1,o.uint16[2+e]=4*t+2,o.uint16[3+e]=4*t+2,o.uint16[4+e]=4*t+3,o.uint16[5+e]=4*t+0}return o}(u));const m=l.createIndexBuffer(mi,!0),v=l.createVertexBuffer(g,K.collisionCircleLayout.members,!0);for(const o of c){const n={u_matrix:o.transform,u_inv_matrix:o.invTransform,u_camera_to_center_distance:(f=i.transform).cameraToCenterDistance,u_viewport_size:[f.width,f.height]};t.draw(l,h.TRIANGLES,K.DepthMode.disabled,K.StencilMode.disabled,i.colorModeForRenderPass(),K.CullFaceMode.disabled,n,r.id,v,m,K.SegmentVector.simpleSegment(0,2*o.circleOffset,o.circleArray.length,o.circleArray.length/2),null,i.transform.zoom,null,null,null)}var f;v.destroy(),m.destroy()}}const vi=K.identity(new Float32Array(16));function bi(e,i,o,r,n,s,a,l,h,p,c,u){const d=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,g=e.icon.dynamicLayoutVertexArray,y={};f.clear();for(let t=0;t<d.length;t++){var m=d.get(t),_=e.allowVerticalPlacement&&!m.placedOrientation,_=m.hidden||!m.crossTileID||_?null:r[m.crossTileID];if(_){const r=new K.pointGeometry(m.anchorX,m.anchorY),d=u(r),g=Wt(r,o?l:a,d),v=Ht(s.cameraToCenterDistance,g.signedDistanceFromCamera);let t=n.evaluateSizeForFeature(e.textSizeData,p,m)*v/K.ONE_EM;o&&(t*=e.tilePixelRatio/h);const{width:b,height:x,anchor:w,textOffset:M,textScale:P}=_,E=function(t,e,i,o,r,n){var{horizontalAlign:s,verticalAlign:a}=K.getAnchorAlignment(t),e=-(s-.5)*e,i=-(a-.5)*i,o=K.evaluateVariableOffset(t,o);return new K.pointGeometry((e/r+o[0])*n,(i/r+o[1])*n)}(w,b,x,M,P,t),S=o?Wt(r.add(E),a,d).point:g.point.add(i?E.rotate(-s.angle):E),T=e.allowVerticalPlacement&&m.placedOrientation===K.WritingMode.vertical?Math.PI/2:0;for(let t=0;t<m.numGlyphs;t++)K.addDynamicAttributes(f,S,T);c&&0<=m.associatedIconIndex&&(y[m.associatedIconIndex]={shiftedAnchor:S,angle:T})}else te(m.numGlyphs,f)}if(c){g.clear();const i=e.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const o=i.get(t);if(o.hidden)te(o.numGlyphs,g);else{const i=y[t];if(i)for(let t=0;t<o.numGlyphs;t++)K.addDynamicAttributes(g,i.shiftedAnchor,i.angle);else te(o.numGlyphs,g)}}e.icon.dynamicLayoutVertexBuffer.updateData(g)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function xi(s,a,l,h,p,c,u,d,f,g,y,m){const _=s.context,v=_.gl,b=s.transform,x="map"===d,w="map"===f,M=x&&"point"!==l.layout.get("symbol-placement"),P=x&&!w&&!M,E=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let S=!1;const T=s.depthModeForSublayer(0,K.DepthMode.ReadOnly),A=l.layout.get("text-variable-anchor"),C=[],I=s.terrain&&w?["PITCH_WITH_MAP_TERRAIN"]:null;for(const d of h){const h=a.getTile(d),f=h.getBucket(l);if(f){const y=p?f.text:f.icon;if(y&&y.segments.get().length){const m=y.programConfigurations.get(l.id),_=p||f.sdfIcons,T=p?f.textSizeData:f.iconSizeData,q=w||0!==b.pitch,Y=s.useProgram((W=_,H=p,f.iconsInText&&H?"symbolTextAndIcon":W?"symbolSDF":"symbolIcon"),m,I),X=K.evaluateSizeForZoom(T,b.zoom);let t,e,i,o,r=[0,0],n=null;if(p){if(e=h.glyphAtlasTexture,i=v.LINEAR,t=h.glyphAtlasTexture.size,f.iconsInText){r=h.imageAtlasTexture.size,n=h.imageAtlasTexture;const K="composite"===T.kind||"camera"===T.kind;o=q||s.options.rotating||s.options.zooming||K?v.LINEAR:v.NEAREST}}else{const K=1!==l.layout.get("icon-size").constantOr(0)||f.iconsNeedLinear;e=h.imageAtlasTexture,i=_||s.options.rotating||s.options.zooming||K||q?v.LINEAR:v.NEAREST,t=h.imageAtlasTexture.size}var L=$(h,1,s.transform.zoom),O=Gt(d.projMatrix,w,x,s.transform,L),R=s.terrain&&w&&M?K.invert(new Float32Array(16),O):vi,D=Vt(d.projMatrix,w,x,s.transform,L),k=A&&f.hasTextData(),z="none"!==l.layout.get("icon-text-fit")&&k&&f.hasIconData();if(M){const K=b.elevation;qt(f,d.projMatrix,s,p,O,D,w,g,K?t=>K.getAtTileOffset(d,t.x,t.y):null)}var F=s.translatePosMatrix(d.projMatrix,h,c,u),N=M||p&&A||z?vi:O,U=s.translatePosMatrix(D,h,c,u,!0),B=_&&0!==l.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1),U=_?f.iconsInText?(Z=T.kind,G=X,V=P,H=w,W=s,L=F,k=N,z=U,O=t,D=r,K.extend(gi(Z,G,V,H,W,L,k,z,!0,O,!0),{u_texsize_icon:D,u_texture_icon:1})):gi(T.kind,X,P,w,s,F,N,U,p,t,!0):fi(T.kind,X,P,w,s,F,N,U,p,t),j={program:Y,buffers:y,uniformValues:U,atlasTexture:e,atlasTextureIcon:n,atlasInterpolation:i,atlasInterpolationIcon:o,isSDF:_,hasHalo:B,tile:h,labelPlaneMatrixInv:R};if(E&&f.canOverlap){S=!0;const s=y.segments.get();for(const a of s)C.push({segments:new K.SegmentVector([a]),sortKey:a.sortKey,state:j})}else C.push({segments:y.segments,sortKey:0,state:j})}}}var Z,G,V,W,H;S&&C.sort((t,e)=>t.sortKey-e.sortKey);for(const K of C){const a=K.state;if(s.terrain&&s.terrain.setupElevationDraw(a.tile,a.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:a.labelPlaneMatrixInv}),_.activeTexture.set(v.TEXTURE0),a.atlasTexture.bind(a.atlasInterpolation,v.CLAMP_TO_EDGE),a.atlasTextureIcon&&(_.activeTexture.set(v.TEXTURE1),a.atlasTextureIcon&&a.atlasTextureIcon.bind(a.atlasInterpolationIcon,v.CLAMP_TO_EDGE)),a.isSDF){const h=a.uniformValues;a.hasHalo&&(h.u_is_halo=1,wi(a.buffers,K.segments,l,s,a.program,T,y,m,h)),h.u_is_halo=0}wi(a.buffers,K.segments,l,s,a.program,T,y,m,a.uniformValues)}}function wi(t,e,i,o,r,n,s,a,l){var h=o.context;r.draw(h,h.gl.TRIANGLES,n,s,a,K.CullFaceMode.disabled,l,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,o.transform.zoom,t.programConfigurations.get(i.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Mi(t,e,i,o,r,n,s){const a=t.context.gl,l=i.paint.get("fill-pattern"),h=l&&l.constantOr(1),p=i.getCrossfadeParameters();let c,u,d,f,g;c=s?(u=h&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",a.LINES):(u=h?"fillPattern":"fill",a.TRIANGLES);for(const m of o){const o=e.getTile(m);if(!h||o.patternsLoaded()){const _=o.getBucket(i);if(_){t.prepareDrawTile(m);const v=_.programConfigurations.get(i.id),b=t.useProgram(u,v);h&&(t.context.activeTexture.set(a.TEXTURE0),o.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),v.updatePaintBuffers(p));const x=l.constantOr(null);if(x&&o.imageAtlas){const K=o.imageAtlas,t=K.patternPositions[x.to.toString()],e=K.patternPositions[x.from.toString()];t&&e&&v.setConstantPatternPositions(t,e)}var y=t.translatePosMatrix(m.projMatrix,o,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(s){f=_.indexBuffer2,g=_.segments2;const K=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[a.drawingBufferWidth,a.drawingBufferHeight];d="fillOutlinePattern"===u&&h?li(y,t,p,o,K):{u_matrix:y,u_world:K}}else f=_.indexBuffer,g=_.segments,d=h?ai(y,t,p,o):si(y);t.prepareDrawProgram(t.context,b,m.toUnwrapped()),b.draw(t.context,c,r,t.stencilModeForClipping(m),n,K.CullFaceMode.disabled,d,i.id,_.layoutVertexBuffer,f,g,i.paint,t.transform.zoom,v)}}}}function Pi(t,e,i,o,r,n,s){const a=t.context,l=a.gl,h=i.paint.get("fill-extrusion-pattern"),p=h.constantOr(1),c=i.getCrossfadeParameters(),u=i.paint.get("fill-extrusion-opacity");for(const w of o){const o=e.getTile(w),M=o.getBucket(i);if(M){const P=M.programConfigurations.get(i.id),E=t.useProgram(p?"fillExtrusionPattern":"fillExtrusion",P);if(t.terrain){const K=t.terrain;if(!M.enableTerrain)continue;if(K.setupElevationDraw(o,E,{useMeterToDem:!0}),Ei(a,e,w,M,i,K),!M.centroidVertexBuffer){const K=E.attributes.a_centroid_pos;void 0!==K&&l.vertexAttrib2f(K,0,0)}}p&&(t.context.activeTexture.set(l.TEXTURE0),o.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),P.updatePaintBuffers(c));const S=h.constantOr(null);if(S&&o.imageAtlas){const K=o.imageAtlas,t=K.patternPositions[S.to.toString()],e=K.patternPositions[S.from.toString()];t&&e&&P.setConstantPatternPositions(t,e)}var d=t.translatePosMatrix(w.projMatrix,o,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),f=i.paint.get("fill-extrusion-vertical-gradient"),f=p?(g=d,y=t,m=f,_=u,v=w,b=c,x=o,K.extend(ni(g,y,m,_),ri(b,y,x),{u_height_factor:-Math.pow(2,v.overscaledZ)/x.tileSize/8})):ni(d,t,f,u);t.prepareDrawProgram(a,E,w.toUnwrapped()),E.draw(a,a.gl.TRIANGLES,r,n,s,K.CullFaceMode.backCCW,f,i.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,i.paint,t.transform.zoom,P,t.terrain?M.centroidVertexBuffer:null)}}var g,y,m,_,v,b,x}function Ei(t,s,l,r,a,h){const e=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new K.OverscaledTileID(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new K.OverscaledTileID(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new K.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new K.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)],n=t=>{var e=s.getSource().maxzoom,i=t=>{const e=s.getTileByID(t);if(e&&e.hasData())return e.getBucket(a)};let o,r,n;return(t.overscaledZ===t.canonical.z||t.overscaledZ>=e)&&(o=i(t.key)),t.overscaledZ>=e&&(r=i(t.calculateScaledKey(t.overscaledZ+1))),t.overscaledZ>e&&(n=i(t.calculateScaledKey(t.overscaledZ-1))),o||r||n},p=[0,0,0],c=(t,e)=>(p[0]=Math.min(t.min.y,e.min.y),p[1]=Math.max(t.max.y,e.max.y),p[2]=K.EXTENT-e.min.x>t.max.x?e.min.x-K.EXTENT:t.max.x,p),u=(t,e)=>(p[0]=Math.min(t.min.x,e.min.x),p[1]=Math.max(t.max.x,e.max.x),p[2]=K.EXTENT-e.min.y>t.max.y?e.min.y-K.EXTENT:t.max.y,p),d=[(t,e)=>c(t,e),(t,e)=>c(e,t),(t,e)=>u(t,e),(t,e)=>u(e,t)],f=new K.pointGeometry(0,0);let g,y,m;var _=(t,e,i,o,r)=>{const n=[[o?i:t,o?t:i,0],[o?i:e,o?e:i,0]],s=r<0?K.EXTENT+r:r,a=[o?s:(t+e)/2,o?(t+e)/2:s,0];return 0===i&&r<0||0!==i&&0<r?h.getForTilePoints(m,[a],!0,y):n.push(a),h.getForTilePoints(l,n,!0,g),Math.max(n[0][2],n[1][2],a[2])/h.exaggeration()};for(let o=0;o<4;o++){const s=r.borders[o];if(0===s.length&&(r.borderDone[o]=!0),!r.borderDone[o]){const a=m=e[o](l),p=n(a);if(p&&p.enableTerrain&&(y=h.findDEMTileFor(a),y&&y.dem)){if(!g){const K=h.findDEMTileFor(l);if(!K||!K.dem)return;g=K}const c=(o<2?1:5)-o,u=p.borders[c];let i=0;for(let t=0;t<s.length;t++){const a=r.featuresOnBorder[s[t]],h=a.borders[o];let e;for(;i<u.length&&(e=p.featuresOnBorder[u[i]],!(e.borders[c][1]>h[0]+3));)p.borderDone[c]||p.encodeCentroid(void 0,e,!1),i++;if(e&&i<u.length){const s=i;let t=0;for(;!(e.borders[c][0]>h[1]-3)&&(t++,++i!==u.length);)e=p.featuresOnBorder[u[i]];if(e=p.featuresOnBorder[u[s]],1<a.intersectsCount()||1<e.intersectsCount()||1!==t)1!==t&&(i=s),r.encodeCentroid(void 0,a,!1),p.borderDone[c]||p.encodeCentroid(void 0,e,!1);else{const n=d[o](a,e),g=o%2?K.EXTENT-1:0;f.x=_(n[0],Math.min(K.EXTENT-1,n[1]),g,o<2,n[2]),f.y=0,r.encodeCentroid(f,a,!1),p.borderDone[c]||p.encodeCentroid(f,e,!1)}}else r.encodeCentroid(void 0,a,!1)}r.borderDone[o]=r.needsCentroidUpdate=!0,p.borderDone[c]||(p.borderDone[c]=p.needsCentroidUpdate=!0)}}}(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}const Si=new K.Color(1,0,0,1),Ti=new K.Color(0,1,0,1),Ai=new K.Color(0,0,1,1),Ci=new K.Color(1,0,1,1),Ii=new K.Color(0,1,1,1);function Li(t,e,i,o){Ri(t,0,e+i/2,t.transform.width,i,o)}function Oi(t,e,i,o){Ri(t,e-i/2,0,i,t.transform.height,o)}function Ri(t,e,i,o,r,n){const s=t.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(e*K.exported.devicePixelRatio,i*K.exported.devicePixelRatio,o*K.exported.devicePixelRatio,r*K.exported.devicePixelRatio),s.clear({color:n}),a.disable(a.SCISSOR_TEST)}function Di(t,e,i){const o=t.context,r=o.gl,n=i.projMatrix,s=t.useProgram("debug"),a=e.getTileByID(i.key);t.terrain&&t.terrain.setupElevationDraw(a,s);var l=K.DepthMode.disabled,h=K.StencilMode.disabled,p=t.colorModeForRenderPass();o.activeTexture.set(r.TEXTURE0),t.emptyTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE),s.draw(o,r.LINE_STRIP,l,h,p,K.CullFaceMode.disabled,hi(n,K.Color.red),"$debug",t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments);p=a.latestRawTileData,p=Math.floor((p&&p.byteLength||0)/1024),e=e.getTile(i).tileSize,e=512/Math.min(e,512)*(i.overscaledZ/t.transform.zoom)*.5;let c=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(c+=` => ${i.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,o=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}(t,`${c} ${p}kb`),s.draw(o,r.TRIANGLES,l,h,K.ColorMode.alphaBlended,K.CullFaceMode.disabled,hi(n,K.Color.transparent,e),"$debug",t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments)}const ki=K.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:zi}=ki;function Fi(t,e,i,o){t.emplaceBack(e,i,o)}class Ni{constructor(t){this.vertexArray=new K.StructArrayLayout3f12,this.indices=new K.StructArrayLayout3ui6,Fi(this.vertexArray,-1,-1,1),Fi(this.vertexArray,1,-1,1),Fi(this.vertexArray,-1,1,1),Fi(this.vertexArray,1,1,1),Fi(this.vertexArray,-1,-1,-1),Fi(this.vertexArray,1,-1,-1),Fi(this.vertexArray,-1,1,-1),Fi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,zi),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=K.SegmentVector.simpleSegment(0,0,36,12)}}function Ui(t,e,i,o,r,n){const s=t.gl,a=e.paint.get("sky-atmosphere-color"),l=e.paint.get("sky-atmosphere-halo-color"),h=e.paint.get("sky-atmosphere-sun-intensity"),p={u_matrix_3f:K.fromMat4([],o),u_sun_direction:r,u_sun_intensity:h,u_color_tint_r:[a.r,a.g,a.b,a.a],u_color_tint_m:[l.r,l.g,l.b,l.a],u_luminance:5e-5};s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+n,e.skyboxTexture,0),i.draw(t,s.TRIANGLES,K.DepthMode.disabled,K.StencilMode.disabled,K.ColorMode.unblended,K.CullFaceMode.frontCW,p,"skyboxCapture",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}const Bi={symbol:function(t,e,i,o,r){var n,s;"translucent"===t.renderPass&&(n=K.StencilMode.disabled,s=t.colorModeForRenderPass(),i.layout.get("text-variable-anchor")&&function(t,e,i,o,r,n,s){var a=e.transform,l="map"===r,h="map"===n;for(const r of t){const t=o.getTile(r),n=t.getBucket(i);if(n&&n.text&&n.text.segments.get().length){var p=K.evaluateSizeForZoom(n.textSizeData,a.zoom),c=$(t,1,e.transform.zoom),u=Gt(r.projMatrix,h,l,e.transform,c),c="none"!==i.layout.get("icon-text-fit")&&n.hasIconData();if(p){const e=Math.pow(2,a.zoom-t.tileID.overscaledZ),i=a.elevation;bi(n,l,h,s,K.symbolSize,a,u,r.projMatrix,e,p,c,i?t=>i.getAtTileOffset(r,t.x,t.y):t=>0)}}}}(o,t,i,e,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),r),0!==i.paint.get("icon-opacity").constantOr(1)&&xi(t,e,i,o,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),n,s),0!==i.paint.get("text-opacity").constantOr(1)&&xi(t,e,i,o,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),n,s),e.map.showCollisionBoxes&&(_i(t,e,i,o,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),_i(t,e,i,o,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1)))},circle:function(e,i,o,r){if("translucent"===e.renderPass){const t=o.paint.get("circle-opacity"),n=o.paint.get("circle-stroke-width"),s=o.paint.get("circle-stroke-opacity"),a=void 0!==o.layout.get("circle-sort-key").constantOr(1);if(0!==t.constantOr(1)||0!==n.constantOr(1)&&0!==s.constantOr(1)){const l=e.context,h=l.gl,p=e.depthModeForSublayer(0,K.DepthMode.ReadOnly),c=K.StencilMode.disabled,u=e.colorModeForRenderPass(),d=[];for(let t=0;t<r.length;t++){const n=r[t],s=i.getTile(n),l=s.getBucket(o);if(l){const h=l.programConfigurations.get(o.id),p=(t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e})(o),c={programConfiguration:h,program:e.useProgram("circle",h,p),layoutVertexBuffer:l.layoutVertexBuffer,indexBuffer:l.indexBuffer,uniformValues:((t,e,i,o)=>{var r=t.transform;let n;if("map"===o.paint.get("circle-pitch-alignment")){const K=$(i,1,r.zoom);n=[K,K]}else n=r.pixelsToGLUnits;return{u_camera_to_center_distance:r.cameraToCenterDistance,u_matrix:t.translatePosMatrix(e.projMatrix,i,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:K.exported.devicePixelRatio,u_extrude_scale:n}})(e,n,s,o),tile:s};if(a){const e=l.segments.get();for(const i of e)d.push({segments:new K.SegmentVector([i]),sortKey:i.sortKey,state:c})}else d.push({segments:l.segments,sortKey:0,state:c})}}a&&d.sort((t,e)=>t.sortKey-e.sortKey);for(const i of d){const{programConfiguration:r,program:t,layoutVertexBuffer:n,indexBuffer:s,uniformValues:a,tile:d}=i.state,f=i.segments;e.terrain&&e.terrain.setupElevationDraw(d,t,{useDepthForOcclusion:!0}),e.prepareDrawProgram(l,t,d.tileID.toUnwrapped()),t.draw(l,h.TRIANGLES,p,c,u,K.CullFaceMode.disabled,a,o.id,n,s,f,o.paint,e.transform.zoom,r)}}}},heatmap:function(e,i,o,r){if(0!==o.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const h=e.context,p=h.gl,c=K.StencilMode.disabled,u=new K.ColorMode([p.ONE,p.ONE],K.Color.transparent,[!0,!0,!0,!0]);!function(t,e,i){const o=t.gl;t.activeTexture.set(o.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);let r=i.heatmapFbo;var n;r?(o.bindTexture(o.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer)):(n=o.createTexture(),o.bindTexture(o.TEXTURE_2D,n),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),r=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,i,o){const r=t.gl;r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.width/4,e.height/4,0,r.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:r.UNSIGNED_BYTE,null),o.colorAttachment.set(i)}(t,e,n,r))}(h,e,o),h.clear({color:K.Color.transparent});for(let t=0;t<r.length;t++){const d=r[t];if(!i.hasRenderableParent(d)){const f=i.getTile(d),g=f.getBucket(o);if(g){const y=g.programConfigurations.get(o.id),m=e.useProgram("heatmap",y),{zoom:_}=e.transform;e.terrain&&e.terrain.setupElevationDraw(f,m),e.prepareDrawProgram(h,m,d.toUnwrapped()),m.draw(h,p.TRIANGLES,K.DepthMode.disabled,c,u,K.CullFaceMode.disabled,(n=d.projMatrix,s=f,a=_,l=o.paint.get("heatmap-intensity"),{u_matrix:n,u_extrude_scale:$(s,1,a),u_intensity:l}),o.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,o.paint,e.transform.zoom,y)}}}h.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){const o=e.context,r=o.gl,n=i.heatmapFbo;if(n){o.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,n.colorAttachment.get()),o.activeTexture.set(r.TEXTURE1);let t=i.colorRampTexture;t=t||(i.colorRampTexture=new K.Texture(o,i.colorRamp,r.RGBA)),t.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(o,r.TRIANGLES,K.DepthMode.disabled,K.StencilMode.disabled,e.colorModeForRenderPass(),K.CullFaceMode.disabled,((t,e)=>{var i=K.create$1();K.ortho(i,0,t.width,t.height,0,0,1);t=t.context.gl;return{u_matrix:i,u_world:[t.drawingBufferWidth,t.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}})(e,i),i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}}(e,o));var n,s,a,l},line:function(i,o,r,n){if("translucent"===i.renderPass){const m=r.paint.get("line-opacity"),_=r.paint.get("line-width");if(0!==m.constantOr(1)&&0!==_.constantOr(1)){const v=i.depthModeForSublayer(0,K.DepthMode.ReadOnly),b=i.colorModeForRenderPass(),x=r.paint.get("line-dasharray"),w=x.constantOr(1),M=r.layout.get("line-cap"),P=r.paint.get("line-pattern"),E=P.constantOr(1),S=r.paint.get("line-gradient"),T=r.getCrossfadeParameters(),A=E?"linePattern":w?"lineSDF":S?"lineGradient":"line",C=i.context,I=C.gl;for(const m of n){const n=o.getTile(m);if(!E||n.patternsLoaded()){const _=n.getBucket(r);if(_){i.prepareDrawTile(m);const L=_.programConfigurations.get(r.id),O=i.useProgram(A,L),R=P.constantOr(null);if(R&&n.imageAtlas){const K=n.imageAtlas,i=K.patternPositions[R.to.toString()],o=K.patternPositions[R.from.toString()];i&&o&&L.setConstantPatternPositions(i,o)}var t=x.constantOr(null),e=M.constantOr(null);if(!E&&t&&e&&n.lineAtlas){const K=n.lineAtlas,i=K.getDash(t.to,e),o=K.getDash(t.from,e);i&&o&&L.setConstantPatternPositions(i,o)}var s=i.terrain?m.projMatrix:null,s=E?(u=i,d=n,f=r,g=T,t=s,e=y=void 0,y=u.transform,e=ci(d,y),{u_matrix:ui(u,d,f,t),u_texsize:d.imageAtlasTexture.size,u_ratio:1/$(d,1,y.zoom),u_device_pixel_ratio:K.exported.devicePixelRatio,u_image:0,u_scale:[e,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}):w?(y=i,a=n,l=r,h=T,p=s,c=void 0,c=ci(a,y.transform),K.extend(pi(y,a,l,p),{u_texsize:a.lineAtlasTexture.size,u_scale:[c,h.fromScale,h.toScale],u_image:0,u_mix:h.t})):S?(l=i,p=n,a=r,c=s,h=_.lineClipsArray.length,K.extend(pi(l,p,a,c),{u_image:0,u_image_height:h})):pi(i,n,r,s);if(E)C.activeTexture.set(I.TEXTURE0),n.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),L.updatePaintBuffers(T);else if(w)C.activeTexture.set(I.TEXTURE0),n.lineAtlasTexture.bind(I.LINEAR,I.REPEAT),L.updatePaintBuffers(T);else if(S){const n=_.gradients[r.id];let e=n.texture;if(r.gradientVersion!==n.version){let t=256;if(r.stepInterpolant){const r=o.getSource().maxzoom,n=m.canonical.z===r?Math.ceil(1<<i.transform.maxZoom-m.canonical.z):1;t=K.clamp(K.nextPowerOfTwo(_.maxLineLength/K.EXTENT*1024*n),256,C.maxTextureSize)}n.gradient=K.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:t,image:n.gradient||void 0,clips:_.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new K.Texture(C,n.gradient,I.RGBA),n.version=r.gradientVersion,e=n.texture}C.activeTexture.set(I.TEXTURE0),e.bind(r.stepInterpolant?I.NEAREST:I.LINEAR,I.CLAMP_TO_EDGE)}i.prepareDrawProgram(C,O,m.toUnwrapped()),O.draw(C,I.TRIANGLES,v,i.stencilModeForClipping(m),b,K.CullFaceMode.disabled,s,r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,r.paint,i.transform.zoom,L,_.layoutVertexBuffer2)}}}var a,l,h,p,c,u,d,f,g,y}}},fill:function(t,e,i,o){const r=i.paint.get("fill-color"),n=i.paint.get("fill-opacity");if(0!==n.constantOr(1)){const s=t.colorModeForRenderPass(),a=i.paint.get("fill-pattern"),l=t.opaquePassEnabledForLayer()&&!a.constantOr(1)&&1===r.constantOr(K.Color.transparent).a&&1===n.constantOr(0)?"opaque":"translucent";if(t.renderPass===l){const r=t.depthModeForSublayer(1,"opaque"===t.renderPass?K.DepthMode.ReadWrite:K.DepthMode.ReadOnly);Mi(t,e,i,o,r,s,!1)}if("translucent"===t.renderPass&&i.paint.get("fill-antialias")){const r=t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,K.DepthMode.ReadOnly);Mi(t,e,i,o,r,s,!0)}}},"fill-extrusion":function(t,e,i,o){const r=i.paint.get("fill-extrusion-opacity");if(0!==r&&"translucent"===t.renderPass){var n=new K.DepthMode(t.context.gl.LEQUAL,K.DepthMode.ReadWrite,t.depthRangeFor3D);if(1!==r||i.paint.get("fill-extrusion-pattern").constantOr(1))Pi(t,e,i,o,n,K.StencilMode.disabled,K.ColorMode.disabled),Pi(t,e,i,o,n,t.stencilModeFor3D(),t.colorModeForRenderPass());else{const r=t.colorModeForRenderPass();Pi(t,e,i,o,n,K.StencilMode.disabled,r)}}},hillshade:function(t,e,i,o){if("offscreen"===t.renderPass||"translucent"===t.renderPass){const r=t.context,n=t.depthModeForSublayer(0,K.DepthMode.ReadOnly),s=t.colorModeForRenderPass(),a=t.terrain&&t.terrain.renderingToTexture,[l,h]="translucent"!==t.renderPass||a?[{},o]:t.stencilConfigForOverlap(o);for(const o of h){const r=e.getTile(o);if(r.needsHillshadePrepare&&"offscreen"===t.renderPass)!function(e,i,o,r,n,s){const a=e.context,l=a.gl;if(i.dem){var h=i.dem;if(a.activeTexture.set(l.TEXTURE1),We(e,i,h),i.demTexture){i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);var p=h.dim;a.activeTexture.set(l.TEXTURE0);let t=i.fbo;if(!t){const e=new K.Texture(a,{width:p,height:p,data:null},l.RGBA);e.bind(l.LINEAR,l.CLAMP_TO_EDGE),t=i.fbo=a.createFramebuffer(p,p,!0),t.colorAttachment.set(e.texture)}a.bindFramebuffer.set(t.framebuffer),a.viewport.set([0,0,p,p]),e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,r,n,s,K.CullFaceMode.disabled,(r=i.tileID,s=(n=h).stride,h=K.create$1(),K.ortho(h,0,K.EXTENT,-K.EXTENT,0,0,1),K.translate(h,h,[0,-K.EXTENT,0]),{u_matrix:h,u_image:1,u_dimension:[s,s],u_zoom:r.overscaledZ,u_unpack:n.unpackVector}),o.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),i.needsHillshadePrepare=!1}}}(t,r,i,n,K.StencilMode.disabled,s);else if("translucent"===t.renderPass){const K=a&&t.terrain?t.terrain.stencilModeForRTTOverlap(o):l[o.overscaledZ];Ve(t,o,r,i,n,K,s)}}r.viewport.set([0,0,t.width,t.height])}},raster:function(i,o,r,n,s,a){if("translucent"===i.renderPass&&0!==r.paint.get("raster-opacity")&&n.length){const c=i.context,u=c.gl,d=o.getSource(),f=i.useProgram("raster"),g=i.colorModeForRenderPass(),y=i.terrain&&i.terrain.renderingToTexture,[m,_]=d instanceof Mt||y?[{},n]:i.stencilConfigForOverlap(n),t=_[_.length-1].overscaledZ,v=!i.options.moving;for(const n of _){const s=y?K.DepthMode.disabled:i.depthModeForSublayer(n.overscaledZ-t,1===r.paint.get("raster-opacity")?K.DepthMode.ReadWrite:K.DepthMode.ReadOnly,u.LESS),_=n.toUnwrapped(),b=o.getTile(n);if(!y||b&&b.hasData()){var l=y?n.projMatrix:i.transform.calculateProjMatrix(_,v),h=i.terrain&&y?i.terrain.stencilModeForRTTOverlap(n):m[n.overscaledZ],p=a?0:r.paint.get("raster-fade-duration");b.registerFadeDuration(p);const x=o.findLoadedParent(n,0),w=Je(b,x,o,i.transform,p);let t,e;i.terrain&&i.terrain.prepareDrawTile(n);p="nearest"===r.paint.get("raster-resampling")?u.NEAREST:u.LINEAR;c.activeTexture.set(u.TEXTURE0),b.texture.bind(p,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST),c.activeTexture.set(u.TEXTURE1),x?(x.texture.bind(p,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST),t=Math.pow(2,x.tileID.overscaledZ-b.tileID.overscaledZ),e=[b.tileID.canonical.x*t%1,b.tileID.canonical.y*t%1]):b.texture.bind(p,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST);l=di(l,e||[0,0],t||1,w,r);i.prepareDrawProgram(c,f,_),d instanceof Mt?f.draw(c,u.TRIANGLES,s,K.StencilMode.disabled,g,K.CullFaceMode.disabled,l,r.id,d.boundsBuffer,i.quadTriangleIndexBuffer,d.boundsSegments):f.draw(c,u.TRIANGLES,s,h,g,K.CullFaceMode.disabled,l,r.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}}}},background:function(t,e,i,o){var r=i.paint.get("background-color"),n=i.paint.get("background-opacity");if(0!==n){const p=t.context,c=p.gl,u=t.transform,d=u.tileSize,f=i.paint.get("background-pattern");if(!t.isPatternMissing(f)){const g=!f&&1===r.a&&1===n&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===g){const y=K.StencilMode.disabled,m=t.depthModeForSublayer(0,"opaque"===g?K.DepthMode.ReadWrite:K.DepthMode.ReadOnly),_=t.colorModeForRenderPass(),v=t.useProgram(f?"backgroundPattern":"background"),b=o||u.coveringTiles({tileSize:d});f&&(p.activeTexture.set(c.TEXTURE0),t.imageManager.bind(t.context));var s,a,l,h=i.getCrossfadeParameters();for(const e of b){const u=e.toUnwrapped(),g=o?e.projMatrix:t.transform.calculateProjMatrix(u);t.prepareDrawTile(e);const b=f?(s=g,a=n,l={tileID:e,tileSize:d},K.extend(function(t,e,i,o){var r=i.imageManager.getPattern(t.from.toString()),n=i.imageManager.getPattern(t.to.toString()),{width:s,height:a}=i.imageManager.getPixelSize(),l=Math.pow(2,o.tileID.overscaledZ),t=o.tileSize*Math.pow(2,i.transform.tileZoom)/l,l=t*(o.tileID.canonical.x+o.tileID.wrap*l),t=t*o.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:n.tl,u_pattern_br_b:n.br,u_texsize:[s,a],u_mix:e.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:n.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/$(o,1,i.transform.tileZoom),u_pixel_coord_upper:[l>>16,t>>16],u_pixel_coord_lower:[65535&l,65535&t]}}(f,h,t,l),{u_matrix:s,u_opacity:a})):{u_matrix:g,u_opacity:n,u_color:r};t.prepareDrawProgram(p,v,u),v.draw(p,c.TRIANGLES,m,y,_,K.CullFaceMode.disabled,b,i.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},sky:function(t,e,i){var o,r,n,s=i.paint.get("sky-opacity");0!==s&&(n=t.context,o=i.paint.get("sky-type"),r=new K.DepthMode(n.gl.LEQUAL,K.DepthMode.ReadOnly,[0,1]),n=t.frameCounter/1e3%1,"atmosphere"===o?"offscreen"===t.renderPass?i.needsSkyboxCapture(t)&&(function(t,e){const i=t.context,o=i.gl;let r=e.skyboxFbo;if(!r){r=e.skyboxFbo=i.createFramebuffer(32,32,!1),e.skyboxGeometry=new Ni(i),e.skyboxTexture=i.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,e.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(let t=0;t<6;++t)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}i.bindFramebuffer.set(r.framebuffer),i.viewport.set([0,0,32,32]);var n=e.getCenter(t,!0),s=t.useProgram("skyboxCapture"),a=new Float64Array(16);K.identity(a),K.rotateY(a,a,.5*-Math.PI),Ui(i,e,s,a,n,0),K.identity(a),K.rotateY(a,a,.5*Math.PI),Ui(i,e,s,a,n,1),K.identity(a),K.rotateX(a,a,.5*-Math.PI),Ui(i,e,s,a,n,2),K.identity(a),K.rotateX(a,a,.5*Math.PI),Ui(i,e,s,a,n,3),K.identity(a),Ui(i,e,s,a,n,4),K.identity(a),K.rotateY(a,a,Math.PI),Ui(i,e,s,a,n,5),i.viewport.set([0,0,t.width,t.height])}(t,i),i.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,e,i,o,r){const n=t.context,s=n.gl,a=t.transform,l=t.useProgram("skybox");n.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,e.skyboxTexture);r={u_matrix:a.skyboxMatrix,u_sun_direction:e.getCenter(t,!1),u_cubemap:0,u_opacity:o,u_temporal_offset:r};t.prepareDrawProgram(n,l),l.draw(n,s.TRIANGLES,i,K.StencilMode.disabled,t.colorModeForRenderPass(),K.CullFaceMode.backCW,r,"skybox",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}(t,i,r,s,n):"gradient"===o&&"sky"===t.renderPass&&function(t,e,i,o,r){const n=t.context,s=n.gl,a=t.transform,l=t.useProgram("skyboxGradient");e.skyboxGeometry||(e.skyboxGeometry=new Ni(n)),n.activeTexture.set(s.TEXTURE0);let h=e.colorRampTexture;h=h||(e.colorRampTexture=new K.Texture(n,e.colorRamp,s.RGBA)),h.bind(s.LINEAR,s.CLAMP_TO_EDGE);var p,c,u,r=(p=a.skyboxMatrix,c=e.getCenter(t,!1),u=e.paint.get("sky-gradient-radius"),o=o,r=r,{u_matrix:p,u_color_ramp:0,u_center_direction:c,u_radius:K.degToRad(u),u_opacity:o,u_temporal_offset:r});t.prepareDrawProgram(n,l),l.draw(n,s.TRIANGLES,i,K.StencilMode.disabled,t.colorModeForRenderPass(),K.CullFaceMode.backCW,r,"skyboxGradient",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}(t,i,r,s,n))},debug:function(e,i,o){for(let t=0;t<o.length;t++)Di(e,i,o[t])},custom:function(t,e,i){const o=t.context,r=i.implementation;if("offscreen"===t.renderPass){const K=r.prerender;K&&(t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),K.call(r,o.gl,t.transform.customLayerMatrix()),o.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),o.setStencilMode(K.StencilMode.disabled);const e="3d"===r.renderingMode?new K.DepthMode(t.context.gl.LEQUAL,K.DepthMode.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,K.DepthMode.ReadOnly);o.setDepthMode(e),r.render(o.gl,t.transform.customLayerMatrix()),o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null)}}};class ji{constructor(t,e){this.context=new vt(t),this.transform=e,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=K.SourceCache.maxUnderzooming+K.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ae,this.gpuTimers={},this.frameCounter=0}updateTerrain(t,e){var i=!!t&&!!t.terrain;if(i||this._terrain&&this._terrain.enabled){this._terrain||(this._terrain=new ei(this,t));const o=this._terrain;this.transform.elevation=i?o:null,o.update(t,this.transform,e)}}_updateFog(t){const e=t.fog;var i;!e||e&&1!==e.getOpacity(this.transform.pitch)?this.transform.fogCullDistSq=null:([i,t]=e.getFovAdjustedRange(this.transform._fov),this.transform.fogCullDistSq=(i=i+.78*(t-i))*i)}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,e){if(this.width=t*K.exported.devicePixelRatio,this.height=e*K.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const K of this.style.order)this.style._layers[K].resize()}setup(){const t=this.context,e=new K.StructArrayLayout2i4;e.emplaceBack(0,0),e.emplaceBack(K.EXTENT,0),e.emplaceBack(0,K.EXTENT),e.emplaceBack(K.EXTENT,K.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(e,K.posAttributes.members),this.tileExtentSegments=K.SegmentVector.simpleSegment(0,0,4,2);const i=new K.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(K.EXTENT,0),i.emplaceBack(0,K.EXTENT),i.emplaceBack(K.EXTENT,K.EXTENT),this.debugBuffer=t.createVertexBuffer(i,K.posAttributes.members),this.debugSegments=K.SegmentVector.simpleSegment(0,0,4,5);const o=new K.StructArrayLayout4i8;o.emplaceBack(0,0,0,0),o.emplaceBack(K.EXTENT,0,K.EXTENT,0),o.emplaceBack(0,K.EXTENT,0,K.EXTENT),o.emplaceBack(K.EXTENT,K.EXTENT,K.EXTENT,K.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(o,wt.members),this.rasterBoundsSegments=K.SegmentVector.simpleSegment(0,0,4,2);const r=new K.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(1,0),r.emplaceBack(0,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,K.posAttributes.members),this.viewportSegments=K.SegmentVector.simpleSegment(0,0,4,2);const n=new K.StructArrayLayout1ui2;n.emplaceBack(0),n.emplaceBack(1),n.emplaceBack(3),n.emplaceBack(2),n.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(n);const s=new K.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new K.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA),this.identityMat=K.create$1();var a=this.context.gl;this.stencilClearMode=new K.StencilMode({func:a.ALWAYS,mask:0},0,255,a.ZERO,a.ZERO,a.ZERO),this.loadTimeStamps.push(K.window.performance.now())}clearStencil(){var t=this.context,e=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var i=K.create$1();K.ortho(i,0,this.width,this.height,0,0,1),K.scale$1(i,i,[e.drawingBufferWidth,e.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,e.TRIANGLES,K.DepthMode.disabled,this.stencilClearMode,K.ColorMode.disabled,K.CullFaceMode.disabled,$e(i),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,e,i){if(e&&this.currentStencilSource!==e.id&&t.isTileClipped()&&i&&i.length){this.currentStencilSource=e.id;const o=this.context,r=o.gl;256<this.nextStencilID+i.length&&this.clearStencil(),o.setColorMode(K.ColorMode.disabled),o.setDepthMode(K.DepthMode.disabled);const n=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of i){const e=this._tileClippingMaskIDs[t.key]=this.nextStencilID++;n.draw(o,r.TRIANGLES,K.DepthMode.disabled,new K.StencilMode({func:r.ALWAYS,mask:0},e,255,r.KEEP,r.KEEP,r.REPLACE),K.ColorMode.disabled,K.CullFaceMode.disabled,$e(t.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}}stencilModeFor3D(){this.currentStencilSource=void 0,256<this.nextStencilID+1&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new K.StencilMode({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);var e=this.context.gl;return new K.StencilMode({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}stencilConfigForOverlap(t){var e=this.context.gl,t=t.sort((t,e)=>e.overscaledZ-t.overscaledZ),i=t[t.length-1].overscaledZ,o=t[0].overscaledZ-i+1;if(1<o){this.currentStencilSource=void 0,256<this.nextStencilID+o&&this.clearStencil();const r={};for(let t=0;t<o;t++)r[t+i]=new K.StencilMode({func:e.GEQUAL,mask:255},t+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=o,[r,t]}return[{[i]:K.StencilMode.disabled},t]}colorModeForRenderPass(){var t=this.context.gl;if(this._showOverdrawInspector)return new K.ColorMode([t.CONSTANT_COLOR,t.ONE],new K.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]);return"opaque"===this.renderPass?K.ColorMode.unblended:K.ColorMode.alphaBlended}depthModeForSublayer(t,e,i){if(!this.opaquePassEnabledForLayer())return K.DepthMode.disabled;t=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new K.DepthMode(i||this.context.gl.LEQUAL,e,[t,t])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,e){this.style=o,this.options=e,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(K.exported.now()),this.imageManager.beginFrame();const i=this.style.order,r=this.style._sourceCaches;for(const K in r){const o=r[K];o.used&&o.prepare(this.context)}const n={},s={},a={};for(const K in r){const o=r[K];n[K]=o.getVisibleCoordinates(),s[K]=n[K].slice().reverse(),a[K]=o.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<i.length;t++)if(this.style._layers[i[t]].is3D()){this.opaquePassCutoff=t;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),K.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const K of i){const e=this.style._layers[K],i=o._getLayerSourceCache(e);if(e.hasOffscreenPass()&&!e.isHidden(this.transform.zoom)){const r=i?s[i.id]:void 0;("custom"===e.type||e.isSky()||r&&r.length)&&this.renderLayer(this,i,e,r)}}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let t=K.Color.transparent;if(this.style.fog&&(t=this.style.fog.properties.get("color")),this.context.clear({color:e.showOverdrawInspector?K.Color.black:t,depth:1}),this.clearStencil(),this._showOverdrawInspector=e.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=i.length-1;0<=this.currentLayer;this.currentLayer--){const K=this.style._layers[i[this.currentLayer]],e=o._getLayerSourceCache(K);if(!K.isSky()){const r=e?s[e.id]:void 0;this._renderTileClippingMasks(K,e,r),this.renderLayer(this,e,K,r)}}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){const K=this.style._layers[i[this.currentLayer]],e=o._getLayerSourceCache(K);K.isSky()&&this.renderLayer(this,e,K,e?s[e.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;){const K=this.style._layers[i[this.currentLayer]],e=o._getLayerSourceCache(K);if(K.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(K))K.isHidden(this.transform.zoom)?++this.currentLayer:this.currentLayer=this.terrain.renderBatch(this.currentLayer);else{const r=e?("symbol"===K.type?a:s)[e.id]:void 0;this._renderTileClippingMasks(K,e,e?n[e.id]:void 0),this.renderLayer(this,e,K,r),++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let i=null;K.values(this.style._layers).forEach(t=>{const e=o._getLayerSourceCache(t);e&&!t.isHidden(this.transform.zoom)&&(!i||i.getSource().maxzoom<e.getSource().maxzoom)&&(i=e)}),i&&this.options.showTileBoundaries&&Bi.debug(this,i,i.getVisibleCoordinates())}this.options.showPadding&&function(t){var e=t.transform.padding;Li(t,t.transform.height-(e.top||0),3,Si),Li(t,e.bottom||0,3,Ti),Oi(t,e.left||0,3,Ai),Oi(t,t.transform.width-(e.right||0),3,Ci);var i,o=t.transform.centerPoint;i=t,e=o.x,t=t.transform.height-o.y,o=Ii,Ri(i,e-1,t-10,2,20,o),Ri(i,e-10,t-1,20,2,o)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%K.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(K.window.performance.now()),this.saveCanvasCopy())}}renderLayer(t,e,i,o){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||o&&o.length)&&(this.id=i.id,this.gpuTimingStart(i),Bi[i.type](t,e,i,o,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(this.options.gpuTiming){const i=this.context.extTimerQuery;let t=this.gpuTimers[e.id];t=t||(this.gpuTimers[e.id]={calls:0,cpuTime:0,query:i.createQueryEXT()}),t.calls++,i.beginQueryEXT(i.TIME_ELAPSED_EXT,t.query)}}gpuTimingEnd(){if(this.options.gpuTiming){const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}}collectGpuTimers(){var t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const e={};for(const i in t){const o=t[i],r=this.context.extTimerQuery,n=r.getQueryObjectEXT(o.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(o.query),e[i]=n}return e}translatePosMatrix(t,e,i,o,r){if(!i[0]&&!i[1])return t;o=r?"map"===o?this.transform.angle:0:"viewport"===o?-this.transform.angle:0;if(o){const K=Math.sin(o),t=Math.cos(o);i=[i[0]*t-i[1]*K,i[0]*K+i[1]*t]}e=[r?i[0]:$(e,i[0],this.transform.zoom),r?i[1]:$(e,i[1],this.transform.zoom),0],i=new Float32Array(16);return K.translate(i,t,e),i}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&0<e.length?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),t=this.imageManager.getPattern(t.to.toString());return!e||!t}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,e=this.style&&this.style.fog,i=[];return this.terrain&&!this.terrain.renderingToTexture&&i.push("TERRAIN"),e&&!t&&0!==e.getOpacity(this.transform.pitch)&&i.push("FOG"),t&&i.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&i.push("OVERDRAW_INSPECTOR"),i}useProgram(t,e,i){this.cache=this.cache||{};var o=i||[],i=this.currentGlobalDefines().concat(o),o=oi.cacheKey(t,i,e);return this.cache[o]||(this.cache[o]=new oi(this.context,t,je[t],e,yi[t],i)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=K.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new K.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(t){this.terrain&&this.terrain.prepareDrawTile(t)}prepareDrawProgram(t,e,i){if(!this.terrain||!this.terrain.renderingToTexture){const s=this.style.fog;var o,r,n;!s||0!==(n=s.getOpacity(this.transform.pitch))&&e.setFogUniformValues(t,(o=this,r=s,e=i,t=n,i=r.properties.get("color"),n=o.frameCounter/1e3%1,t=[i.r/i.a,i.g/i.a,i.b/i.a,t],{u_fog_matrix:e?o.transform.calculateFogTileMatrix(e):o.identityMat,u_fog_range:r.getFovAdjustedRange(o.transform._fov),u_fog_color:t,u_fog_horizon_blend:r.properties.get("horizon-blend"),u_fog_temporal_offset:n}))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}}class Zi{constructor(t=0,e=0,i=0,o=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=o}interpolate(t,e,i){return null!=e.top&&null!=t.top&&(this.top=K.number(t.top,e.top,i)),null!=e.bottom&&null!=t.bottom&&(this.bottom=K.number(t.bottom,e.bottom,i)),null!=e.left&&null!=t.left&&(this.left=K.number(t.left,e.left,i)),null!=e.right&&null!=t.right&&(this.right=K.number(t.right,e.right,i)),this}getCenter(t,e){t=K.clamp((this.left+t-this.right)/2,0,t),e=K.clamp((this.top+e-this.bottom)/2,0,e);return new K.pointGeometry(t,e)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Zi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Gi(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Vi(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]}function Wi(t,e){var i=Gi(t,3);K.fromQuat(t,e),Vi(t,3,i)}function Hi(t,e){Vi(t,3,[e[0],e[1],e[2],1])}function qi(t,e){var i=K.identity$1([]);return K.rotateZ$1(i,i,-e),K.rotateX$1(i,i,-t),i}function Yi(t,e){var i=[t[0],t[1],0],o=[e[0],e[1],0];if(1e-15<=K.length(i)){const t=K.normalize([],i);K.scale(o,t,K.dot(o,t)),e[0]=o[0],e[1]=o[1]}e=K.cross([],e,t);if(K.len(e)<1e-15)return null;e=Math.atan2(-e[1],e[0]);return qi(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),e)}class Xi{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(t){this._position=this._renderWorldCopies?function(t){if(t){const e=Array.isArray(t)?new K.MercatorCoordinate(t[0],t[1],t[2]):t;return e.x=K.wrap(e.x,0,1),e}}(t):t}lookAtPoint(t,e){var i,o;this.orientation=null,this.position&&(i=this._elevation?this._elevation.getAtPointOrZero(K.MercatorCoordinate.fromLngLat(t)):0,o=this.position,o=[(i=K.MercatorCoordinate.fromLngLat(t,i)).x-o.x,i.y-o.y,i.z-o.z],(e=e||[0,0,1])[2]=Math.abs(e[2]),this.orientation=Yi(o,e))}setPitchBearing(t,e){this.orientation=qi(K.degToRad(t),K.degToRad(-e))}}class Ki{constructor(t,e){this._transform=K.identity([]),this._orientation=K.identity$1([]),e&&(this._orientation=e,Wi(this._transform,this._orientation)),t&&Hi(this._transform,t)}get mercatorPosition(){var t=this.position;return new K.MercatorCoordinate(t[0],t[1],t[2])}get position(){var t=Gi(this._transform,3);return[t[0],t[1],t[2]]}set position(t){Hi(this._transform,t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,Wi(this._transform,this._orientation)}getPitchBearing(){var t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=qi(t,e),Wi(this._transform,this._orientation)}forward(){var t=Gi(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){var t=Gi(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){var t=Gi(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,e){var i=new Float64Array(16);return K.invert(i,this.getWorldToCamera(t,e)),i}getWorldToCameraPosition(t,e,i){var o=this.position;K.scale(o,o,-t);const r=new Float64Array(16);return K.fromScaling(r,[i,i,i]),K.translate(r,r,o),r[10]*=e,r}getWorldToCamera(t,e){const i=new Float64Array(16),o=new Float64Array(4),r=this.position;return K.conjugate(o,this._orientation),K.scale(r,r,-t),K.fromQuat(i,o),K.translate(i,i,r),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=e,i[9]*=e,i[10]*=e,i[11]*=e,i}getCameraToClipPerspective(t,e,i,o){var r=new Float64Array(16);return K.perspective(r,t,e,i,o),r}getDistanceToElevation(t){var e=0===t?0:K.mercatorZfromAltitude(t,this.position[1]),t=this.forward();return(e-this.position[2])/t[2]}clone(){return new Ki([...this.position],[...this.orientation])}}class $i{constructor(t,e,i,o,r){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===r||r,this._minZoom=t||0,this._maxZoom=e||22,this._minPitch=null==i?0:i,this._maxPitch=null==o?60:o,this.setMaxBounds(),this.width=0,this.height=0,this._center=new K.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Zi,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new Ki,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const t=new $i(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&((this._elevation=t)?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){var t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return K.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return K.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new K.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){var e,i,o,r,n,s=-K.wrap(t,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(n=new K.ARRAY_TYPE(4),K.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n),e=this.rotationMatrix,i=this.rotationMatrix,o=this.angle,r=i[0],t=i[1],s=i[2],n=i[3],i=Math.sin(o),o=Math.cos(o),e[0]=r*o+s*i,e[1]=t*o+n*i,e[2]=r*-i+s*o,e[3]=t*-i+n*o)}get pitch(){return this._pitch/Math.PI*180}set pitch(t){t=K.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==t&&(this._unmodified=!1,this._pitch=t,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(t){t=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;var t=this._elevation.getAtPointOrZero(K.MercatorCoordinate.fromLngLat(this.center),-1);return-1===t?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){var t=this.cameraToCenterDistance/this.worldSize,e=K.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(e+t)}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],o=this.horizonLineFromTop();let r=0,n=0;for(let t=0;t<i.length;t++){var s=new K.pointGeometry(i[t][0]*this.width,o+i[t][1]*(this.height-o)),a=e.pointCoordinate(s);a&&(s=1/Math.hypot(a[0]-this._camera.position[0],a[1]-this._camera.position[1]),r+=a[3]*s,n+=s)}return 0===n?NaN:r/n}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){var t,e,i;null!=this._cameraZoom&&this._elevation&&(i=this._cameraZoom,e=this._elevation.getAtPointOrZero(K.MercatorCoordinate.fromLngLat(this.center)),t=K.mercatorZfromAltitude(e,this.center.lat),e=this._mercatorZfromZoom(i),i=this._mercatorZfromZoom(this._maxZoom),i=Math.max(e-t,i),this._setZoom(this._zoomFromMercatorZ(i)))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){var e=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude())),t=t.z<this._camera.position[2]?[e.x,e.y,e.z]:[t.x,t.y,t.z],t=K.length(K.sub([],this._camera.position,t));return K.clamp(this._zoomFromMercatorZ(t),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(this.height&&(e.position||e.orientation)){this._updateCameraState();let t=!1;e.orientation&&!K.exactEquals(e.orientation,this._camera.orientation)&&(t=this._setCameraOrientation(e.orientation)),e.position&&(e=[e.position.x,e.position.y,e.position.z],K.exactEquals$1(e,this._camera.position)||(this._setCameraPosition(e),t=!0)),t&&(this._updateStateFromCamera(),this.recenterOnTerrain())}}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,e=new Xi;return e.position=new K.MercatorCoordinate(t[0],t[1],t[2]),e.orientation=this._camera.orientation,e._elevation=this.elevation,e._renderWorldCopies=this._renderWorldCopies,e}_setCameraOrientation(t){if(!K.length$1(t))return!1;K.normalize$1(t,t);var e=K.transformQuat([],[0,0,-1],t),t=K.transformQuat([],[0,-1,0],t);if(t[2]<0)return!1;t=Yi(e,t);return!!t&&(this._camera.orientation=t,!0)}_setCameraPosition(t){var e=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,o=this.cameraToCenterDistance;t[2]=K.clamp(t[2],o/i,o/e),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){t=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(e){const i=[new K.UnwrappedTileID(0,e)];if(this._renderWorldCopies){var t=this.pointCoordinate(new K.pointGeometry(0,0)),o=this.pointCoordinate(new K.pointGeometry(this.width,0)),r=this.pointCoordinate(new K.pointGeometry(this.width,this.height)),n=this.pointCoordinate(new K.pointGeometry(0,this.height)),s=Math.floor(Math.min(t.x,o.x,r.x,n.x)),a=Math.floor(Math.max(t.x,o.x,r.x,n.x));for(let t=s-1;t<=a+1;t++)0!==t&&i.push(new K.UnwrappedTileID(t,e))}return i}coveringTiles(a){let i=this.coveringZoomLevel(a);const o=i,l=this.elevation&&!a.isTerrainDEM;if(void 0!==a.minzoom&&i<a.minzoom)return[];void 0!==a.maxzoom&&i>a.maxzoom&&(i=a.maxzoom);const r=K.MercatorCoordinate.fromLngLat(this.center),n=1<<i,s=[n*r.x,n*r.y,0],h=E.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i),t=this.pointCoordinate(this.getCameraPoint()),p=n*K.mercatorZfromAltitude(1,this.center.lat),e=this._camera.position[2]/K.mercatorZfromAltitude(1,this.center.lat),c=[n*t.x,n*t.y,e],u=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),d=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?i:0,f=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,g=a.isTerrainDEM?-f:this._elevation?this._elevation.getMinElevationBelowMSL():0,y=t=>({aabb:new S([t*n,0,g],[(t+1)*n,n,f]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),m=[],_=[],v=i,b=a.reparseOverscaled?o:i,x=t=>{if(this._elevation&&t.tileID){const e=this._elevation.getMinMaxForTile(t.tileID),i=t.aabb;e?(i.min[2]=e.min,i.max[2]=e.max,i.center[2]=(i.min[2]+i.max[2])/2):(t.shouldSplit=P(t),t.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))}},w=t=>t*t,M=w((e-this._centerAltitude)*p),P=t=>{if(t.zoom<d)return!0;if(t.zoom===v)return!1;if(null!=t.shouldSplit)return t.shouldSplit;var e=t.aabb.distanceX(c),i=t.aabb.distanceY(c);let o=M;l&&(o=w(t.aabb.distanceZ(c)*p));i=e*e+i*i+o;return i<w((1<<v-t.zoom)*u*((t,e)=>{if(e*w(.707)<t)return 1;t=Math.sqrt(e/t);return t/(1.4144271570014144+(Math.pow(1.1,t-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(o,M),i))};if(this._renderWorldCopies)for(let t=1;t<=3;t++)m.push(y(-t)),m.push(y(t));for(m.push(y(0));0<m.length;){const o=m.pop(),r=o.x,n=o.y;let e=o.fullyVisible;if(!e){const K=o.aabb.intersects(h);if(0===K)continue;e=2===K}if(o.zoom!==v&&P(o))for(let t=0;t<4;t++){const i=(r<<1)+t%2,s=(n<<1)+(t>>1),h={aabb:o.aabb.quadrant(t),zoom:o.zoom+1,x:i,y:s,wrap:o.wrap,fullyVisible:e,tileID:void 0,shouldSplit:void 0};l&&(h.tileID=new K.OverscaledTileID(o.zoom+1===v?b:o.zoom+1,o.wrap,o.zoom+1,i,s),x(h)),m.push(h)}else{const l=o.zoom===v?b:o.zoom;if(!(a.minzoom&&a.minzoom>l)){const h=s[0]-(.5+r+(o.wrap<<o.zoom))*(1<<i-o.zoom),t=s[1]-.5-n,p=o.tileID||new K.OverscaledTileID(l,o.wrap,o.zoom,r,n);_.push({tileID:p,distanceSq:h*h+t*t})}}}if(this.fogCullDistSq){const a=this.fogCullDistSq;_.splice(0,_.length,..._.filter(e=>{const t=[0,0,0,1],i=[K.EXTENT,K.EXTENT,0,1],o=this.calculateFogTileMatrix(e.tileID.toUnwrapped());K.transformMat4(t,t,o),K.transformMat4(i,i,o);var r=K.getAABBPointSquareDist(t,i);if(0===r)return!0;let n=!1;var s=this.horizonLineFromTop();if(r>a&&0!==s){const a=this.calculateProjMatrix(e.tileID.toUnwrapped());let t;l&&this._elevation&&(t=this._elevation.getMinMaxForTile(e.tileID)),t=t||{min:g,max:f};const i=K.furthestTileCorner(this.bearing),o=[i[0]*K.EXTENT,i[1]*K.EXTENT,t.max];K.transformMat4$1(o,o,a),n=(1-o[1])*this.height*.5<s}return r<a||n}))}return _.sort((t,e)=>t.distanceSq-e.distanceSq).map(t=>t.tileID)}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){var e=K.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new K.pointGeometry(K.mercatorXfromLng(t.lng)*this.worldSize,K.mercatorYfromLat(e)*this.worldSize)}unproject(t){return new K.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(t,e){var i=this.pointCoordinate(e),e=this.pointCoordinate(this.centerPoint),t=this.locationCoordinate(t),e=new K.MercatorCoordinate(t.x-(i.x-e.x),t.y-(i.y-e.y));this.center=this.coordinateLocation(e),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(t){this.center=this.coordinateLocation(t),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this._coordinatePoint(this.locationCoordinate(t),!1)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t){return K.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t.toLngLat()}pointRayIntersection(t,e){var i=null!=e?e:this._centerAltitude,o=[t.x,t.y,0,1],r=[t.x,t.y,1,1];K.transformMat4(o,o,this.pixelMatrixInverse),K.transformMat4(r,r,this.pixelMatrixInverse);e=r[3];K.scale$2(o,o,1/o[3]),K.scale$2(r,r,1/e);t=o[2],e=r[2];return{p0:o,p1:r,t:t===e?0:(i-t)/(e-t)}}screenPointToMercatorRay(t){const e=[t.x,t.y,0,1],i=[t.x,t.y,1,1];return K.transformMat4(e,e,this.pixelMatrixInverse),K.transformMat4(i,i,this.pixelMatrixInverse),K.scale$2(e,e,1/e[3]),K.scale$2(i,i,1/i[3]),e[2]=K.mercatorZfromAltitude(e[2],this._center.lat)*this.worldSize,i[2]=K.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,K.scale$2(e,e,1/this.worldSize),K.scale$2(i,i,1/this.worldSize),new c([e[0],e[1],e[2]],K.normalize([],K.sub([],i,e)))}rayIntersectionCoordinate(t){var{p0:e,p1:i,t:o}=t,r=K.mercatorZfromAltitude(e[2],this._center.lat),t=K.mercatorZfromAltitude(i[2],this._center.lat);return new K.MercatorCoordinate(K.number(e[0],i[0],o)/this.worldSize,K.number(e[1],i[1],o)/this.worldSize,K.number(r,t,o))}pointCoordinate(t){var e=this.horizonLineFromTop(!1),t=new K.pointGeometry(t.x,Math.max(e,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(t))}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);const i=this.elevation;let o=this.elevation.pointCoordinate(e);if(o)return new K.MercatorCoordinate(o[0],o[1],o[2]);let r=0,n=this.horizonLineFromTop();if(e.y>n)return this.pointCoordinate(e);const s=.02*n,a=e.clone();for(let t=0;t<10&&n-r>s;t++){a.y=K.number(r,n,.66);const e=i.pointCoordinate(a);e?(n=a.y,o=e):r=a.y}return o?new K.MercatorCoordinate(o[0],o[1],o[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);var e=this.horizonLineFromTop();return t.y<e}_coordinatePoint(t,e){e=e&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,t=[t.x*this.worldSize,t.y*this.worldSize,e+t.toAltitude(),1];return K.transformMat4(t,t,this.pixelMatrix),0<t[3]?new K.pointGeometry(t[0]/t[3],t[1]/t[3]):new K.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}getBounds(){return this._terrainEnabled()?this._getBounds3D():(new K.LngLatBounds).extend(this.pointLocation(new K.pointGeometry(this._edgeInsets.left,this._edgeInsets.top))).extend(this.pointLocation(new K.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top))).extend(this.pointLocation(new K.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom))).extend(this.pointLocation(new K.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom)))}_getBounds3D(){const t=this.elevation,i=t.visibleDemTiles.reduce((t,e)=>{return e.dem&&(e=e.dem.tree,t.min=Math.min(t.min,e.minimums[0]),t.max=Math.max(t.max,e.maximums[0])),t},{min:Number.MAX_VALUE,max:0});i.min*=t.exaggeration(),i.max*=t.exaggeration();var e=this.horizonLineFromTop();return[new K.pointGeometry(0,e),new K.pointGeometry(this.width,e),new K.pointGeometry(this.width,this.height),new K.pointGeometry(0,this.height)].reduce((t,e)=>t.extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(e,i.min)))).extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(e,i.max)))),new K.LngLatBounds)}horizonLineFromTop(t=!0){var e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,e=this.height/2-.97*e;return t?Math.max(0,e):e}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new K.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,e){var i=t.canonical,o=e/this.zoomScale(i.z),e=i.x+Math.pow(2,i.z)*t.wrap,t=K.identity(new Float64Array(16));return K.translate(t,t,[e*o,i.y*o,0]),K.scale$1(t,t,[o/K.EXTENT,o/K.EXTENT,1]),t}calculateFogTileMatrix(t){const e=t.key,i=this._fogTileMatrixCache;if(i[e])return i[e];t=this.calculatePosMatrix(t,this.cameraWorldSize);return K.multiply(t,this.worldToFogMatrix,t),i[e]=new Float32Array(t),i[e]}calculateProjMatrix(t,e=!1){const i=t.key,o=e?this._alignedProjMatrixCache:this._projMatrixCache;if(o[i])return o[i];t=this.calculatePosMatrix(t,this.worldSize);return K.multiply(t,e?this.alignedProjMatrix:this.projMatrix,t),o[i]=new Float32Array(t),o[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(this._elevation){const e=this._elevation;this._updateCameraState();const i=this._camera.position,o=this._camera.forward();if(!(i[2]<=0||0<=o[2])){const r=K.mercatorZfromAltitude(1,this._center.lat);i[2]/=r,o[2]/=r,K.normalize(o,o);var t=e.raycast(i,o,e.exaggeration());if(t){const e=K.scaleAndAdd([],i,o,t),r=new K.MercatorCoordinate(e[0],e[1],K.mercatorZfromAltitude(e[2],K.latFromMercatorY(e[1]))),n=this._camera.position,s=r.z+K.length([r.x-n[0],r.y-n[1],r.z-n[2]]);this._cameraZoom=this._zoomFromMercatorZ(s),this._centerAltitude=r.toAltitude(),this._center=r.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}}}_constrainCameraAltitude(){if(this._elevation){const e=this._elevation;this._updateCameraState();const i=e.getAtPointOrZero(this._camera.mercatorPosition),o=this._minimumHeightOverTerrain()*Math.cos(K.degToRad(this._maxPitch)),r=K.mercatorZfromAltitude(i,this._center.lat),n=this._camera.position[2]-r;if(n<o){const e=K.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),i=this._camera.mercatorPosition,r=[e.x-i.x,e.y-i.y,e.z-i.z],s=K.length(r);r[2]-=o-n;var t=K.length(r);0!==t&&(K.scale(r,r,s/t),this._camera.position=[e.x-r[0],e.y-r[1],e.z-r[2]],this._camera.orientation=Yi(r,this._camera.up()),this._updateStateFromCamera())}}}_constrain(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;let e,i,o,r,n=-90,s=90,a=-180,l=180;var h=this.size,t=this._unmodified;if(this.latRange){const t=this.latRange;n=K.mercatorYfromLat(t[1])*this.worldSize,s=K.mercatorYfromLat(t[0])*this.worldSize,e=s-n<h.y?h.y/(s-n):0}if(this.lngRange){const t=this.lngRange;a=K.mercatorXfromLng(t[0])*this.worldSize,l=K.mercatorXfromLng(t[1])*this.worldSize,i=l-a<h.x?h.x/(l-a):0}var p=this.point,c=Math.max(i||0,e||0);if(c)return this.center=this.unproject(new K.pointGeometry(i?(l+a)/2:p.x,e?(s+n)/2:p.y)),this.zoom+=this.scaleZoom(c),this._unmodified=t,void(this._constraining=!1);if(this.latRange){const K=p.y,t=h.y/2;K-t<n&&(r=n+t),K+t>s&&(r=s-t)}if(this.lngRange){const K=p.x,t=h.x/2;K-t<a&&(o=a+t),K+t>l&&(o=l-t)}void 0===o&&void 0===r||(this.center=this.unproject(new K.pointGeometry(void 0!==o?o:p.x,void 0!==r?r:p.y))),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}}_minZoomForBounds(){var t=(t,e)=>Math.log2(t/(this.tileSize*Math.abs(e[1]-e[0])));let e=0;if(this.latRange){const i=this.latRange;e=t(this.height,[K.mercatorYfromLat(i[0]),K.mercatorYfromLat(i[1])])}let i=0;if(this.lngRange){const e=this.lngRange;i=t(this.width,[K.mercatorXfromLng(e[0]),K.mercatorXfromLng(e[1])])}return Math.max(e,i)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(this.height){var t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var e=this.pixelsPerMeter;this._updateCameraState();const s=Math.PI/2+this._pitch,a=this.fovAboveCenter,l=this.elevation?this.elevation.getMinElevationBelowMSL()*e:0,h=(this._camera.position[2]*this.worldSize-l)/Math.cos(this._pitch),p=Math.sin(a)*h/Math.sin(K.clamp(Math.PI-s-a,.01,Math.PI-.01)),c=this.point,u=c.x,d=c.y,f=Math.cos(Math.PI/2-this._pitch)*p+h,g=Math.min(1.01*f,h*(1/this._horizonShift)),y=this.height/50,m=this._camera.getWorldToCamera(this.worldSize,e),_=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,y,g);_[8]=2*-t.x/this.width,_[9]=2*t.y/this.height;var i=K.mul$1([],_,m);this.mercatorMatrix=K.scale$1([],i,[this.worldSize,this.worldSize,this.worldSize/e]),this.projMatrix=i,this.invProjMatrix=K.invert(new Float64Array(16),this.projMatrix);var o=new Float32Array(16);K.identity(o),K.scale$1(o,o,[1,-1,1]),K.rotateX(o,o,this._pitch),K.rotateZ(o,o,this.angle);const v=K.perspective(new Float32Array(16),this._fov,this.width/this.height,y,g),b=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;v[8]=2*-t.x/this.width,v[9]=2*(t.y+b)/this.height,this.skyboxMatrix=K.multiply(o,v,o);var r=this.width%2/2,n=this.height%2/2,e=Math.cos(this.angle),t=Math.sin(this.angle),o=u-Math.round(u)+e*r+t*n,t=d-Math.round(d)+e*n+t*r,r=new Float64Array(i);if(K.translate(r,r,[.5<o?o-1:o,.5<t?t-1:t,0]),this.alignedProjMatrix=r,i=K.create$1(),K.scale$1(i,i,[this.width/2,-this.height/2,1]),K.translate(i,i,[1,-1,0]),this.labelPlaneMatrix=i,i=K.create$1(),K.scale$1(i,i,[1,-1,1]),K.translate(i,i,[-1,-1,0]),K.scale$1(i,i,[2/this.width,2/this.height,1]),this.glCoordMatrix=i,this.pixelMatrix=K.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),!(i=K.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=i,this._projMatrixCache={},this._alignedProjMatrixCache={}}}_calcFogMatrices(){this._fogTileMatrixCache={};var t=this.cameraWorldSize,e=this.cameraPixelsPerMeter,i=this._camera.position,o=1/this.height,r=[t,t,e];K.scale(r,r,o),K.scale(i,i,-1),K.multiply$1(i,i,r);var n=K.create$1();K.translate(n,n,i),K.scale$1(n,n,r),this.mercatorFogMatrix=n,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,e,o)}_updateCameraState(){var t,e,i,o;this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),t=this._camera.forward(),e=this.cameraToCenterDistance,i=this.point,o=this._mercatorZfromZoom(this._cameraZoom||this._zoom)-K.mercatorZfromAltitude(this._centerAltitude,this.center.lat),o=this.cameraToCenterDistance/o,this._camera.position=[i.x/this.worldSize-t[0]*e/o,i.y/this.worldSize-t[1]*e/o,K.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*e/o])}_translateCameraConstrained(t){var e=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=t[2];let o=1;0<i&&(o=Math.min((e-this._camera.position[2])/i,1)),this._camera.position=K.scaleAndAdd([],this._camera.position,t,o),this._updateStateFromCamera()}_updateStateFromCamera(){var t=this._camera.position,e=this._camera.forward(),{pitch:i,bearing:o}=this._camera.getPitchBearing(),r=K.mercatorZfromAltitude(this._centerAltitude,this.center.lat),n=this._mercatorZfromZoom(this._maxZoom)*Math.cos(K.degToRad(this._maxPitch)),r=Math.max((t[2]-r)/Math.cos(i),n),n=this._zoomFromMercatorZ(r);K.scaleAndAdd(t,t,e,r),this._pitch=K.clamp(i,K.degToRad(this.minPitch),K.degToRad(this.maxPitch)),this.angle=K.wrap(o,-Math.PI,Math.PI),this._setZoom(K.clamp(n,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new K.MercatorCoordinate(t[0],t[1],t[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){var t=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!!this._elevation}isHorizonVisibleForPoints(t,e){var i=Math.min(t.x,e.x),o=Math.max(t.x,e.x),r=Math.min(t.y,e.y),e=Math.max(t.y,e.y),r=[new K.pointGeometry(i,r),new K.pointGeometry(o,e),new K.pointGeometry(i,e),new K.pointGeometry(o,r)],n=this._renderWorldCopies?-3:0,s=this._renderWorldCopies?4:1;for(const K of r){const t=this.pointRayIntersection(K);if(t.t<0)return!0;const a=this.rayIntersectionCoordinate(t);if(a.x<n||a.y<0||a.x>s||1<a.y)return!0}return!1}isHorizonVisible(){return 88<this.pitch+K.radToDeg(this.fovAboveCenter)||this.isHorizonVisibleForPoints(new K.pointGeometry(0,0),new K.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,e){t=K.length(K.sub([],this._camera.position,t)),e=this._zoomFromMercatorZ(t)+e;return t-this._mercatorZfromZoom(e)}getCameraPoint(){var t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new K.pointGeometry(0,t))}}class Ji{constructor(t){this._hashName=t&&encodeURIComponent(t),K.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(t){let e=!1,i=null;const o=()=>{i=null,e&&(t(),i=setTimeout(o,300),e=!1)};return()=>(e=!0,i||o(),i)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,K.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return K.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const t=this._map.getCenter(),e=Math.round(100*this._map.getZoom())/100,i=Math.ceil((e*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),n=Math.round(t.lng*r)/r,s=Math.round(t.lat*r)/r,a=this._map.getBearing(),l=this._map.getPitch();let h="";if(h+=o?`/${n}/${s}/${e}`:`${e}/${s}/${n}`,(a||l)&&(h+="/"+Math.round(10*a)/10),l&&(h+=`/${Math.round(l)}`),this._hashName){const o=this._hashName;let i=!1;const e=K.window.location.hash.slice(1).split("&").map(t=>{var e=t.split("=")[0];return e===o?(i=!0,`${e}=${h}`):t}).filter(t=>t);return i||e.push(`${o}=${h}`),`#${e.join("&")}`}return`#${h}`}_getCurrentHash(){const t=K.window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map(t=>t.split("=")).forEach(t=>{t[0]===this._hashName&&(e=t)}),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(3<=t.length&&!t.some(t=>isNaN(t))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){var t=K.window.location.href.replace(/(#.+)?$/,this.getHashString());K.window.history.replaceState(K.window.history.state,null,t)}}const Qi={linearity:.3,easing:K.bezier(0,0,.3,1)},to=K.extend({deceleration:2500,maxSpeed:1400},Qi),eo=K.extend({deceleration:20,maxSpeed:1400},Qi),io=K.extend({deceleration:1e3,maxSpeed:360},Qi),oo=K.extend({deceleration:1e3,maxSpeed:90},Qi);class ro{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:K.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,e=K.exported.now();for(;0<t.length&&160<e-t[0].time;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){const e={zoom:0,bearing:0,pitch:0,pan:new K.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:K}of this._inertiaBuffer)e.zoom+=K.zoomDelta||0,e.bearing+=K.bearingDelta||0,e.pitch+=K.pitchDelta||0,K.panDelta&&e.pan._add(K.panDelta),K.around&&(e.around=K.around),K.pinchAround&&(e.pinchAround=K.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,o={};if(e.pan.mag()&&(t=so(e.pan.mag(),i,K.extend({},to,t||{})),o.offset=e.pan.mult(t.amount/e.pan.mag()),o.center=this._map.transform.center,no(o,t)),e.zoom){const K=so(e.zoom,i,eo);o.zoom=this._map.transform.zoom+K.amount,no(o,K)}if(e.bearing){const r=so(e.bearing,i,io);o.bearing=this._map.transform.bearing+K.clamp(r.amount,-179,179),no(o,r)}if(e.pitch){const K=so(e.pitch,i,oo);o.pitch=this._map.transform.pitch+K.amount,no(o,K)}if(o.zoom||o.bearing){const K=void 0===e.pinchAround?e.around:e.pinchAround;o.around=K?this._map.unproject(K):this._map.getCenter()}return this.clear(),K.extend(o,{noMoveStart:!0})}}}function no(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function so(t,e,i){var{maxSpeed:o,linearity:r,deceleration:n}=i,o=K.clamp(t*r/(e/1e3),-o,o),r=Math.abs(o)/(n*r);return{easing:i.easing,duration:1e3*r,amount:o*(r/2)}}class ao extends K.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i,o={}){var r=d.mousePos(e.getCanvasContainer(),i),n=e.unproject(r);super(t,K.extend({point:r,lngLat:n,originalEvent:i},o)),this._defaultPrevented=!1,this.target=e}}class lo extends K.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){const o="touchend"===t?i.changedTouches:i.touches,r=d.touchPos(e.getCanvasContainer(),o),n=r.map(t=>e.unproject(t)),s=r.reduce((t,e,i,o)=>t.add(e.div(o.length)),new K.pointGeometry(0,0));super(t,{points:r,point:s,lngLats:n,lngLat:e.unproject(s),originalEvent:i}),this._defaultPrevented=!1}}class ho extends K.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class po{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ho(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new ao(t.type,this._map,t))}mouseup(t){this._map.fire(new ao(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new ao(t.type,this._map,t))}dblclick(t){return this._firePreventable(new ao(t.type,this._map,t))}mouseover(t){this._map.fire(new ao(t.type,this._map,t))}mouseout(t){this._map.fire(new ao(t.type,this._map,t))}touchstart(t){return this._firePreventable(new lo(t.type,this._map,t))}touchmove(t){this._map.fire(new lo(t.type,this._map,t))}touchend(t){this._map.fire(new lo(t.type,this._map,t))}touchcancel(t){this._map.fire(new lo(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class co{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ao(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ao("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new ao(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uo{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(d.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(this._active){const i=e;if(!(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)){e=this._startPos;this._lastPos=i,this._box||(this._box=d.create("div","zmapboxgl-boxzoom",this._container),this._container.classList.add("zmapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const o=Math.min(e.x,i.x),r=Math.max(e.x,i.x),n=Math.min(e.y,i.y),s=Math.max(e.y,i.y);this._map._requestDomTask(()=>{this._box&&(d.setTransform(this._box,`translate(${o}px,${n}px)`),this._box.style.width=r-o+"px",this._box.style.height=s-n+"px")})}}}mouseupWindow(t,e){if(this._active&&0===t.button){const i=this._startPos,o=e;if(this.reset(),d.suppressClick(),i.x!==o.x||i.y!==o.y)return this._map.fire(new K.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:t=>t.fitScreenCoordinates(i,o,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("zmapboxgl-crosshair"),this._box&&(d.remove(this._box),this._box=null),d.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,e){return this._map.fire(new K.Event(t,{originalEvent:e}))}}function fo(e,i){const o={};for(let t=0;t<e.length;t++)o[e[t].identifier]=i[t];return o}class go{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,e,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){const e=new K.pointGeometry(0,0);for(const K of t)e._add(K);return e.div(t.length)}(e),this.touches=fo(i,e)))}touchmove(t,e,i){if(!this.aborted&&this.centroid){var o=fo(i,e);for(const t in this.touches){const e=this.touches[t],i=o[t];(!i||30<i.dist(e))&&(this.aborted=!0)}}}touchend(t,e,i){if((!this.centroid||500<t.timeStamp-this.startTime)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class yo{constructor(t){this.singleTap=new go(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){i=this.singleTap.touchend(t,e,i);if(i){const e=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(i)<30;if(e&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class mo{constructor(){this._zoomIn=new yo({numTouches:1,numTaps:2}),this._zoomOut=new yo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(e,t,i){const o=this._zoomIn.touchend(e,t,i),r=this._zoomOut.touchend(e,t,i);return o?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(o)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _o={0:1,2:2,1:4};class vo{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){var i;this._lastPoint||(i=d.mouseButton(t),this._correctButton(t,i)&&(this._lastPoint=e,this._eventButton=i))}mousemoveWindow(t,e){var i=this._lastPoint;if(i)if(t.preventDefault(),function(t,e){e=_o[e];return void 0===t.buttons||(t.buttons&e)!==e}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(i,e)}mouseupWindow(t){this._lastPoint&&d.mouseButton(t)===this._eventButton&&(this._moved&&d.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bo extends vo{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class xo extends vo{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e||1===e}_move(t,e){t=.8*(e.x-t.x);if(t)return this._active=!0,{bearingDelta:t}}contextmenu(t){t.preventDefault()}}class wo extends vo{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e||1===e}_move(t,e){t=-.5*(e.y-t.y);if(t)return this._active=!0,{pitchDelta:t}}contextmenu(t){t.preventDefault()}}class Mo{constructor(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new K.pointGeometry(0,0)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(t,e,i){if(this._active&&!(i.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,i)}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,e,i){0<i.length&&(this._active=!0);const o=fo(i,e),r=new K.pointGeometry(0,0),n=new K.pointGeometry(0,0);let s=0;for(const K in o){const t=o[K],a=this._touches[K];a&&(r._add(t),n._add(t.sub(a)),s++,o[K]=t)}if(this._touches=o,!(s<this._minTouches)&&n.mag()){e=n.div(s);return this._sum._add(e),this._sum.mag()<this._clickTolerance?void 0:{around:r.div(s),panDelta:e}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Po{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,e,i){return{}}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){if(this._firstTwoTouches){t.preventDefault();const[o,r]=this._firstTwoTouches,n=Eo(i,e,o),s=Eo(i,e,r);if(n&&s){e=this._aroundCenter?null:n.add(s).div(2);return this._move([n,s],e,t)}}}touchend(t,e,i){var o,r;this._firstTwoTouches&&([o,r]=this._firstTwoTouches,o=Eo(i,e,o),r=Eo(i,e,r),o&&r||(this._active&&d.suppressClick(),this.reset()))}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Eo(e,i,o){for(let t=0;t<e.length;t++)if(e[t].identifier===o)return i[t]}function So(t,e){return Math.log(t/e)/Math.LN2}class To extends Po{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){var i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(So(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:So(this._distance,i),pinchAround:e}}}function Ao(t,e){return 180*t.angleWith(e)/Math.PI}class Co extends Po{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){var i=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ao(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,t=Ao(t,this._startVector);return Math.abs(t)<e}}function Io(t){return Math.abs(t.y)>Math.abs(t.x)}class Lo extends Po{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){Io((this._lastPoints=t)[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,i){var o=t[0].sub(this._lastPoints[0]),r=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(o,r,i.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(o.y+r.y)/2*-.5}}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;var o=2<=t.mag(),r=2<=e.mag();if(o||r){if(!o||!r)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;i=0<t.y==0<e.y;return Io(t)&&Io(e)&&i}}}const Oo={panStep:100,bearingStep:15,pitchStep:10};class Ro{constructor(){var t=Oo;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(!(a.altKey||a.ctrlKey||a.metaKey)){let i=0,o=0,r=0,n=0,s=0;switch(a.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:a.shiftKey?o=-1:(a.preventDefault(),n=-1);break;case 39:a.shiftKey?o=1:(a.preventDefault(),n=1);break;case 38:a.shiftKey?r=1:(a.preventDefault(),s=-1);break;case 40:a.shiftKey?r=-1:(a.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(o=0,r=0),{cameraAnimation:t=>{var e=t.getZoom();t.easeTo({duration:300,easeId:"keyboardHandler",easing:Do,zoom:i?Math.round(e)+i*(a.shiftKey?2:1):e,bearing:t.getBearing()+o*this._bearingStep,pitch:t.getPitch()+r*this._pitchStep,offset:[-n*this._panStep,-s*this._panStep],center:t.getCenter()},{originalEvent:a})}}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Do(t){return t*(2-t)}const ko=4.000244140625;class zo{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._handler=e,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,K.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(this.isEnabled()){let t=e.deltaMode===K.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;var i=K.exported.now(),o=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==t&&t%ko==0?this._type="wheel":0!==t&&Math.abs(t)<4?this._type="trackpad":400<o?(this._type=null,this._lastValue=t,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(o*t)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,t+=this._lastValue)),e.shiftKey&&t&&(t/=4),this._type&&(this._lastWheelEvent=e,this._delta-=t,this._active||this._start(e)),e.preventDefault()}}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){this._delta&&(this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout),t=d.mousePos(this._el,t),this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame()))}renderFrame(){if(this._frameId&&(this._frameId=null,this.isActive())){const i=this._map.transform,o=()=>i._terrainEnabled()?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const K=this._map.zoomInteger?1:"wheel"===this._type&&Math.abs(this._delta)>ko?this._wheelZoomRate:this._defaultZoomRate;let t=2/(1+Math.exp(-Math.abs(this._delta*K)));this._delta<0&&0!==t&&(t=1/t);const n=o(),s=Math.pow(2,n),e="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(e*t))),"wheel"===this._type&&(this._startZoom=o(),this._easing=this._smoothOutEasing(200)),this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:o(),n=this._startZoom,s=this._easing;let t,e=!1;if("wheel"===this._type&&n&&s){const i=Math.min((K.exported.now()-this._lastWheelEventTime)/200,1),o=s(i);t=K.number(n,r,o),i<1?this._frameId||(this._frameId=!0):e=!0}else t=r,e=!0;return this._active=!0,e&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!e,zoomDelta:t-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}}_smoothOutEasing(t){let e=K.ease;if(this._prevEase){const t=this._prevEase,i=(K.exported.now()-t.start)/t.duration,o=t.easing(.01+i)-t.easing(i),r=.27/Math.sqrt(o*o+1e-4)*.01,n=Math.sqrt(.0729-r*r);e=K.bezier(r,n,.25,1)}return this._prevEase={start:K.exported.now(),duration:t,easing:e},e}reset(){this._active=!1}}class Fo{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class No{constructor(){this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:t=>{t.easeTo({duration:300,zoom:t.getZoom()+(e.shiftKey?-1:1),around:t.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uo{constructor(){this._tap=new yo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,e,i){this._swipePoint||(this._tapTime&&500<t.timeStamp-this._tapTime&&this.reset(),this._tapTime?0<i.length&&(this._swipePoint=e[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,e,i))}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint&&i[0].identifier===this._swipeTouch){var o=e[0],r=o.y-this._swipePoint.y;return this._swipePoint=o,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,e,i)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bo{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("zmapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("zmapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jo{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zo{constructor(t,e,i,o){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("zmapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("zmapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Go=t=>t.zoom||t.drag||t.pitch||t.rotate;class Vo extends K.Event{}class Wo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,e){t=K.sub([],e,t);this.radius=K.length(t[2]<0?K.div([],t,this.constants):[t[0],t[1],0])}projectRay(t){K.div(t,t,this.constants),K.normalize(t,t),K.mul$2(t,t,this.constants);const e=K.scale([],t,this.radius);if(0<e[2]){const t=K.scale([],[0,0,1],K.dot(e,[0,0,1])),i=K.scale([],K.normalize([],[e[0],e[1],0]),this.radius),o=K.add([],e,K.scale([],K.sub([],K.add([],i,t),e),2));e[0]=o[0],e[1]=o[1]}return e}}function Ho(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class qo{constructor(t,e){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ro(t),this._bearingSnap=e.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(e),K.bindAll(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[K.window.document,"mousemove",{capture:!0}],[K.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[K.window,"blur",void 0]];for(const[t,e,i]of this._listeners)d.addEventListener(t,e,t===K.window.document?this.handleWindowEvent:this.handleEvent,i)}destroy(){for(var[t,e,i]of this._listeners)d.removeEventListener(t,e,t===K.window.document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new po(e,t));var o=e.boxZoom=new uo(e,t);this._add("boxZoom",o);var r=new mo,n=new No;e.doubleClickZoom=new Fo(n,r),this._add("tapZoom",r),this._add("clickZoom",n);o=new Uo;this._add("tapDragZoom",o);r=e.touchPitch=new Lo;this._add("touchPitch",r);n=new xo(t),r=new wo(t);e.dragRotate=new jo(t,n,r),this._add("mouseRotate",n,["mousePitch"]),this._add("mousePitch",r,["mouseRotate"]);n=new bo(t),r=new Mo(t);e.dragPan=new Bo(i,n,r),this._add("mousePan",n),this._add("touchPan",r,["touchZoom","touchRotate"]);n=new Co,r=new To;e.touchZoomRotate=new Zo(i,r,n,o),this._add("touchRotate",n,["touchPan","touchZoom"]),this._add("touchZoom",r,["touchPan","touchRotate"]),this._add("blockableMapEvent",new co(e));r=e.scrollZoom=new zo(e,this);this._add("scrollZoom",r,["mousePan"]);r=e.keyboard=new Ro;this._add("keyboard",r);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[i]&&e[i].enable(t[i])}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(var{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Go(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,i){for(const o in t)if(o!==i&&(!e||e.indexOf(o)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}handleEvent(e,i){if("blur"!==e.type){this._updatingCamera=!0;const o="renderFrame"===e.type,r=o?void 0:e,n={needsRenderFrame:!1},s={},a={},l=e.touches?this._getMapTouches(e.touches):void 0,h=l?d.touchPos(this._el,l):o?void 0:d.mousePos(this._el,e);for(const{handlerName:o,handler:d,allowed:p}of this._handlers)if(d.isEnabled()){let t;this._blockedByActive(a,p,o)?d.reset():d[i||e.type]&&(t=d[i||e.type](e,h,l),this.mergeHandlerResult(n,s,t,o,r),t&&t.needsRenderFrame&&this._triggerRenderFrame()),(t||d.isActive())&&(a[o]=d)}const p={};for(const e in this._previousActiveHandlers)a[e]||(p[e]=r);this._previousActiveHandlers=a,(Object.keys(p).length||Ho(n))&&(this._changes.push([n,s,p]),this._triggerRenderFrame()),(Object.keys(a).length||Ho(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:t}=n;t&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],t(this._map))}else this.stop(!0)}mergeHandlerResult(t,e,i,o,r){i&&(K.extend(t,i),r={handlerName:o,originalEvent:i.originalEvent||r},void 0!==i.zoomDelta&&(e.zoom=r),void 0!==i.panDelta&&(e.drag=r),void 0!==i.pitchDelta&&(e.pitch=r),void 0!==i.bearingDelta&&(e.rotate=r))}_applyChanges(){const t={},e={},i={};for(var[o,r,n]of this._changes)o.panDelta&&(t.panDelta=(t.panDelta||new K.pointGeometry(0,0))._add(o.panDelta)),o.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+o.pitchDelta),void 0!==o.around&&(t.around=o.around),void 0!==o.aroundCoord&&(t.aroundCoord=o.aroundCoord),void 0!==o.pinchAround&&(t.pinchAround=o.pinchAround),o.noInertia&&(t.noInertia=o.noInertia),K.extend(e,r),K.extend(i,n);this._updateMapTransform(t,e,i),this._changes=[]}_updateMapTransform(t,e,i){const o=this._map,r=o.transform,n=t=>[t.x,t.y,t.z];if((g=this._eventsInProgress.drag)&&!this._handlersById[g.handlerName].isActive()&&!Ho(t)){const K=r.zoom;r.cameraElevationReference="sea",r.recenterOnTerrain(),r.cameraElevationReference="ground",K!==r.zoom&&this._map._update(!0)}if(!Ho(t))return this._fireEvents(e,i,!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:h,around:p,aroundCoord:c,pinchAround:u}=t;void 0!==u&&(p=u),e.drag&&!this._eventsInProgress.drag&&p&&(this._dragOrigin=n(r.pointCoordinate3D(p)),this._trackingEllipsoid.setup(r._camera.position,this._dragOrigin)),r.cameraElevationReference="sea",o._stop(!0),p=p||o.transform.centerPoint,l&&(r.bearing+=l),h&&(r.pitch+=h),r._updateCameraState();const d=[0,0,0];if(s){const K=r.screenPointToMercatorRay(p),t=r.screenPointToMercatorRay(p.sub(s)),e=this._trackingEllipsoid.projectRay(K.dir),i=this._trackingEllipsoid.projectRay(t.dir);d[0]=i[0]-e[0],d[1]=i[1]-e[1]}var f=r.zoom,g=[0,0,0];if(a){const t=n(c||r.pointCoordinate3D(p)),e={dir:K.normalize([],K.sub([],t,r._camera.position))},i=r.screenPointToMercatorRay(r.centerPoint);if(e.dir[2]<0){const o=K.altitudeFromMercatorZ(t[2],t[1]),s=r.rayIntersectionCoordinate(r.pointRayIntersection(r.centerPoint,o)),l=r.zoomDeltaToMovement(n(s),a)*(i.dir[2]/e.dir[2]);K.scale(g,e.dir,l)}else if(r._terrainEnabled()){const i=r.zoomDeltaToMovement(t,a);K.scale(g,e.dir,i)}}g=K.add(d,d,g);r._translateCameraConstrained(g),a&&1e-4<Math.abs(r.zoom-f)&&r.recenterOnTerrain(),r.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,i,!0)}_fireEvents(t,e,i){const o=Go(this._eventsInProgress),r=Go(t),n={};for(const K in t){const{originalEvent:e}=t[K];this._eventsInProgress[K]||(n[`${K}start`]=e),this._eventsInProgress[K]=t[K]}!o&&r&&this._fireEvent("movestart",r.originalEvent);for(const K in n)this._fireEvent(K,n[K]);r&&this._fireEvent("move",r.originalEvent);for(const K in t){const{originalEvent:e}=t[K];this._fireEvent(K,e)}const s={};let a;for(const K in this._eventsInProgress){const{handlerName:t,originalEvent:i}=this._eventsInProgress[K];this._handlersById[t].isActive()||(delete this._eventsInProgress[K],a=e[t]||i,s[`${K}end`]=a)}for(const K in s)this._fireEvent(K,s[K]);var l=Go(this._eventsInProgress);if(i&&(o||r)&&!l){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),e=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;t?(e(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:a})):(this._map.fire(new K.Event("moveend",{originalEvent:a})),e(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,e){this._map.fire(new K.Event(t,e?{originalEvent:e}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Vo("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Yo extends K.Evented{constructor(t,e){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=e.bearingSnap,K.bindAll(["_renderFrameCallback"],this)}getCenter(){return new K.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(t,e,i){return t=K.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,K.extend({offset:t},e),i)}panTo(t,e,i){return this.easeTo(K.extend({center:t},e),i)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(t,e,i){return this.easeTo(K.extend({zoom:t},e),i)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(t,e,i){return this.easeTo(K.extend({bearing:t},e),i)}resetNorth(t,e){return this.rotateTo(0,K.extend({duration:1e3},t),e),this}resetNorthPitch(t,e){return this.easeTo(K.extend({bearing:0,pitch:0,duration:1e3},t),e),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(t,e){t=K.LngLatBounds.convert(t);var i=e&&e.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),i,e)}_extendCameraOptions(t){var e={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=K.extend({padding:e,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const K=t.padding;t.padding={top:K,bottom:K,right:K,left:K}}return t.padding=K.extend(e,t.padding),t}_cameraForBoxAndBearing(t,e,i,o){const r=this._extendCameraOptions(o),n=this.transform,s=n.padding,a=n.project(K.LngLat.convert(t)),l=n.project(K.LngLat.convert(e)),h=a.rotate(-K.degToRad(i)),p=l.rotate(-K.degToRad(i)),c=new K.pointGeometry(Math.max(h.x,p.x),Math.max(h.y,p.y)),u=new K.pointGeometry(Math.min(h.x,p.x),Math.min(h.y,p.y)),d=c.sub(u),f=(n.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,g=(n.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(g<0||f<0)){const y=Math.min(n.scaleZoom(n.scale*Math.min(f,g)),r.maxZoom),m="number"==typeof r.offset.x?new K.pointGeometry(r.offset.x,r.offset.y):K.pointGeometry.convert(r.offset),_=new K.pointGeometry((r.padding.left-r.padding.right)/2,(r.padding.top-r.padding.bottom)/2).rotate(i*Math.PI/180),v=m.add(_).mult(n.scale/n.zoomScale(y));return{center:n.unproject(a.add(l).div(2).sub(v)),zoom:y,bearing:i}}K.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}_cameraForBox(i,o,r,n,s){const a=this._extendCameraOptions(s);r=r||0,n=n||0,i=K.LngLat.convert(i),o=K.LngLat.convert(o);const l=this.transform.clone();l.padding=a.padding;const h=this.getFreeCameraOptions(),p=new K.LngLat(.5*(i.lng+o.lng),.5*(i.lat+o.lat)),c=.5*(r+n);if(!(l._camera.position[2]<K.mercatorZfromAltitude(c,p.lat))){h.lookAtPoint(p),l.setFreeCameraOptions(h);const d=K.MercatorCoordinate.fromLngLat(i),f=K.MercatorCoordinate.fromLngLat(o),g=l.pointRayIntersection(l.centerPoint,c),y=[(o=l.rayIntersectionCoordinate(g)).x,o.y,o.z];var u=l.screenPointToMercatorRay(l.centerPoint);let t,e=0;do{const i=Math.floor(l.zoom),m=1<<i,s=Math.min(m*d.x,m*f.x),a=Math.min(m*d.y,m*f.y),h=Math.max(m*d.x,m*f.x),p=Math.max(m*d.y,m*f.y),c=new S([s,a,r],[h,p,n]),g=E.fromInvProjectionMatrix(l.invProjMatrix,l.worldSize,i);if(2!==c.intersects(g)){t&&(l._camera.position=K.scaleAndAdd([],l._camera.position,u.dir,-t),l._updateStateFromCamera());break}const o=K.sub([],l._camera.position,y);t=.5*K.length(o),l._camera.position=K.scaleAndAdd([],l._camera.position,u.dir,t);try{l._updateStateFromCamera()}catch(i){return void K.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++e<10);return{center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}}K.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}fitBounds(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)}_raycastElevationBox(t,e){const i=this.transform.elevation;if(i){var o=new K.pointGeometry(t.x,e.y),r=new K.pointGeometry(e.x,t.y),n=i.pointCoordinate(t);if(n){var s=i.pointCoordinate(e);if(s){var a=i.pointCoordinate(o);if(a){var l=i.pointCoordinate(r);if(l){var h=new K.MercatorCoordinate(n[0],n[1]).toLngLat(),p=new K.MercatorCoordinate(s[0],s[1]).toLngLat(),c=new K.MercatorCoordinate(a[0],a[1]).toLngLat(),t=new K.MercatorCoordinate(l[0],l[1]).toLngLat(),e=Math.min(h.lng,Math.min(p.lng,Math.min(c.lng,t.lng))),o=Math.min(h.lat,Math.min(p.lat,Math.min(c.lat,t.lat))),r=Math.max(h.lng,Math.max(p.lng,Math.max(c.lng,t.lng))),c=Math.max(h.lat,Math.max(p.lat,Math.max(c.lat,t.lat))),t=Math.min(n[3],Math.min(s[3],Math.min(a[3],l[3]))),l=Math.max(n[3],Math.max(s[3],Math.max(a[3],l[3])));return{minLngLat:new K.LngLat(e,o),maxLngLat:new K.LngLat(r,c),minAltitude:t,maxAltitude:l}}}}}}}fitScreenCoordinates(t,e,i,o,r){let n,s,a,l;var h=K.pointGeometry.convert(t),p=K.pointGeometry.convert(e),c=this._raycastElevationBox(h,p);if(c)n=c.minLngLat,s=c.maxLngLat,a=c.minAltitude,l=c.maxAltitude;else{if(this.transform.isHorizonVisibleForPoints(h,p))return this;n=this.transform.pointLocation(h),s=this.transform.pointLocation(p)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(K.pointGeometry.convert(t)),this.transform.pointLocation(K.pointGeometry.convert(e)),i,o):this._cameraForBox(n,s,a,l,o),o,r)}_fitInternal(t,e,i){return t?(delete(e=K.extend(t,e)).padding,e.linear?this.easeTo(e,i):this.flyTo(e,i)):this}jumpTo(t,e){this.stop();const i=this.transform;let o=!1,r=!1,n=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(o=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=K.LngLat.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(r=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(n=!0,i.pitch=+t.pitch),null==t.padding||i.isPaddingEqual(t.padding)||(i.padding=t.padding),this.fire(new K.Event("movestart",e)).fire(new K.Event("move",e)),o&&this.fire(new K.Event("zoomstart",e)).fire(new K.Event("zoom",e)).fire(new K.Event("zoomend",e)),r&&this.fire(new K.Event("rotatestart",e)).fire(new K.Event("rotate",e)).fire(new K.Event("rotateend",e)),n&&this.fire(new K.Event("pitchstart",e)).fire(new K.Event("pitch",e)).fire(new K.Event("pitchend",e)),this.fire(new K.Event("moveend",e))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,e){this.stop();const i=this.transform,o=i.zoom,r=i.pitch,n=i.bearing;i.setFreeCameraOptions(t);var s=o!==i.zoom,a=r!==i.pitch,t=n!==i.bearing;return this.fire(new K.Event("movestart",e)).fire(new K.Event("move",e)),s&&this.fire(new K.Event("zoomstart",e)).fire(new K.Event("zoom",e)).fire(new K.Event("zoomend",e)),t&&this.fire(new K.Event("rotatestart",e)).fire(new K.Event("rotate",e)).fire(new K.Event("rotateend",e)),a&&this.fire(new K.Event("pitchstart",e)).fire(new K.Event("pitch",e)).fire(new K.Event("pitchend",e)),this.fire(new K.Event("moveend",e)),this}easeTo(t,e){this._stop(!1,t.easeId),(!1===(t=K.extend({offset:[0,0],duration:500,easing:K.ease},t)).animate||!t.essential&&K.exported.prefersReducedMotion)&&(t.duration=0);const i=this.transform,o=this.getZoom(),r=this.getBearing(),n=this.getPitch(),s=this.getPadding(),a="zoom"in t?+t.zoom:o,l="bearing"in t?this._normalizeBearing(t.bearing,r):r,h="pitch"in t?+t.pitch:n,p=("padding"in t?t:i).padding,c=K.pointGeometry.convert(t.offset);let u=i.centerPoint.add(c);var d=i.pointLocation(u),f=K.LngLat.convert(t.center||d);this._normalizeCenter(f);const g=i.project(d),y=i.project(f).sub(g),m=i.zoomScale(a-o);let _,v;t.around&&(_=K.LngLat.convert(t.around),v=i.locationPoint(_));f={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||a!==o,this._rotating=this._rotating||r!==l,this._pitching=this._pitching||h!==n,this._padding=!i.isPaddingEqual(p),this._easeId=t.easeId,this._prepareEase(e,t.noMoveStart,f),this._ease(t=>{if(this._zooming&&(i.zoom=K.number(o,a,t)),this._rotating&&(i.bearing=K.number(r,l,t)),this._pitching&&(i.pitch=K.number(n,h,t)),this._padding&&(i.interpolatePadding(s,p,t),u=i.centerPoint.add(c)),_)i.setLocationAtPoint(_,v);else{const K=i.zoomScale(i.zoom-o),e=a>o?Math.min(2,m):Math.max(.5,m),r=Math.pow(e,1-t),n=i.unproject(g.add(y.mult(t*r)).mult(K));i.setLocationAtPoint(i.renderWorldCopies?n.wrap():n,u)}this._fireMoveEvents(e)},t=>{i.recenterOnTerrain(),this._afterEase(e,t)},t),this}_prepareEase(t,e,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",e||i.moving||this.fire(new K.Event("movestart",t)),this._zooming&&!i.zooming&&this.fire(new K.Event("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new K.Event("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new K.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new K.Event("move",t)),this._zooming&&this.fire(new K.Event("zoom",t)),this._rotating&&this.fire(new K.Event("rotate",t)),this._pitching&&this.fire(new K.Event("pitch",t))}_afterEase(t,e){var i,o;this._easeId&&e&&this._easeId===e||(delete this._easeId,this.transform.cameraElevationReference="ground",i=this._zooming,o=this._rotating,e=this._pitching,this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new K.Event("zoomend",t)),o&&this.fire(new K.Event("rotateend",t)),e&&this.fire(new K.Event("pitchend",t)),this.fire(new K.Event("moveend",t)))}flyTo(t,r){if(!t.essential&&K.exported.prefersReducedMotion){const n=K.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,r)}this.stop(),t=K.extend({offset:[0,0],speed:1.2,curve:1.42,easing:K.ease},t);const n=this.transform,s=this.getZoom(),a=this.getBearing(),l=this.getPitch(),h=this.getPadding(),p="zoom"in t?K.clamp(+t.zoom,n.minZoom,n.maxZoom):s,c="bearing"in t?this._normalizeBearing(t.bearing,a):a,u="pitch"in t?+t.pitch:l,d=("padding"in t?t:n).padding,e=n.zoomScale(p-s),f=K.pointGeometry.convert(t.offset);let g=n.centerPoint.add(f);const i=n.pointLocation(g),y=K.LngLat.convert(t.center||i);this._normalizeCenter(y);const m=n.project(i),_=n.project(y).sub(m);let o=t.curve;const v=Math.max(n.width,n.height),b=v/e,x=_.mag();if("minZoom"in t){const r=K.clamp(Math.min(t.minZoom,s,p),n.minZoom,n.maxZoom),a=v/n.zoomScale(r-s);o=Math.sqrt(a/x*2)}const w=o*o;function M(t){t=(b*b-v*v+(t?-1:1)*w*w*x*x)/(2*(t?b:v)*w*x);return Math.log(Math.sqrt(t*t+1)-t)}function P(t){return(Math.exp(t)-Math.exp(-t))/2}function E(t){return(Math.exp(t)+Math.exp(-t))/2}const S=M(0);let T=function(t){return E(S)/E(S+o*t)},A=function(t){return v*((E(S)*(P(t=S+o*t)/E(t))-P(S))/w)/x},C=(M(1)-S)/o;if(Math.abs(x)<1e-6||!isFinite(C)){if(Math.abs(v-b)<1e-6)return this.easeTo(t,r);const K=b<v?-1:1;C=Math.abs(Math.log(b/v))/o,A=function(){return 0},T=function(t){return Math.exp(K*o*t)}}return t.duration="duration"in t?+t.duration:1e3*C/("screenSpeed"in t?+t.screenSpeed/o:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=a!==c,this._pitching=u!==l,this._padding=!n.isPaddingEqual(d),this._prepareEase(r,!1),this._ease(t=>{var e=t*C,i=1/T(e);n.zoom=1===t?p:s+n.scaleZoom(i),this._rotating&&(n.bearing=K.number(a,c,t)),this._pitching&&(n.pitch=K.number(l,u,t)),this._padding&&(n.interpolatePadding(h,d,t),g=n.centerPoint.add(f));const o=1===t?y:n.unproject(m.add(_.mult(A(e))).mult(i));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,g),n._updateCenterElevation(),this._fireMoveEvents(r)},()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(t,e,i){!1===i.animate||0===i.duration?(t(1),e()):(this._easeStart=K.exported.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){var t=Math.min((K.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,e){t=K.wrap(t,-180,180);var i=Math.abs(t-e);return Math.abs(t-360-e)<i&&(t-=360),Math.abs(t+360-e)<i&&(t+=360),t}_normalizeCenter(t){var e=this.transform;e.renderWorldCopies&&!e.lngRange&&(e=t.lng-e.center.lng,t.lng+=180<e?-360:e<-180?360:0)}}class Xo{constructor(t={}){this.options=t,K.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){var e=this.options&&this.options.compact;return this._map=t,this._container=d.create("div","zmapboxgl-ctrl zmapboxgl-ctrl-attrib"),this._compactButton=d.create("button","zmapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=d.create("div","zmapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("zmapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){d.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){e=this._map._getUIString(`AttributionControl.${e}`);t.title=e,t.setAttribute("aria-label",e)}_toggleAttribution(){this._container.classList.contains("zmapboxgl-compact-show")?(this._container.classList.remove("zmapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("zmapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let t=this._editLink;t=t||(this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||K.config.ACCESS_TOKEN}];var e;t&&(e=o.reduce((t,e,i)=>(e.value&&(t+=`${e.key}=${e.value}${i<o.length-1?"&":""}`),t),"?"),t.href=`${K.config.FEEDBACK_URL}/${e}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback"))}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(this._map.style){let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(t=>"string"!=typeof t?"":t)):"string"==typeof this.options.customAttribution&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const t=this._map.style._sourceCaches;for(const e in t){const i=t[e];if(i.used){const t=i.getSource();t.attribution&&o.indexOf(t.attribution)<0&&o.push(t.attribution)}}o.sort((t,e)=>t.length-e.length),o=o.filter((e,i)=>{for(let t=i+1;t<o.length;t++)if(0<=o[t].indexOf(e))return!1;return!0});const e=o.join(" | ");e!==this._attribHTML&&(this._attribHTML=e,o.length?(this._innerContainer.innerHTML=e,this._container.classList.remove("zmapboxgl-attrib-empty")):this._container.classList.add("zmapboxgl-attrib-empty"),this._editLink=null)}}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("zmapboxgl-compact"):this._container.classList.remove("zmapboxgl-compact","zmapboxgl-compact-show")}}const Ko={logoInfo:""};class $o{constructor(t){this.options=K.extend({},Ko,t),K.bindAll(["_updateLogo"],this),K.bindAll(["_updateCompact"],this)}onAdd(t){return this._map=t,this._container=d.create("div","zmapboxgl-ctrl"),this._container.style.display="block",this.options.logoInfo&&(/<[^>]+>/g.test(this.options.logoInfo)||this.options.logoInfo instanceof HTMLElement?this._container.innerHTML=this.options.logoInfo:this._container.innerText=this.options.logoInfo),this._updateLogo(),this._container}onRemove(){d.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const i=t[e].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){var t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("zmapboxgl-compact"):e.classList.remove("zmapboxgl-compact")}}}class Jo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){var e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Qo(t,e,i){var o,r,n,s,a;for(t=new K.LngLat(t.lng,t.lat),e&&(o=new K.LngLat(t.lng-360,t.lat),r=new K.LngLat(t.lng+360,t.lat),n=360*Math.ceil(Math.abs(t.lng-i.center.lng)/360),s=i.locationPoint(t).distSqr(e),a=e.x<0||e.y<0||e.x>i.width||e.y>i.height,i.locationPoint(o).distSqr(e)<s&&(a||Math.abs(o.lng-i.center.lng)<n)?t=o:i.locationPoint(r).distSqr(e)<s&&(a||Math.abs(r.lng-i.center.lng)<n)&&(t=r));180<Math.abs(t.lng-i.center.lng);){const K=i.locationPoint(t);if(0<=K.x&&0<=K.y&&K.x<=i.width&&K.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}const tr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function er(t,e,i){const o=t.classList;for(const t in tr)o.remove(`zmapboxgl-${i}-anchor-${t}`);o.add(`zmapboxgl-${i}-anchor-${e}`)}class ir extends K.Evented{constructor(t,e){if(super(),(t instanceof K.window.HTMLElement||e)&&(t=K.extend({element:t},e)),K.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=K.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=d.create("div"),this._element.setAttribute("aria-label","Map marker");const e=d.createNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS(null,"display","block"),e.setAttributeNS(null,"height","41px"),e.setAttributeNS(null,"width","27px"),e.setAttributeNS(null,"viewBox","0 0 27 41");const i=d.createNS("http://www.w3.org/2000/svg","g");i.setAttributeNS(null,"stroke","none"),i.setAttributeNS(null,"stroke-width","1"),i.setAttributeNS(null,"fill","none"),i.setAttributeNS(null,"fill-rule","evenodd");const o=d.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"fill-rule","nonzero");const r=d.createNS("http://www.w3.org/2000/svg","g");r.setAttributeNS(null,"transform","translate(3.0, 29.0)"),r.setAttributeNS(null,"fill","#000000");for(const K of[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}]){const t=d.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",K.rx),t.setAttributeNS(null,"ry",K.ry),r.appendChild(t)}const n=d.createNS("http://www.w3.org/2000/svg","g");n.setAttributeNS(null,"fill",this._color);const s=d.createNS("http://www.w3.org/2000/svg","path");s.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),n.appendChild(s);const a=d.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"opacity","0.25"),a.setAttributeNS(null,"fill","#000000");const l=d.createNS("http://www.w3.org/2000/svg","path");l.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),a.appendChild(l);const h=d.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"transform","translate(6.0, 7.0)"),h.setAttributeNS(null,"fill","#FFFFFF");const p=d.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"transform","translate(8.0, 8.0)");const c=d.createNS("http://www.w3.org/2000/svg","circle");c.setAttributeNS(null,"fill","#000000"),c.setAttributeNS(null,"opacity","0.25"),c.setAttributeNS(null,"cx","5.5"),c.setAttributeNS(null,"cy","5.5"),c.setAttributeNS(null,"r","5.4999962");const u=d.createNS("http://www.w3.org/2000/svg","circle");u.setAttributeNS(null,"fill","#FFFFFF"),u.setAttributeNS(null,"cx","5.5"),u.setAttributeNS(null,"cy","5.5"),u.setAttributeNS(null,"r","5.4999962"),p.appendChild(c),p.appendChild(u),o.appendChild(r),o.appendChild(n),o.appendChild(a),o.appendChild(h),o.appendChild(p),e.appendChild(o),e.setAttributeNS(null,"height",41*this._scale+"px"),e.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(e),this._offset=K.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("zmapboxgl-marker"),this._element.addEventListener("dragstart",t=>{t.preventDefault()}),this._element.addEventListener("mousedown",t=>{t.preventDefault()}),er(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),(this._map=t).getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),d.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=K.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){var e;return this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t&&("offset"in t.options||(e=Math.sqrt(Math.pow(13.5,2)/2),t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset),this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)),this}_onKeyPress(t){var e=t.code,t=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==t&&13!==t||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t&&(t.isOpen()?t.remove():t.addTo(this._map)),this}_evaluateOpacity(){const e=this._pos?this._pos.sub(this._transformedOffset()):null;if(this._withinScreenBounds(e)){var i=this._map.unproject(e);let t=!1;if(this._map.getTerrain()){const e=this._map.getFreeCameraOptions();if(e.position){const o=e.position.toLngLat();t=o.distanceTo(i)<.9*o.distanceTo(this._lngLat)}}const o=(1-this._map._queryFogOpacity(i))*(t?.2:1);this._element.style.opacity=`${o}`,this._popup&&this._popup._setOpacity(`${o}`),this._fadeTimer=null}else this._clearFadeTimer()}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(t){var e=this._map.transform;return!!t&&0<=t.x&&t.x<e.width&&0<=t.y&&t.y<e.height}_update(i){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Qo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let t="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?t=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(t=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let e="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?e="rotateX(0deg)":"map"===this._pitchAlignment&&(e=`rotateX(${this._map.getPitch()}deg)`),i&&"moveend"!==i.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&d.setTransform(this._element,`${tr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${e} ${t}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}}_transformedOffset(){if(!this._defaultMarker)return this._offset;const t=this._map.transform,e=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&e._rotate(t.angle),"map"===this._pitchAlignment&&(e.y*=Math.cos(t._pitch)),e}getOffset(){return this._offset}setOffset(t){return this._offset=K.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const K=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=K}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new K.Event("dragstart"))),this.fire(new K.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new K.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class or{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;t=K.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-t)+this._end*t}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,i){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+i}}const rr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:nr,HTMLElement:sr,ImageBitmap:ar}=K.window,lr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};class hr extends Yo{constructor(t){if(null!=(t=K.extend({},lr,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&85<t.maxPitch)throw new Error("maxPitch must be less than or equal to 85");if(super(new $i(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this.initMapCRS&&this.initMapCRS(t),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._optimizeForTerrain=t.optimizeForTerrain,this._renderTaskQueue=new Jo,this._domRenderTaskQueue=new Jo,this._controls=[],this._markers=[],this._mapId=K.uniqueId(),this._locale=K.extend({},rr,t.locale),this._clickTolerance=t.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new or(0),this._requestManager=new K.RequestManager(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(this._container=K.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof sr))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),K.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==K.window&&(K.window.addEventListener("online",this._onWindowOnline,!1),K.window.addEventListener("resize",this._onWindowResize,!1),K.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new qo(this,t),this._hash=t.hash&&new Ji("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,K.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.attributionControl&&this.addControl(new Xo({customAttribution:t.customAttribution})),this._logoControl=new $o,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new K.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new K.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(t,e){if(void 0===e&&(e=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new K.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var i=t.onAdd(this);this._controls.push(t);const o=this._controlPositions[e];return-1!==e.indexOf("bottom")?o.insertBefore(i,o.firstChild):o.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new K.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var e=this._controls.indexOf(t);return-1<e&&this._controls.splice(e,1),t.onRemove(this),this}hasControl(t){return-1<this._controls.indexOf(t)}resize(t){var e=this._containerDimensions(),i=e[0],e=e[1];this._resizeCanvas(i,e),this.transform.resize(i,e),this.painter.resize(i,e);e=!this._moving;return e&&(this.stop(),this.fire(new K.Event("movestart",t)).fire(new K.Event("move",t))),this.fire(new K.Event("resize",t)),e&&this.fire(new K.Event("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(K.LngLatBounds.convert(t)),this._update()}setMinZoom(t){if(-2<=(t=null==t?-2:t)&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(0<=t&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if(85<(t=null==t?85:t))throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}project(t){return this.transform.locationPoint3D(K.LngLat.convert(t))}unproject(t){return this.transform.pointLocation3D(K.pointGeometry.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(o,r,n){if("mouseenter"===o||"mouseover"===o){let i=!1;return{layer:r,listener:n,delegates:{mousemove:t=>{var e=this.getLayer(r)?this.queryRenderedFeatures(t.point,{layers:[r]}):[];e.length?i||(i=!0,n.call(this,new ao(o,this,t.originalEvent,{features:e}))):i=!1},mouseout:()=>{i=!1}}}}if("mouseleave"===o||"mouseout"===o){let e=!1;return{layer:r,listener:n,delegates:{mousemove:t=>{(this.getLayer(r)?this.queryRenderedFeatures(t.point,{layers:[r]}):[]).length?e=!0:e&&(e=!1,n.call(this,new ao(o,this,t.originalEvent)))},mouseout:t=>{e&&(e=!1,n.call(this,new ao(o,this,t.originalEvent)))}}}}return{layer:r,listener:n,delegates:{[o]:t=>{var e=this.getLayer(r)?this.queryRenderedFeatures(t.point,{layers:[r]}):[];e.length&&(t.features=e,n.call(this,t),delete t.features)}}}}on(t,e,i){if(void 0===i)return super.on(t,e);var o=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(o);for(const t in o.delegates)this.on(t,o.delegates[t]);return this}once(t,e,i){if(void 0===i)return super.once(t,e);var o=this._createDelegatedListener(t,e,i);for(const t in o.delegates)this.once(t,o.delegates[t]);return this}off(o,r,n){return void 0===n?super.off(o,r):(this._delegatedListeners&&this._delegatedListeners[o]&&(()=>{const e=this._delegatedListeners[o];for(let t=0;t<e.length;t++){const i=e[t];if(i.layer===r&&i.listener===n){for(const o in i.delegates)this.off(o,i.delegates[o]);return e.splice(t,1)}}})(),this)}queryRenderedFeatures(t,e){return this.style?(void 0!==e||void 0===t||t instanceof K.pointGeometry||Array.isArray(t)||(e=t,t=void 0),this.style.queryRenderedFeatures(t=t||[[0,0],[this.transform.width,this.transform.height]],e=e||{},this.transform)):[]}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}setStyle(t,e){return!1!==(e=K.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},e)).diff&&e.localIdeographFontFamily===this._localIdeographFontFamily&&e.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._localFontFamily=e.localFontFamily,this._updateStyle(t,e))}_getUIString(t){var e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),t&&(this.style=new De(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new De(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,i){var e;"string"==typeof t?(e=this._requestManager.normalizeStyleURL(t),e=this._requestManager.transformRequest(e,K.ResourceType.Style),K.getJSON(e,(t,e)=>{t?this.fire(new K.ErrorEvent(t)):e&&this._updateDiff(e,i)})):"object"==typeof t&&this._updateDiff(t,i)}_updateDiff(e,i){try{this.style.setState(e)&&this._update(!0)}catch(t){K.warnOnce(`Unable to perform style diff: ${t.message||t.error||t}.  Rebuilding the style from scratch.`),this._updateStyle(e,i)}}getStyle(){if(this.style&&this.style.stylesheet)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():K.warnOnce("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(t){const e=this.style&&this.style._getSourceCaches(t);if(0!==e.length)return e.every(t=>t.loaded());this.fire(new K.ErrorEvent(new Error(`There is no source with ID '${t}'`)))}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const o in t){var e=t[o]._tiles;for(const t in e){var i=e[t];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0}addSourceType(t,e,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this.style.removeSource(t),this._updateTerrain(),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(t,e,{pixelRatio:i=1,sdf:o=!1,stretchX:r,stretchY:n,content:s}={}){if(this._lazyInitEmptyStyle(),e instanceof nr||ar&&e instanceof ar){var{width:a,height:l,data:h}=K.exported.getImageData(e);this.style.addImage(t,{data:new K.RGBAImage({width:a,height:l},h),pixelRatio:i,stretchX:r,stretchY:n,content:s,sdf:o,version:0})}else{if(void 0===e.width||void 0===e.height)return this.fire(new K.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:p,height:c,data:u}=e,d=e;this.style.addImage(t,{data:new K.RGBAImage({width:p,height:c},new Uint8Array(u)),pixelRatio:i,stretchX:r,stretchY:n,content:s,sdf:o,version:0,userImage:d}),d.onAdd&&d.onAdd(this,t)}}}updateImage(t,e){const i=this.style.getImage(t);if(!i)return this.fire(new K.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var{width:o,height:r,data:n}=e instanceof nr||ar&&e instanceof ar?K.exported.getImageData(e):e;return void 0===o||void 0===r?this.fire(new K.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==i.data.width||r!==i.data.height?this.fire(new K.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(i.data.replace(n,!(e instanceof nr||ar&&e instanceof ar)),void this.style.updateImage(t,i))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new K.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t,i){K.getImage(this._requestManager.transformRequest(t,K.ResourceType.Image),(t,e)=>{i(t,e instanceof nr?K.exported.getImageData(e):e)})}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}setLayerZoomRange(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)}setFilter(t,e,i={}){return this.style.setFilter(t,e,i),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,i,o={}){return this.style.setPaintProperty(t,e,i,o),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,i,o={}){return this.style.setLayoutProperty(t,e,i,o),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(t){return this._lazyInitEmptyStyle(),this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(K.LngLat.convert(t),this.transform):0}queryTerrainElevation(t,e){const i=this.transform.elevation;return i?(e=K.extend({},{exaggerated:!0},e),i.getAtPoint(K.MercatorCoordinate.fromLngLat(t),null,e.exaggerated)):null}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_detectMissingCSS(){"rgb(250, 128, 114)"!==K.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&K.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("zmapboxgl-map"),(this._missingCSSCanary=d.create("div","zmapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=d.create("div","zmapboxgl-canvas-container",t);this._interactive&&e.classList.add("zmapboxgl-interactive"),this._canvas=d.create("canvas","zmapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);const o=this._controlContainer=d.create("div","zmapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(t=>{r[t]=d.create("div",`zmapboxgl-ctrl-${t}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e){var i=K.exported.devicePixelRatio||1;this._canvas.width=i*t,this._canvas.height=i*e,this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){t=this._markers.indexOf(t);-1!==t&&this._markers.splice(t,1)}_setupPainter(){var t=K.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);t?(K.storeAuthState(t,!0),this.painter=new ji(t,this.transform),this.on("data",t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)}),K.exported$1.testSupport(t)):this.fire(new K.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new K.Event("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new K.Event("webglcontextrestored",{originalEvent:t}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style&&(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.isMoving()&&this.loaded()?t():this._domRenderTaskQueue.add(t)}_render(e){let i;const o=this.painter.context.extTimerQuery,r=K.exported.now();this.listens("gpu-timing-frame")&&(i=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,i));let n=this._updateAverageElevation(r);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),!this._removed){let t=!1;e=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const s=this.transform.zoom,i=K.exported.now();this.style.zoomHistory.update(s,i);const o=new K.EvaluationParameters(s,{now:i,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),r=o.crossFadingFactor();1===r&&r===this._crossFadingFactor||(t=!0,this._crossFadingFactor=r),this.style.update(o)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new K.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new K.Event("load"))),this.style&&(this.style.hasTransitions()||t)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const s=K.exported.now()-r;o.endQueryEXT(o.TIME_ELAPSED_EXT,i),setTimeout(()=>{var t=o.getQueryObjectEXT(i,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(i),this.fire(new K.Event("gpu-timing-frame",{cpuTime:s,gpuTime:t}))},50)}if(this.listens("gpu-timing-layer")){const s=this.painter.collectGpuTimers();setTimeout(()=>{var t=this.painter.queryGpuTimers(s);this.fire(new K.Event("gpu-timing-layer",{layerTimes:t}))},50)}e=this._sourcesDirty||this._styleDirty||this._placementDirty||n;if(e||this._repaint)this.triggerRepaint();else{const s=!this.isMoving()&&this.loaded();if(s&&(n=this._updateAverageElevation(r,!0)),n)this.triggerRepaint();else if(this._triggerFrame(!1),s&&(this.fire(new K.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const s=this._calculateSpeedIndex();this.fire(new K.Event("speedindexcompleted",{speedIndex:s})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||e||(this._fullyLoaded=!0,this._authenticate()),this}}_updateAverageElevation(e,i=!1){var o=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&o(0);if((i||500<e-this._averageElevationLastSampledAt)&&!this._averageElevation.isEasing(e)){const r=this.transform.averageElevation;let t=this.transform.sampleAverageElevation();isNaN(t)?t=0:this._averageElevationLastSampledAt=e;i=Math.abs(r-t);if(1<i)this._averageElevation.easeTo(t,e,300);else if(1e-4<i)return this._averageElevation.jumpTo(t),o(t)}return!!this._averageElevation.isEasing(e)&&o(this._averageElevation.getValue(e))}_authenticate(){K.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===K.AUTH_ERR_MSG||401===t.status)){const t=this.painter.context.gl;K.storeAuthState(t,!1),this._logoControl instanceof $o&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new K.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),K.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const i=this.painter.context.gl,o=i.createFramebuffer();function r(t){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0);t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,o),this._canvasPixelComparison(r(t),e.canvasCopies.map(r),e.timeStamps)}_canvasPixelComparison(i,o,r){let n=r[1]-r[0];var s=i.length/4;for(let t=0;t<o.length;t++){var a=o[t];let e=0;for(let t=0;t<a.length;t+=4)a[t]===i[t]&&a[t+1]===i[t+1]&&a[t+2]===i[t+2]&&a[t+3]===i[t+3]&&(e+=1);n+=(r[t+2]-r[t+1])*(1-e/s)}return n}remove(){this._hash&&this._hash.remove();for(const K of this._controls)K.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==K.window&&(K.window.removeEventListener("resize",this._onWindowResize,!1),K.window.removeEventListener("orientationchange",this._onWindowResize,!1),K.window.removeEventListener("online",this._onWindowOnline,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),pr(this._canvasContainer),pr(this._controlContainer),pr(this._missingCSSCanary),this._container.classList.remove("zmapboxgl-map"),K.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new K.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=K.exported.frame(t=>{var e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)}))}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&((this._showCollisionBoxes=t)?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}_setCacheLimits(t,e){K.setCacheLimits(t,e)}get version(){return K.version}}function pr(t){t.parentNode&&t.parentNode.removeChild(t)}var ze=K.createCommonjsModule(function(t,e){function s(t,e,i){var o=r(256*t,256*(e=Math.pow(2,i)-e-1),i),i=r(256*(t+1),256*(e+1),i);return o[0]+","+o[1]+","+i[0]+","+i[1]}function r(t,e,i){i=2*Math.PI*6378137/256/Math.pow(2,i);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}(e=e).getURL=function(t,e,i,o,r,n){return n=n||{},t+"?"+["bbox="+s(i,o,r),"format="+(n.format||"image/png"),"service="+(n.service||"WMS"),"version="+(n.version||"1.1.1"),"request="+(n.request||"GetMap"),"srs="+(n.srs||"EPSG:3857"),"width="+(n.width||256),"height="+(n.height||256),"layers="+e].join("&")},e.getTileBBox=s,e.getMercCoords=r,Object.defineProperty(e,"__esModule",{value:!0})}),cr=K.getDefaultExportFromCjs(ze);const ur={showCompass:!0,showZoom:!0,showRotate:!0,visualizePitch:!1};class dr{constructor(t,e,i=!1){this._clickTolerance=10,this.element=e,this.mouseRotate=new xo({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,i&&(this.mousePitch=new wo({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),K.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener(e,"mousedown",this.mousedown),d.addEventListener(e,"touchstart",this.touchstart,{passive:!1}),d.addEventListener(e,"touchmove",this.touchmove),d.addEventListener(e,"touchend",this.touchend),d.addEventListener(e,"touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),d.disableDrag()}move(t,e){const i=this.map,o=this.mouseRotate.mousemoveWindow(t,e);if(o&&o.bearingDelta&&i.setBearing(i.getBearing()+o.bearingDelta),this.mousePitch){const o=this.mousePitch.mousemoveWindow(t,e);o&&o.pitchDelta&&i.setPitch(i.getPitch()+o.pitchDelta)}}off(){var t=this.element;d.removeEventListener(t,"mousedown",this.mousedown),d.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),d.removeEventListener(t,"touchmove",this.touchmove),d.removeEventListener(t,"touchend",this.touchend),d.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){d.enableDrag(),d.removeEventListener(K.window,"mousemove",this.mousemove),d.removeEventListener(K.window,"mouseup",this.mouseup)}mousedown(t){this.down(K.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),d.mousePos(this.element,t)),d.addEventListener(K.window,"mousemove",this.mousemove),d.addEventListener(K.window,"mouseup",this.mouseup)}mousemove(t){this.move(t,d.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=d.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=d.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const fr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let gr,yr=0,mr=!1;const _r={maxWidth:100,unit:"metric"};function vr(t,e,i){const o=i&&i.maxWidth||100,r=t._container.clientHeight/2,n=t.unproject([0,r]),s=t.unproject([o,r]),a=n.distanceTo(s);if(i&&"imperial"===i.unit){const i=3.2808*a;5280<i?br(e,o,i/5280,t._getUIString("ScaleControl.Miles"),t):br(e,o,i,t._getUIString("ScaleControl.Feet"),t)}else i&&"nautical"===i.unit?br(e,o,a/1852,t._getUIString("ScaleControl.NauticalMiles"),t):1e3<=a?br(e,o,a/1e3,t._getUIString("ScaleControl.Kilometers"),t):br(e,o,a,t._getUIString("ScaleControl.Meters"),t)}function br(t,e,i,o,r){const n=function(t){var e,i=Math.pow(10,`${Math.floor(t)}`.length-1);let o=t/i;return o=10<=o?10:5<=o?5:3<=o?3:2<=o?2:1<=o?1:(e=o,t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10)),Math.round(e*t)/t),i*o}(i),s=n/i;r._requestDomTask(()=>{t.style.width=e*s+"px",t.innerHTML=`${n}&nbsp;${o}`})}const xr={},wr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Mr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");const Pr={version:K.version,supported:e,setRTLTextPlugin:K.setRTLTextPlugin,getRTLTextPluginStatus:K.getRTLTextPluginStatus,Map:hr,FreeCRSMap:class extends hr{constructor(t){super(t)}initMapCRS(o){var r,n,t,e;this._tileExtent=[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892],o.mapCRS&&(this._mapCRS=o.mapCRS,o.mapCRS.coordtransform&&"default"!=o.mapCRS.coordtransform)&&(o.mapCRS.topTileExtent&&Array.isArray(o.mapCRS.topTileExtent)&&4===o.mapCRS.topTileExtent.length&&(this._tileExtent[0]=o.mapCRS.topTileExtent[0],this._tileExtent[1]=o.mapCRS.topTileExtent[1],this._tileExtent[2]=o.mapCRS.topTileExtent[2],this._tileExtent[3]=o.mapCRS.topTileExtent[3]),r=this._tileExtent[2]-this._tileExtent[0],n=this._tileExtent[3]-this._tileExtent[1],cr.getTileBBox=function(t,e,i){i=Math.pow(2,i);return o.mapCRS.topTileExtent[0]+r*t/i+","+(o.mapCRS.topTileExtent[1]+n*(e=i-e-1)/i)+","+(o.mapCRS.topTileExtent[0]+r*(t+1)/i)+","+(o.mapCRS.topTileExtent[1]+n*(e+1)/i)},e=!0,(e="none"!=o.mapCRS.coordtransform&&"function"==typeof o.mapCRS.coordtransform.toViewCoord&&"function"==typeof o.mapCRS.coordtransform.fromViewCoord&&e)?(t=o.mapCRS.coordtransform.toViewCoord(this._tileExtent[0],this._tileExtent[1]),e=o.mapCRS.coordtransform.toViewCoord(this._tileExtent[2],this._tileExtent[3]),this.transform.latRange=[t[1],e[1]],this.transform.lngRange=[t[0],e[0]],this._transformCRS([this._tileExtent[0],this._tileExtent[1],this._tileExtent[2],this._tileExtent[3]],[t[0],t[1],e[0],e[1]],o.style,o.mapCRS.coordtransform.toViewCoord,o.mapCRS.coordtransform.fromViewCoord)):(this.transform.latRange=[this._tileExtent[1],this._tileExtent[3]],this.transform.lngRange=[this._tileExtent[0],this._tileExtent[2]],this._uniformCRS([this._tileExtent[0],this._tileExtent[1],this._tileExtent[2],this._tileExtent[3]],o.style)))}_uniformCRS(i,t){var o=i[2]-i[0],r=i[3]-i[1],e=(i[2]+i[0])/2,n=(i[3]+i[1])/2;$i.prototype.lngX=function(t,e){return(t-i[0])*(e||this.worldSize)/o},$i.prototype.latY=function(t,e){return(i[3]-t)*(e||this.worldSize)/r},$i.prototype.xLng=function(t,e){return t*o/(e||this.worldSize)+i[0]},$i.prototype.yLat=function(t,e){return i[3]-t*r/(e||this.worldSize)};var n=new Blob(["function customprojection(p) {var  x = ((p[0]-"+e+") / "+o+" + 0.5),y = 0.5 - ((p[1]- "+n+") / "+r+");y = y < 0 ? 0 : y > 1 ? 1 : y;return [x, y, 0];}"]),s=window.URL.createObjectURL(n);if(t&&t.sources)for(var a in t.sources)t.sources[a]&&"geojson"==t.sources[a].type&&(t.sources[a].data.customprj=s);this._geojson_customprj=s}_transformCRS(i,t,e,o,r){var n=i[2]-i[0],s=i[3]-i[1],a=(i[2]+i[0])/2,l=(i[3]+i[1])/2;$i.prototype.lngX=function(t,e){return(r(t,0)[0]-i[0])*(e||this.worldSize)/n},$i.prototype.latY=function(t,e){t=r(0,t);return(i[3]-t[1])*(e||this.worldSize)/s},$i.prototype.xLng=function(t,e){return o(t*n/(e||this.worldSize)+i[0],0)[0]},$i.prototype.yLat=function(t,e){return o(0,i[3]-t*s/(e||this.worldSize))[1]};var h="function fromViewCoord"+(h=r.toString(0)).substring(8),l=new Blob([h+"  function customprojection(p) {var pp = fromViewCoord(p[0],p[1]); var  x = ((pp[0]-"+a+") / "+n+" + 0.5),y = 0.5 - ((pp[1]- "+l+") / "+s+");y = y < 0 ? 0 : y > 1 ? 1 : y;return [x, y, 0];}"]),p=window.URL.createObjectURL(l);if(e&&e.sources)for(var c in e.sources)e.sources[c]&&"geojson"==e.sources[c].type&&(e.sources[c].data.customprj=p);this._geojson_customprj=p}addSource(t,e){return this._mapCRS&&e&&"geojson"==e.type&&e.data&&!e.data.customprj&&(e.data.customprj=this._geojson_customprj),this.style.addSource(t,e),this._update(!0),this}},NavigationControl:class{constructor(t){this.options=K.extend({},ur,t),this._container=d.create("div","zmapboxgl-ctrl zmapboxgl-ctrl-group"),this._resetContainer=d.create("div","zmapboxgl-ctrl-resetContainer"),this._rotateContainerChild=d.create("div","zmapboxgl-ctrl-rotateContainer-child"),this._rotateContainerChild.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/earth-navi-control-pc4.png) 0% 0% / 266px no-repeat",this._rotateContainer=d.create("div","zmapboxgl-ctrl-rotateContainer"),this._rotateContainer.appendChild(this._rotateContainerChild),this._rotateContainer.appendChild(this._resetContainer),this._container.appendChild(this._rotateContainer),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showRotate&&(this._Counterclockwise=this._createRotateButton("zmapboxgl-ctrl-icon zmapboxgl-ctrl-counterclockwise","counterclockwise",()=>{var t=this._map.getBearing();this._map.rotateTo(t+90)}),this._Counterclockwise.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/earth-navi-control-pc4.png) -75px -5px / 266px no-repeat",this._DirectNorth=this._createRotateButton("zmapboxgl-ctrl-icon zmapboxgl-ctrl-directnorth","directnorth ",()=>this._map.resetNorth()),this._DirectNorth.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/earth-navi-control-pc4.png) -56px -4px / 266px no-repeat",K.bindAll(["_rotateCompassArrow"],this),this._Clockwise=this._createRotateButton("zmapboxgl-ctrl-icon zmapboxgl-ctrl-clockwise","clockwise",()=>{var t=this._map.getBearing();this._map.rotateTo(t-90)}),this._Clockwise.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/earth-navi-control-pc4.png) -75px -5px / 266px no-repeat",this._Reset=this._createResetButton("zmapboxgl-ctrl-icon zmapboxgl-ctrl-reset","reset",()=>{var t=this._map._defaultCenter;this._map.flyTo({center:[t[0],t[1]],zoom:this._map._defaultZoom,bearing:0,pitch:0})}),this._Reset.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/reset.png) -28px 0px no-repeat rgb(255, 255, 255)",this._2DTo3D=this._createRotateButton("zmapboxgl-ctrl-icon zmapboxgl-ctrl-2DTo3D","2DTo3D",()=>{0==this._map.getPitch()?(this._map.flyTo({pitch:60}),this._2DTo3D.classList.remove("zmapboxgl-ctrl-2DTo3D"),this._2DTo3D.classList.add("zmapboxgl-ctrl-3DTo2D"),this._2DTo3D.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/gl-navi-control-pc4.png) -186px 2px / 266px no-repeat rgb(255, 255, 255)"):(this._map.flyTo({pitch:0}),this._2DTo3D.classList.remove("zmapboxgl-ctrl-3DTo2D"),this._2DTo3D.classList.add("zmapboxgl-ctrl-2DTo3D"),this._2DTo3D.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/gl-navi-control-pc4.png) -108px 2px / 266px no-repeat rgb(255, 255, 255)")}),this._2DTo3D.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/gl-navi-control-pc4.png) -108px 2px / 266px no-repeat rgb(255, 255, 255)",K.bindAll(["_pitchChange"],this)),this.options.showZoom&&(K.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("zmapboxgl-ctrl-icon zmapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),d.create("span","zmapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("zmapboxgl-ctrl-icon zmapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),d.create("span","zmapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0))}_updateZoomButtons(){const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),i=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){var t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._DirectNorth.style.transform=t}_pitchChange(t){0==this._map.getPitch()?(this._2DTo3D.classList.remove("zmapboxgl-ctrl-3DTo2D"),this._2DTo3D.classList.add("zmapboxgl-ctrl-2DTo3D"),this._2DTo3D.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/gl-navi-control-pc4.png) -108px 2px / 266px no-repeat rgb(255, 255, 255)"):(this._2DTo3D.classList.remove("zmapboxgl-ctrl-2DTo3D"),this._2DTo3D.classList.add("zmapboxgl-ctrl-3DTo2D"),this._2DTo3D.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/gl-navi-control-pc4.png) -186px 2px / 266px no-repeat rgb(255, 255, 255)")}onAdd(t){return this._map=t,this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this.options.showRotate&&(this._map.on("pitch",this._pitchChange),this._pitchChange(this._map),this._handler=new dr(this._map,this._2DTo3D,this.options.visualizePitch)),this._container}onRemove(){d.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const i=d.create("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}_createRotateButton(t,e,i){const o=d.create("button",t,this._rotateContainerChild);return o.type="button",o.setAttribute("aria-label",e),o.addEventListener("click",i),o}_createResetButton(t,e,i){const o=d.create("button",t,this._resetContainer);return o.type="button",o.setAttribute("aria-label",e),o.addEventListener("click",i),o}_setButtonTitle(t,e){e=this._map._getUIString(`NavigationControl.${e}`);t.title=e,t.setAttribute("aria-label",e)}},GeolocateControl:class extends K.Evented{constructor(t){super(),this.options=K.extend({},fr,t),K.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(t){var e;return this._map=t,this._container=d.create("div","zmapboxgl-ctrl zmapboxgl-ctrl-group"),e=this._setupUI,void 0!==gr?e(gr):void 0!==K.window.navigator.permissions?K.window.navigator.permissions.query({name:"geolocation"}).then(t=>{gr="denied"!==t.state,e(gr)}):(gr=!!K.window.navigator.geolocation,e(gr)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(K.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),d.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,yr=0,mr=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new K.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("zmapboxgl-user-location-dot-stale"),this.fire(new K.Event("geolocate",t)),this._finish()}}_updateCamera(t){const e=new K.LngLat(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,o=this._map.getBearing(),r=K.extend({bearing:o},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(i),r,{geolocateSource:!0})}_updateMarker(t){var e;t?(e=new K.LngLat(t.coords.longitude,t.coords.latitude),this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()):(this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove())}_updateCircleRadius(){const t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),i=this._map.unproject([100,t]),o=e.distanceTo(i)/100,r=Math.ceil(2*this._accuracy/o);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const K=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=K,this._geolocateButton.setAttribute("aria-label",K),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&mr)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("zmapboxgl-user-location-dot-stale"),this.fire(new K.Event("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=d.create("button","zmapboxgl-ctrl-geolocate",this._container),d.create("span","zmapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),!(this._geolocateButton.type="button")===t){K.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const K=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=K,this._geolocateButton.setAttribute("aria-label",K)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=d.create("div","zmapboxgl-user-location-dot"),this._userLocationDotMarker=new ir(this._dotElement),this._circleElement=d.create("div","zmapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ir({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-active"),this.fire(new K.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return K.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new K.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yr--,mr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-background-error"),this.fire(new K.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new K.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("zmapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),yr++,mr=1<yr?(t={maximumAge:6e5,timeout:0},!0):(t=this.options.positionOptions,!1),this._geolocationWatchID=K.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else K.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){K.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("zmapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xo,ScaleControl:class{constructor(t){this.options=K.extend({},_r,t),K.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){vr(this._map,this._container,this.options)}onAdd(t){return this._map=t,this._container=d.create("div","zmapboxgl-ctrl zmapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){d.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(t){this.options.unit=t,vr(this._map,this._container,this.options)}},MouseControl:class{constructor(){this._container=d.create("div","zmapboxgl-ctrl-mouse"),this._container.style.webkitTextFillColor="#8e8c90",this._container.style.color="#8e8c90"}getDefaultPosition(){return"bottom-right"}_toDecimal(t,e){var i=parseFloat(t);if(isNaN(i))return!1;var o=t.toString();0<o.indexOf(".")&&(i=o.split(".")[1].substring(0,e),o=o.split(".")[0]+"."+i);var r=o.indexOf(".");for(r<0&&(r=o.length,o+=".");o.length<=r+e;)o+="0";return o}onAdd(t){return this._map=t,this._map.on("mousemove",t=>{this._container.innerText="lon: "+this._toDecimal(t.lngLat.lng,8)+", lat: "+this._toDecimal(t.lngLat.lat,8)}),this._container}onRemove(){d.remove(this._container),delete this._map}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof K.window.HTMLElement?this._container=t.container:K.warnOnce("Full screen control 'container' must be a DOM element.")),K.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in K.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in K.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=d.create("div","zmapboxgl-ctrl zmapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",K.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){d.remove(this._controlContainer),this._map=null,K.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!K.window.document.fullscreenEnabled&&!K.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=d.create("button","zmapboxgl-ctrl-fullscreen",this._controlContainer);d.create("span","zmapboxgl-ctrl-icon",t).setAttribute("aria-hidden",!0),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),K.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(K.window.document.fullscreenElement||K.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("zmapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("zmapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?K.window.document.exitFullscreen?K.window.document.exitFullscreen():K.window.document.webkitCancelFullScreen&&K.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},NorthControl:class{constructor(t){this.options=K.extend({},xr,t),this._container=d.create("div","zmapboxgl-ctrl-north"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._DirectNorth=this._createRotateButton("zmapboxgl-ctrl-north zmapboxgl-ctrl-direcToNorth","directnorth ",()=>this._map.resetNorth()),this._DirectNorth.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/north.png) no-repeat",K.bindAll(["_rotateCompassArrow"],this)}_rotateCompassArrow(){var t=`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._DirectNorth.style.transform=t}getDefaultPosition(){return"top-left"}onAdd(t){return this._map=t,this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._container}onRemove(){d.remove(this._container),this._map.off("rotate",this._rotateCompassArrow),delete this._map}_createRotateButton(t,e,i){const o=d.create("button",t,this._container);return o.type="button",o.setAttribute("aria-label",e),o.addEventListener("click",i),o}},LogoControl:$o,Popup:class extends K.Evented{constructor(t){super(),this.options=K.extend(Object.create(wr),t),K.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("zmapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("zmapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new K.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&d.remove(this._content),this._container&&(d.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new K.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=K.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("zmapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("zmapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("zmapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("zmapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(K.window.document.createTextNode(t))}setHTML(t){const e=K.window.document.createDocumentFragment(),i=K.window.document.createElement("body");var o;for(i.innerHTML=t;o=i.firstChild;)e.appendChild(o);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=d.create("div","zmapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){this._container&&this._container.classList.add(t)}removeClassName(t){this._container&&this._container.classList.remove(t)}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}_createCloseButton(){this.options.closeButton&&(this._closeButton=d.create("button","zmapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(t){this._update(t.point)}_onMouseMove(t){this._update(t.point)}_onDrag(t){this._update(t.point)}_update(i){if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=d.create("div","zmapboxgl-popup",this._map.getContainer()),this._tip=d.create("div","zmapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(t=>this._container.classList.add(t)),this._trackPointer&&this._container.classList.add("zmapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qo(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||i)){const o=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);let e=this.options.anchor;i=function t(e){if(e){if("number"!=typeof e)return e instanceof K.pointGeometry||Array.isArray(e)?{center:i=K.pointGeometry.convert(e),top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}:{center:K.pointGeometry.convert(e.center||[0,0]),top:K.pointGeometry.convert(e.top||[0,0]),"top-left":K.pointGeometry.convert(e["top-left"]||[0,0]),"top-right":K.pointGeometry.convert(e["top-right"]||[0,0]),bottom:K.pointGeometry.convert(e.bottom||[0,0]),"bottom-left":K.pointGeometry.convert(e["bottom-left"]||[0,0]),"bottom-right":K.pointGeometry.convert(e["bottom-right"]||[0,0]),left:K.pointGeometry.convert(e.left||[0,0]),right:K.pointGeometry.convert(e.right||[0,0])};var i=Math.round(Math.sqrt(.5*Math.pow(e,2)));return{center:new K.pointGeometry(0,0),top:new K.pointGeometry(0,e),"top-left":new K.pointGeometry(i,i),"top-right":new K.pointGeometry(-i,i),bottom:new K.pointGeometry(0,-e),"bottom-left":new K.pointGeometry(i,-i),"bottom-right":new K.pointGeometry(-i,-i),left:new K.pointGeometry(e,0),right:new K.pointGeometry(-e,0)}}return t(new K.pointGeometry(0,0))}(this.options.offset);if(!e){const n=this._container.offsetWidth,r=this._container.offsetHeight;let t;t=o.y+i.bottom.y<r?["top"]:o.y>this._map.transform.height-r?["bottom"]:[],o.x<n/2?t.push("left"):o.x>this._map.transform.width-n/2&&t.push("right"),e=0===t.length?"bottom":t.join("-")}const r=o.add(i[e]).round();this._map._requestDomTask(()=>{this._container&&e&&(d.setTransform(this._container,`${tr[e]} translate(${r.x}px,${r.y}px)`),er(this._container,e,"popup"))})}}_focusFirstElement(){if(this.options.focusAfterOpen&&this._container){const t=this._container.querySelector(Mr);t&&t.focus()}}_onClose(){this.remove()}_setOpacity(t){this._content&&(this._content.style.opacity=t),this._tip&&(this._tip.style.opacity=t)}},Marker:ir,Style:De,LngLat:K.LngLat,LngLatBounds:K.LngLatBounds,Point:K.pointGeometry,MercatorCoordinate:K.MercatorCoordinate,FreeCameraOptions:Xi,Evented:K.Evented,config:K.config,prewarm:function(){Ot().acquire(Ct)},clearPrewarmedResources:function(){const t=Lt;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Ct),Lt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return K.config.ACCESS_TOKEN},set accessToken(t){K.config.ACCESS_TOKEN=t},get baseApiUrl(){return K.config.API_URL},set baseApiUrl(t){K.config.API_URL=t},get workerCount(){return It.workerCount},set workerCount(t){It.workerCount=t},get maxParallelImageRequests(){return K.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){K.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){K.clearTileCache(t)},workerUrl:"",workerClass:null,setNow:K.exported.setNow,restoreNow:K.exported.restoreNow};return Pr}),s}),function(){function t(t){Object.assign(this.options,t),this._ticking=!1,this._lastMouseMoveEvent=null,this._parentMap=null,this._isDragging=!1,this._isCursorOverFeature=!1,this._previousPoint=[0,0],this._currentPoint=[0,0],this._trackingRectCoordinates=[[[],[],[],[],[]]]}(t.prototype=Object.assign({},zmapboxgl.NavigationControl.prototype,{options:{id:"zmapboxgl-minimap",width:"320px",height:"180px",style:"mapbox://styles/mapbox/streets-v8",center:[0,0],zoom:6,zoomAdjust:null,zoomLevels:[[18,13,15],[15,11,13],[12,9,11],[11,7,9]],lineColor:"#08F",lineWidth:1,lineOpacity:1,fillColor:"#F80",fillOpacity:.25,dragPan:!1,scrollZoom:!1,boxZoom:!1,dragRotate:!1,keyboard:!1,doubleClickZoom:!1,touchZoomRotate:!1}})).onAdd=function(t){this._parentMap=t;var e=this.options,i=this._container=this._createContainer(t),t=this._miniMap=new zmapboxgl.Map({attributionControl:!1,container:i,style:t.getStyle(),zoom:e.zoom,center:e.center});return e.maxBounds&&t.setMaxBounds(e.maxBounds),this._isOpen||this.setVisible(!1),t.on("load",this._load.bind(this)),this._container},t.prototype.onRemove=function(){this._eventsHandler(!0),this._close(),delete this._parentMap},t.prototype._load=function(){var e=this.options,i=(this._parentMap,this._miniMap);["dragPan","scrollZoom","boxZoom","dragRotate","keyboard","doubleClickZoom","touchZoomRotate"].forEach(function(t){!0!==e[t]&&i[t].disable()}),"function"==typeof e.zoomAdjust?this.options.zoomAdjust=e.zoomAdjust.bind(this):null===e.zoomAdjust&&(this.options.zoomAdjust=this._zoomAdjust.bind(this));var t=i.getBounds();this._convertBoundsToPoints(t),i.addSource("trackingRect",{type:"geojson",data:{type:"Feature",properties:{name:"trackingRect"},geometry:{type:"Polygon",coordinates:this._trackingRectCoordinates}}}),i.addLayer({id:"trackingRectOutline",type:"line",source:"trackingRect",layout:{},paint:{"line-color":e.lineColor,"line-width":e.lineWidth,"line-opacity":e.lineOpacity}}),i.addLayer({id:"trackingRectFill",type:"fill",source:"trackingRect",layout:{},paint:{"fill-color":e.fillColor,"fill-opacity":e.fillOpacity}}),this._trackingRect=this._miniMap.getSource("trackingRect"),this._update(),this._eventsHandler(),i.on("mousemove",this._mouseMove.bind(this)),i.on("mousedown",this._mouseDown.bind(this)),i.on("mouseup",this._mouseUp.bind(this)),i.on("touchmove",this._mouseMove.bind(this)),i.on("touchstart",this._mouseDown.bind(this)),i.on("touchend",this._mouseUp.bind(this)),this._miniMapCanvas=i.getCanvasContainer(),this._miniMapCanvas.addEventListener("wheel",this._preventDefault),this._miniMapCanvas.addEventListener("mousewheel",this._preventDefault)},t.prototype._eventsHandler=function(t){this.updateFun||((that=this).updateFun=function(){that._update()}),t?this._parentMap.off("move",this.updateFun):this._parentMap.on("move",this.updateFun)},t.prototype._mouseDown=function(t){this._isCursorOverFeature&&(this._isDragging=!0,this._previousPoint=this._currentPoint,this._currentPoint=[t.lngLat.lng,t.lngLat.lat])},t.prototype._mouseMove=function(t){this._ticking=!1;var e=this._miniMap.queryRenderedFeatures(t.point,{layers:["trackingRectFill"]});this._isCursorOverFeature&&0<e.length||(this._isCursorOverFeature=0<e.length,this._miniMapCanvas.style.cursor=this._isCursorOverFeature?"move":""),this._isDragging&&(this._previousPoint=this._currentPoint,this._currentPoint=[t.lngLat.lng,t.lngLat.lat],t=[this._previousPoint[0]-this._currentPoint[0],this._previousPoint[1]-this._currentPoint[1]],t=this._moveTrackingRect(t),this._parentMap.jumpTo({center:t.getCenter()}))},t.prototype._mouseUp=function(){this._isDragging=!1,this._ticking=!1},t.prototype._moveTrackingRect=function(t){var e=this._trackingRect,i=e._data,o=i.properties.bounds;return o._ne.lat-=t[1],o._ne.lng-=t[0],o._sw.lat-=t[1],o._sw.lng-=t[0],this._convertBoundsToPoints(o),e.setData(i),o},t.prototype._setTrackingRectBounds=function(t){var e=this._trackingRect,i=e._data;i.properties.bounds=t,this._convertBoundsToPoints(t),e.setData(i)},t.prototype._convertBoundsToPoints=function(t){var e=t._ne,i=t._sw,t=this._trackingRectCoordinates;t[0][0][0]=e.lng,t[0][0][1]=e.lat,t[0][1][0]=i.lng,t[0][1][1]=e.lat,t[0][2][0]=i.lng,t[0][2][1]=i.lat,t[0][3][0]=e.lng,t[0][3][1]=i.lat,t[0][4][0]=e.lng,t[0][4][1]=e.lat},t.prototype._update=function(t){var e;this._isDragging||(e=this._parentMap.getBounds(),this._setTrackingRectBounds(e),this._zoomAdjust())},t.prototype._zoomAdjust=function(){var e=this._miniMap,i=this._parentMap,o=parseInt(e.getZoom(),10),r=parseInt(i.getZoom(),10),t=this.options.zoomLevels,n=!1;t.forEach(function(t){!n&&r>=t[0]&&(o>=t[1]&&e.setZoom(t[2]),e.setCenter(i.getCenter()),n=!0)}),n||o===this.options.zoom||("object"==typeof this.options.bounds&&e.fitBounds(this.options.bounds,{duration:50}),e.setZoom(this.options.zoom))},t.prototype._createContainer=function(t){var e=this.options,i=document.createElement("div");i.className="zmapboxgl-ctrl-minimap zmapboxgl-ctrl",i.setAttribute("style","width: "+e.width+"; height: "+e.height+"; margin:auto; border:1px solid #212121"),i.addEventListener("contextmenu",this._preventDefault),t.getContainer().appendChild(i);var o=this._showControl=document.createElement("div");o.className="zmapboxgl-ctrl-showControl",o.setAttribute("style","position: absolute; right:0px;width: 14px; height: 14px;right: 0px;bottom: 0px;z-index: 99999");var r=this._showControlImg=document.createElement("img");r.className="zmapboxgl-ctrl-showControl-show",r.setAttribute("style","position: relative;width: 14px; height: 14px;"),r.setAttribute("src",ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/OverViewSlipOut.png"),o.appendChild(r);var n=this;return o.addEventListener("click",function(){"zmapboxgl-ctrl-showControl-show"==r.className?n.setVisible(!1):n.setVisible(!0)}),t.getContainer().appendChild(o),""!==e.id&&(i.id=e.id),i},t.prototype.setVisible=function(t){t?(this._container.style.display="block",this._showControlImg.src=ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/OverViewSlipOut.png",this._showControlImg.className="zmapboxgl-ctrl-showControl-show"):(this._container.style.display="none",this._showControlImg.src=ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/OverViewSlipIn.png",this._showControlImg.className="zmapboxgl-ctrl-showControl-hide"),this.viewChangeHandler(t)},t.prototype._close=function(){this._miniMap.remove(),this._container.remove(),this._showControl.remove()},t.prototype._preventDefault=function(t){t.preventDefault()},zmapboxgl.Minimap=t}();var COMPILED=!1,goog=goog||{};goog.global=this,goog.global.CLOSURE_UNCOMPILED_DEFINES,goog.global.CLOSURE_DEFINES,goog.isDef=function(t){return void 0!==t},goog.exportPath_=function(t,e,i){var o,r=t.split("."),n=i||goog.global;r[0]in n||!n.execScript||n.execScript("var "+r[0]);for(;r.length&&(o=r.shift());)!r.length&&goog.isDef(e)?n[o]=e:n=n[o]||(n[o]={})},goog.define=function(t,e){COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,t)?e=goog.global.CLOSURE_UNCOMPILED_DEFINES[t]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,t)&&(e=goog.global.CLOSURE_DEFINES[t])),goog.exportPath_(t,e)},goog.DEBUG=!0,goog.define("goog.LOCALE","en"),goog.define("goog.TRUSTED_SITE",!0),goog.define("goog.STRICT_MODE_COMPATIBLE",!1),goog.provide=function(t){if(!COMPILED&&goog.isProvided_(t))throw Error('Namespace "'+t+'" already declared.');goog.constructNamespace_(t)},goog.constructNamespace_=function(t,e){if(!COMPILED){delete goog.implicitNamespaces_[t];for(var i=t;(i=i.substring(0,i.lastIndexOf(".")))&&!goog.getObjectByName(i);)goog.implicitNamespaces_[i]=!0}goog.exportPath_(t,e)},goog.module=function(t){if(!goog.isString(t)||!t)throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+t+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");if(goog.moduleLoaderState_.moduleName=t,!COMPILED){if(goog.isProvided_(t))throw Error('Namespace "'+t+'" already declared.');delete goog.implicitNamespaces_[t]}},goog.module.get=function(t){return goog.module.getInternal_(t)},goog.module.getInternal_=function(t){return COMPILED?void 0:goog.isProvided_(t)?t in goog.loadedModules_?goog.loadedModules_[t]:goog.getObjectByName(t):null},goog.moduleLoaderState_=null,goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_},goog.module.declareTestMethods=function(){if(!goog.isInModuleLoader_())throw new Error("goog.module.declareTestMethods must be called from within a goog.module");goog.moduleLoaderState_.declareTestMethods=!0},goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw new Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0},goog.setTestOnly=function(t){if(COMPILED&&!goog.DEBUG)throw t=t||"",Error("Importing test-only code into non-debug environment"+(t?": "+t:"."))},goog.forwardDeclare=function(t){},COMPILED||(goog.isProvided_=function(t){return t in goog.loadedModules_||!goog.implicitNamespaces_[t]&&goog.isDefAndNotNull(goog.getObjectByName(t))},goog.implicitNamespaces_={"goog.module":!0}),goog.getObjectByName=function(t,e){for(var i,o=t.split("."),r=e||goog.global;i=o.shift();){if(!goog.isDefAndNotNull(r[i]))return null;r=r[i]}return r},goog.globalize=function(t,e){var i,o=e||goog.global;for(i in t)o[i]=t[i]},goog.addDependency=function(t,e,i,o){if(goog.DEPENDENCIES_ENABLED){for(var r,n,s=t.replace(/\\/g,"/"),a=goog.dependencies_,l=0;r=e[l];l++)a.nameToPath[r]=s,a.pathIsModule[s]=!!o;for(var h=0;n=i[h];h++)s in a.requires||(a.requires[s]={}),a.requires[s][n]=!0}},goog.define("goog.ENABLE_DEBUG_LOADER",!0),goog.logToConsole_=function(t){goog.global.console&&goog.global.console.error(t)},goog.require=function(t){if(!COMPILED){if(goog.isProvided_(t))return goog.isInModuleLoader_()?goog.module.getInternal_(t):null;if(goog.ENABLE_DEBUG_LOADER){var e=goog.getPathFromDeps_(t);if(e)return goog.included_[e]=!0,goog.writeScripts_(),null}t="goog.require could not find: "+t;throw goog.logToConsole_(t),Error(t)}},goog.basePath="",goog.global.CLOSURE_BASE_PATH,goog.global.CLOSURE_NO_DEPS,goog.global.CLOSURE_IMPORT_SCRIPT,goog.nullFunction=function(){},goog.identityFunction=function(t,e){return t},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(t){t.getInstance=function(){return t.instance_||(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=t),t.instance_=new t)}},goog.instantiatedSingletons_=[],goog.define("goog.LOAD_MODULE_USING_EVAL",!0),goog.define("goog.SEAL_MODULE_EXPORTS",goog.DEBUG),goog.loadedModules_={},goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var t=goog.global.document;return void 0!==t&&"write"in t},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var t=goog.global.document.getElementsByTagName("script"),e=t.length-1;0<=e;--e){var i=t[e].src,o=i.lastIndexOf("?"),o=-1==o?i.length:o;if("base.js"==i.substr(o-7,7))return void(goog.basePath=i.substr(0,o-7))}},goog.importScript_=function(t,e){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(t,e)&&(goog.dependencies_.written[t]=!0)},goog.IS_OLD_IE_=goog.global.document&&goog.global.document.all&&!goog.global.atob,goog.importModule_=function(t){goog.importScript_("",'goog.retrieveAndExecModule_("'+t+'");')&&(goog.dependencies_.written[t]=!0)},goog.queuedModules_=[],goog.retrieveAndExecModule_=function(t){for(var e;-1!=(e=t.indexOf("/./"));)t=t.substr(0,e)+t.substr(e+"/.".length);for(;-1!=(e=t.indexOf("/../"));){var i=t.lastIndexOf("/",e-1);t=t.substr(0,i)+t.substr(e+"/..".length)}var o=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,r=null,n=new goog.global.XMLHttpRequest;if(n.onload=function(){r=this.responseText},n.open("get",t,!1),n.send(),null==(r=n.responseText))throw new Error("load of "+t+"failed");n=goog.wrapModule_(t,r);goog.IS_OLD_IE_?goog.queuedModules_.push(n):o(t,n),goog.dependencies_.written[t]=!0},goog.wrapModule_=function(t,e){return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(e+"\n//# sourceURL="+t+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+e+"\n;return exports});\n//# sourceURL="+t+"\n"},goog.loadQueuedModules_=function(){var t=goog.queuedModules_.length;if(0<t){var e=goog.queuedModules_;goog.queuedModules_=[];for(var i=0;i<t;i++){var o=e[i];goog.globalEval(o)}}},goog.loadModule=function(t){try{var e;if(goog.moduleLoaderState_={moduleName:void 0,declareTestMethods:!1},goog.isFunction(t))e=t.call(goog.global,{});else{if(!goog.isString(t))throw Error("Invalid module definition");e=goog.loadModuleFromSource_.call(goog.global,t)}var i=goog.moduleLoaderState_.moduleName;if(!goog.isString(i)||!i)throw Error('Invalid module name "'+i+'"');if(goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(i,e):goog.SEAL_MODULE_EXPORTS&&Object.seal&&Object.seal(e),goog.loadedModules_[i]=e,goog.moduleLoaderState_.declareTestMethods)for(var o in e)0!==o.indexOf("test",0)&&"tearDown"!=o&&"setup"!=o||(goog.global[o]=e[o])}finally{goog.moduleLoaderState_=null}},goog.loadModuleFromSource_=function(){"use strict";var exports={};return eval(arguments[0]),exports},goog.writeScriptTag_=function(t,e){if(goog.inHtmlDocument_()){var i=goog.global.document;if("complete"==i.readyState){if(/\bdeps.js$/.test(t))return!1;throw Error('Cannot write "'+t+'" after document load')}var o=goog.IS_OLD_IE_;return void 0===e?o?(o=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ",i.write('<script type="text/javascript" src="'+t+'"'+o+"><\/script>")):i.write('<script type="text/javascript" src="'+t+'"><\/script>'):i.write('<script type="text/javascript">'+e+"<\/script>"),!0}return!1},goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(t,e){return"complete"==t.readyState&&goog.lastNonModuleScriptIndex_==e&&goog.loadQueuedModules_(),!0},goog.writeScripts_=function(){var o=[],r={},n=goog.dependencies_;for(e in goog.included_)n.written[e]||function t(e){if(!(e in n.written)){if(e in n.visited)return e in r||(r[e]=!0,o.push(e)),0;if(n.visited[e]=!0,e in n.requires)for(var i in n.requires[e])if(!goog.isProvided_(i)){if(!(i in n.nameToPath))throw Error("Undefined nameToPath for "+i);t(n.nameToPath[i])}e in r||(r[e]=!0,o.push(e))}}(e);for(var t=0;t<o.length;t++){var e=o[t];goog.dependencies_.written[e]=!0}var i=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(t=0;t<o.length;t++){if(!(e=o[t]))throw goog.moduleLoaderState_=i,Error("Undefined script input");n.pathIsModule[e]?goog.importModule_(goog.basePath+e):goog.importScript_(goog.basePath+e)}goog.moduleLoaderState_=i},goog.getPathFromDeps_=function(t){return t in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[t]:null},goog.findBasePath_()),goog.typeOf=function(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var i=Object.prototype.toString.call(t);if("[object Window]"==i)return"object";if("[object Array]"==i||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==i||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e},goog.isNull=function(t){return null===t},goog.isDefAndNotNull=function(t){return null!=t},goog.isArray=function(t){return"array"==goog.typeOf(t)},goog.isArrayLike=function(t){var e=goog.typeOf(t);return"array"==e||"object"==e&&"number"==typeof t.length},goog.isDateLike=function(t){return goog.isObject(t)&&"function"==typeof t.getFullYear},goog.isString=function(t){return"string"==typeof t},goog.isBoolean=function(t){return"boolean"==typeof t},goog.isNumber=function(t){return"number"==typeof t},goog.isFunction=function(t){return"function"==goog.typeOf(t)},goog.isObject=function(t){var e=typeof t;return"object"==e&&null!=t||"function"==e},goog.getUid=function(t){return t[goog.UID_PROPERTY_]||(t[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(t){return!!t[goog.UID_PROPERTY_]},goog.removeUid=function(t){"removeAttribute"in t&&t.removeAttribute(goog.UID_PROPERTY_);try{delete t[goog.UID_PROPERTY_]}catch(t){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(t){var e=goog.typeOf(t);if("object"!=e&&"array"!=e)return t;if(t.clone)return t.clone();var i,o="array"==e?[]:{};for(i in t)o[i]=goog.cloneObject(t[i]);return o},goog.bindNative_=function(t,e,i){return t.call.apply(t.bind,arguments)},goog.bindJs_=function(e,i,t){if(!e)throw new Error;if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,o),e.apply(i,t)}}return function(){return e.apply(i,arguments)}},goog.bind=function(t,e,i){return Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(e,t){var i=Array.prototype.slice.call(arguments,1);return function(){var t=i.slice();return t.push.apply(t,arguments),e.apply(this,t)}},goog.mixin=function(t,e){for(var i in e)t[i]=e[i]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(t){if(goog.global.execScript)goog.global.execScript(t,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");var e,i;null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),void 0!==goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_?goog.global.eval(t):((i=(e=goog.global.document).createElement("script")).type="text/javascript",i.defer=!1,i.appendChild(e.createTextNode(t)),e.body.appendChild(i),e.body.removeChild(i))}},goog.evalWorksForGlobals_=null,goog.cssNameMapping_,goog.cssNameMappingStyle_,goog.getCssName=function(t,e){function r(t){return goog.cssNameMapping_[t]||t}var i=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?r:function(t){for(var e=t.split("-"),i=[],o=0;o<e.length;o++)i.push(r(e[o]));return i.join("-")}:function(t){return t};return e?t+"-"+i(e):i(t)},goog.setCssNameMapping=function(t,e){goog.cssNameMapping_=t,goog.cssNameMappingStyle_=e},goog.global.CLOSURE_CSS_NAME_MAPPING,!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(t,i){return t=i?t.replace(/\{\$([^}]+)}/g,function(t,e){return e in i?i[e]:t}):t},goog.getMsgWithFallback=function(t,e){return t},goog.exportSymbol=function(t,e,i){goog.exportPath_(t,e,i)},goog.exportProperty=function(t,e,i){t[e]=i},goog.inherits=function(t,r){function e(){}e.prototype=r.prototype,t.superClass_=r.prototype,t.prototype=new e,(t.prototype.constructor=t).base=function(t,e,i){var o=Array.prototype.slice.call(arguments,2);return r.prototype[e].apply(t,o)}},goog.base=function(t,e,i){var o=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!o)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(o.superClass_)return o.superClass_.constructor.apply(t,Array.prototype.slice.call(arguments,1));for(var r=Array.prototype.slice.call(arguments,2),n=!1,s=t.constructor;s;s=s.superClass_&&s.superClass_.constructor)if(s.prototype[e]===o)n=!0;else if(n)return s.prototype[e].apply(t,r);if(t[e]===o)return t.constructor.prototype[e].apply(t,r);throw Error("goog.base called from a method of one name to a method of a different name")},goog.scope=function(t){t.call(goog.global)},COMPILED||(goog.global.COMPILED=COMPILED),goog.defineClass=function(t,e){var i=e.constructor,o=e.statics;i&&i!=Object.prototype.constructor||(i=function(){throw Error("cannot instantiate an interface (no constructor defined).")});i=goog.defineClass.createSealingConstructor_(i,t);return t&&goog.inherits(i,t),delete e.constructor,delete e.statics,goog.defineClass.applyProperties_(i.prototype,e),null!=o&&(o instanceof Function?o(i):goog.defineClass.applyProperties_(i,o)),i},goog.defineClass.ClassDescriptor,goog.define("goog.defineClass.SEAL_CLASS_INSTANCES",goog.DEBUG),goog.defineClass.createSealingConstructor_=function(e,t){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(t&&t.prototype&&t.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return e;var i=function(){var t=e.apply(this,arguments)||this;return t[goog.UID_PROPERTY_]=t[goog.UID_PROPERTY_],this.constructor===i&&Object.seal(t),t};return i}return e},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.defineClass.applyProperties_=function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);for(var o=0;o<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;o++)i=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[o],Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},goog.tagUnsealableClass=function(t){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(t.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)},goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable",goog.provide("goog.disposable.IDisposable"),goog.disposable.IDisposable=function(){},goog.disposable.IDisposable.prototype.dispose=goog.abstractMethod,goog.disposable.IDisposable.prototype.isDisposed=goog.abstractMethod,goog.provide("goog.Disposable"),goog.provide("goog.dispose"),goog.provide("goog.disposeAll"),goog.require("goog.disposable.IDisposable"),goog.Disposable=function(){goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF&&(goog.Disposable.INCLUDE_STACK_ON_CREATION&&(this.creationStack=(new Error).stack),goog.Disposable.instances_[goog.getUid(this)]=this),this.disposed_=this.disposed_,this.onDisposeCallbacks_=this.onDisposeCallbacks_},goog.Disposable.MonitoringMode={OFF:0,PERMANENT:1,INTERACTIVE:2},goog.define("goog.Disposable.MONITORING_MODE",0),goog.define("goog.Disposable.INCLUDE_STACK_ON_CREATION",!0),goog.Disposable.instances_={},goog.Disposable.getUndisposedObjects=function(){var t,e=[];for(t in goog.Disposable.instances_)goog.Disposable.instances_.hasOwnProperty(t)&&e.push(goog.Disposable.instances_[Number(t)]);return e},goog.Disposable.clearUndisposedObjects=function(){goog.Disposable.instances_={}},goog.Disposable.prototype.disposed_=!1,goog.Disposable.prototype.onDisposeCallbacks_,goog.Disposable.prototype.creationStack,goog.Disposable.prototype.isDisposed=function(){return this.disposed_},goog.Disposable.prototype.getDisposed=goog.Disposable.prototype.isDisposed,goog.Disposable.prototype.dispose=function(){if(!this.disposed_&&(this.disposed_=!0,this.disposeInternal(),goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF)){var t=goog.getUid(this);if(goog.Disposable.MONITORING_MODE==goog.Disposable.MonitoringMode.PERMANENT&&!goog.Disposable.instances_.hasOwnProperty(t))throw Error(this+" did not call the goog.Disposable base constructor or was disposed of after a clearUndisposedObjects call");delete goog.Disposable.instances_[t]}},goog.Disposable.prototype.registerDisposable=function(t){this.addOnDisposeCallback(goog.partial(goog.dispose,t))},goog.Disposable.prototype.addOnDisposeCallback=function(t,e){this.onDisposeCallbacks_||(this.onDisposeCallbacks_=[]),this.onDisposeCallbacks_.push(goog.isDef(e)?goog.bind(t,e):t)},goog.Disposable.prototype.disposeInternal=function(){if(this.onDisposeCallbacks_)for(;this.onDisposeCallbacks_.length;)this.onDisposeCallbacks_.shift()()},goog.Disposable.isDisposed=function(t){return!(!t||"function"!=typeof t.isDisposed)&&t.isDisposed()},goog.dispose=function(t){t&&"function"==typeof t.dispose&&t.dispose()},goog.disposeAll=function(t){for(var e=0,i=arguments.length;e<i;++e){var o=arguments[e];goog.isArrayLike(o)?goog.disposeAll.apply(null,o):goog.dispose(o)}},goog.provide("goog.events.EventId"),goog.events.EventId=function(t){this.id=t},goog.events.EventId.prototype.toString=function(){return this.id},goog.provide("goog.events.Event"),goog.provide("goog.events.EventLike"),goog.require("goog.Disposable"),goog.require("goog.events.EventId"),goog.events.EventLike,goog.events.Event=function(t,e){this.type=t instanceof goog.events.EventId?String(t):t,this.target=e,this.currentTarget=this.target,this.propagationStopped_=!1,this.defaultPrevented=!1,this.returnValue_=!0},goog.events.Event.prototype.disposeInternal=function(){},goog.events.Event.prototype.dispose=function(){},goog.events.Event.prototype.stopPropagation=function(){this.propagationStopped_=!0},goog.events.Event.prototype.preventDefault=function(){this.defaultPrevented=!0,this.returnValue_=!1},goog.events.Event.stopPropagation=function(t){t.stopPropagation()},goog.events.Event.preventDefault=function(t){t.preventDefault()},goog.provide("goog.debug.Error"),goog.debug.Error=function(t){var e;Error.captureStackTrace?Error.captureStackTrace(this,goog.debug.Error):(e=(new Error).stack)&&(this.stack=e),t&&(this.message=String(t))},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.provide("goog.dom.NodeType"),goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},goog.provide("goog.string"),goog.provide("goog.string.Unicode"),goog.define("goog.string.DETECT_DOUBLE_ESCAPING",!1),goog.string.Unicode={NBSP:""},goog.string.startsWith=function(t,e){return 0==t.lastIndexOf(e,0)},goog.string.endsWith=function(t,e){var i=t.length-e.length;return 0<=i&&t.indexOf(e,i)==i},goog.string.caseInsensitiveStartsWith=function(t,e){return 0==goog.string.caseInsensitiveCompare(e,t.substr(0,e.length))},goog.string.caseInsensitiveEndsWith=function(t,e){return 0==goog.string.caseInsensitiveCompare(e,t.substr(t.length-e.length,e.length))},goog.string.caseInsensitiveEquals=function(t,e){return t.toLowerCase()==e.toLowerCase()},goog.string.subs=function(t,e){for(var i=t.split("%s"),o="",r=Array.prototype.slice.call(arguments,1);r.length&&1<i.length;)o+=i.shift()+r.shift();return o+i.join("%s")},goog.string.collapseWhitespace=function(t){return t.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmpty=function(t){return/^[\s\xa0]*$/.test(t)},goog.string.isEmptySafe=function(t){return goog.string.isEmpty(goog.string.makeSafe(t))},goog.string.isBreakingWhitespace=function(t){return!/[^\t\n\r ]/.test(t)},goog.string.isAlpha=function(t){return!/[^a-zA-Z]/.test(t)},goog.string.isNumeric=function(t){return!/[^0-9]/.test(t)},goog.string.isAlphaNumeric=function(t){return!/[^a-zA-Z0-9]/.test(t)},goog.string.isSpace=function(t){return" "==t},goog.string.isUnicodeChar=function(t){return 1==t.length&&" "<=t&&t<="~"||""<=t&&t<=""},goog.string.stripNewlines=function(t){return t.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(t){return t.replace(/(\r\n|\r|\n)/g,"\n")},goog.string.normalizeWhitespace=function(t){return t.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(t){return t.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(t){return t.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=goog.TRUSTED_SITE&&String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},goog.string.trimLeft=function(t){return t.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(t){return t.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=function(t,e){t=String(t).toLowerCase(),e=String(e).toLowerCase();return t<e?-1:t==e?0:1},goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,goog.string.numerateCompare=function(t,e){if(t==e)return 0;if(!t)return-1;if(!e)return 1;for(var i=t.toLowerCase().match(goog.string.numerateCompareRegExp_),o=e.toLowerCase().match(goog.string.numerateCompareRegExp_),r=Math.min(i.length,o.length),n=0;n<r;n++){var s=i[n],a=o[n];if(s!=a){var l=parseInt(s,10);if(!isNaN(l)){var h=parseInt(a,10);if(!isNaN(h)&&l-h)return l-h}return s<a?-1:1}}return i.length!=o.length?i.length-o.length:t<e?-1:1},goog.string.urlEncode=function(t){return encodeURIComponent(String(t))},goog.string.urlDecode=function(t){return decodeURIComponent(t.replace(/\+/g," "))},goog.string.newLineToBr=function(t,e){return t.replace(/(\r\n|\r|\n)/g,e?"<br />":"<br>")},goog.string.htmlEscape=function(t,e){return e?(t=t.replace(goog.string.AMP_RE_,"&amp;").replace(goog.string.LT_RE_,"&lt;").replace(goog.string.GT_RE_,"&gt;").replace(goog.string.QUOT_RE_,"&quot;").replace(goog.string.SINGLE_QUOTE_RE_,"&#39;").replace(goog.string.NULL_RE_,"&#0;"),goog.string.DETECT_DOUBLE_ESCAPING&&(t=t.replace(goog.string.E_RE_,"&#101;"))):goog.string.ALL_RE_.test(t)&&(-1!=(t=-1!=(t=-1!=(t=-1!=(t=-1!=(t=-1!=t.indexOf("&")?t.replace(goog.string.AMP_RE_,"&amp;"):t).indexOf("<")?t.replace(goog.string.LT_RE_,"&lt;"):t).indexOf(">")?t.replace(goog.string.GT_RE_,"&gt;"):t).indexOf('"')?t.replace(goog.string.QUOT_RE_,"&quot;"):t).indexOf("'")?t.replace(goog.string.SINGLE_QUOTE_RE_,"&#39;"):t).indexOf("\0")&&(t=t.replace(goog.string.NULL_RE_,"&#0;")),goog.string.DETECT_DOUBLE_ESCAPING&&-1!=t.indexOf("e")&&(t=t.replace(goog.string.E_RE_,"&#101;"))),t},goog.string.AMP_RE_=/&/g,goog.string.LT_RE_=/</g,goog.string.GT_RE_=/>/g,goog.string.QUOT_RE_=/"/g,goog.string.SINGLE_QUOTE_RE_=/'/g,goog.string.NULL_RE_=/\x00/g,goog.string.E_RE_=/e/g,goog.string.ALL_RE_=goog.string.DETECT_DOUBLE_ESCAPING?/[\x00&<>"'e]/:/[\x00&<>"']/,goog.string.unescapeEntities=function(t){return goog.string.contains(t,"&")?"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(t):goog.string.unescapePureXmlEntities_(t):t},goog.string.unescapeEntitiesWithDocument=function(t,e){return goog.string.contains(t,"&")?goog.string.unescapeEntitiesUsingDom_(t,e):t},goog.string.unescapeEntitiesUsingDom_=function(t,e){var o={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},r=(e||goog.global.document).createElement("div");return t.replace(goog.string.HTML_ENTITY_PATTERN_,function(t,e){var i=o[t];return i||("#"==e.charAt(0)&&(e=Number("0"+e.substr(1)),isNaN(e)||(i=String.fromCharCode(e))),i||(r.innerHTML=t+" ",i=r.firstChild.nodeValue.slice(0,-1)),o[t]=i)})},goog.string.unescapePureXmlEntities_=function(t){return t.replace(/&([^;]+);/g,function(t,e){switch(e){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==e.charAt(0)){var i=Number("0"+e.substr(1));if(!isNaN(i))return String.fromCharCode(i)}return t}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(t,e){return goog.string.newLineToBr(t.replace(/  /g," &#160;"),e)},goog.string.preserveSpaces=function(t){return t.replace(/(^|[\n ]) /g,"$1"+goog.string.Unicode.NBSP)},goog.string.stripQuotes=function(t,e){for(var i=e.length,o=0;o<i;o++){var r=1==i?e:e.charAt(o);if(t.charAt(0)==r&&t.charAt(t.length-1)==r)return t.substring(1,t.length-1)}return t},goog.string.truncate=function(t,e,i){return(t=i?goog.string.unescapeEntities(t):t).length>e&&(t=t.substring(0,e-3)+"..."),t=i?goog.string.htmlEscape(t):t},goog.string.truncateMiddle=function(t,e,i,o){var r;return i&&(t=goog.string.unescapeEntities(t)),o&&t.length>e?(r=t.length-(o=e<o?e:o),t=t.substring(0,e-o)+"..."+t.substring(r)):t.length>e&&(o=Math.floor(e/2),r=t.length-o,t=t.substring(0,o+=e%2)+"..."+t.substring(r)),t=i?goog.string.htmlEscape(t):t},goog.string.specialEscapeChars_={"\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\x0B",'"':'\\"',"\\":"\\\\"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(t){if((t=String(t)).quote)return t.quote();for(var e=['"'],i=0;i<t.length;i++){var o=t.charAt(i),r=o.charCodeAt(0);e[i+1]=goog.string.specialEscapeChars_[o]||(31<r&&r<127?o:goog.string.escapeChar(o))}return e.push('"'),e.join("")},goog.string.escapeString=function(t){for(var e=[],i=0;i<t.length;i++)e[i]=goog.string.escapeChar(t.charAt(i));return e.join("")},goog.string.escapeChar=function(t){if(t in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[t];if(t in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[t]=goog.string.specialEscapeChars_[t];var e=t,i=t.charCodeAt(0);return 31<i&&i<127?e=t:(i<256?(e="\\x",(i<16||256<i)&&(e+="0")):(e="\\u",i<4096&&(e+="0")),e+=i.toString(16).toUpperCase()),goog.string.jsEscapeCache_[t]=e},goog.string.contains=function(t,e){return-1!=t.indexOf(e)},goog.string.caseInsensitiveContains=function(t,e){return goog.string.contains(t.toLowerCase(),e.toLowerCase())},goog.string.countOf=function(t,e){return t&&e?t.split(e).length-1:0},goog.string.removeAt=function(t,e,i){var o=t;return o=0<=e&&e<t.length&&0<i?t.substr(0,e)+t.substr(e+i,t.length-e-i):o},goog.string.remove=function(t,e){e=new RegExp(goog.string.regExpEscape(e),"");return t.replace(e,"")},goog.string.removeAll=function(t,e){e=new RegExp(goog.string.regExpEscape(e),"g");return t.replace(e,"")},goog.string.regExpEscape=function(t){return String(t).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=function(t,e){return new Array(e+1).join(t)},goog.string.padNumber=function(t,e,i){i=goog.isDef(i)?t.toFixed(i):String(t),t=i.indexOf(".");return-1==t&&(t=i.length),goog.string.repeat("0",Math.max(0,e-t))+i},goog.string.makeSafe=function(t){return null==t?"":String(t)},goog.string.buildString=function(t){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)},goog.string.compareVersions=function(t,e){for(var i=0,o=goog.string.trim(String(t)).split("."),r=goog.string.trim(String(e)).split("."),n=Math.max(o.length,r.length),s=0;0==i&&s<n;s++){var a=o[s]||"",l=r[s]||"",h=new RegExp("(\\d*)(\\D*)","g"),p=new RegExp("(\\d*)(\\D*)","g");do{var c=h.exec(a)||["","",""],u=p.exec(l)||["","",""];if(0==c[0].length&&0==u[0].length)break;var d=0==c[1].length?0:parseInt(c[1],10),f=0==u[1].length?0:parseInt(u[1],10),i=goog.string.compareElements_(d,f)||goog.string.compareElements_(0==c[2].length,0==u[2].length)||goog.string.compareElements_(c[2],u[2])}while(0==i)}return i},goog.string.compareElements_=function(t,e){return t<e?-1:e<t?1:0},goog.string.HASHCODE_MAX_=4294967296,goog.string.hashCode=function(t){for(var e=0,i=0;i<t.length;++i)e=31*e+t.charCodeAt(i),e%=goog.string.HASHCODE_MAX_;return e},goog.string.uniqueStringCounter_=2147483648*Math.random()|0,goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(t){var e=Number(t);return 0==e&&goog.string.isEmpty(t)?NaN:e},goog.string.isLowerCamelCase=function(t){return/^[a-z]+([A-Z][a-z]*)*$/.test(t)},goog.string.isUpperCamelCase=function(t){return/^([A-Z][a-z]*)+$/.test(t)},goog.string.toCamelCase=function(t){return String(t).replace(/\-([a-z])/g,function(t,e){return e.toUpperCase()})},goog.string.toSelectorCase=function(t){return String(t).replace(/([A-Z])/g,"-$1").toLowerCase()},goog.string.toTitleCase=function(t,e){e=(e=goog.isString(e)?goog.string.regExpEscape(e):"\\s")?"|["+e+"]+":"",e=new RegExp("(^"+e+")([a-z])","g");return t.replace(e,function(t,e,i){return e+i.toUpperCase()})},goog.string.parseInt=function(t){return isFinite(t)&&(t=String(t)),goog.isString(t)?/^\s*-?0x/i.test(t)?parseInt(t,16):parseInt(t,10):NaN},goog.string.splitLimit=function(t,e,i){for(var o=t.split(e),r=[];0<i&&o.length;)r.push(o.shift()),i--;return o.length&&r.push(o.join(e)),r},goog.provide("goog.asserts"),goog.provide("goog.asserts.AssertionError"),goog.require("goog.debug.Error"),goog.require("goog.dom.NodeType"),goog.require("goog.string"),goog.define("goog.asserts.ENABLE_ASSERTS",goog.DEBUG),goog.asserts.AssertionError=function(t,e){e.unshift(t),goog.debug.Error.call(this,goog.string.subs.apply(null,e)),e.shift(),this.messagePattern=t},goog.inherits(goog.asserts.AssertionError,goog.debug.Error),goog.asserts.AssertionError.prototype.name="AssertionError",goog.asserts.DEFAULT_ERROR_HANDLER=function(t){throw t},goog.asserts.errorHandler_=goog.asserts.DEFAULT_ERROR_HANDLER,goog.asserts.doAssertFailure_=function(t,e,i,o){var r="Assertion failed";i?(r+=": "+i,n=o):t&&(r+=": "+t,n=e);var n=new goog.asserts.AssertionError(""+r,n||[]);goog.asserts.errorHandler_(n)},goog.asserts.setErrorHandler=function(t){goog.asserts.ENABLE_ASSERTS&&(goog.asserts.errorHandler_=t)},goog.asserts.assert=function(t,e,i){return goog.asserts.ENABLE_ASSERTS&&!t&&goog.asserts.doAssertFailure_("",null,e,Array.prototype.slice.call(arguments,2)),t},goog.asserts.fail=function(t,e){goog.asserts.ENABLE_ASSERTS&&goog.asserts.errorHandler_(new goog.asserts.AssertionError("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1)))},goog.asserts.assertNumber=function(t,e,i){return goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(t)&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(t),t],e,Array.prototype.slice.call(arguments,2)),t},goog.asserts.assertString=function(t,e,i){return goog.asserts.ENABLE_ASSERTS&&!goog.isString(t)&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(t),t],e,Array.prototype.slice.call(arguments,2)),t},goog.asserts.assertFunction=function(t,e,i){return goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(t)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(t),t],e,Array.prototype.slice.call(arguments,2)),t},goog.asserts.assertObject=function(t,e,i){return goog.asserts.ENABLE_ASSERTS&&!goog.isObject(t)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(t),t],e,Array.prototype.slice.call(arguments,2)),t},goog.asserts.assertArray=function(t,e,i){return goog.asserts.ENABLE_ASSERTS&&!goog.isArray(t)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(t),t],e,Array.prototype.slice.call(arguments,2)),t},goog.asserts.assertBoolean=function(t,e,i){return goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(t)&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(t),t],e,Array.prototype.slice.call(arguments,2)),t},goog.asserts.assertElement=function(t,e,i){return!goog.asserts.ENABLE_ASSERTS||goog.isObject(t)&&t.nodeType==goog.dom.NodeType.ELEMENT||goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(t),t],e,Array.prototype.slice.call(arguments,2)),t},goog.asserts.assertInstanceof=function(t,e,i,o){return!goog.asserts.ENABLE_ASSERTS||t instanceof e||goog.asserts.doAssertFailure_("instanceof check failed.",null,i,Array.prototype.slice.call(arguments,3)),t},goog.asserts.assertObjectPrototypeIsIntact=function(){for(var t in Object.prototype)goog.asserts.fail(t+" should not be enumerable in Object.prototype.")},goog.provide("goog.array"),goog.provide("goog.array.ArrayLike"),goog.require("goog.asserts"),goog.define("goog.NATIVE_ARRAY_PROTOTYPES",goog.TRUSTED_SITE),goog.define("goog.array.ASSUME_NATIVE_FUNCTIONS",!1),goog.array.ArrayLike,goog.array.peek=function(t){return t[t.length-1]},goog.array.last=goog.array.peek,goog.array.ARRAY_PROTOTYPE_=Array.prototype,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.indexOf)?function(t,e,i){return goog.asserts.assert(null!=t.length),goog.array.ARRAY_PROTOTYPE_.indexOf.call(t,e,i)}:function(t,e,i){i=null==i?0:i<0?Math.max(0,t.length+i):i;if(goog.isString(t))return goog.isString(e)&&1==e.length?t.indexOf(e,i):-1;for(var o=i;o<t.length;o++)if(o in t&&t[o]===e)return o;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.lastIndexOf)?function(t,e,i){goog.asserts.assert(null!=t.length);i=null==i?t.length-1:i;return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(t,e,i)}:function(t,e,i){i=null==i?t.length-1:i;if(i<0&&(i=Math.max(0,t.length+i)),goog.isString(t))return goog.isString(e)&&1==e.length?t.lastIndexOf(e,i):-1;for(var o=i;0<=o;o--)if(o in t&&t[o]===e)return o;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.forEach)?function(t,e,i){goog.asserts.assert(null!=t.length),goog.array.ARRAY_PROTOTYPE_.forEach.call(t,e,i)}:function(t,e,i){for(var o=t.length,r=goog.isString(t)?t.split(""):t,n=0;n<o;n++)n in r&&e.call(i,r[n],n,t)},goog.array.forEachRight=function(t,e,i){for(var o=t.length,r=goog.isString(t)?t.split(""):t,n=o-1;0<=n;--n)n in r&&e.call(i,r[n],n,t)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.filter)?function(t,e,i){return goog.asserts.assert(null!=t.length),goog.array.ARRAY_PROTOTYPE_.filter.call(t,e,i)}:function(t,e,i){for(var o,r=t.length,n=[],s=0,a=goog.isString(t)?t.split(""):t,l=0;l<r;l++)l in a&&(o=a[l],e.call(i,o,l,t)&&(n[s++]=o));return n},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.map)?function(t,e,i){return goog.asserts.assert(null!=t.length),goog.array.ARRAY_PROTOTYPE_.map.call(t,e,i)}:function(t,e,i){for(var o=t.length,r=new Array(o),n=goog.isString(t)?t.split(""):t,s=0;s<o;s++)s in n&&(r[s]=e.call(i,n[s],s,t));return r},goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduce)?function(t,e,i,o){return goog.asserts.assert(null!=t.length),o&&(e=goog.bind(e,o)),goog.array.ARRAY_PROTOTYPE_.reduce.call(t,e,i)}:function(i,o,t,r){var n=t;return goog.array.forEach(i,function(t,e){n=o.call(r,n,t,e,i)}),n},goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduceRight)?function(t,e,i,o){return goog.asserts.assert(null!=t.length),o&&(e=goog.bind(e,o)),goog.array.ARRAY_PROTOTYPE_.reduceRight.call(t,e,i)}:function(i,o,t,r){var n=t;return goog.array.forEachRight(i,function(t,e){n=o.call(r,n,t,e,i)}),n},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.some)?function(t,e,i){return goog.asserts.assert(null!=t.length),goog.array.ARRAY_PROTOTYPE_.some.call(t,e,i)}:function(t,e,i){for(var o=t.length,r=goog.isString(t)?t.split(""):t,n=0;n<o;n++)if(n in r&&e.call(i,r[n],n,t))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.every)?function(t,e,i){return goog.asserts.assert(null!=t.length),goog.array.ARRAY_PROTOTYPE_.every.call(t,e,i)}:function(t,e,i){for(var o=t.length,r=goog.isString(t)?t.split(""):t,n=0;n<o;n++)if(n in r&&!e.call(i,r[n],n,t))return!1;return!0},goog.array.count=function(t,o,r){var n=0;return goog.array.forEach(t,function(t,e,i){o.call(r,t,e,i)&&++n},r),n},goog.array.find=function(t,e,i){i=goog.array.findIndex(t,e,i);return i<0?null:goog.isString(t)?t.charAt(i):t[i]},goog.array.findIndex=function(t,e,i){for(var o=t.length,r=goog.isString(t)?t.split(""):t,n=0;n<o;n++)if(n in r&&e.call(i,r[n],n,t))return n;return-1},goog.array.findRight=function(t,e,i){i=goog.array.findIndexRight(t,e,i);return i<0?null:goog.isString(t)?t.charAt(i):t[i]},goog.array.findIndexRight=function(t,e,i){for(var o=t.length,r=goog.isString(t)?t.split(""):t,n=o-1;0<=n;n--)if(n in r&&e.call(i,r[n],n,t))return n;return-1},goog.array.contains=function(t,e){return 0<=goog.array.indexOf(t,e)},goog.array.isEmpty=function(t){return 0==t.length},goog.array.clear=function(t){if(!goog.isArray(t))for(var e=t.length-1;0<=e;e--)delete t[e];t.length=0},goog.array.insert=function(t,e){goog.array.contains(t,e)||t.push(e)},goog.array.insertAt=function(t,e,i){goog.array.splice(t,i,0,e)},goog.array.insertArrayAt=function(t,e,i){goog.partial(goog.array.splice,t,i,0).apply(null,e)},goog.array.insertBefore=function(t,e,i){var o;2==arguments.length||(o=goog.array.indexOf(t,i))<0?t.push(e):goog.array.insertAt(t,e,o)},goog.array.remove=function(t,e){var i=goog.array.indexOf(t,e);return(e=0<=i)&&goog.array.removeAt(t,i),e},goog.array.removeAt=function(t,e){return goog.asserts.assert(null!=t.length),1==goog.array.ARRAY_PROTOTYPE_.splice.call(t,e,1).length},goog.array.removeIf=function(t,e,i){i=goog.array.findIndex(t,e,i);return 0<=i&&(goog.array.removeAt(t,i),!0)},goog.array.removeAllIf=function(i,o,r){var n=0;return goog.array.forEachRight(i,function(t,e){o.call(r,t,e,i)&&goog.array.removeAt(i,e)&&n++}),n},goog.array.concat=function(t){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.join=function(t){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.toArray=function(t){var e=t.length;if(0<e){for(var i=new Array(e),o=0;o<e;o++)i[o]=t[o];return i}return[]},goog.array.clone=goog.array.toArray,goog.array.extend=function(t,e){for(var i=1;i<arguments.length;i++){var o,r=arguments[i];if(goog.isArray(r)||(o=goog.isArrayLike(r))&&Object.prototype.hasOwnProperty.call(r,"callee"))t.push.apply(t,r);else if(o)for(var n=t.length,s=r.length,a=0;a<s;a++)t[n+a]=r[a];else t.push(r)}},goog.array.splice=function(t,e,i,o){return goog.asserts.assert(null!=t.length),goog.array.ARRAY_PROTOTYPE_.splice.apply(t,goog.array.slice(arguments,1))},goog.array.slice=function(t,e,i){return goog.asserts.assert(null!=t.length),arguments.length<=2?goog.array.ARRAY_PROTOTYPE_.slice.call(t,e):goog.array.ARRAY_PROTOTYPE_.slice.call(t,e,i)},goog.array.removeDuplicates=function(t,e,i){for(var o=e||t,r=i||function(t){return goog.isObject(l)?"o"+goog.getUid(l):(typeof l).charAt(0)+l},n={},s=0,a=0;a<t.length;){var l=t[a++],h=r(l);Object.prototype.hasOwnProperty.call(n,h)||(n[h]=!0,o[s++]=l)}o.length=s},goog.array.binarySearch=function(t,e,i){return goog.array.binarySearch_(t,i||goog.array.defaultCompare,!1,e)},goog.array.binarySelect=function(t,e,i){return goog.array.binarySearch_(t,e,!0,void 0,i)},goog.array.binarySearch_=function(t,e,i,o,r){for(var n,s=0,a=t.length;s<a;){var l=s+a>>1,h=i?e.call(r,t[l],l,t):e(o,t[l]);0<h?s=1+l:(a=l,n=!h)}return n?s:~s},goog.array.sort=function(t,e){t.sort(e||goog.array.defaultCompare)},goog.array.stableSort=function(t,e){for(var i=0;i<t.length;i++)t[i]={index:i,value:t[i]};var o=e||goog.array.defaultCompare;goog.array.sort(t,function(t,e){return o(t.value,e.value)||t.index-e.index});for(i=0;i<t.length;i++)t[i]=t[i].value},goog.array.sortByKey=function(t,i,e){var o=e||goog.array.defaultCompare;goog.array.sort(t,function(t,e){return o(i(t),i(e))})},goog.array.sortObjectsByKey=function(t,e,i){goog.array.sortByKey(t,function(t){return t[e]},i)},goog.array.isSorted=function(t,e,i){for(var o=e||goog.array.defaultCompare,r=1;r<t.length;r++){var n=o(t[r-1],t[r]);if(0<n||0==n&&i)return!1}return!0},goog.array.equals=function(t,e,i){if(!goog.isArrayLike(t)||!goog.isArrayLike(e)||t.length!=e.length)return!1;for(var o=t.length,r=i||goog.array.defaultCompareEquality,n=0;n<o;n++)if(!r(t[n],e[n]))return!1;return!0},goog.array.compare3=function(t,e,i){for(var o=i||goog.array.defaultCompare,r=Math.min(t.length,e.length),n=0;n<r;n++){var s=o(t[n],e[n]);if(0!=s)return s}return goog.array.defaultCompare(t.length,e.length)},goog.array.defaultCompare=function(t,e){return e<t?1:t<e?-1:0},goog.array.defaultCompareEquality=function(t,e){return t===e},goog.array.binaryInsert=function(t,e,i){i=goog.array.binarySearch(t,e,i);return i<0&&(goog.array.insertAt(t,e,-(i+1)),!0)},goog.array.binaryRemove=function(t,e,i){i=goog.array.binarySearch(t,e,i);return 0<=i&&goog.array.removeAt(t,i)},goog.array.bucket=function(t,e,i){for(var o={},r=0;r<t.length;r++){var n=t[r],s=e.call(i,n,r,t);goog.isDef(s)&&(o[s]||(o[s]=[])).push(n)}return o},goog.array.toObject=function(i,o,r){var n={};return goog.array.forEach(i,function(t,e){n[o.call(r,t,e,i)]=t}),n},goog.array.range=function(t,e,i){var o=[],r=0,n=t,s=i||1;if(void 0!==e&&(r=t,n=e),s*(n-r)<0)return[];if(0<s)for(var a=r;a<n;a+=s)o.push(a);else for(a=r;n<a;a+=s)o.push(a);return o},goog.array.repeat=function(t,e){for(var i=[],o=0;o<e;o++)i[o]=t;return i},goog.array.flatten=function(t){for(var e=[],i=0;i<arguments.length;i++){var o=arguments[i];goog.isArray(o)?e.push.apply(e,goog.array.flatten.apply(null,o)):e.push(o)}return e},goog.array.rotate=function(t,e){return goog.asserts.assert(null!=t.length),t.length&&(0<(e%=t.length)?goog.array.ARRAY_PROTOTYPE_.unshift.apply(t,t.splice(-e,e)):e<0&&goog.array.ARRAY_PROTOTYPE_.push.apply(t,t.splice(0,-e))),t},goog.array.moveItem=function(t,e,i){goog.asserts.assert(0<=e&&e<t.length),goog.asserts.assert(0<=i&&i<t.length);e=goog.array.ARRAY_PROTOTYPE_.splice.call(t,e,1);goog.array.ARRAY_PROTOTYPE_.splice.call(t,i,0,e[0])},goog.array.zip=function(t){if(!arguments.length)return[];for(var e=[],i=0;;i++){for(var o=[],r=0;r<arguments.length;r++){var n=arguments[r];if(i>=n.length)return e;o.push(n[i])}e.push(o)}},goog.array.shuffle=function(t,e){for(var i=e||Math.random,o=t.length-1;0<o;o--){var r=Math.floor(i()*(o+1)),n=t[o];t[o]=t[r],t[r]=n}},goog.provide("goog.object"),goog.require("goog.array"),goog.object.forEach=function(t,e,i){for(var o in t)e.call(i,t[o],o,t)},goog.object.filter=function(t,e,i){var o,r={};for(o in t)e.call(i,t[o],o,t)&&(r[o]=t[o]);return r},goog.object.map=function(t,e,i){var o,r={};for(o in t)r[o]=e.call(i,t[o],o,t);return r},goog.object.some=function(t,e,i){for(var o in t)if(e.call(i,t[o],o,t))return!0;return!1},goog.object.every=function(t,e,i){for(var o in t)if(!e.call(i,t[o],o,t))return!1;return!0},goog.object.getCount=function(t){var e,i=0;for(e in t)i++;return i},goog.object.getAnyKey=function(t){for(var e in t)return e},goog.object.getAnyValue=function(t){for(var e in t)return t[e]},goog.object.contains=function(t,e){return goog.object.containsValue(t,e)},goog.object.getValues=function(t){var e,i=[],o=0;for(e in t)i[o++]=t[e];return i},goog.object.getKeys=function(t){var e,i=[],o=0;for(e in t)i[o++]=e;return i},goog.object.getValueByKeys=function(t,e){for(var i=goog.isArrayLike(e),o=i?e:arguments,r=i?0:1;r<o.length&&(t=t[o[r]],goog.isDef(t));r++);return t},goog.object.containsKey=function(t,e){return e in t},goog.object.containsValue=function(t,e){for(var i in t)if(t[i]==e)return!0;return!1},goog.object.findKey=function(t,e,i){for(var o in t)if(e.call(i,t[o],o,t))return o},goog.object.findValue=function(t,e,i){i=goog.object.findKey(t,e,i);return i&&t[i]},goog.object.isEmpty=function(t){for(var e in t)return!1;return!0},goog.object.clear=function(t){for(var e in t)delete t[e]},goog.object.remove=function(t,e){var i;return(i=e in t)&&delete t[e],i},goog.object.add=function(t,e,i){if(e in t)throw Error('The object already contains the key "'+e+'"');goog.object.set(t,e,i)},goog.object.get=function(t,e,i){return e in t?t[e]:i},goog.object.set=function(t,e,i){t[e]=i},goog.object.setIfUndefined=function(t,e,i){return e in t?t[e]:t[e]=i},goog.object.equals=function(t,e){if(!goog.array.equals(goog.object.getKeys(t),goog.object.getKeys(e)))return!1;for(var i in t)if(t[i]!==e[i])return!1;return!0},goog.object.clone=function(t){var e,i={};for(e in t)i[e]=t[e];return i},goog.object.unsafeClone=function(t){var e=goog.typeOf(t);if("object"!=e&&"array"!=e)return t;if(t.clone)return t.clone();var i,o="array"==e?[]:{};for(i in t)o[i]=goog.object.unsafeClone(t[i]);return o},goog.object.transpose=function(t){var e,i={};for(e in t)i[t[e]]=e;return i},goog.object.PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.object.extend=function(t,e){for(var i,o,r=1;r<arguments.length;r++){for(i in o=arguments[r])t[i]=o[i];for(var n=0;n<goog.object.PROTOTYPE_FIELDS_.length;n++)i=goog.object.PROTOTYPE_FIELDS_[n],Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}},goog.object.create=function(t){var e=arguments.length;if(1==e&&goog.isArray(t))return goog.object.create.apply(null,t);if(e%2)throw Error("Uneven number of arguments");for(var i={},o=0;o<e;o+=2)i[arguments[o]]=arguments[o+1];return i},goog.object.createSet=function(t){var e=arguments.length;if(1==e&&goog.isArray(t))return goog.object.createSet.apply(null,t);for(var i={},o=0;o<e;o++)i[arguments[o]]=!0;return i},goog.object.createImmutableView=function(t){var e=t;return Object.isFrozen&&!Object.isFrozen(t)&&(e=Object.create(t),Object.freeze(e)),e},goog.object.isImmutableView=function(t){return!!Object.isFrozen&&Object.isFrozen(t)},goog.provide("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.util.getNativeUserAgentString_=function(){var t=goog.labs.userAgent.util.getNavigator_();if(t){t=t.userAgent;if(t)return t}return""},goog.labs.userAgent.util.getNavigator_=function(){return goog.global.navigator},goog.labs.userAgent.util.userAgent_=goog.labs.userAgent.util.getNativeUserAgentString_(),goog.labs.userAgent.util.setUserAgent=function(t){goog.labs.userAgent.util.userAgent_=t||goog.labs.userAgent.util.getNativeUserAgentString_()},goog.labs.userAgent.util.getUserAgent=function(){return goog.labs.userAgent.util.userAgent_},goog.labs.userAgent.util.matchUserAgent=function(t){var e=goog.labs.userAgent.util.getUserAgent();return goog.string.contains(e,t)},goog.labs.userAgent.util.matchUserAgentIgnoreCase=function(t){var e=goog.labs.userAgent.util.getUserAgent();return goog.string.caseInsensitiveContains(e,t)},goog.labs.userAgent.util.extractVersionTuples=function(t){for(var e,i=new RegExp("(\\w[\\w ]+)/([^\\s]+)\\s*(?:\\((.*?)\\))?","g"),o=[];e=i.exec(t);)o.push([e[1],e[2],e[3]||void 0]);return o},goog.provide("goog.labs.userAgent.browser"),goog.require("goog.array"),goog.require("goog.labs.userAgent.util"),goog.require("goog.object"),goog.require("goog.string"),goog.labs.userAgent.browser.matchOpera_=function(){return goog.labs.userAgent.util.matchUserAgent("Opera")||goog.labs.userAgent.util.matchUserAgent("OPR")},goog.labs.userAgent.browser.matchIE_=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.browser.matchFirefox_=function(){return goog.labs.userAgent.util.matchUserAgent("Firefox")},goog.labs.userAgent.browser.matchSafari_=function(){return goog.labs.userAgent.util.matchUserAgent("Safari")&&!goog.labs.userAgent.util.matchUserAgent("Chrome")&&!goog.labs.userAgent.util.matchUserAgent("CriOS")&&!goog.labs.userAgent.util.matchUserAgent("Android")},goog.labs.userAgent.browser.matchChrome_=function(){return goog.labs.userAgent.util.matchUserAgent("Chrome")||goog.labs.userAgent.util.matchUserAgent("CriOS")},goog.labs.userAgent.browser.matchAndroidBrowser_=function(){return!goog.labs.userAgent.browser.isChrome()&&goog.labs.userAgent.util.matchUserAgent("Android")},goog.labs.userAgent.browser.isOpera=goog.labs.userAgent.browser.matchOpera_,goog.labs.userAgent.browser.isIE=goog.labs.userAgent.browser.matchIE_,goog.labs.userAgent.browser.isFirefox=goog.labs.userAgent.browser.matchFirefox_,goog.labs.userAgent.browser.isSafari=goog.labs.userAgent.browser.matchSafari_,goog.labs.userAgent.browser.isChrome=goog.labs.userAgent.browser.matchChrome_,goog.labs.userAgent.browser.isAndroidBrowser=goog.labs.userAgent.browser.matchAndroidBrowser_,goog.labs.userAgent.browser.isSilk=function(){return goog.labs.userAgent.util.matchUserAgent("Silk")},goog.labs.userAgent.browser.getVersion=function(){function t(t){t=goog.array.find(t,o);return i[t]||""}var e=goog.labs.userAgent.util.getUserAgent();if(goog.labs.userAgent.browser.isIE())return goog.labs.userAgent.browser.getIEVersion_(e);var e=goog.labs.userAgent.util.extractVersionTuples(e),i={};goog.array.forEach(e,function(t){var e=t[0],t=t[1];i[e]=t});var o=goog.partial(goog.object.containsKey,i);if(goog.labs.userAgent.browser.isOpera())return t(["Version","Opera","OPR"]);if(goog.labs.userAgent.browser.isChrome())return t(["Chrome","CriOS"]);e=e[2];return e&&e[1]||""},goog.labs.userAgent.browser.isVersionOrHigher=function(t){return 0<=goog.string.compareVersions(goog.labs.userAgent.browser.getVersion(),t)},goog.labs.userAgent.browser.getIEVersion_=function(t){var e=/rv: *([\d\.]*)/.exec(t);if(e&&e[1])return e[1];var i="",e=/MSIE +([\d\.]+)/.exec(t);if(e&&e[1]){t=/Trident\/(\d.\d)/.exec(t);if("7.0"==e[1])if(t&&t[1])switch(t[1]){case"4.0":i="8.0";break;case"5.0":i="9.0";break;case"6.0":i="10.0";break;case"7.0":i="11.0"}else i="7.0";else i=e[1]}return i},goog.provide("goog.labs.userAgent.engine"),goog.require("goog.array"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.engine.isPresto=function(){return goog.labs.userAgent.util.matchUserAgent("Presto")},goog.labs.userAgent.engine.isTrident=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.engine.isWebKit=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("WebKit")},goog.labs.userAgent.engine.isGecko=function(){return goog.labs.userAgent.util.matchUserAgent("Gecko")&&!goog.labs.userAgent.engine.isWebKit()&&!goog.labs.userAgent.engine.isTrident()},goog.labs.userAgent.engine.getVersion=function(){var t=goog.labs.userAgent.util.getUserAgent();if(t){var e=goog.labs.userAgent.util.extractVersionTuples(t),t=e[1];if(t)return"Gecko"==t[0]?goog.labs.userAgent.engine.getVersionForKey_(e,"Firefox"):t[1];e=e[0];if(e&&(i=e[2])){var i=/Trident\/([^\s;]+)/.exec(i);if(i)return i[1]}}return""},goog.labs.userAgent.engine.isVersionOrHigher=function(t){return 0<=goog.string.compareVersions(goog.labs.userAgent.engine.getVersion(),t)},goog.labs.userAgent.engine.getVersionForKey_=function(t,e){t=goog.array.find(t,function(t){return e==t[0]});return t&&t[1]||""},goog.provide("goog.reflect"),goog.reflect.object=function(t,e){return e},goog.reflect.sinkValue=function(t){return goog.reflect.sinkValue[" "](t),t},goog.reflect.sinkValue[" "]=goog.nullFunction,goog.reflect.canAccessProperty=function(t,e){try{return goog.reflect.sinkValue(t[e]),!0}catch(t){}return!1},goog.provide("goog.userAgent"),goog.require("goog.labs.userAgent.browser"),goog.require("goog.labs.userAgent.engine"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.define("goog.userAgent.ASSUME_IE",!1),goog.define("goog.userAgent.ASSUME_GECKO",!1),goog.define("goog.userAgent.ASSUME_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_MOBILE_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_OPERA",!1),goog.define("goog.userAgent.ASSUME_ANY_VERSION",!1),goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA,goog.userAgent.getUserAgentString=function(){return goog.labs.userAgent.util.getUserAgent()},goog.userAgent.getNavigator=function(){return goog.global.navigator||null},goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.labs.userAgent.browser.isOpera(),goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.labs.userAgent.browser.isIE(),goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.labs.userAgent.engine.isGecko(),goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.labs.userAgent.engine.isWebKit(),goog.userAgent.isMobile_=function(){return goog.userAgent.WEBKIT&&goog.labs.userAgent.util.matchUserAgent("Mobile")},goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.isMobile_(),goog.userAgent.SAFARI=goog.userAgent.WEBKIT,goog.userAgent.determinePlatform_=function(){var t=goog.userAgent.getNavigator();return t&&t.platform||""},goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_(),goog.define("goog.userAgent.ASSUME_MAC",!1),goog.define("goog.userAgent.ASSUME_WINDOWS",!1),goog.define("goog.userAgent.ASSUME_LINUX",!1),goog.define("goog.userAgent.ASSUME_X11",!1),goog.define("goog.userAgent.ASSUME_ANDROID",!1),goog.define("goog.userAgent.ASSUME_IPHONE",!1),goog.define("goog.userAgent.ASSUME_IPAD",!1),goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD,goog.userAgent.initPlatform_=function(){goog.userAgent.detectedMac_=goog.string.contains(goog.userAgent.PLATFORM,"Mac"),goog.userAgent.detectedWindows_=goog.string.contains(goog.userAgent.PLATFORM,"Win"),goog.userAgent.detectedLinux_=goog.string.contains(goog.userAgent.PLATFORM,"Linux"),goog.userAgent.detectedX11_=!!goog.userAgent.getNavigator()&&goog.string.contains(goog.userAgent.getNavigator().appVersion||"","X11");var t=goog.userAgent.getUserAgentString();goog.userAgent.detectedAndroid_=!!t&&goog.string.contains(t,"Android"),goog.userAgent.detectedIPhone_=!!t&&goog.string.contains(t,"iPhone"),goog.userAgent.detectedIPad_=!!t&&goog.string.contains(t,"iPad")},goog.userAgent.PLATFORM_KNOWN_||goog.userAgent.initPlatform_(),goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.userAgent.detectedMac_,goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.userAgent.detectedWindows_,goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.detectedLinux_,goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.detectedX11_,goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.userAgent.detectedAndroid_,goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.userAgent.detectedIPhone_,goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.userAgent.detectedIPad_,goog.userAgent.determineVersion_=function(){var t,e="";if(goog.userAgent.OPERA&&goog.global.opera){var i=goog.global.opera.version;return goog.isFunction(i)?i():i}if(goog.userAgent.GECKO?t=/rv\:([^\);]+)(\)|;)/:goog.userAgent.IE?t=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:goog.userAgent.WEBKIT&&(t=/WebKit\/(\S+)/),t&&(e=(o=t.exec(goog.userAgent.getUserAgentString()))?o[1]:""),goog.userAgent.IE){var o=goog.userAgent.getDocumentMode_();if(o>parseFloat(e))return String(o)}return e},goog.userAgent.getDocumentMode_=function(){var t=goog.global.document;return t?t.documentMode:void 0},goog.userAgent.VERSION=goog.userAgent.determineVersion_(),goog.userAgent.compare=function(t,e){return goog.string.compareVersions(t,e)},goog.userAgent.isVersionOrHigherCache_={},goog.userAgent.isVersionOrHigher=function(t){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionOrHigherCache_[t]||(goog.userAgent.isVersionOrHigherCache_[t]=0<=goog.string.compareVersions(goog.userAgent.VERSION,t))},goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher,goog.userAgent.isDocumentModeOrHigher=function(t){return goog.userAgent.IE&&goog.userAgent.DOCUMENT_MODE>=t},goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher,goog.userAgent.DOCUMENT_MODE=function(){var t=goog.global.document;if(t&&goog.userAgent.IE)return goog.userAgent.getDocumentMode_()||("CSS1Compat"==t.compatMode?parseInt(goog.userAgent.VERSION,10):5)}(),goog.provide("goog.events.EventType"),goog.require("goog.userAgent"),goog.events.getVendorPrefixedName_=function(t){return goog.userAgent.WEBKIT?"webkit"+t:goog.userAgent.OPERA?"o"+t.toLowerCase():t.toLowerCase()},goog.events.EventType={CLICK:"click",RIGHTCLICK:"rightclick",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",MOUSEWHEEL:goog.userAgent.GECKO?"DOMMouseScroll":"mousewheel",SELECTSTART:"selectstart",WHEEL:"wheel",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",BLUR:"blur",FOCUS:"focus",DEACTIVATE:"deactivate",FOCUSIN:goog.userAgent.IE?"focusin":"DOMFocusIn",FOCUSOUT:goog.userAgent.IE?"focusout":"DOMFocusOut",CHANGE:"change",SELECT:"select",SUBMIT:"submit",INPUT:"input",PROPERTYCHANGE:"propertychange",DRAGSTART:"dragstart",DRAG:"drag",DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",DRAGEND:"dragend",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",TOUCHCANCEL:"touchcancel",BEFOREUNLOAD:"beforeunload",CONSOLEMESSAGE:"consolemessage",CONTEXTMENU:"contextmenu",DOMCONTENTLOADED:"DOMContentLoaded",ERROR:"error",HELP:"help",LOAD:"load",LOSECAPTURE:"losecapture",ORIENTATIONCHANGE:"orientationchange",READYSTATECHANGE:"readystatechange",RESIZE:"resize",SCROLL:"scroll",UNLOAD:"unload",HASHCHANGE:"hashchange",PAGEHIDE:"pagehide",PAGESHOW:"pageshow",POPSTATE:"popstate",COPY:"copy",PASTE:"paste",CUT:"cut",BEFORECOPY:"beforecopy",BEFORECUT:"beforecut",BEFOREPASTE:"beforepaste",ONLINE:"online",OFFLINE:"offline",MESSAGE:"message",CONNECT:"connect",ANIMATIONSTART:goog.events.getVendorPrefixedName_("AnimationStart"),ANIMATIONEND:goog.events.getVendorPrefixedName_("AnimationEnd"),ANIMATIONITERATION:goog.events.getVendorPrefixedName_("AnimationIteration"),TRANSITIONEND:goog.events.getVendorPrefixedName_("TransitionEnd"),POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTERCANCEL:"pointercancel",POINTERMOVE:"pointermove",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",GOTPOINTERCAPTURE:"gotpointercapture",LOSTPOINTERCAPTURE:"lostpointercapture",MSGESTURECHANGE:"MSGestureChange",MSGESTUREEND:"MSGestureEnd",MSGESTUREHOLD:"MSGestureHold",MSGESTURESTART:"MSGestureStart",MSGESTURETAP:"MSGestureTap",MSGOTPOINTERCAPTURE:"MSGotPointerCapture",MSINERTIASTART:"MSInertiaStart",MSLOSTPOINTERCAPTURE:"MSLostPointerCapture",MSPOINTERCANCEL:"MSPointerCancel",MSPOINTERDOWN:"MSPointerDown",MSPOINTERENTER:"MSPointerEnter",MSPOINTERHOVER:"MSPointerHover",MSPOINTERLEAVE:"MSPointerLeave",MSPOINTERMOVE:"MSPointerMove",MSPOINTEROUT:"MSPointerOut",MSPOINTEROVER:"MSPointerOver",MSPOINTERUP:"MSPointerUp",TEXTINPUT:"textinput",COMPOSITIONSTART:"compositionstart",COMPOSITIONUPDATE:"compositionupdate",COMPOSITIONEND:"compositionend",EXIT:"exit",LOADABORT:"loadabort",LOADCOMMIT:"loadcommit",LOADREDIRECT:"loadredirect",LOADSTART:"loadstart",LOADSTOP:"loadstop",RESPONSIVE:"responsive",SIZECHANGED:"sizechanged",UNRESPONSIVE:"unresponsive",VISIBILITYCHANGE:"visibilitychange",STORAGE:"storage",DOMSUBTREEMODIFIED:"DOMSubtreeModified",DOMNODEINSERTED:"DOMNodeInserted",DOMNODEREMOVED:"DOMNodeRemoved",DOMNODEREMOVEDFROMDOCUMENT:"DOMNodeRemovedFromDocument",DOMNODEINSERTEDINTODOCUMENT:"DOMNodeInsertedIntoDocument",DOMATTRMODIFIED:"DOMAttrModified",DOMCHARACTERDATAMODIFIED:"DOMCharacterDataModified"},goog.provide("goog.events.BrowserFeature"),goog.require("goog.userAgent"),goog.events.BrowserFeature={HAS_W3C_BUTTON:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),HAS_W3C_EVENT_SUPPORT:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),SET_KEY_CODE_TO_PREVENT_DEFAULT:goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),HAS_NAVIGATOR_ONLINE_PROPERTY:!goog.userAgent.WEBKIT||goog.userAgent.isVersionOrHigher("528"),HAS_HTML5_NETWORK_EVENT_SUPPORT:goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9b")||goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("8")||goog.userAgent.OPERA&&goog.userAgent.isVersionOrHigher("9.5")||goog.userAgent.WEBKIT&&goog.userAgent.isVersionOrHigher("528"),HTML5_NETWORK_EVENTS_FIRE_ON_BODY:goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("8")||goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),TOUCH_ENABLED:"ontouchstart"in goog.global||!!(goog.global.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!goog.global.navigator||!goog.global.navigator.msMaxTouchPoints)},goog.provide("goog.events.BrowserEvent"),goog.provide("goog.events.BrowserEvent.MouseButton"),goog.require("goog.events.BrowserFeature"),goog.require("goog.events.Event"),goog.require("goog.events.EventType"),goog.require("goog.reflect"),goog.require("goog.userAgent"),goog.events.BrowserEvent=function(t,e){goog.events.BrowserEvent.base(this,"constructor",t?t.type:""),this.target=null,this.currentTarget=null,this.relatedTarget=null,this.offsetX=0,this.offsetY=0,this.clientX=0,this.clientY=0,this.screenX=0,this.screenY=0,this.button=0,this.keyCode=0,this.charCode=0,this.ctrlKey=!1,this.altKey=!1,this.shiftKey=!1,this.metaKey=!1,this.state=null,this.platformModifierKey=!1,this.event_=null,t&&this.init(t,e)},goog.inherits(goog.events.BrowserEvent,goog.events.Event),goog.events.BrowserEvent.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2},goog.events.BrowserEvent.IEButtonMap=[1,4,2],goog.events.BrowserEvent.prototype.init=function(t,e){var i=this.type=t.type;this.target=t.target||t.srcElement,this.currentTarget=e;e=t.relatedTarget;e?goog.userAgent.GECKO&&(goog.reflect.canAccessProperty(e,"nodeName")||(e=null)):i==goog.events.EventType.MOUSEOVER?e=t.fromElement:i==goog.events.EventType.MOUSEOUT&&(e=t.toElement),this.relatedTarget=e,this.offsetX=goog.userAgent.WEBKIT||void 0!==t.offsetX?t.offsetX:t.layerX,this.offsetY=goog.userAgent.WEBKIT||void 0!==t.offsetY?t.offsetY:t.layerY,this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0,this.button=t.button,this.keyCode=t.keyCode||0,this.charCode=t.charCode||("keypress"==i?t.keyCode:0),this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.platformModifierKey=goog.userAgent.MAC?t.metaKey:t.ctrlKey,this.state=t.state,(this.event_=t).defaultPrevented&&this.preventDefault()},goog.events.BrowserEvent.prototype.isButton=function(t){return goog.events.BrowserFeature.HAS_W3C_BUTTON?this.event_.button==t:"click"==this.type?t==goog.events.BrowserEvent.MouseButton.LEFT:!!(this.event_.button&goog.events.BrowserEvent.IEButtonMap[t])},goog.events.BrowserEvent.prototype.isMouseActionButton=function(){return this.isButton(goog.events.BrowserEvent.MouseButton.LEFT)&&!(goog.userAgent.WEBKIT&&goog.userAgent.MAC&&this.ctrlKey)},goog.events.BrowserEvent.prototype.stopPropagation=function(){goog.events.BrowserEvent.superClass_.stopPropagation.call(this),this.event_.stopPropagation?this.event_.stopPropagation():this.event_.cancelBubble=!0},goog.events.BrowserEvent.prototype.preventDefault=function(){goog.events.BrowserEvent.superClass_.preventDefault.call(this);var t=this.event_;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,goog.events.BrowserFeature.SET_KEY_CODE_TO_PREVENT_DEFAULT)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},goog.events.BrowserEvent.prototype.getBrowserEvent=function(){return this.event_},goog.events.BrowserEvent.prototype.disposeInternal=function(){},goog.provide("goog.debug.EntryPointMonitor"),goog.provide("goog.debug.entryPointRegistry"),goog.require("goog.asserts"),goog.debug.EntryPointMonitor=function(){},goog.debug.EntryPointMonitor.prototype.wrap,goog.debug.EntryPointMonitor.prototype.unwrap,goog.debug.entryPointRegistry.refList_=[],goog.debug.entryPointRegistry.monitors_=[],goog.debug.entryPointRegistry.monitorsMayExist_=!1,goog.debug.entryPointRegistry.register=function(t){if(goog.debug.entryPointRegistry.refList_[goog.debug.entryPointRegistry.refList_.length]=t,goog.debug.entryPointRegistry.monitorsMayExist_)for(var e=goog.debug.entryPointRegistry.monitors_,i=0;i<e.length;i++)t(goog.bind(e[i].wrap,e[i]))},goog.debug.entryPointRegistry.monitorAll=function(t){goog.debug.entryPointRegistry.monitorsMayExist_=!0;for(var e=goog.bind(t.wrap,t),i=0;i<goog.debug.entryPointRegistry.refList_.length;i++)goog.debug.entryPointRegistry.refList_[i](e);goog.debug.entryPointRegistry.monitors_.push(t)},goog.debug.entryPointRegistry.unmonitorAllIfPossible=function(t){var e=goog.debug.entryPointRegistry.monitors_;goog.asserts.assert(t==e[e.length-1],"Only the most recent monitor can be unwrapped.");for(var i=goog.bind(t.unwrap,t),o=0;o<goog.debug.entryPointRegistry.refList_.length;o++)goog.debug.entryPointRegistry.refList_[o](i);e.length--},goog.provide("goog.events.Listenable"),goog.provide("goog.events.ListenableKey"),goog.require("goog.events.EventId"),goog.events.Listenable=function(){},goog.events.Listenable.IMPLEMENTED_BY_PROP="closure_listenable_"+(1e6*Math.random()|0),goog.events.Listenable.addImplementation=function(t){t.prototype[goog.events.Listenable.IMPLEMENTED_BY_PROP]=!0},goog.events.Listenable.isImplementedBy=function(t){return!(!t||!t[goog.events.Listenable.IMPLEMENTED_BY_PROP])},goog.events.Listenable.prototype.listen,goog.events.Listenable.prototype.listenOnce,goog.events.Listenable.prototype.unlisten,goog.events.Listenable.prototype.unlistenByKey,goog.events.Listenable.prototype.dispatchEvent,goog.events.Listenable.prototype.removeAllListeners,goog.events.Listenable.prototype.getParentEventTarget,goog.events.Listenable.prototype.fireListeners,goog.events.Listenable.prototype.getListeners,goog.events.Listenable.prototype.getListener,goog.events.Listenable.prototype.hasListener,goog.events.ListenableKey=function(){},goog.events.ListenableKey.counter_=0,goog.events.ListenableKey.reserveKey=function(){return++goog.events.ListenableKey.counter_},goog.events.ListenableKey.prototype.src,goog.events.ListenableKey.prototype.type,goog.events.ListenableKey.prototype.listener,goog.events.ListenableKey.prototype.capture,goog.events.ListenableKey.prototype.handler,goog.events.ListenableKey.prototype.key,goog.provide("goog.events.Listener"),goog.require("goog.events.ListenableKey"),goog.events.Listener=function(t,e,i,o,r,n){goog.events.Listener.ENABLE_MONITORING&&(this.creationStack=(new Error).stack),this.listener=t,this.proxy=e,this.src=i,this.type=o,this.capture=!!r,this.handler=n,this.key=goog.events.ListenableKey.reserveKey(),this.callOnce=!1,this.removed=!1},goog.define("goog.events.Listener.ENABLE_MONITORING",!1),goog.events.Listener.prototype.creationStack,goog.events.Listener.prototype.markAsRemoved=function(){this.removed=!0,this.listener=null,this.proxy=null,this.src=null,this.handler=null},goog.provide("goog.events.ListenerMap"),goog.require("goog.array"),goog.require("goog.events.Listener"),goog.require("goog.object"),goog.events.ListenerMap=function(t){this.src=t,this.listeners={},this.typeCount_=0},goog.events.ListenerMap.prototype.getTypeCount=function(){return this.typeCount_},goog.events.ListenerMap.prototype.getListenerCount=function(){var t,e=0;for(t in this.listeners)e+=this.listeners[t].length;return e},goog.events.ListenerMap.prototype.add=function(t,e,i,o,r){var n=t.toString(),s=this.listeners[n];s||(s=this.listeners[n]=[],this.typeCount_++);var a,t=goog.events.ListenerMap.findListenerIndex_(s,e,o,r);return-1<t?(a=s[t],i||(a.callOnce=!1)):((a=new goog.events.Listener(e,null,this.src,n,!!o,r)).callOnce=i,s.push(a)),a},goog.events.ListenerMap.prototype.remove=function(t,e,i,o){var r=t.toString();if(!(r in this.listeners))return!1;t=this.listeners[r],o=goog.events.ListenerMap.findListenerIndex_(t,e,i,o);return-1<o&&(t[o].markAsRemoved(),goog.array.removeAt(t,o),0==t.length&&(delete this.listeners[r],this.typeCount_--),!0)},goog.events.ListenerMap.prototype.removeByKey=function(t){var e=t.type;if(!(e in this.listeners))return!1;var i=goog.array.remove(this.listeners[e],t);return i&&(t.markAsRemoved(),0==this.listeners[e].length&&(delete this.listeners[e],this.typeCount_--)),i},goog.events.ListenerMap.prototype.removeAll=function(t){var e,i=t&&t.toString(),o=0;for(e in this.listeners)if(!i||e==i){for(var r=this.listeners[e],n=0;n<r.length;n++)++o,r[n].markAsRemoved();delete this.listeners[e],this.typeCount_--}return o},goog.events.ListenerMap.prototype.getListeners=function(t,e){var i=this.listeners[t.toString()],o=[];if(i)for(var r=0;r<i.length;++r){var n=i[r];n.capture==e&&o.push(n)}return o},goog.events.ListenerMap.prototype.getListener=function(t,e,i,o){var r=this.listeners[t.toString()],t=-1;return-1<(t=r?goog.events.ListenerMap.findListenerIndex_(r,e,i,o):t)?r[t]:null},goog.events.ListenerMap.prototype.hasListener=function(t,o){var r=goog.isDef(t),n=r?t.toString():"",s=goog.isDef(o);return goog.object.some(this.listeners,function(t,e){for(var i=0;i<t.length;++i)if(!(r&&t[i].type!=n||s&&t[i].capture!=o))return!0;return!1})},goog.events.ListenerMap.findListenerIndex_=function(t,e,i,o){for(var r=0;r<t.length;++r){var n=t[r];if(!n.removed&&n.listener==e&&n.capture==!!i&&n.handler==o)return r}return-1},goog.provide("goog.events"),goog.provide("goog.events.CaptureSimulationMode"),goog.provide("goog.events.Key"),goog.provide("goog.events.ListenableType"),goog.require("goog.asserts"),goog.require("goog.debug.entryPointRegistry"),goog.require("goog.events.BrowserEvent"),goog.require("goog.events.BrowserFeature"),goog.require("goog.events.Listenable"),goog.require("goog.events.ListenerMap"),goog.forwardDeclare("goog.debug.ErrorHandler"),goog.forwardDeclare("goog.events.EventWrapper"),goog.events.Key,goog.events.ListenableType,goog.events.LISTENER_MAP_PROP_="closure_lm_"+(1e6*Math.random()|0),goog.events.onString_="on",goog.events.onStringMap_={},goog.events.CaptureSimulationMode={OFF_AND_FAIL:0,OFF_AND_SILENT:1,ON:2},goog.define("goog.events.CAPTURE_SIMULATION_MODE",2),goog.events.listenerCountEstimate_=0,goog.events.listen=function(t,e,i,o,r){if(goog.isArray(e)){for(var n=0;n<e.length;n++)goog.events.listen(t,e[n],i,o,r);return null}return i=goog.events.wrapListener(i),goog.events.Listenable.isImplementedBy(t)?t.listen(e,i,o,r):goog.events.listen_(t,e,i,!1,o,r)},goog.events.listen_=function(t,e,i,o,r,n){if(!e)throw Error("Invalid event type");var s=!!r;if(s&&!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_FAIL)return goog.asserts.fail("Can not register capture listener in IE8-."),null;if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_SILENT)return null}var a=goog.events.getListenerMap_(t);a||(t[goog.events.LISTENER_MAP_PROP_]=a=new goog.events.ListenerMap(t));r=a.add(e,i,o,r,n);if(r.proxy)return r;n=goog.events.getProxy();return(r.proxy=n).src=t,n.listener=r,t.addEventListener?t.addEventListener(e.toString(),n,s):t.attachEvent(goog.events.getOnString_(e.toString()),n),goog.events.listenerCountEstimate_++,r},goog.events.getProxy=function(){var e=goog.events.handleBrowserEvent_,i=goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT?function(t){return e.call(i.src,i.listener,t)}:function(t){t=e.call(i.src,i.listener,t);return t&&void 0};return i},goog.events.listenOnce=function(t,e,i,o,r){if(goog.isArray(e)){for(var n=0;n<e.length;n++)goog.events.listenOnce(t,e[n],i,o,r);return null}return i=goog.events.wrapListener(i),goog.events.Listenable.isImplementedBy(t)?t.listenOnce(e,i,o,r):goog.events.listen_(t,e,i,!0,o,r)},goog.events.listenWithWrapper=function(t,e,i,o,r){e.listen(t,i,o,r)},goog.events.unlisten=function(t,e,i,o,r){if(goog.isArray(e)){for(var n=0;n<e.length;n++)goog.events.unlisten(t,e[n],i,o,r);return null}if(i=goog.events.wrapListener(i),goog.events.Listenable.isImplementedBy(t))return t.unlisten(e,i,o,r);if(!t)return!1;var s=!!o,a=goog.events.getListenerMap_(t);if(a){s=a.getListener(e,i,s,r);if(s)return goog.events.unlistenByKey(s)}return!1},goog.events.unlistenByKey=function(t){if(goog.isNumber(t))return!1;var e=t;if(!e||e.removed)return!1;var i=e.src;if(goog.events.Listenable.isImplementedBy(i))return i.unlistenByKey(e);var o=e.type,t=e.proxy;i.removeEventListener?i.removeEventListener(o,t,e.capture):i.detachEvent&&i.detachEvent(goog.events.getOnString_(o),t),goog.events.listenerCountEstimate_--;t=goog.events.getListenerMap_(i);return t?(t.removeByKey(e),0==t.getTypeCount()&&(t.src=null,i[goog.events.LISTENER_MAP_PROP_]=null)):e.markAsRemoved(),!0},goog.events.unlistenWithWrapper=function(t,e,i,o,r){e.unlisten(t,i,o,r)},goog.events.removeAll=function(t,e){if(!t)return 0;if(goog.events.Listenable.isImplementedBy(t))return t.removeAllListeners(e);var i=goog.events.getListenerMap_(t);if(!i)return 0;var o,r=0,n=e&&e.toString();for(o in i.listeners)if(!n||o==n)for(var s=i.listeners[o].concat(),a=0;a<s.length;++a)goog.events.unlistenByKey(s[a])&&++r;return r},goog.events.removeAllNativeListeners=function(){return goog.events.listenerCountEstimate_=0},goog.events.getListeners=function(t,e,i){if(goog.events.Listenable.isImplementedBy(t))return t.getListeners(e,i);if(!t)return[];t=goog.events.getListenerMap_(t);return t?t.getListeners(e,i):[]},goog.events.getListener=function(t,e,i,o,r){i=goog.events.wrapListener(i);o=!!o;if(goog.events.Listenable.isImplementedBy(t))return t.getListener(e,i,o,r);if(!t)return null;t=goog.events.getListenerMap_(t);return t?t.getListener(e,i,o,r):null},goog.events.hasListener=function(t,e,i){if(goog.events.Listenable.isImplementedBy(t))return t.hasListener(e,i);t=goog.events.getListenerMap_(t);return!!t&&t.hasListener(e,i)},goog.events.expose=function(t){var e,i=[];for(e in t)t[e]&&t[e].id?i.push(e+" = "+t[e]+" ("+t[e].id+")"):i.push(e+" = "+t[e]);return i.join("\n")},goog.events.getOnString_=function(t){return t in goog.events.onStringMap_?goog.events.onStringMap_[t]:goog.events.onStringMap_[t]=goog.events.onString_+t},goog.events.fireListeners=function(t,e,i,o){return goog.events.Listenable.isImplementedBy(t)?t.fireListeners(e,i,o):goog.events.fireListeners_(t,e,i,o)},goog.events.fireListeners_=function(t,e,i,o){var r=1,t=goog.events.getListenerMap_(t);if(t&&(n=t.listeners[e.toString()]))for(var n=n.concat(),s=0;s<n.length;s++){var a=n[s];a&&a.capture==i&&!a.removed&&(r&=!1!==goog.events.fireListener(a,o))}return Boolean(r)},goog.events.fireListener=function(t,e){var i=t.listener,o=t.handler||t.src;return t.callOnce&&goog.events.unlistenByKey(t),i.call(o,e)},goog.events.getTotalListenerCount=function(){return goog.events.listenerCountEstimate_},goog.events.dispatchEvent=function(t,e){return goog.asserts.assert(goog.events.Listenable.isImplementedBy(t),"Can not use goog.events.dispatchEvent with non-goog.events.Listenable instance."),t.dispatchEvent(e)},goog.events.protectBrowserEventEntryPoint=function(t){goog.events.handleBrowserEvent_=t.protectEntryPoint(goog.events.handleBrowserEvent_)},goog.events.handleBrowserEvent_=function(t,e){if(t.removed)return!0;if(goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT)return goog.events.fireListener(t,new goog.events.BrowserEvent(e,this));var e=e||goog.getObjectByName("window.event"),i=new goog.events.BrowserEvent(e,this),o=!0;if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.ON){if(!goog.events.isMarkedIeEvent_(e)){goog.events.markIeEvent_(e);for(var r=[],n=i.currentTarget;n;n=n.parentNode)r.push(n);for(var s=t.type,a=r.length-1;!i.propagationStopped_&&0<=a;a--)i.currentTarget=r[a],o&=goog.events.fireListeners_(r[a],s,!0,i);for(a=0;!i.propagationStopped_&&a<r.length;a++)i.currentTarget=r[a],o&=goog.events.fireListeners_(r[a],s,!1,i)}}else o=goog.events.fireListener(t,i);return o},goog.events.markIeEvent_=function(t){var e=!1;if(0==t.keyCode)try{return void(t.keyCode=-1)}catch(t){e=!0}!e&&null!=t.returnValue||(t.returnValue=!0)},goog.events.isMarkedIeEvent_=function(t){return t.keyCode<0||null!=t.returnValue},goog.events.uniqueIdCounter_=0,goog.events.getUniqueId=function(t){return t+"_"+goog.events.uniqueIdCounter_++},goog.events.getListenerMap_=function(t){t=t[goog.events.LISTENER_MAP_PROP_];return t instanceof goog.events.ListenerMap?t:null},goog.events.LISTENER_WRAPPER_PROP_="__closure_events_fn_"+(1e9*Math.random()>>>0),goog.events.wrapListener=function(e){return goog.asserts.assert(e,"Listener can not be null."),goog.isFunction(e)?e:(goog.asserts.assert(e.handleEvent,"An object listener must have handleEvent method."),e[goog.events.LISTENER_WRAPPER_PROP_]||(e[goog.events.LISTENER_WRAPPER_PROP_]=function(t){return e.handleEvent(t)}),e[goog.events.LISTENER_WRAPPER_PROP_])},goog.debug.entryPointRegistry.register(function(t){goog.events.handleBrowserEvent_=t(goog.events.handleBrowserEvent_)}),function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define([],e):t.ol=e()}(this,function(){function l(t){return void 0!==t}function t(t,e,i){t=t.split("."),i=i||Xy,t[0]in i||!i.execScript||i.execScript("var "+t[0]);for(var o;t.length&&(o=t.shift());)!t.length&&l(e)?i[o]=e:i=i[o]||(i[o]={})}function p(){}function e(t){t.Zb=function(){return t.Ug||(t.Ug=new t)}}function r(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var i=Object.prototype.toString.call(t);if("[object Window]"==i)return"object";if("[object Array]"==i||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==i||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function w(t){return"array"==r(t)}function h(t){var e=r(t);return"array"==e||"object"==e&&"number"==typeof t.length}function u(t){return"string"==typeof t}function y(t){return"number"==typeof t}function c(t){return"function"==r(t)}function d(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function R(t){return t[Ky]||(t[Ky]=++$y)}function o(t,e,i){return t.call.apply(t.bind,arguments)}function n(e,i,t){if(!e)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,o),e.apply(i,t)}}return function(){return e.apply(i,arguments)}}function f(t,e,i){return(f=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?o:n).apply(null,arguments)}function j(e,t){var i=Array.prototype.slice.call(arguments,1);return function(){var t=i.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function i(t,n){function e(){}e.prototype=n.prototype,t.da=n.prototype,t.prototype=new e,(t.prototype.constructor=t).Hp=function(t,e,i){for(var o=Array(arguments.length-2),r=2;r<arguments.length;r++)o[r-2]=arguments[r];return n.prototype[e].apply(t,o)}}function s(){}function a(t){var e;Error.captureStackTrace?Error.captureStackTrace(this,a):(e=Error().stack)&&(this.stack=e),t&&(this.message=String(t))}function g(t,e){var i=t.length-e.length;return 0<=i&&t.indexOf(e,i)==i}function m(t){return lm.test(t)&&(-1!=(t=-1!=(t=-1!=(t=-1!=(t=-1!=(t=-1!=t.indexOf("&")?t.replace(im,"&amp;"):t).indexOf("<")?t.replace(om,"&lt;"):t).indexOf(">")?t.replace(rm,"&gt;"):t).indexOf('"')?t.replace(nm,"&quot;"):t).indexOf("'")?t.replace(sm,"&#39;"):t).indexOf("\0")&&(t=t.replace(am,"&#0;"))),t}function _(t){var e=(t=String(t)).indexOf(".");return-1==e&&(e=t.length),hm("0",Math.max(0,2-e))+t}function v(t,e){for(var i=0,o=em(String(t)).split("."),r=em(String(e)).split("."),n=Math.max(o.length,r.length),s=0;0==i&&s<n;s++){var a=o[s]||"",l=r[s]||"",h=RegExp("(\\d*)(\\D*)","g"),p=RegExp("(\\d*)(\\D*)","g");do{var c=h.exec(a)||["","",""],u=p.exec(l)||["","",""]}while((0!=c[0].length||0!=u[0].length)&&0==(i=b(0==c[1].length?0:parseInt(c[1],10),0==u[1].length?0:parseInt(u[1],10))||b(0==c[2].length,0==u[2].length)||b(c[2],u[2])))}return i}function b(t,e){return t<e?-1:e<t?1:0}function x(t,e,i){return Math.min(Math.max(t,e),i)}function M(t,e,i,o,r,n){var s,a=r-i,l=n-o;return 0==a&&0==l||(1<(s=((t-i)*a+(e-o)*l)/(a*a+l*l))?(i=r,o=n):0<s&&(i+=a*s,o+=l*s)),P(t,e,i,o)}function P(t,e,i,o){return(t=i-t)*t+(e=o-e)*e}function E(t){return t*Math.PI/180}function S(t){return t}function T(t,e){return cm.indexOf.call(t,e,void 0)}function A(t,e){e=C(t,e,void 0);return e<0?null:u(t)?t.charAt(e):t[e]}function C(t,e,i){for(var o=t.length,r=u(t)?t.split(""):t,n=0;n<o;n++)if(n in r&&e.call(i,r[n],n,t))return n;return-1}function I(t,e){var i=T(t,e);return(e=0<=i)&&cm.splice.call(t,i,1),e}function L(t){return cm.concat.apply(cm,arguments)}function O(t){var e=t.length;if(0<e){for(var i=Array(e),o=0;o<e;o++)i[o]=t[o];return i}return[]}function D(t,e){for(var i=1;i<arguments.length;i++){var o=arguments[i];if(h(o)){var r=t.length||0,n=o.length||0;t.length=r+n;for(var s=0;s<n;s++)t[r+s]=o[s]}else t.push(o)}}function k(t,e,i){return arguments.length<=2?cm.slice.call(t,e):cm.slice.call(t,e,i)}function z(t){for(var e=xs,i=0;i<t.length;i++)t[i]={index:i,value:t[i]};var o=e;for(e=function(t,e){return o(t.value,e.value)||t.index-e.index},t.sort(e||N),i=0;i<t.length;i++)t[i]=t[i].value}function F(t,e){if(!h(t)||!h(e)||t.length!=e.length)return!1;for(var i=t.length,o=U,r=0;r<i;r++)if(!o(t[r],e[r]))return!1;return!0}function N(t,e){return e<t?1:t<e?-1:0}function U(t,e){return t===e}function B(t){for(var e=[],i=0;i<arguments.length;i++){var o=arguments[i];if(w(o))for(var r=0;r<o.length;r+=8192)for(var n=k(o,r,r+8192),n=B.apply(null,n),s=0;s<n.length;s++)e.push(n[s]);else e.push(o)}return e}function Z(t,e){return e<t?1:t<e?-1:0}function G(t,e){return 0<=t.indexOf(e)}function V(t,e,i){var o=t.length;if(t[0]<=e)return 0;if(!(e<=t[o-1]))if(0<i){for(i=1;i<o;++i)if(t[i]<e)return i-1}else if(i<0){for(i=1;i<o;++i)if(t[i]<=e)return i}else for(i=1;i<o;++i){if(t[i]==e)return i;if(t[i]<e)return t[i-1]-e<e-t[i]?i-1:i}return o-1}function W(t){return void 0!==t?0:void 0}function H(t,e){return void 0!==t?t+e:void 0}function q(t,e,i){this.center=t,this.resolution=e,this.rotation=i}function Y(t){return-1!=tm.indexOf(t)}function X(t,e,i){for(var o in t)e.call(i,t[o],o,t)}function K(t,e){for(var i in t)if(e.call(void 0,t[i],i,t))return!0;return!1}function $(t){var e,i=0;for(e in t)i++;return i}function J(t){var e,i=[],o=0;for(e in t)i[o++]=t[e];return i}function Q(t,e){for(var i in t)if(e.call(void 0,t[i],i,t))return i}function tt(t){for(var e in t)return!1;return!0}function et(t){for(var e in t)delete t[e]}function it(t,e,i){return e in t?t[e]:i}function ot(t,e){return e in t?t[e]:t[e]=[]}function rt(t){var e,i={};for(e in t)i[e]=t[e];return i}function nt(t,e){for(var i,o,r=1;r<arguments.length;r++){for(i in o=arguments[r])t[i]=o[i];for(var n=0;n<dm.length;n++)i=dm[n],Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}}function st(){var t=Xy.document;return t?t.documentMode:void 0}function at(t){return Mm[t]||(Mm[t]=0<=v(wm,t))}function lt(){0!=Cm&&(Im[R(this)]=this),this.pa=this.pa,this.wa=this.wa}function ht(t,e){e=j(pt,e);t.pa?e.call(void 0):(t.wa||(t.wa=[]),t.wa.push(e))}function pt(t){t&&"function"==typeof t.rc&&t.rc()}function ct(t,e){this.type=t,this.g=this.target=e,this.j=!1,this.Zh=!0}function ut(t){t.b()}function dt(t){t.preventDefault()}function ft(t){return ft[" "](t),t}function gt(t,e){if(ct.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.G=this.i=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0,this.B=this.c=this.f=this.o=!1,this.state=null,this.l=!1,this.a=null,t){var i=this.type=t.type,o=t.changedTouches?t.changedTouches[0]:null;this.target=t.target||t.srcElement,this.g=e;var r,n=t.relatedTarget;if(n){if(mm){t:{try{ft(n.nodeName),r=!0;break t}catch(t){}r=!1}r||(n=null)}}else"mouseover"==i?n=t.fromElement:"mouseout"==i&&(n=t.toElement);this.relatedTarget=n,null===o?(this.offsetX=_m||void 0!==t.offsetX?t.offsetX:t.layerX,this.offsetY=_m||void 0!==t.offsetY?t.offsetY:t.layerY,this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0):(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=t.button,this.i=t.keyCode||0,this.G=t.charCode||("keypress"==i?t.keyCode:0),this.o=t.ctrlKey,this.f=t.altKey,this.c=t.shiftKey,this.B=t.metaKey,this.l=vm?t.metaKey:t.ctrlKey,this.state=t.state,(this.a=t).defaultPrevented&&this.preventDefault()}}function yt(t){return(Sm?0==t.a.button:"click"==t.type||t.a.button&Lm[0])&&!(_m&&vm&&t.o)}function mt(t){return t&&t[Om]}function _t(t,e,i,o,r){this.listener=t,this.a=null,this.src=e,this.type=i,this.dd=!!o,this.me=r,this.key=++Rm,this.Vc=this.Wd=!1}function vt(t){t.Vc=!0,t.listener=null,t.a=null,t.src=null,t.me=null}function bt(t){this.src=t,this.a={},this.f=0}function xt(t,e,i,o,r,n){var s=e.toString();(e=t.a[s])||(e=t.a[s]=[],t.f++);var a=Et(e,i,r,n);return-1<a?(t=e[a],o||(t.Wd=!1)):((t=new _t(i,t.src,s,!!r,n)).Wd=o,e.push(t)),t}function wt(t,e){var i=e.type;if(!(i in t.a))return!1;var o=I(t.a[i],e);return o&&(vt(e),0==t.a[i].length&&(delete t.a[i],t.f--)),o}function Mt(t,e,i,o,r){return t=t.a[e.toString()],(e=-1)<(e=t?Et(t,i,o,r):e)?t[e]:null}function Pt(t,e,i){var o=l(e),r=o?e.toString():"",n=l(i);return K(t.a,function(t){for(var e=0;e<t.length;++e)if(!(o&&t[e].type!=r||n&&t[e].dd!=i))return!0;return!1})}function Et(t,e,i,o){for(var r=0;r<t.length;++r){var n=t[r];if(!n.Vc&&n.listener==e&&n.dd==!!i&&n.me==o)return r}return-1}function St(t,e,i,o,r){if(w(e)){for(var n=0;n<e.length;n++)St(t,e[n],i,o,r);return null}return i=zt(i),mt(t)?t.Sa(e,i,o,r):Tt(t,e,i,!1,o,r)}function Tt(t,e,i,o,r,n){if(!e)throw Error("Invalid event type");var s,a,l=!!r,h=kt(t);if(h||(t[Dm]=h=new bt(t)),(i=xt(h,e,i,o,r,n)).a)return i;if(s=Dt,a=Tm?function(t){return s.call(a.src,a.listener,t)}:function(t){return(t=s.call(a.src,a.listener,t))&&void 0},(i.a=o=a).src=t,o.listener=i,t.addEventListener)t.addEventListener(e.toString(),o,l);else{if(!t.attachEvent)throw Error("addEventListener and attachEvent are unavailable.");t.attachEvent(Lt(e.toString()),o)}return i}function At(t,e,i,o,r){if(w(e)){for(var n=0;n<e.length;n++)At(t,e[n],i,o,r);return null}return i=zt(i),mt(t)?xt(t.Ab,String(e),i,!0,o,r):Tt(t,e,i,!0,o,r)}function Ct(t,e,i,o,r){if(w(e))for(var n=0;n<e.length;n++)Ct(t,e[n],i,o,r);else i=zt(i),mt(t)?t.$f(e,i,o,r):(t=t&&kt(t))&&(e=Mt(t,e,i,!!o,r))&&It(e)}function It(t){if(y(t)||!t||t.Vc)return!1;var e=t.src;if(mt(e))return wt(e.Ab,t);var i=t.type,o=t.a;return e.removeEventListener?e.removeEventListener(i,o,t.dd):e.detachEvent&&e.detachEvent(Lt(i),o),(i=kt(e))?(wt(i,t),0==i.f&&(i.src=null,e[Dm]=null)):vt(t),!0}function Lt(t){return t in km?km[t]:km[t]="on"+t}function Ot(t,e,i,o){var r=!0;if((t=kt(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var n=e[t];n&&n.dd==i&&!n.Vc&&(n=Rt(n,o),r=r&&!1!==n)}return r}function Rt(t,e){var i=t.listener,o=t.me||t.src;return t.Wd&&It(t),i.call(o,e)}function Dt(t,e){if(t.Vc)return!0;if(Tm)return Rt(t,new gt(e,this));if(!(o=e))t:{for(var i,o=["window","event"],r=Xy;i=o.shift();){if(null==r[i]){o=null;break t}r=r[i]}o=r}if(o=new gt(i=o,this),r=!0,!(i.keyCode<0||null!=i.returnValue)){t:{var n=!1;if(0==i.keyCode)try{i.keyCode=-1;break t}catch(t){n=!0}!n&&null!=i.returnValue||(i.returnValue=!0)}for(i=[],n=o.g;n;n=n.parentNode)i.push(n);for(var n=t.type,s=i.length-1;!o.j&&0<=s;s--){o.g=i[s];var a=Ot(i[s],n,!0,o),r=r&&a}for(s=0;!o.j&&s<i.length;s++)o.g=i[s],a=Ot(i[s],n,!1,o),r=r&&a}return r}function kt(t){return(t=t[Dm])instanceof bt?t:null}function zt(e){return c(e)?e:(e[zm]||(e[zm]=function(t){return e.handleEvent(t)}),e[zm])}function Ft(){lt.call(this),this.Ab=new bt(this),(this.Pd=this).ib=null}function Nt(t,e,i,o){if(!(e=t.Ab.a[String(e)]))return!0;e=e.concat();for(var r=!0,n=0;n<e.length;++n){var s,a,l=e[n];l&&!l.Vc&&l.dd==i&&(s=l.listener,a=l.me||l.src,l.Wd&&wt(t.Ab,l),r=!1!==s.call(a,o)&&r)}return r&&0!=o.Zh}function Ut(t,e,i){return Pt(t.Ab,l(e)?String(e):void 0,i)}function Bt(){Ft.call(this),this.f=0}function jt(t){It(t)}function Zt(t,e,i){ct.call(this,t),this.key=e,this.oldValue=i}function Gt(t){Bt.call(this),R(this),this.G={},void 0!==t&&this.I(t)}function Vt(t){return Nm.hasOwnProperty(t)?Nm[t]:Nm[t]="change:"+t}function Wt(t,e,i){var o=Vt(e);t.s(new Zt(o,e,i)),t.s(new Zt("propertychange",e,i))}function Ht(t,e,i){return(i=void 0===i?[0,0]:i)[0]=t[0]+2*e,i[1]=t[1]+2*e,i}function qt(t,e,i){return(i=void 0===i?[0,0]:i)[0]=t[0]*e+.5|0,i[1]=t[1]*e+.5|0,i}function Yt(t,e){return w(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}function Xt(t,e){t%=e;return t*e<0?t+e:t}function Kt(t,e,i){return t+i*(e-t)}function $t(t,e){return t[0]+=e[0],t[1]+=e[1],t}function Jt(t,e){var i=t[0],o=t[1],r=e[0],n=e[1],s=r[0],r=r[1],a=n[0],t=a-s,e=(n=n[1])-r;return(i=0==t&&0==e?0:(t*(i-s)+e*(o-r))/(t*t+e*e||0))<=0||(1<=i?(s=a,r=n):(s+=i*t,r+=i*e)),[s,r]}function Qt(t,e){var i=Xt(t+180,360)-180,t=Math.abs(Math.round(3600*i));return Math.floor(t/3600)+" "+_(Math.floor(t/60%60))+" "+_(Math.floor(t%60))+" "+e.charAt(i<0?1:0)}function te(t,e,i){return t?e.replace("{x}",t[0].toFixed(i)).replace("{y}",t[1].toFixed(i)):""}function ee(t,e){for(var i=!0,o=t.length-1;0<=o;--o)if(t[o]!=e[o]){i=!1;break}return i}function ie(t,e){var i=Math.cos(e),o=Math.sin(e),e=t[1]*i+t[0]*o;return t[0]=t[0]*i-t[1]*o,t[1]=e,t}function oe(t,e){var i=t[0]-e[0],e=t[1]-e[1];return i*i+e*e}function re(t,e){return oe(t,Jt(t,e))}function ne(t,e){return te(t,"{x}, {y}",e)}function se(t){this.length=t.length||t;for(var e=0;e<this.length;e++)this[e]=t[e]||0}function ae(t){this.length=t.length||t;for(var e=0;e<this.length;e++)this[e]=t[e]||0}function le(){var t=Array(16);return pe(t,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),t}function he(){var t=Array(16);return pe(t,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),t}function pe(t,e,i,o,r,n,s,a,l,h,p,c,u,d,f,g,y){t[0]=e,t[1]=i,t[2]=o,t[3]=r,t[4]=n,t[5]=s,t[6]=a,t[7]=l,t[8]=h,t[9]=p,t[10]=c,t[11]=u,t[12]=d,t[13]=f,t[14]=g,t[15]=y}function ce(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}function ue(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}function de(t,e,i){var o=t[0],r=t[1],n=t[2],s=t[3],a=t[4],l=t[5],h=t[6],p=t[7],c=t[8],u=t[9],d=t[10],f=t[11],g=t[12],y=t[13],m=t[14];t=t[15];var _=e[0],v=e[1],b=e[2],x=e[3],w=e[4],M=e[5],P=e[6],E=e[7],S=e[8],T=e[9],A=e[10],C=e[11],I=e[12],L=e[13],O=e[14];e=e[15],i[0]=o*_+a*v+c*b+g*x,i[1]=r*_+l*v+u*b+y*x,i[2]=n*_+h*v+d*b+m*x,i[3]=s*_+p*v+f*b+t*x,i[4]=o*w+a*M+c*P+g*E,i[5]=r*w+l*M+u*P+y*E,i[6]=n*w+h*M+d*P+m*E,i[7]=s*w+p*M+f*P+t*E,i[8]=o*S+a*T+c*A+g*C,i[9]=r*S+l*T+u*A+y*C,i[10]=n*S+h*T+d*A+m*C,i[11]=s*S+p*T+f*A+t*C,i[12]=o*I+a*L+c*O+g*e,i[13]=r*I+l*L+u*O+y*e,i[14]=n*I+h*L+d*O+m*e,i[15]=s*I+p*L+f*O+t*e}function fe(t,e){var i=t[0],o=t[1],r=t[2],n=t[3],s=t[4],a=t[5],l=t[6],h=t[7],p=t[8],c=t[9],u=t[10],d=t[11],f=t[12],g=t[13],y=t[14],m=t[15],_=i*a-o*s,v=i*l-r*s,b=i*h-n*s,x=o*l-r*a,w=o*h-n*a,M=r*h-n*l,P=p*g-c*f,E=p*y-u*f,S=p*m-d*f,T=c*y-u*g,A=c*m-d*g,C=u*m-d*y,t=_*C-v*A+b*T+x*S-w*E+M*P;0!=t&&(e[0]=(a*C-l*A+h*T)*(t=1/t),e[1]=(-o*C+r*A-n*T)*t,e[2]=(g*M-y*w+m*x)*t,e[3]=(-c*M+u*w-d*x)*t,e[4]=(-s*C+l*S-h*E)*t,e[5]=(i*C-r*S+n*E)*t,e[6]=(-f*M+y*b-m*v)*t,e[7]=(p*M-u*b+d*v)*t,e[8]=(s*A-a*S+h*P)*t,e[9]=(-i*A+o*S-n*P)*t,e[10]=(f*w-g*b+m*_)*t,e[11]=(-p*w+c*b-d*_)*t,e[12]=(-s*T+a*E-l*P)*t,e[13]=(i*T-o*E+r*P)*t,e[14]=(-f*x+g*v-y*_)*t,e[15]=(p*x-c*v+u*_)*t)}function ge(t,e,i){var o=t[1]*e+t[5]*i+0*t[9]+t[13],r=t[2]*e+t[6]*i+0*t[10]+t[14],n=t[3]*e+t[7]*i+0*t[11]+t[15];t[12]=t[0]*e+t[4]*i+0*t[8]+t[12],t[13]=o,t[14]=r,t[15]=n}function ye(t,e,i){pe(t,t[0]*e,t[1]*e,t[2]*e,t[3]*e,t[4]*i,t[5]*i,t[6]*i,t[7]*i,+t[8],+t[9],+t[10],+t[11],t[12],t[13],t[14],t[15])}function me(t,e){var i=t[0],o=t[1],r=t[2],n=t[3],s=t[4],a=t[5],l=t[6],h=t[7],p=Math.cos(e),e=Math.sin(e);t[0]=i*p+s*e,t[1]=o*p+a*e,t[2]=r*p+l*e,t[3]=n*p+h*e,t[4]=i*-e+s*p,t[5]=o*-e+a*p,t[6]=r*-e+l*p,t[7]=n*-e+h*p}function _e(t){for(var e=Te(),i=0,o=t.length;i<o;++i)Re(e,t[i]);return e}function ve(t,e,i){return Ae(Math.min.apply(null,t),Math.min.apply(null,e),t=Math.max.apply(null,t),e=Math.max.apply(null,e),i)}function be(t,e,i){return i?(i[0]=t[0]-e,i[1]=t[1]-e,i[2]=t[2]+e,i[3]=t[3]+e,i):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function xe(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function we(t,e,i){return(e=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*e+(t=i<t[1]?t[1]-i:t[3]<i?i-t[3]:0)*t}function Me(t,e){return Ee(t,e[0],e[1])}function Pe(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function Ee(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function Se(t,e){var i=t[1],o=t[2],r=t[3],n=e[0],s=e[1],e=0;return n<t[0]?e|=16:o<n&&(e|=4),s<i?e|=8:r<s&&(e|=2),e=0===e?1:e}function Te(){return[1/0,1/0,-1/0,-1/0]}function Ae(t,e,i,o,r){return r?(r[0]=t,r[1]=e,r[2]=i,r[3]=o,r):[t,e,i,o]}function Ce(t,e){var i=t[0],t=t[1];return Ae(i,t,i,t,e)}function Ie(t,e,i,o,r){return De(r=Ae(1/0,1/0,-1/0,-1/0,r),t,e,i,o)}function Le(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function Oe(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function Re(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function De(t,e,i,o,r){for(;i<o;i+=r){var n=t,s=e[i],a=e[i+1];n[0]=Math.min(n[0],s),n[1]=Math.min(n[1],a),n[2]=Math.max(n[2],s),n[3]=Math.max(n[3],a)}return t}function ke(t,e,i){var o;return((o=e.call(i,Fe(t)))||(o=e.call(i,Ne(t)))||(o=e.call(i,Ve(t)))||!!(o=e.call(i,Ge(t))))&&o}function ze(t){var e=0;return e=!qe(t)?We(t)*je(t):e}function Fe(t){return[t[0],t[1]]}function Ne(t){return[t[2],t[1]]}function Ue(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function Be(t,e,i,o){var r,n,s,a=e*o[0]/2;for(o=e*o[1]/2,e=Math.cos(i),i=Math.sin(i),a=[-a,-a,a,a],o=[-o,o,-o,o],r=0;r<4;++r)n=a[r],s=o[r],a[r]=t[0]+n*e-s*i,o[r]=t[1]+n*i+s*e;return ve(a,o,void 0)}function je(t){return t[3]-t[1]}function Ze(t,e,i){return i=i||Te(),He(t,e)&&(i[0]=(t[0]>e[0]?t:e)[0],i[1]=(t[1]>e[1]?t:e)[1],i[2]=(t[2]<e[2]?t:e)[2],i[3]=(t[3]<e[3]?t:e)[3]),i}function Ge(t){return[t[0],t[3]]}function Ve(t){return[t[2],t[3]]}function We(t){return t[2]-t[0]}function He(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function qe(t){return t[2]<t[0]||t[3]<t[1]}function Ye(t,e){var i=(t[2]-t[0])/2*(e-1),e=(t[3]-t[1])/2*(e-1);t[0]-=i,t[2]+=i,t[1]-=e,t[3]+=e}function Xe(t,e,i){return e(t=[t[0],t[1],t[0],t[3],t[2],t[1],t[2],t[3]],t,2),ve([t[0],t[2],t[4],t[6]],[t[1],t[3],t[5],t[7]],i)}function Ke(t){return function(){return t}}function $e(t){return t}function Je(t){var e=arguments,i=e.length;return function(){for(var t=0;t<i;t++)if(!e[t].apply(this,arguments))return!1;return!0}}function Qe(t){this.radius=t}function ti(t){this.Ya=t.code,this.a=t.units,this.g=void 0!==t.extent?t.extent:null,this.i=void 0!==t.worldExtent?t.worldExtent:null,this.c=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.b=void 0!==t.global&&t.global,this.f=!(!this.b||!this.g),this.l=void 0!==t.getPointResolution?t.getPointResolution:this.nk,this.j=null,this.o=t.metersPerUnit;var e=Vm,i=t.code,o=Hm||Xy.proj4;if("function"==typeof o&&void 0===e[i]){var r=o.defs(i);if(void 0!==r)for(var n in void 0!==r.axis&&void 0===t.axisOrientation&&(this.c=r.axis),void 0===t.metersPerUnit&&(this.o=r.to_meter),void 0===t.units&&(this.a=r.units),e)e=o.defs(n),void 0!==e&&(t=ai(n),e===r?ei([t,this]):(e=o(n,i),ni(t,this,e.forward,e.inverse)))}}function ei(t){var e;e=[],t.forEach(function(t){e.push(ii(t))}),t.forEach(function(e){t.forEach(function(t){e!==t&&ri(e,t,ui)})})}function ii(t){ri(Vm[t.Ya]=t,t,ui)}function oi(t){return t?u(t)?ai(t):t:ai("EPSG:3857")}function ri(t,e,i){t=t.Ya,e=e.Ya,t in Wm||(Wm[t]={}),Wm[t][e]=i}function ni(t,e,i,o){ri(t=ai(t),e=ai(e),si(i)),ri(e,t,si(o))}function si(s){return function(t,e,i){var o,r,n=t.length;for(i=void 0!==i?i:2,e=void 0!==e?e:Array(n),r=0;r<n;r+=i)for(o=s([t[r],t[r+1]]),e[r]=o[0],e[r+1]=o[1],o=i-1;2<=o;--o)e[r+o]=t[r+o];return e}}function ai(t){var e,i;return t instanceof ti?e=t:u(t)?(e=Vm[t],i=Hm||Xy.proj4,void 0===e&&"function"==typeof i&&void 0!==i.defs(t)&&ii(e=new ti({code:t}))):e=null,e}function li(t,e){if(t===e)return 1;var i=t.a===e.a;return(t.Ya===e.Ya||pi(t,e)===ui)&&i}function hi(t,e){return pi(ai(t),ai(e))}function pi(t,e){var i,t=t.Ya,e=e.Ya;return i=void 0===(i=t in Wm&&e in Wm[t]?Wm[t][e]:i)?ci:i}function ci(t,e){if(void 0!==e&&t!==e){for(var i=0,o=t.length;i<o;++i)e[i]=t[i];t=e}return t}function ui(t,e){if(void 0!==e){for(var i=0,o=t.length;i<o;++i)e[i]=t[i];i=e}else i=t.slice();return i}function di(t,e,i){return hi(e,i)(t,void 0,t.length)}function fi(t,e,i){return Xe(t,e=hi(e,i))}function gi(){Gt.call(this),this.B=Te(),this.v=-1,this.i={},this.o=this.j=0}function yi(t,e,i,o,r,n){var s=r[0],a=r[1],l=r[4],h=r[5],p=r[12];r=r[13];for(var c=n||[],u=0;e<i;e+=o){var d=t[e],f=t[e+1];c[u++]=s*d+l*f+p,c[u++]=a*d+h*f+r}return n&&c.length!=u&&(c.length=u),c}function mi(){gi.call(this),this.b="XY",this.a=2,this.A=null}function _i(t){return"XY"==t?2:"XYZ"==t||"XYM"==t?3:"XYZM"==t?4:void 0}function vi(t,e,i){t.a=_i(e),t.b=e,t.A=i}function bi(t,e,i,o){if(e)i=_i(e);else{for(e=0;e<o;++e){if(0===i.length)return t.b="XY",t.a=2,0;i=i[0]}e=2==(i=i.length)?"XY":3==i?"XYZ":4==i?"XYZM":void 0}t.b=e,t.a=i}function xi(t,e,i,o){for(var r=0,n=t[i-o],s=t[i-o+1];e<i;e+=o)var a=t[e],l=t[e+1],r=r+(s*a-n*l),n=a,s=l;return r/2}function wi(t,e,i,o){for(var r=0,n=0,s=i.length;n<s;++n){var a=i[n],r=r+xi(t,e,a,o);e=a}return r}function Mi(t,e,i,o,r,n,s){var a=t[e],l=t[e+1],h=t[i]-a,p=t[i+1]-l;if(0!=h||0!=p)if(1<(n=((r-a)*h+(n-l)*p)/(h*h+p*p)))e=i;else if(0<n){for(r=0;r<o;++r)s[r]=Kt(t[e+r],t[i+r],n);return s.length=o,0}for(r=0;r<o;++r)s[r]=t[e+r];s.length=o}function Pi(t,e,i,o,r){var n=t[e],s=t[e+1];for(e+=o;e<i;e+=o){var a=t[e],l=t[e+1];r<(n=P(n,s,a,l))&&(r=n),n=a,s=l}return r}function Ei(t,e,i,o,r){for(var n=0,s=i.length;n<s;++n){var a=i[n];r=Pi(t,e,a,o,r),e=a}return r}function Si(t,e,i,o,r,n,s,a,l,h,p){if(e==i)return h;var c;if(0===r){if((c=P(s,a,t[e],t[e+1]))<h){for(p=0;p<o;++p)l[p]=t[e+p];return l.length=o,c}return h}for(var u=p||[NaN,NaN],d=e+o;d<i;)if(Mi(t,d-o,d,o,s,a,u),(c=P(s,a,u[0],u[1]))<h){for(h=c,p=0;p<o;++p)l[p]=u[p];d+=l.length=o}else d+=o*Math.max((Math.sqrt(c)-Math.sqrt(h))/r|0,1);if(n&&(Mi(t,i-o,e,o,s,a,u),(c=P(s,a,u[0],u[1]))<h)){for(h=c,p=0;p<o;++p)l[p]=u[p];l.length=o}return h}function Ti(t,e,i,o,r,n,s,a,l,h,p){var c,u;for(p=p||[NaN,NaN],c=0,u=i.length;c<u;++c){var d=i[c];h=Si(t,e,d,o,r,n,s,a,l,h,p),e=d}return h}function Ai(t,e){for(var i=0,o=0,r=e.length;o<r;++o)t[i++]=e[o];return i}function Ci(t,e,i,o){for(var r=0,n=i.length;r<n;++r)for(var s=i[r],a=0;a<o;++a)t[e++]=s[a];return e}function Ii(t,e,i,o,r){r=r||[];for(var n=0,s=0,a=i.length;s<a;++s)e=Ci(t,e,i[s],o),r[n++]=e;return r.length=n,r}function Li(t,e,i,o,r){r=void 0!==r?r:[];for(var n=0;e<i;e+=o)r[n++]=t.slice(e,e+o);return r.length=n,r}function Oi(t,e,i,o,r){r=void 0!==r?r:[];for(var n=0,s=0,a=i.length;s<a;++s){var l=i[s];r[n++]=Li(t,e,l,o,r[n]),e=l}return r.length=n,r}function Ri(t,e,i,o,r,n,s){var a=(i-e)/o;if(a<3){for(;e<i;e+=o)n[s++]=t[e],n[s++]=t[e+1];return s}var l=Array(a);l[0]=1,l[a-1]=1,i=[e,i-o];for(var h=0;0<i.length;){for(var p=i.pop(),c=i.pop(),u=0,d=t[c],f=t[c+1],g=t[p],y=t[p+1],m=c+o;m<p;m+=o){var _=M(t[m],t[m+1],d,f,g,y);u<_&&(h=m,u=_)}r<u&&(l[(h-e)/o]=1,c+o<h&&i.push(c,h),h+o<p&&i.push(h,p))}for(m=0;m<a;++m)l[m]&&(n[s++]=t[e+m*o],n[s++]=t[e+m*o+1]);return s}function Di(t,e,i,o,r,n,s,a){for(var l=0,h=i.length;l<h;++l){var p=i[l];t:{var c=t,u=p,d=o,f=r,g=n;if(e!=u){var y=f*Math.round(c[e]/f),m=f*Math.round(c[e+1]/f);e+=d,g[s++]=y,g[s++]=m;var _=void 0,v=void 0;do{if(_=f*Math.round(c[e]/f),v=f*Math.round(c[e+1]/f),(e+=d)==u){g[s++]=_,g[s++]=v;break t}}while(_==y&&v==m);for(;e<u;){var b,x,w,M,P=f*Math.round(c[e]/f),E=f*Math.round(c[e+1]/f);e+=d,P==_&&E==v||((b=_-y)*(M=E-m)==(x=v-m)*(w=P-y)&&(b<0&&w<b||b==w||0<b&&b<w)&&(x<0&&M<x||x==M||0<x&&x<M)||(y=g[s++]=_,m=g[s++]=v),_=P,v=E)}g[s++]=_,g[s++]=v}}a.push(s),e=p}return s}function ki(t,e){mi.call(this),this.g=this.l=-1,this.ma(t,e)}function zi(t,e,i){vi(t,e,i),t.u()}function Fi(t,e){mi.call(this),this.ma(t,e)}function Ni(t,e,i,o,r,n){for(var s=!1,a=t[i-o],l=t[i-o+1];e<i;e+=o){var h=t[e],p=t[e+1];n<l!=n<p&&r<(h-a)*(n-l)/(p-l)+a&&(s=!s),a=h,l=p}return s}function Ui(t,e,i,o,r,n){if(0===i.length||!Ni(t,e,i[0],o,r,n))return!1;var s;for(e=1,s=i.length;e<s;++e)if(Ni(t,i[e-1],i[e],o,r,n))return!1;return!0}function Bi(t,e,i,o,r,n,s){for(var a,l=r[n+1],h=[],p=i[0],c=t[p-o],u=t[p-o+1],d=e;d<p;d+=o)f=t[d],a=t[d+1],(l<=u&&a<=l||u<=l&&l<=a)&&h.push(c=(l-u)/(a-u)*(f-c)+c),c=f,u=a;for(p=NaN,u=-1/0,h.sort(Z),c=h[0],d=1,a=h.length;d<a;++d){var f=h[d],g=Math.abs(f-c);u<g&&(Ui(t,e,i,o,c=(c+f)/2,l)&&(p=c,u=g)),c=f}return isNaN(p)&&(p=r[n]),s?(s.push(p,l),s):[p,l]}function ji(t,e,i,o,r,n){for(var s,a=[t[e],t[e+1]],l=[];e+o<i;e+=o){if(l[0]=t[e+o],l[1]=t[e+o+1],s=r.call(n,a,l))return s;a[0]=l[0],a[1]=l[1]}return!1}function Zi(t,e,i,o,p){var r=De(Te(),t,e,i,o);return!!He(p,r)&&(!!(Pe(p,r)||r[0]>=p[0]&&r[2]<=p[2]||r[1]>=p[1]&&r[3]<=p[3])||ji(t,e,i,o,function(t,e){var i,o,r,n,s,a=!1,l=Se(p,t),h=Se(p,e);return 1===l||1===h?a=!0:(i=p[0],o=p[1],r=p[2],n=p[3],s=e[0],t=((e=e[1])-t[1])/(s-t[0]),(a=!(a=!(a=2&h&&!(2&l)?i<=(a=s-(e-n)/t)&&a<=r:a)&&4&h&&!(4&l)?o<=(a=e-(s-r)*t)&&a<=n:a)&&8&h&&!(8&l)?i<=(a=s-(e-o)/t)&&a<=r:a)||!(16&h)||16&l||(a=o<=(a=e-(s-i)*t)&&a<=n)),a}))}function Gi(t,e,i,o,r){var n=i[0];if(!(Zi(t,e,n,o,r)||Ni(t,e,n,o,r[0],r[1])||Ni(t,e,n,o,r[0],r[3])||Ni(t,e,n,o,r[2],r[1])||Ni(t,e,n,o,r[2],r[3])))return!1;if(1===i.length)return!0;for(e=1,n=i.length;e<n;++e)if(function(e,i,o,r,t){return!ke(t,function(t){return!Ni(e,i,o,r,t[0],t[1])})}(t,i[e-1],i[e],o,r))return!1;return!0}function Vi(t,e,i,o){for(var r=0,n=t[i-o],s=t[i-o+1];e<i;e+=o)var a=t[e],l=t[e+1],r=r+(a-n)*(l+s),n=a,s=l;return 0<r}function Wi(t,e,i,o){var r,n,s=0;for(o=void 0!==o&&o,r=0,n=e.length;r<n;++r){var a=e[r],s=Vi(t,s,a,i);if(0===r){if(o&&s||!o&&!s)return}else if(o&&!s||!o&&s)return;s=a}return 1}function Hi(t,e,i,o,r){var n,s;for(r=void 0!==r&&r,n=0,s=i.length;n<s;++n){var a=i[n],l=Vi(t,e,a,o);if(0===n?r&&l||!r&&!l:r&&!l||!r&&l)for(var l=t,h=a,p=o;e<h-p;){for(var c=0;c<p;++c){var u=l[e+c];l[e+c]=l[h-p+c],l[h-p+c]=u}e+=p,h-=p}e=a}return e}function qi(t,e,i,o){for(var r=0,n=0,s=e.length;n<s;++n)r=Hi(t,r,e[n],i,o);return r}function Yi(t,e){mi.call(this),this.g=[],this.C=-1,this.D=null,this.T=this.O=this.U=-1,this.l=null,this.ma(t,e)}function Xi(t){var e;return t.C!=t.f&&(e=Ue(t.J()),t.D=Bi(t.Rb(),0,t.g,t.a,e,0),t.C=t.f),t.D}function Ki(t,e,i,o){var r,n=o||32;for(o=[],r=0;r<n;++r)D(o,t.offset(e,i,2*Math.PI*r/n));return o.push(o[0],o[1]),(t=new Yi(null)).ba("XY",o,[o.length]),t}function $i(t){var e=t[0],i=t[1],o=t[2],e=[e,i,e,t=t[3],o,t,o,i,e,i];return(i=new Yi(null)).ba("XY",e,[e.length]),i}function Ji(t,e,i){for(var o=e||32,r=t.sa(),n=new Yi(null,e=t.b),o=r*(o+1),r=[],s=0;s<o;s++)r[s]=0;return n.ba(e,r,[r.length]),Qi(n,t.yd(),t.Df(),i),n}function Qi(t,e,i,o){var r=t.ja(),n=t.b,s=t.sa(),a=t.Bb(),l=r.length/s-1;o=o||0;for(var h,p,c=0;c<=l;++c)p=c*s,h=o+2*Xt(c,l)*Math.PI/l,r[p]=e[0]+i*Math.cos(h),r[1+p]=e[1]+i*Math.sin(h);t.ba(n,r,a)}function to(t){Gt.call(this),t=t||{},this.b=[0,0];var e={};e.center=void 0!==t.center?t.center:null,this.g=oi(t.projection);var i,o,r,n,s,a,l,h,p,c,u,d=void 0!==t.minZoom?t.minZoom:0,f=void 0!==t.maxZoom?t.maxZoom:28,g=void 0!==t.zoomFactor?t.zoomFactor:2;f=void 0!==t.resolutions?(i=(f=t.resolutions)[0],h=f[f.length-1],l=f,function(t,e,i){return void 0!==t?(t=x((t=V(l,t,i))+e,0,l.length-1),l[t]):void 0}):(r=(o=((h=(i=oi(t.projection)).J())?Math.max(We(h),je(h)):360*Gm.degrees/i.$b())/256/Math.pow(2,0))/Math.pow(2,28),void 0!==(i=t.maxResolution)?d=0:i=o/Math.pow(g,d),void 0===(h=t.minResolution)&&(h=void 0!==t.maxZoom?void 0!==t.maxResolution?i/Math.pow(g,f):o/Math.pow(g,f):r),f=d+Math.floor(Math.log(i/h)/Math.log(g)),h=i/Math.pow(g,f-d),n=g,s=i,a=f-d,function(t,e,i){return void 0!==t?(t=Math.max(Math.floor(Math.log(s/t)/Math.log(n)+(0<i?0:i<0?1:.5))+e,0),void 0!==a&&(t=Math.min(t,a)),s/Math.pow(n,t)):void 0}),this.a=i,this.j=h,this.c=d,d=void 0!==t.extent?(u=t.extent,function(t){return t?[x(t[0],u[0],u[2]),x(t[1],u[1],u[3])]:void 0}):S,i=void 0===t.enableRotation||t.enableRotation?void 0===(i=t.constrainRotation)||!0===i?(c=E(5),function(t,e){return void 0!==t?Math.abs(t+e)<=c?0:t+e:void 0}):!1!==i&&y(i)?(h=i,p=2*Math.PI/h,function(t,e){return void 0!==t?Math.floor((t+e)/p+.5)*p:void 0}):H:W,this.i=new q(d,f,i),void 0!==t.resolution?e.resolution=t.resolution:void 0!==t.zoom&&(e.resolution=this.constrainResolution(this.a,t.zoom-this.c)),e.rotation=void 0!==t.rotation?t.rotation:0,this.I(e)}function eo(t){var e=t.Va(),i=t.g,o=t.$();return t=t.Ha(),{center:[Math.round(e[0]/o)*o,Math.round(e[1]/o)*o],projection:void 0!==i?i:null,resolution:o,rotation:t}}function io(t){return t.Va()&&void 0!==t.$()}function oo(t,e){t.b[1]+=e}function ro(t){return Math.pow(t,3)}function no(t){return 1-ro(1-t)}function so(t){return 3*t*t-2*t*t*t}function ao(t){return t}function lo(t){return t<.5?so(2*t):1-so(2*(t-.5))}function ho(t){var e=t.source,n=t.start||Date.now(),s=e[0],a=e[1],l=void 0!==t.duration?t.duration:1e3,h=t.easing||so;return function(t,e){if(e.time<n)return e.animate=!0,e.viewHints[0]+=1,!0;if(e.time<n+l){var i=1-h((e.time-n)/l),o=s-e.viewState.center[0],r=a-e.viewState.center[1];return e.animate=!0,e.viewState.center[0]+=i*o,e.viewState.center[1]+=i*r,e.viewHints[0]+=1,!0}return!1}}function po(t){var r=t.rotation||0,n=t.start||Date.now(),s=void 0!==t.duration?t.duration:1e3,a=t.easing||so,l=t.anchor||null;return function(t,e){if(e.time<n)return e.animate=!0,e.viewHints[0]+=1,!0;if(e.time<n+s){var i,o=1-a((e.time-n)/s),o=(r-e.viewState.rotation)*o;return e.animate=!0,e.viewState.rotation+=o,l&&((i=e.viewState.center)[0]-=l[0],i[1]-=l[1],ie(i,o),$t(i,l)),e.viewHints[0]+=1,!0}return!1}}function co(t){var r=t.resolution,n=t.start||Date.now(),s=void 0!==t.duration?t.duration:1e3,a=t.easing||so;return function(t,e){if(e.time<n)return e.animate=!0,e.viewHints[0]+=1,!0;if(e.time<n+s){var i=1-a((e.time-n)/s),o=r-e.viewState.resolution;return e.animate=!0,e.viewState.resolution+=i*o,e.viewHints[0]+=1,!0}return!1}}function uo(t,e,i,o){return void 0!==o?(o[0]=t,o[1]=e,o[2]=i,o):[t,e,i]}function fo(t,e,i,o){this.a=t,this.c=e,this.f=i,this.b=o}function go(t,e,i){return t.a<=e&&e<=t.c&&t.f<=i&&i<=t.b}function yo(t){return t.b-t.f+1}function mo(t){return t.c-t.a+1}function _o(t,e){return t.a<=e.c&&t.c>=e.a&&t.f<=e.b&&t.b>=e.f}function vo(t){this.f=t.html,this.a=t.tileRanges||null}function bo(t,e,i){ct.call(this,t,i),this.element=e}function xo(t){Gt.call(this),this.a=t||[],wo(this)}function wo(t){t.set("length",t.a.length)}function Mo(t){return w(t)?t:Jm(t)}function Po(t){var e;return t=!u(t)?"rgba("+(e=(e=t[0])!=(0|e)?e+.5|0:e)+","+(e=(e=t[1])!=(0|e)?e+.5|0:e)+","+(e=(e=t[2])!=(0|e)?e+.5|0:e)+","+t[3]+")":t}function Eo(t,e){e=e||[];return e[0]=x(t[0]+.5|0,0,255),e[1]=x(t[1]+.5|0,0,255),e[2]=x(t[2]+.5|0,0,255),e[3]=x(t[3],0,1),e}function So(t,e){this.x=l(t)?t:0,this.y=l(e)?e:0}function To(t,e){this.width=t,this.height=e}function Ao(t){return t?new Bo(Uo(t)):Qy=Qy||new Bo}function Co(t){var e=document;return u(t)?e.getElementById(t):t}function Io(i,t){X(t,function(t,e){"style"==e?i.style.cssText=t:"class"==e?i.className=t:"for"==e?i.htmlFor=t:t_.hasOwnProperty(e)?i.setAttribute(t_[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?i.setAttribute(e,t):i[e]=t})}function Lo(t){return new To((t=t.document.documentElement).clientWidth,t.clientHeight)}function Oo(t,e,i){var o,r=arguments,n=document,s=r[0],a=r[1];return!Qm&&a&&(a.name||a.type)&&(s=["<",s],a.name&&s.push(' name="',m(a.name),'"'),a.type&&(s.push(' type="',m(a.type),'"'),nt(o={},a),delete o.type,a=o),s.push(">"),s=s.join("")),s=n.createElement(s),a&&(u(a)?s.className=a:w(a)?s.className=a.join(" "):Io(s,a)),2<r.length&&function(e,i,t){function o(t){t&&i.appendChild(u(t)?e.createTextNode(t):t)}for(var r=2;r<t.length;r++){var n=t[r];!h(n)||d(n)&&0<n.nodeType?o(n):function(t,e){cm.forEach.call(t,e,void 0)}(function(t){if(t&&"number"==typeof t.length){if(d(t))return"function"==typeof t.item||"string"==typeof t.item;if(c(t))return"function"==typeof t.item}return!1}(n)?O(n):n,o)}}(n,s,r),s}function Ro(t){for(var e;e=t.firstChild;)t.removeChild(e)}function Do(t,e,i){t.insertBefore(e,t.childNodes[i]||null)}function ko(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function zo(t,e){var i=e.parentNode;i&&i.replaceChild(t,e)}function Fo(t){if(l(t.firstElementChild))t=t.firstElementChild;else for(t=t.firstChild;t&&1!=t.nodeType;)t=t.nextSibling;return t}function No(t,e){if(t.contains&&1==e.nodeType)return t==e||t.contains(e);if(void 0!==t.compareDocumentPosition)return t==e||Boolean(16&t.compareDocumentPosition(e));for(;e&&t!=e;)e=e.parentNode;return e==t}function Uo(t){return 9==t.nodeType?t:t.ownerDocument||t.document}function Bo(t){this.a=t||Xy.document||document}function jo(){return!0}function Zo(t){var e=t.a;return t=e.scrollingElement||_m&&e.body||e.documentElement,e=e.parentWindow||e.defaultView,gm&&at("10")&&e.pageYOffset!=t.scrollTop?new So(t.scrollLeft,t.scrollTop):new So(e.pageXOffset||t.scrollLeft,e.pageYOffset||t.scrollTop)}function Go(t){return t.classList||(u(t=t.className)&&t.match(/\S+/g)||[])}function Vo(t,e){var i=t.classList?t.classList.contains(e):0<=T(i=Go(t),e);return i}function Wo(t,e){t.classList?t.classList.add(e):Vo(t,e)||(t.className+=0<t.className.length?" "+e:e)}function Ho(t,e){var i;t.classList?t.classList.remove(e):Vo(t,e)&&(t.className=(i=Go(t),t=function(t){return t!=e},cm.filter.call(i,t,void 0).join(" ")))}function qo(t,e){(Vo(t,e)?Ho:Wo)(t,e)}function Yo(t,e,i,o){this.top=t,this.right=e,this.bottom=i,this.left=o}function Xo(t,e,i,o){this.left=t,this.top=e,this.width=i,this.height=o}function Ko(t,e){var i=Uo(t);return i.defaultView&&i.defaultView.getComputedStyle&&(i=i.defaultView.getComputedStyle(t,null))&&(i[e]||i.getPropertyValue(e))||""}function $o(t,e){return Ko(t,e)||(t.currentStyle?t.currentStyle[e]:null)||t.style&&t.style[e]}function Jo(t,e,i){var o;e=e instanceof So?(o=e.x,e.y):(o=e,i),t.style.left=er(o),t.style.top=er(e)}function Qo(t){var e;try{e=t.getBoundingClientRect()}catch(t){return{left:0,top:0,right:0,bottom:0}}return gm&&t.ownerDocument.body&&(t=t.ownerDocument,e.left-=t.documentElement.clientLeft+t.body.clientLeft,e.top-=t.documentElement.clientTop+t.body.clientTop),e}function tr(t){return 1==t.nodeType?new So((t=Qo(t)).left,t.top):new So((t=t.changedTouches?t.changedTouches[0]:t).clientX,t.clientY)}function er(t){return"number"==typeof t&&(t+="px"),t}function ir(t){var e=or;if("none"!=$o(t,"display"))return e(t);var i=t.style,o=i.display,r=i.visibility,n=i.position;return i.visibility="hidden",i.position="absolute",i.display="inline",t=e(t),i.display=o,i.position=n,i.visibility=r,t}function or(t){var e=t.offsetWidth,i=t.offsetHeight;return l(e)&&!(_m&&!e&&!i)||!t.getBoundingClientRect?new To(e,i):new To((t=Qo(t)).right-t.left,t.bottom-t.top)}function rr(t,e){t.style.display=e?"":"none"}function nr(t,e,i,o){if(/^\d+px?$/.test(e))return parseInt(e,10);var r=t.style[i],n=t.runtimeStyle[i];return t.runtimeStyle[i]=t.currentStyle[i],t.style[i]=e,e=t.style[o],t.style[i]=r,t.runtimeStyle[i]=n,e}function sr(t,e){e=t.currentStyle?t.currentStyle[e]:null;return e?nr(t,e,"left","pixelLeft"):0}function ar(t,e){if(gm){var i=sr(t,e+"Left"),o=sr(t,e+"Right"),r=sr(t,e+"Top"),n=sr(t,e+"Bottom");return new Yo(r,o,n,i)}return i=Ko(t,e+"Left"),o=Ko(t,e+"Right"),r=Ko(t,e+"Top"),n=Ko(t,e+"Bottom"),new Yo(parseFloat(r),parseFloat(o),parseFloat(n),parseFloat(i))}function lr(t,e){if("none"==(t.currentStyle?t.currentStyle[e+"Style"]:null))return 0;e=t.currentStyle?t.currentStyle[e+"Width"]:null;return e in e_?e_[e]:nr(t,e,"left","pixelLeft")}function hr(t){if(!gm||9<=Em)return e=Ko(t,"borderLeftWidth"),i=Ko(t,"borderRightWidth"),o=Ko(t,"borderTopWidth"),t=Ko(t,"borderBottomWidth"),new Yo(parseFloat(o),parseFloat(i),parseFloat(t),parseFloat(e));var e=lr(t,"borderLeft"),i=lr(t,"borderRight"),o=lr(t,"borderTop");return new Yo(o,i,t=lr(t,"borderBottom"),e)}function pr(t,e,i){ct.call(this,t),this.map=e,this.frameState=void 0!==i?i:null}function cr(t){Gt.call(this),this.element=t.element||null,this.a=this.U=null,this.o=[],this.render=t.render||s,t.target&&this.c(t.target)}function ur(){this.b=0,this.c={},this.f=this.a=null}function dr(t,e){return t.c.hasOwnProperty(e)}function fr(t){ur.call(this),this.g=void 0!==t?t:2048}function gr(t){return t.sc()>t.g}function yr(t,e){for(var i,o;gr(t)&&!((o=(i=t.a.nc).ga[0].toString())in e&&e[o].contains(i.ga));)t.pop().rc()}function mr(t,e){Ft.call(this),this.ga=t,this.state=e,this.a=null,this.key=""}function _r(t){t.s("change")}function vr(t){Gt.call(this),this.b=ai(t.projection),this.i=void 0!==t.attributions?t.attributions:null,this.U=t.logo,this.B=void 0!==t.state?t.state:"ready",this.O=void 0!==t.wrapX&&t.wrapX}function br(t,e){t.B=e,t.u()}function xr(t){this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.a=t.resolutions,this.maxZoom=this.a.length-1,this.b=void 0!==t.origin?t.origin:null,this.g=null,void 0!==t.origins&&(this.g=t.origins);var e=t.extent;void 0===e||this.b||this.g||(this.b=Ge(e)),this.i=null,void 0!==t.tileSizes&&(this.i=t.tileSizes),this.l=void 0!==t.tileSize?t.tileSize:this.i?null:256,this.G=void 0!==e?e:null,this.f=null,void 0!==t.sizes?this.f=t.sizes.map(function(t){return new fo(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1))},this):e&&function(t,e){for(var i=t.a.length,o=Array(i),r=t.minZoom;r<i;++r)o[r]=Er(t,e,r);t.f=o}(this,e),this.c=[0,0]}function wr(t,e,i,o,r){for(r=t.Ba(e,r),e=e[0]-1;e>=t.minZoom;){if(i.call(null,e,Er(t,r,e,o)))return!0;--e}return!1}function Mr(t,e,i,o){return e[0]<t.maxZoom?(o=t.Ba(e,o),Er(t,o,e[0]+1,i)):null}function Pr(t,e,i,o){Tr(t,e[0],e[1],i,!1,i_);var r=i_[1],n=i_[2];return Tr(t,e[2],e[3],i,!0,i_),t=i_[1],e=i_[2],void 0!==o?(o.a=r,o.c=t,o.f=n,o.b=e):o=new fo(r,t,n,e),o}function Er(t,e,i,o){return i=t.$(i),Pr(t,e,i,o)}function Sr(t,e){var i=t.Ea(e[0]),o=t.$(e[0]),t=Yt(t.Ma(e[0]),t.c);return[i[0]+(e[1]+.5)*t[0]*o,i[1]+(e[2]+.5)*t[1]*o]}function Tr(t,e,i,o,r,n){var s=Ar(t,o),a=o/t.$(s),l=t.Ea(s);return t=Yt(t.Ma(s),t.c),e=a*Math.floor((e-l[0])/o+(r?.5:0))/t[0],i=a*Math.floor((i-l[1])/o+(r?0:.5))/t[1],i=r?(e=Math.ceil(e)-1,Math.ceil(i)-1):(e=Math.floor(e),Math.floor(i)),uo(s,e,i,n)}function Ar(t,e){return x(V(t.a,e,0),t.minZoom,t.maxZoom)}function Cr(t){var e,i=t.j;return i||(e=Lr(i=Or(t),void 0,void 0),i=new xr({extent:i,origin:Ge(i),resolutions:e,tileSize:void 0}),t.j=i),i}function Ir(t){var e={};return nt(e,void 0!==t?t:{}),void 0===e.extent&&(e.extent=ai("EPSG:3857").J()),e.resolutions=Lr(e.extent,e.maxZoom,e.tileSize),delete e.maxZoom,new xr(e)}function Lr(t,e,i){e=void 0!==e?e:42;var o=je(t);for(t=We(t),i=Yt(void 0!==i?i:256),i=Math.max(t/i[0],o/i[1]),e+=1,o=Array(e),t=0;t<e;++t)o[t]=i/Math.pow(2,t);return o}function Or(t){var e=(t=ai(t)).J();return e=!e?Ae(-(t=180*Gm.degrees/t.$b()),-t,t,t):e}function Rr(t){vr.call(this,{attributions:t.attributions,extent:t.extent,logo:t.logo,projection:t.projection,state:t.state,wrapX:t.wrapX}),this.qa=void 0!==t.opaque&&t.opaque,this.xa=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null,this.a=new fr(t.ff),this.g=[0,0]}function Dr(t,e,i,o,r){if(!(e=t.wd(e)))return!1;for(var n,s,a=!0,l=o.a;l<=o.c;++l)for(var h=o.f;h<=o.b;++h)s=!1,dr(e,n=t.Cb(i,l,h))&&((s=2===(n=e.get(n)).state)&&(s=!1!==r(n))),s||(a=!1);return a}function kr(t,e,i,o){return o=t.kb(o),i=t.vc(i),e=Yt(o.Ma(e),t.g),1==i?e:qt(e,i,t.g)}function zr(t,e,i){var o,r,n=void 0!==i?i:t.b;return i=t.kb(n),t.O&&n.b&&(e=(o=e)[0],t=Sr(i,o),e=Me(n=Or(n),t)?o:(o=We(n),t[0]+=o*Math.ceil((n[0]-t[0])/o),i.ie(t,e))),o=e[0],n=e[1],t=e[2],(i=!(i.minZoom>o||o>i.maxZoom)&&(!(i=(r=i.J())?Er(i,r,o):i.f?i.f[o]:null)||go(i,n,t)))?e:null}function Fr(t,e){ct.call(this,t),this.tile=e}function Nr(t){t=t||{},this.C=document.createElement("UL"),this.B=document.createElement("LI"),this.C.appendChild(this.B),rr(this.B,!1),this.b=void 0===t.collapsed||t.collapsed,this.j=void 0===t.collapsible||t.collapsible,this.j||(this.b=!1);var e=t.className||"ol-attribution",i=t.tipLabel||"Attributions",o=t.collapseLabel||"";this.D=u(o)?Oo("SPAN",{},o):o,o=t.label||"i",this.O=u(o)?Oo("SPAN",{},o):o,St(i=Oo("BUTTON",{type:"button",title:i},this.j&&!this.b?this.D:this.O),"click",this.Xl,!1,this),e=Oo("DIV",e+" ol-unselectable ol-control"+(this.b&&this.j?" ol-collapsed":"")+(this.j?"":" ol-uncollapsible"),this.C,i),cr.call(this,{element:e,render:t.render||Ur,target:t.target}),this.v=!0,this.l={},this.i={},this.T={}}function Ur(t){if(t=t.frameState){for(var e,i,o,r,n,s,a,l,h,p,c,u=t.layerStatesArray,d=rt(t.attributions),f={},g=t.viewState.projection,y=0,m=u.length;y<m;y++)if((r=u[y].layer.ea())&&(l=R(r).toString(),a=r.i))for(e=0,i=a.length;e<i;e++)if(!((s=R(n=a[e]).toString())in d)){if(o=t.usedTiles[l]){var _=r.kb(g);t:{var v,b=g;if((v=n).a){var x=void 0,w=void 0;for(w in o)if(w in v.a)for(var M,P=o[w],x=0,E=v.a[w].length;x<E;++x){if(_o(M=v.a[w][x],P)){v=!0;break t}var S=Er(_,Or(b),parseInt(w,10)),T=mo(S);if((P.a<S.a||P.c>S.c)&&(_o(M,new fo(Xt(P.a,T),Xt(P.c,T),P.f,P.b))||mo(P)>T&&_o(M,S))){v=!0;break t}}v=!1}else v=!0}}else v=!1;v?(s in f&&delete f[s],d[s]=n):f[s]=n}for(h in y=(m=[d,f])[0],m=m[1],this.l)h in y?(this.i[h]||(rr(this.l[h],!0),this.i[h]=!0),delete y[h]):h in m?(this.i[h]&&(rr(this.l[h],!1),delete this.i[h]),delete m[h]):(ko(this.l[h]),delete this.l[h],delete this.i[h]);for(h in y)e=document.createElement("LI"),e.innerHTML=y[h].f,this.C.appendChild(e),this.l[h]=e,this.i[h]=!0;for(h in m)e=document.createElement("LI"),e.innerHTML=m[h].f,rr(e,!1),this.C.appendChild(e),this.l[h]=e;for(p in h=!tt(this.i)||!tt(t.logos),this.v!=h&&(rr(this.element,h),this.v=h),(h&&tt(this.i)?Wo:Ho)(this.element,"ol-logo-only"),t=t.logos,h=this.T)p in t||(ko(h[p]),delete h[p]);for(c in t)c in h||(p=new Image,p.src=c,y=t[c],""===y?y=p:(y=Oo("A",{href:y}),y.appendChild(p)),this.B.appendChild(y),h[c]=y);rr(this.B,!tt(t))}else this.v&&(rr(this.element,!1),this.v=!1)}function Br(t){qo(t.element,"ol-collapsed"),t.b?zo(t.D,t.O):zo(t.O,t.D),t.b=!t.b}function jr(t){var e=(t=t||{}).className||"ol-rotate",i=t.label||"";this.b=null,u(i)?this.b=Oo("SPAN","ol-compass",i):(this.b=i,Wo(this.b,"ol-compass")),St(i=Oo("BUTTON",{class:e+"-reset",type:"button",title:t.tipLabel||"Reset rotation"},this.b),"click",jr.prototype.v,!1,this),e=Oo("DIV",e+" ol-unselectable ol-control",i),i=t.render||Zr,this.j=t.resetNorth||void 0,cr.call(this,{element:e,render:i,target:t.target}),this.l=void 0!==t.duration?t.duration:250,this.i=void 0===t.autoHide||t.autoHide,this.B=void 0,this.i&&Wo(this.element,"ol-hidden")}function Zr(t){var e;(t=t.frameState)&&((t=t.viewState.rotation)!=this.B&&(e="rotate("+t+"rad)",this.i&&(0===t?Wo:Ho)(this.element,"ol-hidden"),this.b.style.msTransform=e,this.b.style.webkitTransform=e,this.b.style.transform=e),this.B=t)}function Gr(t){var e=(t=t||{}).className||"ol-zoom",i=t.delta||1,o=t.zoomOutLabel||"",r=t.zoomOutTipLabel||"Zoom out",n=Oo("BUTTON",{class:e+"-in",type:"button",title:t.zoomInTipLabel||"Zoom in"},t.zoomInLabel||"+");St(n,"click",j(Gr.prototype.i,i),!1,this),St(o=Oo("BUTTON",{class:e+"-out",type:"button",title:r},o),"click",j(Gr.prototype.i,-i),!1,this),e=Oo("DIV",e+" ol-unselectable ol-control",n,o),cr.call(this,{element:e,target:t.target}),this.b=void 0!==t.duration?t.duration:250}function Vr(t){t=t||{};var e=new xo;return void 0!==t.zoom&&!t.zoom||e.push(new Gr(t.zoomOptions)),void 0!==t.rotate&&!t.rotate||e.push(new jr(t.rotateOptions)),void 0!==t.attribution&&!t.attribution||e.push(new Nr(t.attributionOptions)),e}function Wr(){var t=Ao().a,e=t.body;return e.webkitRequestFullscreen||e.mozRequestFullScreen&&t.mozFullScreenEnabled||e.msRequestFullscreen&&t.msFullscreenEnabled||e.requestFullscreen&&t.fullscreenEnabled}function Hr(t){t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.requestFullscreen&&t.requestFullscreen()}function qr(){var t=Ao().a;return!!(t.webkitIsFullScreen||t.mozFullScreen||t.msFullscreenElement||t.fullscreenElement)}function Yr(t){this.b=(t=t||{}).className||"ol-full-screen";var e=t.label||"";this.i=u(e)?document.createTextNode(e):e,e=t.labelActive||"",this.j=u(e)?document.createTextNode(e):e,e=t.tipLabel||"Toggle full-screen",St(e=Oo("BUTTON",{class:this.b+"-"+qr(),type:"button",title:e},this.i),"click",this.v,!1,this),St(Xy.document,o_,this.l,!1,this);e=Oo("DIV",this.b+" ol-unselectable ol-control "+(Wr()?"":"ol-unsupported"),e);cr.call(this,{element:e,target:t.target}),this.B=void 0!==t.keys&&t.keys}function Xr(t){var e=Oo("DIV",(t=t||{}).className||"ol-mouse-position");cr.call(this,{element:e,render:t.render||Kr,target:t.target}),St(this,Vt("projection"),this.$l,!1,this),t.coordinateFormat&&this.bi(t.coordinateFormat),t.projection&&this.ih(ai(t.projection)),this.B=t.undefinedHTML||"",this.l=e.innerHTML,this.j=this.i=this.b=null}function Kr(t){(t=t.frameState)?this.b!=t.viewState.projection&&(this.b=t.viewState.projection,this.i=null):this.b=null,$r(this,this.j)}function $r(t,e){var i,o=t.B;e&&t.b&&(t.i||(i=t.hh(),t.i=i?pi(t.b,i):ci),(i=t.a.Ia(e))&&(t.i(i,i),o=(o=t.Bg())?o(i):i.toString())),t.l&&o==t.l||(t.element.innerHTML=o,t.l=o)}function Jr(t,e,i){lt.call(this),this.ya=null,this.b=!1,this.i=t,this.g=i,this.a=e||window,this.f=f(this.c,this)}function Qr(t){var e,i;null!=t.ya&&(e=tn(t),i=en(t),e&&!i&&t.a.mozRequestAnimationFrame?It(t.ya):e&&i?i.call(t.a,t.ya):t.a.clearTimeout(t.ya)),t.ya=null}function tn(t){return(t=t.a).requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||null}function en(t){return(t=t.a).cancelAnimationFrame||t.cancelRequestAnimationFrame||t.webkitCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||null}function on(t){Xy.setTimeout(function(){throw t},0)}function rn(t,e){var i=t;e&&(i=f(t,e)),i=n_(i),!c(Xy.setImmediate)||Xy.Window&&Xy.Window.prototype&&Xy.Window.prototype.setImmediate==Xy.setImmediate?(r_=r_||function(){var t=Xy.MessageChannel;if(void 0===(t=void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Y("Presto")?function(){(o=document.createElement("IFRAME")).style.display="none",o.src="",document.documentElement.appendChild(o);var t=o.contentWindow;(o=t.document).open(),o.write(""),o.close();var e="callImmediate"+Math.random(),i="file:"==t.location.protocol?"*":t.location.protocol+"//"+t.location.host,o=f(function(t){"*"!=i&&t.origin!=i||t.data!=e||this.port1.onmessage()},this);t.addEventListener("message",o,!1),this.port1={},this.port2={postMessage:function(){t.postMessage(e,i)}}}:t)||Y("Trident")||Y("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){Xy.setTimeout(t,0)};var e=new t,i={},o=i;return e.port1.onmessage=function(){var t;l(i.next)&&(t=(i=i.next).rg,i.rg=null,t())},function(t){o.next={rg:t},o=o.next,e.port2.postMessage(0)}}())(i):Xy.setImmediate(i)}function nn(t,e){if(this.f={},this.a=[],this.b=0,1<(o=arguments.length)){if(o%2)throw Error("Uneven number of arguments");for(var i=0;i<o;i+=2)this.set(arguments[i],arguments[i+1])}else if(t){if(t instanceof nn)i=t.P(),o=t.wc();else{var o=[],r=0;for(i in t)o[r++]=i;i=o,o=J(t)}for(r=0;r<i.length;r++)this.set(i[r],o[r])}}function sn(t){if(t.b!=t.a.length){for(var e=0,i=0;e<t.a.length;){var o=t.a[e];an(t.f,o)&&(t.a[i++]=o),e++}t.a.length=i}if(t.b!=t.a.length){for(var r={},i=e=0;e<t.a.length;)an(r,o=t.a[e])||(r[t.a[i++]=o]=1),e++;t.a.length=i}}function an(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ln(){this.a=Jy()}function hn(t){Ft.call(this),this.a=t||window,this.f=St(this.a,"resize",this.c,!1,this),this.b=Lo(this.a||window)}function pn(t){if(48<=t&&t<=57||96<=t&&t<=106||65<=t&&t<=90||(_m||ym)&&0==t)return!0;switch(t){case 32:case 43:case 63:case 64:case 107:case 109:case 110:case 111:case 186:case 59:case 189:case 187:case 61:case 188:case 190:case 191:case 192:case 222:case 219:case 220:case 221:return!0;default:return!1}}function cn(t){return mm?t=function(t){switch(t){case 61:return 187;case 59:return 186;case 173:return 189;case 224:return 91;case 0:return 224;default:return t}}(t):vm&&_m&&93===t&&(t=91),t}function un(t,e){Ft.call(this),t&&dn(this,t,e)}function dn(t,e,i){t.pe&&fn(t),t.xd=e,t.oe=St(t.xd,"keypress",t,i),t.wf=St(t.xd,"keydown",t.a,i,t),t.pe=St(t.xd,"keyup",t.f,i,t)}function fn(t){t.oe&&(It(t.oe),It(t.wf),It(t.pe),t.oe=null,t.wf=null,t.pe=null),t.xd=null,t.lb=-1,t.ac=-1}function gn(t,e,i,o){gt.call(this,o),this.type="key",this.i=t,this.G=e}function yn(t,e){Ft.call(this);t=this.a=t;(t=d(t)&&1==t.nodeType?this.a:this.a?this.a.body:null)&&$o(t,"direction"),this.f=St(this.a,mm?"DOMMouseScroll":"mousewheel",this,e)}function mn(t,e){return _m&&(vm||xm)&&0!=t%e?t:t/e}function _n(t,e,i,o){gt.call(this,e),this.type="mousewheel",this.detail=t,this.v=o}function vn(t,e,i){var o;ct.call(this,t),this.a=e,this.buttons=function(t){if(t.buttons||p_)t=t.buttons;else switch(t.which){case 1:t=1;break;case 2:t=4;break;case 3:t=2;break;default:t=0}return t}(t=i||{}),this.pressure=(o=t,i=this.buttons,o.pressure||(i?.5:0)),this.bubbles="bubbles"in t&&t.bubbles,this.cancelable="cancelable"in t&&t.cancelable,this.view="view"in t?t.view:null,this.detail="detail"in t?t.detail:null,this.screenX="screenX"in t?t.screenX:0,this.screenY="screenY"in t?t.screenY:0,this.clientX="clientX"in t?t.clientX:0,this.clientY="clientY"in t?t.clientY:0,this.button="button"in t?t.button:0,this.relatedTarget="relatedTarget"in t?t.relatedTarget:null,this.pointerId="pointerId"in t?t.pointerId:0,this.width="width"in t?t.width:0,this.height="height"in t?t.height:0,this.pointerType="pointerType"in t?t.pointerType:"",this.isPrimary="isPrimary"in t&&t.isPrimary,e.preventDefault&&(this.preventDefault=function(){e.preventDefault()})}function bn(t,e){var i=document.createElement("CANVAS");return t&&(i.width=t),e&&(i.height=e),i.getContext("2d")}function xn(t,e){var i=t.style;i.WebkitTransform=e,i.MozTransform=e,i.a=e,i.msTransform=e,i.transform=e,gm&&at("9.0")&&(t.style.transformOrigin="0 0")}function wn(t,e){if(g_()){for(var i=Array(16),o=0;o<16;++o)i[o]=e[o].toFixed(6);xn(t,"matrix3d("+i.join(",")+")")}else if(f_()){var i=[e[0],e[1],e[4],e[5],e[12],e[13]],r=Array(6);for(o=0;o<6;++o)r[o]=i[o].toFixed(6);xn(t,"matrix("+r.join(",")+")")}else t.style.left=Math.round(e[12])+"px",t.style.top=Math.round(e[13])+"px"}function Mn(t,e){for(var i,o=y_.length,r=0;r<o;++r)try{if(i=t.getContext(y_[r],e))return i}catch(t){}return null}function Pn(t,e){this.a=t,this.g=e}function En(t){Pn.call(this,t,{mousedown:this.ql,mousemove:this.rl,mouseup:this.ul,mouseover:this.tl,mouseout:this.sl}),this.f=t.f,this.b=[]}function Sn(t,e){for(var i,o=t.b,r=e.clientX,n=e.clientY,s=0,a=o.length;s<a&&(i=o[s]);s++){var l=Math.abs(n-i[1]);if(Math.abs(r-i[0])<=25&&l<=25)return 1}}function Tn(t){var e=zn(t,t.a),i=e.preventDefault;return e.preventDefault=function(){t.preventDefault(),i()},e.pointerId=1,e.isPrimary=!0,e.pointerType="mouse",e}function An(t){Pn.call(this,t,{MSPointerDown:this.zl,MSPointerMove:this.Al,MSPointerUp:this.Dl,MSPointerOut:this.Bl,MSPointerOver:this.Cl,MSPointerCancel:this.yl,MSGotPointerCapture:this.wl,MSLostPointerCapture:this.xl}),this.f=t.f,this.b=["","unavailable","touch","pen","mouse"]}function Cn(t,e){var i=e;return y(e.a.pointerType)&&((i=zn(e,e.a)).pointerType=t.b[e.a.pointerType]),i}function In(t){Pn.call(this,t,{pointerdown:this.co,pointermove:this.eo,pointerup:this.io,pointerout:this.fo,pointerover:this.ho,pointercancel:this.bo,gotpointercapture:this.Ck,lostpointercapture:this.pl})}function Ln(t,e){Pn.call(this,t,{touchstart:this.jp,touchmove:this.ip,touchend:this.hp,touchcancel:this.gp}),this.f=t.f,this.j=e,this.b=void 0,this.i=0,this.c=void 0}function On(t,e,i){function o(){e.preventDefault()}for(var r,n,s,a=Array.prototype.slice.call(e.a.changedTouches),l=a.length,h=0;h<l;++h)r=t,n=e,s=a[h],(n=zn(n,s)).pointerId=s.identifier+2,n.bubbles=!0,n.cancelable=!0,n.detail=r.i,n.button=0,n.buttons=1,n.width=s.webkitRadiusX||s.radiusX||0,n.height=s.webkitRadiusY||s.radiusY||0,n.pressure=s.webkitForce||s.force||.5,n.isPrimary=r.b===s.identifier,n.pointerType="touch",n.clientX=s.clientX,n.clientY=s.clientY,n.screenX=s.screenX,n.screenY=s.screenY,(n=n).preventDefault=o,i.call(t,e,n)}function Rn(t,e){var i,o=t.j.b,e=e.a.changedTouches[0];t.b===e.identifier&&(i=[e.clientX,e.clientY],o.push(i),Xy.setTimeout(function(){I(o,i)},2500))}function Dn(t){Ft.call(this),this.c=t,this.f={},this.b={},this.a=[],M_?kn(this,new In(this)):P_?kn(this,new An(this)):(kn(this,t=new En(this)),w_&&kn(this,new Ln(this,t))),t=this.a.length;for(var e,i,o=0;o<t;o++)e=this.a[o],i=this,Object.keys(e.g).forEach(function(t){St(this.c,t,this.g,!1,this)},i)}function kn(t,i){var e=Object.keys(i.g);e&&(e.forEach(function(t){var e=i.g[t];e&&(this.b[t]=e.bind(i))},t),t.a.push(i))}function zn(t,e){for(var i,o={},r=0,n=k_.length;r<n;r++)o[i=k_[r][0]]=t[i]||e[i]||k_[r][1];return o}function Fn(t,e,i){t.Ac(e,i);var o=e.relatedTarget;o&&No(e.target,o)||(e.bubbles=!1,Un(t,R_,e,i))}function Nn(t,e,i){e.bubbles=!0,Un(t,I_,e,i);var o=e.relatedTarget;o&&No(e.target,o)||(e.bubbles=!1,Un(t,O_,e,i))}function Un(t,e,i,o){t.s(new vn(e,o,i))}function Bn(t,e){t.s(new vn(e.type,e,e.a))}function jn(t,e,i,o,r){pr.call(this,t,e,r),this.a=i,this.originalEvent=i.a,this.pixel=e.be(this.originalEvent),this.coordinate=e.Ia(this.pixel),this.dragging=void 0!==o&&o}function Zn(t,e,i,o,r){jn.call(this,t,e,i.a,o,r),this.f=i}function Gn(t){Ft.call(this),this.b=t,this.i=0,this.j=!1,this.f=this.l=this.c=null,t=this.b.a,this.B=0,this.G={},this.g=new Dn(t),this.a=null,this.l=St(this.g,A_,this.Xk,!1,this),this.o=St(this.g,T_,this.Fo,!1,this)}function Vn(t,e){e.type==Z_||e.type==G_?delete t.G[e.pointerId]:e.type==j_&&(t.G[e.pointerId]=!0),t.B=$(t.G)}function Wn(t){Gt.call(this);var e=rt(t);e.opacity=void 0!==t.opacity?t.opacity:1,e.visible=void 0===t.visible||t.visible,e.zIndex=void 0!==t.zIndex?t.zIndex:0,e.maxResolution=void 0!==t.maxResolution?t.maxResolution:1/0,e.minResolution=void 0!==t.minResolution?t.minResolution:0,this.I(e)}function Hn(t){var e=t.Sb(),i=t.uf(),o=t.tb(),r=t.J(),n=t.Tb(),s=t.Ob(),a=t.Pb();return{layer:t,opacity:x(e,0,1),O:i,visible:o,Db:!0,extent:r,zIndex:n,maxResolution:s,minResolution:Math.max(a,0)}}function qn(){}function Yn(t,e,i,o,r,n){ct.call(this,t,e),this.vectorContext=i,this.frameState=o,this.context=r,this.glContext=n}function Xn(t){var e=rt(t);delete e.source,Wn.call(this,e),this.i=this.B=this.o=null,t.map&&this.setMap(t.map),St(this,Vt("source"),this.dl,!1,this),this.Dc(t.source||null)}function Kn(t,e){return t.visible&&e>=t.minResolution&&e<t.maxResolution}function $n(t,e,i,o,r){Ft.call(this),this.i=r,this.extent=t,this.b=i,this.resolution=e,this.state=o}function Jn(t){t.s("change")}function Qn(t,e,i,o,r,n,s,a){return ue(t),0===e&&0===i||ge(t,e,i),1==o&&1==r||ye(t,o,r),0!==n&&me(t,n),0===s&&0===a||ge(t,s,a),t}function ts(t,e){return t[0]==e[0]&&t[1]==e[1]&&t[4]==e[4]&&t[5]==e[5]&&t[12]==e[12]&&t[13]==e[13]}function es(t,e,i){var o=t[1],r=t[5],n=t[13],s=e[0];return e=e[1],i[0]=t[0]*s+t[4]*e+t[12],i[1]=o*s+r*e+n,i}function is(t){Bt.call(this),this.a=t}function os(t,e){var i=e.state;return 2!=i&&3!=i&&St(e,"change",t.Lm,!1,t),0==i&&(e.load(),i=e.state),2==i}function rs(t){var e=t.a;e.tb()&&"ready"==e.uf()&&t.u()}function ns(t,e){e.wh()&&t.postRenderFunctions.push(j(function(t,e,i){e=R(t).toString(),t.xh(i.viewState.projection,i.usedTiles[e])},e))}function ss(t,e){if(e)for(var i,o=0,r=e.length;o<r;++o)t[R(i=e[o]).toString()]=i}function as(t,e){e=e.U;void 0!==e&&(u(e)?t.logos[e]="":d(e)&&(t.logos[e.src]=e.href))}function ls(t,e,i,o){e=R(e).toString(),i=i.toString(),e in t?i in t[e]?(t=t[e][i],o.a<t.a&&(t.a=o.a),o.c>t.c&&(t.c=o.c),o.f<t.f&&(t.f=o.f),o.b>t.b&&(t.b=o.b)):t[e][i]=o:(t[e]={},t[e][i]=o)}function hs(t,e,i){return[e*(Math.round(t[0]/e)+i[0]%2/2),e*(Math.round(t[1]/e)+i[1]%2/2)]}function ps(t,e,i,o,r,n,s,a,l,h){var p=R(e).toString();p in t.wantedTiles||(t.wantedTiles[p]={});var c=t.wantedTiles[p];t=t.tileQueue;for(var u,d,f,g,y,m=i.minZoom,_=s;m<=_;--_)for(d=Er(i,n,_,d),f=i.$(_),g=d.a;g<=d.c;++g)for(y=d.f;y<=d.b;++y)s-_<=a?(0==(u=e.Qb(_,g,y,o,r)).state&&(c[u.ga.toString()]=!0,u.bb()in t.b||t.c([u,p,Sr(i,u.ga),f])),void 0!==l&&l.call(h,u)):e.bg(_,g,y,r)}function cs(t){this.B=t.opacity,this.C=t.rotateWithView,this.G=t.rotation,this.j=t.scale,this.D=t.snapToPixel}function us(t){this.g=void 0!==(t=t||{}).anchor?t.anchor:[.5,.5],this.c=null,this.f=void 0!==t.anchorOrigin?t.anchorOrigin:"top-left",this.l=void 0!==t.anchorXUnits?t.anchorXUnits:"fraction",this.o=void 0!==t.anchorYUnits?t.anchorYUnits:"fraction";var e=void 0!==t.crossOrigin?t.crossOrigin:null,i=void 0!==t.img?t.img:null,o=void 0!==t.imgSize?t.imgSize:null,r=t.src;void 0!==r&&0!==r.length||!i||(r=i.src||R(i).toString());var n=void 0!==t.src?0:2,s=void 0!==t.color?Mo(t.color):null,a=gs.Zb(),l=a.get(r,e,s);l||(l=new ds(i,r,o,e,n,s),a.set(r,e,s,l)),this.a=l,this.O=void 0!==t.offset?t.offset:[0,0],this.b=void 0!==t.offsetOrigin?t.offsetOrigin:"top-left",this.i=null,this.v=void 0!==t.size?t.size:null,cs.call(this,{opacity:void 0!==t.opacity?t.opacity:1,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,snapToPixel:void 0===t.snapToPixel||t.snapToPixel,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView})}function ds(t,e,i,o,r,n){Ft.call(this),this.j=null,this.a=t||new Image,null!==o&&(this.a.crossOrigin=o),this.c=n?document.createElement("CANVAS"):null,this.i=n,this.g=null,this.f=r,this.b=i,this.l=e,this.o=!1,2==this.f&&fs(this)}function fs(e){var t=bn(1,1);try{t.drawImage(e.a,0,0),t.getImageData(0,0,1,1)}catch(t){e.o=!0}}function gs(){this.a={},this.f=0}function ys(t,e){lt.call(this),this.i=e,this.c={},this.G={}}function ms(t){var e=t.viewState,i=t.coordinateToPixelMatrix;Qn(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),fe(i,t.pixelToCoordinateMatrix)}function _s(){var t=gs.Zb();if(32<t.f){var e,i=0;for(e in t.a){var o,r=t.a[e];(o=(o=0==(3&i++))?!(r=mt(r)?Ut(r,void 0,void 0):!!(r=kt(r))&&Pt(r,void 0,void 0)):o)&&(delete t.a[e],--t.f)}}}function vs(t,e){var i=R(e).toString();if(i in t.c)return t.c[i];e=t.kf(e);return t.c[i]=e,t.G[i]=St(e,"change",t.Nk,!1,t),e}function bs(t,e){for(var i in t.c)if(!(i in e.layerStates)){e.postRenderFunctions.push(t.Lo.bind(t));break}}function xs(t,e){return t.zIndex-e.zIndex}function ws(t,e){this.o=t,this.i=e,this.a=[],this.f=[],this.b={}}function Ms(t){var e=t.a,i=t.f,o=e[0];return 1==e.length?(e.length=0,i.length=0):(e[0]=e.pop(),i[0]=i.pop(),Ps(t,0)),e=t.i(o),delete t.b[e],o}function Ps(t,e){for(var i=t.a,o=t.f,r=i.length,n=i[e],s=o[e],a=e;e<r>>1;){var l=2*e+1,h=2*e+2,l=h<r&&o[h]<o[l]?h:l;i[e]=i[l],o[e]=o[l],e=l}i[e]=n,o[e]=s,Es(t,a,e)}function Es(t,e,i){var o=t.a;t=t.f;for(var r=o[i],n=t[i];e<i;){var s=i-1>>1;if(!(t[s]>n))break;o[i]=o[s],t[i]=t[s],i=s}o[i]=r,t[i]=n}function Ss(t){for(var e,i,o=t.o,r=t.a,n=t.f,s=0,a=r.length,l=0;l<a;++l)1/0==(i=o(e=r[l]))?delete t.b[t.i(e)]:(n[s]=i,r[s++]=e);for(r.length=s,n.length=s,o=(t.a.length>>1)-1;0<=o;o--)Ps(t,o)}function Ts(e,t){ws.call(this,function(t){return e.apply(null,t)},function(t){return t[0].bb()}),this.G=t,this.g=0,this.j={}}function As(t,e,i){for(var o,r=0;t.g<e&&r<i&&0<t.sc();)0===(o=Ms(t)[0]).state&&(t.j[o.bb()]=!0,++t.g,++r,o.load())}function Cs(t,e,i){this.c=t,this.b=e,this.i=i,this.a=[],this.f=this.g=0}function Is(t){Gt.call(this),this.B=null,this.g(!0),this.handleEvent=t.handleEvent}function Ls(t,e,i,o,r){var n,s;void 0!==i&&(n=e.Ha(),s=e.Va(),void 0!==n&&s&&r&&0<r&&(t.Pa(po({rotation:n,duration:r,easing:no})),o&&t.Pa(ho({source:s,duration:r,easing:no}))),e.rotate(i,o))}function Os(t,e,i,o,r){var n=e.$();i=e.constrainResolution(n,i,0),Rs(t,e,i,o,r)}function Rs(t,e,i,o,r){var n,s,a;i&&(n=e.$(),s=e.Va(),void 0!==n&&s&&i!==n&&r&&0<r&&(t.Pa(co({resolution:n,duration:r,easing:no})),o&&t.Pa(ho({source:s,duration:r,easing:no}))),o&&(t=e.Va(),r=e.$(),void 0!==t&&void 0!==r&&(a=[o[0]-i*(o[0]-t[0])/r,o[1]-i*(o[1]-t[1])/r]),e.mb(a)),e.Vb(i))}function Ds(t){this.a=(t=t||{}).delta||1,Is.call(this,{handleEvent:ks}),this.c=void 0!==t.duration?t.duration:250}function ks(t){var e,i,o=!1,r=t.a;return t.type==N_&&(o=t.map,e=t.coordinate,r=r.c?-this.a:this.a,i=o.aa(),Os(o,i,r,e,this.c),t.preventDefault(),o=!0),!o}function zs(t){return(t=t.a).f&&!t.l&&t.c}function Fs(t){return"pointermove"==t.type}function Ns(t){return t.type==z_}function Us(t){return!(t=t.a).f&&!t.l&&!t.c}function Bs(t){return!(t=t.a).f&&!t.l&&t.c}function js(t){return"INPUT"!==(t=t.a.target.tagName)&&"SELECT"!==t&&"TEXTAREA"!==t}function Zs(t){return"mouse"==t.f.pointerType}function Gs(t){Is.call(this,{handleEvent:(t=t||{}).handleEvent||Ws}),this.Gc=t.handleDownEvent||Um,this.$c=t.handleDragEvent||s,this.Ze=t.handleMoveEvent||s,this.$e=t.handleUpEvent||Um,this.C=!1,this.ha={},this.j=[]}function Vs(t){for(var e=t.length,i=0,o=0,r=0;r<e;r++)i+=t[r].clientX,o+=t[r].clientY;return[i/e,o/e]}function Ws(t){if(!(t instanceof Zn))return!0;var e=!1,i=t.type;return i!==j_&&i!==U_&&i!==Z_||(i=t.f,t.type==Z_?delete this.ha[i.pointerId]:(t.type==j_||i.pointerId in this.ha)&&(this.ha[i.pointerId]=i),this.j=J(this.ha)),this.C&&(t.type==U_?this.$c(t):t.type==Z_&&(this.C=this.$e(t))),t.type==j_?(this.C=t=this.Gc(t),e=this.Ec(t)):t.type==B_&&this.Ze(t),!e}function Hs(t){Gs.call(this,{handleDownEvent:Xs,handleDragEvent:qs,handleUpEvent:Ys}),this.a=(t=t||{}).kinetic,this.c=this.l=null,this.v=t.condition||Us,this.o=!1}function qs(t){var e,i,o,r,n,s=Vs(this.j);this.a&&this.a.a.push(s[0],s[1],Date.now()),this.c&&(r=e=[e=this.c[0]-s[0],r=s[1]-this.c[1]],n=(o=eo(i=(t=t.map).aa())).resolution,r[0]*=n,r[1]*=n,ie(e,o.rotation),$t(e,o.center),e=i.Yd(e),t.render(),i.mb(e)),this.c=s}function Ys(t){var e,i,o,r,n,s,a=(t=t.map).aa();if(0!==this.j.length)return!(this.c=null);if(s=!this.o&&this.a)if((s=this.a).a.length<6)s=!1;else{var l=Date.now()-s.i,h=s.a.length-3;if(s.a[h+2]<l)s=!1;else{for(var p=h-3;0<p&&s.a[p+2]>l;)p-=3;var l=s.a[h+2]-s.a[p+2],c=s.a[h]-s.a[p],h=s.a[h+1]-s.a[p+1];s.g=Math.atan2(h,c),s.f=Math.sqrt(c*c+h*h)/l,s=s.f>s.b}}return s&&(s=((s=this.a).b-s.f)/s.c,h=this.a.g,p=a.Va(),this.l=(e=this.a,c=p,i=e.c,o=e.f,r=e.b-o,n=Math.log(e.b/e.f)/e.c,ho({source:c,duration:n,easing:function(t){return o*(Math.exp(i*t*n)-1)/r}})),t.Pa(this.l),p=t.Ra(p),s=t.Ia([p[0]-s*Math.cos(h),p[1]-s*Math.sin(h)]),s=a.Yd(s),a.mb(s)),oo(a,-1),t.render(),!1}function Xs(t){if(0<this.j.length&&this.v(t)){var e=t.map,i=e.aa();return this.c=null,this.C||oo(i,1),e.render(),this.l&&I(e.O,this.l)&&(i.mb(t.frameState.viewState.center),this.l=null),this.a&&((t=this.a).a.length=0,t.g=0,t.f=0),this.o=1<this.j.length,!0}return!1}function Ks(t){t=t||{},Gs.call(this,{handleDownEvent:Qs,handleDragEvent:$s,handleUpEvent:Js}),this.c=t.condition||zs,this.a=void 0,this.l=void 0!==t.duration?t.duration:250}function $s(t){var e,i,o,r;Zs(t)&&(i=(e=t.map).Ta(),t=t.pixel,i=Math.atan2(i[1]/2-t[1],t[0]-i[0]/2),void 0!==this.a&&(t=i-this.a,r=(o=e.aa()).Ha(),e.render(),Ls(e,o,r-t)),this.a=i)}function Js(t){if(!Zs(t))return!0;var e=(t=t.map).aa();oo(e,-1);var i=e.Ha(),o=this.l,i=e.constrainRotation(i,0);return Ls(t,e,i,void 0,o),!1}function Qs(t){return!!(Zs(t)&&yt(t.a)&&this.c(t))&&(oo((t=t.map).aa(),1),t.render(),!(this.a=void 0))}function ta(t){this.c=null,this.f=document.createElement("div"),this.f.style.position="absolute",this.f.className="ol-box "+t,this.b=this.g=this.a=null}function ea(t){var e=t.g,i=t.b;(t=t.f.style).left=Math.min(e[0],i[0])+"px",t.top=Math.min(e[1],i[1])+"px",t.width=Math.abs(i[0]-e[0])+"px",t.height=Math.abs(i[1]-e[1])+"px"}function ia(t){var e=t.g,i=t.b;(e=[e,[e[0],i[1]],i,[i[0],e[1]]].map(t.a.Ia,t.a))[4]=e[0].slice(),t.c?t.c.ma([e]):t.c=new Yi([e])}function oa(t,e,i){ct.call(this,t),this.coordinate=e,this.mapBrowserEvent=i}function ra(t){Gs.call(this,{handleDownEvent:la,handleDragEvent:sa,handleUpEvent:aa}),this.a=new ta((t=t||{}).className||"ol-dragbox"),this.c=null,this.D=t.condition||Bm,this.v=t.boxEndCondition||na}function na(t,e,i){return 64<=(t=i[0]-e[0])*t+(e=i[1]-e[1])*e}function sa(t){var e,i;Zs(t)&&(e=this.a,i=t.pixel,e.g=this.c,e.b=i,ia(e),ea(e),this.s(new oa("boxdrag",t.coordinate,t)))}function aa(t){return!Zs(t)||(this.a.setMap(null),this.v(t,this.c,t.pixel)&&(this.o(t),this.s(new oa("boxend",t.coordinate,t))),!1)}function la(t){if(Zs(t)&&yt(t.a)&&this.D(t)){this.c=t.pixel,this.a.setMap(t.map);var e=this.a,i=this.c;return e.g=this.c,e.b=i,ia(e),ea(e),this.s(new oa("boxstart",t.coordinate,t)),!0}return!1}function ha(t){var e=(t=t||{}).condition||Bs;this.l=void 0!==t.duration?t.duration:200,ra.call(this,{condition:e,className:t.className||"ol-dragzoom"})}function pa(t){Is.call(this,{handleEvent:ca}),this.a=void 0!==(t=t||{}).condition?t.condition:Je(Us,js),this.c=void 0!==t.duration?t.duration:100,this.j=void 0!==t.pixelDelta?t.pixelDelta:128}function ca(t){var e,i,o,r,n,s=!1;return"key"==t.type&&(e=t.a.i,!this.a(t)||40!=e&&37!=e&&39!=e&&38!=e||(o=(s=(i=t.map).aa()).$()*this.j,n=r=0,40==e?n=-o:37==e?r=-o:39==e?r=o:n=o,ie(e=[r,n],s.Ha()),o=this.c,(r=s.Va())&&(o&&0<o&&i.Pa(ho({source:r,duration:o,easing:ao})),i=s.Yd([r[0]+e[0],r[1]+e[1]]),s.mb(i)),t.preventDefault(),s=!0)),!s}function ua(t){Is.call(this,{handleEvent:da}),this.c=(t=t||{}).condition||js,this.a=t.delta||1,this.j=void 0!==t.duration?t.duration:100}function da(t){var e,i,o=!1;return"key"==t.type&&(e=t.a.G,!this.c(t)||43!=e&&45!=e||(o=t.map,e=43==e?this.a:-this.a,o.render(),i=o.aa(),Os(o,i,e,void 0,this.j),t.preventDefault(),o=!0)),!o}function fa(t){Is.call(this,{handleEvent:ga}),t=t||{},this.c=0,this.C=void 0!==t.duration?t.duration:250,this.o=void 0===t.useAnchor||t.useAnchor,this.a=null,this.l=this.j=void 0}function ga(t){var e,i=!1;return"mousewheel"==t.type&&(i=t.map,e=t.a,this.o&&(this.a=t.coordinate),this.c+=e.v,void 0===this.j&&(this.j=Date.now()),e=Math.max(80-(Date.now()-this.j),0),Xy.clearTimeout(this.l),this.l=Xy.setTimeout(this.v.bind(this,i),e),t.preventDefault(),i=!0),!i}function ya(t){Gs.call(this,{handleDownEvent:va,handleDragEvent:ma,handleUpEvent:_a}),t=t||{},this.c=null,this.l=void 0,this.a=!1,this.o=0,this.D=void 0!==t.threshold?t.threshold:.3,this.v=void 0!==t.duration?t.duration:250}function ma(t){var e=0,i=this.j[0],o=this.j[1],i=Math.atan2(o.clientY-i.clientY,o.clientX-i.clientX);void 0!==this.l&&(e=i-this.l,this.o+=e,!this.a&&Math.abs(this.o)>this.D&&(this.a=!0)),this.l=i,i=tr((t=t.map).a),(o=Vs(this.j))[0]-=i.x,o[1]-=i.y,this.c=t.Ia(o),this.a&&(o=(i=t.aa()).Ha(),t.render(),Ls(t,i,o+e,this.c))}function _a(t){if(this.j.length<2){var e,i,o,r=(t=t.map).aa();return oo(r,-1),this.a&&(o=r.Ha(),e=this.c,i=this.v,o=r.constrainRotation(o,0),Ls(t,r,o,e,i)),!1}return!0}function va(t){return 2<=this.j.length&&(t=t.map,this.c=null,this.l=void 0,this.a=!1,this.o=0,this.C||oo(t.aa(),1),t.render(),!0)}function ba(t){Gs.call(this,{handleDownEvent:Ma,handleDragEvent:xa,handleUpEvent:wa}),t=t||{},this.c=null,this.o=void 0!==t.duration?t.duration:400,this.a=void 0,this.l=1}function xa(t){var e=1,i=this.j[0],o=this.j[1],r=i.clientX-o.clientX,i=i.clientY-o.clientY,r=Math.sqrt(r*r+i*i);void 0!==this.a&&(e=this.a/r),this.a=r,1!=e&&(this.l=e);var i=(r=(t=t.map).aa()).$(),o=tr(t.a),n=Vs(this.j);n[0]-=o.x,n[1]-=o.y,this.c=t.Ia(n),t.render(),Rs(t,r,i*e,this.c)}function wa(t){if(this.j.length<2){var e=(t=t.map).aa();oo(e,-1);var i=e.$(),o=this.c,r=this.o,i=e.constrainResolution(i,0,this.l-1);return Rs(t,e,i,o,r),!1}return!0}function Ma(t){return 2<=this.j.length&&(t=t.map,this.c=null,this.a=void 0,this.l=1,this.C||oo(t.aa(),1),t.render(),!0)}function Pa(t){t=t||{};var e=new xo,i=new Cs(-.005,.05,100);return void 0!==t.altShiftDragRotate&&!t.altShiftDragRotate||e.push(new Ks),void 0!==t.doubleClickZoom&&!t.doubleClickZoom||e.push(new Ds({delta:t.zoomDelta,duration:t.zoomDuration})),void 0!==t.dragPan&&!t.dragPan||e.push(new Hs({kinetic:i})),void 0!==t.pinchRotate&&!t.pinchRotate||e.push(new ya),void 0!==t.pinchZoom&&!t.pinchZoom||e.push(new ba({duration:t.zoomDuration})),void 0!==t.keyboard&&!t.keyboard||(e.push(new pa),e.push(new ua({delta:t.zoomDelta,duration:t.zoomDuration}))),void 0!==t.mouseWheelZoom&&!t.mouseWheelZoom||e.push(new fa({duration:t.zoomDuration})),void 0!==t.shiftDragZoom&&!t.shiftDragZoom||e.push(new ha({duration:t.zoomDuration})),e}function Ea(t){var e=t||{};delete(t=rt(e)).layers,e=e.layers,Wn.call(this,t),this.b=[],this.a={},St(this,Vt("layers"),this.Pk,!1,this),e?w(e)&&(e=new xo(e.slice())):e=new xo,this.oh(e)}function Sa(t){ti.call(this,{code:t,units:"m",extent:H_,global:!0,worldExtent:q_})}function Ta(t,e,i){var o=t.length;i=1<i?i:2,void 0===e&&(e=2<i?t.slice():Array(o));for(var r=0;r<o;r+=i)e[r]=6378137*Math.PI*t[r]/180,e[r+1]=6378137*Math.log(Math.tan(Math.PI*(t[r+1]+90)/360));return e}function Aa(t,e,i){var o=t.length;i=1<i?i:2,void 0===e&&(e=2<i?t.slice():Array(o));for(var r=0;r<o;r+=i)e[r]=180*t[r]/(6378137*Math.PI),e[r+1]=360*Math.atan(Math.exp(t[r+1]/6378137))/Math.PI-90;return e}function Ca(t,e){ti.call(this,{code:t,units:"degrees",extent:K_,axisOrientation:e,global:!0,metersPerUnit:$_,worldExtent:K_})}function Ia(){var t,i,o;ei(Y_),ei(J_),t=Y_,i=Ta,o=Aa,J_.forEach(function(e){t.forEach(function(t){ri(e,t,i),ri(t,e,o)})})}function La(t){Xn.call(this,t||{})}function Oa(t){var e=rt(t=t||{});delete e.preload,delete e.useInterimTilesOnError,Xn.call(this,e),this.c(void 0!==t.preload?t.preload:0),this.g(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}function Ra(t){this.a=void 0!==(t=t||{}).color?t.color:null,this.f=void 0}function Da(t){return void 0===t.f&&(t.f="f"+(t.a?Po(t.a):"-")),t.f}function ka(){this.f=-1,this.f=64,this.a=Array(4),this.g=Array(this.f),this.c=this.b=0,this.reset()}function za(t,e,i){i=i||0;var o=Array(16);if(u(e))for(var r=0;r<16;++r)o[r]=e.charCodeAt(i++)|e.charCodeAt(i++)<<8|e.charCodeAt(i++)<<16|e.charCodeAt(i++)<<24;else for(r=0;r<16;++r)o[r]=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;e=t.a[0],i=t.a[1];var r=t.a[2],n=t.a[3],s=0;s=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=(i=(r=(n=(e=i+((s=e+(n^i&(r^n))+o[0]+3614090360&4294967295)<<7&4294967295|s>>>25))+((s=n+(r^e&(i^r))+o[1]+3905402710&4294967295)<<12&4294967295|s>>>20))+((s=r+(i^n&(e^i))+o[2]+606105819&4294967295)<<17&4294967295|s>>>15))+((s=i+(e^r&(n^e))+o[3]+3250441966&4294967295)<<22&4294967295|s>>>10))+((s=e+(n^i&(r^n))+o[4]+4118548399&4294967295)<<7&4294967295|s>>>25))+((s=n+(r^e&(i^r))+o[5]+1200080426&4294967295)<<12&4294967295|s>>>20))+((s=r+(i^n&(e^i))+o[6]+2821735955&4294967295)<<17&4294967295|s>>>15))+((s=i+(e^r&(n^e))+o[7]+4249261313&4294967295)<<22&4294967295|s>>>10))+((s=e+(n^i&(r^n))+o[8]+1770035416&4294967295)<<7&4294967295|s>>>25))+((s=n+(r^e&(i^r))+o[9]+2336552879&4294967295)<<12&4294967295|s>>>20))+((s=r+(i^n&(e^i))+o[10]+4294925233&4294967295)<<17&4294967295|s>>>15))+((s=i+(e^r&(n^e))+o[11]+2304563134&4294967295)<<22&4294967295|s>>>10))+((s=e+(n^i&(r^n))+o[12]+1804603682&4294967295)<<7&4294967295|s>>>25))+((s=n+(r^e&(i^r))+o[13]+4254626195&4294967295)<<12&4294967295|s>>>20))+((s=r+(i^n&(e^i))+o[14]+2792965006&4294967295)<<17&4294967295|s>>>15))+((s=i+(e^r&(n^e))+o[15]+1236535329&4294967295)<<22&4294967295|s>>>10))+((s=e+(r^n&(i^r))+o[1]+4129170786&4294967295)<<5&4294967295|s>>>27))+((s=n+(i^r&(e^i))+o[6]+3225465664&4294967295)<<9&4294967295|s>>>23))+((s=r+(e^i&(n^e))+o[11]+643717713&4294967295)<<14&4294967295|s>>>18))+((s=i+(n^e&(r^n))+o[0]+3921069994&4294967295)<<20&4294967295|s>>>12))+((s=e+(r^n&(i^r))+o[5]+3593408605&4294967295)<<5&4294967295|s>>>27))+((s=n+(i^r&(e^i))+o[10]+38016083&4294967295)<<9&4294967295|s>>>23))+((s=r+(e^i&(n^e))+o[15]+3634488961&4294967295)<<14&4294967295|s>>>18))+((s=i+(n^e&(r^n))+o[4]+3889429448&4294967295)<<20&4294967295|s>>>12))+((s=e+(r^n&(i^r))+o[9]+568446438&4294967295)<<5&4294967295|s>>>27))+((s=n+(i^r&(e^i))+o[14]+3275163606&4294967295)<<9&4294967295|s>>>23))+((s=r+(e^i&(n^e))+o[3]+4107603335&4294967295)<<14&4294967295|s>>>18))+((s=i+(n^e&(r^n))+o[8]+1163531501&4294967295)<<20&4294967295|s>>>12))+((s=e+(r^n&(i^r))+o[13]+2850285829&4294967295)<<5&4294967295|s>>>27))+((s=n+(i^r&(e^i))+o[2]+4243563512&4294967295)<<9&4294967295|s>>>23))+((s=r+(e^i&(n^e))+o[7]+1735328473&4294967295)<<14&4294967295|s>>>18))+((s=i+(n^e&(r^n))+o[12]+2368359562&4294967295)<<20&4294967295|s>>>12))+((s=e+(i^r^n)+o[5]+4294588738&4294967295)<<4&4294967295|s>>>28))+((s=n+(e^i^r)+o[8]+2272392833&4294967295)<<11&4294967295|s>>>21))+((s=r+(n^e^i)+o[11]+1839030562&4294967295)<<16&4294967295|s>>>16))+((s=i+(r^n^e)+o[14]+4259657740&4294967295)<<23&4294967295|s>>>9))+((s=e+(i^r^n)+o[1]+2763975236&4294967295)<<4&4294967295|s>>>28))+((s=n+(e^i^r)+o[4]+1272893353&4294967295)<<11&4294967295|s>>>21))+((s=r+(n^e^i)+o[7]+4139469664&4294967295)<<16&4294967295|s>>>16))+((s=i+(r^n^e)+o[10]+3200236656&4294967295)<<23&4294967295|s>>>9))+((s=e+(i^r^n)+o[13]+681279174&4294967295)<<4&4294967295|s>>>28))+((s=n+(e^i^r)+o[0]+3936430074&4294967295)<<11&4294967295|s>>>21))+((s=r+(n^e^i)+o[3]+3572445317&4294967295)<<16&4294967295|s>>>16))+((s=i+(r^n^e)+o[6]+76029189&4294967295)<<23&4294967295|s>>>9))+((s=e+(i^r^n)+o[9]+3654602809&4294967295)<<4&4294967295|s>>>28))+((s=n+(e^i^r)+o[12]+3873151461&4294967295)<<11&4294967295|s>>>21))+((s=r+(n^e^i)+o[15]+530742520&4294967295)<<16&4294967295|s>>>16))+((s=i+(r^n^e)+o[2]+3299628645&4294967295)<<23&4294967295|s>>>9))+((s=e+(r^(i|~n))+o[0]+4096336452&4294967295)<<6&4294967295|s>>>26))+((s=n+(i^(e|~r))+o[7]+1126891415&4294967295)<<10&4294967295|s>>>22))+((s=r+(e^(n|~i))+o[14]+2878612391&4294967295)<<15&4294967295|s>>>17))+((s=i+(n^(r|~e))+o[5]+4237533241&4294967295)<<21&4294967295|s>>>11))+((s=e+(r^(i|~n))+o[12]+1700485571&4294967295)<<6&4294967295|s>>>26))+((s=n+(i^(e|~r))+o[3]+2399980690&4294967295)<<10&4294967295|s>>>22))+((s=r+(e^(n|~i))+o[10]+4293915773&4294967295)<<15&4294967295|s>>>17))+((s=i+(n^(r|~e))+o[1]+2240044497&4294967295)<<21&4294967295|s>>>11))+((s=e+(r^(i|~n))+o[8]+1873313359&4294967295)<<6&4294967295|s>>>26))+((s=n+(i^(e|~r))+o[15]+4264355552&4294967295)<<10&4294967295|s>>>22))+((s=r+(e^(n|~i))+o[6]+2734768916&4294967295)<<15&4294967295|s>>>17))+((s=i+(n^(r|~e))+o[13]+1309151649&4294967295)<<21&4294967295|s>>>11))+((n=(e=i+((s=e+(r^(i|~n))+o[4]+4149444226&4294967295)<<6&4294967295|s>>>26))+((s=n+(i^(e|~r))+o[11]+3174756917&4294967295)<<10&4294967295|s>>>22))^((r=n+((s=r+(e^(n|~i))+o[2]+718787259&4294967295)<<15&4294967295|s>>>17))|~e))+o[9]+3951481745&4294967295,t.a[0]=t.a[0]+e&4294967295,t.a[1]=t.a[1]+(r+(s<<21&4294967295|s>>>11))&4294967295,t.a[2]=t.a[2]+r&4294967295,t.a[3]=t.a[3]+n&4294967295}function Fa(t,e){for(var i,o=(i=!l(i)?e.length:i)-t.f,r=t.g,n=t.b,s=0;s<i;){if(0==n)for(;s<=o;)za(t,e,s),s+=t.f;if(u(e)){for(;s<i;)if(r[n++]=e.charCodeAt(s++),n==t.f){za(t,r),n=0;break}}else for(;s<i;)if(r[n++]=e[s++],n==t.f){za(t,r),n=0;break}}t.b=n,t.c+=i}function Na(t){this.a=void 0!==(t=t||{}).color?t.color:null,this.c=t.lineCap,this.b=void 0!==t.lineDash?t.lineDash:null,this.g=t.lineJoin,this.i=t.miterLimit,this.f=t.width,this.j=void 0}function Ua(t){if(void 0===t.j){var e="s"+(t.a?Po(t.a):"-")+","+(void 0!==t.c?t.c.toString():"-")+","+(t.b?t.b.toString():"-")+","+(void 0!==t.g?t.g:"-")+","+(void 0!==t.i?t.i.toString():"-")+","+(void 0!==t.f?t.f.toString():"-"),i=new ka;Fa(i,e),(e=Array((i.b<56?i.f:2*i.f)-i.b))[0]=128;for(var o=1;o<e.length-8;++o)e[o]=0;for(var r=8*i.c,o=e.length-8;o<e.length;++o)e[o]=255&r,r/=256;for(Fa(i,e),e=Array(16),o=r=0;o<4;++o)for(var n=0;n<32;n+=8)e[r++]=i.a[o]>>>n&255;if(e.length<=8192)i=String.fromCharCode.apply(null,e);else for(i="",o=0;o<e.length;o+=8192)r=k(e,o,o+8192),i+=String.fromCharCode.apply(null,r);t.j=i}return t.j}function Ba(t){t=t||{},this.i=this.a=this.g=null,this.c=void 0!==t.fill?t.fill:null,this.f=void 0!==t.stroke?t.stroke:null,this.b=t.radius,this.v=[0,0],this.o=this.O=this.l=null;var e,i=t.atlasManager,o=null,r=0;this.f&&(a=Po(this.f.a),void 0===(r=this.f.f)&&(r=1),o=this.f.b,__||(o=null));var n,s=2*(this.b+r)+1,a={strokeStyle:a,Jd:r,size:s,lineDash:o};void 0===i?(this.a=document.createElement("CANVAS"),this.a.height=s,this.a.width=s,e=s=this.a.width,i=this.a.getContext("2d"),this.Bh(a,i,0,0),this.c?this.i=this.a:((i=this.i=document.createElement("CANVAS")).height=a.size,i.width=a.size,i=i.getContext("2d"),this.Ah(a,i,0,0))):(s=Math.round(s),(o=!this.c)&&(e=this.Ah.bind(this,a)),r=this.f?Ua(this.f):"-",n=this.c?Da(this.c):"-",this.g&&r==this.g[1]&&n==this.g[2]&&this.b==this.g[3]||(this.g=["c"+r+n+(void 0!==this.b?this.b.toString():"-"),r,n,this.b]),a=By(i,this.g[0],s,s,this.Bh.bind(this,a),e),this.a=a.image,this.v=[a.offsetX,a.offsetY],e=a.image.width,this.i=o?a.Tg:this.a),this.l=[s/2,s/2],this.O=[s,s],this.o=[e,e],cs.call(this,{opacity:1,rotateWithView:!1,rotation:0,scale:1,snapToPixel:void 0===t.snapToPixel||t.snapToPixel})}function ja(t){t=t||{},this.i=null,this.c=Wa,void 0!==t.geometry&&this.Eh(t.geometry),this.g=void 0!==t.fill?t.fill:null,this.f=void 0!==t.image?t.image:null,this.b=void 0!==t.stroke?t.stroke:null,this.j=void 0!==t.text?t.text:null,this.a=t.zIndex}function Za(t){var e;return c(t)||(e=w(t)?t:[t],t=function(){return e}),t}function Ga(){var t,e;return iv||(t=new Ra({color:"rgba(255,255,255,0.4)"}),e=new Na({color:"#3399CC",width:1.25}),iv=[new ja({image:new Ba({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]),iv}function Va(){var t={},e=[255,255,255,1],i=[0,153,255,1];return t.Polygon=[new ja({fill:new Ra({color:[255,255,255,.5]})})],t.MultiPolygon=t.Polygon,t.LineString=[new ja({stroke:new Na({color:e,width:5})}),new ja({stroke:new Na({color:i,width:3})})],t.MultiLineString=t.LineString,t.Circle=t.Polygon.concat(t.LineString),t.Point=[new ja({image:new Ba({radius:6,fill:new Ra({color:i}),stroke:new Na({color:e,width:1.5})}),zIndex:1/0})],t.MultiPoint=t.Point,t.GeometryCollection=t.Polygon.concat(t.LineString,t.Point),t}function Wa(t){return t.W()}function Ha(t){var e=rt(t=t||{});delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,Xn.call(this,e),this.a=void 0!==t.renderBuffer?t.renderBuffer:100,this.v=null,this.b=void 0,this.c(t.style),this.j=void 0!==t.updateWhileAnimating&&t.updateWhileAnimating,this.l=void 0!==t.updateWhileInteracting&&t.updateWhileInteracting}function qa(t){return t.get("renderOrder")}function Ya(t){var e=rt(t=t||{});delete e.preload,delete e.useInterimTilesOnError,Ha.call(this,e),this.T(t.preload||0),this.Y(t.useInterimTilesOnError||!0)}function Xa(t,e,i,o,r){this.v={},this.b=t,this.D=e,this.g=i,this.pa=o,this.$c=r,this.i=this.a=this.f=this.ib=this.qa=this.ia=null,this.xa=this.na=this.B=this.T=this.U=this.wa=0,this.jb=!1,this.j=this.Fb=0,this.Gb=!1,this.Y=0,this.c="",this.o=this.O=this.Pd=this.oc=0,this.ha=this.G=this.l=null,this.C=[],this.Gc=le()}function Ka(t,e,i){if(t.i){e=yi(e,0,i,2,t.pa,t.C),i=t.b;var o=t.Gc,r=i.globalAlpha;1!=t.B&&(i.globalAlpha=r*t.B);var n,s,a=t.Fb;for(t.jb&&(a+=t.$c),n=0,s=e.length;n<s;n+=2){var l,h,p=e[n]-t.wa,c=e[n+1]-t.U;t.Gb&&(p=Math.round(p),c=Math.round(c)),0===a&&1==t.j||(Qn(o,l=p+t.wa,h=c+t.U,t.j,t.j,a,-l,-h),i.setTransform(o[0],o[1],o[4],o[5],o[12],o[13])),i.drawImage(t.i,t.na,t.xa,t.Y,t.T,p,c,t.Y,t.T)}0===a&&1==t.j||i.setTransform(1,0,0,1,0,0),1!=t.B&&(i.globalAlpha=r)}}function $a(t,e,i,o){var r=0;if(t.ha&&""!==t.c){t.l&&el(t,t.l),t.G&&il(t,t.G);var n=t.ha,s=t.b;for((l=t.ib)?(l.font!=n.font&&(l.font=s.font=n.font),l.textAlign!=n.textAlign&&(l.textAlign=s.textAlign=n.textAlign),l.textBaseline!=n.textBaseline&&(l.textBaseline=s.textBaseline=n.textBaseline)):(s.font=n.font,s.textAlign=n.textAlign,s.textBaseline=n.textBaseline,t.ib={font:n.font,textAlign:n.textAlign,textBaseline:n.textBaseline}),e=yi(e,r,i,o,t.pa,t.C),n=t.b;r<i;r+=o){var a,s=e[r]+t.oc,l=e[r+1]+t.Pd;0===t.O&&1==t.o||(a=Qn(t.Gc,s,l,t.o,t.o,t.O,-s,-l),n.setTransform(a[0],a[1],a[4],a[5],a[12],a[13])),t.G&&n.strokeText(t.c,s,l),t.l&&n.fillText(t.c,s,l)}0===t.O&&1==t.o||n.setTransform(1,0,0,1,0,0)}}function Ja(t,e,i,o,r,n){var s=t.b;for(t=yi(e,i,o,r,t.pa,t.C),s.moveTo(t[0],t[1]),e=2;e<t.length;e+=2)s.lineTo(t[e],t[e+1]);return n&&s.lineTo(t[0],t[1]),o}function Qa(t,e,i,o,r){for(var n=t.b,s=0,a=o.length;s<a;++s)i=Ja(t,e,i,o[s],r,!0),n.closePath();return i}function tl(t){var e,i,o,r,n,s=Object.keys(t.v).map(Number);for(s.sort(Z),e=0,i=s.length;e<i;++e)for(r=0,n=(o=t.v[s[e].toString()]).length;r<n;++r)o[r](t)}function el(t,e){var i=t.b,o=t.ia;o?o.fillStyle!=e.fillStyle&&(o.fillStyle=i.fillStyle=e.fillStyle):(i.fillStyle=e.fillStyle,t.ia={fillStyle:e.fillStyle})}function il(t,e){var i=t.b,o=t.qa;o?(o.lineCap!=e.lineCap&&(o.lineCap=i.lineCap=e.lineCap),__&&!F(o.lineDash,e.lineDash)&&i.setLineDash(o.lineDash=e.lineDash),o.lineJoin!=e.lineJoin&&(o.lineJoin=i.lineJoin=e.lineJoin),o.lineWidth!=e.lineWidth&&(o.lineWidth=i.lineWidth=e.lineWidth),o.miterLimit!=e.miterLimit&&(o.miterLimit=i.miterLimit=e.miterLimit),o.strokeStyle!=e.strokeStyle&&(o.strokeStyle=i.strokeStyle=e.strokeStyle)):(i.lineCap=e.lineCap,__&&i.setLineDash(e.lineDash),i.lineJoin=e.lineJoin,i.lineWidth=e.lineWidth,i.miterLimit=e.miterLimit,i.strokeStyle=e.strokeStyle,t.qa={lineCap:e.lineCap,lineDash:e.lineDash,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}function ol(t){is.call(this,t),this.O=le()}function rl(t,e,i,o,r){var n=t.a;Ut(n,e)&&(t=void 0!==r?r:nl(t,o,0),t=new Xa(i,o.pixelRatio,o.extent,t,o.viewState.rotation),n.s(new Yn(e,n,t,o,i,null)),tl(t))}function nl(t,e,i){var o=e.viewState,r=e.pixelRatio;return Qn(t.O,r*e.size[0]/2,r*e.size[1]/2,r/o.resolution,-r/o.resolution,-o.rotation,-o.center[0]+i,-o.center[1])}function sl(t,e){var i=[0,0];return es(e,t,i),i}function al(t,e,i){this.na=t,this.Y=e,this.c=null,this.g=0,this.resolution=i,this.U=this.wa=null,this.f=[],this.coordinates=[],this.ia=le(),this.a=[],this.ha=[],this.qa=le(),this.ib=le()}function ll(t,e,i,o,r,n){for(var s,a,l=t.coordinates.length,h=t.nf(),p=[e[i],e[i+1]],c=[NaN,NaN],u=!0,d=i+r;d<o;d+=r)c[0]=e[d],c[1]=e[d+1],u=(a=Se(h,c))!==s?(u&&(t.coordinates[l++]=p[0],t.coordinates[l++]=p[1]),t.coordinates[l++]=c[0],t.coordinates[l++]=c[1],!1):1!==a||(t.coordinates[l++]=c[0],t.coordinates[l++]=c[1],!1),p[0]=c[0],p[1]=c[1],s=a;return d===i+r&&(t.coordinates[l++]=p[0],t.coordinates[l++]=p[1]),n&&(t.coordinates[l++]=e[i],t.coordinates[l++]=e[i+1]),l}function hl(t,e){t.wa=[0,e,0],t.f.push(t.wa),t.U=[0,e,0],t.a.push(t.U)}function pl(t,e,i,o,r,n,s,a,l){var h;ts(o,t.ia)?h=t.ha:(h=yi(t.coordinates,0,t.coordinates.length,2,o,t.ha),ce(t.ia,o)),o=!tt(n);var p,c,u=0,d=s.length,f=0,g=t.qa;for(t=t.ib;u<d;)switch((C=s[u])[0]){case 0:f=C[1],!(o&&n[R(f).toString()]||!f.W())&&(void 0===l||He(l,f.W().J()))?++u:u=C[2];break;case 1:e.beginPath(),++u;break;case 2:y=h[f=C[1]],C=h[f+1],P=h[f+2]-y,f=h[f+3]-C,e.arc(y,C,Math.sqrt(P*P+f*f),0,2*Math.PI,!0),++u;break;case 3:e.closePath(),++u;break;case 4:var f=C[1],y=C[2],m=C[3],_=C[4]*i,v=C[5]*i,b=C[6],x=C[7],w=C[8],M=C[9],P=C[11],E=C[12],S=C[13],T=C[14];for(C[10]&&(P+=r);f<y;f+=2){var A,C=h[f]-_,I=h[f+1]-v;S&&(C=Math.round(C),I=Math.round(I)),1==E&&0===P||(Qn(g,A=C+_,L=I+v,E,E,P,-A,-L),e.transform(g[0],g[1],g[4],g[5],g[12],g[13])),A=e.globalAlpha,1!=x&&(e.globalAlpha=A*x);var L=T+w>m.width?m.width-w:T,O=b+M>m.height?m.height-M:b;e.drawImage(m,w,M,L,O,C,I,L*i,O*i),1!=x&&(e.globalAlpha=A),1==E&&0===P||(fe(g,t),e.transform(t[0],t[1],t[4],t[5],t[12],t[13]))}++u;break;case 5:for(f=C[1],y=C[2],_=C[3],v=C[4]*i,b=C[5]*i,P=C[6],E=C[7]*i,m=C[8],x=C[9];f<y;f+=2){for(C=h[f]+v,I=h[f+1]+b,1==E&&0===P||(Qn(g,C,I,E,E,P,-C,-I),e.transform(g[0],g[1],g[4],g[5],g[12],g[13])),1<(M=(w=_.split("\n")).length)?I-=(M-1)/2*(S=Math.round(1.5*e.measureText("M").width)):S=0,T=0;T<M;T++)A=w[T],x&&e.strokeText(A,C,I),m&&e.fillText(A,C,I),I+=S;1==E&&0===P||(fe(g,t),e.transform(t[0],t[1],t[4],t[5],t[12],t[13]))}++u;break;case 6:if(void 0!==a&&(f=a(f=C[1])))return f;++u;break;case 7:e.fill(),++u;break;case 8:for(f=C[1],y=C[2],C=h[f],E=(I=h[f+1])+.5|0,(P=C+.5|0)===p&&E===c||(e.moveTo(C,I),p=P,c=E),f+=2;f<y;f+=2)C=h[f],E=(I=h[f+1])+.5|0,(P=C+.5|0)===p&&E===c||(e.lineTo(C,I),p=P,c=E);++u;break;case 9:e.fillStyle=C[1],++u;break;case 10:p=void 0===C[7]||C[7],c=C[2],e.strokeStyle=C[1],e.lineWidth=p?c*i:c,e.lineCap=C[3],e.lineJoin=C[4],e.miterLimit=C[5],__&&e.setLineDash(C[6]),c=p=NaN,++u;break;case 11:e.font=C[1],e.textAlign=C[2],e.textBaseline=C[3],++u;break;case 12:e.stroke(),++u;break;default:++u}}function cl(t){var e=t.a;e.reverse();for(var i,o,r=e.length,n=-1,s=0;s<r;++s)if(6==(o=(i=e[s])[0]))n=s;else if(0==o){for(i[2]=s,i=t.a,o=s;n<o;){var a=i[n];i[n]=i[o],i[o]=a,++n,--o}n=-1}}function ul(t,e){t.wa[2]=t.f.length,t.wa=null,t.U[2]=t.a.length,t.U=null;e=[6,e];t.f.push(e),t.a.push(e)}function dl(t,e,i){al.call(this,t,e,i),this.l=this.T=null,this.pa=this.O=this.D=this.C=this.v=this.B=this.G=this.o=this.j=this.i=this.b=void 0}function fl(t,e,i){al.call(this,t,e,i),this.b={ld:void 0,fd:void 0,gd:null,hd:void 0,jd:void 0,kd:void 0,xf:0,strokeStyle:void 0,lineCap:void 0,lineDash:null,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0}}function gl(t,e,i,o,r){var n=t.coordinates.length;return e=ll(t,e,i,o,r,!1),t.f.push(n=[8,n,e]),t.a.push(n),o}function yl(t){var e=t.b,i=e.strokeStyle,o=e.lineCap,r=e.lineDash,n=e.lineJoin,s=e.lineWidth,a=e.miterLimit;e.ld==i&&e.fd==o&&F(e.gd,r)&&e.hd==n&&e.jd==s&&e.kd==a||(e.xf!=t.coordinates.length&&(t.f.push([12]),e.xf=t.coordinates.length),t.f.push([10,i,s,o,n,a,r],[1]),e.ld=i,e.fd=o,e.gd=r,e.hd=n,e.jd=s,e.kd=a)}function ml(t,e,i){al.call(this,t,e,i),this.b={ug:void 0,ld:void 0,fd:void 0,gd:null,hd:void 0,jd:void 0,kd:void 0,fillStyle:void 0,strokeStyle:void 0,lineCap:void 0,lineDash:null,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0}}function _l(t,e,i,o,r){var n=t.b,s=[1];t.f.push(s),t.a.push(s);for(var s=0,a=o.length;s<a;++s){var l=o[s],h=t.coordinates.length;i=ll(t,e,i,l,r,!0),t.f.push(i=[8,h,i],h=[3]),t.a.push(i,h),i=l}return t.a.push(e=[7]),void 0!==n.fillStyle&&t.f.push(e),void 0!==n.strokeStyle&&(t.f.push(n=[12]),t.a.push(n)),i}function vl(t){var e=t.b,i=e.fillStyle,o=e.strokeStyle,r=e.lineCap,n=e.lineDash,s=e.lineJoin,a=e.lineWidth,l=e.miterLimit;void 0!==i&&e.ug!=i&&(t.f.push([9,i]),e.ug=e.fillStyle),void 0===o||e.ld==o&&e.fd==r&&e.gd==n&&e.hd==s&&e.jd==a&&e.kd==l||(t.f.push([10,o,a,r,s,l,n]),e.ld=o,e.fd=r,e.gd=n,e.hd=s,e.jd=a,e.kd=l)}function bl(t,e,i){al.call(this,t,e,i),this.O=this.D=this.C=null,this.l="",this.v=this.B=this.G=this.o=0,this.j=this.i=this.b=null}function xl(t,e,i,o){this.G=t,this.g=e,this.o=i,this.i=o,this.b={},this.j=bn(1,1),this.l=le()}function wl(t){for(var e in t.b){var i,o=t.b[e];for(i in o)o[i].ye()}}function Ml(t,e,i,o){this.b=t,this.a=e,this.g=i,this.c=o}function Pl(t,e){return R(t)-R(e)}function El(t,e){e=.5*t/e;return e*e}function Sl(t,e,i,o,r,n){var s,a,l=!1;return(s=i.f)&&(2==(a=s.Ed())||3==a?s.ag(r,n):(0==a&&s.load(),s.yf(r,n),l=!0)),(r=i.c(e))&&(o=r.vd(o),hv[o.V()](t,o,i,e)),l}function Tl(t,e,i,o,r,n){this.g=void 0!==n?n:null,$n.call(this,t,e,i,void 0!==n?0:2,o),this.c=r,this.f=null}function Al(t,e,i,o){var r=di(i,e,t);return i=e.getPointResolution(o,i),void 0!==(e=e.$b())&&(i*=e),void 0!==(e=t.$b())&&(i/=e),t=t.getPointResolution(i,r)/i,isFinite(t)&&!isNaN(t)&&0<t&&(i/=t),i}function Cl(t,e,i,o){t=i-t,e=o-e;var r=Math.sqrt(t*t+e*e);return[Math.round(i+t/r),Math.round(o+e/r)]}function Il(t,e,g,y,i,m,o,r,n,s){var _=bn(Math.round(g*t),Math.round(g*e));if(0===n.length)return _.canvas;_.scale(g,g);var v=Te();n.forEach(function(t){Oe(v,t.extent)});var b=bn(Math.round(g*We(v)/y),Math.round(g*je(v)/y));b.scale(g/y,g/y),b.translate(-v[0],v[3]),n.forEach(function(t){b.drawImage(t.image,t.extent[0],-t.extent[3],We(t.extent),je(t.extent))});var x=Ge(o);return r.c.forEach(function(t){var e=t.source,i=t.target,o=e[1][0],r=e[1][1],n=e[2][0],s=e[2][1];t=(i[0][0]-x[0])/m;var a=-(i[0][1]-x[1])/m,l=(i[1][0]-x[0])/m,h=-(i[1][1]-x[1])/m,p=(i[2][0]-x[0])/m,c=-(i[2][1]-x[1])/m;t:{for(r=(o=[[o=o-(i=e[0][0]),r=r-(e=e[0][1]),0,0,l-t],[n=n-i,s=s-e,0,0,p-t],[0,0,o,r,h-a],[0,0,n,s,c-a]]).length,n=0;n<r;n++){for(var s=n,u=Math.abs(o[n][n]),d=n+1;d<r;d++){var f=Math.abs(o[d][n]);u<f&&(u=f,s=d)}if(0===u){o=null;break t}for(u=o[s],o[s]=o[n],o[n]=u,s=n+1;s<r;s++)for(u=-o[s][n]/o[n][n],d=n;d<r+1;d++)o[s][d]=n==d?0:o[s][d]+u*o[n][d]}for(n=Array(r),s=r-1;0<=s;s--)for(n[s]=o[s][r]/o[s][s],u=s-1;0<=u;u--)o[u][r]-=o[u][s]*n[s];o=n}o&&(_.save(),_.beginPath(),pv?(r=Cl(n=(t+l+p)/3,s=(a+h+c)/3,t,a),l=Cl(n,s,l,h),p=Cl(n,s,p,c),_.moveTo(r[0],r[1]),_.lineTo(l[0],l[1]),_.lineTo(p[0],p[1])):(_.moveTo(t,a),_.lineTo(l,h),_.lineTo(p,c)),_.closePath(),_.clip(),_.transform(o[0],o[2],o[1],o[3],t,a),_.translate(v[0]-i,v[3]-e),_.scale(y/g,-y/g),_.drawImage(b.canvas,0,0),_.restore())}),s&&(_.save(),_.strokeStyle="black",_.lineWidth=1,r.c.forEach(function(t){t=((n=t.target)[0][0]-x[0])/m;var e=-(n[0][1]-x[1])/m,i=(n[1][0]-x[0])/m,o=-(n[1][1]-x[1])/m,r=(n[2][0]-x[0])/m,n=-(n[2][1]-x[1])/m;_.beginPath(),_.moveTo(t,e),_.lineTo(i,o),_.lineTo(r,n),_.closePath(),_.stroke()}),_.restore()),_.canvas}function Ll(t,e,i,o,r){this.b=t,this.g=e;var n={},s=hi(this.g,this.b);this.f=function(t){var e=t[0]+"/"+t[1];return n[e]||(n[e]=s(t)),n[e]},this.i=o,this.G=r*r,this.c=[],this.l=!1,this.o=this.b.f&&!!o&&!!this.b.J()&&We(o)==We(this.b.J()),this.a=this.b.J()?We(this.b.J()):null,this.j=this.g.J()?We(this.g.J()):null,t=Ge(i),e=Ve(i),o=Ne(i),i=Fe(i),r=this.f(t);var a,l=this.f(e),h=this.f(o),p=this.f(i);(function t(e,i,o,r,n,s,a,l,h,p){var c=_e([s,a,l,h]),u=e.a?We(c)/e.a:null,d=e.b.f&&.5<u&&u<1,f=!1;{var g;0<p&&(e.g.b&&e.j&&(g=_e([i,o,r,n]),f|=.25<We(g)/e.j),!d&&e.b.b&&u&&(f|=.25<u))}if(f||!e.i||He(c,e.i)){if(!(f||isFinite(s[0])&&isFinite(s[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(l[0])&&isFinite(l[1])&&isFinite(h[0])&&isFinite(h[1]))){if(!(0<p))return;f=!0}if(0<p&&(f||(u=e.f([(i[0]+r[0])/2,(i[1]+r[1])/2]),c=d?(Xt(s[0],e.a)+Xt(l[0],e.a))/2-Xt(u[0],e.a):(s[0]+l[0])/2-u[0],u=(s[1]+l[1])/2-u[1],f=c*c+u*u>e.G),f))Math.abs(i[0]-r[0])<=Math.abs(i[1]-r[1])?(d=[(o[0]+r[0])/2,(o[1]+r[1])/2],c=e.f(d),u=[(n[0]+i[0])/2,(n[1]+i[1])/2],f=e.f(u),t(e,i,o,d,u,s,a,c,f,p-1),t(e,u,d,r,n,f,c,l,h,p-1)):(d=[(i[0]+o[0])/2,(i[1]+o[1])/2],c=e.f(d),u=[(r[0]+n[0])/2,(r[1]+n[1])/2],f=e.f(u),t(e,i,d,u,n,s,c,f,h,p-1),t(e,d,o,r,u,c,a,l,f,p-1));else{if(d){if(!e.o)return;e.l=!0}e.c.push({source:[s,l,h],target:[i,r,n]}),e.c.push({source:[s,a,l],target:[i,o,r]})}}})(this,t,e,o,i,r,l,h,p,10),this.l&&(a=1/0,this.c.forEach(function(t){a=Math.min(a,t.source[0][0],t.source[1][0],t.source[2][0])}),this.c.forEach(function(t){var e;Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-a>this.a/2&&((e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]])[0][0]-a>this.a/2&&(e[0][0]-=this.a),e[1][0]-a>this.a/2&&(e[1][0]-=this.a),e[2][0]-a>this.a/2&&(e[2][0]-=this.a),Math.max(e[0][0],e[1][0],e[2][0])-Math.min(e[0][0],e[1][0],e[2][0])<this.a/2&&(t.source=e))},this)),n={}}function Ol(t){var e=Te();return t.c.forEach(function(t){t=t.source,Re(e,t[0]),Re(e,t[1]),Re(e,t[2])}),e}function Rl(t,e,i,o,r,n){this.v=e,this.B=t.J();var s=(a=e.J())?Ze(i,a):i,a=Al(t,e,Ue(s),o);this.o=new Ll(t,e,s,this.B,.5*a),this.j=o,this.g=i,t=Ol(this.o),this.G=(this.f=n(t,a,r))?this.f.b:1,this.c=this.l=null,r=2,n=[],this.f&&(r=0,n=this.f.i),$n.call(this,i,o,this.G,r,n)}function Dl(t){var e=t.f.state;2==e&&(t.l=Il(We(t.g)/t.j,je(t.g)/t.j,t.G,t.f.$(),0,t.j,t.g,t.o,[{extent:t.f.J(),image:t.f.a()}])),t.state=e,Jn(t)}function kl(t){vr.call(this,{attributions:t.attributions,extent:t.extent,logo:t.logo,projection:t.projection,state:t.state}),this.D=void 0!==t.resolutions?t.resolutions:null,this.a=null,this.qa=0}function zl(t,e){var i;return t.D&&(i=V(t.D,e,0),e=t.D[i]),e}function Fl(t,e){t.a().src=e}function Nl(t,e){ct.call(this,t),this.image=e}function Ul(t){kl.call(this,{attributions:t.attributions,logo:t.logo,projection:t.projection,resolutions:t.resolutions,state:void 0!==t.state?t.state:void 0}),this.ia=t.canvasFunction,this.Y=null,this.ha=0,this.na=void 0!==t.ratio?t.ratio:1.5}function Bl(t){Gt.call(this),this.ya=void 0,this.a="geometry",this.c=null,this.g=void 0,this.b=null,St(this,Vt(this.a),this.je,!1,this),void 0!==t&&(t instanceof gi||!t?this.Oa(t):this.I(t))}function jl(t){t.prototype.then=t.prototype.then,t.prototype.$goog_Thenable=!0}function Zl(t){if(t)try{return t.$goog_Thenable}catch(t){return}}function Gl(t,e,i){this.c=i,this.b=t,this.g=e,this.f=0,this.a=null}function Vl(t,e){t.g(e),t.f<t.c&&(t.f++,e.next=t.a,t.a=e)}function Wl(){this.f=this.a=null}function Hl(){this.next=this.f=this.a=null}function ql(t,e){gv||function(){{var t;gv=Xy.Promise&&Xy.Promise.resolve?(t=Xy.Promise.resolve(void 0),function(){t.then(Yl)}):function(){rn(Yl)}}}(),yv||(gv(),yv=!0);var i=mv,o=fv.get();o.set(t,e),i.f?i.f.next=o:i.a=o,i.f=o}function Yl(){for(var t=null;t=mv.remove();){try{t.a.call(t.f)}catch(t){on(t)}Vl(fv,t)}yv=!1}function Xl(t,e){if(this.a=_v,this.j=void 0,this.c=this.f=this.b=null,this.g=this.i=!1,t!=p)try{var i=this;t.call(e,function(t){Ql(i,vv,t)},function(t){Ql(i,bv,t)})}catch(t){Ql(this,bv,t)}}function Kl(){this.next=this.b=this.f=this.c=this.a=null,this.g=!1}function $l(t,e,i){var o=xv.get();return o.c=t,o.f=e,o.b=i,o}function Jl(t,e){t.f||t.a!=vv&&t.a!=bv||th(t),t.c?t.c.next=e:t.f=e,t.c=e}function Ql(e,t,i){if(e.a==_v){var o;e==i&&(t=bv,i=new TypeError("Promise cannot resolve to itself")),e.a=1;t:{var r=i,n=e.o,s=e.G;if(r instanceof Xl)Jl(r,$l(n||p,s||null,e)),o=!0;else if(Zl(r))r.then(n,s,e),o=!0;else{if(d(r))try{var a=r.then;if(c(a)){(function(t,e,i,o,r){function n(t){s||(s=!0,o.call(r,t))}var s=!1;try{e.call(t,function(t){s||(s=!0,i.call(r,t))},n)}catch(t){n(t)}})(r,a,n,s,e),o=!0;break t}}catch(t){s.call(e,t),o=!0;break t}o=!1}}o||(e.j=i,e.a=t,e.b=null,th(e),t!=bv||i instanceof rh||(h=i,(l=e).g=!0,ql(function(){l.g&&wv.call(null,h)})))}var l,h}function th(t){t.i||(t.i=!0,ql(t.l,t))}function eh(t){var e=null;return t.f&&(e=t.f,t.f=e.next,e.next=null),t.f||(t.c=null),e}function ih(t,e,i,o){if(i==bv&&e.f&&!e.g)for(;t&&t.g;t=t.b)t.g=!1;if(e.a)e.a.b=null,oh(e,i,o);else try{e.g?e.c.call(e.b):oh(e,i,o)}catch(t){wv.call(null,t)}Vl(xv,e)}function oh(t,e,i){e==vv?t.c.call(t.b,i):t.f&&t.f.call(t.b,i)}function rh(t){a.call(this,t)}function nh(t,e,i){if(c(t))i&&(t=f(t,i));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=f(t.handleEvent,t)}return 2147483647<e?-1:Xy.setTimeout(t,e||0)}function sh(){}function ah(){}function lh(t){if(t.b||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.b;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],i=0;i<e.length;i++){var o=e[i];try{return new ActiveXObject(o),t.b=o}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function hh(t){var e,i;return t[1]&&(0<=(i=(e=t[0]).indexOf("#"))&&(t.push(e.substr(i)),t[0]=e=e.substr(0,i)),(i=e.indexOf("?"))<0?t[1]="?":i==e.length-1&&(t[1]=void 0)),t.join("")}function ph(t,e){for(var i in e)!function t(e,i,o){if(w(i))for(var r=0;r<i.length;r++)t(e,String(i[r]),o);else null!=i&&o.push("&",e,""===i?"":"=",encodeURIComponent(String(i)))}(i,e[i],t);return t}function ch(t){Ft.call(this),this.O=new nn,this.o=t||null,this.a=!1,this.l=this.fa=null,this.g=this.U=this.v="",this.f=this.B=this.c=this.G=!1,this.j=0,this.b=null,this.i=Tv,this.C=this.Y=!1}function uh(e,t){if(e.fa)throw Error("[goog.net.XhrIo] Object is active with another request="+e.v+"; newUri="+t);e.v=t,e.g="",e.U="GET",e.G=!1,e.a=!0,e.fa=(e.o||Ev).a(),e.l=(r=e.o||Ev).f||(r.f=r.c()),e.fa.onreadystatechange=f(e.D,e);try{e.B=!0,e.fa.open("GET",String(t),!0),e.B=!1}catch(t){return fh(e,t),0}var i,o=e.O.clone(),r=A(o.P(),dh),t=Xy.FormData&&!1;0<=T(Cv,"GET")&&!r&&!t&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.fa.setRequestHeader(e,t)},e),e.i&&(e.fa.responseType=e.i),"withCredentials"in e.fa&&(e.fa.withCredentials=e.Y);try{_h(e),0<e.j&&(e.C=(i=e.fa,gm&&at(9)&&y(i.timeout)&&l(i.ontimeout)),e.C?(e.fa.timeout=e.j,e.fa.ontimeout=f(e.Fc,e)):e.b=nh(e.Fc,e.j,e)),e.c=!0,e.fa.send(""),e.c=!1}catch(t){fh(e,t)}}function dh(t){return"content-type"==t.toLowerCase()}function fh(t,e){t.a=!1,t.fa&&(t.f=!0,t.fa.abort(),t.f=!1),t.g=e,gh(t),mh(t)}function gh(t){t.G||(t.G=!0,t.s("complete"),t.s("error"))}function yh(t){if(t.a&&void 0!==Yy&&(!t.l[1]||4!=bh(t)||2!=xh(t)))if(t.c&&4==bh(t))nh(t.D,0,t);else if(t.s("readystatechange"),4==bh(t)){t.a=!1;try{if(vh(t))t.s("complete"),t.s("success");else{var e;try{e=2<bh(t)?t.fa.statusText:""}catch(t){e=""}t.g=e+" ["+xh(t)+"]",gh(t)}}finally{mh(t)}}}function mh(t,e){if(t.fa){_h(t);var i=t.fa,o=t.l[0]?p:null;t.fa=null,t.l=null,e||t.s("ready");try{i.onreadystatechange=o}catch(t){}}}function _h(t){t.fa&&t.C&&(t.fa.ontimeout=null),y(t.b)&&(Xy.clearTimeout(t.b),t.b=null)}function vh(t){var e,i=xh(t);t:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:e=!0;break t;default:e=!1}return e||((i=0===i)&&(!(t=String(t.v).match(Sv)[1]||null)&&Xy.self&&Xy.self.location&&(t=(t=Xy.self.location.protocol).substr(0,t.length-1)),i=!Av.test(t?t.toLowerCase():"")),e=i),e}function bh(t){return t.fa?t.fa.readyState:0}function xh(t){try{return 2<bh(t)?t.fa.status:-1}catch(t){return-1}}function wh(t){try{return t.fa?t.fa.responseText:""}catch(t){return""}}function Mh(t,e,i,o,r,n){mr.call(this,t,e),this.l=bn(),this.i=o,this.g=null,this.f=n,this.b={md:!1,Xf:null,Xh:-1,Wc:null},this.G=r,this.j=i}function Ph(t){var e=t.xml;if(e)return e;if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(t);throw Error("Your browser does not support serializing XML documents")}function Eh(t,e){return function t(e,i,o){if(4==e.nodeType||3==e.nodeType)i?o.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):o.push(e.nodeValue);else for(e=e.firstChild;e;e=e.nextSibling)t(e,i,o);return o}(t,e,[]).join("")}function Sh(t){return(new DOMParser).parseFromString(t,"application/xml")}function Th(i,o){return function(t,e){t=i.call(o,t,e);void 0!==t&&D(e[e.length-1],t)}}function Ah(i,o){return function(t,e){t=i.call(void 0!==o?o:this,t,e);void 0!==t&&e[e.length-1].push(t)}}function Ch(i,o){return function(t,e){t=i.call(void 0!==o?o:this,t,e);void 0!==t&&(e[e.length-1]=t)}}function Ih(o){return function(t,e){var i=o.call(this,t,e);void 0!==i&&ot(e[e.length-1],t.localName).push(i)}}function Lh(o,r){return function(t,e){var i=o.call(this,t,e);void 0!==i&&(e[e.length-1][void 0!==r?r:t.localName]=i)}}function Oh(o,r){return function(t,e,i){o.call(void 0!==r?r:this,t,e,i),i[i.length-1].node.appendChild(t)}}function Rh(r){var n,s;return function(t,e,i){var o;void 0===n&&(n={},(o={})[t.localName]=r,n[t.namespaceURI]=o,s=Dh(t.localName)),Uh(n,s,e,i)}}function Dh(o,r){return function(t,e,i){return t=e[e.length-1].node,void 0===(e=o)&&(e=i),void 0===(i=r)&&(i=t.namespaceURI),Nv(i,e)}}function kh(t,e){for(var i=e.length,o=Array(i),r=0;r<i;++r)o[r]=t[e[r]];return o}function zh(t,e,i){var o,r;for(i=void 0!==i?i:{},o=0,r=t.length;o<r;++o)i[t[o]]=e;return i}function Fh(t,e,i,o){for(e=e.firstElementChild;e;e=e.nextElementSibling){var r=t[e.namespaceURI];void 0!==r&&(void 0!==(r=r[e.localName])&&r.call(o,e,i))}}function Nh(t,e,i,o,r){return o.push(t),Fh(e,i,o,r),o.pop()}function Uh(t,e,i,o,r,n){for(var s,a,l=(void 0!==r?r:i).length,h=0;h<l;++h)void 0!==(s=i[h])&&(void 0!==(a=e.call(n,s,o,void 0!==r?r[h]:void 0))&&t[a.namespaceURI][a.localName].call(n,a,s,o))}function Bh(t,e,i,o,r,n,s){r.push(t),Uh(e,i,o,r,n,s),r.pop()}function jh(r,n,s,a){return function(t,e,o){var i=new ch;i.i="arraybuffer"==n.V()?"arraybuffer":"text",St(i,"complete",function(t){if(vh(t=t.target)){var e,i=n.V();if("json"==i)e=wh(t);else if("text"==i)e=wh(t);else if("xml"==i){if(!gm)try{e=t.fa?t.fa.responseXML:null}catch(t){e=null}e=e||Sh(wh(t))}else"arraybuffer"==i&&(e=function(t){try{if(!t.fa)return null;if("response"in t.fa)return t.fa.response;switch(t.i){case Tv:case"text":return t.fa.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.fa)return t.fa.mozResponseArrayBuffer}return null}catch(t){return null}}(t));e&&s.call(this,n.Ca(e,{featureProjection:o}),n.Ka(e))}else a.call(this);pt(t)},!1,this),c(r)?uh(i,r(t,e,o)):uh(i,r)}}function Zh(t,e){return jh(t,e,function(t,e){e=e.a;"tile-pixels"===e&&(this.f=new ti({code:this.f.Ya,units:e})),this.di(t)},function(){this.state=3,_r(this)})}function Gh(t,e){return jh(t,e,function(t){this.Ic(t)},s)}function Vh(){return[[-1/0,-1/0,1/0,1/0]]}function Wh(t){this.f=Rv(t),this.a={}}function Hh(t,e,i){var o=R(i);Le(t.a[o].slice(0,4),e)||(t.remove(i),t.za(e,i))}function qh(t){return t.f.all().map(function(t){return t[4]})}function Yh(t,e){return t.f.search(e).map(function(t){return t[4]})}function Xh(t,e,i,o){return Kh(Yh(t,e),i,o)}function Kh(t,e,i){for(var o,r=0,n=t.length;r<n&&!(o=e.call(i,t[r]));r++);return o}function $h(t){vr.call(this,{attributions:(t=t||{}).attributions,logo:t.logo,projection:void 0,state:"ready",wrapX:void 0===t.wrapX||t.wrapX}),this.T=s,void 0!==t.loader?this.T=t.loader:void 0!==t.url&&(this.T=Gh(t.url,t.format)),this.na=void 0!==t.strategy?t.strategy:Vh;var e,i,o,r,n=void 0===t.useSpatialIndex||t.useSpatialIndex;this.a=n?new Wh:null,this.Y=new Wh,this.g={},this.j={},this.l={},this.o={},this.c=null,t.features instanceof xo?e=(i=t.features).a:w(t.features)&&(e=t.features),n||void 0!==i||(i=new xo(e)),void 0!==e&&tp(this,e),void 0!==i&&(o=i,r=!1,St(i=this,"addfeature",function(t){r||(r=!0,o.push(t.feature),r=!1)}),St(i,"removefeature",function(t){r||(r=!0,o.remove(t.feature),r=!1)}),St(o,"add",function(t){r||(t=t.element,r=!0,this.Dd(t),r=!1)},!1,i),St(o,"remove",function(t){r||(t=t.element,r=!0,this.Sc(t),r=!1)},!1,i),i.c=o)}function Jh(t,e,i){t.o[e]=[St(i,"change",t.zh,!1,t),St(i,"propertychange",t.zh,!1,t)]}function Qh(t,e,i){var o=!0,r=i.Qa();return void 0!==r?r.toString()in t.j?o=!1:t.j[r.toString()]=i:t.l[e]=i,o}function tp(t,e){for(var i,o,r=[],n=[],s=[],a=0,l=e.length;a<l;a++)Qh(t,i=R(o=e[a]).toString(),o)&&n.push(o);for(a=0,l=n.length;a<l;a++){Jh(t,i=R(o=n[a]).toString(),o);var h=o.W();h?(i=h.J(),r.push(i),s.push(o)):t.g[i]=o}for(t.a&&t.a.load(r,s),a=0,l=n.length;a<l;a++)t.s(new ip("addfeature",n[a]))}function ep(t,e){for(var i in t.j)if(t.j[i]===e){delete t.j[i];break}}function ip(t,e){ct.call(this,t),this.feature=e}function op(t){this.c=t.source,this.xa=le(),this.g=bn(),this.j=[0,0],this.v=null,Ul.call(this,{attributions:t.attributions,canvasFunction:this.zj.bind(this),logo:t.logo,projection:t.projection,ratio:t.ratio,resolutions:t.resolutions,state:this.c.B}),this.T=null,this.o=void 0,this.vh(t.style),St(this.c,"change",this.Wm,void 0,this)}function rp(t){ol.call(this,t),this.g=null,this.i=le(),this.b=this.c=null}function np(t){ol.call(this,t),this.b=this.i=null,this.o=!1,this.j=null,this.B=le(),this.g=null,this.C=this.D=this.v=NaN,this.l=this.c=null,this.U=[0,0]}function sp(t){ol.call(this,t),this.c=!1,this.o=-1,this.l=NaN,this.i=Te(),this.b=this.j=null,this.g=bn()}function ap(t,e){for(var i=t.length,o=Array(i),r=0;r<i;++r)o[r]=function(e,i){var o=/\{z\}/g,r=/\{x\}/g,n=/\{y\}/g,s=/\{-y\}/g;return function(t){return t?e.replace(o,t[0].toString()).replace(r,t[1].toString()).replace(n,function(){return(-t[2]-1).toString()}).replace(s,function(){return(yo(i.f?i.f[t[0]]:null)+t[2]).toString()}):void 0}}(t[r],e);return lp(o)}function lp(o){return 1===o.length?o[0]:function(t,e,i){return t?o[Xt((t[1]<<t[0])+t[2],o.length)](t,e,i):void 0}}function hp(){}function pp(t){var e=[],i=/\{(\d)-(\d)\}/.exec(t)||/\{([a-z])-([a-z])\}/.exec(t);if(i)for(var o=i[2].charCodeAt(0),r=i[1].charCodeAt(0);r<=o;++r)e.push(t.replace(i[0],String.fromCharCode(r)));else e.push(t);return e}function cp(t){Rr.call(this,{attributions:t.attributions,ff:t.ff,extent:t.extent,logo:t.logo,opaque:t.opaque,projection:t.projection,state:t.state||void 0,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX}),this.tileLoadFunction=t.tileLoadFunction,this.tileUrlFunction=this.ae||hp,this.urls=null,t.urls?this.Xa(t.urls):t.url&&this.Wa(t.url),t.tileUrlFunction&&this.La(t.tileUrlFunction)}function up(t){cp.call(this,{attributions:t.attributions,ff:128,extent:t.extent,logo:t.logo,opaque:t.opaque,projection:t.projection,state:t.state||void 0,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction||dp,tileUrlFunction:t.tileUrlFunction,tilePixelRatio:t.tilePixelRatio,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX}),this.c=t.format||null,this.tileClass=t.tileClass||Mh}function dp(t,e){t.hi(Zh(e,t.i))}function fp(t){ol.call(this,t),this.g=bn(),this.b=!1,this.i=[],this.j=Te(),this.o=[NaN,NaN],this.c=le()}function gp(t,e,a,i){var o,r,n,s,l,h,p,c,u=a.f,d=qa(a)||null,f=e.b;!f.md&&f.Xh==u&&f.Xf==d||(pt(f.Wc),f.Wc=null,f.md=!1,o=(h=a.ea()).tileGrid,r=e.ga,s=(n="tile-pixels"==e.f.a)?[0,0,(s=kr(h,r[0],i,e.f))[0],s[1]]:o.Ba(r),l=o.$(r[0]),h=n?h.vc(i):l,f.md=!1,p=new xl(0,s,h,a.a),c=El(h,i),e=e.g,d&&d!==f.Xf&&e.sort(d),e.forEach(function(t){var e;if((i=t.cc())?e=i.call(t,l):(i=a.b)&&(e=i(t,l)),e){w(e)||(e=[e]);var i=c,o=p;if(e){var r=!1;if(w(e))for(var n=0,s=e.length;n<s;++n)r=Sl(o,t,e[n],i,this.l,this)||r;else r=Sl(o,t,e,i,this.l,this)||r;t=r}else t=!1;this.b=this.b||t,f.md=f.md||t}},t),wl(p),f.Xh=u,f.Xf=d,f.Wc=p,f.resolution=NaN)}function yp(t,e){ys.call(this,0,e),this.b=bn(),this.a=this.b.canvas,this.a.style.width="100%",this.a.style.height="100%",this.a.className="ol-unselectable",Do(t,this.a,0),this.f=!0,this.g=le()}function mp(t,e,i){var o,r,n,s,a,l,h=t.i,p=t.b;Ut(h,e)&&(l=i.extent,o=i.pixelRatio,r=i.viewState.rotation,n=i.pixelRatio,a=(s=i.viewState).resolution,l=new Xa(p,o,l,t=Qn(t.g,t.a.width/2,t.a.height/2,n/a,-n/a,-s.rotation,-s.center[0],-s.center[1]),r),h.s(new Yn(e,h,l,i,p,null)),tl(l))}function _p(t,e){is.call(this,t),this.target=e}function vp(t){var e=document.createElement("DIV");e.style.position="absolute",_p.call(this,t,e),this.b=null,this.c=he()}function bp(t){var e=document.createElement("DIV");e.style.position="absolute",_p.call(this,t,e),this.c=!0,this.o=1,this.j=0,this.b={}}function xp(t,e){this.target=document.createElement("DIV"),this.target.style.position="absolute",this.target.style.width="100%",this.target.style.height="100%",this.g=t,this.b=e,this.i=Ge(t.Ba(e)),this.j=t.$(e[0]),this.f={},this.a=null,this.c=he(),this.l=[0,0]}function wp(t){this.j=bn();var e=this.j.canvas;e.style.maxWidth="none",e.style.position="absolute",_p.call(this,t,e),this.c=!1,this.v=-1,this.B=NaN,this.o=Te(),this.b=this.G=null,this.O=le(),this.D=le()}function Mp(t,e,i,o){var r=t.j;Ut(t=t.a,e)&&(o=new Xa(r,i.pixelRatio,i.extent,o,i.viewState.rotation),t.s(new Yn(e,t,o,i,r,null)),tl(o))}function Pp(t,e){ys.call(this,0,e),this.b=bn();e=this.b.canvas;e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.className="ol-unselectable",Do(t,e,0),this.g=le(),this.a=document.createElement("DIV"),this.a.className="ol-unselectable",(e=this.a.style).position="absolute",e.width="100%",e.height="100%",St(this.a,"touchstart",dt),Do(t,this.a,0),this.f=!0}function Ep(t,e,i){var o,r,n,s,a,l,h=t.i;Ut(h,e)&&(o=i.extent,r=i.pixelRatio,s=(n=i.viewState).rotation,l=(a=t.b).canvas,Qn(t.g,l.width/2,l.height/2,r/n.resolution,-r/n.resolution,-n.rotation,-n.center[0],-n.center[1]),t=new Xa(a,r,o,t.g,s),h.s(new Yn(e,h,t,i,a,null)),tl(t))}function Sp(t){this.a=t}function Tp(t){this.a=t}function Ap(t){this.a=t}function Cp(){this.a="precision mediump float;varying vec2 a;varying float b;uniform float k;uniform sampler2D l;void main(void){vec4 texColor=texture2D(l,a);gl_FragColor.rgb=texColor.rgb;float alpha=texColor.a*b*k;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}"}function Ip(){this.a="varying vec2 a;varying float b;attribute vec2 c;attribute vec2 d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;void main(void){mat4 offsetMatrix=i;if(g==1.0){offsetMatrix=i*j;}vec4 offsets=offsetMatrix*vec4(e,0.,0.);gl_Position=h*vec4(c,0.,1.)+offsets;a=d;b=f;}"}function Lp(t,e){this.l=t.getUniformLocation(e,"j"),this.o=t.getUniformLocation(e,"i"),this.i=t.getUniformLocation(e,"k"),this.j=t.getUniformLocation(e,"h"),this.a=t.getAttribLocation(e,"e"),this.f=t.getAttribLocation(e,"f"),this.c=t.getAttribLocation(e,"c"),this.b=t.getAttribLocation(e,"g"),this.g=t.getAttribLocation(e,"d")}function Op(t){this.a=void 0!==t?t:[]}function Rp(t,e){this.G=t,this.a=e,this.f={},this.i={},this.g={},this.l=this.o=this.c=this.j=null,(this.b=G(Hy,"OES_element_index_uint"))&&e.getExtension("OES_element_index_uint"),St(this.G,"webglcontextlost",this.Pn,!1,this),St(this.G,"webglcontextrestored",this.Qn,!1,this)}function Dp(t,e,i){var o,r,n=t.a,s=i.a,a=R(i);a in t.f?n.bindBuffer(e,t.f[a].buffer):(o=n.createBuffer(),n.bindBuffer(e,o),34962==e?r=new Float32Array(s):34963==e&&(r=new(t.b?Uint32Array:Uint16Array)(s)),n.bufferData(e,r,35044),t.f[a]={Hb:i,buffer:o})}function kp(t,e){var i=t.a,o=R(e),e=t.f[o];i.isContextLost()||i.deleteBuffer(e.buffer),delete t.f[o]}function zp(t){var e,i,o,r;return t.c||(i=(e=t.a).createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,i),o=Bp(e,1,1),r=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,1,1),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,r),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),t.c=i,t.o=o,t.l=r),t.c}function Fp(t,e){var i=R(e);if(i in t.i)return t.i[i];var o=t.a,r=o.createShader(e.V());return o.shaderSource(r,e.a),o.compileShader(r),t.i[i]=r}function Np(t,e,i){var o=R(e)+"/"+R(i);if(o in t.g)return t.g[o];var r=t.a,n=r.createProgram();return r.attachShader(n,Fp(t,e)),r.attachShader(n,Fp(t,i)),r.linkProgram(n),t.g[o]=n}function Up(t,e,i){var o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),void 0!==e&&t.texParameteri(3553,10242,e),void 0!==i&&t.texParameteri(3553,10243,i),o}function Bp(t,e,i){var o=Up(t,void 0,void 0);return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),o}function jp(t,e){var i=Up(t,33071,33071);return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),i}function Zp(t,e){this.D=this.C=void 0,this.o=Ue(e),this.v=[],this.i=[],this.pa=void 0,this.g=[],this.c=[],this.U=this.wa=void 0,this.f=[],this.O=this.l=null,this.T=void 0,this.jb=he(),this.Fb=he(),this.ha=this.Y=void 0,this.Gb=he(),this.ib=this.qa=this.ia=void 0,this.xa=[],this.j=[],this.a=[],this.B=null,this.b=[],this.G=[],this.na=void 0}function Gp(t,i){var o=t.B,r=t.l,n=t.xa,s=t.j,a=i.a;return function(){if(!a.isContextLost()){for(var t=0,e=n.length;t<e;++t)a.deleteTexture(n[t]);for(t=0,e=s.length;t<e;++t)a.deleteTexture(s[t])}kp(i,o),kp(i,r)}}function Vp(t,e,i,o){for(var r,n,s,a,l,h=t.C,p=t.D,c=t.pa,u=t.wa,d=t.U,f=t.T,g=t.Y,y=t.ha,m=t.ia?1:0,_=t.qa,v=t.ib,b=t.na,x=Math.cos(_),_=Math.sin(_),w=t.f.length,M=t.a.length,P=0;P<i;P+=o)a=e[P]-t.o[0],l=e[P+1]-t.o[1],r=M/8,n=-v*h,s=-v*(c-p),t.a[M++]=a,t.a[M++]=l,t.a[M++]=n*x-s*_,t.a[M++]=n*_+s*x,t.a[M++]=g/d,t.a[M++]=(y+c)/u,t.a[M++]=f,t.a[M++]=m,n=v*(b-h),s=-v*(c-p),t.a[M++]=a,t.a[M++]=l,t.a[M++]=n*x-s*_,t.a[M++]=n*_+s*x,t.a[M++]=(g+b)/d,t.a[M++]=(y+c)/u,t.a[M++]=f,t.a[M++]=m,n=v*(b-h),s=v*p,t.a[M++]=a,t.a[M++]=l,t.a[M++]=n*x-s*_,t.a[M++]=n*_+s*x,t.a[M++]=(g+b)/d,t.a[M++]=y/u,t.a[M++]=f,t.a[M++]=m,n=-v*h,s=v*p,t.a[M++]=a,t.a[M++]=l,t.a[M++]=n*x-s*_,t.a[M++]=n*_+s*x,t.a[M++]=g/d,t.a[M++]=y/u,t.a[M++]=f,t.a[M++]=m,t.f[w++]=r,t.f[w++]=1+r,t.f[w++]=2+r,t.f[w++]=r,t.f[w++]=2+r,t.f[w++]=3+r}function Wp(t,e){var i=e.a;t.v.push(t.f.length),t.i.push(t.f.length),t.B=new Op(t.a),Dp(e,34962,t.B),t.l=new Op(t.f),Dp(e,34963,t.l);e={};Hp(t.xa,t.g,e,i),Hp(t.j,t.c,e,i),t.C=void 0,t.D=void 0,t.pa=void 0,t.g=null,t.c=null,t.wa=void 0,t.U=void 0,t.f=null,t.T=void 0,t.Y=void 0,t.ha=void 0,t.ia=void 0,t.qa=void 0,t.ib=void 0,t.a=null,t.na=void 0}function Hp(t,e,i,o){for(var r,n,s=e.length,a=0;a<s;++a)(n=R(r=e[a]).toString())in i?r=i[n]:(r=jp(o,r),i[n]=r),t[a]=r}function qp(t,e,i,o,r,n,s,a,l,h,p){var c=e.a;Dp(e,34962,t.B),Dp(e,34963,t.l);var u,d=Cp.Zb(),f=Np(e,d,f=Ip.Zb());if(t.O?d=t.O:(d=new Lp(c,f),t.O=d),e.Je(f),c.enableVertexAttribArray(d.c),c.vertexAttribPointer(d.c,2,5126,!1,32,0),c.enableVertexAttribArray(d.a),c.vertexAttribPointer(d.a,2,5126,!1,32,8),c.enableVertexAttribArray(d.g),c.vertexAttribPointer(d.g,2,5126,!1,32,16),c.enableVertexAttribArray(d.f),c.vertexAttribPointer(d.f,1,5126,!1,32,24),c.enableVertexAttribArray(d.b),c.vertexAttribPointer(d.b,1,5126,!1,32,28),Qn(f=t.Gb,0,0,2/(o*n[0]),2/(o*n[1]),-r,-(i[0]-t.o[0]),-(i[1]-t.o[1])),i=t.Fb,o=2/n[0],n=2/n[1],ue(i),i[0]=o,i[5]=n,i[10]=1,i[15]=1,ue(n=t.jb),0!==r&&me(n,-r),c.uniformMatrix4fv(d.j,!1,f),c.uniformMatrix4fv(d.o,!1,i),c.uniformMatrix4fv(d.l,!1,n),c.uniform1f(d.i,s),void 0===l)Yp(t,c,e,a,t.xa,t.v);else{if(h)t:{for(r=e.b?5125:5123,e=e.b?4:2,n=t.b.length-1,s=t.j.length-1;0<=s;--s)for(c.bindTexture(3553,t.j[s]),h=0<s?t.i[s-1]:0,f=t.i[s];0<=n&&t.b[n]>=h;){if(u=t.b[n],void 0===a[o=R(i=t.G[n]).toString()]&&i.W()&&(void 0===p||He(p,i.W().J()))&&(c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),c.drawElements(4,f-u,r,u*e),f=l(i))){t=f;break t}f=u,n--}t=void 0}else c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),Yp(t,c,e,a,t.j,t.i),t=(t=l(null))?t:void 0;u=t}return c.disableVertexAttribArray(d.c),c.disableVertexAttribArray(d.a),c.disableVertexAttribArray(d.g),c.disableVertexAttribArray(d.f),c.disableVertexAttribArray(d.b),u}function Yp(t,e,i,o,r,n){var s=i.b?5125:5123;if(i=i.b?4:2,tt(o))for(o=r.length,l=t=0;t<o;++t){e.bindTexture(3553,r[t]);var a=n[t];e.drawElements(4,a-l,s,l*i),l=a}else for(var l=0,a=0,h=r.length;a<h;++a){e.bindTexture(3553,r[a]);for(var p=0<a?n[a-1]:0,c=n[a],u=p;l<t.b.length&&t.b[l]<=c;){p=void 0!==o[R(t.G[l]).toString()]?(u!==p&&e.drawElements(4,p-u,s,u*i),u=l===t.b.length-1?c:t.b[l+1]):l===t.b.length-1?c:t.b[l+1];l++}u!==p&&e.drawElements(4,p-u,s,u*i)}}function Xp(t,e,i){this.i=e,this.j=t,this.g=i,this.b={}}function Kp(t,e){var i,o=[];for(i in t.b)o.push(Gp(t.b[i],e));return function(t){var i=arguments,o=i.length;return function(){for(var t,e=0;e<o;e++)t=i[e].apply(this,arguments);return t}}.apply(null,o)}function $p(t,e,i,o,r,n,s,a,l,h){for(var p,c=n0,u=av.length-1;0<=u;--u)if(void 0!==(p=t.b[av[u]])&&(p=qp(p,e,i,o,r,c,n,s,a,l,h)))return p}function Jp(t,e,i,o,r,n){this.f=t,this.g=e,this.c=n,this.l=r,this.j=o,this.i=i,this.b=null,this.a={}}function Qp(){this.a="precision mediump float;varying vec2 a;uniform float f;uniform sampler2D g;void main(void){vec4 texColor=texture2D(g,a);gl_FragColor.rgb=texColor.rgb;gl_FragColor.a=texColor.a*f;}"}function tc(){this.a="varying vec2 a;attribute vec2 b;attribute vec2 c;uniform mat4 d;uniform mat4 e;void main(void){gl_Position=e*vec4(b,0.,1.);a=(d*vec4(c,0.,1.)).st;}"}function ec(t,e){this.b=t.getUniformLocation(e,"f"),this.c=t.getUniformLocation(e,"e"),this.i=t.getUniformLocation(e,"d"),this.g=t.getUniformLocation(e,"g"),this.a=t.getAttribLocation(e,"b"),this.f=t.getAttribLocation(e,"c")}function ic(t,e){is.call(this,e),this.b=t,this.U=new Op([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),this.g=this.ob=null,this.i=void 0,this.o=le(),this.B=he(),this.G=null}function oc(t,e,i,o){var r;Ut(t=t.a,e)&&(r=o.viewState,t.s(new Yn(e,t,new Jp(i,r.center,r.resolution,r.rotation,o.size,o.extent),o,null,i)))}function rc(t,e){ic.call(this,t,e),this.l=this.j=this.c=null}function nc(){this.a="precision mediump float;varying vec2 a;uniform sampler2D e;void main(void){gl_FragColor=texture2D(e,a);}"}function sc(){this.a="varying vec2 a;attribute vec2 b;attribute vec2 c;uniform vec4 d;void main(void){gl_Position=vec4(b*d.xy+d.zw,0.,1.);a=c;}"}function ac(t,e){this.b=t.getUniformLocation(e,"e"),this.c=t.getUniformLocation(e,"d"),this.a=t.getAttribLocation(e,"b"),this.f=t.getAttribLocation(e,"c")}function lc(t,e){ic.call(this,t,e),this.D=nc.Zb(),this.T=sc.Zb(),this.c=null,this.C=new Op([0,0,0,1,1,0,1,1,0,1,0,0,1,1,1,0]),this.v=this.j=null,this.l=-1,this.O=[0,0]}function hc(t,e){ic.call(this,t,e),this.l=!1,this.O=-1,this.D=NaN,this.v=Te(),this.j=this.c=this.C=null}function pc(t,e){ys.call(this,0,e),this.a=document.createElement("CANVAS"),this.a.style.width="100%",this.a.style.height="100%",this.a.className="ol-unselectable",Do(t,this.a,0),this.v=this.C=0,this.D=bn(),this.o=!0,this.b=Mn(this.a,{antialias:!0,depth:!1,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!0}),this.g=new Rp(this.a,this.b),St(this.a,"webglcontextlost",this.Mm,!1,this),St(this.a,"webglcontextrestored",this.Nm,!1,this),this.f=new ur,this.B=null,this.l=new ws(function(t){var e=t[1];t=t[2];var i=e[0]-this.B[0],e=e[1]-this.B[1];return 65536*Math.log(t)+Math.sqrt(i*i+e*e)/t}.bind(this),function(t){return t[0].bb()}),this.O=function(){var t;return this.l.Na()||(Ss(this.l),cc(this,(t=Ms(this.l))[0],t[3],t[4])),!1}.bind(this),this.j=0,dc(this)}function cc(t,e,i,o){var r,n,s,a=t.b,l=e.bb();dr(t.f,l)?(t=t.f.get(l),a.bindTexture(3553,t.ob),9729!=t.Xg&&(a.texParameteri(3553,10240,9729),t.Xg=9729),9729!=t.Yg&&(a.texParameteri(3553,10240,9729),t.Yg=9729)):(r=a.createTexture(),a.bindTexture(3553,r),0<o?(n=t.D.canvas,s=t.D,t.C!==i[0]||t.v!==i[1]?(n.width=i[0],n.height=i[1],t.C=i[0],t.v=i[1]):s.clearRect(0,0,i[0],i[1]),s.drawImage(e.Ua(),o,o,i[0],i[1],0,0,i[0],i[1]),a.texImage2D(3553,0,6408,6408,5121,n)):a.texImage2D(3553,0,6408,6408,5121,e.Ua()),a.texParameteri(3553,10240,9729),a.texParameteri(3553,10241,9729),a.texParameteri(3553,10242,33071),a.texParameteri(3553,10243,33071),t.f.set(l,{ob:r,Xg:9729,Yg:9729}))}function uc(t,e,i){var o=t.i;if(Ut(o,e)){var r,n,s=t.g;for(t=new Jp(s,(t=i.viewState).center,t.resolution,t.rotation,i.size,i.extent),o.s(new Yn(e,o,t,i,null,s)),(e=Object.keys(t.a).map(Number)).sort(Z),i=0,o=e.length;i<o;++i)for(r=0,n=(s=t.a[e[i].toString()]).length;r<n;++r)s[r](t)}}function dc(t){(t=t.b).activeTexture(33984),t.blendFuncSeparate(770,771,1,771),t.disable(2884),t.disable(2929),t.disable(3089),t.disable(2960)}function fc(t){Gt.call(this);var e=function(t){var e=null;void 0!==t.keyboardEventTarget&&(e=u(t.keyboardEventTarget)?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);var i={},o={};void 0===t.logo||"boolean"==typeof t.logo&&t.logo?o["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAHGAAABxgEXwfpGAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAhNQTFRF////AP//AICAgP//AFVVQECA////K1VVSbbbYL/fJ05idsTYJFtbbcjbJllmZszWWMTOIFhoHlNiZszTa9DdUcHNHlNlV8XRIVdiasrUHlZjIVZjaMnVH1RlIFRkH1RkH1ZlasvYasvXVsPQH1VkacnVa8vWIVZjIFRjVMPQa8rXIVVkXsXRsNveIFVkIFZlIVVj3eDeh6GmbMvXH1ZkIFRka8rWbMvXIFVkIFVjIFVkbMvWH1VjbMvWIFVlbcvWIFVla8vVIFVkbMvWbMvVH1VkbMvWIFVlbcvWIFVkbcvVbMvWjNPbIFVkU8LPwMzNIFVkbczWIFVkbsvWbMvXIFVkRnB8bcvW2+TkW8XRIFVkIlZlJVloJlpoKlxrLl9tMmJwOWd0Omh1RXF8TneCT3iDUHiDU8LPVMLPVcLPVcPQVsPPVsPQV8PQWMTQWsTQW8TQXMXSXsXRX4SNX8bSYMfTYcfTYsfTY8jUZcfSZsnUaIqTacrVasrVa8jTa8rWbI2VbMvWbcvWdJObdcvUdszUd8vVeJaee87Yfc3WgJyjhqGnitDYjaarldPZnrK2oNbborW5o9bbo9fbpLa6q9ndrL3ArtndscDDutzfu8fJwN7gwt7gxc/QyuHhy+HizeHi0NfX0+Pj19zb1+Tj2uXk29/e3uLg3+Lh3+bl4uXj4ufl4+fl5Ofl5ufl5ujm5+jmySDnBAAAAFp0Uk5TAAECAgMEBAYHCA0NDg4UGRogIiMmKSssLzU7PkJJT1JTVFliY2hrdHZ3foSFhYeJjY2QkpugqbG1tre5w8zQ09XY3uXn6+zx8vT09vf4+Pj5+fr6/P39/f3+gz7SsAAAAVVJREFUOMtjYKA7EBDnwCPLrObS1BRiLoJLnte6CQy8FLHLCzs2QUG4FjZ5GbcmBDDjxJBXDWxCBrb8aM4zbkIDzpLYnAcE9VXlJSWlZRU13koIeW57mGx5XjoMZEUqwxWYQaQbSzLSkYGfKFSe0QMsX5WbjgY0YS4MBplemI4BdGBW+DQ11eZiymfqQuXZIjqwyadPNoSZ4L+0FVM6e+oGI6g8a9iKNT3o8kVzNkzRg5lgl7p4wyRUL9Yt2jAxVh6mQCogae6GmflI8p0r13VFWTHBQ0rWPW7ahgWVcPm+9cuLoyy4kCJDzCm6d8PSFoh0zvQNC5OjDJhQopPPJqph1doJBUD5tnkbZiUEqaCnB3bTqLTFG1bPn71kw4b+GFdpLElKIzRxxgYgWNYc5SCENVHKeUaltHdXx0dZ8uBI1hJ2UUDgq82CM2MwKeibqAvSO7MCABq0wXEPiqWEAAAAAElFTkSuQmCC"]="http://openlayers.org/":u(h=t.logo)?o[h]="":d(h)&&(o[h.src]=h.href);h=t.layers instanceof Ea?t.layers:new Ea({layers:t.layers}),i.layergroup=h,i.target=t.target,i.view=void 0!==t.view?t.view:new to;var r,n,s,a,l,h=ys;for(void 0!==t.renderer?w(t.renderer)?r=t.renderer:u(t.renderer)&&(r=[t.renderer]):r=a0,n=0,s=r.length;n<s;++n){var p=r[n];if("canvas"==p){if(v_){h=yp;break}}else{if("dom"==p){h=Pp;break}if("webgl"==p&&c_){h=pc;break}}}return a=void 0!==t.controls?w(t.controls)?new xo(t.controls.slice()):t.controls:Vr(),l=void 0!==t.interactions?w(t.interactions)?new xo(t.interactions.slice()):t.interactions:Pa(),t=void 0!==t.overlays?w(t.overlays)?new xo(t.overlays.slice()):t.overlays:new xo,{controls:a,interactions:l,keyboardEventTarget:e,logos:o,overlays:t,Oo:h,values:i}}(t);this.oc=void 0!==t.loadTilesWhileAnimating&&t.loadTilesWhileAnimating,this.Gc=void 0!==t.loadTilesWhileInteracting&&t.loadTilesWhileInteracting,this.Ze=void 0!==t.pixelRatio?t.pixelRatio:m_,this.$c=e.logos,this.v=new Jr(this.Mo,void 0,this),ht(this,this.v),this.Fb=le(),this.$e=le(),this.Gb=0,this.b=null,this.xa=Te(),this.D=this.U=null,this.a=document.createElement("DIV"),this.a.className="ol-viewport",this.a.style.position="relative",this.a.style.overflow="hidden",this.a.style.width="100%",this.a.style.height="100%",this.a.style.msTouchAction="none",this.a.style.touchAction="none",w_&&Wo(this.a,"ol-touch"),this.l=document.createElement("DIV"),this.l.className="ol-overlaycontainer",this.a.appendChild(this.l),this.j=document.createElement("DIV"),this.j.className="ol-overlaycontainer-stopevent",St(this.j,["click","dblclick","mousedown","touchstart","MSPointerDown",j_,mm?"DOMMouseScroll":"mousewheel"],ut),this.a.appendChild(this.j),St(t=new Gn(this),J(V_),this.Pg,!1,this),ht(this,t),this.ia=e.keyboardEventTarget,this.C=new un,St(this.C,"key",this.Og,!1,this),ht(this,this.C),St(t=new yn(this.a),"mousewheel",this.Og,!1,this),ht(this,t),this.g=e.controls,this.c=e.interactions,this.i=e.overlays,this.Y={},this.o=new e.Oo(this.a,this),ht(this,this.o),this.jb=new hn,ht(this,this.jb),this.T=this.B=null,this.O=[],this.na=[],this.qa=new Ts(this.wk.bind(this),this.fl.bind(this)),this.ha={},St(this,Vt("layergroup"),this.Kk,!1,this),St(this,Vt("view"),this.hl,!1,this),St(this,Vt("size"),this.cl,!1,this),St(this,Vt("target"),this.el,!1,this),this.I(e.values),this.g.forEach(function(t){t.setMap(this)},this),St(this.g,"add",function(t){t.element.setMap(this)},!1,this),St(this.g,"remove",function(t){t.element.setMap(null)},!1,this),this.c.forEach(function(t){t.setMap(this)},this),St(this.c,"add",function(t){t.element.setMap(this)},!1,this),St(this.c,"remove",function(t){t.element.setMap(null)},!1,this),this.i.forEach(this.qg,this),St(this.i,"add",function(t){this.qg(t.element)},!1,this),St(this.i,"remove",function(t){var e=t.element.Qa();void 0!==e&&delete this.Y[e.toString()],t.element.setMap(null)},!1,this)}function gc(t){Gt.call(this),this.ya=t.id,this.j=void 0===t.insertFirst||t.insertFirst,this.l=void 0===t.stopEvent||t.stopEvent,this.b=document.createElement("DIV"),this.b.className="ol-overlay-container",this.b.style.position="absolute",this.autoPan=void 0!==t.autoPan&&t.autoPan,this.g=void 0!==t.autoPanAnimation?t.autoPanAnimation:{},this.i=void 0!==t.autoPanMargin?t.autoPanMargin:20,this.a={Vd:"",re:"",Qe:"",Re:"",visible:!0},this.c=null,St(this,Vt("element"),this.Hk,!1,this),St(this,Vt("map"),this.Rk,!1,this),St(this,Vt("offset"),this.Wk,!1,this),St(this,Vt("position"),this.Yk,!1,this),St(this,Vt("positioning"),this.Zk,!1,this),void 0!==t.element&&this.ci(t.element),this.ii(void 0!==t.offset?t.offset:[0,0]),this.li(void 0!==t.positioning?t.positioning:"top-left"),void 0!==t.position&&this.Cf(t.position)}function yc(t,e){var i=Uo(t),o=new So(0,0),r=i?Uo(i):document;return t!=(r=!gm||9<=Em||jo(Ao(r))?r.documentElement:r.body)&&(r=Qo(t),i=Zo(Ao(i)),o.x=r.left+i.x,o.y=r.top+i.y),[o.x,o.y,o.x+e[0],o.y+e[1]]}function mc(t,e){t.a.visible!==e&&(rr(t.b,e),t.a.visible=e)}function _c(t){var e,i,o,r,n=t.ve(),s=t.gh();void 0!==n&&n.b&&void 0!==s?(s=n.Ra(s),e=n.Ta(),n=t.b.style,r=t.Kg(),i=t.Lg(),o=r[0],r=r[1],"bottom-right"==i||"center-right"==i||"top-right"==i?(""!==t.a.re&&(t.a.re=n.left=""),o=Math.round(e[0]-s[0]-o)+"px",t.a.Qe!=o&&(t.a.Qe=n.right=o)):(""!==t.a.Qe&&(t.a.Qe=n.right=""),"bottom-center"!=i&&"center-center"!=i&&"top-center"!=i||(o-=ir(t.b).width/2),o=Math.round(s[0]+o)+"px",t.a.re!=o&&(t.a.re=n.left=o)),"bottom-left"==i||"bottom-center"==i||"bottom-right"==i?(""!==t.a.Re&&(t.a.Re=n.top=""),s=Math.round(e[1]-s[1]-r)+"px",t.a.Vd!=s&&(t.a.Vd=n.bottom=s)):(""!==t.a.Vd&&(t.a.Vd=n.bottom=""),"center-left"!=i&&"center-center"!=i&&"center-right"!=i||(r-=ir(t.b).height/2),s=Math.round(s[1]+r)+"px",t.a.Re!=s&&(t.a.Re=n.top=s)),mc(t,!0)):mc(t,!1)}function vc(t){this.i=void 0===(t=t||{}).collapsed||t.collapsed,this.j=void 0===t.collapsible||t.collapsible,this.j||(this.i=!1);var e=t.className||"ol-overviewmap",i=t.tipLabel||"Overview map",o=t.collapseLabel||"";this.B=u(o)?Oo("SPAN",{},o):o,o=t.label||"",this.v=u(o)?Oo("SPAN",{},o):o,St(i=Oo("BUTTON",{type:"button",title:i},this.j&&!this.i?this.B:this.v),"click",this.cm,!1,this);var o=Oo("DIV","ol-overviewmap-map"),r=this.b=new fc({controls:new xo,interactions:new xo,target:o,view:t.view});t.layers&&t.layers.forEach(function(t){r.og(t)},this);var n=Oo("DIV","ol-overviewmap-box");this.l=new gc({position:[0,0],positioning:"bottom-left",element:n}),this.b.pg(this.l),e=Oo("DIV",e+" ol-unselectable ol-control"+(this.i&&this.j?" ol-collapsed":"")+(this.j?"":" ol-uncollapsible"),o,i),cr.call(this,{element:e,render:t.render||bc,target:t.target})}function bc(){var t,e,i,o=this.a,r=this.b;o.b&&r.b&&(t=o.Ta(),o=o.aa().bd(t),i=r.Ta(),t=r.aa().bd(i),e=r.Ra(Ge(o)),r=r.Ra(Ne(o)),r=new To(Math.abs(e[0]-r[0]),Math.abs(e[1]-r[1])),e=i[0],i=i[1],r.width<.1*e||r.height<.1*i||r.width>.75*e||r.height>.75*i?xc(this):Pe(t,o)||(o=this.b,t=this.a.aa(),o.aa().mb(t.Va()))),wc(this)}function xc(t){var e=t.a;t=t.b;var i=e.Ta(),e=e.aa().bd(i),i=t.Ta();t=t.aa(),Ye(e,1/(.1*Math.pow(2,Math.log(7.5)/Math.LN2/2))),t.mf(e,i)}function wc(t){var e,i,o,r,n,s=t.a,a=t.b;s.b&&a.b&&(o=s.Ta(),n=s.aa(),r=a.aa(),a.Ta(),s=n.Ha(),i=t.l,a=t.l.ue(),n=n.bd(o),o=r.$(),r=Fe(n),n=Ve(n),(t=t.a.aa().Va())&&(ie(e=[r[0]-t[0],r[1]-t[1]],s),$t(e,t)),i.Cf(e),a&&(e=new To(Math.abs((r[0]-n[0])/o),Math.abs((n[1]-r[1])/o)),s=jo(Ao(Uo(a))),!gm||at("10")||s&&at("8")?(a=a.style,mm?a.MozBoxSizing="border-box":_m?a.WebkitBoxSizing="border-box":a.boxSizing="border-box",a.width=Math.max(e.width,0)+"px",a.height=Math.max(e.height,0)+"px"):(t=a.style,s?(s=ar(a,"padding"),a=hr(a),t.pixelWidth=e.width-a.left-s.left-s.right-a.right,t.pixelHeight=e.height-a.top-s.top-s.bottom-a.bottom):(t.pixelWidth=e.width,t.pixelHeight=e.height))))}function Mc(t){qo(t.element,"ol-collapsed"),t.i?zo(t.B,t.v):zo(t.v,t.B),t.i=!t.i;var e=t.b;t.i||e.b||(e.Xc(),xc(t),At(e,"postrender",function(){wc(this)},!1,t))}function Pc(t){var e=(t=t||{}).className||"ol-scale-line";this.j=Oo("DIV",e+"-inner"),this.i=Oo("DIV",e+" ol-unselectable",this.j),this.B=null,this.l=void 0!==t.minWidth?t.minWidth:64,this.b=!1,this.D=void 0,this.v="",cr.call(this,{element:this.i,render:t.render||Ec,target:t.target}),St(this,Vt("units"),this.T,!1,this),this.O(t.units||"metric")}function Ec(t){(t=t.frameState)?this.B=t.viewState:this.B=null,Sc(this)}function Sc(t){if(i=t.B){var e=(o=i.projection).$b(),i=o.getPointResolution(i.resolution,i.center)*e,e=t.l*i,o="";"degrees"==(n=t.C())?(i/=o=Gm.degrees,e<o/60?(o="",i*=3600):e<o?(o="",i*=60):o=""):"imperial"==n?e<.9144?(o="in",i/=.0254):e<1609.344?(o="ft",i/=.3048):(o="mi",i/=1609.344):"nautical"==n?(i/=1852,o="nm"):"metric"==n?e<1?(o="mm",i*=1e3):e<1e3?o="m":(o="km",i/=1e3):"us"==n&&(e<.9144?(o="in",i*=39.37):e<1609.344?(o="ft",i/=.30480061):(o="mi",i/=1609.3472));for(var r,n=3*Math.floor(Math.log(t.l*i)/Math.log(10));;){if(r=l0[(n%3+3)%3]*Math.pow(10,Math.floor(n/3)),e=Math.round(r/i),isNaN(e))return rr(t.i,!1),t.b=!1;if(e>=t.l)break;++n}t.v!=(i=r+" "+o)&&(t.j.innerHTML=i,t.v=i),t.D!=e&&(t.j.style.width=e+"px",t.D=e),t.b||(rr(t.i,!0),t.b=!0)}else t.b&&(rr(t.i,!1),t.b=!1)}function Tc(t){lt.call(this),this.f=t,this.a={}}function Ac(t){X(t.a,function(t,e){this.a.hasOwnProperty(e)&&It(t)},t),t.a={}}function Cc(t,e,i){Ft.call(this),this.target=t,this.handle=e||t,this.a=i||new Xo(NaN,NaN,NaN,NaN),this.i=Uo(t),this.f=new Tc(this),ht(this,this.f),this.g=this.c=this.o=this.l=this.screenY=this.screenX=this.clientY=this.clientX=0,this.b=!1,St(this.handle,["touchstart","mousedown"],this.ri,!1,this)}function Ic(t,e,i){var o=Zo(Ao(t.i));return e+=o.x-t.j.x,i+=o.y-t.j.y,t.j=o,t.c+=e,t.g+=i,new So(Oc(t,t.c),Rc(t,t.g))}function Lc(t,e,i,o){t.target.style.left=i+"px",t.target.style.top=o+"px",t.s(new Dc("drag",t,e.clientX,e.clientY,0,i,o))}function Oc(t,e){var i=t.a,t=isNaN(i.left)?null:i.left,i=isNaN(i.width)?0:i.width;return Math.min(null!=t?t+i:1/0,Math.max(null!=t?t:-1/0,e))}function Rc(t,e){var i=t.a,t=isNaN(i.top)?null:i.top,i=isNaN(i.height)?0:i.height;return Math.min(null!=t?t+i:1/0,Math.max(null!=t?t:-1/0,e))}function Dc(t,e,i,o,r,n,s){ct.call(this,t),this.clientX=i,this.clientY=o,this.left=l(n)?n:e.c,this.top=l(s)?s:e.g}function kc(t){t=t||{},this.i=void 0,this.j=c0,this.l=null,this.v=!1,this.B=void 0!==t.duration?t.duration:200;var e=Oo("BUTTON",{type:"button",class:(i=t.className||"ol-zoomslider")+"-thumb ol-unselectable"}),i=Oo("DIV",[i,"ol-unselectable","ol-control"],e);this.b=new Cc(e),ht(this,this.b),St(this.b,"start",this.Gk,!1,this),St(this.b,"drag",this.Ek,!1,this),St(this.b,"end",this.Fk,!1,this),St(i,"click",this.Dk,!1,this),St(e,"click",ut),cr.call(this,{element:i,render:t.render||zc})}function zc(t){var e,i,o,r,n,s;t.frameState&&(this.v||(e=ir(o=this.element),o=ar(r=Fo(o),"margin"),r=(i=new To(r.offsetWidth,r.offsetHeight)).width+o.right+o.left,o=i.height+o.top+o.bottom,this.l=[r,o],r=e.width-r,o=e.height-o,e=e.width>e.height?(this.j=1,new Xo(0,0,r,0)):(this.j=c0,new Xo(0,0,0,o)),this.b.a=e||new Xo(NaN,NaN,NaN,NaN),this.v=!0),(t=t.frameState.viewState.resolution)!==this.i&&(this.i=t,t=1-(r=this.a.aa(),n=r.a,s=Math.log(n/r.j)/Math.log(2),function(t){return Math.log(n/t)/Math.log(2)/s}(t)),e=this.b,o=Fo(this.element),1==this.j?Jo(o,e.a.left+e.a.width*t):Jo(o,e.a.left,e.a.top+e.a.height*t)))}function Fc(t,e,i){var o=t.b.a;return x(1===t.j?(e-o.left)/o.width:(i-o.top)/o.height,0,1)}function Nc(t,e){return t=t.a.aa(),i=t.a,o=Math.log(i/t.j)/Math.log(2),function(t){return i/Math.pow(2,t*o)}(1-e);var i,o}function Uc(t){this.b=(t=t||{}).extent||null;var e=t.className||"ol-zoom-extent",i=Oo("BUTTON",{type:"button",title:t.tipLabel||"Fit to extent"},t.label||"E");St(i,"click",this.i,!1,this),e=Oo("DIV",e+" ol-unselectable ol-control",i),cr.call(this,{element:e,target:t.target})}function Bc(t){Gt.call(this),t=t||{},this.a=null,St(this,Vt("tracking"),this.Gl,!1,this),this.Af(void 0!==t.tracking&&t.tracking)}function jc(){this.defaultDataProjection=null}function Zc(t,e,i){var o;return i&&(o={dataProjection:i.dataProjection||t.Ka(e),featureProjection:i.featureProjection}),Gc(t,o)}function Gc(t,e){var i;return i=e?{featureProjection:e.featureProjection,dataProjection:e.dataProjection||t.defaultDataProjection,rightHanded:e.rightHanded}:i}function Vc(t,e,i){var o=i?ai(i.featureProjection):null;return i=i?ai(i.dataProjection):null,o&&i&&!li(o,i)?t instanceof gi?(e?t.clone():t).nb(e?o:i,e?i:o):fi(e?t.slice():t,e?o:i,e?i:o):t}function Wc(){this.defaultDataProjection=null}function Hc(t){return d(t)||u(t)&&(t=Mv(t))?t:null}function qc(t,e,i,o,r,n){var s=NaN,a=NaN;if(0!==(h=(i-e)/o))if(1==h)s=t[e],a=t[e+1];else if(2==h)s=(1-r)*t[e]+r*t[e+o],a=(1-r)*t[e+1]+r*t[e+o+1];else{for(var l,a=t[e],h=t[e+1],p=0,s=[0],c=e+o;c<i;c+=o){var u=t[c],d=t[c+1],p=p+Math.sqrt((u-a)*(u-a)+(d-h)*(d-h));s.push(p),a=u,h=d}for(i=r*p,r=N,a=0,h=s.length;a<h;)0<(c=r(i,s[p=a+h>>1]))?a=p+1:(h=p,l=!c);a=(l=l?a:~a)<0?(i=(i-s[-l-2])/(s[-l-1]-s[-l-2]),s=Kt(t[e+=(-l-2)*o],t[e+o],i),Kt(t[e+1],t[e+o+1],i)):(s=t[e+l*o],t[e+l*o+1])}return n?(n[0]=s,n[1]=a,n):[s,a]}function Yc(t,e,i,o,r,n){if(i==e)return null;if(r<t[e+o-1])return n?((i=t.slice(e,e+o))[o-1]=r,i):null;if(t[i-1]<r)return n?((i=t.slice(i-o,i))[o-1]=r,i):null;if(r==t[e+o-1])return t.slice(e,e+o);for(e/=o,i/=o;e<i;)r<t[((n=e+i>>1)+1)*o-1]?i=n:e=n+1;if(r==(i=t[e*o-1]))return t.slice((e-1)*o,(e-1)*o+o);var s;for(n=(r-i)/(t[(e+1)*o-1]-i),i=[],s=0;s<o-1;++s)i.push(Kt(t[(e-1)*o+s],t[e*o+s],n));return i.push(r),i}function Xc(t,e){mi.call(this),this.g=null,this.C=this.D=this.l=-1,this.ma(t,e)}function Kc(t){return t.l!=t.f&&(t.g=t.Ag(.5,t.g),t.l=t.f),t.g}function $c(t,e){mi.call(this),this.g=[],this.l=this.C=-1,this.ma(t,e)}function Jc(t){var e,i,o=[],r=t.A,n=0,s=t.g;for(t=t.a,e=0,i=s.length;e<i;++e){var a=s[e];D(o,n=qc(r,n,a,t,.5)),n=a}return o}function Qc(t,e){for(var i=t.b,o=[],r=[],n=0,s=e.length;n<s;++n){var a=e[n];0===n&&(i=a.b),D(o,a.ja()),r.push(o.length)}t.ba(i,o,r)}function tu(t,e){mi.call(this),this.ma(t,e)}function eu(t,e){mi.call(this),this.g=[],this.C=-1,this.D=null,this.T=this.O=this.U=-1,this.l=null,this.ma(t,e)}function iu(t){if(t.C!=t.f){for(var e=t.A,i=t.g,o=t.a,r=0,n=[],s=Te(),a=0,l=i.length;a<l;++a){var h=i[a],s=Ie(e,r,h[0],o);n.push((s[0]+s[2])/2,(s[1]+s[3])/2),r=h[h.length-1]}for(e=ou(t),i=t.g,o=t.a,a=[],l=r=0,s=i.length;l<s;++l)a=Bi(e,r,h=i[l],o,n,2*l,a),r=h[h.length-1];t.D=a,t.C=t.f}return t.D}function ou(t){if(t.T!=t.f){var e=t.A;t:{for(var i,o=0,r=(i=t.g).length;o<r;++o)if(!Wi(e,i[o],t.a,void 0)){i=!1;break t}i=!0}i?t.l=e:(t.l=e.slice(),t.l.length=qi(t.l,t.g,t.a)),t.T=t.f}return t.l}function ru(t,e,i,o){vi(t,e,i),t.g=o,t.u()}function nu(t,e){for(var i=t.b,o=[],r=[],n=0,s=e.length;n<s;++n){var a=e[n];0===n&&(i=a.b);for(var l,h=o.length,p=0,c=(l=a.Bb()).length;p<c;++p)l[p]+=h;D(o,a.ja()),r.push(l)}ru(t,i,o,r)}function su(t){t=t||{},this.defaultDataProjection=null,this.a=t.geometryName}function au(t,e){if(!t)return null;if(y(t.x)&&y(t.y))n="Point";else if(t.points)n="MultiPoint";else if(t.paths)n=1===t.paths.length?"LineString":"MultiLineString";else if(t.rings){for(var i=t.rings,o=lu(t),r=[],n=[],s=0,a=i.length;s<a;++s){var l=B(i[s]);Vi(l,0,l.length,o.length)?r.push([i[s]]):n.push(i[s])}for(;n.length;){for(i=n.shift(),o=!1,s=r.length-1;0<=s;s--)if(Pe(new ki(r[s][0]).J(),new ki(i).J())){r[s].push(i),o=!0;break}o||r.push([i.reverse()])}t=rt(t),1===r.length?(n="Polygon",t.rings=r[0]):(n="MultiPolygon",t.rings=r)}return Vc(u0[n](t),!1,e)}function lu(t){var e="XY";return!0===t.hasZ&&!0===t.hasM?e="XYZM":!0===t.hasZ?e="XYZ":!0===t.hasM&&(e="XYM"),e}function hu(t){return{hasZ:"XYZ"===(t=t.b)||"XYZM"===t,hasM:"XYM"===t||"XYZM"===t}}function pu(t,e){return d0[t.V()](Vc(t,!0,e),e)}function cu(t){gi.call(this),this.c=t||null,fu(this)}function uu(t){for(var e=[],i=0,o=t.length;i<o;++i)e.push(t[i].clone());return e}function du(t){var e,i;if(t.c)for(e=0,i=t.c.length;e<i;++e)Ct(t.c[e],"change",t.u,!1,t)}function fu(t){var e,i;if(t.c)for(e=0,i=t.c.length;e<i;++e)St(t.c[e],"change",t.u,!1,t)}function gu(t){t=t||{},this.defaultDataProjection=null,this.defaultDataProjection=ai(t.defaultDataProjection||"EPSG:4326"),this.a=t.geometryName}function yu(t,e){return t?Vc(f0[t.type](t),!1,e):null}function mu(t,e){return g0[t.V()](Vc(t,!0,e),e)}function _u(){this.defaultDataProjection=null}function vu(t,e,i){return 0<(t=bu(t,e,i)).length?t[0]:null}function bu(t,e,i){var o=[];for(e=e.firstChild;e;e=e.nextSibling)1==e.nodeType&&D(o,t.jc(e,i));return o}function xu(t){this.featureType=(t=t||{}).featureType,this.featureNS=t.featureNS,this.srsName=t.srsName,this.schemaLocation="",this.a={},this.a["http://www.opengis.net/gml"]={featureMember:Ch(xu.prototype.Gd),featureMembers:Ch(xu.prototype.Gd)},this.defaultDataProjection=null}function wu(t){return Mu(t=Eh(t,!1))}function Mu(t){return(t=/^\s*(true|1)|(false|0)\s*$/.exec(t))?void 0!==t[1]||!1:void 0}function Pu(t){if(t=Eh(t,!1),t=/^\s*(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(Z|(?:([+\-])(\d{2})(?::(\d{2}))?))\s*$/.exec(t)){var e,i=Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[4],10),parseInt(t[5],10),parseInt(t[6],10))/1e3;return"Z"!=t[7]&&(i+=60*(e="-"==t[8]?-1:1)*parseInt(t[9],10),void 0!==t[10]&&(i+=3600*e*parseInt(t[10],10))),i}}function Eu(t){return Su(t=Eh(t,!1))}function Su(t){return(t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t))?parseFloat(t[1]):void 0}function Tu(t){return Au(t=Eh(t,!1))}function Au(t){return(t=/^\s*(\d+)\s*$/.exec(t))?parseInt(t[1],10):void 0}function Cu(t){return Eh(t,!1).trim()}function Iu(t,e){Ru(t,e?"1":"0")}function Lu(t,e){t.appendChild(Fv.createTextNode(e.toPrecision()))}function Ou(t,e){t.appendChild(Fv.createTextNode(e.toString()))}function Ru(t,e){t.appendChild(Fv.createTextNode(e))}function Du(t){xu.call(this,t=t||{}),this.a["http://www.opengis.net/gml"].featureMember=Ah(xu.prototype.Gd),this.schemaLocation=t.schemaLocation||"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd"}function ku(t){xu.call(this,t=t||{}),this.l=void 0!==t.surface&&t.surface,this.g=void 0!==t.curve&&t.curve,this.i=void 0===t.multiCurve||t.multiCurve,this.j=void 0===t.multiSurface||t.multiSurface,this.schemaLocation=t.schemaLocation||"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd"}function zu(t,e,i){i=i[i.length-1].srsName;for(var o=(e=e.Z()).length,r=Array(o),n=0;n<o;++n){var s=e[n],a=n,l="enu";i&&(l=ai(i).c),r[a]="en"===l.substr(0,2)?s[0]+" "+s[1]:s[1]+" "+s[0]}Ru(t,r.join(" "))}function Fu(t){t=t||{},this.defaultDataProjection=null,this.defaultDataProjection=ai("EPSG:4326"),this.a=t.readExtensions}function Nu(t,e,i){return t.push(parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))),"ele"in i?(t.push(i.ele),delete i.ele):t.push(0),"time"in i?(t.push(i.time),delete i.time):t.push(0),t}function Uu(t,e){var i=e[e.length-1],o=t.getAttribute("href");null!==o&&(i.link=o),Fh(S0,t,e)}function Bu(t,e){e[e.length-1].extensionsNode_=t}function ju(t,e){var i=e[0],o=Nh({flatCoordinates:[]},T0,t,e);if(o){t=o.flatCoordinates;delete o.flatCoordinates;e=new Xc(null);return e.ba("XYZM",t),Vc(e,!1,i),(i=new Bl(e)).I(o),i}}function Zu(t,e){var i=e[0],o=Nh({flatCoordinates:[],ends:[]},C0,t,e);if(o){var r=o.flatCoordinates;delete o.flatCoordinates;t=o.ends;delete o.ends;e=new $c(null);return e.ba("XYZM",r,t),Vc(e,!1,i),(i=new Bl(e)).I(o),i}}function Gu(t,e){var i=e[0],e=Nh({},O0,t,e);if(e)return Vc(t=new Fi(t=Nu([],t,e),"XYZM"),!1,i),(i=new Bl(t)).I(e),i}function Vu(t,e){for(var i=0,o=(e=e||[]).length;i<o;++i){var r,n=e[i];t.a&&(r=n.get("extensionsNode_")||null,t.a(n,r)),n.set("extensionsNode_",void 0)}}function Wu(t,e,i){t.setAttribute("href",e),e=i[i.length-1].properties,Bh({node:t},D0,Wv,[e.linkText,e.linkType],i,R0)}function Hu(t,e,i){var o=i[i.length-1],r=o.node.namespaceURI,n=o.properties;switch(Vv(t,null,"lat",e[1]),Vv(t,null,"lon",e[0]),o.geometryLayout){case"XYZM":0!==e[3]&&(n.time=e[3]);case"XYZ":0!==e[2]&&(n.ele=e[2]);break;case"XYM":0!==e[2]&&(n.time=e[2])}o=kh(n,e=j0[r]),Bh({node:t,properties:n},Z0,Wv,o,i,e)}function qu(t,e){t=t.W();return(t=t&&G0[t.V()])?Nv(e[e.length-1].node.namespaceURI,t):void 0}function Yu(t){return t=function(t){for(var e,i=RegExp("\r\n|\r|\n","g"),o=0,r=[];e=i.exec(t);)o=new Xu(t,o,e.index),r.push(o),o=i.lastIndex;return o<t.length&&(o=new Xu(t,o,t.length),r.push(o)),r}(t),e=t,t=function(t){return t.b.substring(t.f,t.a)},cm.map.call(e,t,void 0);var e}function Xu(t,e,i){this.b=t,this.f=e,this.a=i}function Ku(){this.defaultDataProjection=null}function $u(t){t=t||{},this.defaultDataProjection=null,this.defaultDataProjection=ai("EPSG:4326"),this.a=t.altitudeMode||"none"}function Ju(t,e){var i;this.f=this.j=this.c="",this.l=null,this.g=this.a="",this.i=!1,t instanceof Ju?(this.i=l(e)?e:t.i,Qu(this,t.c),this.j=t.j,this.f=t.f,td(this,t.l),this.a=t.a,ed(this,t.b.clone()),this.g=t.g):t&&(i=String(t).match(Sv))?(this.i=!!e,Qu(this,i[1]||"",!0),this.j=rd(i[2]||""),this.f=rd(i[3]||"",!0),td(this,i[4]),this.a=rd(i[5]||"",!0),ed(this,i[6]||"",!0),this.g=rd(i[7]||"")):(this.i=!!e,this.b=new ad(null,0,this.i))}function Qu(t,e,i){t.c=i?rd(e,!0):e,t.c&&(t.c=t.c.replace(/:$/,""))}function td(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.l=e}else t.l=null}function ed(t,e,i){var o,r;e instanceof ad?(t.b=e,o=t.b,(r=t.i)&&!o.c&&(ld(o),o.b=null,o.a.forEach(function(t,e){var i=e.toLowerCase();e!=i&&(this.remove(e),pd(this,i,t))},o)),o.c=r):(i||(e=nd(e,$0)),t.b=new ad(e,0,t.i))}function id(t){return t instanceof Ju?t.clone():new Ju(t,void 0)}function od(t,e){t instanceof Ju||(t=id(t));var i=e=!(e instanceof Ju)?id(e):e,e=(r=t).clone(),t=!!i.c;t?Qu(e,i.c):t=!!i.j,t?e.j=i.j:t=!!i.f,t?e.f=i.f:t=null!=i.l;var o=i.a;if(t)td(e,i.l);else if(t=!!i.a)if("/"!=o.charAt(0)&&(r.f&&!r.a?o="/"+o:-1!=(r=e.a.lastIndexOf("/"))&&(o=e.a.substr(0,r+1)+o)),".."==(r=o)||"."==r)o="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){for(var o=0==r.lastIndexOf("/",0),r=r.split("/"),n=[],s=0;s<r.length;){var a=r[s++];"."==a?o&&s==r.length&&n.push(""):".."==a?((1<n.length||1==n.length&&""!=n[0])&&n.pop(),o&&s==r.length&&n.push("")):(n.push(a),o=!0)}o=n.join("/")}else o=r;return t?e.a=o:t=""!==i.b.toString(),t?ed(e,rd(i.b.toString())):t=!!i.g,t&&(e.g=i.g),e}function rd(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function nd(t,e,i){return u(t)?(t=encodeURI(t).replace(e,sd),t=i?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function sd(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}function ad(t,e,i){this.f=this.a=null,this.b=t||null,this.c=!!i}function ld(o){o.a||(o.a=new nn,o.f=0,o.b&&function(t,e){if(t)for(var i=t.split("&"),o=0;o<i.length;o++){var r=i[o].indexOf("="),n=null,s=null;0<=r?(n=i[o].substring(0,r),s=i[o].substring(r+1)):n=i[o],e(n,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}(o.b,function(t,e){var i=decodeURIComponent(t.replace(/\+/g," "));ld(o),o.b=null;i=cd(o,i),t=o.a.get(i);t||o.a.set(i,t=[]),t.push(e),o.f++}))}function hd(t,e){return ld(t),e=cd(t,e),an(t.a.f,e)}function pd(t,e,i){t.remove(e),0<i.length&&(t.b=null,t.a.set(cd(t,e),O(i)),t.f+=i.length)}function cd(t,e){e=String(e);return e=t.c?e.toLowerCase():e}function ud(t){this.b=(t=t||{}).font,this.i=t.rotation,this.f=t.scale,this.G=t.text,this.l=t.textAlign,this.o=t.textBaseline,this.a=void 0!==t.fill?t.fill:new Ra({color:"#333"}),this.j=void 0!==t.stroke?t.stroke:null,this.c=void 0!==t.offsetX?t.offsetX:0,this.g=void 0!==t.offsetY?t.offsetY:0}function dd(t){t=t||{},this.defaultDataProjection=null,this.defaultDataProjection=ai("EPSG:4326"),this.b=t.defaultStyle||l1,this.c=void 0===t.extractStyles||t.extractStyles,this.i=void 0===t.writeStyles||t.writeStyles,this.a={},this.g=void 0===t.showPointNames||t.showPointNames}function fd(t,e){var i=null,o=[0,0],r="start";return t.f&&(i=t.f.td())&&2==i.length&&(o[0]=t.f.j*i[0]/2,o[1]=-t.f.j*i[1]/2,r="left"),tt(t.Da())?i=new ud({text:e,offsetX:o[0],offsetY:o[1],textAlign:r}):((i=rt(t.Da())).mi(e),i.ni(r),i.ji(o[0]),i.ki(o[1])),new ja({text:i})}function gd(o,r,n,s,a){return function(){var t=a,e="";if((t=t&&this.W()?"Point"===this.W().V():t)&&(e=this.R().name,t=t&&e),o)return t?(t=fd(o[0],e),o.concat(t)):o;if(r){var i=function t(e,i,o){return w(e)?e:u(e)?(!(e in o)&&"#"+e in o&&(e="#"+e),t(o[e],i,o)):i}(r,n,s);return t?(t=fd(i[0],e),i.concat(t)):i}return t?(t=fd(n[0],e),n.concat(t)):n}}function yd(t){return t=Eh(t,!1),(t=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t))?(t=t[1],[parseInt(t.substr(6,2),16),parseInt(t.substr(4,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(0,2),16)/255]):void 0}function md(t){t=Eh(t,!1);for(var e,i=[],o=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;e=o.exec(t);)i.push(parseFloat(e[1]),parseFloat(e[2]),e[3]?parseFloat(e[3]):0),t=t.substr(e[0].length);return""!==t?void 0:i}function _d(t){var e=Eh(t,!1);return t.baseURI?od(t.baseURI,e.trim()).toString():e.trim()}function vd(t){return void 0!==(t=Eu(t))?Math.sqrt(t):void 0}function bd(t,e){return Nh(null,d1,t,e)}function xd(t,e){if(o=Nh({A:[],wi:[]},g1,t,e)){for(var i=o.A,o=o.wi,r=0,n=Math.min(i.length,o.length);r<n;++r)i[4*r+3]=o[r];return(o=new Xc(null)).ba("XYZM",i),o}}function wd(t,e){var i=Nh({},u1,t,e),t=Nh(null,y1,t,e);if(t){e=new Xc(null);return e.ba("XYZ",t),e.I(i),e}}function Md(t,e){var i=Nh({},u1,t,e),t=Nh(null,y1,t,e);if(t){e=new Yi(null);return e.ba("XYZ",t,[t.length]),e.I(i),e}}function Pd(t,e){var i=Nh([],w1,t,e);if(!i)return null;if(0===i.length)return new cu(i);for(var o,r=!0,n=i[0].V(),s=1,a=i.length;s<a;++s)if((o=i[s]).V()!=n){r=!1;break}if(r){if("Point"!=n)return"LineString"==n?(Qc(o=new $c(null),i),Ad(o,i),o):"Polygon"==n?(nu(o=new eu(null),i),Ad(o,i),o):"GeometryCollection"==n?new cu(i):null;for(r=(o=i[0]).b,n=o.ja(),s=1,a=i.length;s<a;++s)D(n,(o=i[s]).ja());return(o=new tu(null)).ba(r,n),Ad(o,i),o}return new cu(i)}function Ed(t,e){var i=Nh({},u1,t,e),t=Nh(null,y1,t,e);if(t){e=new Fi(null);return e.ba("XYZ",t),e.I(i),e}}function Sd(t,e){var i=Nh({},u1,t,e),o=Nh([null],f1,t,e);if(o&&o[0]){for(var e=new Yi(null),r=o[0],n=[r.length],s=1,a=o.length;s<a;++s)D(r,o[s]),n.push(r.length);return e.ba("XYZ",r,n),e.I(i),e}}function Td(t,e){var i=Nh({},L1,t,e);if(!i)return null;var o="fillStyle"in i?i.fillStyle:i1;void 0===(r=i.fill)||r||(o=null);var r="imageStyle"in i?i.imageStyle:n1,t="textStyle"in i?i.textStyle:a1,e="strokeStyle"in i?i.strokeStyle:s1;return[new ja({fill:o,image:r,stroke:e=void 0!==(i=i.outline)&&!i?null:e,text:t,zIndex:void 0})]}function Ad(t,e){for(var i,o,r=e.length,n=Array(e.length),s=Array(e.length),a=o=!1,l=0;l<r;++l)i=e[l],n[l]=i.get("extrude"),s[l]=i.get("altitudeMode"),a=a||void 0!==n[l],o=o||s[l];a&&t.set("extrude",n),o&&t.set("altitudeMode",s)}function Cd(t,e){Fh(c1,t,e)}function Id(t,e){for(var i=e.firstChild;i;i=i.nextSibling)if(1==i.nodeType){var o=Ld(t,i);if(o)return o}}function Ld(t,e){for(var i=e.firstElementChild;i;i=i.nextElementSibling)if(G(t1,i.namespaceURI)&&"name"==i.localName)return Cu(i);for(i=e.firstElementChild;i;i=i.nextElementSibling){var o=Uv(i);if(G(t1,i.namespaceURI)&&("Document"==o||"Folder"==o||"Placemark"==o||"kml"==o)&&(o=Ld(t,i)))return o}}function Od(t,e){for(var i=[],o=e.firstChild;o;o=o.nextSibling)1==o.nodeType&&D(i,Rd(t,o));return i}function Rd(t,e){for(var i,o=[],r=e.firstElementChild;r;r=r.nextElementSibling)G(t1,r.namespaceURI)&&"NetworkLink"==r.localName&&(i=Nh({},P1,r,[]),o.push(i));for(r=e.firstElementChild;r;r=r.nextElementSibling)i=Uv(r),!G(t1,r.namespaceURI)||"Document"!=i&&"Folder"!=i&&"kml"!=i||D(o,Rd(t,r));return o}function Dd(t,e){for(var i=[255*(4==(i=Mo(e)).length?i[3]:1),i[2],i[1],i[0]],o=0;o<4;++o){var r=parseInt(i[o],10).toString(16);i[o]=1==r.length?"0"+r:r}Ru(t,i.join(""))}function kd(t,e,i){Bh({node:t},X1,hb,[e],i)}function zd(t,e,i){var o={node:t};e.Qa()&&t.setAttribute("id",e.Qa()),t=e.R();var r,n=e.cc();(n=n&&n.call(e,0))&&0<n.length&&(r=n[0],this.i&&(t.Style=n[0]),(n=r.Da())&&(t.name=n.Da())),t=kh(t,n=$1[i[i.length-1].node.namespaceURI]),Bh(o,J1,Wv,t,i,n),t=i[0],(e=e.W())&&(e=Vc(e,!0,t)),Bh(o,J1,Zd,[e],i)}function Fd(t,e,i){var o=e.ja();(t={node:t}).layout=e.b,t.stride=e.sa(),Bh(t,Q1,nb,[o],i)}function Nd(t,e,i){var o=(e=e.de()).shift();Bh(t={node:t},tb,sb,e,i),Bh(t,tb,cb,[o],i)}function Ud(t,e){Lu(t,e*e)}function Bd(t,e,i){return Nv(Q0[0],"gx:"+i)}function jd(t,e){return Nv(e[e.length-1].node.namespaceURI,"Placemark")}function Zd(t,e){return t?Nv(e[e.length-1].node.namespaceURI,B1[t.V()]):void 0}function Gd(t){this.defaultDataProjection=null,t=t||{},this.defaultDataProjection=new ti({code:"EPSG:3857",units:"tile-pixels"}),this.a=t.featureClass||Ml,this.c=t.geometryName||"geometry",this.f=t.layerName||"layer",this.b=t.layers||null}function Vd(t,e,i){for(var o=0,r=0,n=t.length;r<n;++r){for(var s=t[r],a=0,l=s.length;a<l;++a){var h=s[a];e.push(h.x,h.y)}o+=2*a,i.push(o)}}function Wd(){this.defaultDataProjection=null,this.defaultDataProjection=ai("EPSG:4326")}function Hd(t,e){e[e.length-1].Kd[t.getAttribute("k")]=t.getAttribute("v")}function qd(t){return t.getAttributeNS("http://www.w3.org/1999/xlink","href")}function Yd(){}function Xd(){}function Kd(t,e,i,o){for(var r=void 0!==o?o:[],n=o=0;n<e;){var s=t[n++];for(r[o++]=t[n++],r[o++]=s,s=2;s<i;++s)r[o++]=t[n++]}r.length=o}function $d(t){t=t||{},this.defaultDataProjection=null,this.defaultDataProjection=ai("EPSG:4326"),this.a=t.factor||1e5,this.f=t.geometryLayout||"XY"}function Jd(t,e,i){for(var o,r,n=Array(e),s=0;s<e;++s)n[s]=0;for(o=0,r=t.length;o<r;)for(s=0;s<e;++s,++o){var a=t[o],l=a-n[s];n[s]=a,t[o]=l}return tf(t,i||1e5)}function Qd(t,e,i){for(var o,r=Array(e),n=0;n<e;++n)r[n]=0;for(t=ef(t,i||1e5),i=0,o=t.length;i<o;)for(n=0;n<e;++n,++i)r[n]+=t[i],t[i]=r[n];return t}function tf(t,e){for(var i=e||1e5,o=0,r=t.length;o<r;++o)t[o]=Math.round(t[o]*i);for(i=0,o=t.length;i<o;++i)r=t[i],t[i]=r<0?~(r<<1):r<<1;for(i="",o=0,r=t.length;o<r;++o){for(var n=t[o],s=void 0,a="";32<=n;)s=63+(32|31&n),a+=String.fromCharCode(s),n>>=5;s=n+63,i+=a+=String.fromCharCode(s)}return i}function ef(t,e){for(var i=e||1e5,o=[],r=0,n=0,s=0,a=t.length;s<a;++s){var l=t.charCodeAt(s)-63,r=r|(31&l)<<n;l<32?(o.push(r),n=r=0):n+=5}for(r=0,n=o.length;r<n;++r)s=o[r],o[r]=1&s?~(s>>1):s>>1;for(r=0,n=o.length;r<n;++r)o[r]/=i;return o}function of(t){t=t||{},this.defaultDataProjection=null,this.defaultDataProjection=ai(t.defaultDataProjection||"EPSG:4326")}function rf(t,e){for(var i,o,r=[],n=0,s=t.length;n<s;++n)i=t[n],0<n&&r.pop(),o=0<=i?e[i]:e[~i].slice().reverse(),r.push.apply(r,o);for(i=0,o=r.length;i<o;++i)r[i]=r[i].slice();return r}function nf(t,e,i,o,r){var n=t.type,s=Cb[n];return e="Point"===n||"MultiPoint"===n?s(t,i,o):s(t,e),(i=new Bl).Oa(Vc(e,!1,r)),void 0!==t.id&&i.kc(t.id),t.properties&&i.I(t.properties),i}function sf(t,e,i){t[0]=t[0]*e[0]+i[0],t[1]=t[1]*e[1]+i[1]}function af(t){this.g=(t=t||{}).featureType,this.b=t.featureNS,this.a=t.gmlFormat||new ku,this.c=t.schemaLocation||"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd",this.defaultDataProjection=null}function lf(t,e){for(var i=e.firstChild;i;i=i.nextSibling)if(1==i.nodeType)return hf(t,i)}function hf(t,e){var i={},o=Au(e.getAttribute("numberOfFeatures"));return i.numberOfFeatures=o,Nh(i,Ib,e,[],t.a)}function pf(t){for(t=t.firstChild;t;t=t.nextSibling)if(1==t.nodeType)return Nh({},Db,t,[])}function cf(t,e){var i=Nv("http://www.opengis.net/ogc","Filter"),o=Nv("http://www.opengis.net/ogc","FeatureId");i.appendChild(o),o.setAttribute("fid",e),t.appendChild(i)}function uf(t){t=t||{},this.defaultDataProjection=null,this.a=void 0!==t.splitCollection&&t.splitCollection}function df(t){return 0===(t=t.Z()).length?"":t[0]+" "+t[1]}function ff(t){for(var e=[],i=0,o=(t=t.Z()).length;i<o;++i)e.push(t[i][0]+" "+t[i][1]);return e.join(",")}function gf(t){for(var e=[],i=0,o=(t=t.de()).length;i<o;++i)e.push("("+ff(t[i])+")");return e.join(",")}function yf(t){var e=t.V();return t=Nb[e](t),e=e.toUpperCase(),0===t.length?e+" EMPTY":e+"("+t+")"}function mf(t){this.f=t,this.a=-1}function _f(t,e){return"0"<=t&&t<="9"||"."==t&&(void 0===e||!e)}function vf(t){var e=t.f.charAt(++t.a),i={position:t.a,value:e};if("("==e)i.type=2;else if(","==e)i.type=5;else if(")"==e)i.type=3;else if(_f(e)||"-"==e){i.type=4;for(var o,e=t.a,r=!1,n=!1;"."==o?r=!0:"e"!=o&&"E"!=o||(n=!0),_f(o=t.f.charAt(++t.a),r)||!n&&("e"==o||"E"==o)||n&&("-"==o||"+"==o););t=parseFloat(t.f.substring(e,t.a--)),i.value=t}else if("a"<=e&&e<="z"||"A"<=e&&e<="Z"){for(i.type=1,e=t.a;"a"<=(o=t.f.charAt(++t.a))&&o<="z"||"A"<=o&&o<="Z";);t=t.f.substring(e,t.a--).toUpperCase(),i.value=t}else{if(" "==e||"\t"==e||"\r"==e||"\n"==e)return vf(t);if(""!==e)throw Error("Unexpected character: "+e);i.type=6}return i}function bf(t){this.f=t}function xf(t){for(var e=[],i=0;i<2;++i){var o=t.a;if(!t.match(4))break;e.push(o.value)}if(2==e.length)return e;throw Error(Ef(t))}function wf(t){for(var e=[xf(t)];t.match(5);)e.push(xf(t));return e}function Mf(t){for(var e=[t.If()];t.match(5);)e.push(t.If());return e}function Pf(t){var e=1==t.a.type&&"EMPTY"==t.a.value;return e&&(t.a=vf(t.f)),e}function Ef(t){return"Unexpected `"+t.a.value+"` at position "+t.a.position+" in `"+t.f.f+"`"}function Sf(){this.version=void 0}function Tf(t,e){return Nh({},ix,t,e)}function Af(t,e){return Nh({},Jb,t,e)}function Cf(t,e){e=Tf(t,e);if(e){t=[Au(t.getAttribute("width")),Au(t.getAttribute("height"))];return e.size=t,e}}function If(t,e){return Nh([],ox,t,e)}function Lf(){this.b="http://mapserver.gis.umn.edu/mapserver",this.a=new Du,this.defaultDataProjection=null}function Of(){this.b=new Xd}function Rf(t){var e=Cu(t).split(" ");return e&&2==e.length?(t=+e[0],e=+e[1],isNaN(t)||isNaN(e)?void 0:[t,e]):void 0}function Df(t){Gt.call(this),t=t||{},this.a=null,this.c=ci,this.b=void 0,St(this,Vt("projection"),this.Ll,!1,this),St(this,Vt("tracking"),this.Ml,!1,this),void 0!==t.projection&&this.dh(ai(t.projection)),void 0!==t.trackingOptions&&this.oi(t.trackingOptions),this.te(void 0!==t.tracking&&t.tracking)}function kf(t,e,i){mi.call(this),this.Yf(t,e||0,i)}function zf(t){var e=t.A[t.a]-t.A[0];return e*e+(t=t.A[t.a+1]-t.A[1])*t}function Ff(t,e,i){for(var o,r,n,s,a,l,h=[],p=t(0),c=t(1),u=e(p),d=[c,p],f=[l=e(c),u],g=[1,0],y={},m=1e5;0<--m&&0<g.length;)n=g.pop(),p=d.pop(),u=f.pop(),(c=n.toString())in y||(h.push(u[0],u[1]),y[c]=!0),s=g.pop(),c=d.pop(),l=f.pop(),M((r=e(o=t(a=(n+s)/2)))[0],r[1],u[0],u[1],l[0],l[1])<i?(h.push(l[0],l[1]),y[c=s.toString()]=!0):(g.push(s,a,a,n),f.push(l,r,r,u),d.push(c,o,o,p));return h}function Nf(t){t=t||{},this.g=this.l=null,this.b=this.i=1/0,this.c=this.j=-1/0,this.C=this.v=1/0,this.O=this.D=-1/0,this.U=void 0!==t.targetSize?t.targetSize:100,this.pa=void 0!==t.maxLines?t.maxLines:100,this.a=[],this.f=[],this.wa=void 0!==t.strokeStyle?t.strokeStyle:dx,this.B=this.o=void 0,this.G=null,this.setMap(void 0!==t.map?t.map:null)}function Uf(t,e,i,o,r,n,s){var a,l,h,p=s;return a=e,l=i,h=o,o=t.g,r=r,e=Ff(function(t){return[a,l+(h-l)*t]},hi(ai("EPSG:4326"),o),r),(p=void 0!==t.a[p]?t.a[p]:new Xc(null)).ba("XY",e),He(p.J(),n)&&(t.a[s++]=p),s}function Bf(t,e,i,o,r){var n,s,a,l,h=r;return n=e,s=t.c,a=t.b,l=t.g,i=i,e=Ff(function(t){return[s+(a-s)*t,n]},hi(ai("EPSG:4326"),l),i),(h=void 0!==t.f[h]?t.f[h]:new Xc(null)).ba("XY",e),He(h.J(),o)&&(t.f[r++]=h),r}function jf(t,e,i,o,r,n,s){$n.call(this,t,e,i,0,o),this.l=r,this.f=new Image,null!==n&&(this.f.crossOrigin=n),this.g={},this.c=null,this.state=0,this.j=s}function Zf(t,e,i,o,r){mr.call(this,t,e),this.j=i,this.f=new Image,null!==o&&(this.f.crossOrigin=o),this.b={},this.i=null,this.l=r}function Gf(t){t.i.forEach(It),t.i=null}function Vf(t,e){Ft.call(this),this.a=new Tc(this);var i=t;e&&(i=Uo(t)),this.a.Sa(i,"dragenter",this.Rn),i!=t&&this.a.Sa(i,"dragover",this.Sn),this.a.Sa(t,"dragover",this.Tn),this.a.Sa(t,"drop",this.Un)}function Wf(t,e){this.g=[],this.v=t,this.B=e||null,this.c=this.a=!1,this.b=void 0,this.o=this.C=this.j=!1,this.i=0,this.f=null,this.l=0}function Hf(t,e,i){t.a=!0,t.b=i,t.c=!e,Kf(t)}function qf(t){if(t.a){if(!t.o)throw new $f;t.o=!1}}function Yf(t,e,i,o){t.g.push([e,i,o]),t.a&&Kf(t)}function Xf(t){return e=t.g,t=function(t){return c(t[1])},cm.some.call(e,t,void 0);var e}function Kf(e){var i;e.i&&e.a&&Xf(e)&&(o=e.i,(i=gx[o])&&(Xy.clearTimeout(i.ya),delete gx[o]),e.i=0),e.f&&(e.f.l--,delete e.f);for(var o=e.b,t=i=!1;e.g.length&&!e.j;){var r=(s=e.g.shift())[0],n=s[1],s=s[2];if(r=e.c?n:r)try{var a=r.call(s||e.B,o);l(a)&&(e.c=e.c&&(a==o||a instanceof Error),e.b=o=a),(Zl(o)||"function"==typeof Xy.Promise&&o instanceof Xy.Promise)&&(t=!0,e.j=!0)}catch(t){o=t,e.c=!0,Xf(e)||(i=!0)}}e.b=o,t&&(a=f(e.G,e,!0),t=f(e.G,e,!1),o instanceof Wf?(Yf(o,a,t),o.C=!0):o.then(a,t)),i&&(o=new Qf(o),gx[o.ya]=o,e.i=o.ya)}function $f(){a.call(this)}function Jf(){a.call(this)}function Qf(t){this.ya=Xy.setTimeout(f(this.f,this),0),this.a=t}function tg(t,e){l(t.name)?(this.name=t.name,this.code=yx[t.name]):(this.code=t.code,this.name=function(e){var t=Q(yx,function(t){return e==t});if(!l(t))throw Error("Invalid code: "+e);return t}(t.code)),a.call(this,function(t,e){for(var i=t.split("%s"),o="",r=Array.prototype.slice.call(arguments,1);r.length&&1<i.length;)o+=i.shift()+r.shift();return o+i.join("%s")}("%s %s",this.name,e))}function eg(t,e){ct.call(this,t.type,e)}function ig(){Ft.call(this),this.vb=new FileReader,this.vb.onloadstart=f(this.a,this),this.vb.onprogress=f(this.a,this),this.vb.onload=f(this.a,this),this.vb.onabort=f(this.a,this),this.vb.onerror=f(this.a,this),this.vb.onloadend=f(this.a,this)}function og(t){t=t||{},Is.call(this,{handleEvent:Bm}),this.j=t.formatConstructors||[],this.v=t.projection?ai(t.projection):null,this.c=null,this.a=void 0}function rg(t,e,i,o,r){ct.call(this,t,e),this.features=o,this.file=i,this.projection=r}function ng(t,e){this.x=t,this.y=e}function sg(t){t=t||{},Gs.call(this,{handleDownEvent:hg,handleDragEvent:ag,handleUpEvent:lg}),this.o=t.condition||Bs,this.a=this.c=void 0,this.l=0,this.v=void 0!==t.duration?t.duration:400}function ag(t){var e,i,o,r;Zs(t)&&(i=(e=t.map).Ta(),t=new ng((t=t.pixel)[0]-i[0]/2,i[1]/2-t[1]),i=Math.atan2(t.y,t.x),t=Math.sqrt(t.x*t.x+t.y*t.y),o=e.aa(),e.render(),void 0!==this.c&&(r=i-this.c,Ls(e,o,o.Ha()-r)),this.c=i,void 0!==this.a&&(i=this.a*(o.$()/t),Rs(e,o,i)),void 0!==this.a&&(this.l=this.a/t),this.a=t)}function lg(t){if(!Zs(t))return!0;var e=(t=t.map).aa();oo(e,-1);var i=this.l-1,o=e.Ha(),o=e.constrainRotation(o,0);Ls(t,e,o,void 0,void 0);var o=e.$(),r=this.v,o=e.constrainResolution(o,0,i);return Rs(t,e,o,void 0,r),this.l=0,!1}function hg(t){return!(!Zs(t)||!this.o(t))&&(oo(t.map.aa(),1),!(this.a=this.c=void 0))}function pg(t,e){ct.call(this,t),this.feature=e}function cg(t){var e;Gs.call(this,{handleDownEvent:dg,handleEvent:ug,handleUpEvent:fg}),this.ia=null,this.T=!1,this.oc=t.source||null,this.Fb=t.features||null,this.pj=t.snapTolerance||12,this.Y=t.type,this.c=("Point"===(e=this.Y)||"MultiPoint"===e?r=_x:"LineString"===e||"MultiLineString"===e?r=vx:"Polygon"===e||"MultiPolygon"===e?r=bx:"Circle"===e&&(r=xx),r),this.jb=t.minPoints||(this.c===bx?3:2),this.xa=t.maxPoints||1/0;var i,o,r=t.geometryFunction;r=r||("Circle"===this.Y?function(t,e){e=e||new kf([NaN,NaN]);return e.Yf(t[0],Math.sqrt(oe(t[0],t[1]))),e}:((r=this.c)===_x?i=Fi:r===vx?i=Xc:r===bx&&(i=Yi),function(t,e){return e?e.ma(t):e=new i(t),e})),this.D=r,this.U=this.v=this.a=this.O=this.l=this.o=null,this.yj=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.qa=new Ha({source:new $h({useSpatialIndex:!1,wrapX:t.wrapX||!1}),style:t.style||(o=Va(),function(t){return o[t.W().V()]})}),this.Gb=t.geometryName,this.Ji=t.condition||Us,this.na=t.freehandCondition||Bs,St(this,Vt("active"),this.vi,!1,this)}function ug(t){var e=!this.T;return this.T&&t.type===U_?(_g(this,t),e=!1):t.type===B_?e=gg(this,t):t.type===N_&&(e=!1),Ws.call(this,t)&&e}function dg(t){return this.Ji(t)?(this.ia=t.pixel,!0):!(this.c!==vx&&this.c!==bx||!this.na(t))&&(this.ia=t.pixel,this.T=!0,this.o||mg(this,t),!0)}function fg(t){this.T=!1;var e=this.ia,i=t.pixel,o=e[0]-i[0],e=e[1]-i[1],i=!0;return o*o+e*e<=this.yj&&(gg(this,t),this.o?this.c===xx||yg(this,t)?this.qd():_g(this,t):(mg(this,t),this.c===_x&&this.qd()),i=!1),i}function gg(t,e){var i,o,r;return t.o?(o=e.coordinate,r=t.l.W(),t.c===_x?i=t.a:t.c===bx?(i=(i=t.a[0])[i.length-1],yg(t,e)&&(o=t.o.slice())):i=(i=t.a)[i.length-1],i[0]=o[0],i[1]=o[1],t.D(t.a,r),t.O&&t.O.W().ma(o),r instanceof Yi&&t.c!==bx?(t.v||(t.v=new Bl(new Xc(null))),r=r.Hg(0),(o=t.v.W()).ba(r.b,r.ja())):t.U&&(o=t.v.W()).ma(t.U),bg(t)):(o=e.coordinate.slice(),t.O?t.O.W().ma(o):(t.O=new Bl(new Fi(o)),bg(t))),!0}function yg(t,e){var i=!1;if(t.l){var o=!1,r=[t.o];if(t.c===vx?o=t.a.length>t.jb:t.c===bx&&(o=t.a[0].length>t.jb,r=[t.a[0][0],t.a[0][t.a[0].length-2]]),o)for(var o=e.map,n=0,s=r.length;n<s;n++){var a=r[n],l=o.Ra(a),i=(h=e.pixel)[0]-l[0],l=h[1]-l[1],h=t.T&&t.na(e)?1:t.pj;if(i=Math.sqrt(i*i+l*l)<=h){t.o=a;break}}}return i}function mg(t,e){e=e.coordinate;t.o=e,t.c===_x?t.a=e.slice():t.c===bx?(t.a=[[e.slice(),e.slice()]],t.U=t.a[0]):(t.a=[e.slice(),e.slice()],t.c===xx&&(t.U=t.a)),t.U&&(t.v=new Bl(new Xc(t.U))),e=t.D(t.a),t.l=new Bl,t.Gb&&t.l.Cc(t.Gb),t.l.Oa(e),bg(t),t.s(new pg("drawstart",t.l))}function _g(t,e){var i,o,r=e.coordinate,e=t.l.W();t.c===vx?(t.o=r.slice(),(o=t.a).push(r.slice()),i=o.length>t.xa,t.D(o,e)):t.c===bx&&((o=t.a[0]).push(r.slice()),(i=o.length>t.xa)&&(t.o=o[0]),t.D(t.a,e)),bg(t),i&&t.qd()}function vg(t){t.o=null;var e=t.l;return e&&(t.l=null,t.O=null,t.v=null,t.qa.ea().clear(!0)),e}function bg(t){var e=[];t.l&&e.push(t.l),t.v&&e.push(t.v),t.O&&e.push(t.O),(t=t.qa.ea()).clear(!0),t.Ic(e)}function xg(t,e,i){ct.call(this,t),this.features=e,this.mapBrowserPointerEvent=i}function wg(t){var e;Gs.call(this,{handleDownEvent:Tg,handleDragEvent:Ag,handleEvent:Ig,handleUpEvent:Cg}),this.xa=t.deleteCondition||Je(Us,Ns),this.na=this.c=null,this.ia=[0,0],this.D=this.T=!1,this.a=new Wh,this.O=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.o=this.qa=!1,this.l=null,this.U=new Ha({source:new $h({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style||(e=Va(),function(){return e.Point}),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.Y={Point:this.um,LineString:this.kh,LinearRing:this.kh,Polygon:this.vm,MultiPoint:this.sm,MultiLineString:this.rm,MultiPolygon:this.tm,GeometryCollection:this.qm},this.v=t.features,this.v.forEach(this.Ef,this),St(this.v,"add",this.om,!1,this),St(this.v,"remove",this.pm,!1,this)}function Mg(t,e){t.D||(t.D=!0,t.s(new xg("modifystart",t.v,e)))}function Pg(t,e){(function(t,e){var i=t.a,o=[];i.forEach(function(t){e===t.feature&&o.push(t)});for(var r=o.length-1;0<=r;--r)i.remove(o[r])})(t,e),t.c&&0===t.v.bc()&&(t.U.ea().Sc(t.c),t.c=null),Ct(e,"change",t.jh,!1,t)}function Eg(t,e){var i=t.c;i?i.W().ma(e):(i=new Bl(new Fi(e)),t.c=i,t.U.ea().Dd(i))}function Sg(t,e){return t.index-e.index}function Tg(t){if(Lg(this,t.pixel,t.map),this.l=[],this.D=!1,e=this.c){var e,i=[],o=_e([e=e.W().Z()]),r={};(o=Yh(this.a,o)).sort(Sg);for(var n=0,s=o.length;n<s;++n){var a=o[n],l=a.la,h=R(a.feature),p=a.depth;p&&(h+="-"+p.join("-")),r[h]||(r[h]=Array(2)),ee(l[0],e)&&!r[h][0]?(this.l.push([a,0]),r[h][0]=a):ee(l[1],e)&&!r[h][1]?("LineString"===a.geometry.V()||"MultiLineString"===a.geometry.V())&&r[h][0]&&0===r[h][0].index||(this.l.push([a,1]),r[h][1]=a):R(l)in this.na&&!r[h][0]&&!r[h][1]&&i.push([a,e])}for(i.length&&Mg(this,t),t=i.length-1;0<=t;--t)this.ml.apply(this,i[t])}return!!this.c}function Ag(t){this.T=!1,Mg(this,t),t=t.coordinate;for(var e=0,i=this.l.length;e<i;++e){for(var o=(l=this.l[e])[0],r=o.depth,n=o.geometry,s=n.Z(),a=o.la,l=l[1];t.length<n.sa();)t.push(0);switch(n.V()){case"Point":s=t,a[0]=a[1]=t;break;case"MultiPoint":s[o.index]=t,a[0]=a[1]=t;break;case"LineString":s[o.index+l]=t,a[l]=t;break;case"MultiLineString":case"Polygon":s[r[0]][o.index+l]=t,a[l]=t;break;case"MultiPolygon":s[r[1]][r[0]][o.index+l]=t,a[l]=t}o=n,this.o=!0,o.ma(s),this.o=!1}Eg(this,t)}function Cg(t){for(var e,i=this.l.length-1;0<=i;--i)e=this.l[i][0],Hh(this.a,_e(e.la),e);return this.D&&(this.s(new xg("modifyend",this.v,t)),this.D=!1),!1}function Ig(t){if(!(t instanceof Zn))return!0;if(t.map.aa().b.slice()[1]||t.type!=B_||this.C||(this.ia=t.pixel,Lg(this,t.pixel,t.map)),this.c&&this.xa(t))if(t.type==z_&&this.T)e=!0;else{this.c.W(),Mg(this,t);for(var e,i,o,r,n,s,a,l,h,p={},c=(e=this.l).length-1;0<=c;--c)if(o=(n=(l=(r=e[c])[0]).geometry).Z(),h=R(l.feature),l.depth&&(h+="-"+l.depth.join("-")),a=i=s=void 0,0===r[1]?s=(i=l).index:1==r[1]&&(s=(a=l).index+1),h in p||(p[h]=[a,i,s]),r=p[h],void 0!==a&&(r[0]=a),void 0!==i&&(r[1]=i),void 0!==r[0]&&void 0!==r[1]){switch(i=o,h=!1,a=s-1,n.V()){case"MultiLineString":o[l.depth[0]].splice(s,1),h=!0;break;case"LineString":o.splice(s,1),h=!0;break;case"MultiPolygon":i=i[l.depth[1]];case"Polygon":4<(i=i[l.depth[0]]).length&&(s==i.length-1&&(s=0),i.splice(s,1),h=!0,0===s&&(i.pop(),i.push(i[0]),a=i.length-1))}h&&(this.a.remove(r[0]),this.a.remove(r[1]),i=n,this.o=!0,i.ma(o),this.o=!1,o={depth:l.depth,feature:l.feature,geometry:l.geometry,index:a,la:[r[0].la[0],r[1].la[1]]},this.a.za(_e(o.la),o),Og(this,n,s,l.depth,-1),this.c&&(this.U.ea().Sc(this.c),this.c=null))}e=!0,this.s(new xg("modifyend",this.v,t)),this.D=!1}return t.type==z_&&(this.T=!1),Ws.call(this,t)&&!e}function Lg(t,e,i){var o=i.Ia(e),r=_e([r=i.Ia([e[0]-t.O,e[1]+t.O]),n=i.Ia([e[0]+t.O,e[1]-t.O])]);if(0<(r=Yh(t.a,r)).length){r.sort(function(t,e){return re(o,t.la)-re(o,e.la)});var n=r[0].la,s=Jt(o,n),a=i.Ra(s);if(Math.sqrt(oe(e,a))<=t.O){for(e=i.Ra(n[0]),i=i.Ra(n[1]),e=oe(a,e),i=oe(a,i),t.qa=Math.sqrt(Math.min(e,i))<=t.O,Eg(t,s=t.qa?i<e?n[1]:n[0]:s),(i={})[R(n)]=!0,e=1,a=r.length;e<a&&(s=r[e].la,ee(n[0],s[0])&&ee(n[1],s[1])||ee(n[0],s[1])&&ee(n[1],s[0]));++e)i[R(s)]=!0;return t.na=i,0}}t.c&&(t.U.ea().Sc(t.c),t.c=null)}function Og(t,e,i,o,r){Xh(t.a,e.J(),function(t){t.geometry===e&&(void 0===o||void 0===t.depth||F(t.depth,o))&&t.index>i&&(t.index+=r)})}function Rg(t,e,i,o){ct.call(this,t),this.selected=e,this.deselected=i,this.mapBrowserEvent=o}function Dg(t){Is.call(this,{handleEvent:kg});var e=t||{};this.C=e.condition||Ns,this.o=e.addCondition||Um,this.D=e.removeCondition||Um,this.O=e.toggleCondition||Bs,this.v=e.multi||!1,this.j=e.filter||Bm;var i,o,r=new Ha({source:new $h({useSpatialIndex:!1,features:e.features,wrapX:e.wrapX}),style:e.style||(D((i=Va()).Polygon,i.LineString),D(i.GeometryCollection,i.LineString),function(t){return i[t.W().V()]}),updateWhileAnimating:!0,updateWhileInteracting:!0});this.c=r,t=e.layers?c(e.layers)?function(t){return t===r||e.layers(t)}:(o=e.layers,function(t){return t===r||G(o,t)}):Bm,this.l=t,this.a={},St(t=this.c.ea().c,"add",this.wm,!1,this),St(t,"remove",this.zm,!1,this)}function kg(t){if(!this.C(t))return!0;var o=this.o(t),r=this.D(t),n=this.O(t),e=!o&&!r&&!n,i=t.map,s=this.c.ea().c,a=[],l=[],h=!1;if(e)i.rd(t.pixel,function(t,e){if(this.j(t,e)){l.push(t);t=R(t);return this.a[t]=e,!this.v}},this,this.l),0<l.length&&1==s.bc()&&s.item(0)==l[0]||(h=!0,0!==s.bc()&&(a=Array.prototype.concat(s.a),s.clear()),s.zf(l),0===l.length?et(this.a):0<a.length&&a.forEach(function(t){t=R(t),delete this.a[t]},this));else{for(i.rd(t.pixel,function(t,e){var i;e!==this.c?!o&&!n||!this.j(t,e)||G(s.a,t)||G(l,t)||(l.push(t),i=R(t),this.a[i]=e):(r||n)&&(a.push(t),i=R(t),delete this.a[i])},this,this.l),e=a.length-1;0<=e;--e)s.remove(a[e]);s.zf(l),(0<l.length||0<a.length)&&(h=!0)}return h&&this.s(new Rg("select",l,a,t)),Fs(t)}function zg(t){Gs.call(this,{handleEvent:Fg,handleDownEvent:Bm,handleUpEvent:Ng}),this.o=(t=t||{}).source||null,this.l=t.features||null,this.ia=[],this.D={},this.O={},this.T={},this.v={},this.U=null,this.c=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.qa=function(t,e){return re(this.U,t.la)-re(this.U,e.la)}.bind(this),this.a=new Wh,this.Y={Point:this.Fm,LineString:this.nh,LinearRing:this.nh,Polygon:this.Gm,MultiPoint:this.Dm,MultiLineString:this.Cm,MultiPolygon:this.Em,GeometryCollection:this.Bm}}function Fg(t){var e=t.pixel,i=t.coordinate,o=t.map,r=o.Ia([e[0]-this.c,e[1]+this.c]),n=o.Ia([e[0]+this.c,e[1]-this.c]),r=_e([r,n]),s=Yh(this.a,r),r=!1,a=null;return n=null,0<s.length&&(this.U=i,s.sort(this.qa),a=Jt(i,s=s[0].la),n=o.Ra(a),Math.sqrt(oe(e,n))<=this.c&&(r=!0,e=o.Ra(s[0]),i=o.Ra(s[1]),e=oe(n,e),i=oe(n,i),Math.sqrt(Math.min(e,i))<=this.c))&&(a=i<e?s[1]:s[0],n=o.Ra(a),n=[Math.round(n[0]),Math.round(n[1])]),o=a,r&&(t.coordinate=o.slice(0,2),t.pixel=n),Ws.call(this,t)}function Ng(){var t=J(this.v);return t.length&&(t.forEach(this.ui,this),this.v={}),!1}function Ug(t,e,i){ct.call(this,t),this.features=e,this.coordinate=i}function Bg(t){Gs.call(this,{handleDownEvent:jg,handleDragEvent:Gg,handleMoveEvent:Vg,handleUpEvent:Zg}),this.o=void 0,this.a=null,this.c=void 0!==t.features?t.features:null,this.l=null}function jg(t){return this.l=(e=this,i=t.pixel,o=t.map,r=null,i=o.rd(i,function(t){return t}),r=e.c&&G(e.c.a,i)?i:r),!(this.a||!this.l)&&(this.a=t.coordinate,Vg.call(this,t),this.s(new Ug("translatestart",this.c,t.coordinate)),!0);var e,i,o,r}function Zg(t){return!!this.a&&(this.a=null,Vg.call(this,t),this.s(new Ug("translateend",this.c,t.coordinate)),!0)}function Gg(t){var i,o,e;this.a&&(i=(t=t.coordinate)[0]-this.a[0],o=t[1]-this.a[1],this.c?this.c.forEach(function(t){var e=t.W();e.Qc(i,o),t.Oa(e)}):this.l&&((e=this.l.W()).Qc(i,o),this.l.Oa(e)),this.a=t,this.s(new Ug("translating",this.c,t)))}function Vg(t){var e,i=t.map.uc();(t=t.map.rd(t.pixel,function(t){return t}))?(e=!1,this.c&&G(this.c.a,t)&&(e=!0),this.o=i.style.cursor,i.style.cursor=this.a?"-webkit-grabbing":e?"-webkit-grab":"pointer",i.style.cursor=this.a?e?"grab":"pointer":"grabbing"):(i.style.cursor=void 0!==this.o?this.o:"",this.o=void 0)}function Wg(t){var e=rt(t=t||{});delete e.gradient,delete e.radius,delete e.blur,delete e.shadow,delete e.weight,Ha.call(this,e),this.g=null,this.Y=void 0!==t.shadow?t.shadow:250,this.T=void 0,this.U=null,St(this,Vt("gradient"),this.Jk,!1,this),this.fi(t.gradient||wx),this.ai(void 0!==t.blur?t.blur:15),this.qh(void 0!==t.radius?t.radius:8),St(this,[Vt("blur"),Vt("radius")],this.Sg,!1,this),this.Sg();var i=t.weight||"weight",o=u(i)?function(t){return t.get(i)}:i;this.c(function(t){var e=255*(t=void 0!==(t=o(t))?x(t,0,1):1)|0,i=this.U[e];return i||(i=[new ja({image:new us({opacity:t,src:this.T})})],this.U[e]=i),i}.bind(this)),this.set("renderOrder",null),St(this,"render",this.bl,!1,this)}function Hg(t,e,i,o,r,n,s,a,l,h){if(mr.call(this,r,0),this.D=void 0!==h&&h,this.C=s,this.i=null,this.g={},this.j=e,this.o=o,this.G=n||r,this.f=[],this.b=null,this.l=0,n=o.Ba(this.G),h=this.o.J(),r=this.j.J(),0===ze(n=h?Ze(n,h):n))this.state=4;else if((h=t.J())&&(r=r?Ze(r,h):h),o=o.$(this.G[0]),o=Al(t,i,Ue(n),o),!isFinite(o)||isNaN(o)||o<=0)this.state=4;else if(this.B=new Ll(t,i,n,r,o*(void 0!==l?l:.5)),0===this.B.c.length)this.state=4;else if(this.l=Ar(e,o),i=Ol(this.B),r&&(t.f?(i[1]=x(i[1],r[1],r[3]),i[3]=x(i[3],r[1],r[3])):i=Ze(i,r)),ze(i))if(mo(t=Er(e,i,this.l))*yo(t)<100){for(e=t.a;e<=t.c;e++)for(i=t.f;i<=t.b;i++)(l=a(this.l,e,i,s))&&this.f.push(l);0===this.f.length&&(this.state=4)}else this.state=3;else this.state=4}function qg(){var t;this&&this.$h&&((t=this.$h)&&"SCRIPT"==t.tagName&&Yg(t,!0,this.Fc))}function Yg(t,e,i){null!=i&&Xy.clearTimeout(i),t.onload=p,t.onerror=p,t.onreadystatechange=p,e&&window.setTimeout(function(){ko(t)},0)}function Xg(t,e){var i="Jsloader error (code #"+t+")";e&&(i+=": "+e),a.call(this,i),this.code=t}function Kg(t,e){this.f=new Ju(t),this.a=e||"callback",this.Fc=5e3}function $g(t,e,i,o){e=e||null;var r="_"+(Ex++).toString(36)+Jy().toString(36);Xy._callbacks_||(Xy._callbacks_={});var n,s,a,l,h,p,c,u,d,f,g,y,m,_,v,b=t.f.clone();if(e)for(var x in e)e.hasOwnProperty&&!e.hasOwnProperty(x)||(n=b,s=x,w(a=e[x])||(a=[String(a)]),pd(n.b,s,a));i&&(Xy._callbacks_[r]=(_=r,v=i,function(t){Jg(_,!0),v.apply(void 0,arguments)}),i=t.a,w(x="_callbacks_."+r)||(x=[String(x)]),pd(b.b,i,x)),c=b.toString(),u={timeout:t.Fc,Bj:!0},f=(d=u||{}).document||document,g=document.createElement("SCRIPT"),y=new Wf(qg,i={$h:g,Fc:void 0}),0<(u=(m=null)!=d.timeout?d.timeout:5e3)&&(m=window.setTimeout(function(){Yg(g,!0);var t=new Xg(Px,"Timeout reached for loading script "+c);qf(y),Hf(y,!1,t)},u),i.Fc=m),g.onload=g.onreadystatechange=function(){g.readyState&&"loaded"!=g.readyState&&"complete"!=g.readyState||(Yg(g,d.Bj||!1,m),y.cd(null))},g.onerror=function(){Yg(g,!0,m);var t=new Xg(Mx,"Error while loading script "+c);qf(y),Hf(y,!1,t)},nt(i=d.attributes||{},{type:"text/javascript",charset:"UTF-8",src:c}),Io(g,i),((f=(i=f).getElementsByTagName("HEAD"))&&0!=f.length?f[0]:i.documentElement).appendChild(g),Yf(t=y,null,(l=r,h=e,p=o,function(){Jg(l,!1),p&&p(h)}),void 0)}function Jg(t,e){Xy._callbacks_[t]&&(e?delete Xy._callbacks_[t]:Xy._callbacks_[t]=p)}function Qg(t){cp.call(this,{attributions:t.attributions,extent:t.extent,logo:t.logo,opaque:t.opaque,projection:t.projection,state:void 0!==t.state?t.state:void 0,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction||iy,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:Zf,this.j={},this.o={},this.na=t.reprojectionErrorThreshold,this.D=!1}function ty(t,e,i,o,r,n,s){return r=(i=zr(t,e=[e,i,o],n))?t.tileUrlFunction(i,r,n):void 0,(r=new t.tileClass(e,void 0!==r?0:4,void 0!==r?r:"",t.crossOrigin,t.tileLoadFunction)).key=s,St(r,"change",t.yh,!1,t),r}function ey(t,e,i,o,r,n){var s,a=null,l=t.Cb(e,i,o),h=t.rf();return dr(t.a,l)?(a=t.a.get(l)).key!=h&&((s=a).a&&a.a.key==h?(a=a.a,2==s.state&&(a.a=s)):(a=ty(t,e,i,o,r,n,h),2==s.state?a.a=s:s.a&&2==s.a.state&&(a.a=s.a,s.a=null)),a.a&&(a.a.a=null),t.a.replace(l,a)):(a=ty(t,e,i,o,r,n,h),t.a.set(l,a)),a}function iy(t,e){t.Ua().src=e}function oy(t){Qg.call(this,{crossOrigin:"anonymous",opaque:!0,projection:ai("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:void 0===t.wrapX||t.wrapX}),this.l=void 0!==t.culture?t.culture:"en-us",this.c=void 0!==t.maxZoom?t.maxZoom:-1,$g(new Kg(new Ju("https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+t.imagerySet),"jsonp"),{include:"ImageryProviders",uriScheme:"https",key:t.key},this.v.bind(this))}function ry(t){$h.call(this,{attributions:t.attributions,extent:t.extent,logo:t.logo,projection:t.projection,wrapX:t.wrapX}),this.D=void 0,this.ha=void 0!==t.distance?t.distance:20,this.C=[],this.v=t.source,this.v.H("change",ry.prototype.qa,this)}function ny(t){if(void 0!==t.D){t.C.length=0;for(var e=Te(),i=t.ha*t.D,o=t.v.Be(),r={},n=0,s=o.length;n<s;n++){var a=o[n];R(a).toString()in r||(Ce(a=a.W().Z(),e),be(e,i,e),a=(a=t.v.pf(e)).filter(function(t){return!((t=R(t).toString())in r)&&(r[t]=!0)}),t.C.push(function(t){for(var e=t.length,i=[0,0],o=0;o<e;o++){var r=t[o].W().Z();$t(i,r)}return e=1/e,i[0]*=e,i[1]*=e,(i=new Bl(new Fi(i))).set("features",t),i}(a)))}}}function sy(t){kl.call(this,{projection:t.projection,resolutions:t.resolutions}),this.ha=void 0!==t.crossOrigin?t.crossOrigin:null,this.o=void 0!==t.displayDpi?t.displayDpi:96,this.j=void 0!==t.params?t.params:{},this.Y=t.url,this.c=void 0!==t.imageLoadFunction?t.imageLoadFunction:Fl,this.ia=void 0===t.hidpi||t.hidpi,this.na=void 0!==t.metersPerUnit?t.metersPerUnit:1,this.v=void 0!==t.ratio?t.ratio:1,this.xa=void 0!==t.useOverlay&&t.useOverlay,this.g=null,this.T=0}function ay(t){var e=void 0!==t.attributions?t.attributions:null,i=t.imageExtent,o=void 0!==t.crossOrigin?t.crossOrigin:null,r=void 0!==t.imageLoadFunction?t.imageLoadFunction:Fl;kl.call(this,{attributions:e,logo:t.logo,projection:ai(t.projection)}),this.c=new jf(i,void 0,1,e,t.url,o,r),this.g=t.imageSize||null,St(this.c,"change",this.l,!1,this)}function ly(t){kl.call(this,{attributions:(t=t||{}).attributions,logo:t.logo,projection:t.projection,resolutions:t.resolutions}),this.na=void 0!==t.crossOrigin?t.crossOrigin:null,this.j=t.url,this.T=void 0!==t.imageLoadFunction?t.imageLoadFunction:Fl,this.g=t.params,this.v=!0,py(this),this.ia=t.serverType,this.xa=void 0===t.hidpi||t.hidpi,this.c=null,this.Y=[0,0],this.ha=0,this.o=void 0!==t.ratio?t.ratio:1.5}function hy(t,e,i,o,r,n){if(n[t.v?"CRS":"SRS"]=r.Ya,"STYLES"in t.g||(n.STYLES=new String("")),1!=o)switch(t.ia){case"geoserver":o=90*o+.5|0,n.FORMAT_OPTIONS="FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+";dpi:"+o:"dpi:"+o;break;case"mapserver":n.MAP_RESOLUTION=90*o;break;case"carmentaserver":case"qgis":n.DPI=90*o}return n.WIDTH=i[0],n.HEIGHT=i[1],i=r.c,e=t.v&&"ne"==i.substr(0,2)?[e[1],e[0],e[3],e[2]]:e,n.BBOX=e.join(","),hh(ph([t.j],n))}function py(t){t.v=0<=v(it(t.g,"VERSION","1.3.0"),"1.3")}function cy(t){var e=void 0!==t.projection?t.projection:"EPSG:3857",i=void 0!==t.tileGrid?t.tileGrid:Ir({extent:Or(e),maxZoom:t.maxZoom,tileSize:t.tileSize});Qg.call(this,{attributions:t.attributions,crossOrigin:t.crossOrigin,logo:t.logo,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX})}function uy(t){var e=void 0!==(t=t||{}).attributions?t.attributions:[Ax];cy.call(this,{attributions:e,crossOrigin:void 0!==t.crossOrigin?t.crossOrigin:"anonymous",opaque:!0,maxZoom:void 0!==t.maxZoom?t.maxZoom:19,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,url:void 0!==t.url?t.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",wrapX:t.wrapX})}function dy(t){var e=Lx[(t=t||{}).layer];this.c=t.layer,cy.call(this,{attributions:e.attributions,crossOrigin:"anonymous",logo:"https://developer.mapquest.com/content/osm/mq_logo.png",maxZoom:e.maxZoom,reprojectionErrorThreshold:t.reprojectionErrorThreshold,opaque:e.opaque,tileLoadFunction:t.tileLoadFunction,url:void 0!==t.url?t.url:"https://otile{1-4}-s.mqcdn.com/tiles/1.0.0/"+this.c+"/{z}/{x}/{y}.jpg"})}function fy(t){this.T=null,this.xa=void 0!==t.operationType?t.operationType:"pixel",this.jb=void 0!==t.threads?t.threads:1,this.c=function(t){for(var e=t.length,i=Array(e),o=0;o<e;++o){var r=o,n=t[o],s=null;n instanceof Rr?(n=new Oa({source:n}),s=new np(n)):n instanceof kl&&(n=new La({source:n}),s=new rp(n)),i[r]=s}return i}(t.sources);for(var e=0,i=this.c.length;e<i;++e)St(this.c[e],"change",this.u,!1,this);this.g=bn(),this.ia=new Ts(function(){return 1},this.u.bind(this));for(var i={},o=0,r=(e=this.c.map(function(t){return Hn(t.a)})).length;o<r;++o)i[R(e[o].layer)]=e[o];this.j=this.o=null,this.ha={animate:!1,attributions:{},coordinateToPixelMatrix:le(),extent:null,focus:null,index:0,layerStates:i,layerStatesArray:e,logos:{},pixelRatio:1,pixelToCoordinateMatrix:le(),postRenderFunctions:[],size:[0,0],skippedFeatureUids:{},tileQueue:this.ia,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{}},kl.call(this,{}),void 0!==t.operation&&this.v(t.operation,t.lib)}function gy(t,e,i){var o=t.o;return!o||t.f!==o.Po||i!==o.resolution||!Le(e,o.extent)}function yy(t,e,i){ct.call(this,t),this.extent=e.extent,this.resolution=e.viewState.resolution/e.pixelRatio,this.data=i}function my(t){var e=-1==(e=t.layer.indexOf("-"))?t.layer:t.layer.slice(0,e),i=kx[t.layer];cy.call(this,{attributions:Fx,crossOrigin:"anonymous",maxZoom:zx[e].maxZoom,opaque:i.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,url:void 0!==t.url?t.url:"https://stamen-tiles-{a-d}.a.ssl.fastly.net/"+t.layer+"/{z}/{x}/{y}."+i.qb})}function _y(t){var e=void 0!==(t=t||{}).params?t.params:{};Qg.call(this,{attributions:t.attributions,crossOrigin:t.crossOrigin,logo:t.logo,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX}),this.c=e,this.l=Te()}function vy(t,e,i){mr.call(this,t,2),this.g=e,this.b=i,this.f={}}function by(t){Rr.call(this,{opaque:!1,projection:t.projection,tileGrid:t.tileGrid,wrapX:void 0===t.wrapX||t.wrapX})}function xy(){}function wy(){this.a=new XDomainRequest,this.readyState=0,this.responseText=this.onreadystatechange=null,this.status=-1,this.statusText=this.responseXML=null,this.a.onload=f(this.Bk,this),this.a.onerror=f(this.Ng,this),this.a.onprogress=f(this.al,this),this.a.ontimeout=f(this.gl,this)}function My(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Py(t){var e;Qg.call(this,{attributions:t.attributions,crossOrigin:t.crossOrigin,projection:ai("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:void 0===t.wrapX||t.wrapX}),t.jsonp?$g(new Kg(t.url),void 0,this.l.bind(this),this.c.bind(this)):(St(e=new ch(new xy),"complete",function(){var t;vh(e)?(t=e.fa?Mv(e.fa.responseText):void 0,this.l(t)):this.c(),e.rc()},!1,this),uh(e,t.url))}function Ey(t){Rr.call(this,{projection:ai("EPSG:3857"),state:"loading"}),this.l=void 0===t.preemptive||t.preemptive,this.j=hp,this.c=void 0,$g(new Kg(t.url),void 0,this.fn.bind(this))}function Sy(t,e,i,o,r){mr.call(this,t,e),this.j=i,this.f=o,this.l=r,this.i=this.g=this.b=null}function Ty(t,e){if(!t.b||!t.g||!t.i)return null;var i=t.b[Math.floor((1-(e[1]-t.f[1])/(t.f[3]-t.f[1]))*t.b.length)];return u(i)?(93<=(i=i.charCodeAt(Math.floor((e[0]-t.f[0])/(t.f[2]-t.f[0])*i.length)))&&i--,35<=i&&i--,(i-=32)in t.g?t.i[t.g[i]]:null):null}function Ay(t){0==t.state&&(t.state=1,$g(new Kg(t.j),void 0,t.en.bind(t),t.dn.bind(t)))}function Cy(t){var e=void 0!==(t=t||{}).params?t.params:{};Qg.call(this,{attributions:t.attributions,crossOrigin:t.crossOrigin,logo:t.logo,opaque:!it(e,"TRANSPARENT",!0),projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX}),this.v=void 0!==t.gutter?t.gutter:0,this.c=e,this.ia="",Oy(this),this.l=!0,this.C=t.serverType,this.Y=void 0===t.hidpi||t.hidpi,this.T="",Ly(this),this.ha=Te(),Ry(this)}function Iy(t,e,i,o,r,n,s){var a=t.urls;if(a){if(s.WIDTH=i[0],s.HEIGHT=i[1],s[t.l?"CRS":"SRS"]=n.Ya,"STYLES"in t.c||(s.STYLES=new String("")),1!=r)switch(t.C){case"geoserver":i=90*r+.5|0,s.FORMAT_OPTIONS="FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+";dpi:"+i:"dpi:"+i;break;case"mapserver":s.MAP_RESOLUTION=90*r;break;case"carmentaserver":case"qgis":s.DPI=90*r}return n=n.c,t.l&&"ne"==n.substr(0,2)&&(t=o[0],o[0]=o[1],o[1]=t,t=o[2],o[2]=o[3],o[3]=t),s.BBOX=o.join(","),hh(ph([1==a.length?a[0]:a[Xt((e[1]<<e[0])+e[2],a.length)]],s))}}function Ly(t){var e=0,i=[];if(t.urls)for(var o=0,r=t.urls.length;o<r;++o)i[e++]=t.urls[o];t.T=i.join("#")}function Oy(t){var e,i=0,o=[];for(e in t.c)o[i++]=e+"-"+t.c[e];t.ia=o.join("/")}function Ry(t){t.l=0<=v(it(t.c,"VERSION","1.3.0"),"1.3")}function Dy(t){this.j=t.matrixIds,xr.call(this,{extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes})}function ky(t,e){var r=[],n=[],s=[],a=[],l=[],i=ai(t.SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")),h=i.$b(),p="ne"==i.c.substr(0,2);return t.TileMatrix.sort(function(t,e){return e.ScaleDenominator-t.ScaleDenominator}),t.TileMatrix.forEach(function(t){n.push(t.Identifier);var e=28e-5*t.ScaleDenominator/h,i=t.TileWidth,o=t.TileHeight;p?s.push([t.TopLeftCorner[1],t.TopLeftCorner[0]]):s.push(t.TopLeftCorner),r.push(e),a.push(i==o?i:[i,o]),l.push([t.MatrixWidth,-t.MatrixHeight])}),new Dy({extent:e,origins:s,resolutions:r,matrixIds:n,tileSizes:a,sizes:l})}function zy(t){this.ha=void 0!==t.version?t.version:"1.0.0",this.C=void 0!==t.format?t.format:"image/jpeg",this.c=void 0!==t.dimensions?t.dimensions:{},this.l="",Fy(this),this.T=t.layer,this.v=t.matrixSet,this.Y=t.style;var e=t.urls;void 0===e&&void 0!==t.url&&(e=pp(t.url));var o=this.ia=void 0!==t.requestEncoding?t.requestEncoding:"KVP",r=t.tileGrid,i={layer:this.T,style:this.Y,tilematrixset:this.v};"KVP"==o&&nt(i,{Service:"WMTS",Request:"GetTile",Version:this.ha,Format:this.C});var n=this.c,s=e&&0<e.length?lp(e.map(function(e){return e="KVP"==o?hh(ph([e],i)):e.replace(/\{(\w+?)\}/g,function(t,e){return e.toLowerCase()in i?i[e.toLowerCase()]:t}),function(t){if(t){var i={TileMatrix:r.j[t[0]],TileCol:t[1],TileRow:-t[2]-1};return nt(i,n),t=e,"KVP"==o?hh(ph([t],i)):t.replace(/\{(\w+?)\}/g,function(t,e){return i[e]})}}})):hp;Qg.call(this,{attributions:t.attributions,crossOrigin:t.crossOrigin,logo:t.logo,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:r,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:s,urls:e,wrapX:void 0!==t.wrapX&&t.wrapX})}function Fy(t){var e,i=0,o=[];for(e in t.c)o[i++]=e+"-"+t.c[e];t.l=o.join("/")}function Ny(t){var e=(s=(t=t||{}).size)[0],i=s[1],o=[],r=256;switch(void 0!==t.tierSizeCalculation?t.tierSizeCalculation:"default"){case"default":for(;r<e||r<i;)o.push([Math.ceil(e/r),Math.ceil(i/r)]),r+=r;break;case"truncated":for(;r<e||r<i;)o.push([Math.ceil(e/r),Math.ceil(i/r)]),e>>=1,i>>=1}o.push([1,1]),o.reverse();for(var r=[1],n=[0],i=1,e=o.length;i<e;i++)r.push(1<<i),n.push(o[i-1][0]*o[i-1][1]+n[i-1]);r.reverse();var s=new xr({extent:s=[0,-s[1],s[0],0],origin:Ge(s),resolutions:r}),a=t.url;Qg.call(this,{attributions:t.attributions,crossOrigin:t.crossOrigin,logo:t.logo,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:Uy,tileGrid:s,tileUrlFunction:function(t){if(t){var e=t[0],i=t[1];return t=-t[2]-1,a+"TileGroup"+((i+t*o[e][0]+n[e])/256|0)+"/"+e+"-"+i+"-"+t+".jpg"}}})}function Uy(t,e,i,o,r){Zf.call(this,t,e,i,o,r),this.g={}}function By(t,e,i,o,r,n){return!(i+t.a>t.b||o+t.a>t.b)&&(r=jy(t,!1,e,i,o,r))?(t=jy(t,!0,e,i,o,void 0!==n?n:jm),{offsetX:r.offsetX,offsetY:r.offsetY,image:r.image,Tg:t.image}):null}function jy(t,e,i,o,r,n){for(var s=e?t.i:t.g,a=0,l=s.length;a<l;++a){t:{var h,p=y=s[a],c=i,u=o,d=r,f=n,g=void 0,y=void 0,g=0;for(y=p.f.length;g<y;++g)if((h=p.f[g]).width>=u+p.a&&h.height>=d+p.a){y={offsetX:h.x+p.a,offsetY:h.y+p.a,image:p.b},p.c[c]=y,f.call(void 0,p.g,h.x+p.a,h.y+p.a),u+=(c=p).a,p=d+p.a,f=d=void 0,f=h.width-u>h.height-p?(d={x:h.x+u,y:h.y,width:h.width-u,height:h.height},{x:h.x,y:h.y+p,width:u,height:h.height-p}):(d={x:h.x+u,y:h.y,width:h.width-u,height:p},{x:h.x,y:h.y+p,width:h.width,height:h.height-p}),Gy(c,g,d,f);break t}y=null}if(y)return y;y||a!==l-1||(e?(y=Math.min(2*t.c,t.b),t.c=y):(y=Math.min(2*t.f,t.b),t.f=y),y=new Zy(y,t.a),s.push(y),++l)}}function Zy(t,e){this.a=e,this.f=[{x:0,y:0,width:t,height:t}],this.c={},this.b=document.createElement("CANVAS"),this.b.width=t,this.b.height=t,this.g=this.b.getContext("2d")}function Gy(t,e,i,o){e=[e,1],0<i.width&&0<i.height&&e.push(i),0<o.width&&0<o.height&&e.push(o),t.f.splice.apply(t.f,e)}function Vy(t){this.v=this.c=this.g=null,this.o=void 0!==t.fill?t.fill:null,this.wa=[0,0],this.a=t.points,this.b=void 0!==t.radius?t.radius:t.radius1,this.i=void 0!==t.radius2?t.radius2:this.b,this.l=void 0!==t.angle?t.angle:0,this.f=void 0!==t.stroke?t.stroke:null,this.pa=this.U=this.O=null;var e,i=t.atlasManager,o="",r="",n=0,s=null,a=0;this.f&&(e=Po(this.f.a),void 0===(a=this.f.f)&&(a=1),s=this.f.b,__||(s=null),void 0===(r=this.f.g)&&(r="round"),void 0===(o=this.f.c)&&(o="round"),void 0===(n=this.f.i)&&(n=10));var l,h=2*(this.b+a)+1,o={strokeStyle:e,Jd:a,size:h,lineCap:o,lineDash:s,lineJoin:r,miterLimit:n};void 0===i?(this.c=document.createElement("CANVAS"),this.c.height=h,this.c.width=h,i=h=this.c.width,l=this.c.getContext("2d"),this.Dh(o,l,0,0),this.o?this.v=this.c:((l=this.v=document.createElement("CANVAS")).height=o.size,l.width=o.size,l=l.getContext("2d"),this.Ch(o,l,0,0))):(h=Math.round(h),(r=!this.o)&&(l=this.Ch.bind(this,o)),n=this.f?Ua(this.f):"-",s=this.o?Da(this.o):"-",this.g&&n==this.g[1]&&s==this.g[2]&&this.b==this.g[3]&&this.i==this.g[4]&&this.l==this.g[5]&&this.a==this.g[6]||(this.g=["r"+n+s+(void 0!==this.b?this.b.toString():"-")+(void 0!==this.i?this.i.toString():"-")+(void 0!==this.l?this.l.toString():"-")+(void 0!==this.a?this.a.toString():"-"),n,s,this.b,this.i,this.l,this.a]),l=By(i,this.g[0],h,h,this.Dh.bind(this,o),l),this.c=l.image,this.wa=[l.offsetX,l.offsetY],i=l.image.width,this.v=r?l.Tg:this.c),this.O=[h/2,h/2],this.U=[h,h],this.pa=[i,i],cs.call(this,{opacity:1,rotateWithView:!1,rotation:void 0!==t.rotation?t.rotation:0,scale:1,snapToPixel:void 0===t.snapToPixel||t.snapToPixel})}var Wy,Hy,qy={},Yy=Yy||{},Xy=this,Ky="closure_uid_"+(1e9*Math.random()>>>0),$y=0,Jy=Date.now||function(){return+new Date};i(a,Error),a.prototype.name="CustomError";var Qy,tm,em=String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},im=/&/g,om=/</g,rm=/>/g,nm=/"/g,sm=/'/g,am=/\x00/g,lm=/[\x00&<>"']/,hm=String.prototype.repeat?function(t,e){return t.repeat(e)}:function(t,e){return Array(e+1).join(t)},pm="cosh"in Math?Math.cosh:function(t){return((t=Math.exp(t))+1/t)/2},cm=Array.prototype;t:{var um=Xy.navigator;if(um){um=um.userAgent;if(um){tm=um;break t}}tm=""}var dm="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),fm=Y("Opera")||Y("OPR"),gm=Y("Trident")||Y("MSIE"),ym=Y("Edge"),mm=Y("Gecko")&&!(-1!=tm.toLowerCase().indexOf("webkit")&&!Y("Edge"))&&!(Y("Trident")||Y("MSIE"))&&!Y("Edge"),_m=-1!=tm.toLowerCase().indexOf("webkit")&&!Y("Edge"),vm=Y("Macintosh"),bm=Y("Windows"),xm=Y("Linux")||Y("CrOS"),wm=function(){if(fm&&Xy.opera){var e,i=Xy.opera.version;try{e=i()}catch(t){e=i}return e}return e="",t=tm,(i=mm?/rv\:([^\);]+)(\)|;)/.exec(t):ym?/Edge\/([\d\.]+)/.exec(t):gm?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t):_m?/WebKit\/(\S+)/.exec(t):void 0)&&(e=i?i[1]:""),gm&&(i=st())>parseFloat(e)?String(i):e;var t}(),Mm={},Pm=Xy.document,Em=Pm&&gm?st()||("CSS1Compat"==Pm.compatMode?parseInt(wm,10):5):void 0,Sm=!gm||9<=Em,Tm=!gm||9<=Em,Am=gm&&!at("9");_m&&at("528"),mm&&at("1.9b")||gm&&at("8")||fm&&at("9.5")||_m&&at("528"),mm&&!at("8")||gm&&at("9");var Cm=0,Im={};lt.prototype.pa=!1,lt.prototype.rc=function(){var t;this.pa||(this.pa=!0,this.X(),0==Cm)||(t=R(this),delete Im[t])},lt.prototype.X=function(){if(this.wa)for(;this.wa.length;)this.wa.shift()()},ct.prototype.b=function(){this.j=!0},ct.prototype.preventDefault=function(){this.Zh=!1},ft[" "]=p,i(gt,ct);var Lm=[1,4,2];gt.prototype.b=function(){gt.da.b.call(this),this.a.stopPropagation?this.a.stopPropagation():this.a.cancelBubble=!0},gt.prototype.preventDefault=function(){gt.da.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Am)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Om="closure_listenable_"+(1e6*Math.random()|0),Rm=0;bt.prototype.remove=function(t,e,i,o){if(!((t=t.toString())in this.a))return!1;var r=this.a[t];return-1<(e=Et(r,e,i,o))&&(vt(r[e]),cm.splice.call(r,e,1),0==r.length&&(delete this.a[t],this.f--),!0)};var Dm="closure_lm_"+(1e6*Math.random()|0),km={},zm="__closure_events_fn_"+(1e9*Math.random()>>>0);i(Ft,lt),Ft.prototype[Om]=!0,(Fm=Ft.prototype).addEventListener=function(t,e,i,o){St(this,t,e,i,o)},Fm.removeEventListener=function(t,e,i,o){Ct(this,t,e,i,o)},Fm.s=function(t){var e;if(i=this.ib)for(e=[];i;i=i.ib)e.push(i);var i=this.Pd,o=t.type||t;u(t)?t=new ct(t,i):t instanceof ct?t.target=t.target||i:(n=t,nt(t=new ct(o,i),n));var r,n=!0;if(e)for(var s=e.length-1;!t.j&&0<=s;s--)n=Nt(r=t.g=e[s],o,!0,t)&&n;if(t.j||(n=Nt(r=t.g=i,o,!0,t)&&n,t.j||(n=Nt(r,o,!1,t)&&n)),e)for(s=0;!t.j&&s<e.length;s++)n=Nt(r=t.g=e[s],o,!1,t)&&n;return n},Fm.X=function(){if(Ft.da.X.call(this),this.Ab){var t,e=this.Ab;for(t in e.a){for(var i=e.a[t],o=0;o<i.length;o++)vt(i[o]);delete e.a[t],e.f--}}this.ib=null},Fm.Sa=function(t,e,i,o){return xt(this.Ab,String(t),e,!1,i,o)},Fm.$f=function(t,e,i,o){return this.Ab.remove(String(t),e,i,o)},i(Bt,Ft),(Fm=Bt.prototype).u=function(){++this.f,this.s("change")},Fm.L=function(){return this.f},Fm.H=function(t,e,i){return St(this,t,e,!1,i)},Fm.M=function(t,e,i){return At(this,t,e,!1,i)},Fm.K=function(t,e,i){Ct(this,t,e,!1,i)},Fm.N=jt,i(Zt,ct),i(Gt,Bt);var Fm,Nm={};if((Fm=Gt.prototype).get=function(t){var e;return e=this.G.hasOwnProperty(t)?this.G[t]:e},Fm.P=function(){return Object.keys(this.G)},Fm.R=function(){var t,e={};for(t in this.G)e[t]=this.G[t];return e},Fm.set=function(t,e,i){i?this.G[t]=e:(i=this.G[t])!==(this.G[t]=e)&&Wt(this,t,i)},Fm.I=function(t,e){for(var i in t)this.set(i,t[i],e)},Fm.S=function(t,e){var i;t in this.G&&(i=this.G[t],delete this.G[t],e||Wt(this,t,i))},se.prototype.a=4,se.prototype.set=function(t,e){e=e||0;for(var i=0;i<t.length&&e+i<this.length;i++)this[e+i]=t[i]},se.prototype.toString=Array.prototype.join,"undefined"==typeof Float32Array&&(se.BYTES_PER_ELEMENT=4,se.prototype.BYTES_PER_ELEMENT=se.prototype.a,t("Float32Array",se,void 0)),ae.prototype.a=8,ae.prototype.set=function(t,e){e=e||0;for(var i=0;i<t.length&&e+i<this.length;i++)this[e+i]=t[i]},ae.prototype.toString=Array.prototype.join,"undefined"==typeof Float64Array){try{ae.BYTES_PER_ELEMENT=8}catch(t){}ae.prototype.BYTES_PER_ELEMENT=ae.prototype.a,t("Float64Array",ae,void 0)}new Float64Array(3),new Float64Array(3),new Float64Array(4),new Float64Array(4),new Float64Array(4),new Float64Array(16);var Um=Ke(!1),Bm=Ke(!0),jm=Ke(null);Qe.prototype.f=function(t){for(var e=0,i=t.length,o=t[i-1][0],r=t[i-1][1],n=0;n<i;n++)var s=t[n][0],a=t[n][1],e=e+E(s-o)*(2+Math.sin(E(r))+Math.sin(E(a))),o=s,r=a;return e*this.radius*this.radius/2},Qe.prototype.a=function(t,e){var i=E(t[1]),o=E(e[1]),r=(o-i)/2,t=E(e[0]-t[0])/2,i=Math.sin(r)*Math.sin(r)+Math.sin(t)*Math.sin(t)*Math.cos(i)*Math.cos(o);return 2*this.radius*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))},Qe.prototype.offset=function(t,e,i){var o=E(t[1]);e/=this.radius;var r=Math.asin(Math.sin(o)*Math.cos(e)+Math.cos(o)*Math.sin(e)*Math.cos(i));return[180*(E(t[0])+Math.atan2(Math.sin(i)*Math.sin(e)*Math.cos(o),Math.cos(e)-Math.sin(o)*Math.sin(r)))/Math.PI,180*r/Math.PI]};var Zm=new Qe(6370997),Gm={};Gm.degrees=2*Math.PI*Zm.radius/360,Gm.ft=.3048,Gm.m=1,Gm["us-ft"]=1200/3937,(Fm=ti.prototype).Pj=function(){return this.Ya},Fm.J=function(){return this.g},Fm.Im=function(){return this.a},Fm.$b=function(){return this.o||Gm[this.a]},Fm.zk=function(){return this.i},Fm.ol=function(){return this.b},Fm.Vo=function(t){this.b=t,this.f=!(!t||!this.g)},Fm.Jm=function(t){this.g=t,this.f=!(!this.b||!t)},Fm.cp=function(t){this.i=t},Fm.Uo=function(t){this.l=t},Fm.nk=function(t,e){if("degrees"==this.a)return t;var i=pi(this,ai("EPSG:4326")),t=i(t=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2],t,2),t=((i=Zm.a(t.slice(0,2),t.slice(2,4)))+(t=Zm.a(t.slice(4,6),t.slice(6,8))))/2;return void 0!==(i=this.$b())&&(t/=i),t},Fm.getPointResolution=function(t,e){return this.l(t,e)};var Vm={},Wm={},Hm=null;i(gi,Gt),(Fm=gi.prototype).sb=function(t,e){e=e||[NaN,NaN];return this.pb(t[0],t[1],e,1/0),e},Fm.sg=function(t){return this.yc(t[0],t[1])},Fm.yc=Um,Fm.J=function(t){this.v!=this.f&&(this.B=this.Xd(this.B),this.v=this.f);var e=this.B;return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):t=e,t},Fm.zb=function(t){return this.vd(t*t)},Fm.nb=function(t,e){return this.qc(hi(t,e)),this},i(mi,gi),(Fm=mi.prototype).yc=Um,Fm.Xd=function(t){return Ie(this.A,0,this.A.length,this.a,t)},Fm.Lb=function(){return this.A.slice(0,this.a)},Fm.ja=function(){return this.A},Fm.Mb=function(){return this.A.slice(this.A.length-this.a)},Fm.Nb=function(){return this.b},Fm.vd=function(t){if(this.o!=this.f&&(et(this.i),this.j=0,this.o=this.f),t<0||0!==this.j&&t<=this.j)return this;var e=t.toString();if(this.i.hasOwnProperty(e))return this.i[e];var i=this.Nc(t);return i.ja().length<this.A.length?this.i[e]=i:(this.j=t,this)},Fm.Nc=function(){return this},Fm.sa=function(){return this.a},Fm.qc=function(t){this.A&&(t(this.A,this.A,this.a),this.u())},Fm.Qc=function(t,e){var i=this.ja();if(i){for(var o,r=i.length,n=this.sa(),s=i||[],a=0,l=0;l<r;l+=n)for(s[a++]=i[l]+t,s[a++]=i[l+1]+e,o=l+2;o<l+n;++o)s[a++]=i[o];i&&s.length!=a&&(s.length=a),this.u()}},i(ki,mi),(Fm=ki.prototype).clone=function(){var t=new ki(null);return zi(t,this.b,this.A.slice()),t},Fm.pb=function(t,e,i,o){return o<we(this.J(),t,e)?o:(this.g!=this.f&&(this.l=Math.sqrt(Pi(this.A,0,this.A.length,this.a,0)),this.g=this.f),Si(this.A,0,this.A.length,this.a,this.l,!0,t,e,i,o))},Fm.jm=function(){return xi(this.A,0,this.A.length,this.a)},Fm.Z=function(){return Li(this.A,0,this.A.length,this.a)},Fm.Nc=function(t){var e=[];return e.length=Ri(this.A,0,this.A.length,this.a,t,e,0),zi(t=new ki(null),"XY",e),t},Fm.V=function(){return"LinearRing"},Fm.ma=function(t,e){t?(bi(this,e,t,1),this.A||(this.A=[]),this.A.length=Ci(this.A,0,t,this.a),this.u()):zi(this,"XY",null)},i(Fi,mi),(Fm=Fi.prototype).clone=function(){var t=new Fi(null);return t.ba(this.b,this.A.slice()),t},Fm.pb=function(t,e,i,o){var r=this.A;if((t=P(t,e,r[0],r[1]))<o){for(o=this.a,e=0;e<o;++e)i[e]=r[e];return i.length=o,t}return o},Fm.Z=function(){return this.A?this.A.slice():[]},Fm.Xd=function(t){return Ce(this.A,t)},Fm.V=function(){return"Point"},Fm.Fa=function(t){return Ee(t,this.A[0],this.A[1])},Fm.ma=function(t,e){t?(bi(this,e,t,0),this.A||(this.A=[]),this.A.length=Ai(this.A,t),this.u()):this.ba("XY",null)},Fm.ba=function(t,e){vi(this,t,e),this.u()},i(Yi,mi),(Fm=Yi.prototype).uj=function(t){this.A?D(this.A,t.ja()):this.A=t.ja().slice(),this.g.push(this.A.length),this.u()},Fm.clone=function(){var t=new Yi(null);return t.ba(this.b,this.A.slice(),this.g.slice()),t},Fm.pb=function(t,e,i,o){return o<we(this.J(),t,e)?o:(this.O!=this.f&&(this.U=Math.sqrt(Ei(this.A,0,this.g,this.a,0)),this.O=this.f),Ti(this.A,0,this.g,this.a,this.U,!0,t,e,i,o))},Fm.yc=function(t,e){return Ui(this.Rb(),0,this.g,this.a,t,e)},Fm.mm=function(){return wi(this.Rb(),0,this.g,this.a)},Fm.Z=function(t){var e;return void 0!==t?Hi(e=this.Rb().slice(),0,this.g,this.a,t):e=this.A,Oi(e,0,this.g,this.a)},Fm.Bb=function(){return this.g},Fm.Yj=function(){return new Fi(Xi(this))},Fm.ck=function(){return this.g.length},Fm.Hg=function(t){if(t<0||this.g.length<=t)return null;var e=new ki(null);return zi(e,this.b,this.A.slice(0===t?0:this.g[t-1],this.g[t])),e},Fm.de=function(){for(var t=this.b,e=this.A,i=this.g,o=[],r=0,n=0,s=i.length;n<s;++n){var a=i[n],l=new ki(null);zi(l,t,e.slice(r,a)),o.push(l),r=a}return o},Fm.Rb=function(){var t;return this.T!=this.f&&(Wi(t=this.A,this.g,this.a)?this.l=t:(this.l=t.slice(),this.l.length=Hi(this.l,0,this.g,this.a)),this.T=this.f),this.l},Fm.Nc=function(t){var e=[],i=[];return e.length=Di(this.A,0,this.g,this.a,Math.sqrt(t),e,0,i),(t=new Yi(null)).ba("XY",e,i),t},Fm.V=function(){return"Polygon"},Fm.Fa=function(t){return Gi(this.Rb(),0,this.g,this.a,t)},Fm.ma=function(t,e){t?(bi(this,e,t,2),this.A||(this.A=[]),t=Ii(this.A,0,t,this.a,this.g),this.A.length=0===t.length?0:t[t.length-1],this.u()):this.ba("XY",null,this.g)},Fm.ba=function(t,e,i){vi(this,t,e),this.g=i,this.u()},i(to,Gt),(Fm=to.prototype).Yd=function(t){return this.i.center(t)},Fm.constrainResolution=function(t,e,i){return this.i.resolution(t,e||0,i||0)},Fm.constrainRotation=function(t,e){return this.i.rotation(t,e||0)},Fm.Va=function(){return this.get("center")},Fm.bd=function(t){return Be(this.Va(),this.$(),this.Ha(),t)},Fm.Ul=function(){return this.g},Fm.$=function(){return this.get("resolution")},Fm.Ha=function(){return this.get("rotation")},Fm.Ak=function(){var t,e=this.$();if(void 0!==e){var i,o=0;do{if((i=this.constrainResolution(this.a,o))==e){t=o;break}}while(++o,i>this.j)}return void 0!==t?this.c+t:t},Fm.mf=function(t,e,i){t instanceof mi||(t=$i(t)),i=void 0!==(l=i||{}).padding?l.padding:[0,0,0,0];var o=void 0===l.constrainResolution||l.constrainResolution,r=void 0!==l.nearest&&l.nearest,n=void 0!==l.minResolution?l.minResolution:void 0!==l.maxZoom?this.constrainResolution(this.a,l.maxZoom-this.c,0):0,s=t.ja(),a=this.Ha(),l=Math.cos(-a),a=Math.sin(-a),h=1/0,p=1/0,c=-1/0,u=-1/0;t=t.sa();for(var d=0,f=s.length;d<f;d+=t)var g=s[d]*l-s[d+1]*a,y=s[d]*a+s[d+1]*l,h=Math.min(h,g),p=Math.min(p,y),c=Math.max(c,g),u=Math.max(u,y);s=[h,p,c,u],e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]],e=Math.max(We(s)/e[0],je(s)/e[1]),e=isNaN(e)?n:Math.max(e,n),o&&(n=this.constrainResolution(e,0,0),e=n=!r&&n<e?this.constrainResolution(n,-1,0):n),this.Vb(e),r=(h+c)/2+(i[1]-i[3])/2*e,i=(p+u)/2+(i[0]-i[2])/2*e,this.mb([r*l-i*(a=-a),i*l+r*a])},Fm.Aj=function(t,e,i){var o=this.Ha(),r=Math.cos(-o),o=Math.sin(-o),n=t[0]*r-t[1]*o;t=t[1]*r+t[0]*o;var s=this.$(),n=n+(e[0]/2-i[0])*s;t+=(i[1]-e[1]/2)*s,this.mb([n*r-t*(o=-o),t*r+n*o])},Fm.rotate=function(t,e){var i,o;void 0!==e&&(void 0!==(o=this.Va())&&(ie(i=[o[0]-e[0],o[1]-e[1]],t-this.Ha()),$t(i,e)),this.mb(i)),this.we(t)},Fm.mb=function(t){this.set("center",t)},Fm.Vb=function(t){this.set("resolution",t)},Fm.we=function(t){this.set("rotation",t)},Fm.ep=function(t){t=this.constrainResolution(this.a,t-this.c,0),this.Vb(t)},fo.prototype.contains=function(t){return go(this,t[1],t[2])},vo.prototype.b=function(){return this.f},i(bo,ct),i(xo,Gt),(Fm=xo.prototype).clear=function(){for(;0<this.bc();)this.pop()},Fm.zf=function(t){for(var e=0,i=t.length;e<i;++e)this.push(t[e]);return this},Fm.forEach=function(t,e){this.a.forEach(t,e)},Fm.El=function(){return this.a},Fm.item=function(t){return this.a[t]},Fm.bc=function(){return this.get("length")},Fm.ne=function(t,e){(function(t,e,i,o){cm.splice.apply(t,k(arguments,1))})(this.a,t,0,e),wo(this),this.s(new bo("add",e,this))},Fm.pop=function(){return this.Wf(this.bc()-1)},Fm.push=function(t){var e=this.a.length;return this.ne(e,t),e},Fm.remove=function(t){for(var e=this.a,i=0,o=e.length;i<o;++i)if(e[i]===t)return this.Wf(i)},Fm.Wf=function(t){var e=this.a[t];return cm.splice.call(this.a,t,1),wo(this),this.s(new bo("remove",e,this)),e},Fm.Ro=function(t,e){var i=this.bc();if(t<i)i=this.a[t],this.a[t]=e,this.s(new bo("remove",i,this)),this.s(new bo("add",e,this));else{for(;i<t;++i)this.ne(i,void 0);this.ne(t,e)}};var qm,Ym,Xm=/^#(?:[0-9a-f]{3}){1,2}$/i,Km=/^(?:rgb)?\((0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2})\)$/i,$m=/^(?:rgba)?\((0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2}),\s?(0|[1-9]\d{0,2}),\s?(0|1|0\.\d{0,10})\)$/i,Jm=(qm={},Ym=0,function(t){if(qm.hasOwnProperty(t))r=qm[t];else{if(1024<=Ym)for(var e in r=0,qm)0==(3&r++)&&(delete qm[e],--Ym);var i,o,r=Xm.exec(t)?(o=3==t.length-1?1:2,r=parseInt(t.substr(1+0*o,o),16),e=parseInt(t.substr(+o+1,o),16),i=parseInt(t.substr(1+2*o,o),16),1==o&&(r=(r<<4)+r,e=(e<<4)+e,i=(i<<4)+i),[r,e,i,1]):(o=$m.exec(t))?Eo(r=[r=Number(o[1]),e=Number(o[2]),i=Number(o[3]),o=Number(o[4])],r):(o=Km.exec(t))?Eo(r=[r=Number(o[1]),e=Number(o[2]),i=Number(o[3]),1],r):void 0;qm[t]=r,++Ym}return r}),Qm=!gm||9<=Em;!mm&&!gm||gm&&9<=Em||mm&&at("1.9.1"),gm&&at("9"),(Fm=So.prototype).clone=function(){return new So(this.x,this.y)},Fm.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},Fm.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},Fm.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},Fm.scale=function(t,e){e=y(e)?e:t;return this.x*=t,this.y*=e,this},(Fm=To.prototype).clone=function(){return new To(this.width,this.height)},Fm.xj=function(){return this.width*this.height},Fm.Na=function(){return!this.xj()},Fm.ceil=function(){return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},Fm.floor=function(){return this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},Fm.round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},Fm.scale=function(t,e){e=y(e)?e:t;return this.width*=t,this.height*=e,this};var t_={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};Bo.prototype.I=Io,Bo.prototype.appendChild=function(t,e){t.appendChild(e)},Bo.prototype.contains=No,(Fm=Yo.prototype).clone=function(){return new Yo(this.top,this.right,this.bottom,this.left)},Fm.contains=function(t){return!(!this||!t)&&(t instanceof Yo?t.left>=this.left&&t.right<=this.right&&t.top>=this.top&&t.bottom<=this.bottom:t.x>=this.left&&t.x<=this.right&&t.y>=this.top&&t.y<=this.bottom)},Fm.ceil=function(){return this.top=Math.ceil(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this.left=Math.ceil(this.left),this},Fm.floor=function(){return this.top=Math.floor(this.top),this.right=Math.floor(this.right),this.bottom=Math.floor(this.bottom),this.left=Math.floor(this.left),this},Fm.round=function(){return this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this.left=Math.round(this.left),this},Fm.scale=function(t,e){e=y(e)?e:t;return this.left*=t,this.right*=t,this.top*=e,this.bottom*=e,this},(Fm=Xo.prototype).clone=function(){return new Xo(this.left,this.top,this.width,this.height)},Fm.contains=function(t){return t instanceof Xo?this.left<=t.left&&this.left+this.width>=t.left+t.width&&this.top<=t.top&&this.top+this.height>=t.top+t.height:t.x>=this.left&&t.x<=this.left+this.width&&t.y>=this.top&&t.y<=this.top+this.height},Fm.distance=function(t){var e=t.x<this.left?this.left-t.x:Math.max(t.x-(this.left+this.width),0);return t=t.y<this.top?this.top-t.y:Math.max(t.y-(this.top+this.height),0),Math.sqrt(e*e+t*t)},Fm.ceil=function(){return this.left=Math.ceil(this.left),this.top=Math.ceil(this.top),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},Fm.floor=function(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},Fm.round=function(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.width=Math.round(this.width),this.height=Math.round(this.height),this},Fm.scale=function(t,e){e=y(e)?e:t;return this.left*=t,this.width*=t,this.top*=e,this.height*=e,this};var e_={thin:2,medium:4,thick:6};i(pr,ct),i(cr,Gt),cr.prototype.X=function(){ko(this.element),cr.da.X.call(this)},cr.prototype.g=function(){return this.a},cr.prototype.setMap=function(t){this.a&&ko(this.element),0<this.o.length&&(this.o.forEach(It),this.o.length=0),(this.a=t)&&((this.U||t.j).appendChild(this.element),this.render!==s&&this.o.push(St(t,"postrender",this.render,!1,this)),t.render())},cr.prototype.c=function(t){this.U=Co(t)},(Fm=ur.prototype).clear=function(){this.b=0,this.c={},this.f=this.a=null},Fm.forEach=function(t,e){for(var i=this.a;i;)t.call(e,i.nc,i.qe,this),i=i.ub},Fm.get=function(t){return(t=this.c[t])===this.f||(t===this.a?(this.a=this.a.ub,this.a.ic=null):(t.ub.ic=t.ic,t.ic.ub=t.ub),t.ub=null,t.ic=this.f,this.f=this.f.ub=t),t.nc},Fm.sc=function(){return this.b},Fm.P=function(){for(var t=Array(this.b),e=0,i=this.f;i;i=i.ic)t[e++]=i.qe;return t},Fm.wc=function(){for(var t=Array(this.b),e=0,i=this.f;i;i=i.ic)t[e++]=i.nc;return t},Fm.pop=function(){var t=this.a;return delete this.c[t.qe],t.ub&&(t.ub.ic=null),this.a=t.ub,this.a||(this.f=null),--this.b,t.nc},Fm.replace=function(t,e){this.get(t),this.c[t].nc=e},Fm.set=function(t,e){e={qe:t,ub:null,ic:this.f,nc:e};this.f?this.f.ub=e:this.a=e,this.f=e,this.c[t]=e,++this.b},i(fr,ur),i(mr,Ft),mr.prototype.bb=function(){return R(this).toString()},mr.prototype.c=function(){return this.ga},i(vr,Gt),(Fm=vr.prototype).Ae=s,Fm.ta=function(){return this.i},Fm.ra=function(){return this.U},Fm.ua=function(){return this.b},Fm.va=function(){return this.B},Fm.oa=function(t){this.i=t,this.u()};var i_=[0,0,0];(Fm=xr.prototype).J=function(){return this.G},Fm.Ig=function(){return this.maxZoom},Fm.Jg=function(){return this.minZoom},Fm.Ea=function(t){return this.b||this.g[t]},Fm.$=function(t){return this.a[t]},Fm.Fh=function(){return this.a},Fm.Ba=function(t,e){var i=this.Ea(t[0]),o=this.$(t[0]),r=Yt(this.Ma(t[0]),this.c),n=i[0]+t[1]*r[0]*o;return Ae(n,i=i[1]+t[2]*r[1]*o,n+r[0]*o,i+r[1]*o,e)},Fm.he=function(t,e,i){return Tr(this,t[0],t[1],e,!1,i)},Fm.ie=function(t,e,i){return e=this.$(e),Tr(this,t[0],t[1],e,!1,i)},Fm.Ma=function(t){return this.l||this.i[t]},i(Rr,vr),(Fm=Rr.prototype).wh=function(){return gr(this.a)},Fm.xh=function(t,e){t=this.wd(t);t&&yr(t,e)},Fm.ce=function(){return 0},Fm.rf=function(){return""},Fm.Cb=function(t,e,i){return t+"/"+e+"/"+i},Fm.tf=function(){return this.qa},Fm.Ja=function(){return this.tileGrid},Fm.kb=function(t){return this.tileGrid||Cr(t)},Fm.wd=function(t){var e=this.b;return e&&!li(e,t)?null:this.a},Fm.vc=function(){return this.xa},Fm.bg=s,i(Fr,ct),i(Nr,cr),(Fm=Nr.prototype).Xl=function(t){t.preventDefault(),Br(this)},Fm.Wl=function(){return this.j},Fm.Zl=function(t){this.j!==t&&(this.j=t,qo(this.element,"ol-uncollapsible"),!t&&this.b&&Br(this))},Fm.Yl=function(t){this.j&&this.b!==t&&Br(this)},Fm.Vl=function(){return this.b},i(jr,cr),jr.prototype.v=function(t){var e,i;t.preventDefault(),void 0!==this.j?this.j():!(e=(t=this.a).aa())||void 0!==(i=e.Ha())&&(0<this.l&&((i%=2*Math.PI)<-Math.PI&&(i+=2*Math.PI),i>Math.PI&&(i-=2*Math.PI),t.Pa(po({rotation:i,duration:this.l,easing:no}))),e.we(0))},i(Gr,cr),Gr.prototype.i=function(t,e){e.preventDefault();var i=this.a,o=i.aa();!o||(e=o.$())&&(0<this.b&&i.Pa(co({resolution:e,duration:this.b,easing:no})),i=o.constrainResolution(e,t),o.Vb(i))};var o_=_m?"webkitfullscreenchange":mm?"mozfullscreenchange":gm?"MSFullscreenChange":"fullscreenchange";i(Yr,cr),Yr.prototype.v=function(t){t.preventDefault(),Wr()&&(t=this.a)&&(qr()?(t=Ao().a).webkitCancelFullScreen?t.webkitCancelFullScreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.msExitFullscreen?t.msExitFullscreen():t.exitFullscreen&&t.exitFullscreen():(t=t.uc(),this.B?t.mozRequestFullScreenWithKeys?t.mozRequestFullScreenWithKeys():t.webkitRequestFullscreen?t.webkitRequestFullscreen():Hr(t):Hr(t)))},Yr.prototype.l=function(){var t=this.b+"-true",e=this.b+"-false",i=Fo(this.element),o=this.a;qr()?(Vo(i,e)&&(Ho(i,e),Wo(i,t)),zo(this.j,this.i)):(Vo(i,t)&&(Ho(i,t),Wo(i,e)),zo(this.i,this.j)),o&&o.Xc()},i(Xr,cr),(Fm=Xr.prototype).$l=function(){this.i=null},Fm.Bg=function(){return this.get("coordinateFormat")},Fm.hh=function(){return this.get("projection")},Fm.Tk=function(t){this.j=this.a.be(t.a),$r(this,this.j)},Fm.Uk=function(){$r(this,null),this.j=null},Fm.setMap=function(t){Xr.da.setMap.call(this,t),t&&(t=t.a,this.o.push(St(t,"mousemove",this.Tk,!1,this),St(t,"mouseout",this.Uk,!1,this)))},Fm.bi=function(t){this.set("coordinateFormat",t)},Fm.ih=function(t){this.set("projection",t)},i(Jr,lt),Jr.prototype.start=function(){Qr(this),this.b=!1;var t,e=tn(this),i=en(this);e&&!i&&this.a.mozRequestAnimationFrame?(this.ya=St(this.a,"MozBeforePaint",this.f),this.a.mozRequestAnimationFrame(null),this.b=!0):this.ya=e&&i?e.call(this.a,this.f):this.a.setTimeout((t=this.f,function(){return t.apply(this,Array.prototype.slice.call(arguments,0,0))}),20)},Jr.prototype.c=function(){this.b&&this.ya&&It(this.ya),this.ya=null,this.i.call(this.g,Jy())},Jr.prototype.X=function(){Qr(this),Jr.da.X.call(this)};var r_,n_=$e;(Fm=nn.prototype).sc=function(){return this.b},Fm.wc=function(){sn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.f[this.a[e]]);return t},Fm.P=function(){return sn(this),this.a.concat()},Fm.Na=function(){return 0==this.b},Fm.clear=function(){this.f={},this.b=this.a.length=0},Fm.remove=function(t){return!!an(this.f,t)&&(delete this.f[t],this.b--,this.a.length>2*this.b&&sn(this),!0)},Fm.get=function(t,e){return an(this.f,t)?this.f[t]:e},Fm.set=function(t,e){an(this.f,t)||(this.b++,this.a.push(t)),this.f[t]=e},Fm.forEach=function(t,e){for(var i=this.P(),o=0;o<i.length;o++){var r=i[o],n=this.get(r);t.call(e,n,r,this)}},Fm.clone=function(){return new nn(this)},new ln,ln.prototype.set=function(t){this.a=t},ln.prototype.reset=function(){this.set(Jy())},ln.prototype.get=function(){return this.a},i(hn,Ft),hn.prototype.X=function(){hn.da.X.call(this),this.f&&(It(this.f),this.f=null),this.b=this.a=null},hn.prototype.c=function(){var t=Lo(this.a||window),e=this.b;t==e||t&&e&&t.width==e.width&&t.height==e.height||(this.b=t,this.s("resize"))},i(un,Ft),(Fm=un.prototype).xd=null,Fm.oe=null,Fm.wf=null,Fm.pe=null,Fm.lb=-1,Fm.ac=-1,Fm.ef=!1;var s_={3:13,12:144,63232:38,63233:40,63234:37,63235:39,63236:112,63237:113,63238:114,63239:115,63240:116,63241:117,63242:118,63243:119,63244:120,63245:121,63246:122,63247:123,63248:44,63272:46,63273:36,63275:35,63276:33,63277:34,63289:144,63302:45},a_={Up:38,Down:40,Left:37,Right:39,Enter:13,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"U+007F":46,Home:36,End:35,PageUp:33,PageDown:34,Insert:45},l_=gm||ym||_m&&at("525"),h_=vm&&mm;un.prototype.a=function(t){(_m||ym)&&(17==this.lb&&!t.o||18==this.lb&&!t.f||vm&&91==this.lb&&!t.B)&&(this.ac=this.lb=-1),-1==this.lb&&(t.o&&17!=t.i?this.lb=17:t.f&&18!=t.i?this.lb=18:t.B&&91!=t.i&&(this.lb=91)),l_&&!function(t,e,i,o,r){if(!(gm||ym||_m&&at("525")))return 1;if(vm&&r)return pn(t);if((!r||o)&&(y(e)&&(e=cn(e)),i||!(17==e||18==e||vm&&91==e))){if((_m||ym)&&o&&i)switch(t){case 220:case 219:case 221:case 192:case 186:case 189:case 187:case 188:case 190:case 191:case 192:case 222:return}if(!gm||!o||e!=t){switch(t){case 13:return 1;case 27:return!_m&&!ym}return pn(t)}}}(t.i,this.lb,t.c,t.o,t.f)?this.handleEvent(t):(this.ac=cn(t.i),h_&&(this.ef=t.f))},un.prototype.f=function(t){this.ac=this.lb=-1,this.ef=t.f},un.prototype.handleEvent=function(t){var e,i,o=t.a,r=o.altKey;gm&&"keypress"==t.type?i=13!=(e=this.ac)&&27!=e?o.keyCode:0:(_m||ym)&&"keypress"==t.type?(e=this.ac,i=0<=o.charCode&&o.charCode<63232&&pn(e)?o.charCode:0):fm&&!_m?i=pn(e=this.ac)?o.keyCode:0:(e=o.keyCode||this.ac,i=o.charCode||0,h_&&(r=this.ef),vm&&63==i&&224==e&&(e=191));var n=e=cn(e),s=o.keyIdentifier;e?63232<=e&&e in s_?n=s_[e]:25==e&&t.c&&(n=9):s&&s in a_&&(n=a_[s]),(t=new gn(this.lb=n,i,0,o)).f=r,this.s(t)},un.prototype.X=function(){un.da.X.call(this),fn(this)},i(gn,gt),i(yn,Ft),yn.prototype.handleEvent=function(t){var e=0,i=0;"mousewheel"==(t=t.a).type?(e=1,(gm||_m&&(bm||at("532.0")))&&(e=40),i=mn(-t.wheelDelta,e),e=l(t.wheelDeltaX)?mn(-t.wheelDeltaY,e):i):(100<(i=t.detail)?i=3:i<-100&&(i=-3),l(t.axis)&&t.axis===t.HORIZONTAL_AXIS||(e=i)),i=new _n(i,t,0,e=y(this.b)?Math.min(Math.max(e,-this.b),this.b):e),this.s(i)},yn.prototype.X=function(){yn.da.X.call(this),It(this.f),this.f=null},i(_n,gt),i(vn,ct);var p_=!1;try{p_=1===new MouseEvent("click",{buttons:1}).buttons}catch(t){}var c_,u_,d_,f_=function(){if(void 0===d_)if(Xy.getComputedStyle){var t,e,i=document.createElement("P"),o={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(e in document.body.appendChild(i),o)e in i.style&&(i.style[e]="translate(1px,1px)",t=Xy.getComputedStyle(i).getPropertyValue(o[e]));ko(i),d_=t&&"none"!==t}else d_=!1;return d_},g_=function(){if(void 0===u_)if(Xy.getComputedStyle){var t,e,i=document.createElement("P"),o={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(e in document.body.appendChild(i),o)e in i.style&&(i.style[e]="translate3d(1px,1px,1px)",t=Xy.getComputedStyle(i).getPropertyValue(o[e]));ko(i),u_=t&&"none"!==t}else u_=!1;return u_},y_=["experimental-webgl","webgl","webkit-3d","moz-webgl"],m_=Xy.devicePixelRatio||1,__=!1,v_=function(){if(!("HTMLCanvasElement"in Xy))return!1;try{var t=bn();return!!t&&(void 0!==t.setLineDash&&(__=!0),!0)}catch(t){return!1}}(),b_="DeviceOrientationEvent"in Xy,x_="geolocation"in Xy.navigator,w_="ontouchstart"in Xy,M_="PointerEvent"in Xy,P_=!!Xy.navigator.msPointerEnabled,E_=!1,Pm=[];if("WebGLRenderingContext"in Xy)try{var S_=Mn(document.createElement("CANVAS"),{failIfMajorPerformanceCaveat:!0});S_&&(E_=!0,W_=S_.getParameter(S_.MAX_TEXTURE_SIZE),Pm=S_.getSupportedExtensions())}catch(t){}c_=E_,Hy=Pm,Wy=W_,i(En,Pn),(Fm=En.prototype).ql=function(t){var e;Sn(this,t)||(1..toString()in this.f&&this.cancel(t),e=Tn(t),this.f[1..toString()]=t,Un(this.a,A_,e,t))},Fm.rl=function(t){var e;Sn(this,t)||(e=Tn(t),Un(this.a,T_,e,t))},Fm.ul=function(t){var e;Sn(this,t)||(e=this.f[1..toString()])&&e.button===t.button&&(e=Tn(t),Un(this.a,C_,e,t),delete this.f[1..toString()])},Fm.tl=function(t){var e;Sn(this,t)||(e=Tn(t),Nn(this.a,e,t))},Fm.sl=function(t){var e;Sn(this,t)||(e=Tn(t),Fn(this.a,e,t))},Fm.cancel=function(t){var e=Tn(t);this.a.cancel(e,t),delete this.f[1..toString()]},i(An,Pn),(Fm=An.prototype).zl=function(t){this.f[t.a.pointerId.toString()]=t;var e=Cn(this,t);Un(this.a,A_,e,t)},Fm.Al=function(t){var e=Cn(this,t);Un(this.a,T_,e,t)},Fm.Dl=function(t){var e=Cn(this,t);Un(this.a,C_,e,t),delete this.f[t.a.pointerId.toString()]},Fm.Bl=function(t){var e=Cn(this,t);Fn(this.a,e,t)},Fm.Cl=function(t){var e=Cn(this,t);Nn(this.a,e,t)},Fm.yl=function(t){var e=Cn(this,t);this.a.cancel(e,t),delete this.f[t.a.pointerId.toString()]},Fm.xl=function(t){this.a.s(new vn("lostpointercapture",t,t.a))},Fm.wl=function(t){this.a.s(new vn("gotpointercapture",t,t.a))},i(In,Pn),(Fm=In.prototype).co=function(t){Bn(this.a,t)},Fm.eo=function(t){Bn(this.a,t)},Fm.io=function(t){Bn(this.a,t)},Fm.fo=function(t){Bn(this.a,t)},Fm.ho=function(t){Bn(this.a,t)},Fm.bo=function(t){Bn(this.a,t)},Fm.pl=function(t){Bn(this.a,t)},Fm.Ck=function(t){Bn(this.a,t)},i(Ln,Pn),(Fm=Ln.prototype).Yh=function(){this.i=0,this.c=void 0},Fm.jp=function(t){var e=t.a.touches,i=Object.keys(this.f),o=i.length;if(o>=e.length){for(var r=[],n=0;n<o;++n){var s=i[n],a=this.f[s];if(!(l=1==s))t:{for(var l=e.length,h=0;h<l;h++)if(e[h].identifier===s-2){l=!0;break t}l=!1}l||r.push(a.Ac)}for(n=0;n<r.length;++n)this.gf(t,r[n])}(0===(e=$(this.f))||1===e&&1..toString()in this.f)&&(this.b=t.a.changedTouches[0].identifier,void 0!==this.c&&Xy.clearTimeout(this.c)),Rn(this,t),this.i++,On(this,t,this.Yn)},Fm.Yn=function(t,e){this.f[e.pointerId]={target:e.target,Ac:e,Gh:e.target};var i=this.a;e.bubbles=!0,Un(i,I_,e,t),i=this.a,e.bubbles=!1,Un(i,O_,e,t),Un(this.a,A_,e,t)},Fm.ip=function(t){t.preventDefault(),On(this,t,this.vl)},Fm.vl=function(t,e){var i,o,r=this.f[e.pointerId];r&&(i=r.Ac,o=r.Gh,Un(this.a,T_,e,t),i&&o!==e.target&&(i.relatedTarget=e.target,e.relatedTarget=o,i.target=o,e.target?(Fn(this.a,i,t),Nn(this.a,e,t)):(e.target=o,e.relatedTarget=null,this.gf(t,e))),r.Ac=e,r.Gh=e.target)},Fm.hp=function(t){Rn(this,t),On(this,t,this.kp)},Fm.kp=function(t,e){Un(this.a,C_,e,t),this.a.Ac(e,t);var i=this.a;e.bubbles=!1,Un(i,R_,e,t),delete this.f[e.pointerId],e.isPrimary&&(this.b=void 0,this.c=Xy.setTimeout(this.Yh.bind(this),200))},Fm.gp=function(t){On(this,t,this.gf)},Fm.gf=function(t,e){this.a.cancel(e,t),this.a.Ac(e,t);var i=this.a;e.bubbles=!1,Un(i,R_,e,t),delete this.f[e.pointerId],e.isPrimary&&(this.b=void 0,this.c=Xy.setTimeout(this.Yh.bind(this),200))},i(Dn,Ft),Dn.prototype.g=function(t){var e=this.b[t.type];e&&e(t)},Dn.prototype.Ac=function(t,e){t.bubbles=!0,Un(this,L_,t,e)},Dn.prototype.cancel=function(t,e){Un(this,D_,t,e)};var T_="pointermove",A_="pointerdown",C_="pointerup",I_="pointerover",L_="pointerout",O_="pointerenter",R_="pointerleave",D_="pointercancel",k_=[["bubbles",!(Dn.prototype.X=function(){for(var t,e,i=this.a.length,o=0;o<i;o++)t=this.a[o],e=this,Object.keys(t.g).forEach(function(t){Ct(this.c,t,this.g,!1,this)},e);Dn.da.X.call(this)})],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]];i(jn,pr),jn.prototype.preventDefault=function(){jn.da.preventDefault.call(this),this.a.preventDefault()},jn.prototype.b=function(){jn.da.b.call(this),this.a.b()},i(Zn,jn),i(Gn,Ft),(Fm=Gn.prototype).Qg=function(t){Vn(this,t);var e,i=new Zn(Z_,this.b,t);this.s(i),this.j||0!==t.button||(e=(i=this).f,t=new Zn(F_,i.b,e),i.s(t),0!==i.i?(Xy.clearTimeout(i.i),i.i=0,t=new Zn(N_,i.b,e),i.s(t)):i.i=Xy.setTimeout(function(){this.i=0;var t=new Zn(z_,this.b,e);this.s(t)}.bind(i),250)),0===this.B&&(this.c.forEach(It),this.c=null,this.j=!1,this.f=null,pt(this.a),this.a=null)},Fm.Xk=function(t){Vn(this,t);var e=new Zn(j_,this.b,t);this.s(e),this.f=t,this.c||(this.a=new Dn(document),this.c=[St(this.a,B_,this.Ql,!1,this),St(this.a,Z_,this.Qg,!1,this),St(this.g,G_,this.Qg,!1,this)])},Fm.Ql=function(t){var e;t.clientX==this.f.clientX&&t.clientY==this.f.clientY||(this.j=!0,e=new Zn(U_,this.b,t,this.j),this.s(e)),t.preventDefault()},Fm.Fo=function(t){this.s(new Zn(t.type,this.b,t,!(!this.f||t.clientX==this.f.clientX&&t.clientY==this.f.clientY)))},Fm.X=function(){this.o&&(It(this.o),this.o=null),this.l&&(It(this.l),this.l=null),this.c&&(this.c.forEach(It),this.c=null),this.a&&(pt(this.a),this.a=null),this.g&&(pt(this.g),this.g=null),Gn.da.X.call(this)};var z_="singleclick",F_="click",N_="dblclick",U_="pointerdrag",B_="pointermove",j_="pointerdown",Z_="pointerup",G_="pointercancel",V_={Cp:z_,rp:F_,sp:N_,vp:U_,yp:B_,up:j_,Bp:Z_,Ap:"pointerover",zp:"pointerout",wp:"pointerenter",xp:"pointerleave",tp:G_};i(Wn,Gt),(Fm=Wn.prototype).J=function(){return this.get("extent")},Fm.Ob=function(){return this.get("maxResolution")},Fm.Pb=function(){return this.get("minResolution")},Fm.Sb=function(){return this.get("opacity")},Fm.tb=function(){return this.get("visible")},Fm.Tb=function(){return this.get("zIndex")},Fm.dc=function(t){this.set("extent",t)},Fm.lc=function(t){this.set("maxResolution",t)},Fm.mc=function(t){this.set("minResolution",t)},Fm.ec=function(t){this.set("opacity",t)},Fm.fc=function(t){this.set("visible",t)},Fm.gc=function(t){this.set("zIndex",t)},i(Yn,ct),i(Xn,Wn),(Fm=Xn.prototype).sf=function(t){return(t=t||[]).push(Hn(this)),t},Fm.ea=function(){return this.get("source")||null},Fm.uf=function(){var t=this.ea();return t?t.B:"undefined"},Fm.Hm=function(){this.u()},Fm.dl=function(){this.i&&(It(this.i),this.i=null);var t=this.ea();t&&(this.i=St(t,"change",this.Hm,!1,this)),this.u()},Fm.setMap=function(t){It(this.o),this.o=null,t||this.u(),It(this.B),this.B=null,t&&(this.o=St(t,"precompose",function(t){var e=Hn(this);e.Db=!1,e.zIndex=1/0,t.frameState.layerStatesArray.push(e),t.frameState.layerStates[R(this)]=e},!1,this),this.B=St(this,"change",t.render,!1,t),this.u())},Fm.Dc=function(t){this.set("source",t)},i($n,Ft),$n.prototype.J=function(){return this.extent},$n.prototype.$=function(){return this.resolution},i(is,Bt),(Fm=is.prototype).cb=s,Fm.zc=function(t,e,i,o){return t=t.slice(),es(e.pixelToCoordinateMatrix,t,t),this.cb(t,e,Bm,this)?i.call(o,this.a):void 0},Fm.ze=Um,Fm.ed=function(i,o,r){return function(e,t){return Dr(i,o,e,t,function(t){r[e]||(r[e]={}),r[e][t.ga.toString()]=t})}},Fm.Lm=function(t){2===t.target.state&&rs(this)},(Fm=cs.prototype).De=function(){return this.B},Fm.fe=function(){return this.C},Fm.Ee=function(){return this.G},Fm.Fe=function(){return this.j},Fm.ge=function(){return this.D},Fm.Ge=function(t){this.B=t},Fm.He=function(t){this.G=t},Fm.Ie=function(t){this.j=t},i(us,cs),(Fm=us.prototype).Yb=function(){if(this.c)return this.c;var t=this.g,e=this.Eb();if("fraction"==this.l||"fraction"==this.o){if(!e)return null;t=this.g.slice(),"fraction"==this.l&&(t[0]*=e[0]),"fraction"==this.o&&(t[1]*=e[1])}if("top-left"!=this.f){if(!e)return null;t===this.g&&(t=this.g.slice()),"top-right"!=this.f&&"bottom-right"!=this.f||(t[0]=-t[0]+e[0]),"bottom-left"!=this.f&&"bottom-right"!=this.f||(t[1]=-t[1]+e[1])}return this.c=t},Fm.hc=function(){var t=this.a;return t.c||t.a},Fm.td=function(){return this.a.b},Fm.Ed=function(){return this.a.f},Fm.Ce=function(){var t,e,i,o=this.a;return o.j||(o.o?((i=bn(t=o.b[0],e=o.b[1])).fillRect(0,0,t,e),o.j=i.canvas):o.j=o.a),o.j},Fm.Ea=function(){if(this.i)return this.i;var t=this.O;if("top-left"!=this.b){var e=this.Eb(),i=this.a.b;if(!e||!i)return null;t=t.slice(),"top-right"!=this.b&&"bottom-right"!=this.b||(t[0]=i[0]-e[0]-t[0]),"bottom-left"!=this.b&&"bottom-right"!=this.b||(t[1]=i[1]-e[1]-t[1])}return this.i=t},Fm.rn=function(){return this.a.l},Fm.Eb=function(){return this.v||this.a.b},Fm.yf=function(t,e){return St(this.a,"change",t,!1,e)},Fm.load=function(){this.a.load()},Fm.ag=function(t,e){Ct(this.a,"change",t,!1,e)},i(ds,Ft),ds.prototype.G=function(){this.f=3,this.g.forEach(It),this.g=null,this.s("change")},ds.prototype.B=function(){if(this.f=2,this.b=[this.a.width,this.a.height],this.g.forEach(It),this.g=null,fs(this),!this.o&&null!==this.i){this.c.width=this.a.width,this.c.height=this.a.height;var t=this.c.getContext("2d");t.drawImage(this.a,0,0);for(var e=t.getImageData(0,0,this.a.width,this.a.height),i=e.data,o=this.i[0]/255,r=this.i[1]/255,n=this.i[2]/255,s=0,a=i.length;s<a;s+=4)i[s]*=o,i[s+1]*=r,i[s+2]*=n;t.putImageData(e,0,0)}this.s("change")},ds.prototype.load=function(){if(0==this.f){this.f=1,this.g=[At(this.a,"error",this.G,!1,this),At(this.a,"load",this.B,!1,this)];try{this.a.src=this.l}catch(t){this.G()}}},e(gs),gs.prototype.clear=function(){this.a={},this.f=0},gs.prototype.get=function(t,e,i){return(t=e+":"+t+":"+(i?Po(i):"null"))in this.a?this.a[t]:null},gs.prototype.set=function(t,e,i,o){this.a[e+":"+t+":"+(i?Po(i):"null")]=o,++this.f},i(ys,lt),(Fm=ys.prototype).X=function(){X(this.c,pt),ys.da.X.call(this)},Fm.Ff=function(t,e,i,o,r,n){function s(t){var e=R(t).toString();return e in p?void 0:(p[e]=!0,i.call(o,t,null))}var a,l,h=(u=e.viewState).resolution,p={},c=u.projection,u=t;for(c.f&&(l=We(c=c.J()),((d=t[0])<c[0]||d>c[2])&&(u=[d+l*Math.ceil((c[0]-d)/l),t[1]])),l=(c=e.layerStatesArray).length-1;0<=l;--l){var d,f=(d=c[l]).layer;if(Kn(d,h)&&r.call(n,f)){var g=vs(this,f);if(a=f.ea()?g.cb(f.ea().O?u:t,e,d.Db?i:s,o):a)return a}}},Fm.rh=function(t,e,i,o,r,n){for(var s=e.viewState.resolution,a=e.layerStatesArray,l=a.length-1;0<=l;--l){var h,p=(h=a[l]).layer;if(Kn(h,s)&&r.call(n,p)&&(h=vs(this,p).zc(t,e,i,o)))return h}},Fm.sh=function(t,e,i,o){return void 0!==this.Ff(t,e,Bm,this,i,o)},Fm.Nk=function(){this.i.render()},Fm.Pe=s,Fm.Lo=function(t,e){for(var i in this.c){var o;e&&i in e.layerStates||(o=i,i=this.c[o],delete this.c[o],It(this.G[o]),delete this.G[o],pt(i))}},ws.prototype.clear=function(){this.a.length=0,this.f.length=0,et(this.b)},ws.prototype.c=function(t){var e=this.o(t);return 1/0!=e&&(this.a.push(t),this.f.push(e),this.b[this.i(t)]=!0,Es(this,0,this.a.length-1),!0)},ws.prototype.sc=function(){return this.a.length},ws.prototype.Na=function(){return 0===this.a.length},i(Ts,ws),Ts.prototype.c=function(t){var e=Ts.da.c.call(this,t);return e&&St(t[0],"change",this.l,!1,this),e},Ts.prototype.l=function(t){var e=(t=t.target).state;2!==e&&3!==e&&4!==e||(Ct(t,"change",this.l,!1,this),(t=t.bb())in this.j&&(delete this.j[t],--this.g),this.G())},i(Is,Gt),Is.prototype.b=function(){return this.get("active")},Is.prototype.i=function(){return this.B},Is.prototype.g=function(t){this.set("active",t)},Is.prototype.setMap=function(t){this.B=t},i(Ds,Is),i(Gs,Is),Gs.prototype.Ec=$e,i(Hs,Gs),Hs.prototype.Ec=Um,i(Ks,Gs),Ks.prototype.Ec=Um,i(ta,lt),ta.prototype.X=function(){this.setMap(null),ta.da.X.call(this)},ta.prototype.setMap=function(t){var e;this.a&&(this.a.l.removeChild(this.f),(e=this.f.style).left=e.top=e.width=e.height="inherit"),(this.a=t)&&this.a.l.appendChild(this.f)},ta.prototype.W=function(){return this.c},i(oa,ct),i(ra,Gs),ra.prototype.W=function(){return this.a.W()},ra.prototype.o=s,i(ha,ra),ha.prototype.o=function(){var t=this.B,e=t.aa(),i=t.Ta(),o=this.W().J(),i=e.constrainResolution(Math.max(We(o)/i[0],je(o)/i[1])),r=e.$(),n=e.Va();t.Pa(co({resolution:r,duration:this.l,easing:no})),t.Pa(ho({source:n,duration:this.l,easing:no})),e.mb(Ue(o)),e.Vb(i)},i(pa,Is),i(ua,Is),i(fa,Is),fa.prototype.v=function(t){var e=x(this.c,-1,1),i=t.aa();t.render(),Os(t,i,-e,this.a,this.C),this.c=0,this.a=null,this.l=this.j=void 0},fa.prototype.D=function(t){(this.o=t)||(this.a=null)},i(ya,Gs),ya.prototype.Ec=Um,i(ba,Gs),ba.prototype.Ec=Um,i(Ea,Wn),(Fm=Ea.prototype).ke=function(){this.tb()&&this.u()},Fm.Pk=function(){this.b.forEach(It),this.b.length=0;var t=this.Rc();this.b.push(St(t,"add",this.Ok,!1,this),St(t,"remove",this.Qk,!1,this)),X(this.a,function(t){t.forEach(It)}),et(this.a);for(var e,i=0,o=(t=t.a).length;i<o;i++)e=t[i],this.a[R(e).toString()]=[St(e,"propertychange",this.ke,!1,this),St(e,"change",this.ke,!1,this)];this.u()},Fm.Ok=function(t){var e=R(t=t.element).toString();this.a[e]=[St(t,"propertychange",this.ke,!1,this),St(t,"change",this.ke,!1,this)],this.u()},Fm.Qk=function(t){t=R(t.element).toString(),this.a[t].forEach(It),delete this.a[t],this.u()},Fm.Rc=function(){return this.get("layers")},Fm.oh=function(t){this.set("layers",t)},Fm.sf=function(t){var e,i,o=void 0!==t?t:[],r=o.length;for(this.Rc().forEach(function(t){t.sf(o)}),t=Hn(this),e=o.length;r<e;r++)(i=o[r]).opacity*=t.opacity,i.visible=i.visible&&t.visible,i.maxResolution=Math.min(i.maxResolution,t.maxResolution),i.minResolution=Math.max(i.minResolution,t.minResolution),void 0!==t.extent&&(i.extent=void 0!==i.extent?Ze(i.extent,t.extent):t.extent);return o},Fm.uf=function(){return"ready"},i(Sa,ti),Sa.prototype.getPointResolution=function(t,e){return t/pm(e[1]/6378137)};var W_=6378137*Math.PI,H_=[-W_,-W_,W_,W_],q_=[-180,-85,180,85],Y_="EPSG:3857 EPSG:102100 EPSG:102113 EPSG:900913 urn:ogc:def:crs:EPSG:6.18:3:3857 urn:ogc:def:crs:EPSG::3857 http://www.opengis.net/gml/srs/epsg.xml#3857".split(" ").map(function(t){return new Sa(t)}),X_=new Qe(6378137);i(Ca,ti),Ca.prototype.getPointResolution=function(t){return t};var K_=[-180,-90,180,90],$_=Math.PI*X_.radius/180,J_=[new Ca("CRS:84"),new Ca("EPSG:4326","neu"),new Ca("urn:ogc:def:crs:EPSG::4326","neu"),new Ca("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new Ca("urn:ogc:def:crs:OGC:1.3:CRS84"),new Ca("urn:ogc:def:crs:OGC:2:84"),new Ca("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Ca("urn:x-ogc:def:crs:EPSG:4326","neu")];i(La,Xn),i(Oa,Xn),Oa.prototype.a=function(){return this.get("preload")},Oa.prototype.c=function(t){this.set("preload",t)},Oa.prototype.b=function(){return this.get("useInterimTilesOnError")},Oa.prototype.g=function(t){this.set("useInterimTilesOnError",t)};var Q_=[0,0,0,1],tv=[],ev=[0,0,0,1];Ra.prototype.b=function(){return this.a},Ra.prototype.c=function(t){this.a=t,this.f=void 0},i(ka,function(){this.f=-1}),ka.prototype.reset=function(){this.a[0]=1732584193,this.a[1]=4023233417,this.a[2]=2562383102,this.a[3]=271733878,this.c=this.b=0},(Fm=Na.prototype).yn=function(){return this.a},Fm.$j=function(){return this.c},Fm.zn=function(){return this.b},Fm.ak=function(){return this.g},Fm.fk=function(){return this.i},Fm.An=function(){return this.f},Fm.Bn=function(t){this.a=t,this.j=void 0},Fm.Wo=function(t){this.c=t,this.j=void 0},Fm.Cn=function(t){this.b=t,this.j=void 0},Fm.Xo=function(t){this.g=t,this.j=void 0},Fm.Yo=function(t){this.i=t,this.j=void 0},Fm.bp=function(t){this.f=t,this.j=void 0},i(Ba,cs),(Fm=Ba.prototype).Yb=function(){return this.l},Fm.nn=function(){return this.c},Fm.Ce=function(){return this.i},Fm.hc=function(){return this.a},Fm.Ed=function(){return 2},Fm.td=function(){return this.o},Fm.Ea=function(){return this.v},Fm.pn=function(){return this.b},Fm.Eb=function(){return this.O},Fm.qn=function(){return this.f},Fm.yf=s,Fm.load=s,Fm.ag=s,Fm.Bh=function(t,e,i,o){e.setTransform(1,0,0,1,0,0),e.translate(i,o),e.beginPath(),e.arc(t.size/2,t.size/2,this.b,0,2*Math.PI,!0),this.c&&(e.fillStyle=Po(this.c.a),e.fill()),this.f&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.Jd,t.lineDash&&e.setLineDash(t.lineDash),e.stroke()),e.closePath()},Fm.Ah=function(t,e,i,o){e.setTransform(1,0,0,1,0,0),e.translate(i,o),e.beginPath(),e.arc(t.size/2,t.size/2,this.b,0,2*Math.PI,!0),e.fillStyle=Po(Q_),e.fill(),this.f&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.Jd,t.lineDash&&e.setLineDash(t.lineDash),e.stroke()),e.closePath()},(Fm=ja.prototype).W=function(){return this.i},Fm.Vj=function(){return this.c},Fm.Dn=function(){return this.g},Fm.En=function(){return this.f},Fm.Fn=function(){return this.b},Fm.Da=function(){return this.j},Fm.Gn=function(){return this.a},Fm.Eh=function(e){c(e)?this.c=e:u(e)?this.c=function(t){return t.get(e)}:e?void 0!==e&&(this.c=function(){return e}):this.c=Wa,this.i=e},Fm.Hn=function(t){this.a=t};var iv=null;i(Ha,Xn),Ha.prototype.C=function(){return this.v},Ha.prototype.D=function(){return this.b},Ha.prototype.c=function(t){this.v=void 0!==t?t:Ga,this.b=null===t?void 0:Za(this.v),this.u()},i(Ya,Ha),Ya.prototype.g=function(){return this.get("preload")},Ya.prototype.U=function(){return this.get("useInterimTilesOnError")},Ya.prototype.T=function(t){this.set("preload",t)},Ya.prototype.Y=function(t){this.set("useInterimTilesOnError",t)},(Fm=Xa.prototype).pd=function(t,e){var i=t.toString(),t=this.v[i];void 0!==t?t.push(e):this.v[i]=[e]},Fm.Jc=function(t){var e,i,o;He(this.g,t.J())&&((this.f||this.a)&&(this.f&&el(this,this.f),this.a&&il(this,this.a),e=this.pa,i=this.C,i=(e=(o=t.ja())?yi(o,0,o.length,t.sa(),e,i):null)[2]-e[0],o=e[3]-e[1],i=Math.sqrt(i*i+o*o),(o=this.b).beginPath(),o.arc(e[0],e[1],i,0,2*Math.PI),this.f&&o.fill(),this.a&&o.stroke()),""!==this.c&&$a(this,t.yd(),2,2))},Fm.lf=function(t,e){var i=e.c(t);i&&He(this.g,i.J())&&(t=e.a,this.pd(t=void 0===t?0:t,function(t){t.eb(e.g,e.b),t.wb(e.f),t.fb(e.Da()),ov[i.V()].call(t,i,null)}))},Fm.Zd=function(t,e){for(var i=t.c,o=0,r=i.length;o<r;++o){var n=i[o];ov[n.V()].call(this,n,e)}},Fm.Jb=function(t){var e=t.ja();t=t.sa(),this.i&&Ka(this,e,e.length),""!==this.c&&$a(this,e,e.length,t)},Fm.Ib=function(t){var e=t.ja();t=t.sa(),this.i&&Ka(this,e,e.length),""!==this.c&&$a(this,e,e.length,t)},Fm.Xb=function(t){var e,i;He(this.g,t.J())&&(this.a&&(il(this,this.a),e=this.b,i=t.ja(),e.beginPath(),Ja(this,i,0,i.length,t.sa(),!1),e.stroke()),""!==this.c&&$a(this,t=Kc(t),2,2))},Fm.Kc=function(t){var e=t.J();if(He(this.g,e)){if(this.a){il(this,this.a);var i,o,e=this.b,r=t.ja(),n=0,s=t.Bb(),a=t.sa();for(e.beginPath(),i=0,o=s.length;i<o;++i)n=Ja(this,r,n,s[i],a,!1);e.stroke()}""!==this.c&&$a(this,t=Jc(t),t.length,2)}},Fm.Mc=function(t){var e;He(this.g,t.J())&&((this.a||this.f)&&(this.f&&el(this,this.f),this.a&&il(this,this.a),(e=this.b).beginPath(),Qa(this,t.Rb(),0,t.Bb(),t.sa()),this.f&&e.fill(),this.a&&e.stroke()),""!==this.c&&$a(this,t=Xi(t),2,2))},Fm.Lc=function(t){if(He(this.g,t.J())){if(this.a||this.f){this.f&&el(this,this.f),this.a&&il(this,this.a);for(var e=this.b,i=ou(t),o=0,r=t.g,n=t.sa(),s=0,a=r.length;s<a;++s){var l=r[s];e.beginPath(),o=Qa(this,i,o,l,n),this.f&&e.fill(),this.a&&e.stroke()}}""!==this.c&&$a(this,t=iu(t),t.length,2)}},Fm.eb=function(t,e){var i,o,r,n;t?(i=t.a,this.f={fillStyle:Po(i||Q_)}):this.f=null,e?(i=e.a,o=e.c,r=e.b,n=e.g,t=e.f,e=e.i,this.a={lineCap:void 0!==o?o:"round",lineDash:r||tv,lineJoin:void 0!==n?n:"round",lineWidth:this.D*(void 0!==t?t:1),miterLimit:void 0!==e?e:10,strokeStyle:Po(i||ev)}):this.a=null},Fm.wb=function(t){var e,i,o,r;t?(e=t.Yb(),i=t.hc(1),o=t.Ea(),r=t.Eb(),this.wa=e[0],this.U=e[1],this.T=r[1],this.i=i,this.B=t.B,this.na=o[0],this.xa=o[1],this.jb=t.C,this.Fb=t.G,this.j=t.j,this.Gb=t.D,this.Y=r[0]):this.i=null},Fm.fb=function(t){var e,i,o,r,n,s,a;t?((e=t.a)?(e=e.a,this.l={fillStyle:Po(e||Q_)}):this.l=null,(s=t.j)?(e=s.a,i=s.c,o=s.b,r=s.g,n=s.f,s=s.i,this.G={lineCap:void 0!==i?i:"round",lineDash:o||tv,lineJoin:void 0!==r?r:"round",lineWidth:void 0!==n?n:1,miterLimit:void 0!==s?s:10,strokeStyle:Po(e||ev)}):this.G=null,e=t.b,i=t.c,o=t.g,r=t.i,n=t.f,s=t.Da(),a=t.l,t=t.o,this.ha={font:void 0!==e?e:"10px sans-serif",textAlign:void 0!==a?a:"center",textBaseline:void 0!==t?t:"middle"},this.c=void 0!==s?s:"",this.oc=void 0!==i?this.D*i:0,this.Pd=void 0!==o?this.D*o:0,this.O=void 0!==r?r:0,this.o=this.D*(void 0!==n?n:1)):this.c=""};var ov={Point:Xa.prototype.Jb,LineString:Xa.prototype.Xb,Polygon:Xa.prototype.Mc,MultiPoint:Xa.prototype.Ib,MultiLineString:Xa.prototype.Kc,MultiPolygon:Xa.prototype.Lc,GeometryCollection:Xa.prototype.Zd,Circle:Xa.prototype.Jc};i(ol,is),ol.prototype.G=function(t,e,i){rl(this,"precompose",i,t,void 0);var o,r,n,s,a,l,h=this.Bd();h&&((o=void 0!==(l=e.extent))&&(r=t.pixelRatio,n=Ge(l),s=Ve(l),a=Ne(l),l=Fe(l),es(t.coordinateToPixelMatrix,n,n),es(t.coordinateToPixelMatrix,s,s),es(t.coordinateToPixelMatrix,a,a),es(t.coordinateToPixelMatrix,l,l),i.save(),i.beginPath(),i.moveTo(n[0]*r,n[1]*r),i.lineTo(s[0]*r,s[1]*r),i.lineTo(a[0]*r,a[1]*r),i.lineTo(l[0]*r,l[1]*r),i.clip()),r=this.qf(),n=i.globalAlpha,i.globalAlpha=e.opacity,0===t.viewState.rotation?i.drawImage(h,0,0,+h.width,+h.height,Math.round(r[12]),Math.round(r[13]),Math.round(h.width*r[0]),Math.round(h.height*r[5])):(i.setTransform(r[0],r[1],r[4],r[5],r[12],r[13]),i.drawImage(h,0,0),i.setTransform(1,0,0,1,0,0)),i.globalAlpha=n,o&&i.restore()),rl(this,"postcompose",i,t,void 0)};var rv,nv,sv=(nv=rv=null,function(t){rv||(rv=bn(1,1),(e=(nv=rv.createImageData(1,1)).data)[0]=42,e[1]=84,e[2]=126,e[3]=255);var e=rv.canvas,i=t[0]<=e.width&&t[1]<=e.height;return i||(e.width=t[0],e.height=t[1],e=t[0]-1,t=t[1]-1,rv.putImageData(nv,e,t),t=rv.getImageData(e,t,1,1),i=F(nv.data,t.data)),i}),av=["Polygon","LineString","Image","Text"];i(al,qn),al.prototype.ye=s,al.prototype.nf=function(){return this.Y},i(dl,al),dl.prototype.Jb=function(t,e){var i,o;this.l&&(hl(this,e),o=t.ja(),i=this.coordinates.length,o=ll(this,o,0,o.length,t.sa(),!1),this.f.push([4,i,o,this.l,this.b,this.i,this.j,this.o,this.G,this.B,this.v,this.C,this.D,this.O,this.pa]),this.a.push([4,i,o,this.T,this.b,this.i,this.j,this.o,this.G,this.B,this.v,this.C,this.D,this.O,this.pa]),ul(this,e))},dl.prototype.Ib=function(t,e){var i,o;this.l&&(hl(this,e),o=t.ja(),i=this.coordinates.length,o=ll(this,o,0,o.length,t.sa(),!1),this.f.push([4,i,o,this.l,this.b,this.i,this.j,this.o,this.G,this.B,this.v,this.C,this.D,this.O,this.pa]),this.a.push([4,i,o,this.T,this.b,this.i,this.j,this.o,this.G,this.B,this.v,this.C,this.D,this.O,this.pa]),ul(this,e))},dl.prototype.ye=function(){cl(this),this.i=this.b=void 0,this.l=this.T=null,this.pa=this.O=this.C=this.v=this.B=this.G=this.o=this.D=this.j=void 0},dl.prototype.wb=function(t){var e=t.Yb(),i=t.Eb(),o=t.Ce(1),r=t.hc(1),n=t.Ea();this.b=e[0],this.i=e[1],this.T=o,this.l=r,this.j=i[1],this.o=t.B,this.G=n[0],this.B=n[1],this.v=t.C,this.C=t.G,this.D=t.j,this.O=t.D,this.pa=i[0]},i(fl,al),(Fm=fl.prototype).nf=function(){return this.c||(this.c=xe(this.Y),0<this.g&&be(this.c,this.resolution*(this.g+1)/2,this.c)),this.c},Fm.Xb=function(t,e){var i=this.b,o=i.lineWidth;void 0!==i.strokeStyle&&void 0!==o&&(yl(this),hl(this,e),this.a.push([10,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash],[1]),gl(this,i=t.ja(),0,i.length,t.sa()),this.a.push([12]),ul(this,e))},Fm.Kc=function(t,e){var i=(o=this.b).lineWidth;if(void 0!==o.strokeStyle&&void 0!==i){yl(this),hl(this,e),this.a.push([10,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash],[1]);for(var o=t.Bb(),i=t.ja(),r=t.sa(),n=0,s=0,a=o.length;s<a;++s)n=gl(this,i,n,o[s],r);this.a.push([12]),ul(this,e)}},Fm.ye=function(){this.b.xf!=this.coordinates.length&&this.f.push([12]),cl(this),this.b=null},Fm.eb=function(t,e){var i=e.a;this.b.strokeStyle=Po(i||ev),i=e.c,this.b.lineCap=void 0!==i?i:"round",i=e.b,this.b.lineDash=i||tv,i=e.g,this.b.lineJoin=void 0!==i?i:"round",i=e.f,this.b.lineWidth=void 0!==i?i:1,i=e.i,this.b.miterLimit=void 0!==i?i:10,this.b.lineWidth>this.g&&(this.g=this.b.lineWidth,this.c=null)},i(ml,al),(Fm=ml.prototype).Jc=function(t,e){var i,o=this.b,r=o.strokeStyle;void 0===o.fillStyle&&void 0===r||(vl(this),hl(this,e),this.a.push([9,Po(Q_)]),void 0!==o.strokeStyle&&this.a.push([10,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash]),i=t.ja(),r=this.coordinates.length,ll(this,i,0,i.length,t.sa(),!1),this.f.push(i=[1],r=[2,r]),this.a.push(i,r),this.a.push(r=[7]),void 0!==o.fillStyle&&this.f.push(r),void 0!==o.strokeStyle&&(this.f.push(o=[12]),this.a.push(o)),ul(this,e))},Fm.Mc=function(t,e){var i=this.b,o=i.strokeStyle;void 0===i.fillStyle&&void 0===o||(vl(this),hl(this,e),this.a.push([9,Po(Q_)]),void 0!==i.strokeStyle&&this.a.push([10,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash]),i=t.Bb(),_l(this,o=t.Rb(),0,i,t.sa()),ul(this,e))},Fm.Lc=function(t,e){var i=(o=this.b).strokeStyle;if(void 0!==o.fillStyle||void 0!==i){vl(this),hl(this,e),this.a.push([9,Po(Q_)]),void 0!==o.strokeStyle&&this.a.push([10,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash]);for(var o=t.g,i=ou(t),r=t.sa(),n=0,s=0,a=o.length;s<a;++s)n=_l(this,i,n,o[s],r);ul(this,e)}},Fm.ye=function(){cl(this),this.b=null;var t=this.na;if(0!==t)for(var e=this.coordinates,i=0,o=e.length;i<o;++i)e[i]=t*Math.round(e[i]/t)},Fm.nf=function(){return this.c||(this.c=xe(this.Y),0<this.g&&be(this.c,this.resolution*(this.g+1)/2,this.c)),this.c},Fm.eb=function(t,e){var i,o=this.b;t?(i=t.a,o.fillStyle=Po(i||Q_)):o.fillStyle=void 0,e?(i=e.a,o.strokeStyle=Po(i||ev),i=e.c,o.lineCap=void 0!==i?i:"round",i=e.b,o.lineDash=i?i.slice():tv,i=e.g,o.lineJoin=void 0!==i?i:"round",i=e.f,o.lineWidth=void 0!==i?i:1,i=e.i,o.miterLimit=void 0!==i?i:10,o.lineWidth>this.g&&(this.g=o.lineWidth,this.c=null)):(o.strokeStyle=void 0,o.lineCap=void 0,o.lineDash=null,o.lineJoin=void 0,o.lineWidth=void 0,o.miterLimit=void 0)},i(bl,al),bl.prototype.Kb=function(t,e,i,o,r,n){var s,a;""!==this.l&&this.j&&(this.b||this.i)&&(this.b&&(r=this.b,(s=this.C)&&s.fillStyle==r.fillStyle||(a=[9,r.fillStyle],this.f.push(a),this.a.push(a),s?s.fillStyle=r.fillStyle:this.C={fillStyle:r.fillStyle})),this.i&&(r=this.i,(s=this.D)&&s.lineCap==r.lineCap&&s.lineDash==r.lineDash&&s.lineJoin==r.lineJoin&&s.lineWidth==r.lineWidth&&s.miterLimit==r.miterLimit&&s.strokeStyle==r.strokeStyle||(a=[10,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,!1],this.f.push(a),this.a.push(a),s?(s.lineCap=r.lineCap,s.lineDash=r.lineDash,s.lineJoin=r.lineJoin,s.lineWidth=r.lineWidth,s.miterLimit=r.miterLimit,s.strokeStyle=r.strokeStyle):this.D={lineCap:r.lineCap,lineDash:r.lineDash,lineJoin:r.lineJoin,lineWidth:r.lineWidth,miterLimit:r.miterLimit,strokeStyle:r.strokeStyle})),r=this.j,(s=this.O)&&s.font==r.font&&s.textAlign==r.textAlign&&s.textBaseline==r.textBaseline||(a=[11,r.font,r.textAlign,r.textBaseline],this.f.push(a),this.a.push(a),s?(s.font=r.font,s.textAlign=r.textAlign,s.textBaseline=r.textBaseline):this.O={font:r.font,textAlign:r.textAlign,textBaseline:r.textBaseline}),hl(this,n),t=[5,r=this.coordinates.length,t=ll(this,t,e,i,o,!1),this.l,this.o,this.G,this.B,this.v,!!this.b,!!this.i],this.f.push(t),this.a.push(t),ul(this,n))},bl.prototype.fb=function(t){var e,i,o,r,n,s,a,l;t?((i=t.a)?(i=Po((i=i.a)||Q_),this.b?this.b.fillStyle=i:this.b={fillStyle:i}):this.b=null,(s=t.j)?(i=s.a,o=s.c,r=s.b,a=s.g,n=s.f,s=s.i,o=void 0!==o?o:"round",r=r?r.slice():tv,a=void 0!==a?a:"round",n=void 0!==n?n:1,s=void 0!==s?s:10,i=Po(i||ev),this.i?((l=this.i).lineCap=o,l.lineDash=r,l.lineJoin=a,l.lineWidth=n,l.miterLimit=s,l.strokeStyle=i):this.i={lineCap:o,lineDash:r,lineJoin:a,lineWidth:n,miterLimit:s,strokeStyle:i}):this.i=null,e=t.b,i=t.c,o=t.g,r=t.i,n=t.f,s=t.Da(),a=t.l,l=t.o,t=void 0!==e?e:"10px sans-serif",a=void 0!==a?a:"center",l=void 0!==l?l:"middle",this.j?((e=this.j).font=t,e.textAlign=a,e.textBaseline=l):this.j={font:t,textAlign:a,textBaseline:l},this.l=void 0!==s?s:"",this.o=void 0!==i?i:0,this.G=void 0!==o?o:0,this.B=void 0!==r?r:0,this.v=void 0!==n?n:1):this.l=""},xl.prototype.c=function(t,e,i,o,r){var n=this.l;Qn(n,.5,.5,1/e,-1/e,-i,-t[0],-t[1]);var s,a=this.j;return a.clearRect(0,0,1,1),void 0!==this.i&&(Re(s=Te(),t),be(s,e*this.i,s)),function(t,e,i,o,r,n,s){var a,l,h,p,c,u=Object.keys(t.b).map(Number);for(u.sort(function(t,e){return e-t}),a=0,l=u.length;a<l;++a)for(p=t.b[u[a].toString()],h=av.length-1;0<=h;--h)if(void 0!==(c=p[av[h]])&&(c=pl(c,e,1,i,o,r,c.a,n,s)))return c}(this,a,n,i,o,function(t){if(0<a.getImageData(0,0,1,1).data[3]){if(t=r(t))return t;a.clearRect(0,0,1,1)}},s)},xl.prototype.a=function(t,e){var i=void 0!==t?t.toString():"0",t=this.b[i];return void 0===t&&(this.b[i]=t={}),void 0===(i=t[e])&&(i=new lv[e](this.G,this.g,this.o),t[e]=i),i},xl.prototype.Na=function(){return tt(this.b)},xl.prototype.f=function(t,e,i,o,r,n){var s,a,l,h,p,c=Object.keys(this.b).map(Number);for(c.sort(Z),!1!==n&&(n=(l=this.g)[0],s=l[1],a=l[2],yi(n=[n,s,n,l=l[3],a,l,a,s],0,8,2,i,n),t.save(),t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.closePath(),t.clip()),n=0,s=c.length;n<s;++n)for(h=this.b[c[n].toString()],a=0,l=av.length;a<l;++a)void 0!==(p=h[av[a]])&&pl(p,t,e,i,o,r,p.f,void 0);t.restore()};var lv={Image:dl,LineString:fl,Polygon:ml,Text:bl};(Fm=Ml.prototype).get=function(t){return this.c[t]},Fm.Bb=function(){return this.g},Fm.J=function(){return this.f||(this.f="Point"===this.b?Ce(this.a):Ie(this.a,0,this.a.length,2)),this.f},Fm.Rb=function(){return this.a},Fm.ja=Ml.prototype.Rb,Fm.W=function(){return this},Fm.Km=function(){return this.c},Fm.vd=Ml.prototype.W,Fm.sa=function(){return 2},Fm.cc=s,Fm.V=function(){return this.b};var hv={Point:function(t,e,i,o){var r=i.f;if(r){if(2!=r.Ed())return;var n=t.a(i.a,"Image");n.wb(r),n.Jb(e,o)}(r=i.Da())&&((t=t.a(i.a,"Text")).fb(r),t.Kb(e.ja(),0,2,2,e,o))},LineString:function(t,e,i,o){var r,n=i.b;n&&((r=t.a(i.a,"LineString")).eb(null,n),r.Xb(e,o)),(n=i.Da())&&((t=t.a(i.a,"Text")).fb(n),t.Kb(Kc(e),0,2,2,e,o))},Polygon:function(t,e,i,o){var r,n=i.g,s=i.b;(n||s)&&((r=t.a(i.a,"Polygon")).eb(n,s),r.Mc(e,o)),(n=i.Da())&&((t=t.a(i.a,"Text")).fb(n),t.Kb(Xi(e),0,2,2,e,o))},MultiPoint:function(t,e,i,o){var r=i.f;if(r){if(2!=r.Ed())return;var n=t.a(i.a,"Image");n.wb(r),n.Ib(e,o)}(r=i.Da())&&((t=t.a(i.a,"Text")).fb(r),i=e.ja(),t.Kb(i,0,i.length,e.sa(),e,o))},MultiLineString:function(t,e,i,o){var r,n=i.b;n&&((r=t.a(i.a,"LineString")).eb(null,n),r.Kc(e,o)),(n=i.Da())&&((t=t.a(i.a,"Text")).fb(n),i=Jc(e),t.Kb(i,0,i.length,2,e,o))},MultiPolygon:function(t,e,i,o){var r,n=i.g,s=i.b;(s||n)&&((r=t.a(i.a,"Polygon")).eb(n,s),r.Lc(e,o)),(n=i.Da())&&((t=t.a(i.a,"Text")).fb(n),i=iu(e),t.Kb(i,0,i.length,2,e,o))},GeometryCollection:function(t,e,i,o){for(var r=0,n=(e=e.c).length;r<n;++r)hv[e[r].V()](t,e[r],i,o)},Circle:function(t,e,i,o){var r,n=i.g,s=i.b;(n||s)&&((r=t.a(i.a,"Polygon")).eb(n,s),r.Jc(e,o)),(n=i.Da())&&((t=t.a(i.a,"Text")).fb(n),t.Kb(e.yd(),0,2,2,e,o))}};i(Tl,$n),Tl.prototype.getError=function(){return this.f},Tl.prototype.j=function(t){t?(this.f=t,this.state=3):this.state=2,Jn(this)},Tl.prototype.load=function(){0==this.state&&(this.state=1,Jn(this),this.g(this.j.bind(this)))},Tl.prototype.a=function(){return this.c};var pv=!((Y("Chrome")||Y("CriOS"))&&!Y("Opera")&&!Y("OPR")&&!Y("Edge"))||Y("iPhone")&&!Y("iPod")&&!Y("iPad")||Y("iPad")||Y("iPod");i(Rl,$n),Rl.prototype.X=function(){1==this.state&&(It(this.c),this.c=null),Rl.da.X.call(this)},Rl.prototype.a=function(){return this.l},Rl.prototype.load=function(){var t;0==this.state&&(this.state=1,Jn(this),2==(t=this.f.state)||3==t?Dl(this):(this.c=this.f.Sa("change",function(){var t=this.f.state;2!=t&&3!=t||(It(this.c),this.c=null,Dl(this))},!1,this),this.f.load()))},i(kl,vr),kl.prototype.C=function(t,e,i,o){var r=this.b;if(r&&o&&!li(r,o)){if(this.a){if(this.qa==this.f&&li(this.a.v,o)&&this.a.$()==e&&this.a.b==i&&Le(this.a.J(),t))return this.a;this.a.rc(),this.a=null}return this.a=new Rl(r,o,t,e,i,function(t,e,i){return this.sd(t,e,i,r)}.bind(this)),this.qa=this.f,this.a}return this.sd(t,e,i,o=r?r:o)},kl.prototype.l=function(t){switch((t=t.target).state){case 1:this.s(new Nl(cv,t));break;case 2:this.s(new Nl(uv,t));break;case 3:this.s(new Nl(dv,t))}},i(Nl,ct);var cv="imageloadstart",uv="imageloadend",dv="imageloaderror";i(Ul,kl),Ul.prototype.sd=function(t,e,i,o){e=zl(this,e);var r=this.Y;return r&&this.ha==this.f&&r.$()==e&&r.b==i&&Pe(r.J(),t)||(Ye(t=t.slice(),this.na),(o=this.ia(t,e,i,[We(t)/e*i,je(t)/e*i],o))&&(r=new Tl(t,e,i,this.i,o)),this.Y=r,this.ha=this.f),r},i(Bl,Gt),(Fm=Bl.prototype).clone=function(){var t=new Bl(this.R());t.Cc(this.a);var e=this.W();return e&&t.Oa(e.clone()),(e=this.c)&&t.Bf(e),t},Fm.W=function(){return this.get(this.a)},Fm.Qa=function(){return this.ya},Fm.Wj=function(){return this.a},Fm.Hl=function(){return this.c},Fm.cc=function(){return this.g},Fm.Il=function(){this.u()},Fm.je=function(){this.b&&(It(this.b),this.b=null);var t=this.W();t&&(this.b=St(t,"change",this.Il,!1,this)),this.u()},Fm.Oa=function(t){this.set(this.a,t)},Fm.Bf=function(t){var e;this.g=(this.c=t)?(c(t=t)||(e=w(t)?t:[t],t=function(){return e}),t):void 0,this.u()},Fm.kc=function(t){this.ya=t,this.u()},Fm.Cc=function(t){Ct(this,Vt(this.a),this.je,!1,this),this.a=t,St(this,Vt(this.a),this.je,!1,this),this.je()},Gl.prototype.get=function(){var t;return 0<this.f?(this.f--,t=this.a,this.a=t.next,t.next=null):t=this.b(),t};var fv=new Gl(function(){return new Hl},function(t){t.reset()},100);Wl.prototype.remove=function(){var t=null;return this.a&&(t=this.a,this.a=this.a.next,this.a||(this.f=null),t.next=null),t},Hl.prototype.set=function(t,e){this.a=t,this.f=e,this.next=null};var gv,yv=!(Hl.prototype.reset=function(){this.next=this.f=this.a=null}),mv=new Wl,_v=0,vv=2,bv=3;Kl.prototype.reset=function(){this.b=this.f=this.c=this.a=null,this.g=!1};var xv=new Gl(function(){return new Kl},function(t){t.reset()},100);Xl.prototype.then=function(t,e,i){return o=this,r=c(t)?t:null,n=c(e)?e:null,s=i,(a=$l(null,null,null)).a=new Xl(function(i,o){a.c=r?function(t){try{var e=r.call(s,t);i(e)}catch(t){o(t)}}:i,a.f=n?function(t){try{var e=n.call(s,t);!l(e)&&t instanceof rh?o(t):i(e)}catch(t){o(t)}}:o}),Jl(a.a.b=o,a),a.a;var o,r,n,s,a},jl(Xl),Xl.prototype.cancel=function(t){this.a==_v&&ql(function(){!function t(e,i){if(e.a==_v)if(e.b){var o=e.b;if(o.f){for(var r=0,n=null,s=null,a=o.f;a&&(a.g||(r++,!((n=a.a==e?a:n)&&1<r)));a=a.next)n||(s=a);n&&(o.a==_v&&1==r?t(o,i):(s?((r=s).next==o.c&&(o.c=r),r.next=r.next.next):eh(o),ih(o,n,bv,i)))}e.b=null}else Ql(e,bv,i)}(this,new rh(t))},this)},Xl.prototype.o=function(t){this.a=_v,Ql(this,vv,t)},Xl.prototype.G=function(t){this.a=_v,Ql(this,bv,t)},Xl.prototype.l=function(){for(var t;t=eh(this);)ih(this,t,this.a,this.j);this.i=!1};var wv=on;i(rh,a),rh.prototype.name="cancel";var Mv=Xy.JSON.parse,Pv=Xy.JSON.stringify;sh.prototype.f=null,i(ah,sh),ah.prototype.a=function(){var t=lh(this);return t?new ActiveXObject(t):new XMLHttpRequest},ah.prototype.c=function(){var t={};return lh(this)&&(t[0]=!0,t[1]=!0),t};var Ev=new ah,Sv=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;i(ch,Ft);var Tv="",Av=/^https?$/i,Cv=["POST","PUT"];ch.prototype.Fc=function(){void 0!==Yy&&this.fa&&(this.g="Timed out after "+this.j+"ms, aborting",this.s("timeout"),this.fa&&this.a&&(this.a=!1,this.f=!0,this.fa.abort(),this.f=!1,this.s("complete"),this.s("abort"),mh(this)))},ch.prototype.X=function(){this.fa&&(this.a&&(this.a=!1,this.f=!0,this.fa.abort(),this.f=!1),mh(this,!0)),ch.da.X.call(this)},ch.prototype.D=function(){this.pa||(this.B||this.c||this.f?yh(this):this.T())},ch.prototype.T=function(){yh(this)},i(Mh,mr),(Fm=Mh.prototype).X=function(){Mh.da.X.call(this)},Fm.Tl=function(){return this.i},Fm.bb=function(){return this.j},Fm.load=function(){0==this.state&&(this.state=1,_r(this),this.G(this,this.j),this.o(null,NaN,this.f))},Fm.di=function(t){this.g=t,this.state=2,_r(this)},Fm.hi=function(t){this.o=t};var Iv,Lv=gm&&function(){if(!gm)return!1;try{return new ActiveXObject("MSXML2.DOMDocument"),!0}catch(t){return!1}}();t:{if(!document.implementation||!document.implementation.createDocument){if(Lv){var Ov=new ActiveXObject("MSXML2.DOMDocument");if(Ov){Ov.resolveExternals=!1,Ov.validateOnParse=!1;try{Ov.setProperty("ProhibitDTD",!0),Ov.setProperty("MaxXMLSize",2048),Ov.setProperty("MaxElementDepth",256)}catch(t){}}if(Ov){Iv=Ov;break t}}throw Error("Your browser does not support creating new documents")}Iv=document.implementation.createDocument("","",null)}var Rv,Dv,kv,zv,Fv=Iv,Nv=document.implementation&&document.implementation.createDocument?function(t,e){return Fv.createElementNS(t,e)}:function(t,e){return Fv.createNode(1,e,t=t||"")},Uv=gm?function(t){var e=t.localName;return void 0!==e?e:t.baseName}:function(t){return t.localName},Bv=gm?function(t){return d(t)&&9==t.nodeType}:function(t){return t instanceof Document},jv=gm?function(t){return d(t)&&void 0!==t.nodeType}:function(t){return t instanceof Node},Zv=document.implementation&&document.implementation.createDocument?function(t,e,i){return t.getAttributeNS(e,i)||""}:function(t,e,i){var o="";return o=void 0!==(t=Gv(t,e,i))?t.nodeValue:o},Gv=document.implementation&&document.implementation.createDocument?function(t,e,i){return t.getAttributeNodeNS(e,i)}:function(t,e,i){for(var o,r=null,n=0,s=(t=t.attributes).length;n<s;++n)if((o=t[n]).namespaceURI==e&&(o.prefix?o.prefix+":"+i:i)==o.nodeName){r=o;break}return r},Vv=document.implementation&&document.implementation.createDocument?function(t,e,i,o){t.setAttributeNS(e,i,o)}:function(t,e,i,o){e?((e=t.ownerDocument.createNode(2,i,e)).nodeValue=o,t.setAttributeNode(e)):t.setAttribute(i,o)},Wv=Dh();function Hv(t,e){return this instanceof Hv?(this.df=Math.max(4,t||9),this.lg=Math.max(2,Math.ceil(.4*this.df)),e&&this.ij(e),void this.clear()):new Hv(t,e)}function qv(t,e){t.bbox=Yv(t,0,t.children.length,e)}function Yv(t,e,i,o){for(var r,n=[1/0,1/0,-1/0,-1/0];e<i;e++)r=t.children[e],Xv(n,t.Ga?o(r):r.bbox);return n}function Xv(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[2]),t[3]=Math.max(t[3],e[3])}function Kv(t,e){return t.bbox[0]-e.bbox[0]}function $v(t,e){return t.bbox[1]-e.bbox[1]}function Jv(t){return(t[2]-t[0])*(t[3]-t[1])}function Qv(t){return t[2]-t[0]+(t[3]-t[1])}function t0(t,e){return t[0]<=e[0]&&t[1]<=e[1]&&e[2]<=t[2]&&e[3]<=t[3]}function e0(t,e){return e[0]<=t[2]&&e[1]<=t[3]&&e[2]>=t[0]&&e[3]>=t[1]}function i0(t,e,i,o,r){for(var n,s=[e,i];s.length;)(i=s.pop())-(e=s.pop())<=o||(function t(e,i,o,r,n){for(var s,a,l,h,p;i<o;){for(600<o-i&&(s=o-i+1,a=r-i+1,l=Math.log(s),h=.5*Math.exp(2*l/3),p=.5*Math.sqrt(l*h*(s-h)/s)*(a-s/2<0?-1:1),l=Math.max(i,Math.floor(r-a*h/s+p)),a=Math.min(o,Math.floor(r+(s-a)*h/s+p)),t(e,l,a,r,n)),s=e[r],h=o,o0(e,a=i,r),0<n(e[o],s)&&o0(e,i,o);a<h;){for(o0(e,a,h),a++,h--;n(e[a],s)<0;)a++;for(;0<n(e[h],s);)h--}0===n(e[i],s)?o0(e,i,h):o0(e,++h,o),h<=r&&(i=h+1),r<=h&&(o=h-1)}}(t,e,i,n=e+Math.ceil((i-e)/o/2)*o,r),s.push(e,n,n,i))}function o0(t,e,i){var o=t[e];t[e]=t[i],t[i]=o}Pm={ka:{}},Hv.prototype={all:function(){return this.gg(this.data,[])},search:function(t){var e=this.data,i=[],o=this.hb;if(!e0(t,e.bbox))return i;for(var r,n,s,a,l=[];e;){for(r=0,n=e.children.length;r<n;r++)s=e.children[r],e0(t,a=e.Ga?o(s):s.bbox)&&(e.Ga?i.push(s):t0(t,a)?this.gg(s,i):l.push(s));e=l.pop()}return i},load:function(t){if(!t||!t.length)return this;if(t.length<this.lg){for(var e=0,i=t.length;e<i;e++)this.za(t[e]);return this}return t=this.ig(t.slice(),0,t.length-1,0),this.data.children.length?this.data.height===t.height?this.ng(this.data,t):(this.data.height<t.height&&(e=this.data,this.data=t,t=e),this.kg(t,this.data.height-t.height-1,!0)):this.data=t,this},za:function(t){return t&&this.kg(t,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:[1/0,1/0,-1/0,-1/0],Ga:!0},this},remove:function(t){if(!t)return this;for(var e,i,o,r,n=this.data,s=this.hb(t),a=[],l=[];n||a.length;){if(n||(n=a.pop(),i=a[a.length-1],e=l.pop(),r=!0),n.Ga&&-1!==(o=n.children.indexOf(t))){n.children.splice(o,1),a.push(n),this.gj(a);break}r||n.Ga||!t0(n.bbox,s)?i?(e++,n=i.children[e],r=!1):n=null:(a.push(n),l.push(e),n=(i=n).children[e=0])}return this},hb:function(t){return t},hf:function(t,e){return t[0]-e[0]},jf:function(t,e){return t[1]-e[1]},toJSON:function(){return this.data},gg:function(t,e){for(var i=[];t;)t.Ga?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},ig:function(t,e,i,o){var r=i-e+1,n=this.df;if(r<=n)return qv(h={children:t.slice(e,i+1),height:1,bbox:null,Ga:!0},this.hb),h;o||(o=Math.ceil(Math.log(r)/Math.log(n)),n=Math.ceil(r/Math.pow(n,o-1)));var s,a,l,h={children:[],height:o,bbox:null,Ga:!1};for(i0(t,e,i,n=(r=Math.ceil(r/n))*Math.ceil(Math.sqrt(n)),this.hf);e<=i;e+=n)for(i0(t,e,a=Math.min(e+n-1,i),r,this.jf),s=e;s<=a;s+=r)l=Math.min(s+r-1,a),h.children.push(this.ig(t,s,l,o-1));return qv(h,this.hb),h},fj:function(t,e,i,o){for(var r,n,s,a,l,h,p,c;o.push(e),!e.Ga&&o.length-1!==i;){for(p=c=1/0,r=0,n=e.children.length;r<n;r++)l=Jv((s=e.children[r]).bbox),h=s.bbox,(h=(Math.max(h[2],t[2])-Math.min(h[0],t[0]))*(Math.max(h[3],t[3])-Math.min(h[1],t[1]))-l)<c?(c=h,p=l<p?l:p,a=s):h===c&&l<p&&(p=l,a=s);e=a}return e},kg:function(t,e,i){var o=this.hb;i=i?t.bbox:o(t);var o=[],r=this.fj(i,this.data,e,o);for(r.children.push(t),Xv(r.bbox,i);0<=e&&o[e].children.length>this.df;)this.oj(o,e),e--;this.cj(i,o,e)},oj:function(t,e){var i=t[e],o=i.children.length,r=this.lg;this.dj(i,r,o),o=this.ej(i,r,o),o={children:i.children.splice(o,i.children.length-o),height:i.height,bbox:null,Ga:!1},i.Ga&&(o.Ga=!0),qv(i,this.hb),qv(o,this.hb),e?t[e-1].children.push(o):this.ng(i,o)},ng:function(t,e){this.data={children:[t,e],height:t.height+1,bbox:null,Ga:!1},qv(this.data,this.hb)},ej:function(t,e,i){for(var o,r,n,s,a,l=s=1/0,h=e;h<=i-e;h++)o=Yv(t,0,h,this.hb),r=Yv(t,h,i,this.hb),n=Math.max(0,Math.min(o[2],r[2])-Math.max(o[0],r[0]))*Math.max(0,Math.min(o[3],r[3])-Math.max(o[1],r[1])),o=Jv(o)+Jv(r),n<l?(l=n,a=h,s=o<s?o:s):n===l&&o<s&&(s=o,a=h);return a},dj:function(t,e,i){var o=t.Ga?this.hf:Kv,r=t.Ga?this.jf:$v;this.hg(t,e,i,o)<(e=this.hg(t,e,i,r))&&t.children.sort(o)},hg:function(t,e,i,o){t.children.sort(o);for(var r,n=Yv(t,0,e,o=this.hb),s=Yv(t,i-e,i,o),a=Qv(n)+Qv(s),l=e;l<i-e;l++)r=t.children[l],Xv(n,t.Ga?o(r):r.bbox),a+=Qv(n);for(l=i-e-1;e<=l;l--)r=t.children[l],Xv(s,t.Ga?o(r):r.bbox),a+=Qv(s);return a},cj:function(t,e,i){for(;0<=i;i--)Xv(e[i].bbox,t)},gj:function(t){for(var e,i=t.length-1;0<=i;i--)0===t[i].children.length?0<i?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():qv(t[i],this.hb)},ij:function(t){var e=["return a"," - b",";"];this.hf=new Function("a","b",e.join(t[0])),this.jf=new Function("a","b",e.join(t[1])),this.hb=new Function("a","return [a"+t.join(", a")+"];")}},void 0!==Pm?Pm.ka=Hv:"undefined"!=typeof self?self.a=Hv:window.a=Hv,Rv=Pm.ka,(Fm=Wh.prototype).za=function(t,e){t=[t[0],t[1],t[2],t[3],e];this.f.za(t),this.a[R(e)]=t},Fm.load=function(t,e){for(var i=Array(e.length),o=0,r=e.length;o<r;o++){var n=t[o],s=e[o],n=[n[0],n[1],n[2],n[3],s];i[o]=n,this.a[R(s)]=n}this.f.load(i)},Fm.remove=function(t){t=R(t);var e=this.a[t];return delete this.a[t],null!==this.f.remove(e)},Fm.forEach=function(t,e){return Kh(qh(this),t,e)},Fm.Na=function(){return tt(this.a)},Fm.clear=function(){this.f.clear(),this.a={}},Fm.J=function(){return this.f.data.bbox},i($h,vr),(Fm=$h.prototype).Dd=function(t){var e,i=R(t).toString();Qh(this,i,t)&&(Jh(this,i,t),(e=t.W())?(i=e.J(),this.a&&this.a.za(i,t)):this.g[i]=t,this.s(new ip("addfeature",t))),this.u()},Fm.Ic=function(t){tp(this,t),this.u()},Fm.clear=function(t){if(t){for(var e in this.o)this.o[e].forEach(It);this.c||(this.o={},this.j={},this.l={})}else t=this.Wh,this.a&&(this.a.forEach(t,this),X(this.g,t,this));this.c&&this.c.clear(),this.a&&this.a.clear(),this.Y.clear(),this.g={},this.s(new ip("clear")),this.u()},Fm.wg=function(t,e){return this.a?this.a.forEach(t,e):this.c?this.c.forEach(t,e):void 0},Fm.rb=function(t,e,i){return this.a?Xh(this.a,t,e,i):this.c?this.c.forEach(e,i):void 0},Fm.xg=function(e,i,o){return this.rb(e,function(t){return t.W().Fa(e)&&(t=i.call(o,t))?t:void 0})},Fm.Eg=function(){return this.c},Fm.Be=function(){var t;return this.c?t=this.c.a:this.a&&(t=qh(this.a),tt(this.g)||D(t,J(this.g))),t},Fm.Dg=function(t){var e,i,o=[];return e=t,i=function(t){o.push(t)},this.rb([e[0],e[1],e[0],e[1]],function(t){return t.W().sg(e)?i.call(void 0,t):void 0}),o},Fm.pf=function(t){return Yh(this.a,t)},Fm.zg=function(t){var o=t[0],r=t[1],n=null,s=[NaN,NaN],a=1/0,l=[-1/0,-1/0,1/0,1/0];return Xh(this.a,l,function(t){var e=t.W(),i=a;(a=e.pb(o,r,s,a))<i&&(n=t,t=Math.sqrt(a),l[0]=o-t,l[1]=r-t,l[2]=o+t,l[3]=r+t)}),n},Fm.J=function(){return this.a.J()},Fm.Cg=function(t){return void 0!==(t=this.j[t.toString()])?t:null},Fm.zh=function(t){var e=R(t=t.target).toString(),i=t.W();i?(i=i.J(),e in this.g?(delete this.g[e],this.a&&this.a.za(i,t)):this.a&&Hh(this.a,i,t)):e in this.g||(this.a&&this.a.remove(t),this.g[e]=t),void 0!==(i=t.Qa())?(i=i.toString(),e in this.l?(delete this.l[e],this.j[i]=t):this.j[i]!==t&&(ep(this,t),this.j[i]=t)):e in this.l||(ep(this,t),this.l[e]=t),this.u(),this.s(new ip("changefeature",t))},Fm.Na=function(){return this.a.Na()&&tt(this.g)},Fm.Oc=function(t,e,i){for(var o=this.Y,r=0,n=(t=this.na(t,e)).length;r<n;++r){var s=t[r];Xh(o,s,function(t){return Pe(t.extent,s)})||(this.T.call(this,s,e,i),o.za(s,{extent:s.slice()}))}},Fm.Sc=function(t){var e=R(t).toString();e in this.g?delete this.g[e]:this.a&&this.a.remove(t),this.Wh(t),this.u()},Fm.Wh=function(t){var e=R(t).toString();this.o[e].forEach(It),delete this.o[e];var i=t.Qa();void 0!==i?delete this.j[i.toString()]:delete this.l[e],this.s(new ip("removefeature",t))},i(ip,ct),i(op,Ul),(Fm=op.prototype).zj=function(t,n,s,e,i){var a=new xl(.5*n/s,t,n);this.c.Oc(t,n,i);var o,l=!1;return this.c.rb(t,function(t){var e;if(!(o=l))if((o=t.cc())?e=o.call(t,n):this.o&&(e=this.o(t,n)),e){for(var i=!1,o=0,r=e.length;o<r;++o)i=Sl(a,t,e[o],El(n,s),this.Vm,this)||i;o=i}else o=!1;l=o},this),wl(a),l?null:(this.j[0]!=e[0]||this.j[1]!=e[1]?(this.g.canvas.width=e[0],this.g.canvas.height=e[1],this.j[0]=e[0],this.j[1]=e[1]):this.g.clearRect(0,0,e[0],e[1]),o=this,i=Ue(t),t=Qn(o.xa,e[0]/2,e[1]/2,s/n,-s/n,0,-i[0],-i[1]),a.f(this.g,s,t,0,{}),this.v=a,this.g.canvas)},Fm.Ae=function(t,e,i,o,r){if(this.v){var n={};return this.v.c(t,e,0,o,function(t){var e=R(t).toString();return e in n?void 0:(n[e]=!0,r(t))})}},Fm.Sm=function(){return this.c},Fm.Tm=function(){return this.T},Fm.Um=function(){return this.o},Fm.Vm=function(){this.u()},Fm.Wm=function(){br(this,this.c.B)},Fm.vh=function(t){this.T=void 0!==t?t:Ga,this.o=t?Za(this.T):void 0,this.u()},i(rp,ol),(Fm=rp.prototype).cb=function(t,e,i,o){var r=this.a;return r.ea().Ae(t,e.viewState.resolution,e.viewState.rotation,e.skippedFeatureUids,function(t){return i.call(o,t,r)})},Fm.zc=function(t,e,i,o){if(this.Bd())if(this.a.ea()instanceof op){if(t=t.slice(),es(e.pixelToCoordinateMatrix,t,t),this.cb(t,e,Bm,this))return i.call(o,this.a)}else if(this.c||(this.c=le(),fe(this.i,this.c)),e=sl(t,this.c),this.b||(this.b=bn(1,1)),this.b.clearRect(0,0,1,1),this.b.drawImage(this.Bd(),e[0],e[1],1,1,0,0,1,1),0<this.b.getImageData(0,0,1,1).data[3])return i.call(o,this.a)},Fm.Bd=function(){return this.g?this.g.a():null},Fm.qf=function(){return this.i},Fm.Cd=function(t,e){var i=t.pixelRatio,o=t.viewState,r=o.center,n=o.resolution,s=o.rotation,a=this.a.ea(),l=t.viewHints,h=t.extent;return void 0!==e.extent&&(h=Ze(h,e.extent)),l[0]||l[1]||qe(h)||(o=a.C(h,n,i,o.projection))&&os(this,o)&&(this.g=o),this.g&&(l=(o=this.g).J(),h=o.$(),e=o.b,Qn(this.i,i*t.size[0]/2,i*t.size[1]/2,n=i*h/(n*e),n,s,e*(l[0]-r[0])/h,e*(r[1]-l[3])/h),this.c=null,ss(t.attributions,o.i),as(t,a)),!0},i(np,ol),np.prototype.Bd=function(){return this.i},np.prototype.qf=function(){return this.B},np.prototype.Cd=function(t,e){function i(t){return 2==(t=t.state)||4==t||3==t&&!T}var o=t.pixelRatio,r=t.viewState,n=r.projection,s=this.a,a=s.ea(),l=a.kb(n),h=a.ce(),p=Ar(l,r.resolution),c=kr(a,p,t.pixelRatio,n),u=c[0]/Yt(l.Ma(p),this.U)[0],d=l.$(p),u=d/u,f=r.center,g=d==r.resolution?Be(f=hs(f,d,t.size),d,r.rotation,t.size):t.extent;if(qe(g=void 0!==e.extent?Ze(g,e.extent):g))return!1;var y,m,_,v,b=Pr(l,g,d),x=c[0]*mo(b),w=c[1]*yo(b);this.i?(y=this.i,m=this.j,this.b[0]<x||this.b[1]<w||this.D!==c[0]||this.C!==c[1]||this.o&&(this.b[0]>x||this.b[1]>w)?(y.width=x,y.height=w,this.b=[x,w],this.o=!sv(this.b),this.c=null):(x=this.b[0],w=this.b[1],p==this.v&&(_=this.c,e=b,_.a<=e.a&&e.c<=_.c&&_.f<=e.f&&e.b<=_.b)||(this.c=null))):(m=bn(x,w),this.i=m.canvas,this.b=[x,w],this.j=m,this.o=!sv(this.b)),this.c?x=mo(w=this.c):(x/=c[0],w/=c[1],v=b.a-Math.floor((x-mo(b))/2),I=b.f-Math.floor((w-yo(b))/2),this.v=p,this.D=c[0],this.C=c[1],this.c=new fo(v,v+x-1,I,I+w-1),this.l=Array(x*w),w=this.c),(y={})[p]={};for(var M,P,E=[],S=this.ed(a,n,y),T=s.b(),A=Te(),C=new fo(0,0,0,0),I=b.a;I<=b.c;++I)for(P=b.f;P<=b.b;++P)!i(M=a.Qb(p,I,P,o,n))&&M.a&&(M=M.a),i(M)?y[p][M.ga.toString()]=M:(U=wr(l,M.ga,S,C,A))||(E.push(M),(U=Mr(l,M.ga,C,A))&&S(p+1,U));for(S=0,U=E.length;S<U;++S)M=E[S],I=c[0]*(M.ga[1]-w.a),P=c[1]*(w.b-M.ga[2]),m.clearRect(I,P,c[0],c[1]);(E=Object.keys(y).map(Number)).sort(Z);for(var L,O,R,D,k,z,F=a.tf(n),N=Ge(l.Ba([p,w.a,w.b],A)),S=0,U=E.length;S<U;++S)if(c=kr(a,L=E[S],o,n),D=y[L],L==p)for(O in D)M=D[O],v=(M.ga[2]-w.f)*x+(M.ga[1]-w.a),this.l[v]!=M&&(I=c[0]*(M.ga[1]-w.a),P=c[1]*(w.b-M.ga[2]),R=M.state,4!=R&&(3!=R||T)&&F||m.clearRect(I,P,c[0],c[1]),2==R&&m.drawImage(M.Ua(),h,h,c[0],c[1],I,P,c[0],c[1]),this.l[v]=M);else for(O in L=l.$(L)/d,D)for(M=D[O],v=l.Ba(M.ga,A),I=(v[0]-N[0])/u,P=(N[1]-v[3])/u,z=L*c[0],k=L*c[1],R=M.state,4!=R&&F||m.clearRect(I,P,z,k),2==R&&m.drawImage(M.Ua(),h,h,c[0],c[1],I,P,z,k),M=Er(l,v,p,C),v=Math.max(M.a,w.a),P=Math.min(M.c,w.c),I=Math.max(M.f,w.f),M=Math.min(M.b,w.b),R=v;R<=P;++R)for(k=I;k<=M;++k)v=(k-w.f)*x+(R-w.a),this.l[v]=void 0;return ls(t.usedTiles,a,p,b),ps(t,a,l,o,n,g,p,s.a()),ns(t,a),as(t,a),Qn(this.B,o*t.size[0]/2,o*t.size[1]/2,o*u/r.resolution,o*u/r.resolution,r.rotation,(N[0]-f[0])/u,(f[1]-N[1])/u),!(this.g=null)},np.prototype.zc=function(t,e,i,o){return this.j&&(this.g||(this.g=le(),fe(this.B,this.g)),t=sl(t,this.g),0<this.j.getImageData(t[0],t[1],1,1).data[3])?i.call(o,this.a):void 0},i(sp,ol),sp.prototype.G=function(t,e,i){var o=t.extent,r=t.pixelRatio,n=e.Db?t.skippedFeatureUids:{},s=(a=t.viewState).projection,a=a.rotation,l=s.J(),h=this.a.ea(),p=nl(this,t,0);rl(this,"precompose",i,t,p);var c=this.b;if(c&&!c.Na()){var u=Ut(this.a,"render")?(this.g.canvas.width=i.canvas.width,this.g.canvas.height=i.canvas.height,this.g):i,d=u.globalAlpha;if(u.globalAlpha=e.opacity,c.f(u,r,p,a,n),h.O&&s.f&&!Pe(l,o)){for(e=o[0],s=We(l),h=0;e<l[0];)p=nl(this,t,p=s*--h),c.f(u,r,p,a,n),e+=s;for(h=0,e=o[2];e>l[2];)p=nl(this,t,p=s*++h),c.f(u,r,p,a,n),e-=s;p=nl(this,t,0)}u!=i&&(rl(this,"render",u,t,p),i.drawImage(u.canvas,0,0)),u.globalAlpha=d}rl(this,"postcompose",i,t,p)},sp.prototype.cb=function(t,e,i,o){if(this.b){var r=e.viewState.resolution,n=e.viewState.rotation,s=this.a,a=e.layerStates[R(s)],l={};return this.b.c(t,r,n,a.Db?e.skippedFeatureUids:{},function(t){var e=R(t).toString();return e in l?void 0:(l[e]=!0,i.call(o,t,s))})}},sp.prototype.B=function(){rs(this)},sp.prototype.Cd=function(t){function e(t){var e,i=t.cc();if(i?e=i.call(t,h):(i=n.b)&&(e=i(t,h)),e){if(e){if(i=!1,w(e))for(var o=0,r=e.length;o<r;++o)i=Sl(d,t,e[o],El(h,p),this.B,this)||i;else i=Sl(d,t,e,El(h,p),this.B,this)||i;t=i}else t=!1;this.c=this.c||t}}var n=this.a,i=n.ea();ss(t.attributions,i.i),as(t,i);var o=t.viewHints[0],r=t.viewHints[1],s=n.j,a=n.l;if(!this.c&&!s&&o||!a&&r)return!0;var l=t.extent,o=(a=t.viewState).projection,h=a.resolution,p=t.pixelRatio,r=n.f,c=n.a;if(void 0===(s=qa(n))&&(s=Pl),l=be(l,c*h),c=a.projection.J(),i.O&&a.projection.f&&!Pe(c,t.extent)&&(t=Math.max(We(l)/2,We(c)),l[0]=c[0]-t,l[2]=c[2]+t),!this.c&&this.l==h&&this.o==r&&this.j==s&&Pe(this.i,l))return!0;pt(this.b),this.b=null,this.c=!1;var u,d=new xl(.5*h/p,l,h,n.a);return i.Oc(l,h,o),s?(u=[],i.rb(l,function(t){u.push(t)},this),u.sort(s),u.forEach(e,this)):i.rb(l,e,this),wl(d),this.l=h,this.o=r,this.j=s,this.i=l,this.b=d,!0},i(cp,Rr),(Fm=cp.prototype).Za=function(){return this.tileLoadFunction},Fm.$a=function(){return this.tileUrlFunction},Fm.ab=function(){return this.urls},Fm.yh=function(t){switch((t=t.target).state){case 1:this.s(new Fr("tileloadstart",t));break;case 2:this.s(new Fr("tileloadend",t));break;case 3:this.s(new Fr("tileloaderror",t))}},Fm.gb=function(t){this.a.clear(),this.tileLoadFunction=t,this.u()},Fm.La=function(t){this.a.clear(),this.tileUrlFunction=t,this.u()},Fm.Wa=function(t){this.urls=[t],t=pp(t),this.La(this.ae||ap(t,this.tileGrid))},Fm.Xa=function(t){this.urls=t,this.La(this.ae||ap(t,this.tileGrid))},Fm.bg=function(t,e,i){t=this.Cb(t,e,i),dr(this.a,t)&&this.a.get(t)},i(up,cp),up.prototype.Qb=function(t,e,i,o,r){var n=this.Cb(t,e,i);return dr(this.a,n)?this.a.get(n):(o=(e=zr(this,t=[t,e,i],r))?this.tileUrlFunction(e,o,r):void 0,St(r=new this.tileClass(t,void 0!==o?0:4,void 0!==o?o:"",this.c,this.tileLoadFunction,r),"change",this.yh,!1,this),this.a.set(n,r),r)},i(fp,ol),fp.prototype.G=function(t,e,i){var o=t.pixelRatio,r=e.Db?t.skippedFeatureUids:{},n=(l=t.viewState).center,s=l.projection,a=l.resolution,l=l.rotation,h=t.size,p=o/a,c=this.a,u=c.ea(),d=u.vc(o),f=d/o,g=nl(this,t,0);rl(this,"precompose",i,t,g);var y=(c=Ut(c,"render")?(this.g.canvas.width=i.canvas.width,this.g.canvas.height=i.canvas.height,this.g):i).globalAlpha;c.globalAlpha=e.opacity,e=this.i;for(var m,_,v,b,x,w,M,P,E,S,T,A=u.tileGrid,C=0,I=e.length;C<I;++C)v=(E=e[C]).b,w=A.Ba(E.ga,this.j),m=E.ga[0],_=Yt(A.Ma(m),this.o),M="tile-pixels"==E.f.a,S=(b=A.$(m))/d,P=b/a,b=Math.round(o*h[0]/2),x=Math.round(o*h[1]/2),T=_[0]*o*P,_=_[1]*o*P,T<1||f<P?(S=M?(w=Ge(w),Qn(this.c,b,x,p*S,p*S,l,(w[0]-n[0])/S,(n[1]-w[1])/S)):g,v.Wc.f(c,o,S,l,r)):(m=kr(u,m,o,s),S=M?Qn(this.c,0,0,p*S,p*S,l,-m[0]/2,-m[1]/2):(S=Ue(w),Qn(this.c,0,0,p,-p,-l,-S[0],-S[1])),E=E.l,v.resolution===a&&v.rotation===l||(v.resolution=a,v.rotation=l,E.canvas.width=.5+T,E.canvas.height=.5+_,E.translate(T/2,_/2),E.rotate(-l),v.Wc.f(E,o,S,l,r,!1)),v=Qn(this.c,0,0,p,-p,0,-n[0],-n[1]),v=yi(Ge(w),0,1,2,v),c.translate(b,x),c.rotate(l),c.drawImage(E.canvas,Math.round(v[0]),Math.round(v[1])),c.rotate(-l),c.translate(-b,-x));c!=i&&(rl(this,"render",c,t,g),i.drawImage(c.canvas,0,0)),c.globalAlpha=y,rl(this,"postcompose",i,t,g)},fp.prototype.cb=function(t,e,i,o){for(var r,n,s,a,l=e.pixelRatio,h=e.viewState.resolution,p=e.viewState.rotation,c=this.a,u=e.layerStates[R(c)],d={},f=this.i,g=c.ea(),y=g.tileGrid,m=0,_=f.length;m<_;++m)n=(a=f[m]).ga,Me(s=g.tileGrid.Ba(n,this.j),t)&&(n="tile-pixels"===a.f.a?(s=Ge(s),h=g.vc(l),n=y.$(n[0])/h,[(t[0]-s[0])/n,(s[1]-t[1])/n]):t,a=a.b.Wc,r=r||a.c(n,h,p,u.Db?e.skippedFeatureUids:{},function(t){var e=R(t).toString();return e in d?void 0:(d[e]=!0,i.call(o,t,c))}));return r},fp.prototype.l=function(){rs(this)},fp.prototype.Cd=function(t,e){var i=this.a,o=i.ea();ss(t.attributions,o.i),as(t,o);var r=t.viewHints[0],n=t.viewHints[1],s=i.j,a=i.l;if(!this.b&&!s&&r||!a&&n)return!0;if(n=t.extent,qe(n=e.extent?Ze(n,e.extent):n))return!1;for(var s=(r=t.viewState).projection,a=r.resolution,r=t.pixelRatio,l=(_=o.tileGrid).a,h=l.length-1;0<h&&l[h]<a;)--h;l=Er(_,n,h),ls(t.usedTiles,o,h,l),ps(t,o,_,r,s,n,h,i.g()),ns(t,o),(n={})[h]={};for(var p,c,u=this.ed(o,s,n),d=i.U(),f=this.j,g=new fo(0,0,0,0),y=l.a;y<=l.c;++y)for(c=l.f;c<=l.b;++c)2==(p=(a=o.Qb(h,y,c,r,s)).state)||4==p||3==p&&!d?n[h][a.ga.toString()]=a:(p=wr(_,a.ga,u,g,f))||(a=Mr(_,a.ga,g,f))&&u(h+1,a);this.b=!1,(o=Object.keys(n).map(Number)).sort(Z);for(var m,s=[],_=0,h=o.length;_<h;++_)for(m in l=n[a=o[_]])a=l[m],2==a.state&&(s.push(a),gp(this,a,i,r));return this.i=s,!0},i(yp,ys),yp.prototype.kf=function(t){return t instanceof La?new rp(t):t instanceof Oa?new np(t):t instanceof Ya?new fp(t):t instanceof Ha?new sp(t):null},yp.prototype.V=function(){return"canvas"},yp.prototype.Pe=function(t){if(t){var e=this.b,i=t.size[0]*t.pixelRatio,o=t.size[1]*t.pixelRatio;this.a.width!=i||this.a.height!=o?(this.a.width=i,this.a.height=o):e.clearRect(0,0,this.a.width,this.a.height),ms(t),mp(this,"precompose",t),z(i=t.layerStatesArray);for(var r,n,o=t.viewState.resolution,s=0,a=i.length;s<a;++s)r=vs(this,r=(n=i[s]).layer),Kn(n,o)&&"ready"==n.O&&r.Cd(t,n)&&r.G(t,n,e);mp(this,"postcompose",t),this.f||(rr(this.a,!0),this.f=!0),bs(this,t),t.postRenderFunctions.push(_s)}else this.f&&(rr(this.a,!1),this.f=!1)},i(_p,is),_p.prototype.g=s,_p.prototype.l=s,i(vp,_p),vp.prototype.cb=function(t,e,i,o){var r=this.a;return r.ea().Ae(t,e.viewState.resolution,e.viewState.rotation,e.skippedFeatureUids,function(t){return i.call(o,t,r)})},vp.prototype.g=function(){Ro(this.target),this.b=null},vp.prototype.i=function(t,e){var i=t.viewState,o=i.center,r=i.resolution,n=i.rotation,s=this.b,a=this.a.ea(),l=t.viewHints,h=t.extent;return void 0!==e.extent&&(h=Ze(h,e.extent)),l[0]||l[1]||qe(h)||(i=a.C(h,r,t.pixelRatio,i.projection))&&os(this,i)&&(s=i),s&&(l=s.J(),h=s.$(),Qn(i=le(),t.size[0]/2,t.size[1]/2,h/r,h/r,n,(l[0]-o[0])/h,(o[1]-l[3])/h),s!=this.b&&((o=s.a(this)).style.maxWidth="none",o.style.position="absolute",Ro(this.target),this.target.appendChild(o),this.b=s),ts(i,this.c)||(wn(this.target,i),ce(this.c,i)),ss(t.attributions,s.i),as(t,a)),!0},i(bp,_p),bp.prototype.g=function(){Ro(this.target),this.j=0},bp.prototype.i=function(t,e){if(!e.visible)return this.c&&(rr(this.target,!1),this.c=!1),!0;var i=t.pixelRatio,o=t.viewState,r=o.projection,n=this.a,s=n.ea(),a=s.kb(r),l=s.ce(),h=Ar(a,o.resolution),p=a.$(h),c=o.center,u=p==o.resolution?Be(c=hs(c,p,t.size),p,o.rotation,t.size):t.extent,p=Pr(a,u=void 0!==e.extent?Ze(u,e.extent):u,p),d={};d[h]={};for(var f,g,y=this.ed(s,r,d),m=n.b(),_=Te(),v=new fo(0,0,0,0),b=p.a;b<=p.c;++b)for(f=p.f;f<=p.b;++f)2==(w=(T=!(w=2==(w=(T=s.Qb(h,b,f,i,r)).state)||4==w||3==w&&!m)&&T.a?T.a:T).state)?d[h][T.ga.toString()]=T:4==w||3==w&&!m||((w=wr(a,T.ga,y,v,_))||(T=Mr(a,T.ga,v,_))&&y(h+1,T));if(this.j!=s.f){for(g in this.b)m=this.b[+g],ko(m.target);this.b={},this.j=s.f}(_=Object.keys(d).map(Number)).sort(Z);var x,y={};for(b=0,f=_.length;b<f;++b){for(x in(g=_[b])in this.b?m=this.b[g]:(m=a.ie(c,g),m=new xp(a,m),y[g]=!0,this.b[g]=m),g=d[g]){var w,M,P,E,S,T=m,A=l,C=(w=g[x]).ga,I=C[0],L=C[1],O=C[2];(C=C.toString())in T.f||(I=Yt(T.g.Ma(I),T.l),(P=(M=w.Ua(T)).style).maxWidth="none",S=E=void 0,0<A?((S=(E=document.createElement("DIV")).style).overflow="hidden",S.width=I[0]+"px",S.height=I[1]+"px",P.position="absolute",P.left=-A+"px",P.top=-A+"px",P.width=I[0]+2*A+"px",P.height=I[1]+2*A+"px",E.appendChild(M)):(P.width=I[0]+"px",P.height=I[1]+"px",E=M,S=P),S.position="absolute",S.left=(L-T.b[1])*I[0]+"px",S.top=(T.b[2]-O)*I[1]+"px",T.a||(T.a=document.createDocumentFragment()),T.a.appendChild(E),T.f[C]=w)}m.a&&(m.target.appendChild(m.a),m.a=null)}for((l=Object.keys(this.b).map(Number)).sort(Z),b=le(),x=0,_=l.length;x<_;++x)if(g=l[x],m=this.b[g],g in d){if(T=m.$(),f=m.Ea(),Qn(b,t.size[0]/2,t.size[1]/2,T/o.resolution,T/o.resolution,o.rotation,(f[0]-c[0])/T,(c[1]-f[1])/T),m.setTransform(b),g in y){for(--g;0<=g;--g)if(g in this.b){(f=this.b[g].target).parentNode&&f.parentNode.insertBefore(m.target,f.nextSibling);break}g<0&&Do(this.target,m.target,0)}else if(!t.viewHints[0]&&!t.viewHints[1]){for(T in w=Er(m.g,u,m.b[0],v),g=[],T=f=void 0,m.f)f=m.f[T],w.contains(f.ga)||g.push(f);for(A=w=void 0,w=0,A=g.length;w<A;++w)T=(f=g[w]).ga.toString(),ko(f.Ua(m)),delete m.f[T]}}else ko(m.target),delete this.b[g];return e.opacity!=this.o&&(this.o=this.target.style.opacity=e.opacity),e.visible&&!this.c&&(rr(this.target,!0),this.c=!0),ls(t.usedTiles,s,h,p),ps(t,s,a,i,r,u,h,n.a()),ns(t,s),as(t,s),!0},xp.prototype.Ea=function(){return this.i},xp.prototype.$=function(){return this.j},xp.prototype.setTransform=function(t){ts(t,this.c)||(wn(this.target,t),ce(this.c,t))},i(wp,_p),wp.prototype.l=function(t,e){var i=(n=t.viewState).center,o=n.rotation,r=n.resolution,n=t.pixelRatio,s=t.size[0],a=t.size[1],l=s*n,h=a*n,i=Qn(this.O,n*s/2,n*a/2,n/r,-n/r,-o,-i[0],-i[1]);(r=this.j).canvas.width=l,r.canvas.height=h,s=Qn(this.D,0,0,1/n,1/n,0,-(l-s)/2*n,-(h-a)/2*n),wn(r.canvas,s),Mp(this,"precompose",t,i),(s=this.b)&&!s.Na()&&(r.globalAlpha=e.opacity,s.f(r,n,i,o,e.Db?t.skippedFeatureUids:{}),Mp(this,"render",t,i)),Mp(this,"postcompose",t,i)},wp.prototype.cb=function(t,e,i,o){if(this.b){var r=e.viewState.resolution,n=e.viewState.rotation,s=this.a,a=e.layerStates[R(s)],l={};return this.b.c(t,r,n,a.Db?e.skippedFeatureUids:{},function(t){var e=R(t).toString();return e in l?void 0:(l[e]=!0,i.call(o,t,s))})}},wp.prototype.C=function(){rs(this)},wp.prototype.i=function(t){function e(t){var e,i=t.cc();if(i?e=i.call(t,l):(i=n.b)&&(e=i(t,l)),e){if(e){if(i=!1,w(e))for(var o=0,r=e.length;o<r;++o)i=Sl(c,t,e[o],El(l,h),this.C,this)||i;else i=Sl(c,t,e,El(l,h),this.C,this)||i;t=i}else t=!1;this.c=this.c||t}}var n=this.a,i=n.ea();ss(t.attributions,i.i),as(t,i);var o=t.viewHints[0],r=t.viewHints[1],s=n.j,a=n.l;if(!this.c&&!s&&o||!a&&r)return!0;var r=t.extent,o=(s=t.viewState).projection,l=s.resolution,h=t.pixelRatio;if(t=n.f,a=n.a,void 0===(s=qa(n))&&(s=Pl),r=be(r,a*l),!this.c&&this.B==l&&this.v==t&&this.G==s&&Pe(this.o,r))return!0;pt(this.b),this.b=null,this.c=!1;var p,c=new xl(.5*l/h,r,l,n.a);return i.Oc(r,l,o),s?(p=[],i.rb(r,function(t){p.push(t)},this),p.sort(s),p.forEach(e,this)):i.rb(r,e,this),wl(c),this.B=l,this.v=t,this.G=s,this.o=r,this.b=c,!0},i(Pp,ys),Pp.prototype.X=function(){ko(this.a),Pp.da.X.call(this)},Pp.prototype.kf=function(t){if(t instanceof La)t=new vp(t);else if(t instanceof Oa)t=new bp(t);else{if(!(t instanceof Ha))return null;t=new wp(t)}return t},Pp.prototype.V=function(){return"dom"},Pp.prototype.Pe=function(t){if(t){(Ut(a=this.i,"precompose")||Ut(a,"postcompose"))&&(a=this.b.canvas,o=t.pixelRatio,a.width=t.size[0]*o,a.height=t.size[1]*o),Ep(this,"precompose",t),z(a=t.layerStatesArray);for(var e,i,o=t.viewState.resolution,r=0,n=a.length;r<n;++r)e=vs(this,e=(i=a[r]).layer),Do(this.a,e.target,r),Kn(i,o)&&"ready"==i.O?e.i(t,i)&&e.l(t,i):e.g();var s,a=t.layerStates;for(s in this.c)s in a||(e=this.c[s],ko(e.target));this.f||(rr(this.a,!0),this.f=!0),ms(t),bs(this,t),t.postRenderFunctions.push(_s),Ep(this,"postcompose",t)}else this.f&&(rr(this.a,!1),this.f=!1)},i(Tp,Sp),Tp.prototype.V=function(){return 35632},i(Ap,Sp),Ap.prototype.V=function(){return 35633},i(Cp,Tp),e(Cp),i(Ip,Ap),e(Ip),(Fm=Rp.prototype).X=function(){var e=this.a;e.isContextLost()||(X(this.f,function(t){e.deleteBuffer(t.buffer)}),X(this.g,function(t){e.deleteProgram(t)}),X(this.i,function(t){e.deleteShader(t)}),e.deleteFramebuffer(this.c),e.deleteRenderbuffer(this.l),e.deleteTexture(this.o))},Fm.On=function(){return this.a},Fm.Pn=function(){et(this.f),et(this.i),et(this.g),this.l=this.o=this.c=this.j=null},Fm.Qn=function(){},Fm.Je=function(t){return t!=this.j&&(this.a.useProgram(t),this.j=t,!0)},i(Zp,qn),Zp.prototype.Ib=function(t,e){this.b.push(this.f.length),this.G.push(e);e=t.ja();Vp(this,e,e.length,t.sa())},Zp.prototype.Jb=function(t,e){this.b.push(this.f.length),this.G.push(e);e=t.ja();Vp(this,e,e.length,t.sa())},Zp.prototype.wb=function(t){var e=t.Yb(),i=t.hc(1),o=t.td(),r=t.Ce(1),n=t.B,s=t.Ea(),a=t.C,l=t.G,h=t.Eb();t=t.j,0===this.g.length?this.g.push(i):R(this.g[this.g.length-1])!=R(i)&&(this.v.push(this.f.length),this.g.push(i)),0===this.c.length?this.c.push(r):R(this.c[this.c.length-1])!=R(r)&&(this.i.push(this.f.length),this.c.push(r)),this.C=e[0],this.D=e[1],this.pa=h[1],this.wa=o[1],this.U=o[0],this.T=n,this.Y=s[0],this.ha=s[1],this.qa=l,this.ia=a,this.ib=t,this.na=h[0]},Xp.prototype.a=function(t,e){var i=this.b[e];return void 0===i&&(i=new r0[e](this.j,this.i),this.b[e]=i),i},Xp.prototype.Na=function(){return tt(this.b)},Xp.prototype.f=function(t,e,i,o,r,n,s,a){var l,h;for(n=0,l=av.length;n<l;++n)void 0!==(h=this.b[av[n]])&&qp(h,t,e,i,o,r,s,a,void 0,!1)},Xp.prototype.c=function(t,e,i,o,r,n,s,a,l,h){var p,c=e.a;return c.bindFramebuffer(c.FRAMEBUFFER,zp(e)),$p(this,e,t,o,r,a,l,function(t){var e=new Uint8Array(4);return c.readPixels(0,0,1,1,c.RGBA,c.UNSIGNED_BYTE,e),0<e[3]&&(t=h(t))?t:void 0},!0,p=void 0!==this.g?be(Ce(t),o*this.g):p)};var r0={Image:Zp},n0=[1,1];i(Jp,qn),(Fm=Jp.prototype).pd=function(t,e){var i=t.toString(),t=this.a[i];void 0!==t?t.push(e):this.a[i]=[e]},Fm.Jc=function(){},Fm.lf=function(t,i){var o=i.c(t);o&&He(this.c,o.J())&&(t=i.a,this.pd(t=void 0===t?0:t,function(t){t.eb(i.g,i.b),t.wb(i.f),t.fb(i.Da());var e=s0[o.V()];e&&e.call(t,o,null)}))},Fm.Zd=function(t,e){for(var i=t.c,o=0,r=i.length;o<r;++o){var n=i[o],s=s0[n.V()];s&&s.call(this,n,e)}},Fm.Jb=function(t,e){var i=this.f,o=new Xp(1,this.c).a(0,"Image");o.wb(this.b),o.Jb(t,e),Wp(o,i),qp(o,this.f,this.g,this.i,this.j,this.l,1,{},void 0,!1),Gp(o,i)()},Fm.Xb=function(){},Fm.Kc=function(){},Fm.Ib=function(t,e){var i=this.f,o=new Xp(1,this.c).a(0,"Image");o.wb(this.b),o.Ib(t,e),Wp(o,i),qp(o,this.f,this.g,this.i,this.j,this.l,1,{},void 0,!1),Gp(o,i)()},Fm.Lc=function(){},Fm.Mc=function(){},Fm.Kb=function(){},Fm.eb=function(){},Fm.wb=function(t){this.b=t},Fm.fb=function(){};var s0={Point:Jp.prototype.Jb,MultiPoint:Jp.prototype.Ib,GeometryCollection:Jp.prototype.Zd};i(Qp,Tp),e(Qp),i(tc,Ap),e(tc),i(ic,is),ic.prototype.th=function(t,e,i){oc(this,"precompose",i,t),Dp(i,34962,this.U);var o=i.a,r=Qp.Zb(),n=tc.Zb(),r=Np(i,r,n);this.G?n=this.G:this.G=n=new ec(o,r),i.Je(r)&&(o.enableVertexAttribArray(n.a),o.vertexAttribPointer(n.a,2,5126,!1,16,0),o.enableVertexAttribArray(n.f),o.vertexAttribPointer(n.f,2,5126,!1,16,8),o.uniform1i(n.g,0)),o.uniformMatrix4fv(n.i,!1,this.o),o.uniformMatrix4fv(n.c,!1,this.B),o.uniform1f(n.b,e.opacity),o.bindTexture(3553,this.ob),o.drawArrays(5,0,4),oc(this,"postcompose",i,t)},ic.prototype.Gf=function(){this.g=this.ob=null,this.i=void 0},i(rc,ic),rc.prototype.cb=function(t,e,i,o){var r=this.a;return r.ea().Ae(t,e.viewState.resolution,e.viewState.rotation,e.skippedFeatureUids,function(t){return i.call(o,t,r)})},rc.prototype.Hf=function(t,e){var i,o,r=this.b.b,n=t.pixelRatio,s=t.viewState,a=s.center,l=s.resolution,h=s.rotation,p=this.c,c=this.ob,u=this.a.ea(),d=t.viewHints,f=t.extent;return void 0!==e.extent&&(f=Ze(f,e.extent)),d[0]||d[1]||qe(f)||(s=u.C(f,l,n,s.projection))&&os(this,s)&&(i=this,o=p=s,o=s.a(),c=jp(i.b.b,o),this.ob&&t.postRenderFunctions.push(j(function(t,e){t.isContextLost()||t.deleteTexture(e)},r,this.ob))),p&&(r=this.b.g.G,f=this,s=r.width,i=r.height,o=n,r=a,a=l,l=h,h=p.J(),s*=a,i*=a,ue(f=f.B),ye(f,2*o/s,2*o/i),me(f,-l),ge(f,h[0]-r[0],h[1]-r[1]),ye(f,(h[2]-h[0])/2,(h[3]-h[1])/2),ge(f,1,1),this.l=null,ue(n=this.o),ye(n,1,-1),ge(n,0,-1),this.c=p,this.ob=c,ss(t.attributions,p.i),as(t,u)),!0},rc.prototype.ze=function(t,e){return void 0!==this.cb(t,e,Bm,this)},rc.prototype.zc=function(t,e,i,o){if(this.c&&this.c.a())if(this.a.ea()instanceof op){if(t=t.slice(),es(e.pixelToCoordinateMatrix,t,t),this.cb(t,e,Bm,this))return i.call(o,this.a)}else{var r,n,s=[this.c.a().width,this.c.a().height];if(this.l||(n=e.size,ue(e=le()),ge(e,-1,-1),ye(e,2/n[0],2/n[1]),ge(e,0,n[1]),ye(e,1,-1),n=le(),fe(this.B,n),ue(r=le()),ge(r,0,s[1]),ye(r,1,-1),ye(r,s[0]/2,s[1]/2),ge(r,1,1),de(r,n,n=le()),de(n,e,n),this.l=n),es(this.l,t,e=[0,0]),!(e[0]<0||e[0]>s[0]||e[1]<0||e[1]>s[1])&&(this.j||(this.j=bn(1,1)),this.j.clearRect(0,0,1,1),this.j.drawImage(this.c.a(),e[0],e[1],1,1,0,0,1,1),0<this.j.getImageData(0,0,1,1).data[3]))return i.call(o,this.a)}},i(nc,Tp),e(nc),i(sc,Ap),e(sc),i(lc,ic),(Fm=lc.prototype).X=function(){kp(this.b.g,this.C),lc.da.X.call(this)},Fm.ed=function(e,o,r){var n=this.b;return function(i,t){return Dr(e,o,i,t,function(t){var e=dr(n.f,t.bb());return e&&(r[i]||(r[i]={}),r[i][t.ga.toString()]=t),e})}},Fm.Gf=function(){lc.da.Gf.call(this),this.c=null},Fm.Hf=function(t,e,i){var o,r,n,s,a,l,h,p,c,u=this.b,d=i.a,f=t.viewState,g=f.projection,y=this.a,m=y.ea(),_=m.kb(g),v=Ar(_,f.resolution),b=_.$(v),x=kr(m,v,t.pixelRatio,g),w=x[0]/Yt(_.Ma(v),this.O)[0],M=b/w,P=m.ce(),E=f.center,S=b==f.resolution?Be(E=hs(E,b,t.size),b,f.rotation,t.size):t.extent,b=Pr(_,S,b);if(this.j&&(p=this.j,c=b,p.a==c.a&&p.f==c.f&&p.c==c.c&&p.b==c.b)&&this.l==m.f)M=this.v;else{var T=[mo(b),yo(b)],T=M*(R=Math.pow(2,Math.ceil(Math.log(Math.max(T[0]*x[0],T[1]*x[1]))/Math.LN2))),A=_.Ea(v),M=[D=A[0]+b.a*x[0]*M,M=A[1]+b.f*x[1]*M,D+T,M+T];l=t,h=R,p=(a=this).b.b,void 0===a.i||a.i!=h?(l.postRenderFunctions.push(j(function(t,e,i){t.isContextLost()||(t.deleteFramebuffer(e),t.deleteTexture(i))},p,a.g,a.ob)),l=Bp(p,h,h),c=p.createFramebuffer(),p.bindFramebuffer(36160,c),p.framebufferTexture2D(36160,36064,3553,l,0),a.ob=l,a.g=c,a.i=h):p.bindFramebuffer(36160,a.g),d.viewport(0,0,R,R),d.clearColor(0,0,0,0),d.clear(16384),d.disable(3042),R=Np(i,this.D,this.T),i.Je(R),this.c||(this.c=new ac(d,R)),Dp(i,34962,this.C),d.enableVertexAttribArray(this.c.a),d.vertexAttribPointer(this.c.a,2,5126,!1,16,0),d.enableVertexAttribArray(this.c.f),d.vertexAttribPointer(this.c.f,2,5126,!1,16,8),d.uniform1i(this.c.b,0),(i={})[v]={};for(var C,I,L=this.ed(m,g,i),O=y.b(),R=!0,D=Te(),k=new fo(0,0,0,0),z=b.a;z<=b.c;++z)for(I=b.f;I<=b.b;++I)if(A=m.Qb(v,z,I,w,g),void 0===e.extent||He(C=_.Ba(A.ga,D),e.extent)){if(2==(C=(A=!(C=2==(C=A.state)||4==C||3==C&&!O)&&A.a?A.a:A).state)){if(dr(u.f,A.bb())){i[v][A.ga.toString()]=A;continue}}else if(4==C||3==C&&!O)continue;R=!1,(C=wr(_,A.ga,L,k,D))||(A=Mr(_,A.ga,k,D))&&L(v+1,A)}(e=Object.keys(i).map(Number)).sort(Z);for(var F,N,U,L=new Float32Array(4),O=0,k=e.length;O<k;++O)for(F in N=i[e[O]])A=N[F],C=_.Ba(A.ga,D),z=2*(C[2]-C[0])/T,I=2*(C[3]-C[1])/T,U=2*(C[0]-M[0])/T-1,C=2*(C[1]-M[1])/T-1,o=L,r=z,n=I,s=U,U=C,o[0]=r,o[1]=n,o[2]=s,o[3]=U,d.uniform4fv(this.c.c,L),cc(u,A,x,P*w),d.drawArrays(5,0,4);R?(this.j=b,this.v=M,this.l=m.f):(this.v=this.j=null,this.l=-1,t.animate=!0)}ls(t.usedTiles,m,v,b);var B=u.l;return ps(t,m,_,w,g,S,v,y.a(),function(t){var e;(e=!(e=2!=t.state||dr(u.f,t.bb()))?t.bb()in B.b:e)||B.c([t,Sr(_,t.ga),_.$(t.ga[0]),x,P*w])},this),ns(t,m),as(t,m),ue(d=this.o),ge(d,(E[0]-M[0])/(M[2]-M[0]),(E[1]-M[1])/(M[3]-M[1])),0!==f.rotation&&me(d,f.rotation),ye(d,t.size[0]*f.resolution/(M[2]-M[0]),t.size[1]*f.resolution/(M[3]-M[1])),ge(d,-.5,-.5),!0},Fm.zc=function(t,e,i,o){if(this.g){var r=[0,0];if(es(this.o,[t[0]/e.size[0],(e.size[1]-t[1])/e.size[1]],r),t=[r[0]*this.i,r[1]*this.i],(e=this.b.g.a).bindFramebuffer(e.FRAMEBUFFER,this.g),r=new Uint8Array(4),e.readPixels(t[0],t[1],1,1,e.RGBA,e.UNSIGNED_BYTE,r),0<r[3])return i.call(o,this.a)}},i(hc,ic),(Fm=hc.prototype).th=function(t,e,i){this.j=e;var o=t.viewState,r=this.c;r&&!r.Na()&&r.f(i,o.center,o.resolution,o.rotation,t.size,t.pixelRatio,e.opacity,e.Db?t.skippedFeatureUids:{})},Fm.X=function(){var t=this.c;t&&(Kp(t,this.b.g)(),this.c=null),hc.da.X.call(this)},Fm.cb=function(t,e,i,o){if(this.c&&this.j){var r=e.viewState,n=this.a,s=this.j,a={};return this.c.c(t,this.b.g,r.center,r.resolution,r.rotation,e.size,e.pixelRatio,s.opacity,s.Db?e.skippedFeatureUids:{},function(t){var e=R(t).toString();return e in a?void 0:(a[e]=!0,i.call(o,t,n))})}},Fm.ze=function(t,e){if(this.c&&this.j){var i=e.viewState;return o=this.c,r=t,n=this.b.g,s=i.resolution,t=i.rotation,i=this.j.opacity,e=e.skippedFeatureUids,(a=n.a).bindFramebuffer(a.FRAMEBUFFER,zp(n)),void 0!==$p(o,n,r,s,t,i,e,function(){var t=new Uint8Array(4);return a.readPixels(0,0,1,1,a.RGBA,a.UNSIGNED_BYTE,t),0<t[3]},!1)}var o,r,n,s,a;return!1},Fm.zc=function(t,e,i,o){return t=t.slice(),es(e.pixelToCoordinateMatrix,t,t),this.ze(t,e)?i.call(o,this.a):void 0},Fm.uh=function(){rs(this)},Fm.Hf=function(t,e,i){function o(t){var e,i=t.cc();if(i?e=i.call(t,h):(i=n.b)&&(e=i(t,h)),e){if(e){if(i=!1,w(e))for(var o=0,r=e.length;o<r;++o)i=Sl(d,t,e[o],El(h,p),this.uh,this)||i;else i=Sl(d,t,e,El(h,p),this.uh,this)||i;t=i}else t=!1;this.l=this.l||t}}var n=this.a;e=n.ea(),ss(t.attributions,e.i),as(t,e);var r=t.viewHints[0],s=t.viewHints[1],a=n.j,l=n.l;if(!this.l&&!a&&r||!l&&s)return!0;var s=t.extent,r=(a=t.viewState).projection,h=a.resolution,p=t.pixelRatio,a=n.f,c=n.a;if(void 0===(l=qa(n))&&(l=Pl),s=be(s,c*h),!this.l&&this.D==h&&this.O==a&&this.C==l&&Pe(this.v,s))return!0;this.c&&t.postRenderFunctions.push(Kp(this.c,i)),this.l=!1;var u,d=new Xp(.5*h/p,s,n.a);return e.Oc(s,h,r),l?(u=[],e.rb(s,function(t){u.push(t)},this),u.sort(l),u.forEach(o,this)):e.rb(s,o,this),function(t,e){for(var i in t.b)Wp(t.b[i],e)}(d,i),this.D=h,this.O=a,this.C=l,this.v=s,this.c=d,!0},i(pc,ys),(Fm=pc.prototype).kf=function(t){return t instanceof La?new rc(this,t):t instanceof Oa?new lc(this,t):t instanceof Ha?new hc(this,t):null},Fm.X=function(){var e=this.b;e.isContextLost()||this.f.forEach(function(t){t&&e.deleteTexture(t.ob)}),pt(this.g),pc.da.X.call(this)},Fm.Dj=function(t,e){for(var i,o=this.b;1024<this.f.sc()-this.j;){if(i=this.f.a.nc)o.deleteTexture(i.ob);else{if(+this.f.a.qe==e.index)break;--this.j}this.f.pop()}},Fm.V=function(){return"webgl"},Fm.Mm=function(t){t.preventDefault(),this.f.clear(),this.j=0,X(this.c,function(t){t.Gf()})},Fm.Nm=function(){dc(this),this.i.render()},Fm.Pe=function(t){var e=this.g,i=this.b;if(i.isContextLost())return!1;if(!t)return this.o&&(rr(this.a,!1),this.o=!1),!1;this.B=t.focus,this.f.set((-t.index).toString(),null),++this.j,uc(this,"precompose",t);var o=[],r=t.layerStatesArray;z(r);for(var n,s=t.viewState.resolution,a=0,l=r.length;a<l;++a)Kn(n=r[a],s)&&"ready"==n.O&&(vs(this,n.layer).Hf(t,n,e)&&o.push(n));for(r=t.size[0]*t.pixelRatio,s=t.size[1]*t.pixelRatio,this.a.width==r&&this.a.height==s||(this.a.width=r,this.a.height=s),i.bindFramebuffer(36160,null),i.clearColor(0,0,0,0),i.clear(16384),i.enable(3042),i.viewport(0,0,this.a.width,this.a.height),a=0,l=o.length;a<l;++a)vs(this,(n=o[a]).layer).th(t,n,e);this.o||(rr(this.a,!0),this.o=!0),ms(t),1024<this.f.sc()-this.j&&t.postRenderFunctions.push(this.Dj.bind(this)),this.l.Na()||(t.postRenderFunctions.push(this.O),t.animate=!0),uc(this,"postcompose",t),bs(this,t),t.postRenderFunctions.push(_s)},Fm.Ff=function(t,e,i,o,r,n){if(this.b.isContextLost())return!1;for(var s=e.viewState,a=e.layerStatesArray,l=a.length-1;0<=l;--l){var h,p=(h=a[l]).layer;if(Kn(h,s.resolution)&&r.call(n,p)&&(h=vs(this,p).cb(t,e,i,o)))return h}},Fm.sh=function(t,e,i,o){var r=!1;if(this.b.isContextLost())return!1;for(var n=e.viewState,s=e.layerStatesArray,a=s.length-1;0<=a;--a){var l=s[a],h=l.layer;if(Kn(l,n.resolution)&&i.call(o,h)&&(r=vs(this,h).ze(t,e)))return!0}return r},Fm.rh=function(t,e,i,o,r){if(this.b.isContextLost())return!1;for(var n=e.viewState,s=e.layerStatesArray,a=s.length-1;0<=a;--a){var l,h=(l=s[a]).layer;if(Kn(l,n.resolution)&&r.call(o,h)&&(l=vs(this,h).zc(t,e,i,o)))return l}};var a0=["canvas","webgl","dom"];i(fc,Gt),(Fm=fc.prototype).qj=function(t){this.g.push(t)},Fm.rj=function(t){this.c.push(t)},Fm.og=function(t){this.tc().Rc().push(t)},Fm.pg=function(t){this.i.push(t)},Fm.qg=function(t){var e=t.Qa();void 0!==e&&(this.Y[e.toString()]=t),t.setMap(this)},Fm.Pa=function(t){this.render(),Array.prototype.push.apply(this.O,arguments)},Fm.X=function(){ko(this.a),fc.da.X.call(this)},Fm.rd=function(t,e,i,o,r){return this.b?(t=this.Ia(t),this.o.Ff(t,this.b,e,void 0!==i?i:null,void 0!==o?o:Bm,void 0!==r?r:null)):void 0},Fm.Rl=function(t,e,i,o,r){return this.b?this.o.rh(t,this.b,e,void 0!==i?i:null,void 0!==o?o:Bm,void 0!==r?r:null):void 0},Fm.jl=function(t,e,i){return!!this.b&&(t=this.Ia(t),this.o.sh(t,this.b,void 0!==e?e:Bm,void 0!==i?i:null))},Fm.Sj=function(t){return this.Ia(this.be(t))},Fm.be=function(t){var e=this.a;return t=tr(t),e=tr(e),[(e=new So(t.x-e.x,t.y-e.y)).x,e.y]},Fm.fh=function(){return this.get("target")},Fm.uc=function(){var t=this.fh();return void 0!==t?Co(t):null},Fm.Ia=function(t){var e=this.b;return e?(t=t.slice(),es(e.pixelToCoordinateMatrix,t,t)):null},Fm.Qj=function(){return this.g},Fm.jk=function(){return this.i},Fm.ik=function(t){return void 0!==(t=this.Y[t.toString()])?t:null},Fm.Xj=function(){return this.c},Fm.tc=function(){return this.get("layergroup")},Fm.eh=function(){return this.tc().Rc()},Fm.Ra=function(t){var e=this.b;return e?(t=t.slice(0,2),es(e.coordinateToPixelMatrix,t,t)):null},Fm.Ta=function(){return this.get("size")},Fm.aa=function(){return this.get("view")},Fm.yk=function(){return this.a},Fm.wk=function(t,e,i,o){var r=this.b;return r&&e in r.wantedTiles&&r.wantedTiles[e][t.ga.toString()]?(t=i[0]-r.focus[0],i=i[1]-r.focus[1],65536*Math.log(o)+Math.sqrt(t*t+i*i)/o):1/0},Fm.Og=function(t,e){t=new jn(e||t.type,this,t);this.Pg(t)},Fm.Pg=function(t){if(this.b){this.T=t.coordinate,t.frameState=this.b;var e,i=this.c.a;if(!1!==this.s(t))for(e=i.length-1;0<=e;e--){var o=i[e];if(o.b()&&!o.handleEvent(t))break}}},Fm.$k=function(){var t,e,i,o=this.b,r=this.qa;for(r.Na()||(e=t=16,i=0,o&&((i=o.viewHints)[0]&&(t=this.oc?8:0,e=2),i[1]&&(t=this.Gc?8:0,e=2),i=$(o.wantedTiles)),e*=i,r.g<(t*=i)&&(Ss(r),As(r,t,e))),t=0,e=(r=this.na).length;t<e;++t)r[t](this,o);r.length=0},Fm.cl=function(){this.render()},Fm.el=function(){var t=this.uc();fn(this.C),t?(t.appendChild(this.a),dn(this.C,this.ia||t),this.B||(this.B=St(this.jb,"resize",this.Xc,!1,this))):(ko(this.a),this.B&&(It(this.B),this.B=null)),this.Xc()},Fm.fl=function(){this.render()},Fm.il=function(){this.render()},Fm.hl=function(){this.U&&(It(this.U),this.U=null);var t=this.aa();t&&(this.U=St(t,"propertychange",this.il,!1,this)),this.render()},Fm.Lk=function(){this.render()},Fm.Mk=function(){this.render()},Fm.Kk=function(){this.D&&(this.D.forEach(It),this.D=null);var t=this.tc();t&&(this.D=[St(t,"propertychange",this.Mk,!1,this),St(t,"change",this.Lk,!1,this)]),this.render()},Fm.No=function(){var t=this.v;Qr(t),t.c()},Fm.render=function(){null!=this.v.ya||this.v.start()},Fm.Go=function(t){return this.g.remove(t)},Fm.Ho=function(t){return this.c.remove(t)},Fm.Jo=function(t){return this.tc().Rc().remove(t)},Fm.Ko=function(t){return this.i.remove(t)},Fm.Mo=function(t){var e,i=this.Ta(),o=this.aa(),r=null;if(void 0!==i&&0<i[0]&&0<i[1]&&o&&io(o)){for(var r=o.b.slice(),n=this.tc().sf(),s={},a=0,l=n.length;a<l;++a)s[R(n[a].layer)]=n[a];e=eo(o),r={animate:!1,attributions:{},coordinateToPixelMatrix:this.Fb,extent:null,focus:this.T||e.center,index:this.Gb++,layerStates:s,layerStatesArray:n,logos:rt(this.$c),pixelRatio:this.Ze,pixelToCoordinateMatrix:this.$e,postRenderFunctions:[],size:i,skippedFeatureUids:this.ha,tileQueue:this.qa,time:t,usedTiles:{},viewState:e,viewHints:r,wantedTiles:{}}}if(r){for(a=i=0,l=(t=this.O).length;a<l;++a)(o=t[a])(this,r)&&(t[i++]=o);t.length=i,r.extent=Be(e.center,e.resolution,e.rotation,r.size)}this.b=r,this.o.Pe(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.na,r.postRenderFunctions),0!==this.O.length||r.viewHints[0]||r.viewHints[1]||Le(r.extent,this.xa)||(this.s(new pr("moveend",this,r)),xe(r.extent,this.xa))),this.s(new pr("postrender",this,r)),rn(this.$k,this)},Fm.gi=function(t){this.set("layergroup",t)},Fm.Zf=function(t){this.set("size",t)},Fm.Sl=function(t){this.set("target",t)},Fm.ap=function(t){this.set("view",t)},Fm.pi=function(t){t=R(t).toString(),this.ha[t]=!0,this.render()},Fm.Xc=function(){var t,e,i=this.uc();i?(t=Uo(i),i=(e=gm&&i.currentStyle)&&jo(Ao(t))&&"auto"!=e.width&&"auto"!=e.height&&!e.boxSizing?new To(t=nr(i,e.width,"width","pixelWidth"),i=nr(i,e.height,"height","pixelHeight")):(e=new To(i.offsetWidth,i.offsetHeight),t=ar(i,"padding"),i=hr(i),new To(e.width-i.left-t.left-t.right-i.right,e.height-i.top-t.top-t.bottom-i.bottom)),this.Zf([i.width,i.height])):this.Zf(void 0)},Fm.ti=function(t){t=R(t).toString(),delete this.ha[t],this.render()},Ia(),i(gc,Gt),(Fm=gc.prototype).ue=function(){return this.get("element")},Fm.Qa=function(){return this.ya},Fm.ve=function(){return this.get("map")},Fm.Kg=function(){return this.get("offset")},Fm.gh=function(){return this.get("position")},Fm.Lg=function(){return this.get("positioning")},Fm.Hk=function(){Ro(this.b);var t=this.ue();t&&this.b.appendChild(t)},Fm.Rk=function(){this.c&&(ko(this.b),It(this.c),this.c=null);var t=this.ve();t&&(this.c=St(t,"postrender",this.render,!1,this),_c(this),t=this.l?t.j:t.l,this.j?Do(t,this.b,0):t.appendChild(this.b))},Fm.render=function(){_c(this)},Fm.Wk=function(){_c(this)},Fm.Yk=function(){var t,e,i,o,r,n,s;_c(this),void 0!==this.get("position")&&this.autoPan&&void 0!==(t=this.ve())&&t.uc()&&(e=yc(t.uc(),t.Ta()),i=(s=this.ue()).offsetWidth,r=s.currentStyle||window.getComputedStyle(s),i+=parseInt(r.marginLeft,10)+parseInt(r.marginRight,10),r=s.offsetHeight,o=s.currentStyle||window.getComputedStyle(s),n=yc(s,[i,r=r+(parseInt(o.marginTop,10)+parseInt(o.marginBottom,10))]),s=this.i,Pe(e,n)||(i=n[0]-e[0],r=e[2]-n[2],o=n[1]-e[1],n=e[3]-n[3],e=[0,0],i<0?e[0]=i-s:r<0&&(e[0]=Math.abs(r)+s),o<0?e[1]=o-s:n<0&&(e[1]=Math.abs(n)+s),0===e[0]&&0===e[1])||(s=t.aa().Va(),e=[(i=t.Ra(s))[0]+e[0],i[1]+e[1]],this.g&&(this.g.source=s,t.Pa(ho(this.g))),t.aa().mb(t.Ia(e))))},Fm.Zk=function(){_c(this)},Fm.ci=function(t){this.set("element",t)},Fm.setMap=function(t){this.set("map",t)},Fm.ii=function(t){this.set("offset",t)},Fm.Cf=function(t){this.set("position",t)},Fm.li=function(t){this.set("positioning",t)},i(vc,cr),(Fm=vc.prototype).setMap=function(t){var e=this.a;t!==e&&((e=e&&e.aa())&&Ct(e,Vt("rotation"),this.le,!1,this),vc.da.setMap.call(this,t),t&&(this.o.push(St(t,"propertychange",this.Sk,!1,this)),0===this.b.eh().bc()&&this.b.gi(t.tc()),t=t.aa()))&&(St(t,Vt("rotation"),this.le,!1,this),io(t)&&(this.b.Xc(),xc(this)))},Fm.Sk=function(t){"view"===t.key&&((t=t.oldValue)&&Ct(t,Vt("rotation"),this.le,!1,this),St(t=this.a.aa(),Vt("rotation"),this.le,!1,this))},Fm.le=function(){this.b.aa().we(this.a.aa().Ha())},Fm.cm=function(t){t.preventDefault(),Mc(this)},Fm.bm=function(){return this.j},Fm.em=function(t){this.j!==t&&(this.j=t,qo(this.element,"ol-uncollapsible"),!t&&this.i&&Mc(this))},Fm.dm=function(t){this.j&&this.i!==t&&Mc(this)},Fm.am=function(){return this.i},Fm.kk=function(){return this.b},i(Pc,cr);var l0=[1,2,5];Pc.prototype.C=function(){return this.get("units")},Pc.prototype.T=function(){Sc(this)},Pc.prototype.O=function(t){this.set("units",t)},i(Tc,lt);var h0=[];Tc.prototype.Sa=function(t,e,i,o){w(e)||(e&&(h0[0]=e.toString()),e=h0);for(var r=0;r<e.length;r++){var n=St(t,e[r],i||this.handleEvent,o||!1,this.f||this);if(!n)break;this.a[n.key]=n}return this},Tc.prototype.$f=function(t,e,i,o,r){if(w(e))for(var n=0;n<e.length;n++)this.$f(t,e[n],i,o,r);else i=i||this.handleEvent,r=r||this.f||this,i=zt(i),o=!!o,(e=mt(t)?Mt(t.Ab,String(e),i,o,r):(t=t&&kt(t))?Mt(t,e,i,o,r):null)&&(It(e),delete this.a[e.key]);return this},Tc.prototype.X=function(){Tc.da.X.call(this),Ac(this)},Tc.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},i(Cc,Ft);var p0=gm||mm&&at("1.9.3");(Fm=Cc.prototype).X=function(){Cc.da.X.call(this),Ct(this.handle,["touchstart","mousedown"],this.ri,!1,this),Ac(this.f),p0&&this.i.releaseCapture(),this.handle=this.target=null},Fm.ri=function(t){var e,i,o="mousedown"==t.type;this.b||o&&!yt(t)?this.s("earlycancel"):this.s(new Dc("start",this,t.clientX,t.clientY))&&(this.b=!0,t.preventDefault(),e=(o=this.i).documentElement,this.f.Sa(o,["touchmove","mousemove"],this.Vk,i=!p0),this.f.Sa(o,["touchend","mouseup"],this.$d,i),p0?(e.setCapture(!1),this.f.Sa(e,"losecapture",this.$d)):this.f.Sa(o?o.parentWindow||o.defaultView:window,"blur",this.$d),this.G&&this.f.Sa(this.G,"scroll",this.Vn,i),this.clientX=this.l=t.clientX,this.clientY=this.o=t.clientY,this.screenX=t.screenX,this.screenY=t.screenY,this.c=this.target.offsetLeft,this.g=this.target.offsetTop,this.j=Zo(Ao(this.i)))},Fm.$d=function(t){Ac(this.f),p0&&this.i.releaseCapture(),this.b?(this.b=!1,this.s(new Dc("end",this,t.clientX,t.clientY,0,Oc(this,this.c),Rc(this,this.g)))):this.s("earlycancel")},Fm.Vk=function(t){var e=t.clientX-this.clientX,i=t.clientY-this.clientY;if(this.clientX=t.clientX,this.clientY=t.clientY,this.screenX=t.screenX,this.screenY=t.screenY,!this.b){var o=this.l-this.clientX,r=this.o-this.clientY;if(0<o*o+r*r){if(!this.s(new Dc("start",this,t.clientX,t.clientY)))return void(this.pa||this.$d(t));this.b=!0}}e=(i=Ic(this,e,i)).x,i=i.y,this.b&&this.s(new Dc("beforedrag",this,t.clientX,t.clientY,0,e,i))&&(Lc(this,t,e,i),t.preventDefault())},Fm.Vn=function(t){var e=Ic(this,0,0);t.clientX=this.clientX,t.clientY=this.clientY,Lc(this,t,e.x,e.y)},i(Dc,ct),i(kc,cr);var c0=0;(Fm=kc.prototype).setMap=function(t){kc.da.setMap.call(this,t),t&&t.render()},Fm.Dk=function(t){var e=this.a,i=e.aa(),o=i.$();e.Pa(co({resolution:o,duration:this.B,easing:no})),t=Nc(this,Fc(this,t.offsetX-this.l[0]/2,t.offsetY-this.l[1]/2)),i.Vb(i.constrainResolution(t))},Fm.Gk=function(){oo(this.a.aa(),1)},Fm.Ek=function(t){this.i=Nc(this,Fc(this,t.left,t.top)),this.a.aa().Vb(this.i)},Fm.Fk=function(){var t=this.a,e=t.aa();oo(e,-1),t.Pa(co({resolution:this.i,duration:this.B,easing:no})),t=e.constrainResolution(this.i),e.Vb(t)},i(Uc,cr),Uc.prototype.i=function(t){t.preventDefault(),t=(i=this.a).aa();var e=this.b||t.g.J(),i=i.Ta();t.mf(e,i)},i(Bc,Gt),(Fm=Bc.prototype).X=function(){this.Af(!1),Bc.da.X.call(this)},Fm.Wn=function(t){var e;null!==(t=t.a).alpha&&(e=E(t.alpha),this.set("alpha",e),"boolean"==typeof t.absolute&&t.absolute?this.set("heading",e):y(t.webkitCompassHeading)&&-1!=t.webkitCompassAccuracy&&this.set("heading",E(t.webkitCompassHeading))),null!==t.beta&&this.set("beta",E(t.beta)),null!==t.gamma&&this.set("gamma",E(t.gamma)),this.u()},Fm.Lj=function(){return this.get("alpha")},Fm.Oj=function(){return this.get("beta")},Fm.Uj=function(){return this.get("gamma")},Fm.Fl=function(){return this.get("heading")},Fm.$g=function(){return this.get("tracking")},Fm.Gl=function(){var t;b_&&((t=this.$g())&&!this.a?this.a=St(Xy,"deviceorientation",this.Wn,!1,this):!t&&this.a&&(It(this.a),this.a=null))},Fm.Af=function(t){this.set("tracking",t)},i(Wc,jc),(Fm=Wc.prototype).V=function(){return"json"},Fm.Ub=function(t,e){return this.Tc(Hc(t),Zc(this,t,e))},Fm.Ca=function(t,e){return this.Of(Hc(t),Zc(this,t,e))},Fm.Uc=function(t,e){return this.Mh(Hc(t),Zc(this,t,e))},Fm.Ka=function(t){return this.Th(Hc(t))},Fm.Ld=function(t,e){return Pv(this.Yc(t,e))},Fm.Wb=function(t,e){return Pv(this.Ue(t,e))},Fm.Zc=function(t,e){return Pv(this.We(t,e))},i(Xc,mi),(Fm=Xc.prototype).sj=function(t){this.A?D(this.A,t):this.A=t.slice(),this.u()},Fm.clone=function(){var t=new Xc(null);return t.ba(this.b,this.A.slice()),t},Fm.pb=function(t,e,i,o){return o<we(this.J(),t,e)?o:(this.C!=this.f&&(this.D=Math.sqrt(Pi(this.A,0,this.A.length,this.a,0)),this.C=this.f),Si(this.A,0,this.A.length,this.a,this.D,!1,t,e,i,o))},Fm.Ij=function(t,e){return ji(this.A,0,this.A.length,this.a,t,e)},Fm.hm=function(t,e){return"XYM"!=this.b&&"XYZM"!=this.b?null:Yc(this.A,0,this.A.length,this.a,t,void 0!==e&&e)},Fm.Z=function(){return Li(this.A,0,this.A.length,this.a)},Fm.Ag=function(t,e){return qc(this.A,0,this.A.length,this.a,t,e)},Fm.im=function(){for(var t=this.A,e=this.a,i=t[0],o=t[1],r=0,n=0+e;n<this.A.length;n+=e)var s=t[n],a=t[n+1],r=r+Math.sqrt((s-i)*(s-i)+(a-o)*(a-o)),i=s,o=a;return r},Fm.Nc=function(t){var e=[];return e.length=Ri(this.A,0,this.A.length,this.a,t,e,0),(t=new Xc(null)).ba("XY",e),t},Fm.V=function(){return"LineString"},Fm.Fa=function(t){return Zi(this.A,0,this.A.length,this.a,t)},Fm.ma=function(t,e){t?(bi(this,e,t,1),this.A||(this.A=[]),this.A.length=Ci(this.A,0,t,this.a),this.u()):this.ba("XY",null)},Fm.ba=function(t,e){vi(this,t,e),this.u()},i($c,mi),(Fm=$c.prototype).tj=function(t){this.A?D(this.A,t.ja().slice()):this.A=t.ja().slice(),this.g.push(this.A.length),this.u()},Fm.clone=function(){var t=new $c(null);return t.ba(this.b,this.A.slice(),this.g.slice()),t},Fm.pb=function(t,e,i,o){return o<we(this.J(),t,e)?o:(this.l!=this.f&&(this.C=Math.sqrt(Ei(this.A,0,this.g,this.a,0)),this.l=this.f),Ti(this.A,0,this.g,this.a,this.C,!1,t,e,i,o))},Fm.km=function(t,e,i){return"XYM"!=this.b&&"XYZM"!=this.b||0===this.A.length?null:function(t,e,i,o,r,n){var s=0;if(n)return Yc(t,s,e[e.length-1],i,o,r);if(o<t[i-1])return r?((t=t.slice(0,i))[i-1]=o,t):null;if(t[t.length-1]<o)return r?((t=t.slice(t.length-i))[i-1]=o,t):null;for(r=0,n=e.length;r<n;++r){var a=e[r];if(s!=a){if(o<t[s+i-1])break;if(o<=t[a-1])return Yc(t,s,a,i,o,!1);s=a}}return null}(this.A,this.g,this.a,t,void 0!==e&&e,void 0!==i&&i)},Fm.Z=function(){return Oi(this.A,0,this.g,this.a)},Fm.Bb=function(){return this.g},Fm.bk=function(t){if(t<0||this.g.length<=t)return null;var e=new Xc(null);return e.ba(this.b,this.A.slice(0===t?0:this.g[t-1],this.g[t])),e},Fm.ud=function(){for(var t=this.A,e=this.g,i=this.b,o=[],r=0,n=0,s=e.length;n<s;++n){var a=e[n],l=new Xc(null);l.ba(i,t.slice(r,a)),o.push(l),r=a}return o},Fm.Nc=function(t){for(var e=[],i=[],o=this.A,r=this.g,n=this.a,s=0,a=0,l=0,h=r.length;l<h;++l){var p=r[l],a=Ri(o,s,p,n,t,e,a);i.push(a),s=p}return e.length=a,(t=new $c(null)).ba("XY",e,i),t},Fm.V=function(){return"MultiLineString"},Fm.Fa=function(t){t:{for(var e=this.A,i=this.g,o=this.a,r=0,n=0,s=i.length;n<s;++n){if(Zi(e,r,i[n],o,t)){t=!0;break t}r=i[n]}t=!1}return t},Fm.ma=function(t,e){t?(bi(this,e,t,2),this.A||(this.A=[]),t=Ii(this.A,0,t,this.a,this.g),this.A.length=0===t.length?0:t[t.length-1],this.u()):this.ba("XY",null,this.g)},Fm.ba=function(t,e,i){vi(this,t,e),this.g=i,this.u()},i(tu,mi),(Fm=tu.prototype).vj=function(t){this.A?D(this.A,t.ja()):this.A=t.ja().slice(),this.u()},Fm.clone=function(){var t=new tu(null);return t.ba(this.b,this.A.slice()),t},Fm.pb=function(t,e,i,o){if(o<we(this.J(),t,e))return o;for(var r,n=this.A,s=this.a,a=0,l=n.length;a<l;a+=s)if((r=P(t,e,n[a],n[a+1]))<o){for(o=r,r=0;r<s;++r)i[r]=n[a+r];i.length=s}return o},Fm.Z=function(){return Li(this.A,0,this.A.length,this.a)},Fm.mk=function(t){var e=this.A?this.A.length/this.a:0;return t<0||e<=t?null:((e=new Fi(null)).ba(this.b,this.A.slice(t*this.a,(t+1)*this.a)),e)},Fm.xe=function(){for(var t=this.A,e=this.b,i=this.a,o=[],r=0,n=t.length;r<n;r+=i){var s=new Fi(null);s.ba(e,t.slice(r,r+i)),o.push(s)}return o},Fm.V=function(){return"MultiPoint"},Fm.Fa=function(t){for(var e=this.A,i=this.a,o=0,r=e.length;o<r;o+=i)if(Ee(t,e[o],e[o+1]))return!0;return!1},Fm.ma=function(t,e){t?(bi(this,e,t,1),this.A||(this.A=[]),this.A.length=Ci(this.A,0,t,this.a),this.u()):this.ba("XY",null)},Fm.ba=function(t,e){vi(this,t,e),this.u()},i(eu,mi),(Fm=eu.prototype).wj=function(t){if(this.A){var e,i,o=this.A.length;for(D(this.A,t.ja()),e=0,i=(t=t.Bb().slice()).length;e<i;++e)t[e]+=o}else this.A=t.ja().slice(),t=t.Bb().slice(),this.g.push();this.g.push(t),this.u()},Fm.clone=function(){var t=new eu(null),e=function t(e){if("object"!=(o=r(e))&&"array"!=o)return e;if(c(e.clone))return e.clone();var i,o="array"==o?[]:{};for(i in e)o[i]=t(e[i]);return o}(this.g);return ru(t,this.b,this.A.slice(),e),t},Fm.pb=function(t,e,i,o){if(o<we(this.J(),t,e))return o;if(this.O!=this.f){for(var r=this.g,n=0,s=0,a=0,l=r.length;a<l;++a)var h=r[a],s=Ei(this.A,n,h,this.a,s),n=h[h.length-1];this.U=Math.sqrt(s),this.O=this.f}r=ou(this),n=this.g,s=this.a,a=this.U;for(var h=[NaN,NaN],p=l=0,c=n.length;p<c;++p){var u=n[p];o=Ti(r,l,u,s,a,!0,t,e,i,o,h),l=u[u.length-1]}return o},Fm.yc=function(t,e){t:{var i=ou(this),o=this.g,r=0;if(0!==o.length)for(var n=0,s=o.length;n<s;++n){var a=o[n];if(Ui(i,r,a,this.a,t,e)){i=!0;break t}r=a[a.length-1]}i=!1}return i},Fm.lm=function(){for(var t=ou(this),e=this.g,i=0,o=0,r=0,n=e.length;r<n;++r)var s=e[r],o=o+wi(t,i,s,this.a),i=s[s.length-1];return o},Fm.Z=function(t){void 0!==t?qi(e=ou(this).slice(),this.g,this.a,t):e=this.A,t=e;for(var e=this.g,i=this.a,o=0,r=[],n=0,s=0,a=e.length;s<a;++s){var l=e[s];r[n++]=Oi(t,o,l,i,r[n]),o=l[l.length-1]}return r.length=n,r},Fm.Zj=function(){var t=new tu(null);return t.ba("XY",iu(this).slice()),t},Fm.Nc=function(t){var e=[],i=[],o=this.A,r=this.g,n=this.a;t=Math.sqrt(t);for(var s=0,a=0,l=0,h=r.length;l<h;++l){var p=r[l],c=[],a=Di(o,s,p,n,t,e,a,c);i.push(c),s=p[p.length-1]}return e.length=a,ru(o=new eu(null),"XY",e,i),o},Fm.pk=function(t){if(t<0||this.g.length<=t)return null;var e=0===t?0:(e=this.g[t-1])[e.length-1],i=(t=this.g[t].slice())[t.length-1];if(0!==e)for(var o=0,r=t.length;o<r;++o)t[o]-=e;return(o=new Yi(null)).ba(this.b,this.A.slice(e,i),t),o},Fm.ee=function(){for(var t,e,i=this.b,o=this.A,r=this.g,n=[],s=0,a=0,l=r.length;a<l;++a){var h=r[a].slice(),p=h[h.length-1];if(0!==s)for(t=0,e=h.length;t<e;++t)h[t]-=s;(t=new Yi(null)).ba(i,o.slice(s,p),h),n.push(t),s=p}return n},Fm.V=function(){return"MultiPolygon"},Fm.Fa=function(t){t:{for(var e=ou(this),i=this.g,o=this.a,r=0,n=0,s=i.length;n<s;++n){var a=i[n];if(Gi(e,r,a,o,t)){t=!0;break t}r=a[a.length-1]}t=!1}return t},Fm.ma=function(t,e){if(t){bi(this,e,t,3),this.A||(this.A=[]);for(var i=this.A,o=this.a,r=0,n=(n=this.g)||[],s=0,a=0,l=t.length;a<l;++a)r=Ii(i,r,t[a],o,n[s]),r=(n[s++]=r)[r.length-1];n.length=s,0===n.length?this.A.length=0:(i=n[n.length-1],this.A.length=0===i.length?0:i[i.length-1]),this.u()}else ru(this,"XY",null,this.g)},i(su,Wc);var u0={Point:function(t){return void 0!==t.m&&void 0!==t.z?new Fi([t.x,t.y,t.z,t.m],"XYZM"):void 0!==t.z?new Fi([t.x,t.y,t.z],"XYZ"):void 0!==t.m?new Fi([t.x,t.y,t.m],"XYM"):new Fi([t.x,t.y])},LineString:function(t){return new Xc(t.paths[0],lu(t))},Polygon:function(t){return new Yi(t.rings,lu(t))},MultiPoint:function(t){return new tu(t.points,lu(t))},MultiLineString:function(t){return new $c(t.paths,lu(t))},MultiPolygon:function(t){return new eu(t.rings,lu(t))}},d0={Point:function(t){var e=t.Z();return"XYZ"===(t=t.b)?{x:e[0],y:e[1],z:e[2]}:"XYM"===t?{x:e[0],y:e[1],m:e[2]}:"XYZM"===t?{x:e[0],y:e[1],z:e[2],m:e[3]}:"XY"===t?{x:e[0],y:e[1]}:void 0},LineString:function(t){var e=hu(t);return{hasZ:e.hasZ,hasM:e.hasM,paths:[t.Z()]}},Polygon:function(t){var e=hu(t);return{hasZ:e.hasZ,hasM:e.hasM,rings:t.Z(!1)}},MultiPoint:function(t){var e=hu(t);return{hasZ:e.hasZ,hasM:e.hasM,points:t.Z()}},MultiLineString:function(t){var e=hu(t);return{hasZ:e.hasZ,hasM:e.hasM,paths:t.Z()}},MultiPolygon:function(t){var e=hu(t);t=t.Z(!1);for(var i=[],o=0;o<t.length;o++)for(var r=t[o].length-1;0<=r;r--)i.push(t[o][r]);return{hasZ:e.hasZ,hasM:e.hasM,rings:i}}};(Fm=su.prototype).Tc=function(t,e){var i=au(t.geometry,e),o=new Bl;return this.a&&o.Cc(this.a),o.Oa(i),e&&e.vf&&t.attributes[e.vf]&&o.kc(t.attributes[e.vf]),t.attributes&&o.I(t.attributes),o},Fm.Of=function(t,e){var i=e||{};if(t.features){var o,r,n=[],s=t.features;for(i.vf=t.objectIdFieldName,o=0,r=s.length;o<r;++o)n.push(this.Tc(s[o],i));return n}return[this.Tc(t,i)]},Fm.Mh=au,Fm.Th=function(t){return t.spatialReference&&t.spatialReference.wkid?ai("EPSG:"+t.spatialReference.wkid):null},Fm.We=function(t,e){return pu(t,Gc(this,e))},Fm.Yc=function(t,e){e=Gc(this,e);var i={},o=t.W();return o&&(i.geometry=pu(o,e)),delete(o=t.R())[t.a],i.attributes=tt(o)?{}:o,e&&e.featureProjection&&(i.spatialReference={wkid:ai(e.featureProjection).Ya.split(":").pop()}),i},Fm.Ue=function(t,e){e=Gc(this,e);for(var i=[],o=0,r=t.length;o<r;++o)i.push(this.Yc(t[o],e));return{features:i}},i(cu,gi),(Fm=cu.prototype).clone=function(){var t=new cu(null);return t.ei(this.c),t},Fm.pb=function(t,e,i,o){if(o<we(this.J(),t,e))return o;for(var r=this.c,n=0,s=r.length;n<s;++n)o=r[n].pb(t,e,i,o);return o},Fm.yc=function(t,e){for(var i=this.c,o=0,r=i.length;o<r;++o)if(i[o].yc(t,e))return!0;return!1},Fm.Xd=function(t){Ae(1/0,1/0,-1/0,-1/0,t);for(var e=this.c,i=0,o=e.length;i<o;++i)Oe(t,e[i].J());return t},Fm.Fg=function(){return uu(this.c)},Fm.vd=function(t){if(this.o!=this.f&&(et(this.i),this.j=0,this.o=this.f),t<0||0!==this.j&&t<this.j)return this;var e=t.toString();if(this.i.hasOwnProperty(e))return this.i[e];for(var i=[],o=this.c,r=!1,n=0,s=o.length;n<s;++n){var a=o[n],l=a.vd(t);i.push(l),l!==a&&(r=!0)}return r?(du(t=new cu(null)),t.c=i,fu(t),t.u(),this.i[e]=t):(this.j=t,this)},Fm.V=function(){return"GeometryCollection"},Fm.Fa=function(t){for(var e=this.c,i=0,o=e.length;i<o;++i)if(e[i].Fa(t))return!0;return!1},Fm.Na=function(){return 0===this.c.length},Fm.ei=function(t){t=uu(t),du(this),this.c=t,fu(this),this.u()},Fm.qc=function(t){for(var e=this.c,i=0,o=e.length;i<o;++i)e[i].qc(t);this.u()},Fm.Qc=function(t,e){for(var i=this.c,o=0,r=i.length;o<r;++o)i[o].Qc(t,e);this.u()},Fm.X=function(){du(this),cu.da.X.call(this)},i(gu,Wc);var f0={Point:function(t){return new Fi(t.coordinates)},LineString:function(t){return new Xc(t.coordinates)},Polygon:function(t){return new Yi(t.coordinates)},MultiPoint:function(t){return new tu(t.coordinates)},MultiLineString:function(t){return new $c(t.coordinates)},MultiPolygon:function(t){return new eu(t.coordinates)},GeometryCollection:function(t,e){return new cu(t.geometries.map(function(t){return yu(t,e)}))}},g0={Point:function(t){return{type:"Point",coordinates:t.Z()}},LineString:function(t){return{type:"LineString",coordinates:t.Z()}},Polygon:function(t,e){var i;return e&&(i=e.rightHanded),{type:"Polygon",coordinates:t.Z(i)}},MultiPoint:function(t){return{type:"MultiPoint",coordinates:t.Z()}},MultiLineString:function(t){return{type:"MultiLineString",coordinates:t.Z()}},MultiPolygon:function(t,e){var i;return e&&(i=e.rightHanded),{type:"MultiPolygon",coordinates:t.Z(i)}},GeometryCollection:function(t,e){return{type:"GeometryCollection",geometries:t.c.map(function(t){return mu(t,e)})}},Circle:function(){return{type:"GeometryCollection",geometries:[]}}};(Fm=gu.prototype).Tc=function(t,e){var i=yu(t.geometry,e),e=new Bl;return this.a&&e.Cc(this.a),e.Oa(i),void 0!==t.id&&e.kc(t.id),t.properties&&e.I(t.properties),e},Fm.Of=function(t,e){if("Feature"==t.type)return[this.Tc(t,e)];if("FeatureCollection"!=t.type)return[];for(var i=[],o=t.features,r=0,n=o.length;r<n;++r)i.push(this.Tc(o[r],e));return i},Fm.Mh=yu,Fm.Th=function(t){return(t=t.crs)?"name"==t.type?ai(t.properties.name):"EPSG"==t.type?ai("EPSG:"+t.properties.code):null:this.defaultDataProjection},Fm.Yc=function(t,e){e=Gc(this,e);var i={type:"Feature"},o=t.Qa();return void 0!==o&&(i.id=o),(o=t.W())?i.geometry=mu(o,e):i.geometry=null,delete(o=t.R())[t.a],tt(o)?i.properties=null:i.properties=o,i},Fm.Ue=function(t,e){e=Gc(this,e);for(var i=[],o=0,r=t.length;o<r;++o)i.push(this.Yc(t[o],e));return{type:"FeatureCollection",features:i}},Fm.We=function(t,e){return mu(t,Gc(this,e))},i(_u,jc),(Fm=_u.prototype).V=function(){return"xml"},Fm.Ub=function(t,e){return Bv(t)?vu(this,t,e):jv(t)?this.Kh(t,e):u(t)?vu(this,Sh(t),e):null},Fm.Ca=function(t,e){return Bv(t)?bu(this,t,e):jv(t)?this.jc(t,e):u(t)?bu(this,Sh(t),e):[]},Fm.Uc=function(t,e){if(Bv(t))return this.G(t,e);if(jv(t)){var i=this.Le(t,[Zc(this,t,e||{})]);return i||null}return u(t)?(i=Sh(t),this.G(i,e)):null},Fm.Ka=function(t){return Bv(t)?this.Uf(t):jv(t)?this.Oe(t):u(t)?(t=Sh(t),this.Uf(t)):null},Fm.Uf=function(){return this.defaultDataProjection},Fm.Oe=function(){return this.defaultDataProjection},Fm.Ld=function(t,e){return Ph(this.v(t,e))},Fm.Wb=function(t,e){return Ph(this.f(t,e))},Fm.Zc=function(t,e){return Ph(this.o(t,e))},i(xu,_u),(Fm=xu.prototype).Gd=function(t,e){var i=Uv(t);if("FeatureCollection"==i)s="http://www.opengis.net/wfs"===t.namespaceURI?Nh([],this.a,t,e,this):Nh(null,this.a,t,e,this);else if("featureMembers"==i||"featureMember"==i){var o,r,n=(c=e[0]).featureType,s=c.featureNS;if(!n&&t.childNodes){for(n=[],s={},o=0,r=t.childNodes.length;o<r;++o){var a,l,h=t.childNodes[o];1===h.nodeType&&(a=h.nodeName.split(":").pop(),-1===n.indexOf(a)&&(!function(t,e){for(var i in t)if(t[i]==e)return 1}(s,h.namespaceURI)?s[l="p"+$(s)]=h.namespaceURI:l=Q(s,function(t){return t===h.namespaceURI}),n.push(l+":"+a)))}c.featureType=n,c.featureNS=s}u(s)&&(o=s,(s={}).p0=o);var p,c={},n=w(n)?n:[n];for(p in s){for(a={},o=0,r=n.length;o<r;++o)(-1===n[o].indexOf(":")?"p0":n[o].split(":")[0])===p&&(a[n[o].split(":").pop()]=("featureMembers"==i?Ah:Ch)(this.Nf,this));c[s[p]]=a}s=Nh([],c,t,e)}return s=s||[]},Fm.Le=function(t,e){var i=e[0];i.srsName=t.firstElementChild.getAttribute("srsName");e=Nh(null,this.fg,t,e,this);return e?Vc(e,!1,i):void 0},Fm.Nf=function(t,e){for(var i,o=t.getAttribute("fid")||Zv(t,"http://www.opengis.net/gml","id"),r={},n=t.firstElementChild;n;n=n.nextElementSibling){var s,a=Uv(n);0===n.childNodes.length||1===n.childNodes.length&&(3===n.firstChild.nodeType||4===n.firstChild.nodeType)?(s=Eh(n,!1),/^[\s\xa0]*$/.test(s)&&(s=void 0),r[a]=s):("boundedBy"!==a&&(i=a),r[a]=this.Le(n,e))}return n=new Bl(r),i&&n.Cc(i),o&&n.kc(o),n},Fm.Sh=function(t,e){t=this.Ke(t,e);if(t){e=new Fi(null);return e.ba("XYZ",t),e}},Fm.Qh=function(t,e){e=Nh([],this.Ri,t,e,this);return e?new tu(e):void 0},Fm.Ph=function(t,e){t=Nh([],this.Qi,t,e,this);if(t){e=new $c(null);return Qc(e,t),e}},Fm.Rh=function(t,e){t=Nh([],this.Si,t,e,this);if(t){e=new eu(null);return nu(e,t),e}},Fm.Hh=function(t,e){Fh(this.Vi,t,e,this)},Fm.Vg=function(t,e){Fh(this.Oi,t,e,this)},Fm.Ih=function(t,e){Fh(this.Wi,t,e,this)},Fm.Me=function(t,e){t=this.Ke(t,e);if(t){e=new Xc(null);return e.ba("XYZ",t),e}},Fm.ro=function(t,e){e=Nh(null,this.Nd,t,e,this);return e||void 0},Fm.Oh=function(t,e){t=this.Ke(t,e);if(t){e=new ki(null);return zi(e,"XYZ",t),e}},Fm.Ne=function(t,e){var i=Nh([null],this.Ye,t,e,this);if(i&&i[0]){for(var e=new Yi(null),o=i[0],r=[o.length],n=1,s=i.length;n<s;++n)D(o,i[n]),r.push(o.length);return e.ba("XYZ",o,r),e}},Fm.Ke=function(t,e){return Nh(null,this.Nd,t,e,this)},Fm.Ri=Object({"http://www.opengis.net/gml":{pointMember:Ah(xu.prototype.Hh),pointMembers:Ah(xu.prototype.Hh)}}),Fm.Qi=Object({"http://www.opengis.net/gml":{lineStringMember:Ah(xu.prototype.Vg),lineStringMembers:Ah(xu.prototype.Vg)}}),Fm.Si=Object({"http://www.opengis.net/gml":{polygonMember:Ah(xu.prototype.Ih),polygonMembers:Ah(xu.prototype.Ih)}}),Fm.Vi=Object({"http://www.opengis.net/gml":{Point:Ah(xu.prototype.Ke)}}),Fm.Oi=Object({"http://www.opengis.net/gml":{LineString:Ah(xu.prototype.Me)}}),Fm.Wi=Object({"http://www.opengis.net/gml":{Polygon:Ah(xu.prototype.Ne)}}),Fm.Od=Object({"http://www.opengis.net/gml":{LinearRing:Ch(xu.prototype.ro)}}),Fm.jc=function(t,e){var i={featureType:this.featureType,featureNS:this.featureNS};return e&&nt(i,Zc(this,t,e)),this.Gd(t,[i])},Fm.Oe=function(t){return ai(this.B||t.firstElementChild.getAttribute("srsName"))},i(Du,xu),(Fm=Du.prototype).Lh=function(t,e){var i=Eh(t,!1).replace(/^\s*|\s*$/g,""),o=e[0].srsName,r=t.parentNode.getAttribute("srsDimension"),n="enu";(o=o&&ai(o))&&(n=o.c),i=i.split(/[\s,]+/),o=2,t.getAttribute("srsDimension")?o=Au(t.getAttribute("srsDimension")):t.getAttribute("dimension")?o=Au(t.getAttribute("dimension")):r&&(o=Au(r));for(var s,a,l=[],h=0,p=i.length;h<p;h+=o)r=parseFloat(i[h]),s=parseFloat(i[h+1]),a=3===o?parseFloat(i[h+2]):0,"en"===n.substr(0,2)?l.push(r,s,a):l.push(s,r,a);return l},Fm.oo=function(t,e){e=Nh([null],this.Ki,t,e,this);return Ae(e[1][0],e[1][1],e[1][3],e[1][4])},Fm.ll=function(t,e){t=Nh(void 0,this.Od,t,e,this);t&&e[e.length-1].push(t)},Fm.Xn=function(t,e){t=Nh(void 0,this.Od,t,e,this);t&&(e[e.length-1][0]=t)},Fm.Nd=Object({"http://www.opengis.net/gml":{coordinates:Ch(Du.prototype.Lh)}}),Fm.Ye=Object({"http://www.opengis.net/gml":{innerBoundaryIs:Du.prototype.ll,outerBoundaryIs:Du.prototype.Xn}}),Fm.Ki=Object({"http://www.opengis.net/gml":{coordinates:Ah(Du.prototype.Lh)}}),Fm.fg=Object({"http://www.opengis.net/gml":{Point:Ch(xu.prototype.Sh),MultiPoint:Ch(xu.prototype.Qh),LineString:Ch(xu.prototype.Me),MultiLineString:Ch(xu.prototype.Ph),LinearRing:Ch(xu.prototype.Oh),Polygon:Ch(xu.prototype.Ne),MultiPolygon:Ch(xu.prototype.Rh),Box:Ch(Du.prototype.oo)}}),i(ku,xu),(Fm=ku.prototype).vo=function(t,e){t=Nh([],this.Pi,t,e,this);if(t){e=new $c(null);return Qc(e,t),e}},Fm.wo=function(t,e){t=Nh([],this.Ti,t,e,this);if(t){e=new eu(null);return nu(e,t),e}},Fm.vg=function(t,e){Fh(this.Li,t,e,this)},Fm.si=function(t,e){Fh(this.$i,t,e,this)},Fm.zo=function(t,e){return Nh([null],this.Ui,t,e,this)},Fm.Bo=function(t,e){return Nh([null],this.Zi,t,e,this)},Fm.Ao=function(t,e){return Nh([null],this.Ye,t,e,this)},Fm.uo=function(t,e){return Nh([null],this.Nd,t,e,this)},Fm.nl=function(t,e){t=Nh(void 0,this.Od,t,e,this);t&&e[e.length-1].push(t)},Fm.Ej=function(t,e){t=Nh(void 0,this.Od,t,e,this);t&&(e[e.length-1][0]=t)},Fm.Uh=function(t,e){var i=Nh([null],this.aj,t,e,this);if(i&&i[0]){for(var e=new Yi(null),o=i[0],r=[o.length],n=1,s=i.length;n<s;++n)D(o,i[n]),r.push(o.length);return e.ba("XYZ",o,r),e}},Fm.Jh=function(t,e){t=Nh([null],this.Mi,t,e,this);if(t){e=new Xc(null);return e.ba("XYZ",t),e}},Fm.qo=function(t,e){e=Nh([null],this.Ni,t,e,this);return Ae(e[1][0],e[1][1],e[2][0],e[2][1])},Fm.so=function(t,e){for(var i,o=Eh(t,!1),r=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,n=[];i=r.exec(o);)n.push(parseFloat(i[1])),o=o.substr(i[0].length);if(""===o){if(r="enu","neu"===(r=(o=e[0].srsName)?ai(o).c:r))for(o=0,r=n.length;o<r;o+=3)i=n[o],n[o]=n[o+1],n[o+1]=i;return 2==(o=n.length)&&n.push(0),0===o?void 0:n}},Fm.Rf=function(t,e){var i=Eh(t,!1).replace(/^\s*|\s*$/g,""),o=e[0].srsName,r=t.parentNode.getAttribute("srsDimension"),n="enu";o&&(n=ai(o).c),i=i.split(/\s+/),o=2,t.getAttribute("srsDimension")?o=Au(t.getAttribute("srsDimension")):t.getAttribute("dimension")?o=Au(t.getAttribute("dimension")):r&&(o=Au(r));for(var s,a,l=[],h=0,p=i.length;h<p;h+=o)r=parseFloat(i[h]),s=parseFloat(i[h+1]),a=3===o?parseFloat(i[h+2]):0,"en"===n.substr(0,2)?l.push(r,s,a):l.push(s,r,a);return l},Fm.Nd=Object({"http://www.opengis.net/gml":{pos:Ch(ku.prototype.so),posList:Ch(ku.prototype.Rf)}}),Fm.Ye=Object({"http://www.opengis.net/gml":{interior:ku.prototype.nl,exterior:ku.prototype.Ej}}),Fm.fg=Object({"http://www.opengis.net/gml":{Point:Ch(xu.prototype.Sh),MultiPoint:Ch(xu.prototype.Qh),LineString:Ch(xu.prototype.Me),MultiLineString:Ch(xu.prototype.Ph),LinearRing:Ch(xu.prototype.Oh),Polygon:Ch(xu.prototype.Ne),MultiPolygon:Ch(xu.prototype.Rh),Surface:Ch(ku.prototype.Uh),MultiSurface:Ch(ku.prototype.wo),Curve:Ch(ku.prototype.Jh),MultiCurve:Ch(ku.prototype.vo),Envelope:Ch(ku.prototype.qo)}}),Fm.Pi=Object({"http://www.opengis.net/gml":{curveMember:Ah(ku.prototype.vg),curveMembers:Ah(ku.prototype.vg)}}),Fm.Ti=Object({"http://www.opengis.net/gml":{surfaceMember:Ah(ku.prototype.si),surfaceMembers:Ah(ku.prototype.si)}}),Fm.Li=Object({"http://www.opengis.net/gml":{LineString:Ah(xu.prototype.Me),Curve:Ah(ku.prototype.Jh)}}),Fm.$i=Object({"http://www.opengis.net/gml":{Polygon:Ah(xu.prototype.Ne),Surface:Ah(ku.prototype.Uh)}}),Fm.aj=Object({"http://www.opengis.net/gml":{patches:Ch(ku.prototype.zo)}}),Fm.Mi=Object({"http://www.opengis.net/gml":{segments:Ch(ku.prototype.Bo)}}),Fm.Ni=Object({"http://www.opengis.net/gml":{lowerCorner:Ah(ku.prototype.Rf),upperCorner:Ah(ku.prototype.Rf)}}),Fm.Ui=Object({"http://www.opengis.net/gml":{PolygonPatch:Ch(ku.prototype.Ao)}}),Fm.Zi=Object({"http://www.opengis.net/gml":{LineStringSegment:Ch(ku.prototype.uo)}}),Fm.Gi=function(t,e,i){var o=i[i.length-1].srsName;o&&t.setAttribute("srsName",o),o=Nv(t.namespaceURI,"pos"),t.appendChild(o),t="enu",(i=i[i.length-1].srsName)&&(t=ai(i).c),e=e.Z(),Ru(o,"en"===t.substr(0,2)?e[0]+" "+e[1]:e[1]+" "+e[0])};var y0={"http://www.opengis.net/gml":{lowerCorner:Oh(Ru),upperCorner:Oh(Ru)}};(Fm=ku.prototype).np=function(t,e,i){var o=i[i.length-1].srsName;o&&t.setAttribute("srsName",o),Bh({node:t},y0,Wv,[e[0]+" "+e[1],e[2]+" "+e[3]],i,["lowerCorner","upperCorner"],this)},Fm.Di=function(t,e,i){var o=i[i.length-1].srsName;o&&t.setAttribute("srsName",o),o=Nv(t.namespaceURI,"posList"),t.appendChild(o),zu(o,e,i)},Fm.Yi=function(t,e){var i=e[e.length-1],o=i.node,e=i.exteriorWritten;return void 0===e&&(i.exteriorWritten=!0),Nv(o.namespaceURI,void 0!==e?"interior":"exterior")},Fm.Xe=function(t,e,i){var o=i[i.length-1].srsName;"PolygonPatch"!==t.nodeName&&o&&t.setAttribute("srsName",o),"Polygon"===t.nodeName||"PolygonPatch"===t.nodeName?(e=e.de(),Bh({node:t,srsName:o},b0,this.Yi,e,i,void 0,this)):"Surface"===t.nodeName&&(o=Nv(t.namespaceURI,"patches"),t.appendChild(o),t=Nv(o.namespaceURI,"PolygonPatch"),o.appendChild(t),this.Xe(t,e,i))},Fm.Se=function(t,e,i){var o=i[i.length-1].srsName;"LineStringSegment"!==t.nodeName&&o&&t.setAttribute("srsName",o),"LineString"===t.nodeName||"LineStringSegment"===t.nodeName?(o=Nv(t.namespaceURI,"posList"),t.appendChild(o),zu(o,e,i)):"Curve"===t.nodeName&&(o=Nv(t.namespaceURI,"segments"),t.appendChild(o),t=Nv(o.namespaceURI,"LineStringSegment"),o.appendChild(t),this.Se(t,e,i))},Fm.Fi=function(t,e,i){var o=(r=i[i.length-1]).srsName,r=r.surface;o&&t.setAttribute("srsName",o),e=e.ee(),Bh({node:t,srsName:o,surface:r},m0,this.c,e,i,void 0,this)},Fm.op=function(t,e,i){var o=i[i.length-1].srsName;o&&t.setAttribute("srsName",o),e=e.xe(),Bh({node:t,srsName:o},_0,Dh("pointMember"),e,i,void 0,this)},Fm.Ei=function(t,e,i){var o=(r=i[i.length-1]).srsName,r=r.curve;o&&t.setAttribute("srsName",o),e=e.ud(),Bh({node:t,srsName:o,curve:r},v0,this.c,e,i,void 0,this)},Fm.Hi=function(t,e,i){var o=Nv(t.namespaceURI,"LinearRing");t.appendChild(o),this.Di(o,e,i)},Fm.Ii=function(t,e,i){var o=this.b(e,i);o&&(t.appendChild(o),this.Xe(o,e,i))},Fm.pp=function(t,e,i){var o=Nv(t.namespaceURI,"Point");t.appendChild(o),this.Gi(o,e,i)},Fm.Ci=function(t,e,i){var o=this.b(e,i);o&&(t.appendChild(o),this.Se(o,e,i))},Fm.Ve=function(t,e,i){var o=i[i.length-1],r=rt(o);r.node=t,o=w(e)?o.dataProjection?fi(e,o.featureProjection,o.dataProjection):e:Vc(e,!0,o),Bh(r,x0,this.b,[o],i,void 0,this)},Fm.yi=function(t,e,i){var o=e.Qa();o&&t.setAttribute("fid",o);var r=(o=i[i.length-1]).featureNS,n=e.a;o.Bc||(o.Bc={},o.Bc[r]={});var s=e.R();e=[];var a,l=[];for(a in s){var h=s[a];null!==h&&(e.push(a),l.push(h),a==n||h instanceof gi?a in o.Bc[r]||(o.Bc[r][a]=Oh(this.Ve,this)):a in o.Bc[r]||(o.Bc[r][a]=Oh(Ru)))}(a=rt(o)).node=t,Bh(a,o.Bc,Dh(void 0,r),l,i,e)};var m0={"http://www.opengis.net/gml":{surfaceMember:Oh(ku.prototype.Ii),polygonMember:Oh(ku.prototype.Ii)}},_0={"http://www.opengis.net/gml":{pointMember:Oh(ku.prototype.pp)}},v0={"http://www.opengis.net/gml":{lineStringMember:Oh(ku.prototype.Ci),curveMember:Oh(ku.prototype.Ci)}},b0={"http://www.opengis.net/gml":{exterior:Oh(ku.prototype.Hi),interior:Oh(ku.prototype.Hi)}},x0={"http://www.opengis.net/gml":{Curve:Oh(ku.prototype.Se),MultiCurve:Oh(ku.prototype.Ei),Point:Oh(ku.prototype.Gi),MultiPoint:Oh(ku.prototype.op),LineString:Oh(ku.prototype.Se),MultiLineString:Oh(ku.prototype.Ei),LinearRing:Oh(ku.prototype.Di),Polygon:Oh(ku.prototype.Xe),MultiPolygon:Oh(ku.prototype.Fi),Surface:Oh(ku.prototype.Xe),MultiSurface:Oh(ku.prototype.Fi),Envelope:Oh(ku.prototype.np)}},w0={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};ku.prototype.c=function(t,e){return Nv("http://www.opengis.net/gml",w0[e[e.length-1].node.nodeName])},ku.prototype.b=function(t,e){var i,o=(n=e[e.length-1]).multiSurface,r=n.surface,e=n.curve,n=n.multiCurve;return w(t)?i="Envelope":"MultiPolygon"===(i=t.V())&&!0===o?i="MultiSurface":"Polygon"===i&&!0===r?i="Surface":"LineString"===i&&!0===e?i="Curve":"MultiLineString"===i&&!0===n&&(i="MultiCurve"),Nv("http://www.opengis.net/gml",i)},ku.prototype.o=function(t,e){e=Gc(this,e);var i=Nv("http://www.opengis.net/gml","geom"),o={node:i,srsName:this.srsName,curve:this.g,surface:this.l,multiSurface:this.j,multiCurve:this.i};return e&&nt(o,e),this.Ve(i,t,[o]),i},ku.prototype.f=function(t,e){e=Gc(this,e);var i=Nv("http://www.opengis.net/gml","featureMembers");Vv(i,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",this.schemaLocation);var o={srsName:this.srsName,curve:this.g,surface:this.l,multiSurface:this.j,multiCurve:this.i,featureNS:this.featureNS,featureType:this.featureType};e&&nt(o,e);var r=(o=[o])[o.length-1],n=r.featureType,s=r.featureNS,e={};return e[s]={},e[s][n]=Oh(this.yi,this),(r=rt(r)).node=i,Bh(r,e,Dh(n,s),t,o),i},i(Fu,_u);var M0=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],P0={rte:ju,trk:Zu,wpt:Gu},E0=zh(M0,{rte:Ah(ju),trk:Ah(Zu),wpt:Ah(Gu)}),S0=zh(M0,{text:Lh(Cu,"linkText"),type:Lh(Cu,"linkType")}),T0=zh(M0,{name:Lh(Cu),cmt:Lh(Cu),desc:Lh(Cu),src:Lh(Cu),link:Uu,number:Lh(Tu),extensions:Bu,type:Lh(Cu),rtept:function(t,e){var i=Nh({},A0,t,e);i&&Nu(e[e.length-1].flatCoordinates,t,i)}}),A0=zh(M0,{ele:Lh(Eu),time:Lh(Pu)}),C0=zh(M0,{name:Lh(Cu),cmt:Lh(Cu),desc:Lh(Cu),src:Lh(Cu),link:Uu,number:Lh(Tu),type:Lh(Cu),extensions:Bu,trkseg:function(t,e){var i=e[e.length-1];Fh(I0,t,e),i.ends.push(i.flatCoordinates.length)}}),I0=zh(M0,{trkpt:function(t,e){var i=Nh({},L0,t,e);i&&Nu(e[e.length-1].flatCoordinates,t,i)}}),L0=zh(M0,{ele:Lh(Eu),time:Lh(Pu)}),O0=zh(M0,{ele:Lh(Eu),time:Lh(Pu),magvar:Lh(Eu),geoidheight:Lh(Eu),name:Lh(Cu),cmt:Lh(Cu),desc:Lh(Cu),src:Lh(Cu),link:Uu,sym:Lh(Cu),type:Lh(Cu),fix:Lh(Cu),sat:Lh(Tu),hdop:Lh(Eu),vdop:Lh(Eu),pdop:Lh(Eu),ageofdgpsdata:Lh(Eu),dgpsid:Lh(Tu),extensions:Bu});Fu.prototype.Kh=function(t,e){if(!G(M0,t.namespaceURI))return null;var i=P0[t.localName];return(i=i&&i(t,[Zc(this,t,e)]))?(Vu(this,[i]),i):null},Fu.prototype.jc=function(t,e){if(!G(M0,t.namespaceURI))return[];if("gpx"==t.localName){e=Nh([],E0,t,[Zc(this,t,e)]);if(e)return Vu(this,e),e}return[]};var R0=["text","type"],D0=zh(M0,{text:Oh(Ru),type:Oh(Ru)}),k0=zh(M0,"name cmt desc src link number type rtept".split(" ")),z0=zh(M0,{name:Oh(Ru),cmt:Oh(Ru),desc:Oh(Ru),src:Oh(Ru),link:Oh(Wu),number:Oh(Ou),type:Oh(Ru),rtept:Rh(Oh(Hu))}),F0=zh(M0,"name cmt desc src link number type trkseg".split(" ")),N0=zh(M0,{name:Oh(Ru),cmt:Oh(Ru),desc:Oh(Ru),src:Oh(Ru),link:Oh(Wu),number:Oh(Ou),type:Oh(Ru),trkseg:Rh(Oh(function(t,e,i){Bh({node:t,geometryLayout:e.b,properties:{}},B0,U0,e.Z(),i)}))}),U0=Dh("trkpt"),B0=zh(M0,{trkpt:Oh(Hu)}),j0=zh(M0,"ele time magvar geoidheight name cmt desc src link sym type fix sat hdop vdop pdop ageofdgpsdata dgpsid".split(" ")),Z0=zh(M0,{ele:Oh(Lu),time:Oh(function(t,e){e=(e=new Date(1e3*e)).getUTCFullYear()+"-"+_(e.getUTCMonth()+1)+"-"+_(e.getUTCDate())+"T"+_(e.getUTCHours())+":"+_(e.getUTCMinutes())+":"+_(e.getUTCSeconds())+"Z";t.appendChild(Fv.createTextNode(e))}),magvar:Oh(Lu),geoidheight:Oh(Lu),name:Oh(Ru),cmt:Oh(Ru),desc:Oh(Ru),src:Oh(Ru),link:Oh(Wu),sym:Oh(Ru),type:Oh(Ru),fix:Oh(Ru),sat:Oh(Ou),hdop:Oh(Lu),vdop:Oh(Lu),pdop:Oh(Lu),ageofdgpsdata:Oh(Lu),dgpsid:Oh(Ou)}),G0={Point:"wpt",LineString:"rte",MultiLineString:"trk"},V0=zh(M0,{rte:Oh(function(t,e,i){var o=i[0],r=e.R();t={node:t,properties:r},(e=e.W())&&(e=Vc(e,!0,o),t.geometryLayout=e.b,r.rtept=e.Z()),r=kh(r,o=k0[i[i.length-1].node.namespaceURI]),Bh(t,z0,Wv,r,i,o)}),trk:Oh(function(t,e,i){var o=i[0],r=e.R();t={node:t,properties:r},(e=e.W())&&(e=Vc(e,!0,o),r.trkseg=e.ud()),r=kh(r,o=F0[i[i.length-1].node.namespaceURI]),Bh(t,N0,Wv,r,i,o)}),wpt:Oh(function(t,e,i){var o=i[0],r=i[i.length-1];r.properties=e.R(),(e=e.W())&&(e=Vc(e,!0,o),r.geometryLayout=e.b,Hu(t,e.Z(),i))})});Fu.prototype.f=function(t,e){e=Gc(this,e);var i=Nv("http://www.topografix.com/GPX/1/1","gpx");return Bh({node:i},V0,qu,t,[e]),i},i(Ku,jc),(Fm=Ku.prototype).V=function(){return"text"},Fm.Ub=function(t,e){return this.Fd(u(t)?t:"",Gc(this,e))},Fm.Ca=function(t,e){return this.Pf(u(t)?t:"",Gc(this,e))},Fm.Uc=function(t,e){return this.Hd(u(t)?t:"",Gc(this,e))},Fm.Ka=function(){return this.defaultDataProjection},Fm.Ld=function(t,e){return this.Te(t,Gc(this,e))},Fm.Wb=function(t,e){return this.zi(t,Gc(this,e))},Fm.Zc=function(t,e){return this.Md(t,Gc(this,e))},i($u,Ku);var W0=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,H0=/^H.([A-Z]{3}).*?:(.*)/,q0=/^HFDTE(\d{2})(\d{2})(\d{2})/;$u.prototype.Fd=function(t,e){for(var i=this.a,o=Yu(t),r={},n=[],s=2e3,a=0,l=1,h=0,p=o.length;h<p;++h){var c,u,d,f,g,y=o[h];"B"==y.charAt(0)?(c=W0.exec(y))&&(y=parseInt(c[1],10),u=parseInt(c[2],10),d=parseInt(c[3],10),f=parseInt(c[4],10)+parseInt(c[5],10)/6e4,"S"==c[6]&&(f=-f),g=parseInt(c[7],10)+parseInt(c[8],10)/6e4,"W"==c[9]&&(g=-g),n.push(g,f),"none"!=i&&n.push("gps"==i?parseInt(c[11],10):"barometric"==i?parseInt(c[12],10):0),n.push(Date.UTC(s,a,l,y,u,d)/1e3)):"H"==y.charAt(0)&&((c=q0.exec(y))?(l=parseInt(c[1],10),a=parseInt(c[2],10)-1,s=2e3+parseInt(c[3],10)):(c=H0.exec(y))&&(r[c[1]]=c[2].trim(),q0.exec(y)))}return 0===n.length?null:((o=new Xc(null)).ba("none"==i?"XYM":"XYZM",n),(i=new Bl(Vc(o,!1,e))).I(r),i)},$u.prototype.Pf=function(t,e){e=this.Fd(t,e);return e?[e]:[]},Ju.prototype.toString=function(){var t=[],e=this.c;e&&t.push(nd(e,Y0,!0),":");var i=this.f;return!i&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(nd(e,Y0,!0),"@"),t.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.l)&&t.push(":",String(i))),(i=this.a)&&(this.f&&"/"!=i.charAt(0)&&t.push("/"),t.push(nd(i,"/"==i.charAt(0)?K0:X0,!0))),(i=this.b.toString())&&t.push("?",i),(i=this.g)&&t.push("#",nd(i,J0)),t.join("")},Ju.prototype.clone=function(){return new Ju(this)};var Y0=/[#\/\?@]/g,X0=/[\#\?:]/g,K0=/[\#\?]/g,$0=/[\#\?@]/g,J0=/#/g;(Fm=ad.prototype).sc=function(){return ld(this),this.f},Fm.remove=function(t){return ld(this),t=cd(this,t),!!an(this.a.f,t)&&(this.b=null,this.f-=this.a.get(t).length,this.a.remove(t))},Fm.clear=function(){this.a=this.b=null,this.f=0},Fm.Na=function(){return ld(this),0==this.f},Fm.P=function(){ld(this);for(var t=this.a.wc(),e=this.a.P(),i=[],o=0;o<e.length;o++)for(var r=t[o],n=0;n<r.length;n++)i.push(e[o]);return i},Fm.wc=function(t){ld(this);var e=[];if(u(t))hd(this,t)&&(e=L(e,this.a.get(cd(this,t))));else{t=this.a.wc();for(var i=0;i<t.length;i++)e=L(e,t[i])}return e},Fm.set=function(t,e){return ld(this),this.b=null,hd(this,t=cd(this,t))&&(this.f-=this.a.get(t).length),this.a.set(t,[e]),this.f++,this},Fm.get=function(t,e){t=t?this.wc(t):[];return 0<t.length?String(t[0]):e},Fm.toString=function(){if(this.b)return this.b;if(!this.a)return"";for(var t=[],e=this.a.P(),i=0;i<e.length;i++)for(var o=e[i],r=encodeURIComponent(String(o)),o=this.wc(o),n=0;n<o.length;n++){var s=r;""!==o[n]&&(s+="="+encodeURIComponent(String(o[n]))),t.push(s)}return this.b=t.join("&")},Fm.clone=function(){var t=new ad;return t.b=this.b,this.a&&(t.a=this.a.clone(),t.f=this.f),t},(Fm=ud.prototype).Tj=function(){return this.b},Fm.gk=function(){return this.c},Fm.hk=function(){return this.g},Fm.In=function(){return this.a},Fm.Jn=function(){return this.i},Fm.Kn=function(){return this.f},Fm.Ln=function(){return this.j},Fm.Da=function(){return this.G},Fm.uk=function(){return this.l},Fm.vk=function(){return this.o},Fm.To=function(t){this.b=t},Fm.ji=function(t){this.c=t},Fm.ki=function(t){this.g=t},Fm.So=function(t){this.a=t},Fm.Mn=function(t){this.i=t},Fm.Nn=function(t){this.f=t},Fm.Zo=function(t){this.j=t},Fm.mi=function(t){this.G=t},Fm.ni=function(t){this.l=t},Fm.$o=function(t){this.o=t},i(dd,_u);var Q0=["http://www.google.com/kml/ext/2.2"],t1=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],e1=[255,255,255,1],i1=new Ra({color:e1}),o1=[20,2],r1=[64,64],n1=new us({anchor:o1,anchorOrigin:"bottom-left",anchorXUnits:"pixels",anchorYUnits:"pixels",crossOrigin:"anonymous",rotation:0,scale:.5,size:r1,src:"https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png"}),s1=new Na({color:e1,width:1}),a1=new ud({font:"bold 16px Helvetica",fill:i1,stroke:new Na({color:[51,51,51,1],width:2}),scale:.8}),l1=[new ja({fill:i1,image:n1,text:a1,stroke:s1,zIndex:0})],h1={fraction:"fraction",pixels:"pixels"},p1=zh(t1,{value:Ch(Cu)}),c1=zh(t1,{Data:function(t,e){var i=t.getAttribute("name");null===i||(t=Nh(void 0,p1,t,e))&&(e[e.length-1][i]=t)},SchemaData:function(t,e){Fh(I1,t,e)}}),u1=zh(t1,{extrude:Lh(wu),altitudeMode:Lh(Cu)}),d1=zh(t1,{coordinates:Ch(md)}),f1=zh(t1,{innerBoundaryIs:function(t,e){t=Nh(void 0,v1,t,e);t&&e[e.length-1].push(t)},outerBoundaryIs:function(t,e){t=Nh(void 0,S1,t,e);t&&(e[e.length-1][0]=t)}}),g1=zh(t1,{when:function(t,e){var i=e[e.length-1].wi,o=Eh(t,!1);(o=/^\s*(\d{4})($|-(\d{2})($|-(\d{2})($|T(\d{2}):(\d{2}):(\d{2})(Z|(?:([+\-])(\d{2})(?::(\d{2}))?)))))\s*$/.exec(o))?(e=Date.UTC(parseInt(o[1],10),o[3]?parseInt(o[3],10)-1:0,o[5]?parseInt(o[5],10):1,o[7]?parseInt(o[7],10):0,o[8]?parseInt(o[8],10):0,o[9]?parseInt(o[9],10):0),o[10]&&"Z"!=o[10]&&(e+=60*(t="-"==o[11]?-1:1)*parseInt(o[12],10),o[13]&&(e+=3600*t*parseInt(o[13],10))),i.push(e)):i.push(0)}},zh(Q0,{coord:function(t,e){e=e[e.length-1].A,t=Eh(t,!1);(t=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(t))?e.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),0):e.push(0,0,0,0)}})),y1=zh(t1,{coordinates:Ch(md)}),m1=zh(t1,{href:Lh(_d)},zh(Q0,{x:Lh(Eu),y:Lh(Eu),w:Lh(Eu),h:Lh(Eu)})),_1=zh(t1,{Icon:Lh(function(t,e){e=Nh({},m1,t,e);return e||null}),heading:Lh(Eu),hotSpot:Lh(function(t){var e=t.getAttribute("xunits"),i=t.getAttribute("yunits");return{x:parseFloat(t.getAttribute("x")),dg:h1[e],y:parseFloat(t.getAttribute("y")),eg:h1[i]}}),scale:Lh(vd)}),v1=zh(t1,{LinearRing:Ch(bd)}),b1=zh(t1,{color:Lh(yd),scale:Lh(vd)}),x1=zh(t1,{color:Lh(yd),width:Lh(Eu)}),w1=zh(t1,{LineString:Ah(wd),LinearRing:Ah(Md),MultiGeometry:Ah(Pd),Point:Ah(Ed),Polygon:Ah(Sd)}),M1=zh(Q0,{Track:Ah(xd)}),P1=zh(t1,{ExtendedData:Cd,Link:function(t,e){Fh(E1,t,e)},address:Lh(Cu),description:Lh(Cu),name:Lh(Cu),open:Lh(wu),phoneNumber:Lh(Cu),visibility:Lh(wu)}),E1=zh(t1,{href:Lh(_d)}),S1=zh(t1,{LinearRing:Ch(bd)}),T1=zh(t1,{Style:Lh(Td),key:Lh(Cu),styleUrl:Lh(function(t){var e=Eh(t,!1).trim();return t.baseURI?od(t.baseURI,e).toString():e})}),A1=zh(t1,{ExtendedData:Cd,MultiGeometry:Lh(Pd,"geometry"),LineString:Lh(wd,"geometry"),LinearRing:Lh(Md,"geometry"),Point:Lh(Ed,"geometry"),Polygon:Lh(Sd,"geometry"),Style:Lh(Td),StyleMap:function(t,e){t=Nh(void 0,O1,t,e);t&&(e=e[e.length-1],w(t)?e.Style=t:u(t)&&(e.styleUrl=t))},address:Lh(Cu),description:Lh(Cu),name:Lh(Cu),open:Lh(wu),phoneNumber:Lh(Cu),styleUrl:Lh(_d),visibility:Lh(wu)},zh(Q0,{MultiTrack:Lh(function(t,e){t=Nh([],M1,t,e);if(t){e=new $c(null);return Qc(e,t),e}},"geometry"),Track:Lh(xd,"geometry")})),C1=zh(t1,{color:Lh(yd),fill:Lh(wu),outline:Lh(wu)}),I1=zh(t1,{SimpleData:function(t,e){var i=t.getAttribute("name");null!==i&&(t=Cu(t),e[e.length-1][i]=t)}}),L1=zh(t1,{IconStyle:function(t,e){var i,o,r,n,s,a,l,h,p,c=Nh({},_1,t,e);c&&(i=e[e.length-1],o=(o=(p="Icon"in c?c.Icon:{}).href)?o:"https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",(t=c.hotSpot)?(r=[t.x,t.y],n=t.dg,s=t.eg):"https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png"===o?(r=o1,s=n="pixels"):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(o)&&(r=[.5,0],s=n="fraction"),t=p.x,e=p.y,void 0!==t&&void 0!==e&&(a=[t,e]),t=p.w,p=p.h,void 0!==t&&void 0!==p&&(l=[t,p]),void 0!==(p=c.heading)&&(h=E(p)),c=c.scale,"https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png"==o&&(l=r1,void 0===c&&(c=.5)),r=new us({anchor:r,anchorOrigin:"bottom-left",anchorXUnits:n,anchorYUnits:s,crossOrigin:"anonymous",offset:a,offsetOrigin:"bottom-left",rotation:h,scale:c,size:l,src:o}),i.imageStyle=r)},LabelStyle:function(t,e){t=Nh({},b1,t,e);t&&(e[e.length-1].textStyle=new ud({fill:new Ra({color:"color"in t?t.color:e1}),scale:t.scale}))},LineStyle:function(t,e){t=Nh({},x1,t,e);t&&(e[e.length-1].strokeStyle=new Na({color:"color"in t?t.color:e1,width:"width"in t?t.width:1}))},PolyStyle:function(t,e){var i=Nh({},C1,t,e);i&&((t=e[e.length-1]).fillStyle=new Ra({color:"color"in i?i.color:e1}),void 0!==(e=i.fill)&&(t.fill=e),void 0!==(i=i.outline)&&(t.outline=i))}}),O1=zh(t1,{Pair:function(t,e){var i=Nh({},T1,t,e);!i||(t=i.key)&&"normal"==t&&((t=i.styleUrl)&&(e[e.length-1]=t),(i=i.Style)&&(e[e.length-1]=i))}});(Fm=dd.prototype).Lf=function(t,e){var i;return Uv(t),(i=Nh([],i=zh(t1,{Document:Th(this.Lf,this),Folder:Th(this.Lf,this),Placemark:Ah(this.Tf,this),Style:this.Do.bind(this),StyleMap:this.Co.bind(this)}),t,e,this))?i:void 0},Fm.Tf=function(t,e){var i=Nh({geometry:null},A1,t,e);if(i){var o=new Bl;null!==(t=t.getAttribute("id"))&&o.kc(t);t=e[0],e=i.geometry;return e&&Vc(e,!1,t),o.Oa(e),delete i.geometry,this.c&&o.Bf(gd(i.Style,i.styleUrl,this.b,this.a,this.g)),delete i.Style,o.I(i),o}},Fm.Do=function(t,e){var i=t.getAttribute("id");null===i||(e=Td(t,e))&&(i=t.baseURI?od(t.baseURI,"#"+i).toString():"#"+i,this.a[i]=e)},Fm.Co=function(t,e){var i=t.getAttribute("id");null===i||(e=Nh(void 0,O1,t,e))&&(i=t.baseURI?od(t.baseURI,"#"+i).toString():"#"+i,this.a[i]=e)},Fm.Kh=function(t,e){if(!G(t1,t.namespaceURI))return null;e=this.Tf(t,[Zc(this,t,e)]);return e||null},Fm.jc=function(t,e){if(!G(t1,t.namespaceURI))return[];if("Document"==(i=Uv(t))||"Folder"==i)return(i=this.Lf(t,[Zc(this,t,e)]))?i:[];if("Placemark"==i)return(i=this.Tf(t,[Zc(this,t,e)]))?[i]:[];if("kml"!=i)return[];for(var i=[],o=t.firstElementChild;o;o=o.nextElementSibling){var r=this.jc(o,e);r&&D(i,r)}return i},Fm.xo=function(t){return Bv(t)?Id(this,t):jv(t)?Ld(this,t):u(t)?Id(this,t=Sh(t)):void 0},Fm.yo=function(t){var e=[];return Bv(t)?D(e,Od(this,t)):jv(t)?D(e,Rd(this,t)):u(t)&&D(e,Od(this,t=Sh(t))),e};var R1,D1,k1,z1,F1=zh(t1,["Document","Placemark"]),N1=zh(t1,{Document:Oh(function(t,e,i){Bh({node:t},U1,jd,e,i,void 0,this)}),Placemark:Oh(zd)}),U1=zh(t1,{Placemark:Oh(zd)}),B1={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry"},j1=zh(t1,["href"],zh(Q0,["x","y","w","h"])),Z1=zh(t1,{href:Oh(Ru)},zh(Q0,{x:Oh(Lu),y:Oh(Lu),w:Oh(Lu),h:Oh(Lu)})),G1=zh(t1,["scale","heading","Icon","hotSpot"]),V1=zh(t1,{Icon:Oh(function(t,e,i){t={node:t};var o=j1[i[i.length-1].node.namespaceURI],r=kh(e,o);Bh(t,Z1,Wv,r,i,o),r=kh(e,o=j1[Q0[0]]),Bh(t,Z1,Bd,r,i,o)}),heading:Oh(Lu),hotSpot:Oh(function(t,e){t.setAttribute("x",e.x),t.setAttribute("y",e.y),t.setAttribute("xunits",e.dg),t.setAttribute("yunits",e.eg)}),scale:Oh(Ud)}),W1=zh(t1,["color","scale"]),H1=zh(t1,{color:Oh(Dd),scale:Oh(Ud)}),q1=zh(t1,["color","width"]),Y1=zh(t1,{color:Oh(Dd),width:Oh(Lu)}),X1=zh(t1,{LinearRing:Oh(Fd)}),K1=zh(t1,{LineString:Oh(Fd),Point:Oh(Fd),Polygon:Oh(Nd)}),$1=zh(t1,"name open visibility address phoneNumber description styleUrl Style".split(" ")),J1=zh(t1,{MultiGeometry:Oh(function(t,e,i){t={node:t};var o,r,n=e.V();"MultiPoint"==n?(o=e.xe(),r=ab):"MultiLineString"==n?(o=e.ud(),r=lb):"MultiPolygon"==n&&(o=e.ee(),r=pb),Bh(t,K1,r,o,i)}),LineString:Oh(Fd),LinearRing:Oh(Fd),Point:Oh(Fd),Polygon:Oh(Nd),Style:Oh(function(t,e,i){t={node:t};var o={},r=e.g,n=e.b,s=e.f;e=e.Da(),s instanceof us&&(o.IconStyle=s),e&&(o.LabelStyle=e),n&&(o.LineStyle=n),r&&(o.PolyStyle=r),o=kh(o,e=ib[i[i.length-1].node.namespaceURI]),Bh(t,ob,Wv,o,i,e)}),address:Oh(Ru),description:Oh(Ru),name:Oh(Ru),open:Oh(Iu),phoneNumber:Oh(Ru),styleUrl:Oh(Ru),visibility:Oh(Iu)}),Q1=zh(t1,{coordinates:Oh(function(t,e,i){var o,r=(i=i[i.length-1]).layout;i=i.stride,"XY"==r||"XYM"==r?o=2:"XYZ"!=r&&"XYZM"!=r||(o=3);var n,s=e.length,a="";if(0<s){for(a+=e[0],r=1;r<o;++r)a+=","+e[r];for(n=i;n<s;n+=i)for(a+=" "+e[n],r=1;r<o;++r)a+=","+e[n+r]}Ru(t,a)})}),tb=zh(t1,{outerBoundaryIs:Oh(kd),innerBoundaryIs:Oh(kd)}),eb=zh(t1,{color:Oh(Dd)}),ib=zh(t1,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),ob=zh(t1,{IconStyle:Oh(function(t,e,i){t={node:t};var o,r,n={},s=e.Eb(),a=e.td(),l={href:e.a.l};s&&(l.w=s[0],l.h=s[1],o=e.Yb(),(r=e.Ea())&&a&&0!==r[0]&&r[1]!==s[1]&&(l.x=r[0],l.y=a[1]-(r[1]+s[1])),o&&0!==o[0]&&o[1]!==s[1]&&(n.hotSpot={x:o[0],dg:"pixels",y:s[1]-o[1],eg:"pixels"})),n.Icon=l,1!==(s=e.j)&&(n.scale=s),0!==(e=e.G)&&(n.heading=e),n=kh(n,e=G1[i[i.length-1].node.namespaceURI]),Bh(t,V1,Wv,n,i,e)}),LabelStyle:Oh(function(t,e,i){t={node:t};var o={},r=e.a;r&&(o.color=r.a),(e=e.f)&&1!==e&&(o.scale=e),o=kh(o,e=W1[i[i.length-1].node.namespaceURI]),Bh(t,H1,Wv,o,i,e)}),LineStyle:Oh(function(t,e,i){t={node:t};var o=q1[i[i.length-1].node.namespaceURI];e=kh({color:e.a,width:e.f},o),Bh(t,Y1,Wv,e,i,o)}),PolyStyle:Oh(function(t,e,i){Bh({node:t},eb,rb,[e.a],i)})}),rb=Dh("color"),nb=Dh("coordinates"),sb=Dh("innerBoundaryIs"),ab=Dh("Point"),lb=Dh("LineString"),hb=Dh("LinearRing"),pb=Dh("Polygon"),cb=Dh("outerBoundaryIs");dd.prototype.f=function(t,e){e=Gc(this,e);var i=Nv(t1[4],"kml");Vv(i,"http://www.w3.org/2000/xmlns/","xmlns:gx",Q0[0]),Vv(i,"http://www.w3.org/2000/xmlns/","xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),Vv(i,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var o={node:i},r={};1<t.length?r.Document=t:1==t.length&&(r.Placemark=t[0]);t=F1[i.namespaceURI],r=kh(r,t);return Bh(o,N1,Wv,r,[e],t,this),i},z1={ka:k1={}},function(t){"object"==typeof k1&&void 0!==z1?z1.ka=t():("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Ip=t()}(function(){return function o(r,n,s){function a(i,t){if(!n[i]){if(!r[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(l)return l(i,!0);throw(e=Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",e}e=n[i]={ka:{}},r[i][0].call(e.ka,function(t){var e=r[i][1][t];return a(e||t)},e,e.ka,o,r,n,s)}return n[i].ka}for(var l="function"==typeof require&&require,t=0;t<s.length;t++)a(s[t]);return a}({1:[function(t,e){function i(t){var e;return t&&t.length&&(t=(e=t).length),t=new Uint8Array(t||0),e&&t.set(e),t.Vh=a.Vh,t.cg=a.cg,t.Nh=a.Nh,t.Bi=a.Bi,t.Sf=a.Sf,t.Ai=a.Ai,t.Mf=a.Mf,t.xi=a.xi,t.toString=a.toString,t.write=a.write,t.slice=a.slice,t.tg=a.tg,t.jj=!0,t}function r(t){for(var e,i,o=t.length,r=[],n=0;n<o;n++){if(55295<(e=t.charCodeAt(n))&&e<57344){if(!i){56319<e||n+1===o?r.push(239,191,189):i=e;continue}if(e<56320){r.push(239,191,189),i=e;continue}e=i-55296<<10|e-56320|65536,i=null}else i&&(r.push(239,191,189),i=null);e<128?r.push(e):e<2048?r.push(e>>6|192,63&e|128):e<65536?r.push(e>>12|224,e>>6&63|128,63&e|128):r.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}return r}e.ka=i;var n,s,o=t("ieee754"),a={Vh:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},cg:function(t,e){this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24},Nh:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+(this[t+3]<<24)},Sf:function(t){return o.read(this,t,!0,23,4)},Mf:function(t){return o.read(this,t,!0,52,8)},Ai:function(t,e){return o.write(this,t,e,!0,23,4)},xi:function(t,e){return o.write(this,t,e,!0,52,8)},toString:function(t,e,i){var o=t="";for(i=Math.min(this.length,i||this.length),e=e||0;e<i;e++){var r=this[e];r<=127?(t+=decodeURIComponent(o)+String.fromCharCode(r),o=""):o+="%"+r.toString(16)}return t+decodeURIComponent(o)},write:function(t,e){for(var i=t===n?s:r(t),o=0;o<i.length;o++)this[e+o]=i[o]},slice:function(t,e){return this.subarray(t,e)},tg:function(t,e){e=e||0;for(var i=0;i<this.length;i++)t[e+i]=this[i]}};a.Bi=a.cg,i.byteLength=function(t){return(s=r(n=t)).length},i.isBuffer=function(t){return!(!t||!t.jj)}},{ieee754:3}],2:[function(o,r){!function(t){function e(t){this.Hb=i.isBuffer(t)?t:new i(t||0),this.ca=0,this.length=this.Hb.length}r.ka=e;var i=t.qp||o("./buffer");e.c=0,e.b=1,e.a=2,e.f=5;var n=Math.pow(2,63);e.prototype={Qf:function(t,e,i){for(i=i||this.length;this.ca<i;){var o=this.Aa(),r=this.ca;t(o>>3,e,this),this.ca===r&&this.fp(o)}return e},to:function(){var t=this.Hb.Sf(this.ca);return this.ca+=4,t},po:function(){var t=this.Hb.Mf(this.ca);return this.ca+=8,t},Aa:function(){var t,e,i,o=this.Hb,r=o[this.ca++];if(r<128)return r;if(r&=127,(t=o[this.ca++])<128)return r|t<<7;if(t=(127&t)<<7,(e=o[this.ca++])<128)return r|t|e<<14;if(e=(127&e)<<14,(i=o[this.ca++])<128)return r|t|e|i<<21;if(r=(r|t|e|(127&i)<<21)+268435456*(127&(i=o[this.ca++])),i<128)return r;if(r+=34359738368*(127&(i=o[this.ca++])),i<128)return r;if(r+=4398046511104*(127&(i=o[this.ca++])),i<128)return r;if(r+=562949953421312*(127&(i=o[this.ca++])),i<128)return r;if(r+=72057594037927940*(127&(i=o[this.ca++])),i<128)return r;if(r+=0x8000000000000000*(127&(i=o[this.ca++])),i<128)return r;throw Error("Expected varint not more than 10 bytes")},Eo:function(){var t=this.ca;if((r=this.Aa())<n)return r;for(var e=this.ca-2;255===this.Hb[e];)e--;e<t&&(e=t);for(var i=r=0;i<e-t+1;i++)var o=127&~this.Hb[t+i],r=r+(i<4?o<<7*i:o*Math.pow(2,7*i));return-r-1},Id:function(){var t=this.Aa();return 1==t%2?(t+1)/-2:t/2},no:function(){return Boolean(this.Aa())},Vf:function(){var t=this.Aa()+this.ca,e=this.Hb.toString("utf8",this.ca,t);return this.ca=t,e},fp:function(t){if((t&=7)===e.c)for(;127<this.Hb[this.ca++];);else if(t===e.a)this.ca=this.Aa()+this.ca;else if(t===e.f)this.ca+=4;else{if(t!==e.b)throw Error("Unimplemented type: "+t);this.ca+=8}}}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./buffer":1}],3:[function(t,e,i){i.read=function(t,e,i,o,r){var n=8*r-o-1,s=(1<<n)-1,a=s>>1,l=-7,h=i?-1:1,p=t[e+(r=i?r-1:0)];for(r+=h,i=p&(1<<-l)-1,p>>=-l,l+=n;0<l;i=256*i+t[e+r],r+=h,l-=8);for(n=i&(1<<-l)-1,i>>=-l,l+=o;0<l;n=256*n+t[e+r],r+=h,l-=8);if(0===i)i=1-a;else{if(i===s)return n?NaN:1/0*(p?-1:1);n+=Math.pow(2,o),i-=a}return(p?-1:1)*n*Math.pow(2,i-o)},i.write=function(t,e,i,o,r,n){var s,a=8*n-r-1,l=(1<<a)-1,h=l>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0;n=o?0:n-1;var c=o?1:-1,u=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(e=isNaN(e)?1:0,o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(s=Math.pow(2,-o))<1&&(o--,s*=2),2<=(e=1<=o+h?e+p/s:e+p*Math.pow(2,1-h))*s&&(o++,s/=2),l<=o+h?(e=0,o=l):1<=o+h?(e=(e*s-1)*Math.pow(2,r),o+=h):(e=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));8<=r;t[i+n]=255&e,n+=c,e/=256,r-=8);for(o=o<<r|e,a+=r;0<a;t[i+n]=255&o,n+=c,o/=256,a-=8);t[i+n-c]|=128*u}},{}]},{},[2])(2)}),Dv=z1.ka,D1={ka:R1={}},function(t){"object"==typeof R1&&void 0!==D1?D1.ka=t():("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Kp=t()}(function(){return function o(r,n,s){function a(i,t){if(!n[i]){if(!r[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(l)return l(i,!0);throw(e=Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",e}e=n[i]={ka:{}},r[i][0].call(e.ka,function(t){var e=r[i][1][t];return a(e||t)},e,e.ka,o,r,n,s)}return n[i].ka}for(var l="function"==typeof require&&require,t=0;t<s.length;t++)a(s[t]);return a}({1:[function(t,e){e.ka.bj=t("./lib/vectortile.js"),e.ka.Dp=t("./lib/vectortilefeature.js"),e.ka.Ep=t("./lib/vectortilelayer.js")},{"./lib/vectortile.js":2,"./lib/vectortilefeature.js":3,"./lib/vectortilelayer.js":4}],2:[function(t,e){function i(t,e,i){3===t&&((t=new o(i,i.Aa()+i.ca)).length&&(e[t.name]=t))}var o=t("./vectortilelayer");e.ka=function(t,e){this.layers=t.Qf(i,{},e)}},{"./vectortilelayer":4}],3:[function(t,e){function i(t,e,i,o,r){this.properties={},this.extent=i,this.type=0,this.pc=t,this.af=-1,this.Rd=o,this.Td=r,t.Qf(n,this,e)}function n(t,e,i){if(1==t)e.Gp=i.Aa();else if(2==t)for(t=i.Aa()+i.ca;i.ca<t;){var o=e.Rd[i.Aa()],r=e.Td[i.Aa()];e.properties[o]=r}else 3==t?e.type=i.Aa():4==t&&(e.af=i.ca)}var l=t("point-geometry");(e.ka=i).types=["Unknown","Point","LineString","Polygon"],i.prototype.Wg=function(){var t=this.pc;t.ca=this.af;for(var e,i=t.Aa()+t.ca,o=1,r=0,n=0,s=0,a=[];t.ca<i;)if(r||(o=7&(r=t.Aa()),r>>=3),r--,1===o||2===o)n+=t.Id(),s+=t.Id(),1===o&&(e&&a.push(e),e=[]),e.push(new l(n,s));else{if(7!==o)throw Error("unknown command "+o);e&&e.push(e[0].clone())}return e&&a.push(e),a},i.prototype.bbox=function(){var t=this.pc;t.ca=this.af;for(var e=t.Aa()+t.ca,i=1,o=0,r=0,n=0,s=1/0,a=-1/0,l=1/0,h=-1/0;t.ca<e;)if(o||(i=7&(o=t.Aa()),o>>=3),o--,1===i||2===i)(r+=t.Id())<s&&(s=r),a<r&&(a=r),(n+=t.Id())<l&&(l=n),h<n&&(h=n);else if(7!==i)throw Error("unknown command "+i);return[s,l,a,h]}},{"point-geometry":5}],4:[function(t,e){function i(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this.pc=t,this.Rd=[],this.Td=[],this.Qd=[],t.Qf(o,this,e),this.length=this.Qd.length}function o(t,e,i){15===t?e.version=i.Aa():1===t?e.name=i.Vf():5===t?e.extent=i.Aa():2===t?e.Qd.push(i.ca):3===t?e.Rd.push(i.Vf()):4===t&&e.Td.push(function(t){for(var e=null,i=t.Aa()+t.ca;t.ca<i;)e=1==(e=t.Aa()>>3)?t.Vf():2===e?t.to():3===e?t.po():4===e?t.Eo():5===e?t.Aa():6===e?t.Id():7===e?t.no():null;return e}(i))}var r=t("./vectortilefeature.js");(e.ka=i).prototype.feature=function(t){if(t<0||t>=this.Qd.length)throw Error("feature index out of bounds");return this.pc.ca=this.Qd[t],t=this.pc.Aa()+this.pc.ca,new r(this.pc,t,this.extent,this.Rd,this.Td)}},{"./vectortilefeature.js":3}],5:[function(t,e){function i(t,e){this.x=t,this.y=e}(e.ka=i).prototype={clone:function(){return new i(this.x,this.y)},rotate:function(t){return this.clone().mj(t)},round:function(){return this.clone().nj()},angle:function(){return Math.atan2(this.y,this.x)},mj:function(t){var e=Math.cos(t),i=(t=Math.sin(t))*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=i,this},nj:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.a=function(t){return!(t instanceof i)&&Array.isArray(t)?new i(t[0],t[1]):t}},{}]},{},[1])(1)}),kv=D1.ka,i(Gd,jc),Gd.prototype.V=function(){return"arraybuffer"},Gd.prototype.Ca=function(t,e){var i,o=this.b,r=new Dv(t),r=new kv.bj(r),n=[],s=this.a;for(i in r.layers)if(!o||-1!=o.indexOf(i))for(var a,l,h,p,c,u,d,f,g,y=0,m=(a=r.layers[i]).length;y<m;++y)s===Ml?(l=i,Vd(h=(d=a.feature(y)).Wg(),g=[],p=[]),f=void 0,1===(c=d.type)?f=1===h.length?"Point":"MultiPoint":2===c?f=1===h.length?"LineString":"MultiLineString":3===c&&(f="Polygon"),(d=d.properties)[this.f]=l,l=new this.a(f,g,p,d)):(d=a.feature(y),f=i,g=e,l=new this.a,(p=d.properties)[this.f]=f,(g=Vc(f=0===(f=d.type)?null:(Vd(d=d.Wg(),c=[],h=[]),u=void 0,1===f?u=new(1===d.length?Fi:tu)(null):2===f?u=new(1===d.length?Xc:$c)(null):3===f&&(u=new Yi(null)),u.ba("XY",c,h),u),!1,Gc(this,g)))&&(p[this.c]=g),l.I(p),l.Cc(this.c)),n.push(l);return n},Gd.prototype.Ka=function(){return this.defaultDataProjection},Gd.prototype.g=function(t){this.b=t},i(Wd,_u);var W_=[null],ub=zh(W_,{nd:function(t,e){e[e.length-1].Pc.push(t.getAttribute("ref"))},tag:Hd}),db=zh(W_,{node:function(t,e){var i=e[0],o=e[e.length-1],r=t.getAttribute("id"),n=[parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))];o.Zg[r]=n;e=Nh({Kd:{}},fb,t,e);tt(e.Kd)||(Vc(n=new Fi(n),!1,i),(i=new Bl(n)).kc(r),i.I(e.Kd),o.features.push(i))},way:function(t,e){for(var i=e[0],o=t.getAttribute("id"),r=Nh({Pc:[],Kd:{}},ub,t,e),n=e[e.length-1],s=[],a=0,l=r.Pc.length;a<l;a++)D(s,n.Zg[r.Pc[a]]);r.Pc[0]==r.Pc[r.Pc.length-1]?(a=new Yi(null)).ba("XY",s,[s.length]):(a=new Xc(null)).ba("XY",s),Vc(a,!1,i),(i=new Bl(a)).kc(o),i.I(r.Kd),n.features.push(i)}}),fb=zh(W_,{tag:Hd});Wd.prototype.jc=function(t,e){e=Zc(this,t,e);return"osm"==t.localName&&(e=Nh({Zg:{},features:[]},db,t,[e])).features?e.features:[]},Yd.prototype.read=function(t){return Bv(t)?this.f(t):jv(t)?this.a(t):u(t)?(t=Sh(t),this.f(t)):null},i(Xd,Yd),Xd.prototype.f=function(t){for(t=t.firstChild;t;t=t.nextSibling)if(1==t.nodeType)return this.a(t);return null},Xd.prototype.a=function(t){return(t=Nh({},gb,t,[]))?t:null};var Pm=[null,"http://www.opengis.net/ows/1.1"],gb=zh(Pm,{ServiceIdentification:Lh(function(t,e){return Nh({},Tb,t,e)}),ServiceProvider:Lh(function(t,e){return Nh({},Ab,t,e)}),OperationsMetadata:Lh(function(t,e){return Nh({},Mb,t,e)})}),yb=zh(Pm,{DeliveryPoint:Lh(Cu),City:Lh(Cu),AdministrativeArea:Lh(Cu),PostalCode:Lh(Cu),Country:Lh(Cu),ElectronicMailAddress:Lh(Cu)}),mb=zh(Pm,{Value:Ih(Cu)}),_b=zh(Pm,{AllowedValues:Lh(function(t,e){return Nh({},mb,t,e)})}),vb=zh(Pm,{Phone:Lh(function(t,e){return Nh({},Pb,t,e)}),Address:Lh(function(t,e){return Nh({},yb,t,e)})}),bb=zh(Pm,{HTTP:Lh(function(t,e){return Nh({},xb,t,e)})}),xb=zh(Pm,{Get:Ih(function(t,e){var i=qd(t);return i?Nh({href:i},Eb,t,e):void 0}),Post:void 0}),wb=zh(Pm,{DCP:Lh(function(t,e){return Nh({},bb,t,e)})}),Mb=zh(Pm,{Operation:function(t,e){var i=t.getAttribute("name"),t=Nh({},wb,t,e);t&&(e[e.length-1][i]=t)}}),Pb=zh(Pm,{Voice:Lh(Cu),Facsimile:Lh(Cu)}),Eb=zh(Pm,{Constraint:Ih(function(t,e){var i=t.getAttribute("name");return i?Nh({name:i},_b,t,e):void 0})}),Sb=zh(Pm,{IndividualName:Lh(Cu),PositionName:Lh(Cu),ContactInfo:Lh(function(t,e){return Nh({},vb,t,e)})}),Tb=zh(Pm,{Title:Lh(Cu),ServiceTypeVersion:Lh(Cu),ServiceType:Lh(Cu)}),Ab=zh(Pm,{ProviderName:Lh(Cu),ProviderSite:Lh(qd),ServiceContact:Lh(function(t,e){return Nh({},Sb,t,e)})});i($d,Ku),(Fm=$d.prototype).Fd=function(t,e){return new Bl(this.Hd(t,e))},Fm.Pf=function(t,e){return[this.Fd(t,e)]},Fm.Hd=function(t,e){var i=_i(this.f),t=Qd(t,i,this.a);return Kd(t,t.length,i,t),Vc(new Xc(Li(t,0,t.length,i),this.f),!1,Gc(this,e))},Fm.Te=function(t,e){t=t.W();return t?this.Md(t,e):""},Fm.zi=function(t,e){return this.Te(t[0],e)},Fm.Md=function(t,e){e=(t=Vc(t,!0,Gc(this,e))).ja(),t=t.sa();return Kd(e,e.length,t,e),Jd(e,t,this.a)},i(of,Wc),of.prototype.Of=function(t,e){if("Topology"!=t.type)return[];var i=null,o=null;t.transform&&(i=(n=t.transform).scale,o=n.translate);var r=t.arcs;if(n)for(var n=i,s=o,a=0,l=r.length;a<l;++a)for(var h=r[a],p=n,c=s,u=0,d=0,f=void 0,g=void 0,g=0,y=h.length;g<y;++g)u+=(f=h[g])[0],d+=f[1],f[0]=u,f[1]=d,sf(f,p,c);for(n=[],a=0,l=(s=J(t.objects)).length;a<l;++a)"GeometryCollection"===s[a].type?(h=s[a],n.push.apply(n,function(t,e,i,o,r){for(var n=[],s=0,a=(t=t.geometries).length;s<a;++s)n[s]=nf(t[s],e,i,o,r);return n}(h,r,i,o,e))):(h=s[a],n.push(nf(h,r,i,o,e)));return n},of.prototype.Ka=function(){return this.defaultDataProjection};var Cb={Point:function(t,e,i){return t=t.coordinates,e&&i&&sf(t,e,i),new Fi(t)},LineString:function(t,e){return new Xc(rf(t.arcs,e))},Polygon:function(t,e){for(var i=[],o=0,r=t.arcs.length;o<r;++o)i[o]=rf(t.arcs[o],e);return new Yi(i)},MultiPoint:function(t,e,i){var o,r;if(t=t.coordinates,e&&i)for(o=0,r=t.length;o<r;++o)sf(t[o],e,i);return new tu(t)},MultiLineString:function(t,e){for(var i=[],o=0,r=t.arcs.length;o<r;++o)i[o]=rf(t.arcs[o],e);return new $c(i)},MultiPolygon:function(t,e){for(var i,o,r,n,s=[],a=0,l=t.arcs.length;a<l;++a){for(o=[],r=0,n=(i=t.arcs[a]).length;r<n;++r)o[r]=rf(i[r],e);s[a]=o}return new eu(s)}};i(af,_u),af.prototype.jc=function(t,e){var i={featureType:this.g,featureNS:this.b};return nt(i,Zc(this,t,e||{})),i=[i],this.a.a["http://www.opengis.net/gml"].featureMember=Ah(xu.prototype.Gd),i=!(i=Nh([],this.a.a,t,i,this.a))?[]:i},af.prototype.j=function(t){return Bv(t)?pf(t):jv(t)?Nh({},Db,t,[]):u(t)?pf(t=Sh(t)):void 0},af.prototype.i=function(t){return Bv(t)?lf(this,t):jv(t)?hf(this,t):u(t)?lf(this,t=Sh(t)):void 0};var Ib={"http://www.opengis.net/gml":{boundedBy:Lh(xu.prototype.Le,"bounds")}},Lb={"http://www.opengis.net/wfs":{totalInserted:Lh(Tu),totalUpdated:Lh(Tu),totalDeleted:Lh(Tu)}},Ob={"http://www.opengis.net/ogc":{FeatureId:Ah(function(t){return t.getAttribute("fid")})}},Rb={"http://www.opengis.net/wfs":{Feature:function(t,e){Fh(Ob,t,e)}}},Db={"http://www.opengis.net/wfs":{TransactionSummary:Lh(function(t,e){return Nh({},Lb,t,e)},"transactionSummary"),InsertResults:Lh(function(t,e){return Nh([],Rb,t,e)},"insertIds")}},kb={"http://www.opengis.net/wfs":{PropertyName:Oh(Ru)}},zb={"http://www.opengis.net/wfs":{Insert:Oh(function(t,e,i){var o=i[i.length-1],o=Nv(o.featureNS,o.featureType);t.appendChild(o),ku.prototype.yi(o,e,i)}),Update:Oh(function(t,e,i){var o=i[i.length-1],r=o.featureType,n=(n=o.featurePrefix)||"feature",s=o.featureNS;if(t.setAttribute("typeName",n+":"+r),Vv(t,"http://www.w3.org/2000/xmlns/","xmlns:"+n,s),r=e.Qa()){for(var s=[],a=0,l=(n=e.P()).length;a<l;a++){var h=e.get(n[a]);void 0!==h&&s.push({name:n[a],value:h})}Bh({node:t,srsName:o.srsName},zb,Dh("Property"),s,i),cf(t,r)}}),Delete:Oh(function(t,e,i){i=(r=i[i.length-1]).featureType;var o=(o=r.featurePrefix)||"feature",r=r.featureNS;t.setAttribute("typeName",o+":"+i),Vv(t,"http://www.w3.org/2000/xmlns/","xmlns:"+o,r),(e=e.Qa())&&cf(t,e)}),Property:Oh(function(t,e,i){var o=Nv("http://www.opengis.net/wfs","Name");t.appendChild(o),Ru(o,e.name),void 0!==e.value&&null!==e.value&&(o=Nv("http://www.opengis.net/wfs","Value"),t.appendChild(o),e.value instanceof gi?ku.prototype.Ve(o,e.value,i):Ru(o,e.value))}),Native:Oh(function(t,e){e.mp&&t.setAttribute("vendorId",e.mp),void 0!==e.Qo&&t.setAttribute("safeToIgnore",e.Qo),void 0!==e.value&&Ru(t,e.value)})}},Fb={"http://www.opengis.net/wfs":{Query:Oh(function(t,e,i){var o=i[i.length-1],r=o.featurePrefix,n=o.featureNS,s=o.propertyNames,a=o.srsName;t.setAttribute("typeName",(r?r+":":"")+e),a&&t.setAttribute("srsName",a),n&&Vv(t,"http://www.w3.org/2000/xmlns/","xmlns:"+r,n),(e=rt(o)).node=t,Bh(e,kb,Dh("PropertyName"),s,i),(o=o.bbox)&&(s=Nv("http://www.opengis.net/ogc","Filter"),e=i[i.length-1].geometryName,r=Nv("http://www.opengis.net/ogc","BBOX"),s.appendChild(r),Ru(n=Nv("http://www.opengis.net/ogc","PropertyName"),e),r.appendChild(n),ku.prototype.Ve(r,o,i),t.appendChild(s))})}};af.prototype.l=function(t){var e=Nv("http://www.opengis.net/wfs","GetFeature");e.setAttribute("service","WFS"),e.setAttribute("version","1.1.0"),t&&(t.handle&&e.setAttribute("handle",t.handle),t.outputFormat&&e.setAttribute("outputFormat",t.outputFormat),void 0!==t.maxFeatures&&e.setAttribute("maxFeatures",t.maxFeatures),t.resultType&&e.setAttribute("resultType",t.resultType),void 0!==t.startIndex&&e.setAttribute("startIndex",t.startIndex),void 0!==t.count&&e.setAttribute("count",t.count)),Vv(e,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",this.c);var i=t.featureTypes,o=rt((t=[{node:e,srsName:t.srsName,featureNS:t.featureNS||this.b,featurePrefix:t.featurePrefix,geometryName:t.geometryName,bbox:t.bbox,propertyNames:t.propertyNames||[]}])[t.length-1]);return o.node=e,Bh(o,Fb,Dh("Query"),i,t),e},af.prototype.B=function(t,e,i,o){var r,n,s=[],a=Nv("http://www.opengis.net/wfs","Transaction");return a.setAttribute("service","WFS"),a.setAttribute("version","1.1.0"),o&&(r=o.gmlOptions||{},o.handle&&a.setAttribute("handle",o.handle)),Vv(a,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",this.c),t&&(nt(n={node:a,featureNS:o.featureNS,featureType:o.featureType,featurePrefix:o.featurePrefix},r),Bh(n,zb,Dh("Insert"),t,s)),e&&(nt(n={node:a,featureNS:o.featureNS,featureType:o.featureType,featurePrefix:o.featurePrefix},r),Bh(n,zb,Dh("Update"),e,s)),i&&Bh({node:a,featureNS:o.featureNS,featureType:o.featureType,featurePrefix:o.featurePrefix},zb,Dh("Delete"),i,s),o.nativeElements&&Bh({node:a,featureNS:o.featureNS,featureType:o.featureType,featurePrefix:o.featurePrefix},zb,Dh("Native"),o.nativeElements,s),a},af.prototype.Uf=function(t){for(t=t.firstChild;t;t=t.nextSibling)if(1==t.nodeType)return this.Oe(t);return null},af.prototype.Oe=function(t){if(t.firstElementChild&&t.firstElementChild.firstElementChild)for(t=(t=t.firstElementChild.firstElementChild).firstElementChild;t;t=t.nextElementSibling)if(0!==t.childNodes.length&&(1!==t.childNodes.length||3!==t.firstChild.nodeType)){var e=[{}];return this.a.Le(t,e),ai(e.pop().srsName)}return null},i(uf,Ku);var Nb={Point:df,LineString:ff,Polygon:gf,MultiPoint:function(t){for(var e=[],i=0,o=(t=t.xe()).length;i<o;++i)e.push("("+df(t[i])+")");return e.join(",")},MultiLineString:function(t){for(var e=[],i=0,o=(t=t.ud()).length;i<o;++i)e.push("("+ff(t[i])+")");return e.join(",")},MultiPolygon:function(t){for(var e=[],i=0,o=(t=t.ee()).length;i<o;++i)e.push("("+gf(t[i])+")");return e.join(",")},GeometryCollection:function(t){for(var e=[],i=0,o=(t=t.Fg()).length;i<o;++i)e.push(yf(t[i]));return e.join(",")}};(Fm=uf.prototype).Fd=function(t,e){t=this.Hd(t,e);if(t){e=new Bl;return e.Oa(t),e}return null},Fm.Pf=function(t,e){for(var i=[],o=this.Hd(t,e),r=[],n=0,s=(i=this.a&&"GeometryCollection"==o.V()?o.c:[o]).length;n<s;++n)(o=new Bl).Oa(i[n]),r.push(o);return r},Fm.Hd=function(t,e){t=new bf(new mf(t));return t.a=vf(t.f),(t=function t(e){var i=e.a;if(e.match(1)){var o=i.value;if("GEOMETRYCOLLECTION"==o){t:{if(e.match(2)){for(i=[];i.push(t(e)),e.match(5););if(e.match(3)){e=i;break t}}else if(Pf(e)){e=[];break t}throw Error(Ef(e))}return new cu(e)}var r=Bb[o],i=Ub[o];if(!r||!i)throw Error("Invalid geometry type: "+o);return new i(e=r.call(e))}throw Error(Ef(e))}(t))?Vc(t,!1,e):null},Fm.Te=function(t,e){t=t.W();return t?this.Md(t,e):""},Fm.zi=function(t,e){if(1==t.length)return this.Te(t[0],e);for(var i=[],o=0,r=t.length;o<r;++o)i.push(t[o].W());return i=new cu(i),this.Md(i,e)},Fm.Md=function(t,e){return yf(Vc(t,!0,e))},(Fm=bf.prototype).match=function(t){return(t=this.a.type==t)&&(this.a=vf(this.f)),t},Fm.Jf=function(){if(this.match(2)){var t=xf(this);if(this.match(3))return t}else if(Pf(this))return null;throw Error(Ef(this))},Fm.If=function(){if(this.match(2)){var t=wf(this);if(this.match(3))return t}else if(Pf(this))return[];throw Error(Ef(this))},Fm.Kf=function(){if(this.match(2)){var t=Mf(this);if(this.match(3))return t}else if(Pf(this))return[];throw Error(Ef(this))},Fm.$n=function(){if(this.match(2)){var t;if(2==this.a.type)for(t=[this.Jf()];this.match(5);)t.push(this.Jf());else t=wf(this);if(this.match(3))return t}else if(Pf(this))return[];throw Error(Ef(this))},Fm.Zn=function(){if(this.match(2)){var t=Mf(this);if(this.match(3))return t}else if(Pf(this))return[];throw Error(Ef(this))},Fm.ao=function(){if(this.match(2)){for(var t=[this.Kf()];this.match(5);)t.push(this.Kf());if(this.match(3))return t}else if(Pf(this))return[];throw Error(Ef(this))};var Ub={POINT:Fi,LINESTRING:Xc,POLYGON:Yi,MULTIPOINT:tu,MULTILINESTRING:$c,MULTIPOLYGON:eu},Bb={POINT:bf.prototype.Jf,LINESTRING:bf.prototype.If,POLYGON:bf.prototype.Kf,MULTIPOINT:bf.prototype.$n,MULTILINESTRING:bf.prototype.Zn,MULTIPOLYGON:bf.prototype.ao};i(Sf,Yd),Sf.prototype.f=function(t){for(t=t.firstChild;t;t=t.nextSibling)if(1==t.nodeType)return this.a(t);return null},Sf.prototype.a=function(t){return this.version=t.getAttribute("version").trim(),(t=Nh({version:this.version},jb,t,[]))?t:null};var W_=[null,"http://www.opengis.net/wms"],jb=zh(W_,{Service:Lh(function(t,e){return Nh({},Gb,t,e)}),Capability:Lh(function(t,e){return Nh({},Zb,t,e)})}),Zb=zh(W_,{Request:Lh(function(t,e){return Nh({},$b,t,e)}),Exception:Lh(function(t,e){return Nh([],qb,t,e)}),Layer:Lh(function(t,e){return Nh({},Yb,t,e)})}),Gb=zh(W_,{Name:Lh(Cu),Title:Lh(Cu),Abstract:Lh(Cu),KeywordList:Lh(If),OnlineResource:Lh(qd),ContactInformation:Lh(function(t,e){return Nh({},Vb,t,e)}),Fees:Lh(Cu),AccessConstraints:Lh(Cu),LayerLimit:Lh(Tu),MaxWidth:Lh(Tu),MaxHeight:Lh(Tu)}),Vb=zh(W_,{ContactPersonPrimary:Lh(function(t,e){return Nh({},Wb,t,e)}),ContactPosition:Lh(Cu),ContactAddress:Lh(function(t,e){return Nh({},Hb,t,e)}),ContactVoiceTelephone:Lh(Cu),ContactFacsimileTelephone:Lh(Cu),ContactElectronicMailAddress:Lh(Cu)}),Wb=zh(W_,{ContactPerson:Lh(Cu),ContactOrganization:Lh(Cu)}),Hb=zh(W_,{AddressType:Lh(Cu),Address:Lh(Cu),City:Lh(Cu),StateOrProvince:Lh(Cu),PostCode:Lh(Cu),Country:Lh(Cu)}),qb=zh(W_,{Format:Ah(Cu)}),Yb=zh(W_,{Name:Lh(Cu),Title:Lh(Cu),Abstract:Lh(Cu),KeywordList:Lh(If),CRS:Ih(Cu),EX_GeographicBoundingBox:Lh(function(t,e){if(o=Nh({},Kb,t,e)){var i=o.westBoundLongitude,t=o.southBoundLatitude,e=o.eastBoundLongitude,o=o.northBoundLatitude;return void 0===i||void 0===t||void 0===e||void 0===o?void 0:[i,t,e,o]}}),BoundingBox:Ih(function(t){var e=[Su(t.getAttribute("minx")),Su(t.getAttribute("miny")),Su(t.getAttribute("maxx")),Su(t.getAttribute("maxy"))],i=[Su(t.getAttribute("resx")),Su(t.getAttribute("resy"))];return{crs:t.getAttribute("CRS"),extent:e,res:i}}),Dimension:Ih(function(t){return{name:t.getAttribute("name"),units:t.getAttribute("units"),unitSymbol:t.getAttribute("unitSymbol"),default:t.getAttribute("default"),multipleValues:Mu(t.getAttribute("multipleValues")),nearestValue:Mu(t.getAttribute("nearestValue")),current:Mu(t.getAttribute("current")),values:Cu(t)}}),Attribution:Lh(function(t,e){return Nh({},Xb,t,e)}),AuthorityURL:Ih(function(t,e){e=Tf(t,e);return e?(e.name=t.getAttribute("name"),e):void 0}),Identifier:Ih(Cu),MetadataURL:Ih(function(t,e){e=Tf(t,e);return e?(e.type=t.getAttribute("type"),e):void 0}),DataURL:Ih(Tf),FeatureListURL:Ih(Tf),Style:Ih(function(t,e){return Nh({},ex,t,e)}),MinScaleDenominator:Lh(Eu),MaxScaleDenominator:Lh(Eu),Layer:Ih(function(t,e){var i=e[e.length-1],o=Nh({},Yb,t,e);if(o){e=Mu(t.getAttribute("queryable"));return void 0===e&&(e=i.queryable),o.queryable=void 0!==e&&e,void 0===(e=Au(t.getAttribute("cascaded")))&&(e=i.cascaded),o.cascaded=e,void 0===(e=Mu(t.getAttribute("opaque")))&&(e=i.opaque),o.opaque=void 0!==e&&e,void 0===(e=Mu(t.getAttribute("noSubsets")))&&(e=i.noSubsets),o.noSubsets=void 0!==e&&e,(e=Su(t.getAttribute("fixedWidth")))||(e=i.fixedWidth),o.fixedWidth=e,(e=Su(t.getAttribute("fixedHeight")))||(e=i.fixedHeight),o.fixedHeight=e,["Style","CRS","AuthorityURL"].forEach(function(t){var e;t in i&&(e=(e=ot(o,t)).concat(i[t]),o[t]=e)}),"EX_GeographicBoundingBox BoundingBox Dimension Attribution MinScaleDenominator MaxScaleDenominator".split(" ").forEach(function(t){t in o||(o[t]=i[t])}),o}})}),Xb=zh(W_,{Title:Lh(Cu),OnlineResource:Lh(qd),LogoURL:Lh(Cf)}),Kb=zh(W_,{westBoundLongitude:Lh(Eu),eastBoundLongitude:Lh(Eu),southBoundLatitude:Lh(Eu),northBoundLatitude:Lh(Eu)}),$b=zh(W_,{GetCapabilities:Lh(Af),GetMap:Lh(Af),GetFeatureInfo:Lh(Af)}),Jb=zh(W_,{Format:Ih(Cu),DCPType:Ih(function(t,e){return Nh({},Qb,t,e)})}),Qb=zh(W_,{HTTP:Lh(function(t,e){return Nh({},tx,t,e)})}),tx=zh(W_,{Get:Lh(Tf),Post:Lh(Tf)}),ex=zh(W_,{Name:Lh(Cu),Title:Lh(Cu),Abstract:Lh(Cu),LegendURL:Ih(Cf),StyleSheetURL:Lh(Tf),StyleURL:Lh(Tf)}),ix=zh(W_,{Format:Lh(Cu),OnlineResource:Lh(qd)}),ox=zh(W_,{Keyword:Ah(Cu)});i(Lf,_u),Lf.prototype.jc=function(t,e){var i={featureType:this.featureType,featureNS:this.featureNS};e&&nt(i,Zc(this,t,e));var o=[i];t.namespaceURI=this.b;e=Uv(t),i=[];if(0!==t.childNodes.length){if("msGMLOutput"==e)for(var r=0,n=t.childNodes.length;r<n;r++){var s,a,l,h=t.childNodes[r];1===h.nodeType&&(s=o[0],a=h.localName.replace("_layer","")+"_feature",s.featureType=a,s.featureNS=this.b,(l={})[a]=Ah(this.a.Nf,this.a),s=zh([s.featureNS,null],l),h.namespaceURI=this.b,(h=Nh([],s,h,o,this.a))&&D(i,h))}"FeatureCollection"==e&&(o=Nh([],this.a.a,t,[{}],this.a))&&(i=o)}return i},i(Of,Yd),Of.prototype.f=function(t){for(t=t.firstChild;t;t=t.nextSibling)if(1==t.nodeType)return this.a(t);return null},Of.prototype.a=function(t){this.version=t.getAttribute("version").trim();var e=this.b.a(t);return e?(e.version=this.version,(e=Nh(e,rx,t,[]))?e:null):null};var Pm=[null,"http://www.opengis.net/wmts/1.0"],W_=[null,"http://www.opengis.net/ows/1.1"],rx=zh(Pm,{Contents:Lh(function(t,e){return Nh({},nx,t,e)})}),nx=zh(Pm,{Layer:Ih(function(t,e){return Nh({},sx,t,e)}),TileMatrixSet:Ih(function(t,e){return Nh({},cx,t,e)})}),sx=zh(Pm,{Style:Ih(function(t,e){e=Nh({},ax,t,e);if(e){t="true"===t.getAttribute("isDefault");return e.isDefault=t,e}}),Format:Ih(Cu),TileMatrixSetLink:Ih(function(t,e){return Nh({},lx,t,e)}),Dimension:Ih(function(t,e){return Nh({},hx,t,e)}),ResourceURL:Ih(function(t){var e=t.getAttribute("format"),i=t.getAttribute("template");t=t.getAttribute("resourceType");var o={};return e&&(o.format=e),i&&(o.template=i),t&&(o.resourceType=t),o})},zh(W_,{Title:Lh(Cu),Abstract:Lh(Cu),WGS84BoundingBox:Lh(function(t,e){e=Nh([],px,t,e);return 2!=e.length?void 0:_e(e)}),Identifier:Lh(Cu)})),ax=zh(Pm,{LegendURL:Ih(function(t){var e={};return e.format=t.getAttribute("format"),e.href=qd(t),e})},zh(W_,{Title:Lh(Cu),Identifier:Lh(Cu)})),lx=zh(Pm,{TileMatrixSet:Lh(Cu)}),hx=zh(Pm,{Default:Lh(Cu),Value:Ih(Cu)},zh(W_,{Identifier:Lh(Cu)})),px=zh(W_,{LowerCorner:Ah(Rf),UpperCorner:Ah(Rf)}),cx=zh(Pm,{WellKnownScaleSet:Lh(Cu),TileMatrix:Ih(function(t,e){return Nh({},ux,t,e)})},zh(W_,{SupportedCRS:Lh(Cu),Identifier:Lh(Cu)})),ux=zh(Pm,{TopLeftCorner:Lh(Rf),ScaleDenominator:Lh(Eu),TileWidth:Lh(Tu),TileHeight:Lh(Tu),MatrixWidth:Lh(Tu),MatrixHeight:Lh(Tu)},zh(W_,{Identifier:Lh(Cu)}));i(Df,Gt),(Fm=Df.prototype).X=function(){this.te(!1),Df.da.X.call(this)},Fm.Ll=function(){var t=this.ah();t&&(this.c=pi(ai("EPSG:4326"),t),this.a&&this.set("position",this.c(this.a)))},Fm.Ml=function(){var t;x_&&((t=this.bh())&&void 0===this.b?this.b=Xy.navigator.geolocation.watchPosition(this.jo.bind(this),this.ko.bind(this),this.Mg()):t||void 0===this.b||(Xy.navigator.geolocation.clearWatch(this.b),this.b=void 0))},Fm.jo=function(t){t=t.coords,this.set("accuracy",t.accuracy),this.set("altitude",null===t.altitude?void 0:t.altitude),this.set("altitudeAccuracy",null===t.altitudeAccuracy?void 0:t.altitudeAccuracy),this.set("heading",null===t.heading?void 0:E(t.heading)),this.a?(this.a[0]=t.longitude,this.a[1]=t.latitude):this.a=[t.longitude,t.latitude];var e=this.c(this.a);this.set("position",e),this.set("speed",null===t.speed?void 0:t.speed),(t=Ki(X_,this.a,t.accuracy)).qc(this.c),this.set("accuracyGeometry",t),this.u()},Fm.ko=function(t){t.type="error",this.te(!1),this.s(t)},Fm.Jj=function(){return this.get("accuracy")},Fm.Kj=function(){return this.get("accuracyGeometry")||null},Fm.Mj=function(){return this.get("altitude")},Fm.Nj=function(){return this.get("altitudeAccuracy")},Fm.Jl=function(){return this.get("heading")},Fm.Kl=function(){return this.get("position")},Fm.ah=function(){return this.get("projection")},Fm.sk=function(){return this.get("speed")},Fm.bh=function(){return this.get("tracking")},Fm.Mg=function(){return this.get("trackingOptions")},Fm.dh=function(t){this.set("projection",t)},Fm.te=function(t){this.set("tracking",t)},Fm.oi=function(t){this.set("trackingOptions",t)},i(kf,mi),(Fm=kf.prototype).clone=function(){var t=new kf(null),e=this.A.slice();return vi(t,this.b,e),t.u(),t},Fm.pb=function(t,e,i,o){var r=this.A;t-=r[0];var n=e-r[1];if((e=t*t+n*n)<o){if(0===e)for(o=0;o<this.a;++o)i[o]=r[o];else for(o=this.Df()/Math.sqrt(e),i[0]=r[0]+o*t,i[1]=r[1]+o*n,o=2;o<this.a;++o)i[o]=r[o];return i.length=this.a,e}return o},Fm.yc=function(t,e){var i=this.A,t=t-i[0];return t*t+(i=e-i[1])*i<=zf(this)},Fm.yd=function(){return this.A.slice(0,this.a)},Fm.Xd=function(t){var e=this.A,i=e[this.a]-e[0];return Ae(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)},Fm.Df=function(){return Math.sqrt(zf(this))},Fm.V=function(){return"Circle"},Fm.Fa=function(t){var e;return!!He(t,e=this.J())&&(e=this.yd(),t[0]<=e[0]&&t[2]>=e[0]||t[1]<=e[1]&&t[3]>=e[1]||ke(t,this.sg,this))},Fm.fm=function(t){var e=this.a,i=this.A[e]-this.A[0],o=t.slice();for(o[e]=o[0]+i,i=1;i<e;++i)o[e+i]=t[i];vi(this,this.b,o),this.u()},Fm.Yf=function(t,e,i){if(t){var o;for(bi(this,i,t,0),this.A||(this.A=[]),t=Ai(i=this.A,t),i[t++]=i[0]+e,e=1,o=this.a;e<o;++e)i[t++]=i[e];i.length=t}else vi(this,"XY",null);this.u()},Fm.gm=function(t){this.A[this.a]=this.A[0]+t,this.u()};var dx=new Na({color:"rgba(0,0,0,0.2)"}),fx=[90,45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001];(Fm=Nf.prototype).Nl=function(){return this.l},Fm.ek=function(){return this.a},Fm.lk=function(){return this.f},Fm.Rg=function(t){var e,i,o,r,n,s,a,l,h,p,c=t.vectorContext,u=t.frameState,d=u.extent,f=(t=u.viewState).center,g=t.projection,y=t.resolution;for(t=y*y/(4*(t=u.pixelRatio)*t),this.g&&li(this.g,g)||(e=ai("EPSG:4326"),i=g.J(),p=fi(o=g.i,e,g),r=o[2],n=o[1],s=o[0],a=p[3],l=p[2],h=p[1],p=p[0],this.i=o[3],this.b=r,this.j=n,this.c=s,this.v=a,this.C=l,this.D=h,this.O=p,this.o=hi(e,g),this.B=hi(g,e),this.G=this.B(Ue(i)),this.g=g),e=0,g.f&&(e=We(g=g.J()),(u=u.focus[0])<g[0]||u>g[2])&&(e*=Math.ceil((g[0]-u)/e),d=[d[0]+e,d[1],d[2]+e,d[3]]),u=this.G[0],g=this.G[1],e=-1,o=Math.pow(this.U*y,2),r=[],n=[],y=0,i=fx.length;y<i&&(r[0]=u-(s=fx[y]/2),r[1]=g-s,n[0]=u+s,n[1]=g+s,this.o(r,r),this.o(n,n),!((s=Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2))<=o));++y)e=fx[y];if(-1==(y=e))this.a.length=this.f.length=0;else{for(f=(u=this.B(f))[0],u=u[1],g=this.pa,o=(e=fi(e=[Math.max(d[0],this.O),Math.max(d[1],this.D),Math.min(d[2],this.C),Math.min(d[3],this.v)],this.g,"EPSG:4326"))[3],n=e[1],i=Uf(this,r=x(f=Math.floor(f/y)*y,this.c,this.b),n,o,t,d,0),e=0;r!=this.c&&e++<g;)i=Uf(this,r=Math.max(r-y,this.c),n,o,t,d,i);for(r=x(f,this.c,this.b),e=0;r!=this.b&&e++<g;)i=Uf(this,r=Math.min(r+y,this.b),n,o,t,d,i);for(this.a.length=i,i=Bf(this,f=x(u=Math.floor(u/y)*y,this.j,this.i),t,d,0),e=0;f!=this.j&&e++<g;)i=Bf(this,f=Math.max(f-y,this.j),t,d,i);for(f=x(u,this.j,this.i),e=0;f!=this.i&&e++<g;)i=Bf(this,f=Math.min(f+y,this.i),t,d,i);this.f.length=i}for(c.eb(null,this.wa),t=0,f=this.a.length;t<f;++t)y=this.a[t],c.Xb(y,null);for(t=0,f=this.f.length;t<f;++t)y=this.f[t],c.Xb(y,null)},Fm.setMap=function(t){this.l&&(this.l.K("postcompose",this.Rg,this),this.l.render()),t&&(t.H("postcompose",this.Rg,this),t.render()),this.l=t},i(jf,$n),jf.prototype.a=function(t){return void 0===t?this.f:(t=R(t))in this.g?this.g[t]:(e=tt(this.g)?this.f:this.f.cloneNode(!1),this.g[t]=e);var e},jf.prototype.o=function(){this.state=3,this.c.forEach(It),this.c=null,Jn(this)},jf.prototype.G=function(){void 0===this.resolution&&(this.resolution=je(this.extent)/this.f.height),this.state=2,this.c.forEach(It),this.c=null,Jn(this)},jf.prototype.load=function(){0==this.state&&(this.state=1,Jn(this),this.c=[At(this.f,"error",this.o,!1,this),At(this.f,"load",this.G,!1,this)],this.j(this,this.l))},i(Zf,mr),(Fm=Zf.prototype).X=function(){1==this.state&&Gf(this),this.a&&pt(this.a),Zf.da.X.call(this)},Fm.Ua=function(t){if(void 0===t)return this.f;var e=R(t);return e in this.b?this.b[e]:(t=tt(this.b)?this.f:this.f.cloneNode(!1),this.b[e]=t)},Fm.bb=function(){return this.j},Fm.Ol=function(){this.state=3,Gf(this),_r(this)},Fm.Pl=function(){this.state=this.f.naturalWidth&&this.f.naturalHeight?2:4,Gf(this),_r(this)},Fm.load=function(){0==this.state&&(this.state=1,_r(this),this.i=[At(this.f,"error",this.Ol,!1,this),At(this.f,"load",this.Pl,!1,this)],this.l(this,this.j))},i(Vf,Ft),(Fm=Vf.prototype).od=!1,Fm.X=function(){Vf.da.X.call(this),this.a.rc()},Fm.Rn=function(t){var e=t.a.dataTransfer;(this.od=!(!e||!(e.types&&(0<=T(e.types,"Files")||0<=T(e.types,"public.file-url"))||e.files&&0<e.files.length)))&&t.preventDefault()},Fm.Sn=function(t){this.od&&(t.preventDefault(),t.a.dataTransfer.dropEffect="none")},Fm.Tn=function(t){if(this.od){t.preventDefault(),t.b(),t=t.a.dataTransfer;try{t.effectAllowed="all"}catch(t){}t.dropEffect="copy"}},Fm.Un=function(t){this.od&&(t.preventDefault(),t.b(),(t=new gt(t.a)).type="drop",this.s(t))},Wf.prototype.cancel=function(t){var e;this.a?this.b instanceof Wf&&this.b.cancel():(this.f&&(e=this.f,delete this.f,t?e.cancel(t):(e.l--,e.l<=0&&e.cancel())),this.v?this.v.call(this.B,this):this.o=!0,this.a||(t=new Jf,qf(this),Hf(this,!1,t)))},Wf.prototype.G=function(t,e){this.j=!1,Hf(this,t,e)},Wf.prototype.cd=function(t){qf(this),Hf(this,!0,t)},Wf.prototype.then=function(t,e,i){var o,r,n=new Xl(function(t,e){o=t,r=e});return Yf(this,o,function(t){t instanceof Jf?n.cancel():r(t)}),n.then(t,e,i)},jl(Wf),i($f,a),$f.prototype.message="Deferred has already fired",$f.prototype.name="AlreadyCalledError",i(Jf,a),Jf.prototype.message="Deferred was canceled",Jf.prototype.name="CanceledError",Qf.prototype.f=function(){throw delete gx[this.ya],this.a};var gx={};i(tg,a);var yx={AbortError:3,EncodingError:5,InvalidModificationError:9,InvalidStateError:7,NotFoundError:1,NotReadableError:4,NoModificationAllowedError:6,PathExistsError:12,QuotaExceededError:10,SecurityError:2,SyntaxError:8,TypeMismatchError:11};i(eg,ct),i(ig,Ft),ig.prototype.getError=function(){return this.vb.error&&new tg(this.vb.error,"reading file")},ig.prototype.a=function(t){this.s(new eg(t,this))},ig.prototype.X=function(){ig.da.X.call(this),delete this.vb},i(og,Is),og.prototype.X=function(){this.a&&It(this.a),og.da.X.call(this)},og.prototype.l=function(t){for(var e,i=0,o=(t=t.a.dataTransfer.files).length;i<o;++i){var r,n=r=t[i],s=new ig,a=(e=s,a=void 0,a=new Wf,e.Sa("loadend",j(function(t,e){var i=e.vb.result,o=e.getError();null==i||o?(qf(t),Hf(t,!1,o)):t.cd(i),e.rc()},a,e)),a);s.vb.readAsText(n,""),Yf(n=a,r=j(this.o,r),null,this)}},og.prototype.o=function(t,e){for(var i=this.B,o=(o=this.v)||i.aa().g,r=[],n=0,s=(i=this.j).length;n<s;++n){var a,l=new i[n];try{a=l.Ca(e)}catch(t){a=null}if(a)for(var l=hi(l=l.Ka(e),o),h=0,p=a.length;h<p;++h){var c=a[h],u=c.W();u&&u.qc(l),r.push(c)}}this.s(new rg(mx,this,t,r,o))},og.prototype.setMap=function(t){this.a&&(It(this.a),this.a=void 0),this.c&&(pt(this.c),this.c=null),og.da.setMap.call(this,t),t&&(this.c=new Vf(t.a),this.a=St(this.c,"drop",this.l,!1,this))};var mx="addfeatures";i(rg,ct),i(ng,So),ng.prototype.clone=function(){return new ng(this.x,this.y)},ng.prototype.scale=So.prototype.scale,ng.prototype.rotate=function(t){var e=Math.cos(t);t=Math.sin(t);var i=this.y*e+this.x*t;return this.x=this.x*e-this.y*t,this.y=i,this},i(sg,Gs),i(pg,ct),i(cg,Gs),(Fm=cg.prototype).setMap=function(t){cg.da.setMap.call(this,t),this.vi()},Fm.Io=function(){var t,e=this.l.W();this.c===vx?((t=this.a).splice(-2,1),this.D(t,e)):this.c===bx&&((t=this.a[0]).splice(-2,1),this.v.W().ma(t),this.D(this.a,e)),0===t.length&&(this.o=null),bg(this)},Fm.qd=function(){var t=vg(this),e=this.a,i=t.W();this.c===vx?(e.pop(),this.D(e,i)):this.c===bx&&(e[0].pop(),e[0].push(e[0][0]),this.D(e,i)),"MultiPoint"===this.Y?t.Oa(new tu([e])):"MultiLineString"===this.Y?t.Oa(new $c([e])):"MultiPolygon"===this.Y&&t.Oa(new eu([e])),this.s(new pg("drawend",t)),this.Fb&&this.Fb.push(t),this.oc&&this.oc.Dd(t)},Fm.nm=function(t){var e=t.W();this.l=t,this.a=e.Z(),t=this.a[this.a.length-1],this.o=t.slice(),this.a.push(t.slice()),bg(this),this.s(new pg("drawstart",this.l))},Fm.Ec=Um,Fm.vi=function(){var t=this.B,e=this.b();t&&e||vg(this),this.qa.setMap(e?t:null)};var _x="Point",vx="LineString",bx="Polygon",xx="Circle";i(xg,ct),i(wg,Gs),(Fm=wg.prototype).Ef=function(t){var e=t.W();e.V()in this.Y&&this.Y[e.V()].call(this,t,e),(e=this.B)&&Lg(this,this.ia,e),St(t,"change",this.jh,!1,this)},Fm.setMap=function(t){this.U.setMap(t),wg.da.setMap.call(this,t)},Fm.om=function(t){this.Ef(t.element)},Fm.jh=function(t){this.o||(Pg(this,t=t.target),this.Ef(t))},Fm.pm=function(t){Pg(this,t.element)},Fm.um=function(t,e){var i=e.Z(),i={feature:t,geometry:e,la:[i,i]};this.a.za(e.J(),i)},Fm.sm=function(t,e){for(var i,o=e.Z(),r=0,n=o.length;r<n;++r)i={feature:t,geometry:e,depth:[r],index:r,la:[i=o[r],i]},this.a.za(e.J(),i)},Fm.kh=function(t,e){for(var i,o,r=e.Z(),n=0,s=r.length-1;n<s;++n)o={feature:t,geometry:e,index:n,la:i=r.slice(n,n+2)},this.a.za(_e(i),o)},Fm.rm=function(t,e){for(var i,o,r,n,s,a=e.Z(),l=0,h=a.length;l<h;++l)for(o=0,r=(i=a[l]).length-1;o<r;++o)s={feature:t,geometry:e,depth:[l],index:o,la:n=i.slice(o,o+2)},this.a.za(_e(n),s)},Fm.vm=function(t,e){for(var i,o,r,n,s,a=e.Z(),l=0,h=a.length;l<h;++l)for(o=0,r=(i=a[l]).length-1;o<r;++o)s={feature:t,geometry:e,depth:[l],index:o,la:n=i.slice(o,o+2)},this.a.za(_e(n),s)},Fm.tm=function(t,e){for(var i,o,r,n,s,a,l,h,p=e.Z(),c=0,u=p.length;c<u;++c)for(n=0,s=(a=p[c]).length;n<s;++n)for(o=0,r=(i=a[n]).length-1;o<r;++o)h={feature:t,geometry:e,depth:[n,c],index:o,la:l=i.slice(o,o+2)},this.a.za(_e(l),h)},Fm.qm=function(t,e){for(var i=e.c,o=0;o<i.length;++o)this.Y[i[o].V()].call(this,t,i[o])},Fm.ml=function(t,e){for(var i,o=t.la,r=t.feature,n=t.geometry,s=t.depth,a=t.index;e.length<n.sa();)e.push(0);switch(n.V()){case"MultiLineString":case"Polygon":(i=n.Z())[s[0]].splice(a+1,0,e);break;case"MultiPolygon":(i=n.Z())[s[1]][s[0]].splice(a+1,0,e);break;case"LineString":(i=n.Z()).splice(a+1,0,e);break;default:return}this.o=!0,n.ma(i),this.o=!1,(i=this.a).remove(t),Og(this,n,a,s,1);t={la:[o[0],e],feature:r,geometry:n,depth:s,index:a};i.za(_e(t.la),t),this.l.push([t,1]),o={la:[e,o[1]],feature:r,geometry:n,depth:s,index:a+1},i.za(_e(o.la),o),this.l.push([o,0]),this.T=!0},i(Rg,ct),i(Dg,Is),(Fm=Dg.prototype).xm=function(){return this.c.ea().c},Fm.ym=function(t){return t=R(t),this.a[t]},Fm.setMap=function(t){var e=this.B,i=this.c.ea().c;e&&i.forEach(e.ti,e),Dg.da.setMap.call(this,t),this.c.setMap(t),t&&i.forEach(t.pi,t)},Fm.wm=function(t){t=t.element;var e=this.B;e&&e.pi(t)},Fm.zm=function(t){t=t.element;var e=this.B;e&&e.ti(t)},i(zg,Gs),(Fm=zg.prototype).zd=function(t,e){var i=void 0===e||e,o=t.W(),r=this.Y[o.V()];r&&(e=R(t),this.T[e]=o.J(Te()),r.call(this,t,o),i&&(this.O[e]=o.H("change",this.Ik.bind(this,t),this),this.D[e]=t.H(Vt(t.a),this.Am,this)))},Fm.Gj=function(t){this.zd(t)},Fm.Hj=function(t){this.Ad(t)},Fm.lh=function(t){var e;t instanceof ip?e=t.feature:t instanceof bo&&(e=t.element),this.zd(e)},Fm.mh=function(t){var e;t instanceof ip?e=t.feature:t instanceof bo&&(e=t.element),this.Ad(e)},Fm.Am=function(t){t=t.g,this.Ad(t,!0),this.zd(t,!0)},Fm.Ik=function(t){var e;this.C?(e=R(t))in this.v||(this.v[e]=t):this.ui(t)},Fm.Ad=function(e,t){var i=void 0===t||t,t=R(e),o=this.T[t];if(o){var r=this.a,n=[];for(Xh(r,o,function(t){e===t.feature&&n.push(t)}),o=n.length-1;0<=o;--o)r.remove(n[o]);i&&(It(this.O[t]),delete this.O[t],It(this.D[t]),delete this.D[t])}},Fm.setMap=function(t){var e,i=this.B,o=this.ia;this.l?e=this.l:this.o&&(e=this.o.Be()),i&&(o.forEach(jt),o.length=0,e.forEach(this.Hj,this)),zg.da.setMap.call(this,t),t&&(this.l?(o.push(this.l.H("add",this.lh,this)),o.push(this.l.H("remove",this.mh,this))):this.o&&(o.push(this.o.H("addfeature",this.lh,this)),o.push(this.o.H("removefeature",this.mh,this))),e.forEach(this.Gj,this))},Fm.Ec=Um,Fm.ui=function(t){this.Ad(t,!1),this.zd(t,!1)},Fm.Bm=function(t,e){for(var i=e.c,o=0;o<i.length;++o)this.Y[i[o].V()].call(this,t,i[o])},Fm.nh=function(t,e){for(var i,o,r=e.Z(),n=0,s=r.length-1;n<s;++n)o={feature:t,la:i=r.slice(n,n+2)},this.a.za(_e(i),o)},Fm.Cm=function(t,e){for(var i,o,r,n,s,a=e.Z(),l=0,h=a.length;l<h;++l)for(o=0,r=(i=a[l]).length-1;o<r;++o)s={feature:t,la:n=i.slice(o,o+2)},this.a.za(_e(n),s)},Fm.Dm=function(t,e){for(var i,o=e.Z(),r=0,n=o.length;r<n;++r)i={feature:t,la:[i=o[r],i]},this.a.za(e.J(),i)},Fm.Em=function(t,e){for(var i,o,r,n,s,a,l,h,p=e.Z(),c=0,u=p.length;c<u;++c)for(n=0,s=(a=p[c]).length;n<s;++n)for(o=0,r=(i=a[n]).length-1;o<r;++o)h={feature:t,la:l=i.slice(o,o+2)},this.a.za(_e(l),h)},Fm.Fm=function(t,e){t={feature:t,la:[t=e.Z(),t]};this.a.za(e.J(),t)},Fm.Gm=function(t,e){for(var i,o,r,n,s,a=e.Z(),l=0,h=a.length;l<h;++l)for(o=0,r=(i=a[l]).length-1;o<r;++o)s={feature:t,la:n=i.slice(o,o+2)},this.a.za(_e(n),s)},i(Ug,ct),i(Bg,Gs),i(Wg,Ha);var wx=["#00f","#0ff","#0f0","#ff0","#f00"];(Fm=Wg.prototype).yg=function(){return this.get("blur")},Fm.Gg=function(){return this.get("gradient")},Fm.ph=function(){return this.get("radius")},Fm.Jk=function(){for(var t=this.Gg(),e=bn(1,256),i=e.createLinearGradient(0,0,1,256),o=1/(t.length-1),r=0,n=t.length;r<n;++r)i.addColorStop(r*o,t[r]);e.fillStyle=i,e.fillRect(0,0,1,256),this.g=e.getImageData(0,0,1,256).data},Fm.Sg=function(){var t=this.ph(),e=this.yg(),i=t+e+1,o=2*i;(o=bn(o,o)).shadowOffsetX=o.shadowOffsetY=this.Y,o.shadowBlur=e,o.shadowColor="#000",o.beginPath(),e=i-this.Y,o.arc(e,e,t,0,2*Math.PI,!0),o.fill(),this.T=o.canvas.toDataURL(),this.U=Array(256),this.u()},Fm.bl=function(t){for(var e,i=(t=t.context).canvas,o=(i=t.getImageData(0,0,i.width,i.height)).data,r=0,n=o.length;r<n;r+=4)(e=4*o[r+3])&&(o[r]=this.g[e],o[r+1]=this.g[1+e],o[r+2]=this.g[2+e]);t.putImageData(i,0,0)},Fm.ai=function(t){this.set("blur",t)},Fm.fi=function(t){this.set("gradient",t)},Fm.qh=function(t){this.set("radius",t)},i(Hg,mr),Hg.prototype.X=function(){1==this.state&&(this.b.forEach(It),this.b=null),Hg.da.X.call(this)},Hg.prototype.Ua=function(t){if(void 0===t)return this.i;var e=R(t);return e in this.g?this.g[e]:(t=tt(this.g)?this.i:this.i.cloneNode(!1),this.g[e]=t)},Hg.prototype.v=function(){var e=[];this.f.forEach(function(t){t&&2==t.state&&e.push({extent:this.j.Ba(t.ga),image:t.Ua()})},this),this.f.length=0;var t=this.G[0],i=y(o=this.o.Ma(t))?o:o[0],o=y(o)?o:o[1],t=this.o.$(t),r=this.j.$(this.l),n=this.o.Ba(this.G);this.i=Il(i,o,this.C,r,this.j.J(),t,n,this.B,e,this.D),this.state=2,_r(this)},Hg.prototype.load=function(){var o;0==this.state&&(this.state=1,_r(this),o=0,this.b=[],this.f.forEach(function(e){var i,t=e.state;0!=t&&1!=t||(o++,i=e.Sa("change",function(){var t=e.state;2!=t&&3!=t&&4!=t||(It(i),0===--o&&(this.b.forEach(It),this.b=null,this.v()))},!1,this),this.b.push(i))},this),this.f.forEach(function(t){0==t.state&&t.load()}),0===o&&Xy.setTimeout(this.v.bind(this),0))};var Mx=0,Px=1;i(Xg,a);var Ex=0;Kg.prototype.cancel=function(t){t&&(t.Cj&&t.Cj.cancel(),t.ya&&Jg(t.ya,!1))},i(Qg,cp),(Fm=Qg.prototype).wh=function(){return!!gr(this.a)||K(this.j,gr)},Fm.xh=function(t,e){var i=this.wd(t);yr(this.a,this.a==i?e:{}),X(this.j,function(t){yr(t,t==i?e:{})})},Fm.tf=function(t){return!(this.b&&t&&!li(this.b,t))&&Qg.da.tf.call(this,t)},Fm.kb=function(t){var e=this.b;return!this.tileGrid||e&&!li(e,t)?((e=R(t).toString())in this.o||(this.o[e]=Cr(t)),this.o[e]):this.tileGrid},Fm.wd=function(t){var e=this.b;return!e||li(e,t)?this.a:((t=R(t).toString())in this.j||(this.j[t]=new fr),this.j[t])},Fm.Qb=function(t,e,i,o,r){if(this.b&&r&&!li(this.b,r)){var n=this.wd(r);if(dr(n,t=this.Cb.apply(this,e=[t,e,i])))return n.get(t);var s=this.b;i=this.kb(s);var a=this.kb(r),l=zr(this,e,r);return o=new Hg(s,i,r,a,e,l,this.vc(o),function(t,e,i,o){return ey(this,t,e,i,o,s)}.bind(this),this.na,this.D),n.set(t,o),o}return ey(this,t,e,i,o,r)},Fm.xb=function(t){this.D!=t&&(this.D=t,X(this.j,function(t){t.clear()}),this.u())},Fm.yb=function(t,e){t=ai(t);t&&((t=R(t).toString())in this.o||(this.o[t]=e))},i(oy,Qg);var Sx=new vo({html:'<a class="ol-attribution-bing-tos" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a>'});oy.prototype.v=function(t){var e,o,s,a,r,l;200!=t.statusCode||"OK"!=t.statusDescription||"ValidCredentials"!=t.authenticationResultCode||1!=t.resourceSets.length||1!=t.resourceSets[0].resources.length?br(this,"error"):(-1==(e=t.brandLogoUri).indexOf("https")&&(e=e.replace("http","https")),o=t.resourceSets[0].resources[0],s=-1==this.c?o.zoomMax:this.c,a=Ir({extent:t=Or(this.b),minZoom:o.zoomMin,maxZoom:s,tileSize:o.imageWidth==o.imageHeight?o.imageWidth:[o.imageWidth,o.imageHeight]}),this.tileGrid=a,r=this.l,this.tileUrlFunction=lp(o.imageUrlSubdomains.map(function(t){var e=[0,0,0],i=o.imageUrl.replace("{subdomain}",t).replace("{culture}",r);return function(t){return t?(uo(t[0],t[1],-t[2]-1,e),i.replace("{quadkey}",function(t){for(var e,i=t[0],o=Array(i),r=1<<i-1,n=0;n<i;++n)e=48,t[1]&r&&(e+=1),t[2]&r&&(e+=2),o[n]=String.fromCharCode(e),r>>=1;return o.join("")}(e))):void 0}})),o.imageryProviders&&(l=pi(ai("EPSG:4326"),this.b),(t=o.imageryProviders.map(function(t){var e=t.attribution,n={};return t.coverageAreas.forEach(function(t){var e,i,o=t.zoomMin,r=Math.min(t.zoomMax,s);for(t=Xe([(t=t.bbox)[1],t[0],t[3],t[2]],l),e=o;e<=r;++e)i=e.toString(),o=Er(a,t,e),i in n?n[i].push(o):n[i]=[o]}),new vo({html:e,tileRanges:n})})).push(Sx),this.oa(t)),this.U=e,br(this,"ready"))},i(ry,$h),ry.prototype.ia=function(){return this.v},ry.prototype.Oc=function(t,e,i){this.v.Oc(t,e,i),e!==this.D&&(this.clear(),this.D=e,ny(this),this.Ic(this.C))},ry.prototype.qa=function(){this.clear(),ny(this),this.Ic(this.C),this.u()},i(sy,kl),(Fm=sy.prototype).Pm=function(){return this.j},Fm.sd=function(t,e,i){e=zl(this,e),i=this.ia?i:1;var o=this.g;if(o&&this.T==this.f&&o.$()==e&&o.b==i&&Pe(o.J(),t))return o;1!=this.v&&Ye(t=t.slice(),this.v);var r,n,s,a,l,h,p,c=[We(t)/e*i,je(t)/e*i];return void 0!==this.Y?(o=this.Y,r=Ue(t),n=this.na,s=We(t),a=je(t),l=c[0],h=c[1],p=.0254/this.o,nt(c={OPERATION:this.xa?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol.source.ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:this.o,SETDISPLAYWIDTH:Math.round(c[0]),SETDISPLAYHEIGHT:Math.round(c[1]),SETVIEWSCALE:l*a<h*s?s*n/(l*p):a*n/(h*p),SETVIEWCENTERX:r[0],SETVIEWCENTERY:r[1]},this.j),o=hh(ph([o],c)),St(o=new jf(t,e,i,this.i,o,this.ha,this.c),"change",this.l,!1,this)):o=null,this.g=o,this.T=this.f,o},Fm.Om=function(){return this.c},Fm.Rm=function(t){nt(this.j,t),this.u()},Fm.Qm=function(t){this.g=null,this.c=t,this.u()},i(ay,kl),ay.prototype.sd=function(t){return He(t,this.c.J())?this.c:null},ay.prototype.l=function(t){var e,i,o,r,n;2==this.c.state&&(n=this.c.J(),i=this.c.a(),r=this.g?(e=this.g[0],this.g[1]):(e=i.width,i.height),(n=Math.ceil(We(n)/(je(n)/r)))!=e&&((o=document.createElement("canvas")).width=n,o.height=r,o.getContext("2d").drawImage(i,0,0,e,r,0,0,o.width,o.height),this.c.f=o)),ay.da.l.call(this,t)},i(ly,kl);var Tx=[101,101];(Fm=ly.prototype).Xm=function(t,e,i,o){if(void 0!==this.j){var r=Be(t,e,0,Tx),n={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.g.LAYERS};return nt(n,this.g,o),o=Math.floor((r[3]-t[1])/e),n[this.v?"I":"X"]=Math.floor((t[0]-r[0])/e),n[this.v?"J":"Y"]=o,hy(this,r,Tx,1,ai(i),n)}},Fm.Zm=function(){return this.g},Fm.sd=function(t,e,i,o){if(void 0===this.j)return null;e=zl(this,e),1==i||this.xa&&void 0!==this.ia||(i=1);var r,n=((t=t.slice())[0]+t[2])/2,s=(t[1]+t[3])/2,a=We(t)/(l=e/i),l=je(t)/l,h=this.c;return h&&this.ha==this.f&&h.$()==e&&h.b==i&&Pe(h.J(),t)?h:(1!=this.o&&(h=this.o*We(t)/2,r=this.o*je(t)/2,t[0]=n-h,t[1]=s-r,t[2]=n+h,t[3]=s+r),nt(n={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0},this.g),this.Y[0]=Math.ceil(a*this.o),this.Y[1]=Math.ceil(l*this.o),o=hy(this,t,this.Y,i,o,n),this.c=new jf(t,e,i,this.i,o,this.na,this.T),this.ha=this.f,St(this.c,"change",this.l,!1,this),this.c)},Fm.Ym=function(){return this.T},Fm.$m=function(){return this.j},Fm.an=function(t){this.c=null,this.T=t,this.u()},Fm.bn=function(t){t!=this.j&&(this.j=t,this.c=null,this.u())},Fm.cn=function(t){nt(this.g,t),py(this),this.c=null,this.u()},i(cy,Qg),i(uy,cy);var Ax=new vo({html:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.'});i(dy,cy);var Cx,Ix,W_=new vo({html:'Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a>'}),Lx={osm:{maxZoom:19,opaque:!0,attributions:[W_,Ax]},sat:{maxZoom:18,opaque:!0,attributions:[W_,new vo({html:"Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency"})]},hyb:{maxZoom:18,opaque:!1,attributions:[W_,Ax]}};dy.prototype.l=function(){return this.c},Ix={ka:Cx={}},function(t){"object"==typeof Cx&&void 0!==Ix?Ix.ka=t():("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jp=t()}(function(){return function o(r,n,s){function a(i,t){if(!n[i]){if(!r[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(l)return l(i,!0);throw(e=Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",e}e=n[i]={ka:{}},r[i][0].call(e.ka,function(t){var e=r[i][1][t];return a(e||t)},e,e.ka,o,r,n,s)}return n[i].ka}for(var l="function"==typeof require&&require,t=0;t<s.length;t++)a(s[t]);return a}({1:[function(t,e,i){t=t("./processor"),i.Xi=t},{"./processor":2}],2:[function(t,e){function a(h){return function(t){var e,i=t.buffers,o=t.meta,r=t.width,n=t.height,s=i.length,a=i[0].byteLength;if(t.imageOps){for(a=Array(s),e=0;e<s;++e)a[e]=new ImageData(new Uint8ClampedArray(i[e]),r,n);r=h(a,o).data}else{for(r=new Uint8ClampedArray(a),n=Array(s),t=Array(s),e=0;e<s;++e)n[e]=new Uint8ClampedArray(i[e]),t[e]=[0,0,0,0];for(i=0;i<a;i+=4){for(e=0;e<s;++e){var l=n[e];t[e][0]=l[i],t[e][1]=l[i+1],t[e][2]=l[i+2],t[e][3]=l[i+3]}e=h(t,o),r[i]=e[0],r[i+1]=e[1],r[i+2]=e[2],r[i+3]=e[3]}}return r.buffer}}function i(t){this.bf=!!t.kl;var e,i,o,r,n=[];if(e=0===t.threads?0:!this.bf&&t.threads||1)for(var s=0;s<e;++s)n[s]=function(e,t){var i=Object.keys(e.lib||{}).map(function(t){return"var "+t+" = "+e.lib[t].toString()+";"}).concat(["var __minion__ = ("+a.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(__event__) {',"var buffer = __minion__(__event__.data);","self.postMessage({buffer: buffer, meta: __event__.data.meta}, [buffer]);","});"]),i=URL.createObjectURL(new Blob(i,{type:"text/javascript"}));return(i=new Worker(i)).addEventListener("message",t),i}(t,this.mg.bind(this,s));else n[0]=(i=t,o=this.mg.bind(this,0),r=a(i.operation),{postMessage:function(t){setTimeout(function(){o({data:{buffer:r(t),se:t.se}})},0)}});this.Ud=n,this.ad=[],this.kj=t.mo||1/0,this.Sd=0,this.Hc={},this.cf=null}i.prototype.lo=function(t,e,i){this.hj({xc:t,se:e,cd:i}),this.jg()},i.prototype.hj=function(t){for(this.ad.push(t);this.ad.length>this.kj;)this.ad.shift().cd(null,null)},i.prototype.jg=function(){if(0===this.Sd&&0<this.ad.length){var t=this.cf=this.ad.shift(),e=t.xc[0].width,i=t.xc[0].height,o=t.xc.map(function(t){return t.data.buffer}),r=this.Ud.length;if(1===(this.Sd=r))this.Ud[0].postMessage({buffers:o,meta:t.se,imageOps:this.bf,width:e,height:i},o);else for(var n=4*Math.ceil(t.xc[0].data.length/4/r),s=0;s<r;++s){for(var a=s*n,l=[],h=0,p=o.length;h<p;++h)l.push(o[s].slice(a,a+n));this.Ud[s].postMessage({buffers:l,meta:t.se,imageOps:this.bf,width:e,height:i},l)}}},i.prototype.mg=function(t,e){this.Fp||(this.Hc[t]=e.data,--this.Sd,0===this.Sd&&this.lj())},i.prototype.lj=function(){var t=this.cf,e=this.Ud.length;if(1===e)o=new Uint8ClampedArray(this.Hc[0].buffer),r=this.Hc[0].meta;else for(var i=t.xc[0].data.length,o=new Uint8ClampedArray(i),r=Array(i),i=4*Math.ceil(i/4/e),n=0;n<e;++n){var s=n*i;o.set(new Uint8ClampedArray(this.Hc[n].buffer),s),r[n]=this.Hc[n].meta}this.cf=null,this.Hc={},t.cd(null,new ImageData(o,t.xc[0].width,t.xc[0].height),r),this.jg()},e.ka=i},{}]},{},[1])(1)}),zv=Ix.ka,i(fy,kl),fy.prototype.v=function(t,e){this.T=new zv.Xi({operation:t,kl:"image"===this.xa,mo:1,lib:e,threads:this.jb}),this.u()},fy.prototype.C=function(t,e,i,o){i=!0;for(var r,n=0,s=this.c.length;n<s;++n)if("ready"!==(r=this.c[n].a.ea()).B){i=!1;break}if(!i)return null;if(!gy(this,t,e))return this.j;i=this.g.canvas,r=Math.round(We(t)/e),n=Math.round(je(t)/e),r===i.width&&n===i.height||(i.width=r,i.height=n),(r=rt(this.ha)).viewState=rt(r.viewState);var n=Ue(t),s=Math.round(We(t)/e),a=Math.round(je(t)/e);return r.extent=t,r.focus=Ue(t),r.size[0]=s,r.size[1]=a,(s=r.viewState).center=n,s.projection=o,s.resolution=e,this.j=o=new Tl(t,e,1,this.i,i,this.Y.bind(this,r)),this.o={extent:t,resolution:e,Po:this.f},o},fy.prototype.Y=function(t,e){for(var i=this.c.length,o=Array(i),r=0;r<i;++r){var n,s,a,l,h,p=this.c[r],c=t;if(p.Cd(c,t.layerStatesArray[r]),!(h=(h=p.Bd())?(p=p.qf(),n=Math.round(p[12]),s=Math.round(p[13]),a=c.size[0],c=c.size[1],h instanceof Image?(!Ox||(l=Ox.canvas).width!==a||l.height!==c?Ox=bn(a,c):Ox.clearRect(0,0,a,c),Ox.drawImage(h,n,s,Math.round(h.width*p[0]),Math.round(h.height*p[5])),Ox.getImageData(0,0,a,c)):h.getContext("2d").getImageData(-n,-s,a,c)):null))return;o[r]=h}this.s(new yy(Rx,t,i={})),this.T.lo(o,i,this.na.bind(this,t,e)),As(t.tileQueue,16,16)},fy.prototype.na=function(t,e,i,o,r){i?e(i):o&&(this.s(new yy(Dx,t,r)),gy(this,t.extent,t.viewState.resolution/t.pixelRatio)||this.g.putImageData(o,0,0),e(null))};var Ox=null;i(yy,ct);var Rx="beforeoperations",Dx="afteroperations",kx={terrain:{qb:"jpg",opaque:!0},"terrain-background":{qb:"jpg",opaque:!0},"terrain-labels":{qb:"png",opaque:!1},"terrain-lines":{qb:"png",opaque:!1},"toner-background":{qb:"png",opaque:!0},toner:{qb:"png",opaque:!0},"toner-hybrid":{qb:"png",opaque:!1},"toner-labels":{qb:"png",opaque:!1},"toner-lines":{qb:"png",opaque:!1},"toner-lite":{qb:"png",opaque:!0},watercolor:{qb:"jpg",opaque:!0}},zx={terrain:{minZoom:4,maxZoom:18},toner:{minZoom:0,maxZoom:20},watercolor:{minZoom:3,maxZoom:16}};i(my,cy);var Fx=[new vo({html:'Map tiles by <a href="http://stamen.com/">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.'}),Ax];return i(_y,Qg),_y.prototype.v=function(){return this.c},_y.prototype.vc=function(t){return t},_y.prototype.ae=function(t,e,i){var o=this.tileGrid;if(!((o=o||this.kb(i)).a.length<=t[0])){var r=o.Ba(t,this.l),n=Yt(o.Ma(t[0]),this.g);1!=e&&(n=qt(n,e,this.g)),nt(o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0},this.c);var s=this.urls;return t=s?(i=i.Ya.split(":").pop(),o.SIZE=n[0]+","+n[1],o.BBOX=r.join(","),o.BBOXSR=i,o.IMAGESR=i,o.DPI=Math.round(o.DPI?o.DPI*e:90*e),g(t=1==s.length?s[0]:s[Xt((t[1]<<t[0])+t[2],s.length)],"/")||(t+="/"),g(t,"MapServer/")?t+="export":g(t,"ImageServer/")&&(t+="exportImage"),hh(ph([t],o))):void 0}},_y.prototype.C=function(t){nt(this.c,t),this.u()},i(vy,mr),vy.prototype.Ua=function(t){if((t=void 0!==t?R(t):-1)in this.f)return this.f[t];var e=this.g,i=bn(e[0],e[1]);return i.strokeStyle="black",i.strokeRect(.5,.5,e[0]+.5,e[1]+.5),i.fillStyle="black",i.textAlign="center",i.textBaseline="middle",i.font="24px sans-serif",i.fillText(this.b,e[0]/2,e[1]/2),this.f[t]=i.canvas},i(by,Rr),by.prototype.Qb=function(t,e,i){var o=this.Cb(t,e,i);if(dr(this.a,o))return this.a.get(o);var r=Yt(this.tileGrid.Ma(t)),r=new vy(t=[t,e,i],r,e=(e=zr(this,t))?zr(this,e).toString():"");return this.a.set(o,r),r},i(xy,sh),xy.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new wy;throw Error("Unsupported browser")},xy.prototype.c=function(){return{}},(Fm=wy.prototype).open=function(t,e,i){if(null!=i&&!i)throw Error("Only async requests are supported.");this.a.open(t,e)},Fm.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},Fm.abort=function(){this.a.abort()},Fm.setRequestHeader=function(){},Fm.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},Fm.Bk=function(){this.status=200,this.responseText=this.a.responseText,My(this,4)},Fm.Ng=function(){this.status=500,this.responseText=null,My(this,4)},Fm.gl=function(){this.Ng()},Fm.al=function(){this.status=200,My(this,1)},Fm.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},i(Py,Qg),Py.prototype.l=function(t){var e,i=ai("EPSG:4326"),o=this.b;void 0!==t.bounds&&(e=Xe(t.bounds,pi(i,o)));var r=t.minzoom||0,n=t.maxzoom||22;if(this.tileGrid=o=Ir({extent:Or(o),maxZoom:n,minZoom:r}),this.tileUrlFunction=ap(t.tiles,o),void 0!==t.attribution&&!this.i){i=void 0!==e?e:i.J(),e={};for(;r<=n;++r)e[r.toString()]=[Er(o,i,r)];this.oa([new vo({html:t.attribution,tileRanges:e})])}br(this,"ready")},Py.prototype.c=function(){br(this,"error")},i(Ey,Rr),(Fm=Ey.prototype).tk=function(){return this.c},Fm.Fj=function(t,e,i,o,r){var n,s,a;this.tileGrid?(e=this.tileGrid.he(t,e),e=this.Qb(e[0],e[1],e[2],1,this.b),n=t,s=i,a=o,t=r,0==e.state&&!0===t?(At(e,"change",function(){s.call(a,Ty(this,n))},!1,e),Ay(e)):!0===t?rn(function(){s.call(a,Ty(this,n))},e):s.call(a,Ty(e,n))):!0===r?rn(function(){i.call(o,null)}):i.call(o,null)},Fm.fn=function(t){var e,i=ai("EPSG:4326"),o=this.b;void 0!==t.bounds&&(e=Xe(t.bounds,pi(i,o)));var r=t.minzoom||0,n=t.maxzoom||22;this.tileGrid=o=Ir({extent:Or(o),maxZoom:n,minZoom:r}),this.c=t.template;var s=t.grids;if(s){if(this.j=ap(s,o),void 0!==t.attribution){for(i=void 0!==e?e:i.J(),e={};r<=n;++r)e[s=r.toString()]=[Er(o,i,r)];this.oa([new vo({html:t.attribution,tileRanges:e})])}br(this,"ready")}else br(this,"error")},Fm.Qb=function(t,e,i,o,r){var n=this.Cb(t,e,i);return dr(this.a,n)?this.a.get(n):(e=zr(this,t=[t,e,i],r),o=new Sy(t,void 0!==(o=this.j(e,o,r))?0:4,void 0!==o?o:"",this.tileGrid.Ba(t),this.l),this.a.set(n,o),o)},Fm.bg=function(t,e,i){t=this.Cb(t,e,i),dr(this.a,t)&&this.a.get(t)},i(Sy,mr),(Fm=Sy.prototype).Ua=function(){return null},Fm.bb=function(){return this.j},Fm.dn=function(){this.state=3,_r(this)},Fm.en=function(t){this.b=t.grid,this.g=t.keys,this.i=t.data,this.state=4,_r(this)},Fm.load=function(){this.l&&Ay(this)},i(Cy,Qg),(Fm=Cy.prototype).gn=function(t,e,i,o){if(i=ai(i),e=(s=(s=this.tileGrid)||this.kb(i)).he(t,e),!(s.a.length<=e[0])){var r=s.$(e[0]),n=s.Ba(e,this.ha),s=Yt(s.Ma(e[0]),this.g),a=this.v;return 0!==a&&(s=Ht(s,a,this.g),n=be(n,r*a,n)),nt(a={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.c.LAYERS},this.c,o),o=Math.floor((n[3]-t[1])/r),a[this.l?"I":"X"]=Math.floor((t[0]-n[0])/r),a[this.l?"J":"Y"]=o,Iy(this,e,s,n,1,i,a)}},Fm.ce=function(){return this.v},Fm.rf=function(){return this.ia},Fm.Cb=function(t,e,i){return this.T+Cy.da.Cb.call(this,t,e,i)},Fm.hn=function(){return this.c},Fm.vc=function(t){return this.Y&&void 0!==this.C?t:1},Fm.ae=function(t,e,i){if(!((n=(n=this.tileGrid)||this.kb(i)).a.length<=t[0])){1==e||this.Y&&void 0!==this.C||(e=1);var o=n.$(t[0]),r=n.Ba(t,this.ha),n=Yt(n.Ma(t[0]),this.g),s=this.v;return 0!==s&&(n=Ht(n,s,this.g),r=be(r,o*s,r)),1!=e&&(n=qt(n,e,this.g)),nt(o={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0},this.c),Iy(this,t,n,r,e,i,o)}},Fm.jn=function(t){nt(this.c,t),Ly(this),Oy(this),Ry(this),this.u()},i(Dy,xr),Dy.prototype.o=function(){return this.j},i(zy,Qg),(Fm=zy.prototype).Rj=function(){return this.c},Fm.kn=function(){return this.C},Fm.rf=function(){return this.l},Fm.ln=function(){return this.T},Fm.dk=function(){return this.v},Fm.rk=function(){return this.ia},Fm.mn=function(){return this.Y},Fm.xk=function(){return this.ha},Fm.lp=function(t){nt(this.c,t),Fy(this),this.u()},i(Ny,Qg),i(Uy,Zf),Uy.prototype.Ua=function(t){var e=void 0!==t?R(t).toString():"";if(e in this.g)return this.g[e];if(t=Uy.da.Ua.call(this,t),2!=this.state)return t;if(256==t.width&&256==t.height)return this.g[e]=t;var i=bn(256,256);return i.drawImage(t,0,0),this.g[e]=i.canvas},Zy.prototype.get=function(t){return it(this.c,t,null)},i(Vy,cs),(Fm=Vy.prototype).Yb=function(){return this.O},Fm.sn=function(){return this.l},Fm.tn=function(){return this.o},Fm.Ce=function(){return this.v},Fm.hc=function(){return this.c},Fm.td=function(){return this.pa},Fm.Ed=function(){return 2},Fm.Ea=function(){return this.wa},Fm.vn=function(){return this.a},Fm.wn=function(){return this.b},Fm.qk=function(){return this.i},Fm.Eb=function(){return this.U},Fm.xn=function(){return this.f},Fm.yf=s,Fm.load=s,Fm.ag=s,Fm.Dh=function(t,e,i,o){var r;for(e.setTransform(1,0,0,1,0,0),e.translate(i,o),e.beginPath(),this.i!==this.b&&(this.a*=2),i=0;i<=this.a;i++)o=2*i*Math.PI/this.a-Math.PI/2+this.l,r=0==i%2?this.b:this.i,e.lineTo(t.size/2+r*Math.cos(o),t.size/2+r*Math.sin(o));this.o&&(e.fillStyle=Po(this.o.a),e.fill()),this.f&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.Jd,t.lineDash&&e.setLineDash(t.lineDash),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke()),e.closePath()},Fm.Ch=function(t,e,i,o){var r;for(e.setTransform(1,0,0,1,0,0),e.translate(i,o),e.beginPath(),this.i!==this.b&&(this.a*=2),i=0;i<=this.a;i++)r=2*i*Math.PI/this.a-Math.PI/2+this.l,o=0==i%2?this.b:this.i,e.lineTo(t.size/2+o*Math.cos(r),t.size/2+o*Math.sin(r));e.fillStyle=Q_,e.fill(),this.f&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.Jd,t.lineDash&&e.setLineDash(t.lineDash),e.stroke()),e.closePath()},t("ol.animation.bounce",function(t){var r=t.resolution,n=t.start||Date.now(),s=void 0!==t.duration?t.duration:1e3,a=t.easing||lo;return function(t,e){if(e.time<n)return e.animate=!0,e.viewHints[0]+=1,!0;if(e.time<n+s){var i=a((e.time-n)/s),o=r-e.viewState.resolution;return e.animate=!0,e.viewState.resolution+=i*o,e.viewHints[0]+=1,!0}return!1}},qy),t("ol.animation.pan",ho,qy),t("ol.animation.rotate",po,qy),t("ol.animation.zoom",co,qy),t("ol.Attribution",vo,qy),vo.prototype.getHTML=vo.prototype.b,t("ol.Collection",xo,qy),xo.prototype.extend=xo.prototype.zf,xo.prototype.getArray=xo.prototype.El,xo.prototype.getLength=xo.prototype.bc,xo.prototype.insertAt=xo.prototype.ne,xo.prototype.removeAt=xo.prototype.Wf,xo.prototype.setAt=xo.prototype.Ro,t("ol.coordinate.add",$t,qy),t("ol.coordinate.createStringXY",function(e){return function(t){return ne(t,e)}},qy),t("ol.coordinate.format",te,qy),t("ol.coordinate.rotate",ie,qy),t("ol.coordinate.toStringHDMS",function(t){return t?Qt(t[1],"NS")+" "+Qt(t[0],"EW"):""},qy),t("ol.coordinate.toStringXY",ne,qy),t("ol.DeviceOrientation",Bc,qy),Bc.prototype.getAlpha=Bc.prototype.Lj,Bc.prototype.getBeta=Bc.prototype.Oj,Bc.prototype.getGamma=Bc.prototype.Uj,Bc.prototype.getHeading=Bc.prototype.Fl,Bc.prototype.getTracking=Bc.prototype.$g,Bc.prototype.setTracking=Bc.prototype.Af,t("ol.easing.easeIn",ro,qy),t("ol.easing.easeOut",no,qy),t("ol.easing.inAndOut",so,qy),t("ol.easing.linear",ao,qy),t("ol.easing.upAndDown",lo,qy),t("ol.extent.boundingExtent",_e,qy),t("ol.extent.buffer",be,qy),t("ol.extent.containsCoordinate",Me,qy),t("ol.extent.containsExtent",Pe,qy),t("ol.extent.containsXY",Ee,qy),t("ol.extent.createEmpty",Te,qy),t("ol.extent.equals",Le,qy),t("ol.extent.extend",Oe,qy),t("ol.extent.getBottomLeft",Fe,qy),t("ol.extent.getBottomRight",Ne,qy),t("ol.extent.getCenter",Ue,qy),t("ol.extent.getHeight",je,qy),t("ol.extent.getIntersection",Ze,qy),t("ol.extent.getSize",function(t){return[t[2]-t[0],t[3]-t[1]]},qy),t("ol.extent.getTopLeft",Ge,qy),t("ol.extent.getTopRight",Ve,qy),t("ol.extent.getWidth",We,qy),t("ol.extent.intersects",He,qy),t("ol.extent.isEmpty",qe,qy),t("ol.extent.applyTransform",Xe,qy),t("ol.Feature",Bl,qy),Bl.prototype.getGeometry=Bl.prototype.W,Bl.prototype.getId=Bl.prototype.Qa,Bl.prototype.getGeometryName=Bl.prototype.Wj,Bl.prototype.getStyle=Bl.prototype.Hl,Bl.prototype.getStyleFunction=Bl.prototype.cc,Bl.prototype.setGeometry=Bl.prototype.Oa,Bl.prototype.setStyle=Bl.prototype.Bf,Bl.prototype.setId=Bl.prototype.kc,Bl.prototype.setGeometryName=Bl.prototype.Cc,t("ol.featureloader.tile",Zh,qy),t("ol.featureloader.xhr",Gh,qy),t("ol.Geolocation",Df,qy),Df.prototype.getAccuracy=Df.prototype.Jj,Df.prototype.getAccuracyGeometry=Df.prototype.Kj,Df.prototype.getAltitude=Df.prototype.Mj,Df.prototype.getAltitudeAccuracy=Df.prototype.Nj,Df.prototype.getHeading=Df.prototype.Jl,Df.prototype.getPosition=Df.prototype.Kl,Df.prototype.getProjection=Df.prototype.ah,Df.prototype.getSpeed=Df.prototype.sk,Df.prototype.getTracking=Df.prototype.bh,Df.prototype.getTrackingOptions=Df.prototype.Mg,Df.prototype.setProjection=Df.prototype.dh,Df.prototype.setTracking=Df.prototype.te,Df.prototype.setTrackingOptions=Df.prototype.oi,t("ol.Graticule",Nf,qy),Nf.prototype.getMap=Nf.prototype.Nl,Nf.prototype.getMeridians=Nf.prototype.ek,Nf.prototype.getParallels=Nf.prototype.lk,t("ol.has.DEVICE_PIXEL_RATIO",m_,qy),t("ol.has.CANVAS",v_,qy),t("ol.has.DEVICE_ORIENTATION",b_,qy),t("ol.has.GEOLOCATION",x_,qy),t("ol.has.TOUCH",w_,qy),t("ol.has.WEBGL",c_,qy),jf.prototype.getImage=jf.prototype.a,Zf.prototype.getImage=Zf.prototype.Ua,t("ol.Kinetic",Cs,qy),t("ol.loadingstrategy.all",Vh,qy),t("ol.loadingstrategy.bbox",function(t){return[t]},qy),t("ol.loadingstrategy.tile",function(n){return function(t,e){var i=Ar(n,e),o=Er(n,t,i),r=[];for((i=[i,0,0])[1]=o.a;i[1]<=o.c;++i[1])for(i[2]=o.f;i[2]<=o.b;++i[2])r.push(n.Ba(i));return r}},qy),t("ol.Map",fc,qy),fc.prototype.addControl=fc.prototype.qj,fc.prototype.addInteraction=fc.prototype.rj,fc.prototype.addLayer=fc.prototype.og,fc.prototype.addOverlay=fc.prototype.pg,fc.prototype.beforeRender=fc.prototype.Pa,fc.prototype.forEachFeatureAtPixel=fc.prototype.rd,fc.prototype.forEachLayerAtPixel=fc.prototype.Rl,fc.prototype.hasFeatureAtPixel=fc.prototype.jl,fc.prototype.getEventCoordinate=fc.prototype.Sj,fc.prototype.getEventPixel=fc.prototype.be,fc.prototype.getTarget=fc.prototype.fh,fc.prototype.getTargetElement=fc.prototype.uc,fc.prototype.getCoordinateFromPixel=fc.prototype.Ia,fc.prototype.getControls=fc.prototype.Qj,fc.prototype.getOverlays=fc.prototype.jk,fc.prototype.getOverlayById=fc.prototype.ik,fc.prototype.getInteractions=fc.prototype.Xj,fc.prototype.getLayerGroup=fc.prototype.tc,fc.prototype.getLayers=fc.prototype.eh,fc.prototype.getPixelFromCoordinate=fc.prototype.Ra,fc.prototype.getSize=fc.prototype.Ta,fc.prototype.getView=fc.prototype.aa,fc.prototype.getViewport=fc.prototype.yk,fc.prototype.renderSync=fc.prototype.No,fc.prototype.removeControl=fc.prototype.Go,fc.prototype.removeInteraction=fc.prototype.Ho,fc.prototype.removeLayer=fc.prototype.Jo,fc.prototype.removeOverlay=fc.prototype.Ko,fc.prototype.setLayerGroup=fc.prototype.gi,fc.prototype.setSize=fc.prototype.Zf,fc.prototype.setTarget=fc.prototype.Sl,fc.prototype.setView=fc.prototype.ap,fc.prototype.updateSize=fc.prototype.Xc,jn.prototype.stopPropagation=jn.prototype.b,t("ol.Object",Gt,qy),Gt.prototype.getKeys=Gt.prototype.P,Gt.prototype.getProperties=Gt.prototype.R,Gt.prototype.setProperties=Gt.prototype.I,Gt.prototype.unset=Gt.prototype.S,t("ol.Observable",Bt,qy),t("ol.Observable.unByKey",jt,qy),Bt.prototype.changed=Bt.prototype.u,Bt.prototype.dispatchEvent=Bt.prototype.s,Bt.prototype.getRevision=Bt.prototype.L,Bt.prototype.on=Bt.prototype.H,Bt.prototype.once=Bt.prototype.M,Bt.prototype.un=Bt.prototype.K,Bt.prototype.unByKey=Bt.prototype.N,t("ol.inherits",i,qy),t("ol.Overlay",gc,qy),gc.prototype.getElement=gc.prototype.ue,gc.prototype.getId=gc.prototype.Qa,gc.prototype.getMap=gc.prototype.ve,gc.prototype.getOffset=gc.prototype.Kg,gc.prototype.getPosition=gc.prototype.gh,gc.prototype.getPositioning=gc.prototype.Lg,gc.prototype.setElement=gc.prototype.ci,gc.prototype.setOffset=gc.prototype.ii,gc.prototype.setPosition=gc.prototype.Cf,gc.prototype.setPositioning=gc.prototype.li,t("ol.render.toContext",function(t,e){var i=t.canvas,o=e||{},e=o.pixelRatio||m_;return(o=o.size)&&(i.width=o[0]*e,i.height=o[1]*e,i.style.width=o[0]+"px",i.style.height=o[1]+"px"),new Xa(t,e,i=[0,0,i.width,i.height],o=Qn(le(),0,0,e,e,0,0,0),0)},qy),t("ol.size.toSize",Yt,qy),mr.prototype.getTileCoord=mr.prototype.c,Mh.prototype.getFormat=Mh.prototype.Tl,Mh.prototype.setFeatures=Mh.prototype.di,Mh.prototype.setLoader=Mh.prototype.hi,t("ol.View",to,qy),to.prototype.constrainCenter=to.prototype.Yd,to.prototype.getCenter=to.prototype.Va,to.prototype.calculateExtent=to.prototype.bd,to.prototype.getProjection=to.prototype.Ul,to.prototype.getResolution=to.prototype.$,to.prototype.getRotation=to.prototype.Ha,to.prototype.getZoom=to.prototype.Ak,to.prototype.fit=to.prototype.mf,to.prototype.centerOn=to.prototype.Aj,to.prototype.setCenter=to.prototype.mb,to.prototype.setResolution=to.prototype.Vb,to.prototype.setRotation=to.prototype.we,to.prototype.setZoom=to.prototype.ep,t("ol.xml.getAllTextContent",Eh,qy),t("ol.xml.parse",Sh,qy),Rp.prototype.getGL=Rp.prototype.On,Rp.prototype.useProgram=Rp.prototype.Je,t("ol.tilegrid.TileGrid",xr,qy),xr.prototype.getMaxZoom=xr.prototype.Ig,xr.prototype.getMinZoom=xr.prototype.Jg,xr.prototype.getOrigin=xr.prototype.Ea,xr.prototype.getResolution=xr.prototype.$,xr.prototype.getResolutions=xr.prototype.Fh,xr.prototype.getTileCoordExtent=xr.prototype.Ba,xr.prototype.getTileCoordForCoordAndResolution=xr.prototype.he,xr.prototype.getTileCoordForCoordAndZ=xr.prototype.ie,xr.prototype.getTileSize=xr.prototype.Ma,t("ol.tilegrid.createXYZ",Ir,qy),t("ol.tilegrid.WMTS",Dy,qy),Dy.prototype.getMatrixIds=Dy.prototype.o,t("ol.tilegrid.WMTS.createFromCapabilitiesMatrixSet",ky,qy),t("ol.style.AtlasManager",function(t){this.f=void 0!==(t=t||{}).initialSize?t.initialSize:256,this.b=void 0!==t.maxSize?t.maxSize:void 0!==Wy?Wy:2048,this.a=void 0!==t.space?t.space:1,this.g=[new Zy(this.f,this.a)],this.c=this.f,this.i=[new Zy(this.c,this.a)]},qy),t("ol.style.Circle",Ba,qy),Ba.prototype.getFill=Ba.prototype.nn,Ba.prototype.getImage=Ba.prototype.hc,Ba.prototype.getRadius=Ba.prototype.pn,Ba.prototype.getStroke=Ba.prototype.qn,t("ol.style.Fill",Ra,qy),Ra.prototype.getColor=Ra.prototype.b,Ra.prototype.setColor=Ra.prototype.c,t("ol.style.Icon",us,qy),us.prototype.getAnchor=us.prototype.Yb,us.prototype.getImage=us.prototype.hc,us.prototype.getOrigin=us.prototype.Ea,us.prototype.getSrc=us.prototype.rn,us.prototype.getSize=us.prototype.Eb,t("ol.style.Image",cs,qy),cs.prototype.getOpacity=cs.prototype.De,cs.prototype.getRotateWithView=cs.prototype.fe,cs.prototype.getRotation=cs.prototype.Ee,cs.prototype.getScale=cs.prototype.Fe,cs.prototype.getSnapToPixel=cs.prototype.ge,cs.prototype.setOpacity=cs.prototype.Ge,cs.prototype.setRotation=cs.prototype.He,cs.prototype.setScale=cs.prototype.Ie,t("ol.style.RegularShape",Vy,qy),Vy.prototype.getAnchor=Vy.prototype.Yb,Vy.prototype.getAngle=Vy.prototype.sn,Vy.prototype.getFill=Vy.prototype.tn,Vy.prototype.getImage=Vy.prototype.hc,Vy.prototype.getOrigin=Vy.prototype.Ea,Vy.prototype.getPoints=Vy.prototype.vn,Vy.prototype.getRadius=Vy.prototype.wn,Vy.prototype.getRadius2=Vy.prototype.qk,Vy.prototype.getSize=Vy.prototype.Eb,Vy.prototype.getStroke=Vy.prototype.xn,t("ol.style.Stroke",Na,qy),Na.prototype.getColor=Na.prototype.yn,Na.prototype.getLineCap=Na.prototype.$j,Na.prototype.getLineDash=Na.prototype.zn,Na.prototype.getLineJoin=Na.prototype.ak,Na.prototype.getMiterLimit=Na.prototype.fk,Na.prototype.getWidth=Na.prototype.An,Na.prototype.setColor=Na.prototype.Bn,Na.prototype.setLineCap=Na.prototype.Wo,Na.prototype.setLineDash=Na.prototype.Cn,Na.prototype.setLineJoin=Na.prototype.Xo,Na.prototype.setMiterLimit=Na.prototype.Yo,Na.prototype.setWidth=Na.prototype.bp,t("ol.style.Style",ja,qy),ja.prototype.getGeometry=ja.prototype.W,ja.prototype.getGeometryFunction=ja.prototype.Vj,ja.prototype.getFill=ja.prototype.Dn,ja.prototype.getImage=ja.prototype.En,ja.prototype.getStroke=ja.prototype.Fn,ja.prototype.getText=ja.prototype.Da,ja.prototype.getZIndex=ja.prototype.Gn,ja.prototype.setGeometry=ja.prototype.Eh,ja.prototype.setZIndex=ja.prototype.Hn,t("ol.style.Text",ud,qy),ud.prototype.getFont=ud.prototype.Tj,ud.prototype.getOffsetX=ud.prototype.gk,ud.prototype.getOffsetY=ud.prototype.hk,ud.prototype.getFill=ud.prototype.In,ud.prototype.getRotation=ud.prototype.Jn,ud.prototype.getScale=ud.prototype.Kn,ud.prototype.getStroke=ud.prototype.Ln,ud.prototype.getText=ud.prototype.Da,ud.prototype.getTextAlign=ud.prototype.uk,ud.prototype.getTextBaseline=ud.prototype.vk,ud.prototype.setFont=ud.prototype.To,ud.prototype.setOffsetX=ud.prototype.ji,ud.prototype.setOffsetY=ud.prototype.ki,ud.prototype.setFill=ud.prototype.So,ud.prototype.setRotation=ud.prototype.Mn,ud.prototype.setScale=ud.prototype.Nn,ud.prototype.setStroke=ud.prototype.Zo,ud.prototype.setText=ud.prototype.mi,ud.prototype.setTextAlign=ud.prototype.ni,ud.prototype.setTextBaseline=ud.prototype.$o,t("ol.Sphere",Qe,qy),Qe.prototype.geodesicArea=Qe.prototype.f,Qe.prototype.haversineDistance=Qe.prototype.a,t("ol.source.BingMaps",oy,qy),t("ol.source.BingMaps.TOS_ATTRIBUTION",Sx,qy),t("ol.source.Cluster",ry,qy),ry.prototype.getSource=ry.prototype.ia,t("ol.source.ImageCanvas",Ul,qy),t("ol.source.ImageMapGuide",sy,qy),sy.prototype.getParams=sy.prototype.Pm,sy.prototype.getImageLoadFunction=sy.prototype.Om,sy.prototype.updateParams=sy.prototype.Rm,sy.prototype.setImageLoadFunction=sy.prototype.Qm,t("ol.source.Image",kl,qy),t("ol.source.ImageStatic",ay,qy),t("ol.source.ImageVector",op,qy),op.prototype.getSource=op.prototype.Sm,op.prototype.getStyle=op.prototype.Tm,op.prototype.getStyleFunction=op.prototype.Um,op.prototype.setStyle=op.prototype.vh,t("ol.source.ImageWMS",ly,qy),ly.prototype.getGetFeatureInfoUrl=ly.prototype.Xm,ly.prototype.getParams=ly.prototype.Zm,ly.prototype.getImageLoadFunction=ly.prototype.Ym,ly.prototype.getUrl=ly.prototype.$m,ly.prototype.setImageLoadFunction=ly.prototype.an,ly.prototype.setUrl=ly.prototype.bn,ly.prototype.updateParams=ly.prototype.cn,t("ol.source.MapQuest",dy,qy),dy.prototype.getLayer=dy.prototype.l,t("ol.source.OSM",uy,qy),t("ol.source.OSM.ATTRIBUTION",Ax,qy),t("ol.source.Raster",fy,qy),fy.prototype.setOperation=fy.prototype.v,t("ol.source.Source",vr,qy),vr.prototype.getAttributions=vr.prototype.ta,vr.prototype.getLogo=vr.prototype.ra,vr.prototype.getProjection=vr.prototype.ua,vr.prototype.getState=vr.prototype.va,vr.prototype.setAttributions=vr.prototype.oa,t("ol.source.Stamen",my,qy),t("ol.source.TileArcGISRest",_y,qy),_y.prototype.getParams=_y.prototype.v,_y.prototype.updateParams=_y.prototype.C,t("ol.source.TileDebug",by,qy),t("ol.source.TileImage",Qg,qy),Qg.prototype.setRenderReprojectionEdges=Qg.prototype.xb,Qg.prototype.setTileGridForProjection=Qg.prototype.yb,t("ol.source.TileJSON",Py,qy),t("ol.source.Tile",Rr,qy),Rr.prototype.getTileGrid=Rr.prototype.Ja,t("ol.source.TileUTFGrid",Ey,qy),Ey.prototype.getTemplate=Ey.prototype.tk,Ey.prototype.forDataAtCoordinateAndResolution=Ey.prototype.Fj,t("ol.source.TileWMS",Cy,qy),Cy.prototype.getGetFeatureInfoUrl=Cy.prototype.gn,Cy.prototype.getParams=Cy.prototype.hn,Cy.prototype.updateParams=Cy.prototype.jn,cp.prototype.getTileLoadFunction=cp.prototype.Za,cp.prototype.getTileUrlFunction=cp.prototype.$a,cp.prototype.getUrls=cp.prototype.ab,cp.prototype.setTileLoadFunction=cp.prototype.gb,cp.prototype.setTileUrlFunction=cp.prototype.La,cp.prototype.setUrl=cp.prototype.Wa,cp.prototype.setUrls=cp.prototype.Xa,t("ol.source.Vector",$h,qy),$h.prototype.addFeature=$h.prototype.Dd,$h.prototype.addFeatures=$h.prototype.Ic,$h.prototype.forEachFeature=$h.prototype.wg,$h.prototype.forEachFeatureInExtent=$h.prototype.rb,$h.prototype.forEachFeatureIntersectingExtent=$h.prototype.xg,$h.prototype.getFeaturesCollection=$h.prototype.Eg,$h.prototype.getFeatures=$h.prototype.Be,$h.prototype.getFeaturesAtCoordinate=$h.prototype.Dg,$h.prototype.getFeaturesInExtent=$h.prototype.pf,$h.prototype.getClosestFeatureToCoordinate=$h.prototype.zg,$h.prototype.getExtent=$h.prototype.J,$h.prototype.getFeatureById=$h.prototype.Cg,$h.prototype.removeFeature=$h.prototype.Sc,t("ol.source.VectorTile",up,qy),t("ol.source.WMTS",zy,qy),zy.prototype.getDimensions=zy.prototype.Rj,zy.prototype.getFormat=zy.prototype.kn,zy.prototype.getLayer=zy.prototype.ln,zy.prototype.getMatrixSet=zy.prototype.dk,zy.prototype.getRequestEncoding=zy.prototype.rk,zy.prototype.getStyle=zy.prototype.mn,zy.prototype.getVersion=zy.prototype.xk,zy.prototype.updateDimensions=zy.prototype.lp,t("ol.source.WMTS.optionsFromCapabilities",function(t,i){var e=A(t.Contents.Layer,function(t){return t.Identifier==i.layer}),o=t.Contents.TileMatrixSet,r=1<e.TileMatrixSetLink.length?"projection"in i?C(e.TileMatrixSetLink,function(e){return A(o,function(t){return t.Identifier==e.TileMatrixSet}).SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")==i.projection}):C(e.TileMatrixSetLink,function(t){return t.TileMatrixSet==i.matrixSet}):0,n=e.TileMatrixSetLink[r=r<0?0:r].TileMatrixSet,s=e.Format[0];"format"in i&&(s=i.format),r=C(e.Style,function(t){return"style"in i?t.Title==i.style:t.isDefault}),r=e.Style[r=r<0?0:r].Identifier;var a={};"Dimension"in e&&e.Dimension.forEach(function(t){var e=t.Identifier,i=t.Default;void 0===i&&(i=t.Value[0]),a[e]=i});var l,h=A(t.Contents.TileMatrixSet,function(t){return t.Identifier==n}),p=ai("projection"in i?i.projection:h.SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"));void 0!==(d=e.WGS84BoundingBox)&&(l=ai("EPSG:4326").J(),l=d[0]==l[0]&&d[2]==l[2],c=fi(d,"EPSG:4326",p),(d=p.J())&&(Pe(d,c)||(c=void 0)));var c,h=ky(h,c),u=[];if(c=void 0!==(c=i.requestEncoding)?c:"",t.hasOwnProperty("OperationsMetadata")&&t.OperationsMetadata.hasOwnProperty("GetTile")&&0!==c.indexOf("REST"))for(var d=0,f=(e=t.OperationsMetadata.GetTile.DCP.HTTP.Get).length;d<f;++d){var g=A(e[d].Constraint,function(t){return"GetEncoding"==t.name}).AllowedValues.Value;0<g.length&&G(g,"KVP")&&(c="KVP",u.push(e[d].href))}else c="REST",e.ResourceURL.forEach(function(t){"tile"==t.resourceType&&(s=t.format,u.push(t.template))});return{urls:u,layer:i.layer,matrixSet:n,format:s,projection:p,requestEncoding:c,tileGrid:h,style:r,dimensions:a,wrapX:l}},qy),t("ol.source.XYZ",cy,qy),t("ol.source.Zoomify",Ny,qy),Ml.prototype.getExtent=Ml.prototype.J,Ml.prototype.getGeometry=Ml.prototype.W,Ml.prototype.getProperties=Ml.prototype.Km,Ml.prototype.getType=Ml.prototype.V,t("ol.render.VectorContext",qn,qy),Jp.prototype.drawAsync=Jp.prototype.pd,Jp.prototype.drawCircleGeometry=Jp.prototype.Jc,Jp.prototype.drawFeature=Jp.prototype.lf,Jp.prototype.drawGeometryCollectionGeometry=Jp.prototype.Zd,Jp.prototype.drawPointGeometry=Jp.prototype.Jb,Jp.prototype.drawLineStringGeometry=Jp.prototype.Xb,Jp.prototype.drawMultiLineStringGeometry=Jp.prototype.Kc,Jp.prototype.drawMultiPointGeometry=Jp.prototype.Ib,Jp.prototype.drawMultiPolygonGeometry=Jp.prototype.Lc,Jp.prototype.drawPolygonGeometry=Jp.prototype.Mc,Jp.prototype.drawText=Jp.prototype.Kb,Jp.prototype.setFillStrokeStyle=Jp.prototype.eb,Jp.prototype.setImageStyle=Jp.prototype.wb,Jp.prototype.setTextStyle=Jp.prototype.fb,Xa.prototype.drawAsync=Xa.prototype.pd,Xa.prototype.drawCircleGeometry=Xa.prototype.Jc,Xa.prototype.drawFeature=Xa.prototype.lf,Xa.prototype.drawPointGeometry=Xa.prototype.Jb,Xa.prototype.drawMultiPointGeometry=Xa.prototype.Ib,Xa.prototype.drawLineStringGeometry=Xa.prototype.Xb,Xa.prototype.drawMultiLineStringGeometry=Xa.prototype.Kc,Xa.prototype.drawPolygonGeometry=Xa.prototype.Mc,Xa.prototype.drawMultiPolygonGeometry=Xa.prototype.Lc,Xa.prototype.setFillStrokeStyle=Xa.prototype.eb,Xa.prototype.setImageStyle=Xa.prototype.wb,Xa.prototype.setTextStyle=Xa.prototype.fb,t("ol.proj.common.add",Ia,qy),t("ol.proj.METERS_PER_UNIT",Gm,qy),t("ol.proj.Projection",ti,qy),ti.prototype.getCode=ti.prototype.Pj,ti.prototype.getExtent=ti.prototype.J,ti.prototype.getUnits=ti.prototype.Im,ti.prototype.getMetersPerUnit=ti.prototype.$b,ti.prototype.getWorldExtent=ti.prototype.zk,ti.prototype.isGlobal=ti.prototype.ol,ti.prototype.setGlobal=ti.prototype.Vo,ti.prototype.setExtent=ti.prototype.Jm,ti.prototype.setWorldExtent=ti.prototype.cp,ti.prototype.setGetPointResolution=ti.prototype.Uo,t("ol.proj.setProj4",function(t){Hm=t},qy),t("ol.proj.addEquivalentProjections",ei,qy),t("ol.proj.addProjection",ii,qy),t("ol.proj.addCoordinateTransforms",ni,qy),t("ol.proj.fromLonLat",function(t,e){return di(t,"EPSG:4326",void 0!==e?e:"EPSG:3857")},qy),t("ol.proj.toLonLat",function(t,e){return di(t,void 0!==e?e:"EPSG:3857","EPSG:4326")},qy),t("ol.proj.get",ai,qy),t("ol.proj.getTransform",hi,qy),t("ol.proj.transform",di,qy),t("ol.proj.transformExtent",fi,qy),t("ol.layer.Heatmap",Wg,qy),Wg.prototype.getBlur=Wg.prototype.yg,Wg.prototype.getGradient=Wg.prototype.Gg,Wg.prototype.getRadius=Wg.prototype.ph,Wg.prototype.setBlur=Wg.prototype.ai,Wg.prototype.setGradient=Wg.prototype.fi,Wg.prototype.setRadius=Wg.prototype.qh,t("ol.layer.Image",La,qy),La.prototype.getSource=La.prototype.ea,t("ol.layer.Layer",Xn,qy),Xn.prototype.getSource=Xn.prototype.ea,Xn.prototype.setSource=Xn.prototype.Dc,t("ol.layer.Base",Wn,qy),Wn.prototype.getExtent=Wn.prototype.J,Wn.prototype.getMaxResolution=Wn.prototype.Ob,Wn.prototype.getMinResolution=Wn.prototype.Pb,Wn.prototype.getOpacity=Wn.prototype.Sb,Wn.prototype.getVisible=Wn.prototype.tb,Wn.prototype.getZIndex=Wn.prototype.Tb,Wn.prototype.setExtent=Wn.prototype.dc,Wn.prototype.setMaxResolution=Wn.prototype.lc,Wn.prototype.setMinResolution=Wn.prototype.mc,Wn.prototype.setOpacity=Wn.prototype.ec,Wn.prototype.setVisible=Wn.prototype.fc,Wn.prototype.setZIndex=Wn.prototype.gc,t("ol.layer.Group",Ea,qy),Ea.prototype.getLayers=Ea.prototype.Rc,Ea.prototype.setLayers=Ea.prototype.oh,t("ol.layer.Tile",Oa,qy),Oa.prototype.getPreload=Oa.prototype.a,Oa.prototype.getSource=Oa.prototype.ea,Oa.prototype.setPreload=Oa.prototype.c,Oa.prototype.getUseInterimTilesOnError=Oa.prototype.b,Oa.prototype.setUseInterimTilesOnError=Oa.prototype.g,t("ol.layer.Vector",Ha,qy),Ha.prototype.getSource=Ha.prototype.ea,Ha.prototype.getStyle=Ha.prototype.C,Ha.prototype.getStyleFunction=Ha.prototype.D,Ha.prototype.setStyle=Ha.prototype.c,t("ol.layer.VectorTile",Ya,qy),Ya.prototype.getPreload=Ya.prototype.g,Ya.prototype.getSource=Ya.prototype.ea,Ya.prototype.getUseInterimTilesOnError=Ya.prototype.U,Ya.prototype.setPreload=Ya.prototype.T,Ya.prototype.setUseInterimTilesOnError=Ya.prototype.Y,t("ol.interaction.DoubleClickZoom",Ds,qy),t("ol.interaction.DoubleClickZoom.handleEvent",ks,qy),t("ol.interaction.DragAndDrop",og,qy),t("ol.interaction.DragAndDrop.handleEvent",Bm,qy),t("ol.interaction.DragBox",ra,qy),ra.prototype.getGeometry=ra.prototype.W,t("ol.interaction.DragPan",Hs,qy),t("ol.interaction.DragRotateAndZoom",sg,qy),t("ol.interaction.DragRotate",Ks,qy),t("ol.interaction.DragZoom",ha,qy),t("ol.interaction.Draw",cg,qy),t("ol.interaction.Draw.handleEvent",ug,qy),cg.prototype.removeLastPoint=cg.prototype.Io,cg.prototype.finishDrawing=cg.prototype.qd,cg.prototype.extend=cg.prototype.nm,t("ol.interaction.Draw.createRegularPolygon",function(r,n){return function(t,e){var i=t[0],o=t[1],t=Math.sqrt(oe(i,o)),e=e||Ji(new kf(i),r);return Qi(e,i,t,n||Math.atan((o[1]-i[1])/(o[0]-i[0]))),e}},qy),t("ol.interaction.Interaction",Is,qy),Is.prototype.getActive=Is.prototype.b,Is.prototype.getMap=Is.prototype.i,Is.prototype.setActive=Is.prototype.g,t("ol.interaction.defaults",Pa,qy),t("ol.interaction.KeyboardPan",pa,qy),t("ol.interaction.KeyboardPan.handleEvent",ca,qy),t("ol.interaction.KeyboardZoom",ua,qy),t("ol.interaction.KeyboardZoom.handleEvent",da,qy),t("ol.interaction.Modify",wg,qy),t("ol.interaction.Modify.handleEvent",Ig,qy),t("ol.interaction.MouseWheelZoom",fa,qy),t("ol.interaction.MouseWheelZoom.handleEvent",ga,qy),fa.prototype.setMouseAnchor=fa.prototype.D,t("ol.interaction.PinchRotate",ya,qy),t("ol.interaction.PinchZoom",ba,qy),t("ol.interaction.Pointer",Gs,qy),t("ol.interaction.Pointer.handleEvent",Ws,qy),t("ol.interaction.Select",Dg,qy),Dg.prototype.getFeatures=Dg.prototype.xm,Dg.prototype.getLayer=Dg.prototype.ym,t("ol.interaction.Select.handleEvent",kg,qy),t("ol.interaction.Snap",zg,qy),zg.prototype.addFeature=zg.prototype.zd,zg.prototype.removeFeature=zg.prototype.Ad,t("ol.interaction.Translate",Bg,qy),t("ol.geom.Circle",kf,qy),kf.prototype.getCenter=kf.prototype.yd,kf.prototype.getRadius=kf.prototype.Df,kf.prototype.getType=kf.prototype.V,kf.prototype.intersectsExtent=kf.prototype.Fa,kf.prototype.setCenter=kf.prototype.fm,kf.prototype.setCenterAndRadius=kf.prototype.Yf,kf.prototype.setRadius=kf.prototype.gm,kf.prototype.transform=kf.prototype.nb,t("ol.geom.Geometry",gi,qy),gi.prototype.getClosestPoint=gi.prototype.sb,gi.prototype.getExtent=gi.prototype.J,gi.prototype.simplify=gi.prototype.zb,gi.prototype.transform=gi.prototype.nb,t("ol.geom.GeometryCollection",cu,qy),cu.prototype.getGeometries=cu.prototype.Fg,cu.prototype.getType=cu.prototype.V,cu.prototype.intersectsExtent=cu.prototype.Fa,cu.prototype.setGeometries=cu.prototype.ei,cu.prototype.applyTransform=cu.prototype.qc,cu.prototype.translate=cu.prototype.Qc,t("ol.geom.LinearRing",ki,qy),ki.prototype.getArea=ki.prototype.jm,ki.prototype.getCoordinates=ki.prototype.Z,ki.prototype.getType=ki.prototype.V,ki.prototype.setCoordinates=ki.prototype.ma,t("ol.geom.LineString",Xc,qy),Xc.prototype.appendCoordinate=Xc.prototype.sj,Xc.prototype.forEachSegment=Xc.prototype.Ij,Xc.prototype.getCoordinateAtM=Xc.prototype.hm,Xc.prototype.getCoordinates=Xc.prototype.Z,Xc.prototype.getCoordinateAt=Xc.prototype.Ag,Xc.prototype.getLength=Xc.prototype.im,Xc.prototype.getType=Xc.prototype.V,Xc.prototype.intersectsExtent=Xc.prototype.Fa,Xc.prototype.setCoordinates=Xc.prototype.ma,t("ol.geom.MultiLineString",$c,qy),$c.prototype.appendLineString=$c.prototype.tj,$c.prototype.getCoordinateAtM=$c.prototype.km,$c.prototype.getCoordinates=$c.prototype.Z,$c.prototype.getLineString=$c.prototype.bk,$c.prototype.getLineStrings=$c.prototype.ud,$c.prototype.getType=$c.prototype.V,$c.prototype.intersectsExtent=$c.prototype.Fa,$c.prototype.setCoordinates=$c.prototype.ma,t("ol.geom.MultiPoint",tu,qy),tu.prototype.appendPoint=tu.prototype.vj,tu.prototype.getCoordinates=tu.prototype.Z,tu.prototype.getPoint=tu.prototype.mk,tu.prototype.getPoints=tu.prototype.xe,tu.prototype.getType=tu.prototype.V,tu.prototype.intersectsExtent=tu.prototype.Fa,tu.prototype.setCoordinates=tu.prototype.ma,t("ol.geom.MultiPolygon",eu,qy),eu.prototype.appendPolygon=eu.prototype.wj,eu.prototype.getArea=eu.prototype.lm,eu.prototype.getCoordinates=eu.prototype.Z,eu.prototype.getInteriorPoints=eu.prototype.Zj,eu.prototype.getPolygon=eu.prototype.pk,eu.prototype.getPolygons=eu.prototype.ee,eu.prototype.getType=eu.prototype.V,eu.prototype.intersectsExtent=eu.prototype.Fa,eu.prototype.setCoordinates=eu.prototype.ma,t("ol.geom.Point",Fi,qy),Fi.prototype.getCoordinates=Fi.prototype.Z,Fi.prototype.getType=Fi.prototype.V,Fi.prototype.intersectsExtent=Fi.prototype.Fa,Fi.prototype.setCoordinates=Fi.prototype.ma,t("ol.geom.Polygon",Yi,qy),Yi.prototype.appendLinearRing=Yi.prototype.uj,Yi.prototype.getArea=Yi.prototype.mm,Yi.prototype.getCoordinates=Yi.prototype.Z,Yi.prototype.getInteriorPoint=Yi.prototype.Yj,Yi.prototype.getLinearRingCount=Yi.prototype.ck,Yi.prototype.getLinearRing=Yi.prototype.Hg,Yi.prototype.getLinearRings=Yi.prototype.de,Yi.prototype.getType=Yi.prototype.V,Yi.prototype.intersectsExtent=Yi.prototype.Fa,Yi.prototype.setCoordinates=Yi.prototype.ma,t("ol.geom.Polygon.circular",Ki,qy),t("ol.geom.Polygon.fromExtent",$i,qy),t("ol.geom.Polygon.fromCircle",Ji,qy),t("ol.geom.SimpleGeometry",mi,qy),mi.prototype.getFirstCoordinate=mi.prototype.Lb,mi.prototype.getLastCoordinate=mi.prototype.Mb,mi.prototype.getLayout=mi.prototype.Nb,mi.prototype.applyTransform=mi.prototype.qc,mi.prototype.translate=mi.prototype.Qc,t("ol.format.EsriJSON",su,qy),su.prototype.readFeature=su.prototype.Ub,su.prototype.readFeatures=su.prototype.Ca,su.prototype.readGeometry=su.prototype.Uc,su.prototype.readProjection=su.prototype.Ka,su.prototype.writeGeometry=su.prototype.Zc,su.prototype.writeGeometryObject=su.prototype.We,su.prototype.writeFeature=su.prototype.Ld,su.prototype.writeFeatureObject=su.prototype.Yc,su.prototype.writeFeatures=su.prototype.Wb,su.prototype.writeFeaturesObject=su.prototype.Ue,t("ol.format.Feature",jc,qy),t("ol.format.GeoJSON",gu,qy),gu.prototype.readFeature=gu.prototype.Ub,gu.prototype.readFeatures=gu.prototype.Ca,gu.prototype.readGeometry=gu.prototype.Uc,gu.prototype.readProjection=gu.prototype.Ka,gu.prototype.writeFeature=gu.prototype.Ld,gu.prototype.writeFeatureObject=gu.prototype.Yc,gu.prototype.writeFeatures=gu.prototype.Wb,gu.prototype.writeFeaturesObject=gu.prototype.Ue,gu.prototype.writeGeometry=gu.prototype.Zc,gu.prototype.writeGeometryObject=gu.prototype.We,t("ol.format.GPX",Fu,qy),Fu.prototype.readFeature=Fu.prototype.Ub,Fu.prototype.readFeatures=Fu.prototype.Ca,Fu.prototype.readProjection=Fu.prototype.Ka,Fu.prototype.writeFeatures=Fu.prototype.Wb,Fu.prototype.writeFeaturesNode=Fu.prototype.f,t("ol.format.IGC",$u,qy),$u.prototype.readFeature=$u.prototype.Ub,$u.prototype.readFeatures=$u.prototype.Ca,$u.prototype.readProjection=$u.prototype.Ka,t("ol.format.KML",dd,qy),dd.prototype.readFeature=dd.prototype.Ub,dd.prototype.readFeatures=dd.prototype.Ca,dd.prototype.readName=dd.prototype.xo,dd.prototype.readNetworkLinks=dd.prototype.yo,dd.prototype.readProjection=dd.prototype.Ka,dd.prototype.writeFeatures=dd.prototype.Wb,dd.prototype.writeFeaturesNode=dd.prototype.f,t("ol.format.MVT",Gd,qy),Gd.prototype.setLayers=Gd.prototype.g,t("ol.format.OSMXML",Wd,qy),Wd.prototype.readFeatures=Wd.prototype.Ca,Wd.prototype.readProjection=Wd.prototype.Ka,t("ol.format.Polyline",$d,qy),t("ol.format.Polyline.encodeDeltas",Jd,qy),t("ol.format.Polyline.decodeDeltas",Qd,qy),t("ol.format.Polyline.encodeFloats",tf,qy),t("ol.format.Polyline.decodeFloats",ef,qy),$d.prototype.readFeature=$d.prototype.Ub,$d.prototype.readFeatures=$d.prototype.Ca,$d.prototype.readGeometry=$d.prototype.Uc,$d.prototype.readProjection=$d.prototype.Ka,$d.prototype.writeGeometry=$d.prototype.Zc,t("ol.format.TopoJSON",of,qy),of.prototype.readFeatures=of.prototype.Ca,of.prototype.readProjection=of.prototype.Ka,t("ol.format.WFS",af,qy),af.prototype.readFeatures=af.prototype.Ca,af.prototype.readTransactionResponse=af.prototype.j,af.prototype.readFeatureCollectionMetadata=af.prototype.i,af.prototype.writeGetFeature=af.prototype.l,af.prototype.writeTransaction=af.prototype.B,af.prototype.readProjection=af.prototype.Ka,t("ol.format.WKT",uf,qy),uf.prototype.readFeature=uf.prototype.Ub,uf.prototype.readFeatures=uf.prototype.Ca,uf.prototype.readGeometry=uf.prototype.Uc,uf.prototype.writeFeature=uf.prototype.Ld,uf.prototype.writeFeatures=uf.prototype.Wb,uf.prototype.writeGeometry=uf.prototype.Zc,t("ol.format.WMSCapabilities",Sf,qy),t("ol.format.WMSGetFeatureInfo",Lf,qy),Lf.prototype.readFeatures=Lf.prototype.Ca,t("ol.format.WMTSCapabilities",Of,qy),t("ol.format.GML2",Du,qy),t("ol.format.GML3",ku,qy),ku.prototype.writeGeometryNode=ku.prototype.o,ku.prototype.writeFeatures=ku.prototype.Wb,ku.prototype.writeFeaturesNode=ku.prototype.f,t("ol.format.GML",ku,qy),ku.prototype.writeFeatures=ku.prototype.Wb,ku.prototype.writeFeaturesNode=ku.prototype.f,xu.prototype.readFeatures=xu.prototype.Ca,t("ol.events.condition.altKeyOnly",function(t){return(t=t.a).f&&!t.l&&!t.c},qy),t("ol.events.condition.altShiftKeysOnly",zs,qy),t("ol.events.condition.always",Bm,qy),t("ol.events.condition.click",function(t){return t.type==F_},qy),t("ol.events.condition.never",Um,qy),t("ol.events.condition.pointerMove",Fs,qy),t("ol.events.condition.singleClick",Ns,qy),t("ol.events.condition.doubleClick",function(t){return t.type==N_},qy),t("ol.events.condition.noModifierKeys",Us,qy),t("ol.events.condition.platformModifierKeyOnly",function(t){return!(t=t.a).f&&t.l&&!t.c},qy),t("ol.events.condition.shiftKeyOnly",Bs,qy),t("ol.events.condition.targetNotEditable",js,qy),t("ol.events.condition.mouseOnly",Zs,qy),t("ol.control.Attribution",Nr,qy),t("ol.control.Attribution.render",Ur,qy),Nr.prototype.getCollapsible=Nr.prototype.Wl,Nr.prototype.setCollapsible=Nr.prototype.Zl,Nr.prototype.setCollapsed=Nr.prototype.Yl,Nr.prototype.getCollapsed=Nr.prototype.Vl,t("ol.control.Control",cr,qy),cr.prototype.getMap=cr.prototype.g,cr.prototype.setTarget=cr.prototype.c,t("ol.control.defaults",Vr,qy),t("ol.control.FullScreen",Yr,qy),t("ol.control.MousePosition",Xr,qy),t("ol.control.MousePosition.render",Kr,qy),Xr.prototype.getCoordinateFormat=Xr.prototype.Bg,Xr.prototype.getProjection=Xr.prototype.hh,Xr.prototype.setCoordinateFormat=Xr.prototype.bi,Xr.prototype.setProjection=Xr.prototype.ih,t("ol.control.OverviewMap",vc,qy),t("ol.control.OverviewMap.render",bc,qy),vc.prototype.getCollapsible=vc.prototype.bm,vc.prototype.setCollapsible=vc.prototype.em,vc.prototype.setCollapsed=vc.prototype.dm,vc.prototype.getCollapsed=vc.prototype.am,vc.prototype.getOverviewMap=vc.prototype.kk,t("ol.control.Rotate",jr,qy),t("ol.control.Rotate.render",Zr,qy),t("ol.control.ScaleLine",Pc,qy),Pc.prototype.getUnits=Pc.prototype.C,t("ol.control.ScaleLine.render",Ec,qy),Pc.prototype.setUnits=Pc.prototype.O,t("ol.control.Zoom",Gr,qy),t("ol.control.ZoomSlider",kc,qy),t("ol.control.ZoomSlider.render",zc,qy),t("ol.control.ZoomToExtent",Uc,qy),t("ol.color.asArray",Mo,qy),t("ol.color.asString",Po,qy),Gt.prototype.changed=Gt.prototype.u,Gt.prototype.dispatchEvent=Gt.prototype.s,Gt.prototype.getRevision=Gt.prototype.L,Gt.prototype.on=Gt.prototype.H,Gt.prototype.once=Gt.prototype.M,Gt.prototype.un=Gt.prototype.K,Gt.prototype.unByKey=Gt.prototype.N,xo.prototype.getKeys=xo.prototype.P,xo.prototype.getProperties=xo.prototype.R,xo.prototype.setProperties=xo.prototype.I,xo.prototype.unset=xo.prototype.S,xo.prototype.changed=xo.prototype.u,xo.prototype.dispatchEvent=xo.prototype.s,xo.prototype.getRevision=xo.prototype.L,xo.prototype.on=xo.prototype.H,xo.prototype.once=xo.prototype.M,xo.prototype.un=xo.prototype.K,xo.prototype.unByKey=xo.prototype.N,Bc.prototype.getKeys=Bc.prototype.P,Bc.prototype.getProperties=Bc.prototype.R,Bc.prototype.setProperties=Bc.prototype.I,Bc.prototype.unset=Bc.prototype.S,Bc.prototype.changed=Bc.prototype.u,Bc.prototype.dispatchEvent=Bc.prototype.s,Bc.prototype.getRevision=Bc.prototype.L,Bc.prototype.on=Bc.prototype.H,Bc.prototype.once=Bc.prototype.M,Bc.prototype.un=Bc.prototype.K,Bc.prototype.unByKey=Bc.prototype.N,Bl.prototype.getKeys=Bl.prototype.P,Bl.prototype.getProperties=Bl.prototype.R,Bl.prototype.setProperties=Bl.prototype.I,Bl.prototype.unset=Bl.prototype.S,Bl.prototype.changed=Bl.prototype.u,Bl.prototype.dispatchEvent=Bl.prototype.s,Bl.prototype.getRevision=Bl.prototype.L,Bl.prototype.on=Bl.prototype.H,Bl.prototype.once=Bl.prototype.M,Bl.prototype.un=Bl.prototype.K,Bl.prototype.unByKey=Bl.prototype.N,Df.prototype.getKeys=Df.prototype.P,Df.prototype.getProperties=Df.prototype.R,Df.prototype.setProperties=Df.prototype.I,Df.prototype.unset=Df.prototype.S,Df.prototype.changed=Df.prototype.u,Df.prototype.dispatchEvent=Df.prototype.s,Df.prototype.getRevision=Df.prototype.L,Df.prototype.on=Df.prototype.H,Df.prototype.once=Df.prototype.M,Df.prototype.un=Df.prototype.K,Df.prototype.unByKey=Df.prototype.N,Zf.prototype.getTileCoord=Zf.prototype.c,fc.prototype.getKeys=fc.prototype.P,fc.prototype.getProperties=fc.prototype.R,fc.prototype.setProperties=fc.prototype.I,fc.prototype.unset=fc.prototype.S,fc.prototype.changed=fc.prototype.u,fc.prototype.dispatchEvent=fc.prototype.s,fc.prototype.getRevision=fc.prototype.L,fc.prototype.on=fc.prototype.H,fc.prototype.once=fc.prototype.M,fc.prototype.un=fc.prototype.K,fc.prototype.unByKey=fc.prototype.N,Zn.prototype.stopPropagation=Zn.prototype.b,gc.prototype.getKeys=gc.prototype.P,gc.prototype.getProperties=gc.prototype.R,gc.prototype.setProperties=gc.prototype.I,gc.prototype.unset=gc.prototype.S,gc.prototype.changed=gc.prototype.u,gc.prototype.dispatchEvent=gc.prototype.s,gc.prototype.getRevision=gc.prototype.L,gc.prototype.on=gc.prototype.H,gc.prototype.once=gc.prototype.M,gc.prototype.un=gc.prototype.K,gc.prototype.unByKey=gc.prototype.N,Mh.prototype.getTileCoord=Mh.prototype.c,to.prototype.getKeys=to.prototype.P,to.prototype.getProperties=to.prototype.R,to.prototype.setProperties=to.prototype.I,to.prototype.unset=to.prototype.S,to.prototype.changed=to.prototype.u,to.prototype.dispatchEvent=to.prototype.s,to.prototype.getRevision=to.prototype.L,to.prototype.on=to.prototype.H,to.prototype.once=to.prototype.M,to.prototype.un=to.prototype.K,to.prototype.unByKey=to.prototype.N,Dy.prototype.getMaxZoom=Dy.prototype.Ig,Dy.prototype.getMinZoom=Dy.prototype.Jg,Dy.prototype.getOrigin=Dy.prototype.Ea,Dy.prototype.getResolution=Dy.prototype.$,Dy.prototype.getResolutions=Dy.prototype.Fh,Dy.prototype.getTileCoordExtent=Dy.prototype.Ba,Dy.prototype.getTileCoordForCoordAndResolution=Dy.prototype.he,Dy.prototype.getTileCoordForCoordAndZ=Dy.prototype.ie,Dy.prototype.getTileSize=Dy.prototype.Ma,Ba.prototype.getOpacity=Ba.prototype.De,Ba.prototype.getRotateWithView=Ba.prototype.fe,Ba.prototype.getRotation=Ba.prototype.Ee,Ba.prototype.getScale=Ba.prototype.Fe,Ba.prototype.getSnapToPixel=Ba.prototype.ge,Ba.prototype.setOpacity=Ba.prototype.Ge,Ba.prototype.setRotation=Ba.prototype.He,Ba.prototype.setScale=Ba.prototype.Ie,us.prototype.getOpacity=us.prototype.De,us.prototype.getRotateWithView=us.prototype.fe,us.prototype.getRotation=us.prototype.Ee,us.prototype.getScale=us.prototype.Fe,us.prototype.getSnapToPixel=us.prototype.ge,us.prototype.setOpacity=us.prototype.Ge,us.prototype.setRotation=us.prototype.He,us.prototype.setScale=us.prototype.Ie,Vy.prototype.getOpacity=Vy.prototype.De,Vy.prototype.getRotateWithView=Vy.prototype.fe,Vy.prototype.getRotation=Vy.prototype.Ee,Vy.prototype.getScale=Vy.prototype.Fe,Vy.prototype.getSnapToPixel=Vy.prototype.ge,Vy.prototype.setOpacity=Vy.prototype.Ge,Vy.prototype.setRotation=Vy.prototype.He,Vy.prototype.setScale=Vy.prototype.Ie,vr.prototype.getKeys=vr.prototype.P,vr.prototype.getProperties=vr.prototype.R,vr.prototype.setProperties=vr.prototype.I,vr.prototype.unset=vr.prototype.S,vr.prototype.changed=vr.prototype.u,vr.prototype.dispatchEvent=vr.prototype.s,vr.prototype.getRevision=vr.prototype.L,vr.prototype.on=vr.prototype.H,vr.prototype.once=vr.prototype.M,vr.prototype.un=vr.prototype.K,vr.prototype.unByKey=vr.prototype.N,Rr.prototype.getAttributions=Rr.prototype.ta,Rr.prototype.getLogo=Rr.prototype.ra,Rr.prototype.getProjection=Rr.prototype.ua,Rr.prototype.getState=Rr.prototype.va,Rr.prototype.setAttributions=Rr.prototype.oa,Rr.prototype.getKeys=Rr.prototype.P,Rr.prototype.getProperties=Rr.prototype.R,Rr.prototype.setProperties=Rr.prototype.I,Rr.prototype.unset=Rr.prototype.S,Rr.prototype.changed=Rr.prototype.u,Rr.prototype.dispatchEvent=Rr.prototype.s,Rr.prototype.getRevision=Rr.prototype.L,Rr.prototype.on=Rr.prototype.H,Rr.prototype.once=Rr.prototype.M,Rr.prototype.un=Rr.prototype.K,Rr.prototype.unByKey=Rr.prototype.N,cp.prototype.getTileGrid=cp.prototype.Ja,cp.prototype.getAttributions=cp.prototype.ta,cp.prototype.getLogo=cp.prototype.ra,cp.prototype.getProjection=cp.prototype.ua,cp.prototype.getState=cp.prototype.va,cp.prototype.setAttributions=cp.prototype.oa,cp.prototype.getKeys=cp.prototype.P,cp.prototype.getProperties=cp.prototype.R,cp.prototype.setProperties=cp.prototype.I,cp.prototype.unset=cp.prototype.S,cp.prototype.changed=cp.prototype.u,cp.prototype.dispatchEvent=cp.prototype.s,cp.prototype.getRevision=cp.prototype.L,cp.prototype.on=cp.prototype.H,cp.prototype.once=cp.prototype.M,cp.prototype.un=cp.prototype.K,cp.prototype.unByKey=cp.prototype.N,Qg.prototype.getTileLoadFunction=Qg.prototype.Za,Qg.prototype.getTileUrlFunction=Qg.prototype.$a,Qg.prototype.getUrls=Qg.prototype.ab,Qg.prototype.setTileLoadFunction=Qg.prototype.gb,Qg.prototype.setTileUrlFunction=Qg.prototype.La,Qg.prototype.setUrl=Qg.prototype.Wa,Qg.prototype.setUrls=Qg.prototype.Xa,Qg.prototype.getTileGrid=Qg.prototype.Ja,Qg.prototype.getAttributions=Qg.prototype.ta,Qg.prototype.getLogo=Qg.prototype.ra,Qg.prototype.getProjection=Qg.prototype.ua,Qg.prototype.getState=Qg.prototype.va,Qg.prototype.setAttributions=Qg.prototype.oa,Qg.prototype.getKeys=Qg.prototype.P,Qg.prototype.getProperties=Qg.prototype.R,Qg.prototype.setProperties=Qg.prototype.I,Qg.prototype.unset=Qg.prototype.S,Qg.prototype.changed=Qg.prototype.u,Qg.prototype.dispatchEvent=Qg.prototype.s,Qg.prototype.getRevision=Qg.prototype.L,Qg.prototype.on=Qg.prototype.H,Qg.prototype.once=Qg.prototype.M,Qg.prototype.un=Qg.prototype.K,Qg.prototype.unByKey=Qg.prototype.N,oy.prototype.setRenderReprojectionEdges=oy.prototype.xb,oy.prototype.setTileGridForProjection=oy.prototype.yb,oy.prototype.getTileLoadFunction=oy.prototype.Za,oy.prototype.getTileUrlFunction=oy.prototype.$a,oy.prototype.getUrls=oy.prototype.ab,oy.prototype.setTileLoadFunction=oy.prototype.gb,oy.prototype.setTileUrlFunction=oy.prototype.La,oy.prototype.setUrl=oy.prototype.Wa,oy.prototype.setUrls=oy.prototype.Xa,oy.prototype.getTileGrid=oy.prototype.Ja,oy.prototype.getAttributions=oy.prototype.ta,oy.prototype.getLogo=oy.prototype.ra,oy.prototype.getProjection=oy.prototype.ua,oy.prototype.getState=oy.prototype.va,oy.prototype.setAttributions=oy.prototype.oa,oy.prototype.getKeys=oy.prototype.P,oy.prototype.getProperties=oy.prototype.R,oy.prototype.setProperties=oy.prototype.I,oy.prototype.unset=oy.prototype.S,oy.prototype.changed=oy.prototype.u,oy.prototype.dispatchEvent=oy.prototype.s,oy.prototype.getRevision=oy.prototype.L,oy.prototype.on=oy.prototype.H,oy.prototype.once=oy.prototype.M,oy.prototype.un=oy.prototype.K,oy.prototype.unByKey=oy.prototype.N,$h.prototype.getAttributions=$h.prototype.ta,$h.prototype.getLogo=$h.prototype.ra,$h.prototype.getProjection=$h.prototype.ua,$h.prototype.getState=$h.prototype.va,$h.prototype.setAttributions=$h.prototype.oa,$h.prototype.getKeys=$h.prototype.P,$h.prototype.getProperties=$h.prototype.R,$h.prototype.setProperties=$h.prototype.I,$h.prototype.unset=$h.prototype.S,$h.prototype.changed=$h.prototype.u,$h.prototype.dispatchEvent=$h.prototype.s,$h.prototype.getRevision=$h.prototype.L,$h.prototype.on=$h.prototype.H,$h.prototype.once=$h.prototype.M,$h.prototype.un=$h.prototype.K,$h.prototype.unByKey=$h.prototype.N,ry.prototype.addFeature=ry.prototype.Dd,ry.prototype.addFeatures=ry.prototype.Ic,ry.prototype.forEachFeature=ry.prototype.wg,ry.prototype.forEachFeatureInExtent=ry.prototype.rb,ry.prototype.forEachFeatureIntersectingExtent=ry.prototype.xg,ry.prototype.getFeaturesCollection=ry.prototype.Eg,ry.prototype.getFeatures=ry.prototype.Be,ry.prototype.getFeaturesAtCoordinate=ry.prototype.Dg,ry.prototype.getFeaturesInExtent=ry.prototype.pf,ry.prototype.getClosestFeatureToCoordinate=ry.prototype.zg,ry.prototype.getExtent=ry.prototype.J,ry.prototype.getFeatureById=ry.prototype.Cg,ry.prototype.removeFeature=ry.prototype.Sc,ry.prototype.getAttributions=ry.prototype.ta,ry.prototype.getLogo=ry.prototype.ra,ry.prototype.getProjection=ry.prototype.ua,ry.prototype.getState=ry.prototype.va,ry.prototype.setAttributions=ry.prototype.oa,ry.prototype.getKeys=ry.prototype.P,ry.prototype.getProperties=ry.prototype.R,ry.prototype.setProperties=ry.prototype.I,ry.prototype.unset=ry.prototype.S,ry.prototype.changed=ry.prototype.u,ry.prototype.dispatchEvent=ry.prototype.s,ry.prototype.getRevision=ry.prototype.L,ry.prototype.on=ry.prototype.H,ry.prototype.once=ry.prototype.M,ry.prototype.un=ry.prototype.K,ry.prototype.unByKey=ry.prototype.N,kl.prototype.getAttributions=kl.prototype.ta,kl.prototype.getLogo=kl.prototype.ra,kl.prototype.getProjection=kl.prototype.ua,kl.prototype.getState=kl.prototype.va,kl.prototype.setAttributions=kl.prototype.oa,kl.prototype.getKeys=kl.prototype.P,kl.prototype.getProperties=kl.prototype.R,kl.prototype.setProperties=kl.prototype.I,kl.prototype.unset=kl.prototype.S,kl.prototype.changed=kl.prototype.u,kl.prototype.dispatchEvent=kl.prototype.s,kl.prototype.getRevision=kl.prototype.L,kl.prototype.on=kl.prototype.H,kl.prototype.once=kl.prototype.M,kl.prototype.un=kl.prototype.K,kl.prototype.unByKey=kl.prototype.N,Ul.prototype.getAttributions=Ul.prototype.ta,Ul.prototype.getLogo=Ul.prototype.ra,Ul.prototype.getProjection=Ul.prototype.ua,Ul.prototype.getState=Ul.prototype.va,Ul.prototype.setAttributions=Ul.prototype.oa,Ul.prototype.getKeys=Ul.prototype.P,Ul.prototype.getProperties=Ul.prototype.R,Ul.prototype.setProperties=Ul.prototype.I,Ul.prototype.unset=Ul.prototype.S,Ul.prototype.changed=Ul.prototype.u,Ul.prototype.dispatchEvent=Ul.prototype.s,Ul.prototype.getRevision=Ul.prototype.L,Ul.prototype.on=Ul.prototype.H,Ul.prototype.once=Ul.prototype.M,Ul.prototype.un=Ul.prototype.K,Ul.prototype.unByKey=Ul.prototype.N,sy.prototype.getAttributions=sy.prototype.ta,sy.prototype.getLogo=sy.prototype.ra,sy.prototype.getProjection=sy.prototype.ua,sy.prototype.getState=sy.prototype.va,sy.prototype.setAttributions=sy.prototype.oa,sy.prototype.getKeys=sy.prototype.P,sy.prototype.getProperties=sy.prototype.R,sy.prototype.setProperties=sy.prototype.I,sy.prototype.unset=sy.prototype.S,sy.prototype.changed=sy.prototype.u,sy.prototype.dispatchEvent=sy.prototype.s,sy.prototype.getRevision=sy.prototype.L,sy.prototype.on=sy.prototype.H,sy.prototype.once=sy.prototype.M,sy.prototype.un=sy.prototype.K,sy.prototype.unByKey=sy.prototype.N,ay.prototype.getAttributions=ay.prototype.ta,ay.prototype.getLogo=ay.prototype.ra,ay.prototype.getProjection=ay.prototype.ua,ay.prototype.getState=ay.prototype.va,ay.prototype.setAttributions=ay.prototype.oa,ay.prototype.getKeys=ay.prototype.P,ay.prototype.getProperties=ay.prototype.R,ay.prototype.setProperties=ay.prototype.I,ay.prototype.unset=ay.prototype.S,ay.prototype.changed=ay.prototype.u,ay.prototype.dispatchEvent=ay.prototype.s,ay.prototype.getRevision=ay.prototype.L,ay.prototype.on=ay.prototype.H,ay.prototype.once=ay.prototype.M,ay.prototype.un=ay.prototype.K,ay.prototype.unByKey=ay.prototype.N,op.prototype.getAttributions=op.prototype.ta,op.prototype.getLogo=op.prototype.ra,op.prototype.getProjection=op.prototype.ua,op.prototype.getState=op.prototype.va,op.prototype.setAttributions=op.prototype.oa,op.prototype.getKeys=op.prototype.P,op.prototype.getProperties=op.prototype.R,op.prototype.setProperties=op.prototype.I,op.prototype.unset=op.prototype.S,op.prototype.changed=op.prototype.u,op.prototype.dispatchEvent=op.prototype.s,op.prototype.getRevision=op.prototype.L,op.prototype.on=op.prototype.H,op.prototype.once=op.prototype.M,op.prototype.un=op.prototype.K,op.prototype.unByKey=op.prototype.N,ly.prototype.getAttributions=ly.prototype.ta,ly.prototype.getLogo=ly.prototype.ra,ly.prototype.getProjection=ly.prototype.ua,ly.prototype.getState=ly.prototype.va,ly.prototype.setAttributions=ly.prototype.oa,ly.prototype.getKeys=ly.prototype.P,ly.prototype.getProperties=ly.prototype.R,ly.prototype.setProperties=ly.prototype.I,ly.prototype.unset=ly.prototype.S,ly.prototype.changed=ly.prototype.u,ly.prototype.dispatchEvent=ly.prototype.s,ly.prototype.getRevision=ly.prototype.L,ly.prototype.on=ly.prototype.H,ly.prototype.once=ly.prototype.M,ly.prototype.un=ly.prototype.K,ly.prototype.unByKey=ly.prototype.N,cy.prototype.setRenderReprojectionEdges=cy.prototype.xb,cy.prototype.setTileGridForProjection=cy.prototype.yb,cy.prototype.getTileLoadFunction=cy.prototype.Za,cy.prototype.getTileUrlFunction=cy.prototype.$a,cy.prototype.getUrls=cy.prototype.ab,cy.prototype.setTileLoadFunction=cy.prototype.gb,cy.prototype.setTileUrlFunction=cy.prototype.La,cy.prototype.setUrl=cy.prototype.Wa,cy.prototype.setUrls=cy.prototype.Xa,cy.prototype.getTileGrid=cy.prototype.Ja,cy.prototype.getAttributions=cy.prototype.ta,cy.prototype.getLogo=cy.prototype.ra,cy.prototype.getProjection=cy.prototype.ua,cy.prototype.getState=cy.prototype.va,cy.prototype.setAttributions=cy.prototype.oa,cy.prototype.getKeys=cy.prototype.P,cy.prototype.getProperties=cy.prototype.R,cy.prototype.setProperties=cy.prototype.I,cy.prototype.unset=cy.prototype.S,cy.prototype.changed=cy.prototype.u,cy.prototype.dispatchEvent=cy.prototype.s,cy.prototype.getRevision=cy.prototype.L,cy.prototype.on=cy.prototype.H,cy.prototype.once=cy.prototype.M,cy.prototype.un=cy.prototype.K,cy.prototype.unByKey=cy.prototype.N,dy.prototype.setRenderReprojectionEdges=dy.prototype.xb,dy.prototype.setTileGridForProjection=dy.prototype.yb,dy.prototype.getTileLoadFunction=dy.prototype.Za,dy.prototype.getTileUrlFunction=dy.prototype.$a,dy.prototype.getUrls=dy.prototype.ab,dy.prototype.setTileLoadFunction=dy.prototype.gb,dy.prototype.setTileUrlFunction=dy.prototype.La,dy.prototype.setUrl=dy.prototype.Wa,dy.prototype.setUrls=dy.prototype.Xa,dy.prototype.getTileGrid=dy.prototype.Ja,dy.prototype.getAttributions=dy.prototype.ta,dy.prototype.getLogo=dy.prototype.ra,dy.prototype.getProjection=dy.prototype.ua,dy.prototype.getState=dy.prototype.va,dy.prototype.setAttributions=dy.prototype.oa,dy.prototype.getKeys=dy.prototype.P,dy.prototype.getProperties=dy.prototype.R,dy.prototype.setProperties=dy.prototype.I,dy.prototype.unset=dy.prototype.S,dy.prototype.changed=dy.prototype.u,dy.prototype.dispatchEvent=dy.prototype.s,dy.prototype.getRevision=dy.prototype.L,dy.prototype.on=dy.prototype.H,dy.prototype.once=dy.prototype.M,dy.prototype.un=dy.prototype.K,dy.prototype.unByKey=dy.prototype.N,uy.prototype.setRenderReprojectionEdges=uy.prototype.xb,uy.prototype.setTileGridForProjection=uy.prototype.yb,uy.prototype.getTileLoadFunction=uy.prototype.Za,uy.prototype.getTileUrlFunction=uy.prototype.$a,uy.prototype.getUrls=uy.prototype.ab,uy.prototype.setTileLoadFunction=uy.prototype.gb,uy.prototype.setTileUrlFunction=uy.prototype.La,uy.prototype.setUrl=uy.prototype.Wa,uy.prototype.setUrls=uy.prototype.Xa,uy.prototype.getTileGrid=uy.prototype.Ja,uy.prototype.getAttributions=uy.prototype.ta,uy.prototype.getLogo=uy.prototype.ra,uy.prototype.getProjection=uy.prototype.ua,uy.prototype.getState=uy.prototype.va,uy.prototype.setAttributions=uy.prototype.oa,uy.prototype.getKeys=uy.prototype.P,uy.prototype.getProperties=uy.prototype.R,uy.prototype.setProperties=uy.prototype.I,uy.prototype.unset=uy.prototype.S,uy.prototype.changed=uy.prototype.u,uy.prototype.dispatchEvent=uy.prototype.s,uy.prototype.getRevision=uy.prototype.L,uy.prototype.on=uy.prototype.H,uy.prototype.once=uy.prototype.M,uy.prototype.un=uy.prototype.K,uy.prototype.unByKey=uy.prototype.N,fy.prototype.getAttributions=fy.prototype.ta,fy.prototype.getLogo=fy.prototype.ra,fy.prototype.getProjection=fy.prototype.ua,fy.prototype.getState=fy.prototype.va,fy.prototype.setAttributions=fy.prototype.oa,fy.prototype.getKeys=fy.prototype.P,fy.prototype.getProperties=fy.prototype.R,fy.prototype.setProperties=fy.prototype.I,fy.prototype.unset=fy.prototype.S,fy.prototype.changed=fy.prototype.u,fy.prototype.dispatchEvent=fy.prototype.s,fy.prototype.getRevision=fy.prototype.L,fy.prototype.on=fy.prototype.H,fy.prototype.once=fy.prototype.M,fy.prototype.un=fy.prototype.K,fy.prototype.unByKey=fy.prototype.N,my.prototype.setRenderReprojectionEdges=my.prototype.xb,my.prototype.setTileGridForProjection=my.prototype.yb,my.prototype.getTileLoadFunction=my.prototype.Za,my.prototype.getTileUrlFunction=my.prototype.$a,my.prototype.getUrls=my.prototype.ab,my.prototype.setTileLoadFunction=my.prototype.gb,my.prototype.setTileUrlFunction=my.prototype.La,my.prototype.setUrl=my.prototype.Wa,my.prototype.setUrls=my.prototype.Xa,my.prototype.getTileGrid=my.prototype.Ja,my.prototype.getAttributions=my.prototype.ta,my.prototype.getLogo=my.prototype.ra,my.prototype.getProjection=my.prototype.ua,my.prototype.getState=my.prototype.va,my.prototype.setAttributions=my.prototype.oa,my.prototype.getKeys=my.prototype.P,my.prototype.getProperties=my.prototype.R,my.prototype.setProperties=my.prototype.I,my.prototype.unset=my.prototype.S,my.prototype.changed=my.prototype.u,my.prototype.dispatchEvent=my.prototype.s,my.prototype.getRevision=my.prototype.L,my.prototype.on=my.prototype.H,my.prototype.once=my.prototype.M,my.prototype.un=my.prototype.K,my.prototype.unByKey=my.prototype.N,_y.prototype.setRenderReprojectionEdges=_y.prototype.xb,_y.prototype.setTileGridForProjection=_y.prototype.yb,_y.prototype.getTileLoadFunction=_y.prototype.Za,_y.prototype.getTileUrlFunction=_y.prototype.$a,_y.prototype.getUrls=_y.prototype.ab,_y.prototype.setTileLoadFunction=_y.prototype.gb,_y.prototype.setTileUrlFunction=_y.prototype.La,_y.prototype.setUrl=_y.prototype.Wa,_y.prototype.setUrls=_y.prototype.Xa,_y.prototype.getTileGrid=_y.prototype.Ja,_y.prototype.getAttributions=_y.prototype.ta,_y.prototype.getLogo=_y.prototype.ra,_y.prototype.getProjection=_y.prototype.ua,_y.prototype.getState=_y.prototype.va,_y.prototype.setAttributions=_y.prototype.oa,_y.prototype.getKeys=_y.prototype.P,_y.prototype.getProperties=_y.prototype.R,_y.prototype.setProperties=_y.prototype.I,_y.prototype.unset=_y.prototype.S,_y.prototype.changed=_y.prototype.u,_y.prototype.dispatchEvent=_y.prototype.s,_y.prototype.getRevision=_y.prototype.L,_y.prototype.on=_y.prototype.H,_y.prototype.once=_y.prototype.M,_y.prototype.un=_y.prototype.K,_y.prototype.unByKey=_y.prototype.N,by.prototype.getTileGrid=by.prototype.Ja,by.prototype.getAttributions=by.prototype.ta,by.prototype.getLogo=by.prototype.ra,by.prototype.getProjection=by.prototype.ua,by.prototype.getState=by.prototype.va,by.prototype.setAttributions=by.prototype.oa,by.prototype.getKeys=by.prototype.P,by.prototype.getProperties=by.prototype.R,by.prototype.setProperties=by.prototype.I,by.prototype.unset=by.prototype.S,by.prototype.changed=by.prototype.u,by.prototype.dispatchEvent=by.prototype.s,by.prototype.getRevision=by.prototype.L,by.prototype.on=by.prototype.H,by.prototype.once=by.prototype.M,by.prototype.un=by.prototype.K,by.prototype.unByKey=by.prototype.N,Py.prototype.setRenderReprojectionEdges=Py.prototype.xb,Py.prototype.setTileGridForProjection=Py.prototype.yb,Py.prototype.getTileLoadFunction=Py.prototype.Za,Py.prototype.getTileUrlFunction=Py.prototype.$a,Py.prototype.getUrls=Py.prototype.ab,Py.prototype.setTileLoadFunction=Py.prototype.gb,Py.prototype.setTileUrlFunction=Py.prototype.La,Py.prototype.setUrl=Py.prototype.Wa,Py.prototype.setUrls=Py.prototype.Xa,Py.prototype.getTileGrid=Py.prototype.Ja,Py.prototype.getAttributions=Py.prototype.ta,Py.prototype.getLogo=Py.prototype.ra,Py.prototype.getProjection=Py.prototype.ua,Py.prototype.getState=Py.prototype.va,Py.prototype.setAttributions=Py.prototype.oa,Py.prototype.getKeys=Py.prototype.P,Py.prototype.getProperties=Py.prototype.R,Py.prototype.setProperties=Py.prototype.I,Py.prototype.unset=Py.prototype.S,Py.prototype.changed=Py.prototype.u,Py.prototype.dispatchEvent=Py.prototype.s,Py.prototype.getRevision=Py.prototype.L,Py.prototype.on=Py.prototype.H,Py.prototype.once=Py.prototype.M,Py.prototype.un=Py.prototype.K,Py.prototype.unByKey=Py.prototype.N,Ey.prototype.getTileGrid=Ey.prototype.Ja,Ey.prototype.getAttributions=Ey.prototype.ta,Ey.prototype.getLogo=Ey.prototype.ra,Ey.prototype.getProjection=Ey.prototype.ua,Ey.prototype.getState=Ey.prototype.va,Ey.prototype.setAttributions=Ey.prototype.oa,Ey.prototype.getKeys=Ey.prototype.P,Ey.prototype.getProperties=Ey.prototype.R,Ey.prototype.setProperties=Ey.prototype.I,Ey.prototype.unset=Ey.prototype.S,Ey.prototype.changed=Ey.prototype.u,Ey.prototype.dispatchEvent=Ey.prototype.s,Ey.prototype.getRevision=Ey.prototype.L,Ey.prototype.on=Ey.prototype.H,Ey.prototype.once=Ey.prototype.M,Ey.prototype.un=Ey.prototype.K,Ey.prototype.unByKey=Ey.prototype.N,Cy.prototype.setRenderReprojectionEdges=Cy.prototype.xb,Cy.prototype.setTileGridForProjection=Cy.prototype.yb,Cy.prototype.getTileLoadFunction=Cy.prototype.Za,Cy.prototype.getTileUrlFunction=Cy.prototype.$a,Cy.prototype.getUrls=Cy.prototype.ab,Cy.prototype.setTileLoadFunction=Cy.prototype.gb,Cy.prototype.setTileUrlFunction=Cy.prototype.La,Cy.prototype.setUrl=Cy.prototype.Wa,Cy.prototype.setUrls=Cy.prototype.Xa,Cy.prototype.getTileGrid=Cy.prototype.Ja,Cy.prototype.getAttributions=Cy.prototype.ta,Cy.prototype.getLogo=Cy.prototype.ra,Cy.prototype.getProjection=Cy.prototype.ua,Cy.prototype.getState=Cy.prototype.va,Cy.prototype.setAttributions=Cy.prototype.oa,Cy.prototype.getKeys=Cy.prototype.P,Cy.prototype.getProperties=Cy.prototype.R,Cy.prototype.setProperties=Cy.prototype.I,Cy.prototype.unset=Cy.prototype.S,Cy.prototype.changed=Cy.prototype.u,Cy.prototype.dispatchEvent=Cy.prototype.s,Cy.prototype.getRevision=Cy.prototype.L,Cy.prototype.on=Cy.prototype.H,Cy.prototype.once=Cy.prototype.M,Cy.prototype.un=Cy.prototype.K,Cy.prototype.unByKey=Cy.prototype.N,up.prototype.getTileLoadFunction=up.prototype.Za,up.prototype.getTileUrlFunction=up.prototype.$a,up.prototype.getUrls=up.prototype.ab,up.prototype.setTileLoadFunction=up.prototype.gb,up.prototype.setTileUrlFunction=up.prototype.La,up.prototype.setUrl=up.prototype.Wa,up.prototype.setUrls=up.prototype.Xa,up.prototype.getTileGrid=up.prototype.Ja,up.prototype.getAttributions=up.prototype.ta,up.prototype.getLogo=up.prototype.ra,up.prototype.getProjection=up.prototype.ua,up.prototype.getState=up.prototype.va,up.prototype.setAttributions=up.prototype.oa,up.prototype.getKeys=up.prototype.P,up.prototype.getProperties=up.prototype.R,up.prototype.setProperties=up.prototype.I,up.prototype.unset=up.prototype.S,up.prototype.changed=up.prototype.u,up.prototype.dispatchEvent=up.prototype.s,up.prototype.getRevision=up.prototype.L,up.prototype.on=up.prototype.H,up.prototype.once=up.prototype.M,up.prototype.un=up.prototype.K,up.prototype.unByKey=up.prototype.N,zy.prototype.setRenderReprojectionEdges=zy.prototype.xb,zy.prototype.setTileGridForProjection=zy.prototype.yb,zy.prototype.getTileLoadFunction=zy.prototype.Za,zy.prototype.getTileUrlFunction=zy.prototype.$a,zy.prototype.getUrls=zy.prototype.ab,zy.prototype.setTileLoadFunction=zy.prototype.gb,zy.prototype.setTileUrlFunction=zy.prototype.La,zy.prototype.setUrl=zy.prototype.Wa,zy.prototype.setUrls=zy.prototype.Xa,zy.prototype.getTileGrid=zy.prototype.Ja,zy.prototype.getAttributions=zy.prototype.ta,zy.prototype.getLogo=zy.prototype.ra,zy.prototype.getProjection=zy.prototype.ua,zy.prototype.getState=zy.prototype.va,zy.prototype.setAttributions=zy.prototype.oa,zy.prototype.getKeys=zy.prototype.P,zy.prototype.getProperties=zy.prototype.R,zy.prototype.setProperties=zy.prototype.I,zy.prototype.unset=zy.prototype.S,zy.prototype.changed=zy.prototype.u,zy.prototype.dispatchEvent=zy.prototype.s,zy.prototype.getRevision=zy.prototype.L,zy.prototype.on=zy.prototype.H,zy.prototype.once=zy.prototype.M,zy.prototype.un=zy.prototype.K,zy.prototype.unByKey=zy.prototype.N,Ny.prototype.setRenderReprojectionEdges=Ny.prototype.xb,Ny.prototype.setTileGridForProjection=Ny.prototype.yb,Ny.prototype.getTileLoadFunction=Ny.prototype.Za,Ny.prototype.getTileUrlFunction=Ny.prototype.$a,Ny.prototype.getUrls=Ny.prototype.ab,Ny.prototype.setTileLoadFunction=Ny.prototype.gb,Ny.prototype.setTileUrlFunction=Ny.prototype.La,Ny.prototype.setUrl=Ny.prototype.Wa,Ny.prototype.setUrls=Ny.prototype.Xa,Ny.prototype.getTileGrid=Ny.prototype.Ja,Ny.prototype.getAttributions=Ny.prototype.ta,Ny.prototype.getLogo=Ny.prototype.ra,Ny.prototype.getProjection=Ny.prototype.ua,Ny.prototype.getState=Ny.prototype.va,Ny.prototype.setAttributions=Ny.prototype.oa,Ny.prototype.getKeys=Ny.prototype.P,Ny.prototype.getProperties=Ny.prototype.R,Ny.prototype.setProperties=Ny.prototype.I,Ny.prototype.unset=Ny.prototype.S,Ny.prototype.changed=Ny.prototype.u,Ny.prototype.dispatchEvent=Ny.prototype.s,Ny.prototype.getRevision=Ny.prototype.L,Ny.prototype.on=Ny.prototype.H,Ny.prototype.once=Ny.prototype.M,Ny.prototype.un=Ny.prototype.K,Ny.prototype.unByKey=Ny.prototype.N,Hg.prototype.getTileCoord=Hg.prototype.c,is.prototype.changed=is.prototype.u,is.prototype.dispatchEvent=is.prototype.s,is.prototype.getRevision=is.prototype.L,is.prototype.on=is.prototype.H,is.prototype.once=is.prototype.M,is.prototype.un=is.prototype.K,is.prototype.unByKey=is.prototype.N,ic.prototype.changed=ic.prototype.u,ic.prototype.dispatchEvent=ic.prototype.s,ic.prototype.getRevision=ic.prototype.L,ic.prototype.on=ic.prototype.H,ic.prototype.once=ic.prototype.M,ic.prototype.un=ic.prototype.K,ic.prototype.unByKey=ic.prototype.N,rc.prototype.changed=rc.prototype.u,rc.prototype.dispatchEvent=rc.prototype.s,rc.prototype.getRevision=rc.prototype.L,rc.prototype.on=rc.prototype.H,rc.prototype.once=rc.prototype.M,rc.prototype.un=rc.prototype.K,rc.prototype.unByKey=rc.prototype.N,lc.prototype.changed=lc.prototype.u,lc.prototype.dispatchEvent=lc.prototype.s,lc.prototype.getRevision=lc.prototype.L,lc.prototype.on=lc.prototype.H,lc.prototype.once=lc.prototype.M,lc.prototype.un=lc.prototype.K,lc.prototype.unByKey=lc.prototype.N,hc.prototype.changed=hc.prototype.u,hc.prototype.dispatchEvent=hc.prototype.s,hc.prototype.getRevision=hc.prototype.L,hc.prototype.on=hc.prototype.H,hc.prototype.once=hc.prototype.M,hc.prototype.un=hc.prototype.K,hc.prototype.unByKey=hc.prototype.N,_p.prototype.changed=_p.prototype.u,_p.prototype.dispatchEvent=_p.prototype.s,_p.prototype.getRevision=_p.prototype.L,_p.prototype.on=_p.prototype.H,_p.prototype.once=_p.prototype.M,_p.prototype.un=_p.prototype.K,_p.prototype.unByKey=_p.prototype.N,vp.prototype.changed=vp.prototype.u,vp.prototype.dispatchEvent=vp.prototype.s,vp.prototype.getRevision=vp.prototype.L,vp.prototype.on=vp.prototype.H,vp.prototype.once=vp.prototype.M,vp.prototype.un=vp.prototype.K,vp.prototype.unByKey=vp.prototype.N,bp.prototype.changed=bp.prototype.u,bp.prototype.dispatchEvent=bp.prototype.s,bp.prototype.getRevision=bp.prototype.L,bp.prototype.on=bp.prototype.H,bp.prototype.once=bp.prototype.M,bp.prototype.un=bp.prototype.K,bp.prototype.unByKey=bp.prototype.N,wp.prototype.changed=wp.prototype.u,wp.prototype.dispatchEvent=wp.prototype.s,wp.prototype.getRevision=wp.prototype.L,wp.prototype.on=wp.prototype.H,wp.prototype.once=wp.prototype.M,wp.prototype.un=wp.prototype.K,wp.prototype.unByKey=wp.prototype.N,ol.prototype.changed=ol.prototype.u,ol.prototype.dispatchEvent=ol.prototype.s,ol.prototype.getRevision=ol.prototype.L,ol.prototype.on=ol.prototype.H,ol.prototype.once=ol.prototype.M,ol.prototype.un=ol.prototype.K,ol.prototype.unByKey=ol.prototype.N,rp.prototype.changed=rp.prototype.u,rp.prototype.dispatchEvent=rp.prototype.s,rp.prototype.getRevision=rp.prototype.L,rp.prototype.on=rp.prototype.H,rp.prototype.once=rp.prototype.M,rp.prototype.un=rp.prototype.K,rp.prototype.unByKey=rp.prototype.N,np.prototype.changed=np.prototype.u,np.prototype.dispatchEvent=np.prototype.s,np.prototype.getRevision=np.prototype.L,np.prototype.on=np.prototype.H,np.prototype.once=np.prototype.M,np.prototype.un=np.prototype.K,np.prototype.unByKey=np.prototype.N,sp.prototype.changed=sp.prototype.u,sp.prototype.dispatchEvent=sp.prototype.s,sp.prototype.getRevision=sp.prototype.L,sp.prototype.on=sp.prototype.H,sp.prototype.once=sp.prototype.M,sp.prototype.un=sp.prototype.K,sp.prototype.unByKey=sp.prototype.N,fp.prototype.changed=fp.prototype.u,fp.prototype.dispatchEvent=fp.prototype.s,fp.prototype.getRevision=fp.prototype.L,fp.prototype.on=fp.prototype.H,fp.prototype.once=fp.prototype.M,fp.prototype.un=fp.prototype.K,fp.prototype.unByKey=fp.prototype.N,Wn.prototype.getKeys=Wn.prototype.P,Wn.prototype.getProperties=Wn.prototype.R,Wn.prototype.setProperties=Wn.prototype.I,Wn.prototype.unset=Wn.prototype.S,Wn.prototype.changed=Wn.prototype.u,Wn.prototype.dispatchEvent=Wn.prototype.s,Wn.prototype.getRevision=Wn.prototype.L,Wn.prototype.on=Wn.prototype.H,Wn.prototype.once=Wn.prototype.M,Wn.prototype.un=Wn.prototype.K,Wn.prototype.unByKey=Wn.prototype.N,Xn.prototype.getExtent=Xn.prototype.J,Xn.prototype.getMaxResolution=Xn.prototype.Ob,Xn.prototype.getMinResolution=Xn.prototype.Pb,Xn.prototype.getOpacity=Xn.prototype.Sb,Xn.prototype.getVisible=Xn.prototype.tb,Xn.prototype.getZIndex=Xn.prototype.Tb,Xn.prototype.setExtent=Xn.prototype.dc,Xn.prototype.setMaxResolution=Xn.prototype.lc,Xn.prototype.setMinResolution=Xn.prototype.mc,Xn.prototype.setOpacity=Xn.prototype.ec,Xn.prototype.setVisible=Xn.prototype.fc,Xn.prototype.setZIndex=Xn.prototype.gc,Xn.prototype.getKeys=Xn.prototype.P,Xn.prototype.getProperties=Xn.prototype.R,Xn.prototype.setProperties=Xn.prototype.I,Xn.prototype.unset=Xn.prototype.S,Xn.prototype.changed=Xn.prototype.u,Xn.prototype.dispatchEvent=Xn.prototype.s,Xn.prototype.getRevision=Xn.prototype.L,Xn.prototype.on=Xn.prototype.H,Xn.prototype.once=Xn.prototype.M,Xn.prototype.un=Xn.prototype.K,Xn.prototype.unByKey=Xn.prototype.N,Ha.prototype.setSource=Ha.prototype.Dc,Ha.prototype.getExtent=Ha.prototype.J,Ha.prototype.getMaxResolution=Ha.prototype.Ob,Ha.prototype.getMinResolution=Ha.prototype.Pb,Ha.prototype.getOpacity=Ha.prototype.Sb,Ha.prototype.getVisible=Ha.prototype.tb,Ha.prototype.getZIndex=Ha.prototype.Tb,Ha.prototype.setExtent=Ha.prototype.dc,Ha.prototype.setMaxResolution=Ha.prototype.lc,Ha.prototype.setMinResolution=Ha.prototype.mc,Ha.prototype.setOpacity=Ha.prototype.ec,Ha.prototype.setVisible=Ha.prototype.fc,Ha.prototype.setZIndex=Ha.prototype.gc,Ha.prototype.getKeys=Ha.prototype.P,Ha.prototype.getProperties=Ha.prototype.R,Ha.prototype.setProperties=Ha.prototype.I,Ha.prototype.unset=Ha.prototype.S,Ha.prototype.changed=Ha.prototype.u,Ha.prototype.dispatchEvent=Ha.prototype.s,Ha.prototype.getRevision=Ha.prototype.L,Ha.prototype.on=Ha.prototype.H,Ha.prototype.once=Ha.prototype.M,Ha.prototype.un=Ha.prototype.K,Ha.prototype.unByKey=Ha.prototype.N,Wg.prototype.getSource=Wg.prototype.ea,Wg.prototype.getStyle=Wg.prototype.C,Wg.prototype.getStyleFunction=Wg.prototype.D,Wg.prototype.setStyle=Wg.prototype.c,Wg.prototype.setSource=Wg.prototype.Dc,Wg.prototype.getExtent=Wg.prototype.J,Wg.prototype.getMaxResolution=Wg.prototype.Ob,Wg.prototype.getMinResolution=Wg.prototype.Pb,Wg.prototype.getOpacity=Wg.prototype.Sb,Wg.prototype.getVisible=Wg.prototype.tb,Wg.prototype.getZIndex=Wg.prototype.Tb,Wg.prototype.setExtent=Wg.prototype.dc,Wg.prototype.setMaxResolution=Wg.prototype.lc,Wg.prototype.setMinResolution=Wg.prototype.mc,Wg.prototype.setOpacity=Wg.prototype.ec,Wg.prototype.setVisible=Wg.prototype.fc,Wg.prototype.setZIndex=Wg.prototype.gc,Wg.prototype.getKeys=Wg.prototype.P,Wg.prototype.getProperties=Wg.prototype.R,Wg.prototype.setProperties=Wg.prototype.I,Wg.prototype.unset=Wg.prototype.S,Wg.prototype.changed=Wg.prototype.u,Wg.prototype.dispatchEvent=Wg.prototype.s,Wg.prototype.getRevision=Wg.prototype.L,Wg.prototype.on=Wg.prototype.H,Wg.prototype.once=Wg.prototype.M,Wg.prototype.un=Wg.prototype.K,Wg.prototype.unByKey=Wg.prototype.N,La.prototype.setSource=La.prototype.Dc,La.prototype.getExtent=La.prototype.J,La.prototype.getMaxResolution=La.prototype.Ob,La.prototype.getMinResolution=La.prototype.Pb,La.prototype.getOpacity=La.prototype.Sb,La.prototype.getVisible=La.prototype.tb,La.prototype.getZIndex=La.prototype.Tb,La.prototype.setExtent=La.prototype.dc,La.prototype.setMaxResolution=La.prototype.lc,La.prototype.setMinResolution=La.prototype.mc,La.prototype.setOpacity=La.prototype.ec,La.prototype.setVisible=La.prototype.fc,La.prototype.setZIndex=La.prototype.gc,La.prototype.getKeys=La.prototype.P,La.prototype.getProperties=La.prototype.R,La.prototype.setProperties=La.prototype.I,La.prototype.unset=La.prototype.S,La.prototype.changed=La.prototype.u,La.prototype.dispatchEvent=La.prototype.s,La.prototype.getRevision=La.prototype.L,La.prototype.on=La.prototype.H,La.prototype.once=La.prototype.M,La.prototype.un=La.prototype.K,La.prototype.unByKey=La.prototype.N,Ea.prototype.getExtent=Ea.prototype.J,Ea.prototype.getMaxResolution=Ea.prototype.Ob,Ea.prototype.getMinResolution=Ea.prototype.Pb,Ea.prototype.getOpacity=Ea.prototype.Sb,Ea.prototype.getVisible=Ea.prototype.tb,Ea.prototype.getZIndex=Ea.prototype.Tb,Ea.prototype.setExtent=Ea.prototype.dc,Ea.prototype.setMaxResolution=Ea.prototype.lc,Ea.prototype.setMinResolution=Ea.prototype.mc,Ea.prototype.setOpacity=Ea.prototype.ec,Ea.prototype.setVisible=Ea.prototype.fc,Ea.prototype.setZIndex=Ea.prototype.gc,Ea.prototype.getKeys=Ea.prototype.P,Ea.prototype.getProperties=Ea.prototype.R,Ea.prototype.setProperties=Ea.prototype.I,Ea.prototype.unset=Ea.prototype.S,Ea.prototype.changed=Ea.prototype.u,Ea.prototype.dispatchEvent=Ea.prototype.s,Ea.prototype.getRevision=Ea.prototype.L,Ea.prototype.on=Ea.prototype.H,Ea.prototype.once=Ea.prototype.M,Ea.prototype.un=Ea.prototype.K,Ea.prototype.unByKey=Ea.prototype.N,Oa.prototype.setSource=Oa.prototype.Dc,Oa.prototype.getExtent=Oa.prototype.J,Oa.prototype.getMaxResolution=Oa.prototype.Ob,Oa.prototype.getMinResolution=Oa.prototype.Pb,Oa.prototype.getOpacity=Oa.prototype.Sb,Oa.prototype.getVisible=Oa.prototype.tb,Oa.prototype.getZIndex=Oa.prototype.Tb,Oa.prototype.setExtent=Oa.prototype.dc,Oa.prototype.setMaxResolution=Oa.prototype.lc,Oa.prototype.setMinResolution=Oa.prototype.mc,Oa.prototype.setOpacity=Oa.prototype.ec,Oa.prototype.setVisible=Oa.prototype.fc,Oa.prototype.setZIndex=Oa.prototype.gc,Oa.prototype.getKeys=Oa.prototype.P,Oa.prototype.getProperties=Oa.prototype.R,Oa.prototype.setProperties=Oa.prototype.I,Oa.prototype.unset=Oa.prototype.S,Oa.prototype.changed=Oa.prototype.u,Oa.prototype.dispatchEvent=Oa.prototype.s,Oa.prototype.getRevision=Oa.prototype.L,Oa.prototype.on=Oa.prototype.H,Oa.prototype.once=Oa.prototype.M,Oa.prototype.un=Oa.prototype.K,Oa.prototype.unByKey=Oa.prototype.N,Ya.prototype.getStyle=Ya.prototype.C,Ya.prototype.getStyleFunction=Ya.prototype.D,Ya.prototype.setStyle=Ya.prototype.c,Ya.prototype.setSource=Ya.prototype.Dc,Ya.prototype.getExtent=Ya.prototype.J,Ya.prototype.getMaxResolution=Ya.prototype.Ob,Ya.prototype.getMinResolution=Ya.prototype.Pb,Ya.prototype.getOpacity=Ya.prototype.Sb,Ya.prototype.getVisible=Ya.prototype.tb,Ya.prototype.getZIndex=Ya.prototype.Tb,Ya.prototype.setExtent=Ya.prototype.dc,Ya.prototype.setMaxResolution=Ya.prototype.lc,Ya.prototype.setMinResolution=Ya.prototype.mc,Ya.prototype.setOpacity=Ya.prototype.ec,Ya.prototype.setVisible=Ya.prototype.fc,Ya.prototype.setZIndex=Ya.prototype.gc,Ya.prototype.getKeys=Ya.prototype.P,Ya.prototype.getProperties=Ya.prototype.R,Ya.prototype.setProperties=Ya.prototype.I,Ya.prototype.unset=Ya.prototype.S,Ya.prototype.changed=Ya.prototype.u,Ya.prototype.dispatchEvent=Ya.prototype.s,Ya.prototype.getRevision=Ya.prototype.L,Ya.prototype.on=Ya.prototype.H,Ya.prototype.once=Ya.prototype.M,Ya.prototype.un=Ya.prototype.K,Ya.prototype.unByKey=Ya.prototype.N,Is.prototype.getKeys=Is.prototype.P,Is.prototype.getProperties=Is.prototype.R,Is.prototype.setProperties=Is.prototype.I,Is.prototype.unset=Is.prototype.S,Is.prototype.changed=Is.prototype.u,Is.prototype.dispatchEvent=Is.prototype.s,Is.prototype.getRevision=Is.prototype.L,Is.prototype.on=Is.prototype.H,Is.prototype.once=Is.prototype.M,Is.prototype.un=Is.prototype.K,Is.prototype.unByKey=Is.prototype.N,Ds.prototype.getActive=Ds.prototype.b,Ds.prototype.getMap=Ds.prototype.i,Ds.prototype.setActive=Ds.prototype.g,Ds.prototype.getKeys=Ds.prototype.P,Ds.prototype.getProperties=Ds.prototype.R,Ds.prototype.setProperties=Ds.prototype.I,Ds.prototype.unset=Ds.prototype.S,Ds.prototype.changed=Ds.prototype.u,Ds.prototype.dispatchEvent=Ds.prototype.s,Ds.prototype.getRevision=Ds.prototype.L,Ds.prototype.on=Ds.prototype.H,Ds.prototype.once=Ds.prototype.M,Ds.prototype.un=Ds.prototype.K,Ds.prototype.unByKey=Ds.prototype.N,og.prototype.getActive=og.prototype.b,og.prototype.getMap=og.prototype.i,og.prototype.setActive=og.prototype.g,og.prototype.getKeys=og.prototype.P,og.prototype.getProperties=og.prototype.R,og.prototype.setProperties=og.prototype.I,og.prototype.unset=og.prototype.S,og.prototype.changed=og.prototype.u,og.prototype.dispatchEvent=og.prototype.s,og.prototype.getRevision=og.prototype.L,og.prototype.on=og.prototype.H,og.prototype.once=og.prototype.M,og.prototype.un=og.prototype.K,og.prototype.unByKey=og.prototype.N,Gs.prototype.getActive=Gs.prototype.b,Gs.prototype.getMap=Gs.prototype.i,Gs.prototype.setActive=Gs.prototype.g,Gs.prototype.getKeys=Gs.prototype.P,Gs.prototype.getProperties=Gs.prototype.R,Gs.prototype.setProperties=Gs.prototype.I,Gs.prototype.unset=Gs.prototype.S,Gs.prototype.changed=Gs.prototype.u,Gs.prototype.dispatchEvent=Gs.prototype.s,Gs.prototype.getRevision=Gs.prototype.L,Gs.prototype.on=Gs.prototype.H,Gs.prototype.once=Gs.prototype.M,Gs.prototype.un=Gs.prototype.K,Gs.prototype.unByKey=Gs.prototype.N,ra.prototype.getActive=ra.prototype.b,ra.prototype.getMap=ra.prototype.i,ra.prototype.setActive=ra.prototype.g,ra.prototype.getKeys=ra.prototype.P,ra.prototype.getProperties=ra.prototype.R,ra.prototype.setProperties=ra.prototype.I,ra.prototype.unset=ra.prototype.S,ra.prototype.changed=ra.prototype.u,ra.prototype.dispatchEvent=ra.prototype.s,ra.prototype.getRevision=ra.prototype.L,ra.prototype.on=ra.prototype.H,ra.prototype.once=ra.prototype.M,ra.prototype.un=ra.prototype.K,ra.prototype.unByKey=ra.prototype.N,Hs.prototype.getActive=Hs.prototype.b,Hs.prototype.getMap=Hs.prototype.i,Hs.prototype.setActive=Hs.prototype.g,Hs.prototype.getKeys=Hs.prototype.P,Hs.prototype.getProperties=Hs.prototype.R,Hs.prototype.setProperties=Hs.prototype.I,Hs.prototype.unset=Hs.prototype.S,Hs.prototype.changed=Hs.prototype.u,Hs.prototype.dispatchEvent=Hs.prototype.s,Hs.prototype.getRevision=Hs.prototype.L,Hs.prototype.on=Hs.prototype.H,Hs.prototype.once=Hs.prototype.M,Hs.prototype.un=Hs.prototype.K,Hs.prototype.unByKey=Hs.prototype.N,sg.prototype.getActive=sg.prototype.b,sg.prototype.getMap=sg.prototype.i,sg.prototype.setActive=sg.prototype.g,sg.prototype.getKeys=sg.prototype.P,sg.prototype.getProperties=sg.prototype.R,sg.prototype.setProperties=sg.prototype.I,sg.prototype.unset=sg.prototype.S,sg.prototype.changed=sg.prototype.u,sg.prototype.dispatchEvent=sg.prototype.s,sg.prototype.getRevision=sg.prototype.L,sg.prototype.on=sg.prototype.H,sg.prototype.once=sg.prototype.M,sg.prototype.un=sg.prototype.K,sg.prototype.unByKey=sg.prototype.N,Ks.prototype.getActive=Ks.prototype.b,Ks.prototype.getMap=Ks.prototype.i,Ks.prototype.setActive=Ks.prototype.g,Ks.prototype.getKeys=Ks.prototype.P,Ks.prototype.getProperties=Ks.prototype.R,Ks.prototype.setProperties=Ks.prototype.I,Ks.prototype.unset=Ks.prototype.S,Ks.prototype.changed=Ks.prototype.u,Ks.prototype.dispatchEvent=Ks.prototype.s,Ks.prototype.getRevision=Ks.prototype.L,Ks.prototype.on=Ks.prototype.H,Ks.prototype.once=Ks.prototype.M,Ks.prototype.un=Ks.prototype.K,Ks.prototype.unByKey=Ks.prototype.N,ha.prototype.getGeometry=ha.prototype.W,ha.prototype.getActive=ha.prototype.b,ha.prototype.getMap=ha.prototype.i,ha.prototype.setActive=ha.prototype.g,ha.prototype.getKeys=ha.prototype.P,ha.prototype.getProperties=ha.prototype.R,ha.prototype.setProperties=ha.prototype.I,ha.prototype.unset=ha.prototype.S,ha.prototype.changed=ha.prototype.u,ha.prototype.dispatchEvent=ha.prototype.s,ha.prototype.getRevision=ha.prototype.L,ha.prototype.on=ha.prototype.H,ha.prototype.once=ha.prototype.M,ha.prototype.un=ha.prototype.K,ha.prototype.unByKey=ha.prototype.N,cg.prototype.getActive=cg.prototype.b,cg.prototype.getMap=cg.prototype.i,cg.prototype.setActive=cg.prototype.g,cg.prototype.getKeys=cg.prototype.P,cg.prototype.getProperties=cg.prototype.R,cg.prototype.setProperties=cg.prototype.I,cg.prototype.unset=cg.prototype.S,cg.prototype.changed=cg.prototype.u,cg.prototype.dispatchEvent=cg.prototype.s,cg.prototype.getRevision=cg.prototype.L,cg.prototype.on=cg.prototype.H,cg.prototype.once=cg.prototype.M,cg.prototype.un=cg.prototype.K,cg.prototype.unByKey=cg.prototype.N,pa.prototype.getActive=pa.prototype.b,pa.prototype.getMap=pa.prototype.i,pa.prototype.setActive=pa.prototype.g,pa.prototype.getKeys=pa.prototype.P,pa.prototype.getProperties=pa.prototype.R,pa.prototype.setProperties=pa.prototype.I,pa.prototype.unset=pa.prototype.S,pa.prototype.changed=pa.prototype.u,pa.prototype.dispatchEvent=pa.prototype.s,pa.prototype.getRevision=pa.prototype.L,pa.prototype.on=pa.prototype.H,pa.prototype.once=pa.prototype.M,pa.prototype.un=pa.prototype.K,pa.prototype.unByKey=pa.prototype.N,ua.prototype.getActive=ua.prototype.b,ua.prototype.getMap=ua.prototype.i,ua.prototype.setActive=ua.prototype.g,ua.prototype.getKeys=ua.prototype.P,ua.prototype.getProperties=ua.prototype.R,ua.prototype.setProperties=ua.prototype.I,ua.prototype.unset=ua.prototype.S,ua.prototype.changed=ua.prototype.u,ua.prototype.dispatchEvent=ua.prototype.s,ua.prototype.getRevision=ua.prototype.L,ua.prototype.on=ua.prototype.H,ua.prototype.once=ua.prototype.M,ua.prototype.un=ua.prototype.K,ua.prototype.unByKey=ua.prototype.N,wg.prototype.getActive=wg.prototype.b,wg.prototype.getMap=wg.prototype.i,wg.prototype.setActive=wg.prototype.g,wg.prototype.getKeys=wg.prototype.P,wg.prototype.getProperties=wg.prototype.R,wg.prototype.setProperties=wg.prototype.I,wg.prototype.unset=wg.prototype.S,wg.prototype.changed=wg.prototype.u,wg.prototype.dispatchEvent=wg.prototype.s,wg.prototype.getRevision=wg.prototype.L,wg.prototype.on=wg.prototype.H,wg.prototype.once=wg.prototype.M,wg.prototype.un=wg.prototype.K,wg.prototype.unByKey=wg.prototype.N,fa.prototype.getActive=fa.prototype.b,fa.prototype.getMap=fa.prototype.i,fa.prototype.setActive=fa.prototype.g,fa.prototype.getKeys=fa.prototype.P,fa.prototype.getProperties=fa.prototype.R,fa.prototype.setProperties=fa.prototype.I,fa.prototype.unset=fa.prototype.S,fa.prototype.changed=fa.prototype.u,fa.prototype.dispatchEvent=fa.prototype.s,fa.prototype.getRevision=fa.prototype.L,fa.prototype.on=fa.prototype.H,fa.prototype.once=fa.prototype.M,fa.prototype.un=fa.prototype.K,fa.prototype.unByKey=fa.prototype.N,ya.prototype.getActive=ya.prototype.b,ya.prototype.getMap=ya.prototype.i,ya.prototype.setActive=ya.prototype.g,ya.prototype.getKeys=ya.prototype.P,ya.prototype.getProperties=ya.prototype.R,ya.prototype.setProperties=ya.prototype.I,ya.prototype.unset=ya.prototype.S,ya.prototype.changed=ya.prototype.u,ya.prototype.dispatchEvent=ya.prototype.s,ya.prototype.getRevision=ya.prototype.L,ya.prototype.on=ya.prototype.H,ya.prototype.once=ya.prototype.M,ya.prototype.un=ya.prototype.K,ya.prototype.unByKey=ya.prototype.N,ba.prototype.getActive=ba.prototype.b,ba.prototype.getMap=ba.prototype.i,ba.prototype.setActive=ba.prototype.g,ba.prototype.getKeys=ba.prototype.P,ba.prototype.getProperties=ba.prototype.R,ba.prototype.setProperties=ba.prototype.I,ba.prototype.unset=ba.prototype.S,ba.prototype.changed=ba.prototype.u,ba.prototype.dispatchEvent=ba.prototype.s,ba.prototype.getRevision=ba.prototype.L,ba.prototype.on=ba.prototype.H,ba.prototype.once=ba.prototype.M,ba.prototype.un=ba.prototype.K,ba.prototype.unByKey=ba.prototype.N,Dg.prototype.getActive=Dg.prototype.b,Dg.prototype.getMap=Dg.prototype.i,Dg.prototype.setActive=Dg.prototype.g,Dg.prototype.getKeys=Dg.prototype.P,Dg.prototype.getProperties=Dg.prototype.R,Dg.prototype.setProperties=Dg.prototype.I,Dg.prototype.unset=Dg.prototype.S,Dg.prototype.changed=Dg.prototype.u,Dg.prototype.dispatchEvent=Dg.prototype.s,Dg.prototype.getRevision=Dg.prototype.L,Dg.prototype.on=Dg.prototype.H,Dg.prototype.once=Dg.prototype.M,Dg.prototype.un=Dg.prototype.K,Dg.prototype.unByKey=Dg.prototype.N,zg.prototype.getActive=zg.prototype.b,zg.prototype.getMap=zg.prototype.i,zg.prototype.setActive=zg.prototype.g,zg.prototype.getKeys=zg.prototype.P,zg.prototype.getProperties=zg.prototype.R,zg.prototype.setProperties=zg.prototype.I,zg.prototype.unset=zg.prototype.S,zg.prototype.changed=zg.prototype.u,zg.prototype.dispatchEvent=zg.prototype.s,zg.prototype.getRevision=zg.prototype.L,zg.prototype.on=zg.prototype.H,zg.prototype.once=zg.prototype.M,zg.prototype.un=zg.prototype.K,zg.prototype.unByKey=zg.prototype.N,Bg.prototype.getActive=Bg.prototype.b,Bg.prototype.getMap=Bg.prototype.i,Bg.prototype.setActive=Bg.prototype.g,Bg.prototype.getKeys=Bg.prototype.P,Bg.prototype.getProperties=Bg.prototype.R,Bg.prototype.setProperties=Bg.prototype.I,Bg.prototype.unset=Bg.prototype.S,Bg.prototype.changed=Bg.prototype.u,Bg.prototype.dispatchEvent=Bg.prototype.s,Bg.prototype.getRevision=Bg.prototype.L,Bg.prototype.on=Bg.prototype.H,Bg.prototype.once=Bg.prototype.M,Bg.prototype.un=Bg.prototype.K,Bg.prototype.unByKey=Bg.prototype.N,gi.prototype.getKeys=gi.prototype.P,gi.prototype.getProperties=gi.prototype.R,gi.prototype.setProperties=gi.prototype.I,gi.prototype.unset=gi.prototype.S,gi.prototype.changed=gi.prototype.u,gi.prototype.dispatchEvent=gi.prototype.s,gi.prototype.getRevision=gi.prototype.L,gi.prototype.on=gi.prototype.H,gi.prototype.once=gi.prototype.M,gi.prototype.un=gi.prototype.K,gi.prototype.unByKey=gi.prototype.N,mi.prototype.getClosestPoint=mi.prototype.sb,mi.prototype.getExtent=mi.prototype.J,mi.prototype.simplify=mi.prototype.zb,mi.prototype.transform=mi.prototype.nb,mi.prototype.getKeys=mi.prototype.P,mi.prototype.getProperties=mi.prototype.R,mi.prototype.setProperties=mi.prototype.I,mi.prototype.unset=mi.prototype.S,mi.prototype.changed=mi.prototype.u,mi.prototype.dispatchEvent=mi.prototype.s,mi.prototype.getRevision=mi.prototype.L,mi.prototype.on=mi.prototype.H,mi.prototype.once=mi.prototype.M,mi.prototype.un=mi.prototype.K,mi.prototype.unByKey=mi.prototype.N,kf.prototype.getFirstCoordinate=kf.prototype.Lb,kf.prototype.getLastCoordinate=kf.prototype.Mb,kf.prototype.getLayout=kf.prototype.Nb,kf.prototype.getClosestPoint=kf.prototype.sb,kf.prototype.getExtent=kf.prototype.J,kf.prototype.simplify=kf.prototype.zb,kf.prototype.getKeys=kf.prototype.P,kf.prototype.getProperties=kf.prototype.R,kf.prototype.setProperties=kf.prototype.I,kf.prototype.unset=kf.prototype.S,kf.prototype.changed=kf.prototype.u,kf.prototype.dispatchEvent=kf.prototype.s,kf.prototype.getRevision=kf.prototype.L,kf.prototype.on=kf.prototype.H,kf.prototype.once=kf.prototype.M,kf.prototype.un=kf.prototype.K,kf.prototype.unByKey=kf.prototype.N,cu.prototype.getClosestPoint=cu.prototype.sb,cu.prototype.getExtent=cu.prototype.J,cu.prototype.simplify=cu.prototype.zb,cu.prototype.transform=cu.prototype.nb,cu.prototype.getKeys=cu.prototype.P,cu.prototype.getProperties=cu.prototype.R,cu.prototype.setProperties=cu.prototype.I,cu.prototype.unset=cu.prototype.S,cu.prototype.changed=cu.prototype.u,cu.prototype.dispatchEvent=cu.prototype.s,cu.prototype.getRevision=cu.prototype.L,cu.prototype.on=cu.prototype.H,cu.prototype.once=cu.prototype.M,cu.prototype.un=cu.prototype.K,cu.prototype.unByKey=cu.prototype.N,ki.prototype.getFirstCoordinate=ki.prototype.Lb,ki.prototype.getLastCoordinate=ki.prototype.Mb,ki.prototype.getLayout=ki.prototype.Nb,ki.prototype.getClosestPoint=ki.prototype.sb,ki.prototype.getExtent=ki.prototype.J,ki.prototype.simplify=ki.prototype.zb,ki.prototype.transform=ki.prototype.nb,ki.prototype.getKeys=ki.prototype.P,ki.prototype.getProperties=ki.prototype.R,ki.prototype.setProperties=ki.prototype.I,ki.prototype.unset=ki.prototype.S,ki.prototype.changed=ki.prototype.u,ki.prototype.dispatchEvent=ki.prototype.s,ki.prototype.getRevision=ki.prototype.L,ki.prototype.on=ki.prototype.H,ki.prototype.once=ki.prototype.M,ki.prototype.un=ki.prototype.K,ki.prototype.unByKey=ki.prototype.N,Xc.prototype.getFirstCoordinate=Xc.prototype.Lb,Xc.prototype.getLastCoordinate=Xc.prototype.Mb,Xc.prototype.getLayout=Xc.prototype.Nb,Xc.prototype.getClosestPoint=Xc.prototype.sb,Xc.prototype.getExtent=Xc.prototype.J,Xc.prototype.simplify=Xc.prototype.zb,Xc.prototype.transform=Xc.prototype.nb,Xc.prototype.getKeys=Xc.prototype.P,Xc.prototype.getProperties=Xc.prototype.R,Xc.prototype.setProperties=Xc.prototype.I,Xc.prototype.unset=Xc.prototype.S,Xc.prototype.changed=Xc.prototype.u,Xc.prototype.dispatchEvent=Xc.prototype.s,Xc.prototype.getRevision=Xc.prototype.L,Xc.prototype.on=Xc.prototype.H,Xc.prototype.once=Xc.prototype.M,Xc.prototype.un=Xc.prototype.K,Xc.prototype.unByKey=Xc.prototype.N,$c.prototype.getFirstCoordinate=$c.prototype.Lb,$c.prototype.getLastCoordinate=$c.prototype.Mb,$c.prototype.getLayout=$c.prototype.Nb,$c.prototype.getClosestPoint=$c.prototype.sb,$c.prototype.getExtent=$c.prototype.J,$c.prototype.simplify=$c.prototype.zb,$c.prototype.transform=$c.prototype.nb,$c.prototype.getKeys=$c.prototype.P,$c.prototype.getProperties=$c.prototype.R,$c.prototype.setProperties=$c.prototype.I,$c.prototype.unset=$c.prototype.S,$c.prototype.changed=$c.prototype.u,$c.prototype.dispatchEvent=$c.prototype.s,$c.prototype.getRevision=$c.prototype.L,$c.prototype.on=$c.prototype.H,$c.prototype.once=$c.prototype.M,$c.prototype.un=$c.prototype.K,$c.prototype.unByKey=$c.prototype.N,tu.prototype.getFirstCoordinate=tu.prototype.Lb,tu.prototype.getLastCoordinate=tu.prototype.Mb,tu.prototype.getLayout=tu.prototype.Nb,tu.prototype.getClosestPoint=tu.prototype.sb,tu.prototype.getExtent=tu.prototype.J,tu.prototype.simplify=tu.prototype.zb,tu.prototype.transform=tu.prototype.nb,tu.prototype.getKeys=tu.prototype.P,tu.prototype.getProperties=tu.prototype.R,tu.prototype.setProperties=tu.prototype.I,tu.prototype.unset=tu.prototype.S,tu.prototype.changed=tu.prototype.u,tu.prototype.dispatchEvent=tu.prototype.s,tu.prototype.getRevision=tu.prototype.L,tu.prototype.on=tu.prototype.H,tu.prototype.once=tu.prototype.M,tu.prototype.un=tu.prototype.K,tu.prototype.unByKey=tu.prototype.N,eu.prototype.getFirstCoordinate=eu.prototype.Lb,eu.prototype.getLastCoordinate=eu.prototype.Mb,eu.prototype.getLayout=eu.prototype.Nb,eu.prototype.getClosestPoint=eu.prototype.sb,eu.prototype.getExtent=eu.prototype.J,eu.prototype.simplify=eu.prototype.zb,eu.prototype.transform=eu.prototype.nb,eu.prototype.getKeys=eu.prototype.P,eu.prototype.getProperties=eu.prototype.R,eu.prototype.setProperties=eu.prototype.I,eu.prototype.unset=eu.prototype.S,eu.prototype.changed=eu.prototype.u,eu.prototype.dispatchEvent=eu.prototype.s,eu.prototype.getRevision=eu.prototype.L,eu.prototype.on=eu.prototype.H,eu.prototype.once=eu.prototype.M,eu.prototype.un=eu.prototype.K,eu.prototype.unByKey=eu.prototype.N,Fi.prototype.getFirstCoordinate=Fi.prototype.Lb,Fi.prototype.getLastCoordinate=Fi.prototype.Mb,Fi.prototype.getLayout=Fi.prototype.Nb,Fi.prototype.getClosestPoint=Fi.prototype.sb,Fi.prototype.getExtent=Fi.prototype.J,Fi.prototype.simplify=Fi.prototype.zb,Fi.prototype.transform=Fi.prototype.nb,Fi.prototype.getKeys=Fi.prototype.P,Fi.prototype.getProperties=Fi.prototype.R,Fi.prototype.setProperties=Fi.prototype.I,Fi.prototype.unset=Fi.prototype.S,Fi.prototype.changed=Fi.prototype.u,Fi.prototype.dispatchEvent=Fi.prototype.s,Fi.prototype.getRevision=Fi.prototype.L,Fi.prototype.on=Fi.prototype.H,Fi.prototype.once=Fi.prototype.M,Fi.prototype.un=Fi.prototype.K,Fi.prototype.unByKey=Fi.prototype.N,Yi.prototype.getFirstCoordinate=Yi.prototype.Lb,Yi.prototype.getLastCoordinate=Yi.prototype.Mb,Yi.prototype.getLayout=Yi.prototype.Nb,Yi.prototype.getClosestPoint=Yi.prototype.sb,Yi.prototype.getExtent=Yi.prototype.J,Yi.prototype.simplify=Yi.prototype.zb,Yi.prototype.transform=Yi.prototype.nb,Yi.prototype.getKeys=Yi.prototype.P,Yi.prototype.getProperties=Yi.prototype.R,Yi.prototype.setProperties=Yi.prototype.I,Yi.prototype.unset=Yi.prototype.S,Yi.prototype.changed=Yi.prototype.u,Yi.prototype.dispatchEvent=Yi.prototype.s,Yi.prototype.getRevision=Yi.prototype.L,Yi.prototype.on=Yi.prototype.H,Yi.prototype.once=Yi.prototype.M,Yi.prototype.un=Yi.prototype.K,Yi.prototype.unByKey=Yi.prototype.N,Du.prototype.readFeatures=Du.prototype.Ca,ku.prototype.readFeatures=ku.prototype.Ca,ku.prototype.readFeatures=ku.prototype.Ca,cr.prototype.getKeys=cr.prototype.P,cr.prototype.getProperties=cr.prototype.R,cr.prototype.setProperties=cr.prototype.I,cr.prototype.unset=cr.prototype.S,cr.prototype.changed=cr.prototype.u,cr.prototype.dispatchEvent=cr.prototype.s,cr.prototype.getRevision=cr.prototype.L,cr.prototype.on=cr.prototype.H,cr.prototype.once=cr.prototype.M,cr.prototype.un=cr.prototype.K,cr.prototype.unByKey=cr.prototype.N,Nr.prototype.getMap=Nr.prototype.g,Nr.prototype.setTarget=Nr.prototype.c,Nr.prototype.getKeys=Nr.prototype.P,Nr.prototype.getProperties=Nr.prototype.R,Nr.prototype.setProperties=Nr.prototype.I,Nr.prototype.unset=Nr.prototype.S,Nr.prototype.changed=Nr.prototype.u,Nr.prototype.dispatchEvent=Nr.prototype.s,Nr.prototype.getRevision=Nr.prototype.L,Nr.prototype.on=Nr.prototype.H,Nr.prototype.once=Nr.prototype.M,Nr.prototype.un=Nr.prototype.K,Nr.prototype.unByKey=Nr.prototype.N,Yr.prototype.getMap=Yr.prototype.g,Yr.prototype.setTarget=Yr.prototype.c,Yr.prototype.getKeys=Yr.prototype.P,Yr.prototype.getProperties=Yr.prototype.R,Yr.prototype.setProperties=Yr.prototype.I,Yr.prototype.unset=Yr.prototype.S,Yr.prototype.changed=Yr.prototype.u,Yr.prototype.dispatchEvent=Yr.prototype.s,Yr.prototype.getRevision=Yr.prototype.L,Yr.prototype.on=Yr.prototype.H,Yr.prototype.once=Yr.prototype.M,Yr.prototype.un=Yr.prototype.K,Yr.prototype.unByKey=Yr.prototype.N,Xr.prototype.getMap=Xr.prototype.g,Xr.prototype.setTarget=Xr.prototype.c,Xr.prototype.getKeys=Xr.prototype.P,Xr.prototype.getProperties=Xr.prototype.R,Xr.prototype.setProperties=Xr.prototype.I,Xr.prototype.unset=Xr.prototype.S,Xr.prototype.changed=Xr.prototype.u,Xr.prototype.dispatchEvent=Xr.prototype.s,Xr.prototype.getRevision=Xr.prototype.L,Xr.prototype.on=Xr.prototype.H,Xr.prototype.once=Xr.prototype.M,Xr.prototype.un=Xr.prototype.K,Xr.prototype.unByKey=Xr.prototype.N,vc.prototype.getMap=vc.prototype.g,vc.prototype.setTarget=vc.prototype.c,vc.prototype.getKeys=vc.prototype.P,vc.prototype.getProperties=vc.prototype.R,vc.prototype.setProperties=vc.prototype.I,vc.prototype.unset=vc.prototype.S,vc.prototype.changed=vc.prototype.u,vc.prototype.dispatchEvent=vc.prototype.s,vc.prototype.getRevision=vc.prototype.L,vc.prototype.on=vc.prototype.H,vc.prototype.once=vc.prototype.M,vc.prototype.un=vc.prototype.K,vc.prototype.unByKey=vc.prototype.N,jr.prototype.getMap=jr.prototype.g,jr.prototype.setTarget=jr.prototype.c,jr.prototype.getKeys=jr.prototype.P,jr.prototype.getProperties=jr.prototype.R,jr.prototype.setProperties=jr.prototype.I,jr.prototype.unset=jr.prototype.S,jr.prototype.changed=jr.prototype.u,jr.prototype.dispatchEvent=jr.prototype.s,jr.prototype.getRevision=jr.prototype.L,jr.prototype.on=jr.prototype.H,jr.prototype.once=jr.prototype.M,jr.prototype.un=jr.prototype.K,jr.prototype.unByKey=jr.prototype.N,Pc.prototype.getMap=Pc.prototype.g,Pc.prototype.setTarget=Pc.prototype.c,Pc.prototype.getKeys=Pc.prototype.P,Pc.prototype.getProperties=Pc.prototype.R,Pc.prototype.setProperties=Pc.prototype.I,Pc.prototype.unset=Pc.prototype.S,Pc.prototype.changed=Pc.prototype.u,Pc.prototype.dispatchEvent=Pc.prototype.s,Pc.prototype.getRevision=Pc.prototype.L,Pc.prototype.on=Pc.prototype.H,Pc.prototype.once=Pc.prototype.M,Pc.prototype.un=Pc.prototype.K,Pc.prototype.unByKey=Pc.prototype.N,Gr.prototype.getMap=Gr.prototype.g,Gr.prototype.setTarget=Gr.prototype.c,Gr.prototype.getKeys=Gr.prototype.P,Gr.prototype.getProperties=Gr.prototype.R,Gr.prototype.setProperties=Gr.prototype.I,Gr.prototype.unset=Gr.prototype.S,Gr.prototype.changed=Gr.prototype.u,Gr.prototype.dispatchEvent=Gr.prototype.s,Gr.prototype.getRevision=Gr.prototype.L,Gr.prototype.on=Gr.prototype.H,Gr.prototype.once=Gr.prototype.M,Gr.prototype.un=Gr.prototype.K,Gr.prototype.unByKey=Gr.prototype.N,kc.prototype.getMap=kc.prototype.g,kc.prototype.setTarget=kc.prototype.c,kc.prototype.getKeys=kc.prototype.P,kc.prototype.getProperties=kc.prototype.R,kc.prototype.setProperties=kc.prototype.I,kc.prototype.unset=kc.prototype.S,kc.prototype.changed=kc.prototype.u,kc.prototype.dispatchEvent=kc.prototype.s,kc.prototype.getRevision=kc.prototype.L,kc.prototype.on=kc.prototype.H,kc.prototype.once=kc.prototype.M,kc.prototype.un=kc.prototype.K,kc.prototype.unByKey=kc.prototype.N,Uc.prototype.getMap=Uc.prototype.g,Uc.prototype.setTarget=Uc.prototype.c,Uc.prototype.getKeys=Uc.prototype.P,Uc.prototype.getProperties=Uc.prototype.R,Uc.prototype.setProperties=Uc.prototype.I,Uc.prototype.unset=Uc.prototype.S,Uc.prototype.changed=Uc.prototype.u,Uc.prototype.dispatchEvent=Uc.prototype.s,Uc.prototype.getRevision=Uc.prototype.L,Uc.prototype.on=Uc.prototype.H,Uc.prototype.once=Uc.prototype.M,Uc.prototype.un=Uc.prototype.K,Uc.prototype.unByKey=Uc.prototype.N,qy.ol});var P={version:"1.0.0"};"object"==typeof module&&"object"==typeof module.exports?module.exports=P:"function"==typeof define&&define.amd&&define(P),"undefined"!=typeof window&&expose(),P.Constants={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4},P.Utils={_stampId:0},P.Utils.trim=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},P.Utils.stamp=function(t){var e="_p_id_";return t[e]=t[e]||this._stampId++,t[e]},P.Utils.uuid=function(){for(var t=[],e="0123456789abcdef",i=0;i<36;i++)t[i]=e.substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")},P.Utils.getFeatureType=function(t){switch(t){case P.PlotTypes.ARC:return"LineString";case P.PlotTypes.ELLIPSE:return"Polygon";case P.PlotTypes.CURVE:return"LineString";case P.PlotTypes.CLOSED_CURVE:case P.PlotTypes.LUNE:case P.PlotTypes.SECTOR:case P.PlotTypes.GATHERING_PLACE:return"Polygon";case P.PlotTypes.STRAIGHT_ARROW:return"LineString";case P.PlotTypes.ASSAULT_DIRECTION:case P.PlotTypes.ATTACK_ARROW:case P.PlotTypes.FINE_ARROW:case P.PlotTypes.CIRCLE:case P.PlotTypes.DOUBLE_ARROW:case P.PlotTypes.TAILED_ATTACK_ARROW:case P.PlotTypes.SQUAD_COMBAT:case P.PlotTypes.TAILED_SQUAD_COMBAT:return"Polygon";case P.PlotTypes.FREEHAND_LINE:return"LineString";case P.PlotTypes.FREEHAND_POLYGON:case P.PlotTypes.POLYGON:return"Polygon";case P.PlotTypes.MARKER:return"Point";case P.PlotTypes.RECTANGLE:return"Polygon";case P.PlotTypes.POLYLINE:return"LineString"}},P.Utils.handleArray=function(t,e){var i=[];if("Point"===e)i=t;else if("Polygon"===e){for(var o=[],r=0;r<t.length;r++)0<r%2&&o.push([t[r-1],t[r]]);o.push(o[0]),i.push(o)}else for(r=0;r<t.length;r++)0<r%2&&i.push([t[r-1],t[r]]);return i},P.DomUtils={},P.DomUtils.create=function(t,e,i,o){t=document.createElement(t);return t.className=e||"",o&&(t.id=o),i&&i.appendChild(t),t},P.DomUtils.createHidden=function(t,e,i){t=document.createElement(t);return t.style.display="none",i&&(t.id=i),e&&e.appendChild(t),t},P.DomUtils.remove=function(t,e){e&&t&&e.removeChild(t)},P.DomUtils.get=function(t){return document.getElementById(t)},P.DomUtils.getStyle=function(t,e){e=t.style[e];return"auto"===e?null:e},P.DomUtils.hasClass=function(t,e){return 0<t.className.length&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(t.className)},P.DomUtils.addClass=function(t,e){this.hasClass(t,e)||(t.className&&(t.className+=" "),t.className+=e)},P.DomUtils.removeClass=function(t,e){t.className=P.Utils.trim((" "+t.className+" ").replace(" "+e+" "," "))},P.DomUtils.getDomEventKey=function(t,e,i){return"_p_dom_event_"+t+"_"+P.Utils.stamp(e)+(i?"_"+P.Utils.stamp(i):"")},P.DomUtils.addListener=function(e,t,i,o){var r,n=P.DomUtils.getDomEventKey(t,i,o);return(r=e[n])||(r=function(t){return i.call(o||e,t)},"addEventListener"in e?e.addEventListener(t,r,!1):"attachEvent"in e&&e.attachEvent("on"+t,r),e[n]=r),this},P.DomUtils.removeListener=function(t,e,i,o){i=P.DomUtils.getDomEventKey(e,i,o),o=t[i];return o&&("removeEventListener"in t?t.removeEventListener(e,o,!1):"detachEvent"in t&&t.detachEvent("on"+e,o),t[i]=null),this},P.PlotTypes={ARC:"arc",ELLIPSE:"ellipse",CURVE:"curve",CLOSED_CURVE:"closedcurve",LUNE:"lune",SECTOR:"sector",GATHERING_PLACE:"gatheringplace",STRAIGHT_ARROW:"straightarrow",ASSAULT_DIRECTION:"assaultdirection",ATTACK_ARROW:"attackarrow",TAILED_ATTACK_ARROW:"tailedattackarrow",SQUAD_COMBAT:"squadcombat",TAILED_SQUAD_COMBAT:"tailedsquadcombat",FINE_ARROW:"finearrow",CIRCLE:"circle",DOUBLE_ARROW:"doublearrow",POLYLINE:"polyline",FREEHAND_LINE:"freehandline",POLYGON:"polygon",FREEHAND_POLYGON:"freehandpolygon",RECTANGLE:"rectangle",MARKER:"marker",TRIANGLE:"triangle"},P.PlotUtils={},P.PlotUtils.wgsToMercator=function(t){var e=t[0],t=t[1];return[20037508.34*e/180,20037508.34*(Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180))/180]},P.PlotUtils.mercatorToWGS=function(t){var e=t[0],t=t[1]/20037508.34*180;return[e/20037508.34*180,t=180/Math.PI*(2*Math.atan(Math.exp(t*Math.PI/180))-Math.PI/2)]},P.PlotUtils.distance=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))},P.PlotUtils.wholeDistance=function(t){for(var e=0,i=0;i<t.length-1;i++)e+=P.PlotUtils.distance(t[i],t[i+1]);return e},P.PlotUtils.getBaseLength=function(t){return Math.pow(P.PlotUtils.wholeDistance(t),.99)},P.PlotUtils.mid=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]},P.PlotUtils.getCircleCenterOfThreePoints=function(t,e,i){var o=[(t[0]+e[0])/2,(t[1]+e[1])/2],r=[o[0]-t[1]+e[1],o[1]+t[0]-e[0]],e=[(t[0]+i[0])/2,(t[1]+i[1])/2],i=[e[0]-t[1]+i[1],e[1]+t[0]-i[0]];return P.PlotUtils.getIntersectPoint(o,r,e,i)},P.PlotUtils.getIntersectPoint=function(t,e,i,o){if(t[1]==e[1]){var r=(o[0]-i[0])/(o[1]-i[1]),n=r*(t[1]-i[1])+i[0],s=t[1];return[n,s]}if(i[1]!=o[1])return a=(e[0]-t[0])/(e[1]-t[1]),r=(o[0]-i[0])/(o[1]-i[1]),[n=a*(s=(a*t[1]-t[0]-r*i[1]+i[0])/(a-r))-a*t[1]+t[0],s];var a=(e[0]-t[0])/(e[1]-t[1]);return[n=a*(i[1]-t[1])+t[0],s=i[1]]},P.PlotUtils.getAzimuth=function(t,e){var i,o=Math.asin(Math.abs(e[1]-t[1])/P.PlotUtils.distance(t,e));return e[1]>=t[1]&&e[0]>=t[0]?i=o+Math.PI:e[1]>=t[1]&&e[0]<t[0]?i=P.Constants.TWO_PI-o:e[1]<t[1]&&e[0]<t[0]?i=o:e[1]<t[1]&&e[0]>=t[0]&&(i=Math.PI-o),i},P.PlotUtils.getAngleOfThreePoints=function(t,e,i){i=P.PlotUtils.getAzimuth(e,t)-P.PlotUtils.getAzimuth(e,i);return i<0?i+P.Constants.TWO_PI:i},P.PlotUtils.isClockWise=function(t,e,i){return(i[1]-t[1])*(e[0]-t[0])>(e[1]-t[1])*(i[0]-t[0])},P.PlotUtils.getPointOnLine=function(t,e,i){return[e[0]+t*(i[0]-e[0]),e[1]+t*(i[1]-e[1])]},P.PlotUtils.getCubicValue=function(t,e,i,o,r){var n=1-(t=Math.max(Math.min(t,1),0)),s=t*t,a=s*t,l=n*n,h=l*n;return[h*e[0]+3*l*t*i[0]+3*n*s*o[0]+a*r[0],h*e[1]+3*l*t*i[1]+3*n*s*o[1]+a*r[1]]},P.PlotUtils.getThirdPoint=function(t,e,i,o,r){t=P.PlotUtils.getAzimuth(t,e),t=r?t+i:t-i,i=o*Math.cos(t),t=o*Math.sin(t);return[e[0]+i,e[1]+t]},P.PlotUtils.getArcPoints=function(t,e,i,o){for(var r=[],n=(n=o-i)<0?n+P.Constants.TWO_PI:n,s=0;s<=P.Constants.FITTING_COUNT;s++){var a=i+n*s/P.Constants.FITTING_COUNT,l=t[0]+e*Math.cos(a),a=t[1]+e*Math.sin(a);r.push([P.PlotUtils.mercatorToWGS([l,a])[0],P.PlotUtils.mercatorToWGS([l,a])[1]])}return r},P.PlotUtils.getBisectorNormals=function(t,e,i,o){var r,n,s=P.PlotUtils.getNormal(e,i,o),a=Math.sqrt(s[0]*s[0]+s[1]*s[1]),l=s[0]/a,h=s[1]/a,p=P.PlotUtils.distance(e,i),s=P.PlotUtils.distance(i,o),i=a>P.Constants.ZERO_TOLERANCE?P.PlotUtils.isClockWise(e,i,o)?(r=[i[0]-(n=t*p)*h,i[1]+n*l],[i[0]+(n=t*s)*h,i[1]-n*l]):(r=[i[0]+(n=t*p)*h,i[1]-n*l],[i[0]-(n=t*s)*h,i[1]+n*l]):(r=[i[0]+t*(e[0]-i[0]),i[1]+t*(e[1]-i[1])],[i[0]+t*(o[0]-i[0]),i[1]+t*(o[1]-i[1])]);return[r,i]},P.PlotUtils.getNormal=function(t,e,i){var o=t[0]-e[0],r=t[1]-e[1],t=Math.sqrt(o*o+r*r);o/=t,r/=t;t=i[0]-e[0],i=i[1]-e[1],e=Math.sqrt(t*t+i*i);return[o+(t/=e),r+(i/=e)]},P.PlotUtils.getCurvePoints=function(t,e){for(var i=[P.PlotUtils.getLeftMostControlPoint(e)],o=0;o<e.length-2;o++)var r=e[o],n=e[o+1],s=e[o+2],s=P.PlotUtils.getBisectorNormals(t,r,n,s),i=i.concat(s);var a=P.PlotUtils.getRightMostControlPoint(e);i.push(a);for(var l=[],o=0;o<e.length-1;o++){r=e[o],n=e[o+1],l.push(r);for(t=0;t<P.Constants.FITTING_COUNT;t++){var h=P.PlotUtils.getCubicValue(t/P.Constants.FITTING_COUNT,r,i[2*o],i[2*o+1],n);l.push(h)}l.push(n)}return l},P.PlotUtils.getLeftMostControlPoint=function(e){var i,o,r,n=e[0],s=e[1],a=e[2],l=P.PlotUtils.getBisectorNormals(0,n,s,a)[0],h=P.PlotUtils.getNormal(n,s,a),n=Math.sqrt(h[0]*h[0]+h[1]*h[1])>P.Constants.ZERO_TOLERANCE?(i=P.PlotUtils.mid(n,s),r=n[0]-i[0],o=n[1]-i[1],e=P.PlotUtils.distance(n,s),a=l[0]-i[0],h=l[1]-i[1],r=i[0]+((e=-(l=2/e)*o)*e-(o=l*r)*o)*a+(l=2*e*o)*h,i[1]+l*a+(o*o-e*e)*h):(r=n[0]+t*(s[0]-n[0]),n[1]+t*(s[1]-n[1]));return[r,n]},P.PlotUtils.getRightMostControlPoint=function(e){var i,o,r=e.length,n=e[r-3],s=e[r-2],a=e[r-1],l=P.PlotUtils.getBisectorNormals(0,n,s,a)[1],h=P.PlotUtils.getNormal(n,s,a),a=Math.sqrt(h[0]*h[0]+h[1]*h[1])>P.Constants.ZERO_TOLERANCE?(i=P.PlotUtils.mid(s,a),o=a[0]-i[0],e=a[1]-i[1],r=P.PlotUtils.distance(s,a),n=l[0]-i[0],h=l[1]-i[1],o=i[0]+((r=-(l=2/r)*e)*r-(e=l*o)*e)*n+(l=2*r*e)*h,i[1]+l*n+(e*e-r*r)*h):(o=a[0]+t*(s[0]-a[0]),a[1]+t*(s[1]-a[1]));return[o,a]},P.PlotUtils.getBezierPoints=function(t){if(t.length<=2)return t;for(var e=[],i=t.length-1,o=0;o<=1;o+=.01){for(var r=y=0,n=0;n<=i;n++){var s=P.PlotUtils.getBinomialFactor(i,n),a=Math.pow(o,n),l=Math.pow(1-o,i-n);r+=s*a*l*t[n][0],y+=s*a*l*t[n][1]}e.push([r,y])}return e.push(t[i]),e},P.PlotUtils.getBinomialFactor=function(t,e){return P.PlotUtils.getFactorial(t)/(P.PlotUtils.getFactorial(e)*P.PlotUtils.getFactorial(t-e))},P.PlotUtils.getFactorial=function(t){if(t<=1)return 1;if(2==t)return 2;if(3==t)return 6;if(4==t)return 24;if(5==t)return 120;for(var e=1,i=1;i<=t;i++)e*=i;return e},P.PlotUtils.getQBSplinePoints=function(t){if(t.length<=2)return t;var e=[],i=t.length-2-1;e.push(t[0]);for(var o=0;o<=i;o++)for(var r=0;r<=1;r+=.05){for(var n=y=0,s=0;s<=2;s++){var a=P.PlotUtils.getQuadricBSplineFactor(s,r);n+=a*t[o+s][0],y+=a*t[o+s][1]}e.push([n,y])}return e.push(t[t.length-1]),e},P.PlotUtils.getQuadricBSplineFactor=function(t,e){return 0==t?Math.pow(e-1,2)/2:1==t?(-2*Math.pow(e,2)+2*e+1)/2:2==t?Math.pow(e,2)/2:0},P.Event={},P.Event.EventType={},P.Event.EventType.MOUSEMOVE="mousemove",P.Event.EventType.MOUSEUP="mouseup",P.Event.EventType.MOUSEDOWN="mousedown",P.Event.PlotDrawEvent=function(t,e){goog.base(this,t),this.feature=e},goog.inherits(P.Event.PlotDrawEvent,goog.events.Event),P.Event.PlotDrawEvent.DRAW_START="draw_start",P.Event.PlotDrawEvent.DRAW_MOVING="draw_moving",P.Event.PlotDrawEvent.DRAW_END="draw_end",P.Event.PlotEditEvent=function(t,e){goog.base(this,t),this.feature=e},goog.inherits(P.Event.PlotEditEvent,goog.events.Event),P.Event.PlotEditEvent.EDIT_START="edit_start",P.Event.PlotEditEvent.EDIT_END="edit_end",P.Event.PlotEditEvent.DRAG_POINT_MOVING="drag_point_moving",P.Event.PlotEditEvent.DRAG_POINT_END="drag_point_end",P.Event.PlotEditEvent.DRAG_PLOT_MOVING="drag_plot_moving",P.Event.PlotEditEvent.DRAG_PLOT_END="drag_plot_end",P.Plot=function(t){this.setPoints(t)},P.Plot.prototype={isPlot:function(){return!0},setPoints:function(t){this.points=t||[],1<=this.points.length&&this.generate()},getPoints:function(){return this.points.slice(0)},getPointCount:function(){return this.points.length},updatePoint:function(t,e){0<=e&&e<this.points.length&&(this.points[e]=t,this.generate())},updateLastPoint:function(t){this.updatePoint(t,this.points.length-1)},generate:function(){},finishDrawing:function(){}},P.Plot.Arc=function(t){goog.base(this,[]),this.type=P.PlotTypes.ARC,this.fixPointCount=3,this.setPoints(t)},goog.inherits(P.Plot.Arc,ol.geom.LineString),goog.mixin(P.Plot.Arc.prototype,P.Plot.prototype),P.Plot.Arc.prototype.generate=function(){var t,e,i,o,r,n,s,a=this.getPointCount();a<2||(2==a?this.setCoordinates(this.points):(t=P.PlotUtils.wgsToMercator(this.points[0]),e=P.PlotUtils.wgsToMercator(this.points[1]),i=P.PlotUtils.wgsToMercator(this.points[2]),o=P.PlotUtils.getCircleCenterOfThreePoints(t,e,i),r=P.PlotUtils.distance(t,o),n=P.PlotUtils.getAzimuth(t,o),a=P.PlotUtils.getAzimuth(e,o),a=P.PlotUtils.isClockWise(t,e,i)?(s=a,n):(s=n,a),this.setCoordinates(P.PlotUtils.getArcPoints(o,r,s,a))))},P.Plot.AttackArrow=function(t){goog.base(this,[]),this.type=P.PlotTypes.ATTACK_ARROW,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.headTailFactor=.8,this.setPoints(t)},goog.inherits(P.Plot.AttackArrow,ol.geom.Polygon),goog.mixin(P.Plot.AttackArrow.prototype,P.Plot.prototype),P.Plot.AttackArrow.prototype.generate=function(){var t,e,i,o,r,n,s;this.getPointCount()<2||(2!=this.getPointCount()?(n=(s=this.getPoints())[0],t=s[1],P.PlotUtils.isClockWise(s[0],s[1],s[2])&&(n=s[1],t=s[0]),r=[P.PlotUtils.mid(n,t)].concat(s.slice(2)),i=(e=this.getArrowHeadPoints(r,n,t))[0],o=e[4],s=P.PlotUtils.distance(n,t)/P.PlotUtils.getBaseLength(r),s=(r=this.getArrowBodyPoints(r,i,o,s)).length,(n=[n].concat(r.slice(0,s/2))).push(i),(s=[t].concat(r.slice(s/2,s))).push(o),n=P.PlotUtils.getQBSplinePoints(n),s=P.PlotUtils.getQBSplinePoints(s),this.setCoordinates([n.concat(e,s.reverse())])):this.setCoordinates([this.points]))},P.Plot.AttackArrow.prototype.getArrowHeadPoints=function(t,e,i){var o=(n=P.PlotUtils.getBaseLength(t))*this.headHeightFactor,r=t[t.length-1],n=P.PlotUtils.distance(r,t[t.length-2]),e=P.PlotUtils.distance(e,i),i=(o=o>e*this.headTailFactor?e*this.headTailFactor:o)*this.headWidthFactor,e=o*this.neckWidthFactor,n=(o=n<o?n:o)*this.neckHeightFactor,o=P.PlotUtils.getThirdPoint(t[t.length-2],r,0,o,!0),t=P.PlotUtils.getThirdPoint(t[t.length-2],r,0,n,!0),n=P.PlotUtils.getThirdPoint(r,o,P.Constants.HALF_PI,i,!1),i=P.PlotUtils.getThirdPoint(r,o,P.Constants.HALF_PI,i,!0);return[P.PlotUtils.getThirdPoint(r,t,P.Constants.HALF_PI,e,!1),n,r,i,P.PlotUtils.getThirdPoint(r,t,P.Constants.HALF_PI,e,!0)]},P.Plot.AttackArrow.prototype.getArrowBodyPoints=function(t,e,i,o){for(var r=P.PlotUtils.wholeDistance(t),n=P.PlotUtils.getBaseLength(t)*o,s=(n-P.PlotUtils.distance(e,i))/2,a=0,l=[],h=[],p=1;p<t.length-1;p++){var c=P.PlotUtils.getAngleOfThreePoints(t[p-1],t[p],t[p+1])/2,u=(n/2-(a+=P.PlotUtils.distance(t[p-1],t[p]))/r*s)/Math.sin(c),d=P.PlotUtils.getThirdPoint(t[p-1],t[p],Math.PI-c,u,!0),u=P.PlotUtils.getThirdPoint(t[p-1],t[p],c,u,!1);l.push(d),h.push(u)}return l.concat(h)},P.Plot.SquadCombat=function(t){goog.base(this,[]),this.type=P.PlotTypes.SQUAD_COMBAT,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.setPoints(t)},goog.inherits(P.Plot.SquadCombat,P.Plot.AttackArrow),P.Plot.SquadCombat.prototype.generate=function(){var t,e,i,o,r,n,s=this.getPointCount();s<2||(n=this.getPoints(),t=this.getTailPoints(n),i=(e=this.getArrowHeadPoints(n,t[0],t[1]))[0],o=e[4],s=(r=this.getArrowBodyPoints(n,i,o,this.tailWidthFactor)).length,(n=[t[0]].concat(r.slice(0,s/2))).push(i),(s=[t[1]].concat(r.slice(s/2,s))).push(o),n=P.PlotUtils.getQBSplinePoints(n),s=P.PlotUtils.getQBSplinePoints(s),this.setCoordinates([n.concat(e,s.reverse())]))},P.Plot.SquadCombat.prototype.getTailPoints=function(t){var e=P.PlotUtils.getBaseLength(t)*this.tailWidthFactor;return[P.PlotUtils.getThirdPoint(t[1],t[0],P.Constants.HALF_PI,e,!1),P.PlotUtils.getThirdPoint(t[1],t[0],P.Constants.HALF_PI,e,!0)]},P.Plot.TailedAttackArrow=function(t){goog.base(this,[]),this.type=P.PlotTypes.TAILED_ATTACK_ARROW,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.headTailFactor=.8,this.swallowTailFactor=1,this.swallowTailPnt=null,this.setPoints(t)},goog.inherits(P.Plot.TailedAttackArrow,P.Plot.AttackArrow),P.Plot.TailedAttackArrow.prototype.generate=function(){var t,e,i,o,r,n,s,a,l,h=this.getPointCount();h<2||(2!=this.getPointCount()?(l=(s=this.getPoints())[0],t=s[1],P.PlotUtils.isClockWise(s[0],s[1],s[2])&&(l=s[1],t=s[0]),e=[P.PlotUtils.mid(l,t)].concat(s.slice(2)),o=(i=this.getArrowHeadPoints(e,l,t))[0],r=i[4],n=P.PlotUtils.distance(l,t),s=(a=P.PlotUtils.getBaseLength(e))*this.tailWidthFactor*this.swallowTailFactor,this.swallowTailPnt=P.PlotUtils.getThirdPoint(e[1],e[0],0,s,!0),h=(a=this.getArrowBodyPoints(e,o,r,n/a)).length,(l=[l].concat(a.slice(0,h/2))).push(o),(h=[t].concat(a.slice(h/2,h))).push(r),l=P.PlotUtils.getQBSplinePoints(l),h=P.PlotUtils.getQBSplinePoints(h),this.setCoordinates([l.concat(i,h.reverse(),[this.swallowTailPnt,l[0]])])):this.setCoordinates([this.points]))},P.Plot.TailedSquadCombat=function(t){goog.base(this,[]),this.type=P.PlotTypes.TAILED_SQUAD_COMBAT,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.swallowTailFactor=1,this.swallowTailPnt=null,this.setPoints(t)},goog.inherits(P.Plot.TailedSquadCombat,P.Plot.AttackArrow),P.Plot.TailedSquadCombat.prototype.generate=function(){var t,e,i,o,r,n,s=this.getPointCount();s<2||(n=this.getPoints(),t=this.getTailPoints(n),i=(e=this.getArrowHeadPoints(n,t[0],t[2]))[0],o=e[4],s=(r=this.getArrowBodyPoints(n,i,o,this.tailWidthFactor)).length,(n=[t[0]].concat(r.slice(0,s/2))).push(i),(s=[t[2]].concat(r.slice(s/2,s))).push(o),n=P.PlotUtils.getQBSplinePoints(n),s=P.PlotUtils.getQBSplinePoints(s),this.setCoordinates([n.concat(e,s.reverse(),[t[1],n[0]])]))},P.Plot.TailedSquadCombat.prototype.getTailPoints=function(t){var e=P.PlotUtils.getBaseLength(t)*this.tailWidthFactor,i=P.PlotUtils.getThirdPoint(t[1],t[0],P.Constants.HALF_PI,e,!1),o=P.PlotUtils.getThirdPoint(t[1],t[0],P.Constants.HALF_PI,e,!0),e=e*this.swallowTailFactor;return[i,P.PlotUtils.getThirdPoint(t[1],t[0],0,e,!0),o]},P.Plot.Circle=function(t){goog.base(this,[]),this.type=P.PlotTypes.CIRCLE,this.fixPointCount=2,this.setPoints(t)},goog.inherits(P.Plot.Circle,ol.geom.Polygon),goog.mixin(P.Plot.Circle.prototype,P.Plot.prototype),P.Plot.Circle.prototype.generate=function(){var t,e;this.getPointCount()<2||(t=this.points[0],e=P.PlotUtils.distance(P.PlotUtils.wgsToMercator(t),P.PlotUtils.wgsToMercator(this.points[1])),this.setCoordinates([this.generatePoints(P.PlotUtils.wgsToMercator(t),e)]))},P.Plot.Circle.prototype.generatePoints=function(t,e){for(var i,o,r=[],n=0;n<=P.Constants.FITTING_COUNT;n++)o=2*Math.PI*n/P.Constants.FITTING_COUNT,i=t[0]+e*Math.cos(o),o=t[1]+e*Math.sin(o),r.push(P.PlotUtils.mercatorToWGS([i,o]));return r},P.Plot.ClosedCurve=function(t){goog.base(this,[]),this.type=P.PlotTypes.CLOSED_CURVE,this.t=.3,this.setPoints(t)},goog.inherits(P.Plot.ClosedCurve,ol.geom.Polygon),goog.mixin(P.Plot.ClosedCurve.prototype,P.Plot.prototype),P.Plot.ClosedCurve.prototype.generate=function(){if(!((e=this.getPointCount())<2))if(2==e)this.setCoordinates([this.points]);else{var t=this.getPoints();t.push(t[0],t[1]);for(var e,i=[],o=0;o<t.length-2;o++)var r=P.PlotUtils.getBisectorNormals(this.t,t[o],t[o+1],t[o+2]),i=i.concat(r);i=[i[(e=i.length)-1]].concat(i.slice(0,e-1));for(var n=[],o=0;o<t.length-2;o++){var s=t[o],a=t[o+1];n.push(s);for(var l=0;l<=P.Constants.FITTING_COUNT;l++){var h=P.PlotUtils.getCubicValue(l/P.Constants.FITTING_COUNT,s,i[2*o],i[2*o+1],a);n.push(h)}n.push(a)}this.setCoordinates([n])}},P.Plot.Curve=function(t){goog.base(this,[]),this.type=P.PlotTypes.CURVE,this.t=.3,this.setPoints(t)},goog.inherits(P.Plot.Curve,ol.geom.LineString),goog.mixin(P.Plot.Curve.prototype,P.Plot.prototype),P.Plot.Curve.prototype.generate=function(){var t=this.getPointCount();t<2||(2==t?this.setCoordinates(this.points):this.setCoordinates(P.PlotUtils.getCurvePoints(this.t,this.points)))},P.Plot.DoubleArrow=function(t){goog.base(this,[]),this.type=P.PlotTypes.DOUBLE_ARROW,this.headHeightFactor=.25,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.connPoint=null,this.tempPoint4=null,this.fixPointCount=4,this.setPoints(t)},goog.inherits(P.Plot.DoubleArrow,ol.geom.Polygon),goog.mixin(P.Plot.DoubleArrow.prototype,P.Plot.prototype),P.Plot.DoubleArrow.prototype.finishDrawing=function(){3==this.getPointCount()&&null!=this.tempPoint4&&this.points.push(this.tempPoint4),null!=this.connPoint&&this.points.push(this.connPoint)},P.Plot.DoubleArrow.prototype.generate=function(){var t,e,i,o,r,n,s,a=this.getPointCount();a<2||(2!=a?(n=this.points[0],i=this.points[1],s=this.points[2],a=this.getPointCount(),this.tempPoint4=3==a?this.getTempPoint4(n,i,s):this.points[3],this.connPoint=3==a||4==a?P.PlotUtils.mid(n,i):this.points[4],t=P.PlotUtils.isClockWise(n,i,s)?(o=this.getArrowPoints(n,this.connPoint,this.tempPoint4,!1),this.getArrowPoints(this.connPoint,i,s,!0)):(o=this.getArrowPoints(i,this.connPoint,s,!1),this.getArrowPoints(this.connPoint,n,this.tempPoint4,!0)),r=o.length,a=o.slice(0,e=(r-5)/2),i=o.slice(e,5+e),s=o.slice(5+e,r),n=t.slice(0,e),o=t.slice(e,5+e),r=t.slice(5+e,r),n=P.PlotUtils.getBezierPoints(n),a=P.PlotUtils.getBezierPoints(r.concat(a.slice(1))),s=P.PlotUtils.getBezierPoints(s),s=n.concat(o,a,i,s),this.setCoordinates([s])):this.setCoordinates([this.points]))},P.Plot.DoubleArrow.prototype.getArrowPoints=function(t,e,i,o){var r=P.PlotUtils.mid(t,e),n=P.PlotUtils.distance(r,i),s=P.PlotUtils.getThirdPoint(i,r,0,.3*n,!0),a=P.PlotUtils.getThirdPoint(i,r,0,.5*n,!0),s=[r,s=P.PlotUtils.getThirdPoint(r,s,P.Constants.HALF_PI,n/5,o),a=P.PlotUtils.getThirdPoint(r,a,P.Constants.HALF_PI,n/4,o),i],r=this.getArrowHeadPoints(s,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),n=r[0],o=r[4],a=P.PlotUtils.distance(t,e)/P.PlotUtils.getBaseLength(s)/2,i=this.getArrowBodyPoints(s,n,o,a),s=i.length,a=i.slice(0,s/2),s=i.slice(s/2,s);return a.push(n),s.push(o),(a=a.reverse()).push(e),(s=s.reverse()).push(t),a.reverse().concat(r,s)},P.Plot.DoubleArrow.prototype.getArrowHeadPoints=function(t,e,i){var o=P.PlotUtils.getBaseLength(t)*this.headHeightFactor,r=t[t.length-1],n=(P.PlotUtils.distance(e,i),o*this.headWidthFactor),e=o*this.neckWidthFactor,i=o*this.neckHeightFactor,o=P.PlotUtils.getThirdPoint(t[t.length-2],r,0,o,!0),t=P.PlotUtils.getThirdPoint(t[t.length-2],r,0,i,!0),i=P.PlotUtils.getThirdPoint(r,o,P.Constants.HALF_PI,n,!1),n=P.PlotUtils.getThirdPoint(r,o,P.Constants.HALF_PI,n,!0);return[P.PlotUtils.getThirdPoint(r,t,P.Constants.HALF_PI,e,!1),i,r,n,P.PlotUtils.getThirdPoint(r,t,P.Constants.HALF_PI,e,!0)]},P.Plot.DoubleArrow.prototype.getArrowBodyPoints=function(t,e,i,o){for(var r=P.PlotUtils.wholeDistance(t),n=P.PlotUtils.getBaseLength(t)*o,s=(n-P.PlotUtils.distance(e,i))/2,a=0,l=[],h=[],p=1;p<t.length-1;p++){var c=P.PlotUtils.getAngleOfThreePoints(t[p-1],t[p],t[p+1])/2,u=(n/2-(a+=P.PlotUtils.distance(t[p-1],t[p]))/r*s)/Math.sin(c),d=P.PlotUtils.getThirdPoint(t[p-1],t[p],Math.PI-c,u,!0),u=P.PlotUtils.getThirdPoint(t[p-1],t[p],c,u,!1);l.push(d),h.push(u)}return l.concat(h)},P.Plot.DoubleArrow.prototype.getTempPoint4=function(t,e,i){var o,r,n=P.PlotUtils.mid(t,e),e=P.PlotUtils.distance(n,i),i=P.PlotUtils.getAngleOfThreePoints(t,n,i),s=i<P.Constants.HALF_PI?(o=e*Math.sin(i),s=e*Math.cos(i),r=P.PlotUtils.getThirdPoint(t,n,P.Constants.HALF_PI,o,!1),P.PlotUtils.getThirdPoint(n,r,P.Constants.HALF_PI,s,!0)):i>=P.Constants.HALF_PI&&i<Math.PI?(o=e*Math.sin(Math.PI-i),s=e*Math.cos(Math.PI-i),r=P.PlotUtils.getThirdPoint(t,n,P.Constants.HALF_PI,o,!1),P.PlotUtils.getThirdPoint(n,r,P.Constants.HALF_PI,s,!1)):i>=Math.PI&&i<1.5*Math.PI?(o=e*Math.sin(i-Math.PI),s=e*Math.cos(i-Math.PI),r=P.PlotUtils.getThirdPoint(t,n,P.Constants.HALF_PI,o,!0),P.PlotUtils.getThirdPoint(n,r,P.Constants.HALF_PI,s,!0)):(o=e*Math.sin(2*Math.PI-i),s=e*Math.cos(2*Math.PI-i),r=P.PlotUtils.getThirdPoint(t,n,P.Constants.HALF_PI,o,!0),P.PlotUtils.getThirdPoint(n,r,P.Constants.HALF_PI,s,!1));return s},P.Plot.Ellipse=function(t){goog.base(this,[]),this.type=P.PlotTypes.ELLIPSE,this.fixPointCount=2,this.setPoints(t)},goog.inherits(P.Plot.Ellipse,ol.geom.Polygon),goog.mixin(P.Plot.Ellipse.prototype,P.Plot.prototype),P.Plot.Ellipse.prototype.generate=function(){var t,e,i,o;this.getPointCount()<2||(t=P.PlotUtils.wgsToMercator(this.points[0]),o=P.PlotUtils.wgsToMercator(this.points[1]),e=P.PlotUtils.mid(t,o),i=Math.abs((t[0]-o[0])/2),o=Math.abs((t[1]-o[1])/2),this.setCoordinates([this.generatePoints(e,i,o)]))},P.Plot.Ellipse.prototype.generatePoints=function(t,e,i){for(var o,r,n=[],s=0;s<=P.Constants.FITTING_COUNT;s++)r=2*Math.PI*s/P.Constants.FITTING_COUNT,o=t[0]+e*Math.cos(r),r=t[1]+i*Math.sin(r),n.push([P.PlotUtils.mercatorToWGS([o,r])[0],P.PlotUtils.mercatorToWGS([o,r])[1]]);return n},P.Plot.FineArrow=function(t){goog.base(this,[]),this.type=P.PlotTypes.FINE_ARROW,this.tailWidthFactor=.15,this.neckWidthFactor=.2,this.headWidthFactor=.25,this.headAngle=Math.PI/8.5,this.neckAngle=Math.PI/13,this.fixPointCount=2,this.setPoints(t)},goog.inherits(P.Plot.FineArrow,ol.geom.Polygon),goog.mixin(P.Plot.FineArrow.prototype,P.Plot.prototype),P.Plot.FineArrow.prototype.generate=function(){var t,e,i,o,r,n,s,a;this.getPointCount()<2||(t=(o=this.getPoints())[0],e=o[1],n=(r=P.PlotUtils.getBaseLength(o))*this.tailWidthFactor,a=r*this.neckWidthFactor,s=r*this.headWidthFactor,i=P.PlotUtils.getThirdPoint(e,t,P.Constants.HALF_PI,n,!0),o=P.PlotUtils.getThirdPoint(e,t,P.Constants.HALF_PI,n,!1),r=P.PlotUtils.getThirdPoint(t,e,this.headAngle,s,!1),n=P.PlotUtils.getThirdPoint(t,e,this.headAngle,s,!0),s=P.PlotUtils.getThirdPoint(t,e,this.neckAngle,a,!1),a=P.PlotUtils.getThirdPoint(t,e,this.neckAngle,a,!0),this.setCoordinates([[i,s,r,e,n,a,o]]))},P.Plot.AssaultDirection=function(t){goog.base(this,[]),this.type=P.PlotTypes.ASSAULT_DIRECTION,this.tailWidthFactor=.2,this.neckWidthFactor=.25,this.headWidthFactor=.3,this.headAngle=Math.PI/4,this.neckAngle=.17741*Math.PI,this.setPoints(t)},goog.inherits(P.Plot.AssaultDirection,P.Plot.FineArrow),P.Plot.GatheringPlace=function(t){goog.base(this,[]),this.type=P.PlotTypes.GATHERING_PLACE,this.t=.4,this.fixPointCount=3,this.setPoints(t)},goog.inherits(P.Plot.GatheringPlace,ol.geom.Polygon),goog.mixin(P.Plot.GatheringPlace.prototype,P.Plot.prototype),P.Plot.GatheringPlace.prototype.generate=function(){var t,e=this.getPoints();if(!(e.length<2)){2==this.getPointCount()&&(i=P.PlotUtils.mid(e[0],e[1]),t=P.PlotUtils.distance(e[0],i)/.9,p=P.PlotUtils.getThirdPoint(e[0],i,P.Constants.HALF_PI,t,!0),e=[e[0],p,e[1]]);var i=P.PlotUtils.mid(e[0],e[2]);e.push(i,e[0],e[1]);for(var o=[],r=0;r<e.length-2;r++)var n=e[r],s=e[r+1],a=e[r+2],a=P.PlotUtils.getBisectorNormals(this.t,n,s,a),o=o.concat(a);i=o.length;o=[o[i-1]].concat(o.slice(0,i-1));for(var l=[],r=0;r<e.length-2;r++){n=e[r],s=e[r+1],l.push(n);for(var h=0;h<=P.Constants.FITTING_COUNT;h++){var p=P.PlotUtils.getCubicValue(h/P.Constants.FITTING_COUNT,n,o[2*r],o[2*r+1],s);l.push(p)}l.push(s)}this.setCoordinates([l])}},P.Plot.Lune=function(t){goog.base(this,[]),this.type=P.PlotTypes.LUNE,this.fixPointCount=3,this.setPoints(t)},goog.inherits(P.Plot.Lune,ol.geom.Polygon),goog.mixin(P.Plot.Lune.prototype,P.Plot.prototype),P.Plot.Lune.prototype.generate=function(){var t,e,i,o,r,n,s,a,l;this.getPointCount()<2||(l=this.getPoints(),2==this.getPointCount()&&(r=P.PlotUtils.mid(P.PlotUtils.wgsToMercator(l[0]),P.PlotUtils.wgsToMercator(l[1])),n=P.PlotUtils.distance(P.PlotUtils.wgsToMercator(l[0]),r),a=P.PlotUtils.getThirdPoint(P.PlotUtils.wgsToMercator(l[0]),r,P.Constants.HALF_PI,n),l.push(a)),t=P.PlotUtils.wgsToMercator(l[0]),e=P.PlotUtils.wgsToMercator(l[1]),i=P.PlotUtils.wgsToMercator(l[2]),o=P.PlotUtils.getCircleCenterOfThreePoints(t,e,i),r=P.PlotUtils.distance(t,o),n=P.PlotUtils.getAzimuth(t,o),a=P.PlotUtils.getAzimuth(e,o),a=P.PlotUtils.isClockWise(t,e,i)?(s=a,n):(s=n,a),(l=P.PlotUtils.getArcPoints(o,r,s,a)).push(l[0]),this.setCoordinates([l]))},P.Plot.Sector=function(t){goog.base(this,[]),this.type=P.PlotTypes.SECTOR,this.fixPointCount=3,this.setPoints(t)},goog.inherits(P.Plot.Sector,ol.geom.Polygon),goog.mixin(P.Plot.Sector.prototype,P.Plot.prototype),P.Plot.Sector.prototype.generate=function(){var t,e,i,o;this.getPointCount()<2||(2==this.getPointCount()?this.setCoordinates([this.points]):(t=(e=this.getPoints())[0],i=e[1],o=e[2],e=P.PlotUtils.distance(P.PlotUtils.wgsToMercator(i),P.PlotUtils.wgsToMercator(t)),i=P.PlotUtils.getAzimuth(P.PlotUtils.wgsToMercator(i),P.PlotUtils.wgsToMercator(t)),o=P.PlotUtils.getAzimuth(P.PlotUtils.wgsToMercator(o),P.PlotUtils.wgsToMercator(t)),(o=P.PlotUtils.getArcPoints(P.PlotUtils.wgsToMercator(t),e,i,o)).push(t,o[0]),this.setCoordinates([o])))},P.Plot.StraightArrow=function(t){goog.base(this,[]),this.type=P.PlotTypes.STRAIGHT_ARROW,this.fixPointCount=2,this.maxArrowLength=3e6,this.arrowLengthScale=5,this.setPoints(t)},goog.inherits(P.Plot.StraightArrow,ol.geom.LineString),goog.mixin(P.Plot.StraightArrow.prototype,P.Plot.prototype),P.Plot.StraightArrow.prototype.generate=function(){var t,e,i,o;this.getPointCount()<2||(t=(i=this.getPoints())[0],e=i[1],o=(o=P.PlotUtils.distance(t,e)/this.arrowLengthScale)>this.maxArrowLength?this.maxArrowLength:o,i=P.PlotUtils.getThirdPoint(t,e,Math.PI/6,o,!1),o=P.PlotUtils.getThirdPoint(t,e,Math.PI/6,o,!0),this.setCoordinates([t,e,i,e,o]))},P.Plot.Polyline=function(t){goog.base(this,[]),this.type=P.PlotTypes.POLYLINE,this.setPoints(t)},goog.inherits(P.Plot.Polyline,ol.geom.LineString),goog.mixin(P.Plot.Polyline.prototype,P.Plot.prototype),P.Plot.Polyline.prototype.generate=function(){this.getPointCount()<2||this.setCoordinates(this.points)},P.Plot.FreehandLine=function(t){goog.base(this,[]),this.type=P.PlotTypes.FREEHAND_LINE,this.freehand=!0,this.setPoints(t)},goog.inherits(P.Plot.FreehandLine,ol.geom.LineString),goog.mixin(P.Plot.FreehandLine.prototype,P.Plot.prototype),P.Plot.FreehandLine.prototype.generate=function(){this.getPointCount()<2||this.setCoordinates(this.points)},P.Plot.Polygon=function(t){goog.base(this,[]),this.type=P.PlotTypes.POLYGON,this.setPoints(t)},goog.inherits(P.Plot.Polygon,ol.geom.Polygon),goog.mixin(P.Plot.Polygon.prototype,P.Plot.prototype),P.Plot.Polygon.prototype.generate=function(){this.getPointCount()<2||this.setCoordinates([this.points])},P.Plot.Marker=function(t){goog.base(this,[0,0]),this.type=P.PlotTypes.MARKER,this.fixPointCount=1,this.setPoints(t)},goog.inherits(P.Plot.Marker,ol.geom.Point),goog.mixin(P.Plot.Marker.prototype,P.Plot.prototype),P.Plot.Marker.prototype.generate=function(){var t=this.points[0];this.setCoordinates(t)},P.Plot.Rectangle=function(t){goog.base(this,[]),this.type=P.PlotTypes.RECTANGLE,this.fixPointCount=2,this.setPoints(t)},goog.inherits(P.Plot.Rectangle,ol.geom.Polygon),goog.mixin(P.Plot.Rectangle.prototype,P.Plot.prototype),P.Plot.Rectangle.prototype.generate=function(){var t,e,i,o,r;this.getPointCount()<2||(t=this.points[0],r=this.points[1],e=Math.min(t[0],r[0]),i=Math.max(t[0],r[0]),o=Math.min(t[1],r[1]),r=Math.max(t[1],r[1]),this.setCoordinates([[[e,r],[i,r],[i,o],[e,o]]]))},P.Plot.FreehandPolygon=function(t){goog.base(this,[]),this.type=P.PlotTypes.FREEHAND_POLYGON,this.freehand=!0,this.setPoints(t)},goog.inherits(P.Plot.FreehandPolygon,ol.geom.Polygon),goog.mixin(P.Plot.FreehandPolygon.prototype,P.Plot.prototype),P.Plot.FreehandPolygon.prototype.generate=function(){this.getPointCount()<2||this.setCoordinates([this.points])},P.PlotFactory={},P.PlotFactory.createPlot=function(t,e){switch(t){case P.PlotTypes.ARC:return new P.Plot.Arc(e);case P.PlotTypes.ELLIPSE:return new P.Plot.Ellipse(e);case P.PlotTypes.CURVE:return new P.Plot.Curve(e);case P.PlotTypes.CLOSED_CURVE:return new P.Plot.ClosedCurve(e);case P.PlotTypes.LUNE:return new P.Plot.Lune(e);case P.PlotTypes.SECTOR:return new P.Plot.Sector(e);case P.PlotTypes.GATHERING_PLACE:return new P.Plot.GatheringPlace(e);case P.PlotTypes.STRAIGHT_ARROW:return new P.Plot.StraightArrow(e);case P.PlotTypes.ASSAULT_DIRECTION:return new P.Plot.AssaultDirection(e);case P.PlotTypes.ATTACK_ARROW:return new P.Plot.AttackArrow(e);case P.PlotTypes.FINE_ARROW:return new P.Plot.FineArrow(e);case P.PlotTypes.CIRCLE:return new P.Plot.Circle(e);case P.PlotTypes.DOUBLE_ARROW:return new P.Plot.DoubleArrow(e);case P.PlotTypes.TAILED_ATTACK_ARROW:return new P.Plot.TailedAttackArrow(e);case P.PlotTypes.SQUAD_COMBAT:return new P.Plot.SquadCombat(e);case P.PlotTypes.TAILED_SQUAD_COMBAT:return new P.Plot.TailedSquadCombat(e);case P.PlotTypes.FREEHAND_LINE:return new P.Plot.FreehandLine(e);case P.PlotTypes.FREEHAND_POLYGON:return new P.Plot.FreehandPolygon(e);case P.PlotTypes.POLYGON:return new P.Plot.Polygon(e);case P.PlotTypes.MARKER:return new P.Plot.Marker(e);case P.PlotTypes.RECTANGLE:return new P.Plot.Rectangle(e);case P.PlotTypes.POLYLINE:return new P.Plot.Polyline(e)}return null},P.PlotDraw=function(t){goog.base(this,[]),this.points=null,this.plot=null,this.feature=null,this.plotType=null,this.plotParams=null,this.mapViewport=null,this.dblClickZoomInteraction=null,this.featureSourceID="plot-draw-source-point",this.featureSource={type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[]}}},this.drawOverlay={id:"plot-draw-overlayer-point-layer",source:"plot-draw-source-point",type:"circle",paint:{"circle-radius":4,"circle-color":"#B42222"}},this.setMap(t)},goog.inherits(P.PlotDraw,ol.Observable),P.PlotDraw.prototype.activate=function(t,e){this.deactivate(),this.deactivateMapTools(),(window._PlotDraw=this).map.on("click",this.mapFirstClickHandler),this.plotType=t,this.plotParams=e,this.map.addSource(this.featureSourceID,this.featureSource),this.map.addLayer(this.drawOverlay)},P.PlotDraw.prototype.deactivate=function(){this.disconnectEventHandlers(),this.map.getLayer(this.drawOverlay.id)&&(this.map.removeLayer(this.drawOverlay.id),this.map.removeSource("plot-draw-source-point")),this.points=[],this.plot=null,this.feature=null,this.plotType=null,this.plotParams=null,this.activateMapTools()},P.PlotDraw.prototype.isDrawing=function(){return null!=this.plotType},P.PlotDraw.prototype.setMap=function(t){this.map=t,this.mapViewport=this.map.getCanvasContainer()},P.PlotDraw.prototype.mapFirstClickHandler=function(t){return window._PlotDraw.points.push([t.lngLat.lng,t.lngLat.lat]),window._PlotDraw.plot=P.PlotFactory.createPlot(window._PlotDraw.plotType,window._PlotDraw.points,window._PlotDraw.plotParams),window._PlotDraw.feature=window._PlotDraw.plot,window._PlotDraw.map.off("click",window._PlotDraw.mapFirstClickHandler),window._PlotDraw.plot.fixPointCount==window._PlotDraw.plot.getPointCount()?void window._PlotDraw.mapDoubleClickHandler(t):(window._PlotDraw.map.on("click",window._PlotDraw.mapNextClickHandler),window._PlotDraw.plot.freehand||window._PlotDraw.map.on("dblclick",window._PlotDraw.mapDoubleClickHandler),void goog.events.listen(window._PlotDraw.mapViewport,P.Event.EventType.MOUSEMOVE,window._PlotDraw.mapMouseMoveHandler,!1,window._PlotDraw))},P.PlotDraw.prototype.mapMouseMoveHandler=function(t){var e,i=this.map.unproject([t.offsetX,t.offsetY]),t=(this.map.project([i.lng,i.lat]),[i.lng,i.lat]);P.PlotUtils.distance([i.lng,i.lat],this.points[this.points.length-1])<P.Constants.ZERO_TOLERANCE||(this.plot.freehand?(this.points.push(t),this.plot.setPoints(this.points)):(e=this.points.concat([t]),this.plot.setPoints(e)),e=JSON.parse(JSON.stringify({type:"Feature",properties:{},geometry:{coordinates:P.Utils.handleArray(this.feature.A,P.Utils.getFeatureType(this.feature.type)),type:P.Utils.getFeatureType(this.feature.type)}})),this.dispatchEvent(new P.Event.PlotDrawEvent(P.Event.PlotDrawEvent.DRAW_MOVING,e)))},P.PlotDraw.prototype.mapNextClickHandler=function(t){var e=[t.lngLat.lng,t.lngLat.lat];if(window._PlotDraw.plot.freehand||!(P.PlotUtils.distance(e,window._PlotDraw.points[window._PlotDraw.points.length-1])<P.Constants.ZERO_TOLERANCE))return window._PlotDraw.points.push(e),window._PlotDraw.plot.setPoints(window._PlotDraw.points),window._PlotDraw.plot.fixPointCount==window._PlotDraw.plot.getPointCount()?void window._PlotDraw.mapDoubleClickHandler(t):void(window._PlotDraw.plot&&window._PlotDraw.plot.freehand&&window._PlotDraw.mapDoubleClickHandler(t))},P.PlotDraw.prototype.mapDoubleClickHandler=function(t){window._PlotDraw.disconnectEventHandlers(),window._PlotDraw.plot.finishDrawing(),t.preventDefault(),window._PlotDraw.drawEnd()},P.PlotDraw.prototype.disconnectEventHandlers=function(){this.map.off("click",this.mapFirstClickHandler),this.map.off("click",this.mapNextClickHandler),goog.events.unlisten(this.mapViewport,P.Event.EventType.MOUSEMOVE,this.mapMouseMoveHandler,!1,this),this.map.off("dblclick",this.mapDoubleClickHandler)},P.PlotDraw.prototype.drawEnd=function(t){var e=JSON.parse(JSON.stringify({type:"Feature",properties:{id:P.Utils.uuid(),coordinates:this.feature.points,isplot:!0,plotType:this.plotType},geometry:{coordinates:P.Utils.handleArray(this.feature.A,P.Utils.getFeatureType(this.feature.type)),type:P.Utils.getFeatureType(this.feature.type)}}));this.activateMapTools(),this.disconnectEventHandlers(),this.map.getLayer(this.drawOverlay.id)&&(this.map.removeLayer(this.drawOverlay.id),this.map.removeSource("plot-draw-source-point")),this.points=[],this.plot=null,this.plotType=null,this.plotParams=null,this.dispatchEvent(new P.Event.PlotDrawEvent(P.Event.PlotDrawEvent.DRAW_END,e)),this.feature=null},P.PlotDraw.prototype.deactivateMapTools=function(){},P.PlotDraw.prototype.activateMapTools=function(){},P.PlotEdit=function(t,e){t&&e&&(goog.base(this,[]),this.activePlot=null,this.startPoint=null,this.ghostControlPoints=null,this.controlPoints=null,this.map=t,this.zmapboxgl=e,this.mapViewport=this.map.getCanvasContainer(),this.mouseOver=!1,this.elementTable={},this.activeControlPointId=null,this.mapDragPan=null)},goog.inherits(P.PlotEdit,ol.Observable),P.PlotEdit.prototype.Constants={HELPER_HIDDEN_DIV:"p-helper-hidden-div",HELPER_CONTROL_POINT_DIV:"p-helper-control-point-div"},P.PlotEdit.prototype.initHelperDom=function(){if(this.map&&this.activePlot){var t=this.getMapParentElement();if(t)for(var e=P.DomUtils.createHidden("div",t,this.Constants.HELPER_HIDDEN_DIV),i=this.getControlPoints(),o=0;o<i.length;o++){var r=this.Constants.HELPER_CONTROL_POINT_DIV+"-"+o;P.DomUtils.create("div",this.Constants.HELPER_CONTROL_POINT_DIV,e,r),this.elementTable[r]=o}}},P.PlotEdit.prototype.getMapParentElement=function(){var t=this.map.getContainer();if(t)return t.parentNode},P.PlotEdit.prototype.destroyHelperDom=function(){if(this.controlPoints){for(var t=0;t<this.controlPoints.length;t++)this.controlPoints[t].remove();this.controlPoints=null}var e=this.getMapParentElement(),i=P.DomUtils.get(this.Constants.HELPER_HIDDEN_DIV);i&&e&&P.DomUtils.remove(i,e)},P.PlotEdit.prototype.initControlPoints=function(){if(this.map&&this.zmapboxgl){this.controlPoints=[];for(var t=this.getControlPoints(),e=0;e<t.length;e++){var i=this.Constants.HELPER_CONTROL_POINT_DIV+"-"+e,i=(P.DomUtils.get(i),new this.zmapboxgl.Marker({draggable:!0}).setLngLat(t[e]).addTo(this.map));this.controlPoints.push(i),i.on("dragend",function(){window._PlotEdit.dispatchEvent(new P.Event.PlotEditEvent(P.Event.PlotEditEvent.DRAG_POINT_END,window._PlotEdit.handleMarkerDragEvent()))}),i.on("drag",function(){window._PlotEdit.dispatchEvent(new P.Event.PlotEditEvent(P.Event.PlotEditEvent.DRAG_POINT_MOVING,window._PlotEdit.handleMarkerDragEvent()))})}}},P.PlotEdit.prototype.handleMarkerDragEvent=function(){for(var t=[],e=0;e<window._PlotEdit.controlPoints.length;e++)t.push([window._PlotEdit.controlPoints[e].getLngLat().lng,window._PlotEdit.controlPoints[e].getLngLat().lat]);var i=P.PlotFactory.createPlot(window._PlotEdit.plotType,t,null);return JSON.parse(JSON.stringify({type:"Feature",properties:{id:P.Utils.uuid(),coordinates:i.points,isplot:!0,plotType:window._PlotEdit.plotType},geometry:{coordinates:P.Utils.handleArray(i.A,P.Utils.getFeatureType(i.type)),type:P.Utils.getFeatureType(i.type)}}))},P.PlotEdit.prototype.controlPointMouseMoveHandler2=function(t){t.stopImmediatePropagation()},P.PlotEdit.prototype.controlPointMouseDownHandler=function(t){t=t.target.id;this.activeControlPointId=t,goog.events.listen(this.mapViewport,P.Event.EventType.MOUSEMOVE,this.controlPointMouseMoveHandler,!1,this),goog.events.listen(this.mapViewport,P.Event.EventType.MOUSEUP,this.controlPointMouseUpHandler,!1,this)},P.PlotEdit.prototype.controlPointMouseMoveHandler=function(t){var e,i=map.getCoordinateFromPixel([t.offsetX,t.offsetY]);this.activeControlPointId&&(e=this.activePlot,t=this.elementTable[this.activeControlPointId],e.updatePoint(i,t),this.map.getOverlayById(this.activeControlPointId).setPosition(i))},P.PlotEdit.prototype.controlPointMouseUpHandler=function(t){goog.events.unlisten(this.mapViewport,P.Event.EventType.MOUSEMOVE,this.controlPointMouseMoveHandler,!1,this),goog.events.unlisten(this.mapViewport,P.Event.EventType.MOUSEUP,this.controlPointMouseUpHandler,!1,this)},P.PlotEdit.prototype.activate=function(t){t.properties.isplot&&(this.deactivate(),this.plotType=t.properties.plotType,this.activePlot=new ol.Feature(P.PlotFactory.createPlot(t.properties.plotType,JSON.parse(t.properties.coordinates),null)),(window._PlotEdit=this).initHelperDom(),this.initControlPoints(),this.map.on("pointermove",this.plotMouseOverOutHandler))},P.PlotEdit.prototype.getControlPoints=function(){return this.activePlot?this.activePlot.getGeometry().getPoints():[]},P.PlotEdit.prototype.plotMouseOverOutHandler=function(t){t=map.queryRenderedFeatures(t.point);t.length&&t==this.activePlot?window._PlotEdit.mouseOver||(window._PlotEdit.mouseOver=!0,window._PlotEdit.map.getCanvasContainer().style.cursor="move",window._PlotEdit.map.on("pointerdown",window._PlotEdit.plotMouseDownHandler)):window._PlotEdit.mouseOver&&(window._PlotEdit.mouseOver=!1,window._PlotEdit.map.getCanvasContainer().style.cursor="default",window._PlotEdit.map.off("pointerdown",window._PlotEdit.plotMouseDownHandler))},P.PlotEdit.prototype.plotMouseDownHandler=function(t){window._PlotEdit.ghostControlPoints=window._PlotEdit.getControlPoints(),window._PlotEdit.startPoint=t.coordinate,window._PlotEdit.disableMapDragPan(),window._PlotEdit.map.on("pointerup",window._PlotEdit.plotMouseUpHandler),window._PlotEdit.map.on("pointerdrag",window._PlotEdit.plotMouseMoveHandler)},P.PlotEdit.prototype.plotMouseMoveHandler=function(t){for(var t=t.coordinate,e=t[0]-this.startPoint[0],i=t[1]-this.startPoint[1],o=[],r=0;r<window._PlotEdit.ghostControlPoints.length;r++){var n=window._PlotEdit.ghostControlPoints[r],s=[n[0]+e,n[1]+i];o.push(s);n=window._PlotEdit.Constants.HELPER_CONTROL_POINT_DIV+"-"+r,n=window._PlotEdit.map.getOverlayById(n);n.setPosition(s),n.setPositioning("center-center")}window._PlotEdit.activePlot.getGeometry().setPoints(o)},P.PlotEdit.prototype.plotMouseUpHandler=function(t){window._PlotEdit.enableMapDragPan(),window._PlotEdit.map.off("pointerup",window._PlotEdit.plotMouseUpHandler),window._PlotEdit.map.off("pointerdrag",window._PlotEdit.plotMouseMoveHandler)},P.PlotEdit.prototype.disconnectEventHandlers=function(){this.map.off("pointermove",this.plotMouseOverOutHandler,this),goog.events.unlisten(this.mapViewport,P.Event.EventType.MOUSEMOVE,this.controlPointMouseMoveHandler,!1,this),goog.events.unlisten(this.mapViewport,P.Event.EventType.MOUSEUP,this.controlPointMouseUpHandler,!1,this),this.map.off("pointerdown",this.plotMouseDownHandler,this),this.map.off("pointerup",this.plotMouseUpHandler,this),this.map.off("pointerdrag",this.plotMouseMoveHandler,this)},P.PlotEdit.prototype.deactivate=function(){this.activePlot=null,this.mouseOver=!1,this.destroyHelperDom(),this.disconnectEventHandlers(),this.elementTable={},this.activeControlPointId=null,this.startPoint=null},P.PlotEdit.prototype.disableMapDragPan=function(){},P.PlotEdit.prototype.enableMapDragPan=function(){},function(){var t=window;t.ZenMap=t.ZenMapLib=t.ZenMapLib||{},t.ZenMap.Adapter=t.ZenMap.Adapter||{},t.ZenMap.Controls=t.ZenMap.Controls||{},t.ZenMap.Geometry=t.ZenMap.Geometry||{},t.ZenMap.Layers=t.ZenMap.Layers||{},t.ZenMap.Managers=t.ZenMap.Managers||{},t.ZenMap.Symbols=t.ZenMap.Symbols||{},t.ZenMap.Tools=t.ZenMap.Tools||{},t.ZenMap.Utils=t.ZenMap.Utils||{},t.ZenMap.Services=t.ZenMap.Services||{},t.ZenMap.LayerIndex=t.ZenMap.LayerIndex||0,t.ZenMap.OverlayIndex=t.ZenMap.OverlayIndex||0,ZenMap.LINE_TYPE_SOLID=[2,0],ZenMap.LINE_TYPE_DASH=[2,2],ZenMap.LINE_TYPE_DOT=[1,2],ZenMap.LINE_TYPE_DASHDOTDOT=[3,2],ZenMap.LINE_TYPE_DASHDOT=[1,4],ZenMap.LINE_TYPE_SHORTDASH=[2,2],ZenMap.LINE_TYPE_SHORTDOT=[2,2],ZenMap.LINE_TYPE_SHORTDASHDOTDOT=[1,4],ZenMap.LINE_TYPE_SHORTDASHDOT=[2,4],ZenMap.LINE_TYPE_LONGDASH=[5,2],ZenMap.LINE_TYPE_LONGDASHDOT=[5,2],ZenMap.CONTROL_TYPE_MOUSEPOSITION=6,ZenMap.CONTROL_TYPE_JWMOUSEPOSITION=7,ZenMap.ISPOINTCONVERT=!0,ZenMap.ISWGS84=!0,ZenMap.VERSIONNUMBER="V3.0.5",ZenMap.CULTURE="CN",ZenMap.MAPTYPE_ARCGISTILE=8,ZenMap.MAPTYPE_PGIS=1,ZenMap.MAPTYPE_WMS=2,ZenMap.MAPTYPE_GOOGLE=3,ZenMap.MAPTYPE_BAIDU=4,ZenMap.MAPTYPE_BING=5,ZenMap.MAPTYPE_IMAGE=6,ZenMap.MAPTYPE_GEOSERVER=7,ZenMap.MAPTYPE_ZENMAP=9,ZenMap.CONTROL_TYPE_UNKNOWN=0,ZenMap.CONTROL_TYPE_COPYRIGHT=1,ZenMap.CONTROL_TYPE_NAVIGATION=2,ZenMap.CONTROL_TYPE_OVERVIEW=3,ZenMap.CONTROL_TYPE_SCALE=4,ZenMap.CONTROL_TYPE_NORTH=5,ZenMap.CONTROL_TYPE_MOUSEPOSITION=6,ZenMap.CONTROL_TYPE_JWMOUSEPOSITION=7,ZenMap.CONTROL_TYPE_ZOOMANIMATION=8,ZenMap.CONTROL_ANCHOR_TOP_LEFT=0,ZenMap.CONTROL_ANCHOR_TOP_RIGHT=1,ZenMap.CONTROL_ANCHOR_BOTTOM_LEFT=2,ZenMap.CONTROL_ANCHOR_BOTTOM_RIGHT=3,ZenMap.CULTURE="CN",t.ZenMap.controlPosition={TopLeft:"top-left",TopRight:"top-right",BottomLeft:"bottom-left",BottomRight:"bottom-right"}}(),ZenMap.Utils.BaseUtils=function(){var scriptName="ZenMapGL.js";function _getScriptLocation(){for(var t,e,i=new RegExp("(^|(.*?))\\/("+scriptName+")(\\?|$)"),o=document.getElementsByTagName("script"),r="",n=0,s=o.length;n<s;n++)if((t=o[n].src)&&(e=t.match(i))){r=e[1];break}return r}var host=_getScriptLocation(),e={indexOf:function(t,e){return t.indexOf(e)},getScriptLocation:function(){var t=document.getElementsByTagName("script");return t[t.length-1].getAttribute("src")},getHostPath:function(){return host},getScriptDictoryLocation:function(){var t=this.getScriptLocation();if(t||!(t.length<0))return t.substring(0,t.lastIndexOf("/")+1)},createError:function(t,e){return e?new Error(t+"\r\nBecause :"+e.message):new Error(t)},addtrustmyself:function(){this.addtrusturl(window.location.href)},addpopwinmyself:function(){this.popupwindow(window.location.href)},addCSSFiles:function(t){if(t&&!(t.length<=0)){for(var e=[],i=0,o=t.length;i<o;i++)e.push("<link type='text/css' rel='stylesheet' href = '"+host+"/"+t[i]+"'/> ");0<e.length&&document.write(e.join(""))}},addCSSFiles2:function(t){if(t&&!(t.length<=0))for(var e=0,i=t.length;e<i;e++){var o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href",host+"/"+t[e]),window._APPEND_CHILD_?window._APPEND_CHILD_(o):document.getElementsByTagName("head")[0].appendChild(o)}},addJSFiles:function(t){if(t&&!(t.length<=0)){for(var e=[],i=0,o=t.length;i<o;i++)e.push("<script type='text/javascript' src='"+host+"/"+t[i]+"'><\/script>");0<e.length&&document.write(e.join(""))}},toJson:function(t){switch(t.constructor){case Object:var e,i="{";for(e in t)t.hasOwnProperty(e)&&(i+="'"+e+"':"+ZenMap.Utils.BaseUtils.toJson(t[e])+",");return(i=","===i.substr(i.length-1)?i.substr(0,i.length-1):i)+"}";case Array:for(var o="[",r=0;r<t.length;r++)t[r]&&(o+=ZenMap.Utils.BaseUtils.toJson(t[r])+",");return(o=","===o.substr(o.length-1)?o.substr(0,o.length-1):o)+"]";case Boolean,Date,String:return'"'+t.toString()+'"';case Function:break;case Number:return t.toString()}},uuid:function(){for(var t=[],e="0123456789abcdef",i=0;i<36;i++)t[i]=e.substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}};return e.JsonToStr=function(t){var i,o,r=[];for(o in t)t.hasOwnProperty(o)&&(i=function(t){if("function"!=typeof t)return"object"==typeof t&&null!==t?e.JsonToStr(t):/^(string|number)$/.test(typeof t)?"'"+t+"'":t}(t[o]))&&r.push("'"+o+"':"+i);return"{"+r.join(",")+"}"},e.isTypeRight=function(param,type){switch(type){case"string":return"string"==typeof param;case"int":return"number"==typeof param&&-1===param.toString().indexOf(".");case"number":return"number"==typeof param;case"boolean":return"boolean"==typeof param;case"Array":return param instanceof Array==!0;case"function":return"function"==typeof param;case"object":return"object"==typeof param;case"undefined":return void 0===param;default:return param instanceof eval(type)}},e}(),ZenMap.Utils.BaseUtils.addCSSFiles2(["ZenView/zmapbox-gl.css"]),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var e,i=0;e=this[i];i++)if(e==t)return i;return-1}),ZenMap.Events=function(t,e){this.CLASS_NAME="ZenMap.Events",this.obj=t,this.listeners={},this.supportEvents=e||[],this.through=!0},ZenMap.Events.prototype._internalEvent=["_register","_unregister"],ZenMap.Events.prototype={setSupportEvent:function(t){this.supportEvents=t||[]},supportEvent:function(t){var e=!1;return(e=this.obj.suppertEvent?this.obj.suppertEvent(t):e)||0<=this.supportEvents.indexOf(t)||0<=this._internalEvent.indexOf(t)},register:function(t,e,i){var o;this.supportEvent(t)&&((o=this.listeners[t])?o.push({f:e,s:i}):(this.triggerEvt("_register",{eventType:t}),this.listeners[t]=[{f:e,s:i}]))},unregister:function(t,e){var i=this.listeners[t];if(i){for(var o=-1,r=0,n=i.length;r<n;++r)if(i[r].f===e){o=r;break}0<=o&&i.pop(e),i.length<=0&&this.triggerEvt("_unregister",{eventType:t})}},triggerEvt:function(t,e){var i=this.listeners[t];if(i&&0<i.length){(e=e||{}).srcObject=this.obj,e.eventType||(e.eventType=t);for(var o=0,r=i.length;o<r&&(!1!==i[o].f.call(i[o].s,e)&&this.through);++o);}}},ZenMap.MAP_EVENT_CLICK="click",ZenMap.MAP_EVENT_DBLCLICK="dblclick",ZenMap.MAP_EVENT_RIGHT_CLICK="rightclick",ZenMap.MAP_EVENT_MOUSE_MOVE="mousemove",ZenMap.MAP_EVENT_MOUSE_OVER="mouseover",ZenMap.MAP_EVENT_MOUSE_OUT="mouseout",ZenMap.MAP_EVENT_ZOOM_START="zoomstart",ZenMap.MAP_EVENT_ZOOM_END="zoomend",ZenMap.MAP_EVENT_DRAG="draging",ZenMap.MAP_EVENT_DRAG_START="dragstart",ZenMap.MAP_EVENT_DRAG_END="dragend",ZenMap.MAP_EVENT_MOVE="moving",ZenMap.MAP_EVENT_MOVE_START="movestart",ZenMap.MAP_EVENT_MOVE_END="moveend",ZenMap.MAP_EVENT_ADD_OVERLAY="addoverlay",ZenMap.MAP_EVENT_REMOVE_OVERLAY="removeoverlay",ZenMap.MAP_EVENT_CLEAR_OVERLAYS="clearoverlays",ZenMap.MAP_EVENT_ADD_CONTROL="addcontrol",ZenMap.MAP_EVENT_REMOVE_CONTROL="removecontrol",ZenMap.PixelRatio=!0,function(){var e=ZenMap.Map=function(t,e){window.devicePixelRatio=1,zmapboxgl.accessToken="pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA",this._containerID="",this._opts=e,this._controls=[],this._popupList=[],this._overLays=[],this.fill_extrusions={},this._menu,this._containerID="string"==typeof t?t:t.id,this._project=e.project||"GCJ-02",e.defaultZoom=e.defaultZoom||e.minZoom,e.isOnly2DMap=e.isOnly2DMap||!1;var i={lon:e.centerPoint[0],lat:e.centerPoint[1]};this._mapCRS=e.mapCRS;var o,r,i=ZenMap.T.setPoint(this,i),t=null;e.restrictedExtent&&(t=e.restrictedExtent[0]<-180||180<e.restrictedExtent[0]?(o=ZenMap.T.helper.inverseMercator(e.restrictedExtent[0],e.restrictedExtent[1]),r=ZenMap.T.helper.inverseMercator(e.restrictedExtent[2],e.restrictedExtent[3]),new zmapboxgl.LngLatBounds([o.lon,o.lat],[r.lon,r.lat])):(o=ZenMap.T.setPoint(this,{lon:e.restrictedExtent[0],lat:e.restrictedExtent[1]}),r=ZenMap.T.setPoint(this,{lon:e.restrictedExtent[2],lat:e.restrictedExtent[3]}),new zmapboxgl.LngLatBounds([o.lon,o.lat],[r.lon,r.lat]))),this._obj=new zmapboxgl.FreeCRSMap({container:this._containerID,zoom:e.defaultZoom,preserveDrawingBuffer:!0,center:[i.lon,i.lat],minZoom:e.minZoom,maxZoom:e.maxZoom,bearing:e.bearing||0,pitch:e.pitch||0,antialias:e.antialias,pitchWithRotate:!e.isOnly2DMap,dragRotate:!e.isOnly2DMap,renderWorldCopies:!!e.renderWorldCopies,doubleClickZoom:!1,maxPitchControl:!!e.maxPitchControl,localIdeographFontFamily:"Microsoft YaHei",mapCRS:e.mapCRS,useLocalFontFamily:void 0===e.useLocalFontFamily||e.useLocalFontFamily,style:e.style||{version:8,sources:{},sprite:ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/gaode",glyphs:ZenMap.Utils.BaseUtils.getHostPath()+"/lib/fonts/{fontstack}/{range}.pbf",layers:[{id:"background",interactive:!0,paint:{"background-color":"#0a212f","background-opacity":!1===e.showBackground?0:1},type:"background"}]},hash:!1,maxBounds:t}),this._obj.zoomInteger=e.zoomInteger,this._layers=[],this._Fullscreen=!1,this._mapContainer=this._obj.getContainer(),this._obj._defaultZoom=e.defaultZoom,this._obj._defaultCenter=[i.lon,i.lat],this._obj.scrollZoom.enable(),this._obj.dragPan.enable(),this._obj.boxZoom.disable(),this._events=new ZenMap.Events(this,["click","rightclick","mousemove","resize","dblclick","dragstart","dragend","draging","zoomstart","zoomend","movestart","moveend","moving","loaded","mouseover","mouseout"]),this._defaultLayer=new ZenMap.Layers.OverlayLayer("defaultLayer"),this._addEvents(),this.isDrawing=!1,this.activeFeature=null};e.prototype._addEvents=function(){var i=this;this._obj.on("load",function(){i.addLayer(i._defaultLayer),i._events.triggerEvt("loaded")}),this._obj.on("click",function(t){i._getActiveFeatureForClick(t);t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),t=new ZenMap.Geometry.Point(ZenMap.T.getPoint(i,t).lon,ZenMap.T.getPoint(i,t).lat);i._events.triggerEvt("click",t)}),this._obj.on("contextmenu",function(t){i._getActiveFeatureForRightClick(t);t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),t=new ZenMap.Geometry.Point(ZenMap.T.getPoint(i,t).lon,ZenMap.T.getPoint(i,t).lat);i._events.triggerEvt("rightclick",t)}),this._obj.on("dblclick",function(t){t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),t=new ZenMap.Geometry.Point(ZenMap.T.getPoint(i,t).lon,ZenMap.T.getPoint(i,t).lat);i._events.triggerEvt("dblclick",t)}),this._obj.on("mousemove",function(t){i._getActiveFeatureForMouse(t);t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),t=new ZenMap.Geometry.Point(ZenMap.T.getPoint(i,t).lon,ZenMap.T.getPoint(i,t).lat);i._events.triggerEvt("mousemove",t)}),this._obj.on("mouseover",function(t){t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),t=new ZenMap.Geometry.Point(ZenMap.T.getPoint(i,t).lon,ZenMap.T.getPoint(i,t).lat);i._events.triggerEvt("mouseover",t)}),this._obj.on("mouseout",function(t){i._mouseout();t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),t=new ZenMap.Geometry.Point(ZenMap.T.getPoint(i,t).lon,ZenMap.T.getPoint(i,t).lat);i._events.triggerEvt("mouseout",t)}),this._obj.on("zoomstart",function(t){for(var t=t.target.getZoom(),e=0;e<i._layers.length;e++)-1<i._layers[e]._layerID.indexOf("OverlayLayer")&&i._layers[e]._clearClusterPoint();i._events.triggerEvt("zoomstart",t)}),this._obj.on("zoomend",function(t){t=t.target.getZoom();i._events.triggerEvt("zoomend",t)}),this._obj.on("dragstart",function(t){i._events.triggerEvt("dragstart")}),this._obj.on("dragend",function(t){i._events.triggerEvt("dragend")}),this._obj.on("drag",function(t){i._events.triggerEvt("draging")}),this._obj.on("move",function(t){i._events.triggerEvt("moving")}),this._obj.on("movestart",function(t){i._events.triggerEvt("movestart")}),this._obj.on("moveend",function(t){i._events.triggerEvt("moveend")})},e.prototype._getFeatures=function(t){for(var e=this._obj.style._order.length-1;0<=e;e--)if(-1<this._obj.style._order[e].indexOf("OverlayLayer")){var i=this._obj.style._order[e];if("none"!=this._obj.getLayoutProperty(i,"visibility")){var o=this._obj.queryRenderedFeatures(t.point,{layers:[i]});if(o&&0<o.length)for(var r=0;r<o.length;r++)if(o[r].properties.cluster||o[r].properties.visible)return[o[r]]}}return[]},e.prototype._redrawClusterPoints=function(t){for(var e=0;e<this._layers.length;e++)-1<this._layers[e]._layerID.indexOf("OverlayLayer")&&this._layers[e]._clearClusterPoint();if(t.properties.cluster)for(var i=t.source,e=0;e<this._layers.length;e++)if(i===this._layers[e]._layerID+"_source"){var o=this._layers[e]._overlays[this._layers[e]._cId].dataJson,r="";return 0<o.length&&(r=o[0].markType),void this._layers[e].clusteronmouseover({feature:t,count:t.properties.point_count,layer:this._layers[e],markType:this._layers[e].name+"~"+r})}},e.prototype._getOverlayByFeature=function(t){if(0<t.length){this._obj.getCanvas().style.cursor="pointer";var e=t[0].properties.layerId,i=t[0].properties.id;if(this._defaultLayer._layerID===e)return this._defaultLayer._overlays[i];for(var o=0;o<this._layers.length;o++)if(e===this._layers[o]._layerID){if(!this._layers[o].useCluster)return this._layers[o]._overlays[i];for(var r=0;r<this._layers[o]._overlays[this._layers[o]._cId].dataJson.length;r++)if(this._layers[o]._overlays[this._layers[o]._cId].dataJson[r].id===t[0].properties.id)return this._layers[o]._overlays[this._layers[o]._cId].dataJson[r];break}}},e.prototype._getActiveFeatureForMouse=function(t){if(this.isDrawing||this._obj.boxZoom._enabled)this._obj.getCanvas().style.cursor="crosshair";else if(!this.ModifyFeatureControl||!this.ModifyFeatureControl._active){t=this._getFeatures(t);if(0!=t.length)return 0<t.length&&t[0].properties.cluster?this.activeFeature&&this.activeFeature.properties.cluster_id==t[0].properties.cluster_id?void 0:(this._mouseout(),this._obj.getCanvas().style.cursor="pointer",this._redrawClusterPoints(t[0]),void(this.activeFeature=t[0])):void(this.activeOverlay&&t[0].properties.id==this.activeOverlay.id||(this._mouseout(),this.activeOverlay=this._getOverlayByFeature(t),this.activeOverlay&&(this._obj.getCanvas().style.cursor="pointer","ZenMap.Symbols.Marker"!==this.activeOverlay.CLASS_NAME&&"ZenMap.Symbols.Label"!==this.activeOverlay.CLASS_NAME&&"ZenMap.Symbols.Star"!==this.activeOverlay.CLASS_NAME&&"ZenMap.Symbols.ClusterMarker"!==this.activeOverlay.CLASS_NAME||!this.activeOverlay.isEnableEdit||(this.ModifyFeatureControl&&!this.ModifyFeatureControl._active&&(this.ModifyFeatureControl.disableEdit(),this.ModifyFeatureControl=null),this.ModifyFeatureControl||(this.ModifyFeatureControl=new ZenMap.Controls.ModifyFeatureControl("",this.activeOverlay))),this.activeOverlay.layer?this.activeOverlay._events.triggerEvt("mouseover",this.activeOverlay):this.activeOverlay.container&&(this.activeOverlay.container.layer.onmouseover(this.activeOverlay),this.activeOverlay.container.layer._clusterOverFun(t[0])),this.activeOverlay.title&&(this._obj.getCanvas().title=this.activeOverlay.title))));this._mouseout()}},e.prototype._mouseout=function(){this._obj.getCanvas().style.cursor="",this.activeOverlay&&(this.ModifyFeatureControl&&!this.ModifyFeatureControl._active&&(this.ModifyFeatureControl.disableEdit(),this.ModifyFeatureControl=null),this.activeOverlay.layer?this.activeOverlay._events.triggerEvt("mouseout",this.activeOverlay):this.activeOverlay.container&&(this.activeOverlay.container.layer.onmouseout(this.activeOverlay),this.activeOverlay.container.layer._clusterOutFun()),this._obj.getCanvas().title=""),this.activeOverlay=null,this.activeFeature=null},e.prototype._getActiveFeatureForClick=function(t){var e=this._getFeatures(t);if(this.activeOverlay)this.activeOverlay.layer?(this.activeOverlay._events.triggerEvt("click",this.activeOverlay),this.activeOverlay.isEnableEdit&&"ZenMap.Symbols.Marker"!==this.activeOverlay.CLASS_NAME&&"ZenMap.Symbols.Label"!==this.activeOverlay.CLASS_NAME&&"ZenMap.Symbols.Star"!==this.activeOverlay.CLASS_NAME&&(this.activeOverlay.layer.ModifyFeatureControl&&!this.activeOverlay.layer.ModifyFeatureControl._active&&(this.activeOverlay.layer.ModifyFeatureControl.disableEdit(),this.activeOverlay.layer.ModifyFeatureControl=null),this.activeOverlay.layer.ModifyFeatureControl||(this.activeOverlay.layer.ModifyFeatureControl=new ZenMap.Controls.ModifyFeatureControl("",this.activeOverlay)))):this.activeOverlay.container&&this.activeOverlay.container.layer.onSelect(this.activeOverlay);else if(e&&0<e.length)for(var i=e[0].source,o=0;o<this._layers.length;o++)if(i===this._layers[o]._layerID+"_source")return void this._layers[o]._clusterClickFun(t)},e.prototype._setActiveEditeOverlay=function(t){this.activeOverlay&&this.activeOverlay.layer&&this.activeOverlay.isEnableEdit&&"ZenMap.Symbols.Marker"!==this.activeOverlay.CLASS_NAME&&"ZenMap.Symbols.Label"!==this.activeOverlay.CLASS_NAME&&"ZenMap.Symbols.Star"!==this.activeOverlay.CLASS_NAME&&this.activeOverlay.layer.ModifyFeatureControl&&!this.activeOverlay.layer.ModifyFeatureControl._active&&(this.activeOverlay.layer.ModifyFeatureControl.disableEdit(),this.activeOverlay.layer.ModifyFeatureControl=null),t.isEnableEdit&&"ZenMap.Symbols.Marker"!==t.CLASS_NAME&&"ZenMap.Symbols.Label"!==t.CLASS_NAME&&"ZenMap.Symbols.Star"!==t.CLASS_NAME&&(t.layer.ModifyFeatureControl&&(t.layer.ModifyFeatureControl.disableEdit(),t.layer.ModifyFeatureControl=null),t.layer.ModifyFeatureControl=new ZenMap.Controls.ModifyFeatureControl("",t))},e.prototype._getActiveFeatureForRightClick=function(t){this.activeOverlay&&this.activeOverlay.layer&&(this.activeOverlay.isEnableContextMenu&&(t=t.point,this.activeOverlay.layer._menu&&(this.activeOverlay.layer._menu.destroy(),this.activeOverlay.layer._menu=null),this.activeOverlay.layer._menu=new ZenMap.Menu(this,t,this.activeOverlay.MenuList),this.activeOverlay.layer._menu.show()),this.activeOverlay._events.triggerEvt("rightclick",this.activeOverlay))},e.prototype.setTo2DMap=function(){this._obj.easeTo({bearing:0,pitch:0}),this._obj.dragRotate.disable();for(var t=0;t<this._layers.length;t++)if("ZenMap.Layers.GaoDeLayer"===this._layers[t].CLASS_NAME&&"vector"===this._layers[t]._opts.type||"ZenMap.Layers.VectorLayer"===this._layers[t].CLASS_NAME)for(var e,i=0;i<this._layers[t].style.layers.length;i++)"fill-extrusion"==this._layers[t].style.layers[i].type&&(e=this._layers[t].style.layers[i].id,this.fill_extrusions[e]||(this.fill_extrusions[e]=this._layers[t].style.layers[i].paint["fill-extrusion-height"]),this._obj.setPaintProperty(e,"fill-extrusion-height",0))},e.prototype.setTo3DMap=function(){for(var t in 0===this._obj.getBearing()&&0===this._obj.getPitch()&&this._obj.easeTo({bearing:0,pitch:60}),this.enablePitchWithRotate(),this._obj.style._layers)this._obj.style._layers.hasOwnProperty(t)&&"fill-extrusion"==this._obj.style._layers[t].type&&this._obj.setPaintProperty(t,"fill-extrusion-height",this.fill_extrusions[t])},e.prototype.enableRotate=function(){this._obj.setPitch(0),this._obj.dragRotate.enable(),this._obj.dragRotate._pitchWithRotate=!1},e.prototype.enablePitchWithRotate=function(){this._obj.dragRotate.enable(),this._obj.dragRotate._pitchWithRotate=!0},e.prototype.disableRotate=function(){this.setTo2DMap()},e.prototype.disablePitchWithRotate=function(){this.enableRotate()},e.prototype.enableAntialias=function(){var t=this._obj._containerDimensions();window.devicePixelRatio=2,this._obj._resizeCanvas(t[0],t[1]),this._obj.transform.resize(t[0],t[1]),this._obj.painter.resize(t[0],t[1]),this._obj._update()},e.prototype.disableAntialias=function(){var t=this._obj._containerDimensions();window.devicePixelRatio=1,this._obj._resizeCanvas(t[0],t[1]),this._obj.transform.resize(t[0],t[1]),this._obj.painter.resize(t[0],t[1]),this._obj._update()},e.prototype.load=function(t){t&&t instanceof Function&&this._obj.on("load",t)},e.prototype.addImages=function(i,o){for(var r=this,n=0,t=0;t<i.length;t++)r._obj.hasImage(i[t][0])?n++:this._obj.loadImage(i[t][1],function(t,e){t||r._obj.hasImage(this.key)||r._obj.addImage(this.key,e),++n===i.length&&o&&o instanceof Function&&o(i)}.bind({key:i[t][0]}));n===i.length&&o&&o instanceof Function&&o(i)},e.prototype.addCanvasImage=function(t,e,i){this._obj.addImage(t,e,i)},e.prototype.triggerRepaint=function(){this._obj.triggerRepaint()},e.prototype.hasLayer=function(t){var e=t;"string"!=typeof t&&(e=t.id);for(var i=0;i<this._layers.length;i++)if(this._layers[i].id==e)return!0;return!1},e.prototype.addLayer=function(t,e,i){if(!this.hasLayer(t))if(this._obj.getLayer(i)||(i=null),"ZenMap.Layers.NPLayer"!==t.CLASS_NAME){t._map=this;e=e&&this._obj.getLayer("city_normal_region_green")?"city_normal_region_green":null;if("ZenMap.Layers.GaoDeLayer"===t.CLASS_NAME||"ZenMap.Layers.GoogleLayer"===t.CLASS_NAME||"ZenMap.Layers.VectorLayer"===t.CLASS_NAME||"ZenMap.Layers.ImageLayer"===t.CLASS_NAME){if(this._opts.isOnly2DMap)for(var o=0;o<t.style.layers.length;o++)"fill-extrusion"==t.style.layers[o].type&&(this.fill_extrusions[t.style.layers[o].id]=t.style.layers[o].paint["fill-extrusion-height"],t.style.layers[o].paint["fill-extrusion-height"]=0);if(this._obj.getStyle()){if("ZenMap.Layers.VectorLayer"===t.CLASS_NAME){t._opts.mineDataToken&&(zmapboxgl.mineDataToken=t._opts.mineDataToken);for(o=0;o<t._sourceID.length;o++)this._obj.addSource(t._sourceID[o],t.style.sources[t._sourceID[o]])}else this._obj.addSource(t._sourceID,t.style.sources[t._sourceID]);for(o=0;o<t.style.layers.length;o++)this._obj.addLayer(t.style.layers[o]);t._opts.isBaseLayer&&this.setBaseLayer(t)}else this._obj.setStyle(t.style);this._project=t._opts.ISWGS84?"WGS84":this._project}else if("ZenMap.Layers.TDMapLayer"===t.CLASS_NAME||"ZenMap.Layers.WMTSLayer"===t.CLASS_NAME){if(this._obj.getStyle()){this._obj.addSource(t._sourceID,t.style.sources[t._sourceID]);for(o=0;o<t.style.layers.length;o++)this._obj.addLayer(t.style.layers[o]);t._opts.isBaseLayer&&this.setBaseLayer(t)}else this._obj.setStyle(t.style);this._project=!1===t._opts.ISWGS84?"GCJ-02":"WGS84"}else if("ZenMap.Layers.BaiduTileLayer"===t.CLASS_NAME||"ZenMap.Layers.ArcgisTileLayer"===t.CLASS_NAME||"ZenMap.Layers.EzMapTileLayer"===t.CLASS_NAME)this._project="WGS84",t.setMap(this);else if("ZenMap.Layers.OverlayLayer"===t.CLASS_NAME)this._obj.addSource(t._layerID+"_source",t._source),t._tempSource&&this._obj.addSource(t._layerID+"_tempSource",t._tempSource),t.useCluster?(t._mapMarkerLayer&&this._obj.addLayer(t._mapMarkerLayer),this._obj.addLayer(t._clusterLayer),this._obj.addLayer(t._markerLayer),this._obj.addLayer(t._activeMarkerLayer),t._tempPointLayer&&this._obj.addLayer(t._tempPointLayer)):(this._obj.addLayer(t._polygonLayer),this._obj.addLayer(t._dashlineLayer),this._obj.addLayer(t._lineLayer),this._obj.getLayer("city_normal_building_id")&&(this._obj.moveLayer(t._polygonLayer.id,"city_normal_building_id"),this._obj.moveLayer(t._dashlineLayer.id,"city_normal_building_id"),this._obj.moveLayer(t._lineLayer.id,"city_normal_building_id")),this._obj.addLayer(t._markerLayer),this._obj.addLayer(t._mapMarkerLayer),this._obj.addLayer(t._pointLayer)),t._addEvents();else if("ZenMap.Layers.HeatMapLayer"===t.CLASS_NAME)this._obj.addSource(t._layerID+"_source",t._source),this._obj.addLayer(t._layer,e);else if("ZenMap.Layers.GeoJsonLayer"===t.CLASS_NAME){this._obj.addSource(t._layerID+"_source",t._source);for(o=0;o<t._layers.length;o++)this._obj.addLayer(t._layers[o],i)}else"ZenMap.Layers.ModelLayer"===t.CLASS_NAME?t._map=this:"ZenMap.Layers.ThreeLayer"===t.CLASS_NAME&&("city_normal_building_id"!==(e=e||i||"city_normal_building_id")||this._obj.getLayer("city_normal_building_id")||(e=null),this._obj.addLayer(t._customLayer,e),t._map=this);"defaultLayer"!==t.name&&this._layers.push(t)}else t.opts&&t.opts.layerInfo?this.initMapLayer(t.opts.layerInfo,t):this._addNPLayer(t,this.initMapLayer)},e.prototype.initMapLayer=function(t,e){if(t.layerType&&(e.layerType=t.layerType),t.fullExtent)for(var i=0;i<t.fullExtent.length;i++)e.fullExtent.push(t.fullExtent[i]);t.type&&(e.type=t.type),t.centerPoint&&(e.centerPoint=t.centerPoint);var o=null,r=e.url+"/getTile?";switch(e.layerType){case"tiandi":case"ZenMap.Layers.TDMapLayer":e._opts={mapType:e.type,centerPoint:e.centerPoint,fullExtent:e.fullExtent,topLevel:0,bottomLevel:18,isBaseLayer:e.isBaseLayer,zoomOffset:0},e._opts.fullExtent=[-180,-90,180,90],o=new ZenMap.Layers.TDMapLayer(r,e.name,e._opts);break;case"gaode":case"ZenMap.Layers.GaoDeLayer":e._opts={centerPoint:e.centerPoint,fullExtent:e.fullExtent,isBaseLayer:e.isBaseLayer},r+="X={x}&Y={y}&L={z}",o=new ZenMap.Layers.GaoDeLayer(r,e.name,e._opts);break;case"google":case"ZenMap.Layers.GoogleLayer":e._opts={isOnline:!0,centerPoint:e.centerPoint,fullExtent:e.fullExtent,isBaseLayer:e.isBaseLayer},r+="X={x}&Y={y}&L={z}",o=new ZenMap.Layers.GoogleLayer(r,e.name,e._opts);break;case"baidu":case"baiduVector":case"ZenMap.Layers.BaiduTileLayer":e._opts={centerPoint:e.centerPoint,fullExtent:e.fullExtent,isBaseLayer:e.isBaseLayer},"baiduVector"===e.layerType&&(r+="format=jsonp&",e._opts.isVectorLayer=!0),r+="X={x}&Y={y}&L={z}",o=new ZenMap.Layers.BaiduTileLayer(r,e.name,e._opts);break;case"streetmap":case"ZenMap.Layers.OSMLayer":r+="X={x}&Y={y}&L={z}",o=new ZenMap.Layers.OSMLayer(r,e.name,{isChina:!1,centerPoint:e.centerPoint,isBaseLayer:e.isBaseLayer});break;case"pgis":case"ZenMap.Layers.EzMapTileLayer":r+="X={x}&Y={y}&L={z}",o=new ZenMap.Layers.EzMapTileLayer(r,"",{centerPoint:e.centerPoint})}o&&(this.addLayer(o),e._sourceID=o._sourceID,e._layerID=o._layerID,e.id=o.id,e.style=o.style)},e.prototype._addNPLayer=function(layer,callback){OpenLayers.Request.GET({url:layer.url+"?f=pjson",async:!1,scope:this,success:function(reply){var layerInfo=eval("("+reply.responseText+")");callback.call(this,layerInfo,layer)}})},e.prototype.getDefaultLayer=function(){return this._defaultLayer},e.prototype.repaint=function(){this._obj.repaint=!0},e.prototype.getMapId=function(){},e.prototype.enableScrollWheelZoom=function(){this._obj.scrollZoom.enable()},e.prototype.disableScrollWheelZoom=function(){this._obj.scrollZoom.disable()},e.prototype.enableDoubleClickZoom=function(){this._obj.doubleClickZoom.enable()},e.prototype.disableDoubleClickZoom=function(){this._obj.doubleClickZoom.disable()},e.prototype.enableKeyboard=function(){this._obj.keyboard.enable()},e.prototype.disableKeyboard=function(){this._obj.keyboard.disable()},e.prototype.enableInertialDragging=function(){this._obj.dragPan.enable()},e.prototype.disableInertialDragging=function(){this._obj.dragPan.disable()},e.prototype.enableBoxSelect=function(r){this._obj.getCanvas().style.cursor="crosshair";var n=this;this._obj.boxZoom.enable(-1,function(t){var e=t[0],i={x:t[0].x,y:t[1].y},o=t[1],t={x:t[1].x,y:t[0].y},e=n.pixelToPoint(e),i=n.pixelToPoint(i),o=n.pixelToPoint(o),t=n.pixelToPoint(t);r(new ZenMap.Geometry.Polygon([e,i,o,t,e]))})},e.prototype.disableBoxSelect=function(){this._obj.boxZoom.disable(),this._obj.getCanvas().style.cursor=""},e.prototype.enableEditing=function(t){},e.prototype.disableEditing=function(){},e.prototype.enableMapOperation=function(){this._obj.scrollZoom.enable(),this._obj.dragPan.enable(),this._obj.dragRotate.enable(),this._obj.doubleClickZoom.enable()},e.prototype.disableMapOperation=function(){this._obj.scrollZoom.disable(),this._obj.dragPan.disable(),this._obj.dragRotate.disable(),this._obj.doubleClickZoom.disable()},e.prototype.setCursor=function(t){this._obj.getCanvasContainer().style.cursor=t},e.prototype.getCursor=function(){return this._obj.getCanvasContainer().style.cursor},e.prototype.setMinZoom=function(t){this._obj.setMinZoom(t)},e.prototype.setMaxZoom=function(t){this._obj.setMaxZoom(t)},e.prototype.enableLayerSwitcher=function(){},e.prototype.disableLayerSwitcher=function(){},e.prototype.getModifyFeature=function(){},e.prototype.getExtent=function(){var t=this._obj.getBounds(),e=t._sw,t=t._ne;return ZenMap.T.getExtent(this,new ZenMap.Geometry.Extent(e.lng,e.lat,t.lng,t.lat))},e.prototype.getRestrictedExtent=function(){var t=this._obj.getMaxBounds();if(t){var e=t._sw,t=t._ne;return ZenMap.T.getExtent(this,new ZenMap.Geometry.Extent(e.lng,e.lat,t.lng,t.lat))}return ZenMap.T.getExtent(this,new ZenMap.Geometry.Extent(-180,-90,180,90))},e.prototype.setRestrictedExtent=function(t){var e=ZenMap.T.setExtent(this,t),t=new zmapboxgl.LngLat(e.left,e.bottom),e=new zmapboxgl.LngLat(e.right,e.top),e=new zmapboxgl.LngLatBounds(t,e);this._obj.setMaxBounds(e)},e.prototype.getCenter=function(){var t=this._obj.getCenter(),t=ZenMap.T.getPoint(this,{lon:t.lng,lat:t.lat});return new ZenMap.Geometry.Point(t.lon,t.lat)},e.prototype.getDistance=function(t,e){t=[t.lon,t.lat],e=[e.lon,e.lat];return ZenMap.Utils.MapUtil.getDistance(t,e,{units:"meters"})},e.prototype.getSize=function(){var t=this._obj.getCanvas();return new ZenMap.Geometry.Size(t.width,t.height)},e.prototype.getZoom=function(){return this._obj.getZoom()},e.prototype.getMaxZoom=function(){return this._obj.getMaxZoom()},e.prototype.getMinZoom=function(){return this._obj.getMinZoom()},e.prototype.getProjection=function(){},e.prototype.centerAndZoom=function(t,e,i){this.setCenter(t,e,i)},e.prototype.pan=function(){this._obj.getCanvas().style.cursor="",this._obj.boxZoom.disable(),this._obj.dragPan.enable(),this.enableDoubleClickZoom()},e.prototype.panTo=function(t){this._obj.panTo([t.lon,t.lat])},e.prototype.panByPixel=function(t,e){this._obj.panBy([t,e])},e.prototype.reset=function(){this._obj.flyTo({center:this._obj._defaultCenter,zoom:this._opts.defaultZoom})},e.prototype.setCenter=function(t,e,i){e=e||this._obj.getZoom();var o=ZenMap.T.setPoint(this,t),r=(i=i||{}).bearing||0===i.bearing?i.bearing:this._obj.getBearing(),n=i.pitch||0===i.pitch?i.pitch:this._obj.getPitch();this._obj.dragRotate.isEnabled()||(n=r=0);var s=i.speed||1.2,a=i.curve||1,t=i.offset||[0,0],l=i.callback,h=this._obj.keyboard.isEnabled(),p=this._obj.dragPan.isEnabled(),c=this._obj.scrollZoom.isEnabled(),u=this._obj.dragRotate.isEnabled(),d=this._obj.doubleClickZoom.isEnabled();i.isOnlyFly&&(this.disableMapOperation(),this.disableKeyboard());var f=this;this._obj.flyTo({center:[o.lon,o.lat],zoom:e,bearing:r,pitch:n,speed:s,curve:a,offset:t,callBack:function(){i.isOnlyFly&&(h&&f.enableKeyboard(),d&&f._obj.doubleClickZoom.enable(),p&&f._obj.dragPan.enable(),c&&f._obj.scrollZoom.enable(),u&&f._obj.dragRotate.enable()),l&&l instanceof Function&&l()}})},e.prototype.enableRotateMap=function(){var e=this;e.rotateStatus=!0;var i=function(t){e.rotateStatus&&(e._obj.rotateTo(t/200%360,{duration:0}),requestAnimationFrame(i))};i(0)},e.prototype.disableRotateMap=function(){this.rotateStatus=!1},e.prototype.switchLayer=function(t){},e.prototype.isStyleLoaded=function(){return!!this._obj.getStyle()},e.prototype.switchLayerByName=function(t){},e.prototype.setZoom=function(t){this._obj.flyTo({zoom:t})},e.prototype.fullExtent=function(){this.reset()},e.prototype.zoomIn=function(){this._obj.boxZoom.enable(),this._obj.getCanvas().style.cursor="crosshair"},e.prototype.zoomOut=function(){this._obj.boxZoom.disable(),this._obj.boxZoom.enable(2),this._obj.getCanvas().style.cursor="crosshair"},e.prototype.zoomInOutStop=function(){this.disableBoxSelect()},e.prototype.zoomInFixed=function(){this._obj.zoomIn()},e.prototype.zoomOutFixed=function(){this._obj.zoomOut()},e.prototype.zoomToExtent=function(t,e,i){t=ZenMap.T.setExtent(this,t),t=[[t.left,t.bottom],[t.right,t.top]];e?this._obj.fitBounds(t,ZenMap.Utils.MapUtil.extend({padding:e},i)):this._obj.fitBounds(t,i)},e.prototype.jumpToExtent=function(t,e){t=ZenMap.T.setExtent(this,t),t=[[t.left,t.bottom],[t.right,t.top]],e=this._obj.cameraForBounds(t,{padding:e||0});this._obj.jumpTo(e)},e.prototype.getCenterZoomByExtent=function(t,e){t=ZenMap.T.setExtent(this,t),t=[[t.left,t.bottom],[t.right,t.top]],e=this._obj.cameraForBounds(t,{padding:e||0});return{center:ZenMap.T.getPoint(this,{lon:e.center.lng,lat:e.center.lat}),zoom:e.zoom}},e.prototype.zoomTo=function(t,e){t&&"ZenMap.Geometry.Point"===t.CLASS_NAME?this.setCenter(t,e):this.setZoom(e)},e.prototype.updateSize=function(){this._obj.resize()},e.prototype.centerAtMouse=function(){var e=this;this.addEventListener("click",function(t){t=new ZenMap.Geometry.Point(t.lon,t.lat);e.setCenter(t)})},e.prototype.addControl=function(t,e){if(t){if(this._controls)for(var i=0;i<this._controls.length;i++)if(this._controls[i].CLASS_NAME==t.CLASS_NAME)return;if("ZenMap.Controls.OverviewControl"===t.CLASS_NAME){e=e||"bottom-right";for(var o=this._obj.getMinZoom(),r=this._obj.getMaxZoom(),n=[],s=0,a=o;a<r;a+=3)s++,a==o?n.push([a-1,a-1,a]):n.push([a,o+s,o+s+1]);t._obj=new zmapboxgl.Minimap({center:[this._obj.getCenter().lng,this._obj.getCenter().lat],zoom:this._obj.getMinZoom(),zoomLevels:n}),t._obj._isOpen=t._isOpen,t._obj.viewChangeHandler=t.options.viewChangeHandler||function(){}}t._obj&&(this._obj.addControl(t._obj,e),t.visible=!0,t._map=this,null==e||void 0===e?("1"!=t.controlType&&"4"!=t.controlType||(t.anchor=ZenMap.CONTROL_ANCHOR_BOTTOM_LEFT),"2"==t.controlType&&(t.anchor=ZenMap.CONTROL_ANCHOR_TOP_RIGHT),"5"==t.controlType&&(t.anchor=ZenMap.CONTROL_ANCHOR_TOP_LEFT),"6"==t.controlType&&(t.anchor=ZenMap.CONTROL_ANCHOR_BOTTOM_RIGHT)):t.anchor=e,this._controls.push(t))}},e.prototype.removeControl=function(t){if(t&&this._controls)for(var e=0;e<this._controls.length;e++)if(this._controls[e].CLASS_NAME==t.CLASS_NAME){t._obj&&this._obj.removeControl(this._controls[e]._obj),this._controls.splice(e,1);break}},e.prototype.addJWMousePostion=function(){this._JMMouseControl=new ZenMap.Controls.MousePositionControl("ZenMap.CONTROL_TYPE_JWMOUSEPOSITION"),this.addControl(this._JMMouseControl)},e.prototype.removeJWMousePostion=function(){this._JMMouseControl&&this.removeControl(this._JMMouseControl)},e.prototype.activateMouseContext=function(t,e){this._mouseContextControl=new ZenMap.Controls.MouseContextControl(this,t,e),this._mouseContextControl.active()},e.prototype.deactivateMouseContext=function(){this._mouseContextControl&&(this._mouseContextControl.destroy(),this._mouseContextControl=null)},e.prototype.getMouseContextStyle=function(){if(this._mouseContextControl)return this._mouseContextControl.getContextStyle()},e.prototype.getMouseContextElement=function(){if(this._mouseContextControl)return this._mouseContextControl.getContext()},e.prototype.setMouseContextStyle=function(t){this._mouseContextControl&&this._mouseContextControl.setContextStyle(t)},e.prototype.getContainer=function(){return this._obj.getContainer()},e.prototype.addOverlay=function(t){if("ZenMap.Symbols.InfoWindow"==t.CLASS_NAME){for(var e=0;e<this._popupList.length;e++)if(this._popupList[e].id==t.id)return;t._map=this,t.open(),this._popupList.push(t)}else this._defaultLayer.addOverlay(t);this._overLays.push(t)},e.prototype.addOverlays=function(t){for(var e=0;e<t.length;e++)this.addOverlay(t[e])},e.prototype.removeOverlay=function(t){if(t){if("ZenMap.Symbols.InfoWindow"==t.CLASS_NAME){t._obj.remove();for(var e=0;e<this._popupList.length;e++)if(this._popupList[e].id==t.id){this._popupList.splice(e,1);break}t._map=null}else this._defaultLayer.removeOverlay(t);for(e=0;e<this._overLays.length;e++)this._overLays[e].id==t.id&&this._overLays.splice(e,1)}},e.prototype.removeOverlays=function(t){if(t instanceof Array&&0<t.length)for(var e=0;e<t.length;e++)this.removeOverlay(t[e])},e.prototype.removeOverlayList=function(t){if(t instanceof Array&&0<t.length)for(var e=0;e<t.length;e++)this._defaultLayer.removeOverlay(t[e])},e.prototype.getOverlays=function(){return this._overLays},e.prototype.clearOverlays=function(){this._defaultLayer.removeAllOverlays();for(var t=0;t<this._popupList.length;t++)this._popupList[t]&&(this._popupList[t]._obj&&this._popupList[t]._obj.remove(),this._popupList[t]._map=null);this._popupList=[],this._overLays=[]},e.prototype.getInfoWindows=function(){if(this._popupList)return this._popupList},e.prototype.closeAllInfoWindows=function(){if(this._popupList){for(var t=0;t<this._popupList.length;t++)this._popupList[t].close(),this._popupList[t]._map=null;this._popupList=[]}},e.prototype.addContextMenu=function(t){this._menuList=t,this._showhideContextMenu(!0)},e.prototype.removeContextMenu=function(){this._menuList=null,this._showhideContextMenu(!1)},e.prototype._showhideContextMenu=function(t){function e(t){t=i.pointToPixel(t),i._menu&&(i._menu.destroy(),i._menu=null),i._menu=new ZenMap.Menu(i,t,i._menuList),i._menu.show()}var i=this;t?this.addEventListener("rightclick",e):(this.removeEventListener("rightclick",e),this._menu&&(this._menu.destroy(),this._menu=null))},e.prototype.addLayers=function(t,e){if(e){var i={version:8,sources:{},sprite:ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/gaode",glyphs:ZenMap.Utils.BaseUtils.getHostPath()+"/lib/fonts/{fontstack}/{range}.pbf",layers:[]};this._obj.getStyle()&&(i=this._obj.getStyle());for(var o=0,r=0;r<t.length;r++){i.sources[t[r]._sourceID]=t[r].style.sources[t[r]._sourceID];for(var n=0;n<t[r].style.layers.length;n++)i.layers.splice(o,0,t[r].style.layers[n]),o++;(t[r]._map=this)._layers.push(t[r])}0<t.length&&!1===t[0]._opts.ISWGS84&&(this._project="GCJ-02"),this._obj.setStyle(i)}else for(r=0;r<t.length;r++)this.addLayer(t[r])},e.prototype.removeLayer=function(t){if(this.hasLayer(t)){if("string"==typeof t)for(var e=0;e<this._layers.length;e++)if(this._layers[e].id==t){t=this._layers[e];break}if("string"!=typeof t){if("ZenMap.Layers.OverlayLayer"===t.CLASS_NAME)t._removeEvents(),t.useCluster?(t._mapMarkerLayer&&this._obj.removeLayer(t._mapMarkerLayer.id),this._obj.removeLayer(t._clusterLayer.id),this._obj.removeLayer(t._markerLayer.id),this._obj.removeLayer(t._activeMarkerLayer.id),t._tempPointLayer&&this._obj.removeLayer(t._tempPointLayer.id)):(this._obj.removeLayer(t._markerLayer.id),this._obj.removeLayer(t._mapMarkerLayer.id),this._obj.removeLayer(t._pointLayer.id),this._obj.removeLayer(t._lineLayer.id),this._obj.removeLayer(t._dashlineLayer.id),this._obj.removeLayer(t._polygonLayer.id)),this._obj.removeSource(t._layerID+"_source"),this._obj.getSource(t._layerID+"_tempSource")&&this._obj.removeSource(t._layerID+"_tempSource");else if("ZenMap.Layers.HeatMapLayer"===t.CLASS_NAME)this._obj.removeLayer(t._layer.id),this._obj.removeSource(t._layerID+"_source");else if("ZenMap.Layers.GeoJsonLayer"===t.CLASS_NAME){for(e=0;e<t._layers.length;e++)this._obj.removeLayer(t._layers[e].id);this._obj.removeSource(t._layerID+"_source")}else if("ZenMap.Layers.BaiduLayer"===t.CLASS_NAME||"ZenMap.Layers.ArcgisTileLayer"===t.CLASS_NAME||"ZenMap.Layers.NPLayer"===t.CLASS_NAME&&"baidu"===t.layerType)t.clear();else if("ZenMap.Layers.ModelLayer"===t.CLASS_NAME)t.removeAllModels(),t._map=null;else if("ZenMap.Layers.ThreeLayer"===t.CLASS_NAME)this._obj.removeLayer(t._customLayer.id),t._map=null;else{for(var i=t.style.layers,e=0;e<i.length;e++)this._obj.removeLayer(i[e].id);if("ZenMap.Layers.VectorLayer"===t.CLASS_NAME)for(e=0;e<t._sourceID.length;e++)this._obj.removeSource(t._sourceID[e]);else this._obj.removeSource(t._sourceID)}for(e=0;e<this._layers.length;e++)if(t==this._layers[e]){this._layers.splice(e,1);break}}}},e.prototype.removeLayerByName=function(t){for(var e,i=0;i<this._layers.length;i++)if(this._layers[i].name==t){e=this._layers[i];break}e&&this.removeLayer(e)},e.prototype.getLayer=function(t){for(var e,i=0;i<this._layers.length;i++)if(this._layers[i].id==t){e=this._layers[i];break}return e},e.prototype.getLayerByName=function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e].name==t)return this._layers[e]},e.prototype.getVisibleLayers=function(){for(var t=[],e=0;e<this._layers.length;e++)1==this._layers[e].visible&&t.push(this._layers[e]);return t},e.prototype.setBaseLayer=function(t){var e=this._obj.style._order[0];"background"===e&&(e=1<this._obj.style._order.length?this._obj.style._order[1]:null);for(var i=0;i<t.style.layers.length;i++)this._obj.moveLayer(t.style.layers[i].id,e)},e.prototype.setVisibilityDefalutLayer=function(t){t?this._defaultLayer.show():this._defaultLayer.hide()},e.prototype.containFeatures=function(t,e,i){return(i&&"ZenMap.Layers.OverlayLayer"==i.CLASS_NAME?i:this._defaultLayer).containFeatures(t,e)},e.prototype.pixelToPoint=function(t){t=this._obj.unproject(t),t=ZenMap.T.getPoint(this,{lon:t.lng,lat:t.lat});return new ZenMap.Geometry.Point(t.lon,t.lat)},e.prototype.pointToPixel=function(t){return t=ZenMap.T.setPoint(this,t),this._obj.project({lng:t.lon,lat:t.lat})},e.prototype.containsPoint=function(t,e){return t.containsPoint(e)},e.prototype.getMapUnits=function(){},e.prototype.setDefaultMapCursor=function(t){},e.prototype.getAllLayers=function(){return this._layers},e.prototype.destroyMap=function(){this._obj&&(this._obj.remove(),this._obj=null),this._defaultLayer=null,this._controls=[],this._popupList=[],this._overLays=[],this._events=null},e.prototype.getTitleSize=function(){},e.prototype.getVersion=function(){return ZenMap.VERSIONNUMBER},e.prototype.setFallThrough=function(t){},e.prototype.setMapStyle=function(e,t,i,o){this.resetMapStyle();var r,n=this;if(e)if("string"==typeof e){switch(e){case"blue":r="style_blue";break;case"green":r="style_green";break;case"purple":r="style_purple"}var s=ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/"+r+".json";ZenMap.Utils.Request.Get(s,"",function(t){e=JSON.parse(t),n._setMapStyle(e,o)},function(){console.log("error")})}else e=e.styleJson||e,n._setMapStyle(e,o)},e.prototype._setMapStyle=function(t,e){for(var i=0;i<t.length;i++)if(this._obj.getLayer(t[i].featureType))for(var o in t[i])"featureType"!=o&&"elementType"!=o&&("visibility"===o||"icon-image"===o?this._obj.setLayoutProperty(t[i].featureType,o,t[i][o]):"iconVisibility"==o?this._obj.setPaintProperty(t[i].featureType,"icon-opacity","visible"==t[i][o]?1:0):"filter"==o?this._obj.setFilter(t[i].featureType,t[i][o]):("fill-color"==o&&(this._obj.setPaintProperty(t[i].featureType,"fill-outline-color",t[i][o]),this._obj.setPaintProperty(t[i].featureType,"fill-color",t[i][o])),this._obj.setPaintProperty(t[i].featureType,o,t[i][o])));e&&e instanceof Function&&e()},e.prototype.resetMapStyle=function(){for(var t=null,e=0;e<this._layers.length;e++)if("ZenMap.Layers.GaoDeLayer"===this._layers[e].CLASS_NAME&&"vector"==this._layers[e]._opts.type){t=this._layers[e];break}if(t)for(var i=t.style.layers,e=0;e<i.length;e++){for(var o in i[e].layout)i[e].layout.hasOwnProperty(o)&&this._obj.setLayoutProperty(i[e].id,o,i[e].layout[o]);for(var o in this._obj.setLayoutProperty(i[e].id,"visibility","visible"),i[e].paint)i[e].paint.hasOwnProperty(o)&&this._obj.setPaintProperty(i[e].id,o,i[e].paint[o])}},e.prototype.getMapTileUrl=function(t){},e.prototype.setLanguage=function(t){},e.prototype.setDistricts=function(t,e,i,o){},e.prototype.mapToImage=function(t){var e=this._obj.getCanvas(),i=new Image;i.src=e.toDataURL("image/png"),t?t(i):window.open("about:blank","image from canvas").document.write(i)},e.prototype.setPitch=function(t){this._obj.setPitch(t)},e.prototype.getPitch=function(){return this._obj.getPitch()},e.prototype.getBearing=function(){return this._obj.getBearing()},e.prototype.setBearing=function(t){return this._obj.setBearing(t)},e.prototype.rotateTo=function(t){return this._obj.rotateTo(t)},e.prototype.moveTo=function(t){var e=ZenMap.T.setPoint(this,t),i=ZenMap.T.setPoint(this,this.getCenter());cx=this.pointToPixel(e),cpx=this.pointToPixel(i);t=Math.abs(cx.x-cpx.x),i=Math.abs(cx.y-cpx.y);t>this._obj.getCanvas().width||i>this._obj.getCanvas().height?this._obj.jumpTo({center:[e.lon,e.lat]}):this.panTo(e)},e.prototype.resetNorth=function(){this._obj.resetNorth()},e.prototype.addEventListener=function(t,e,i){this._events.register(t,e,i)},e.prototype.removeEventListener=function(t,e){this._events.unregister(t,e)},e.prototype.isFullscreen=function(){return(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._mapContainer!==this._Fullscreen&&(this._Fullscreen=!this._Fullscreen),this._Fullscreen},e.prototype.setFullscreen=function(){this.isFullscreen()?this.exitFullscreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen()},e.prototype.exitFullscreen=function(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen()},e.prototype.setBackGroundColor=function(t){for(var e=Object.getOwnPropertyNames(this._obj.style._layers),i=0;i<e.length;i++){var o=this._obj.style._layers[e[i]];"background"===o.type&&this._obj.setPaintProperty(o.id,"background-color",t)}},e.prototype.jumpTo=function(t){var e=(t=t||{}).zoom||0===t.zoom?t.zoom:this._obj.getZoom(),i=t.center||0===t.center?t.center:this._obj.getCenter(),o=ZenMap.T.setPoint(this,i),r=t.bearing||0===t.bearing?t.bearing:this._obj.getBearing(),i=t.pitch||0===t.pitch?t.pitch:this._obj.getPitch();(t=t||{})&&this._obj.jumpTo({center:[o.lon,o.lat],zoom:e,bearing:r,pitch:i})},e.prototype.centerFly=function(r,n){var s=this;s.isStopFly=!1;var a=n&&n.speed?n.speed:.2,l=function(){var t,e,i,o;s.isStopFly||(t=ZenMap.T.setPoint(s,r),e=n&&(n.zoom||0===n.zoom)?n.zoom:s._obj.getZoom(),i=n&&(n.pitch||0===n.pitch)?n.pitch:s._obj.getPitch(),o=s._obj.getBearing(),360<(o+=a)&&(o-=360),s._obj.jumpTo({center:[t.lon,t.lat],zoom:e,bearing:o,pitch:i}),requestAnimationFrame(l))};l()},e.prototype.stopCenterFly=function(){this.isStopFly=!0},e.prototype.moveLayerTopest=function(t,e){t&&"ZenMap.Layers.OverlayLayer"==t.CLASS_NAME?t.useCluster?(this._obj.moveLayer(t._clusterLayer.id),this._obj.moveLayer(t._markerLayer.id),this._obj.moveLayer(t._activeMarkerLayer.id),t._tempPointLayer&&this._obj.moveLayer(t._tempPointLayer.id)):(e&&(this._obj.moveLayer(t._polygonLayer.id),this._obj.moveLayer(t._dashlineLayer.id),this._obj.moveLayer(t._lineLayer.id)),this._obj.moveLayer(t._markerLayer.id),this._obj.moveLayer(t._mapMarkerLayer.id),this._obj.moveLayer(t._pointLayer.id)):t&&"ZenMap.Layers.ThreeLayer"===t.CLASS_NAME&&this._obj.moveLayer(t._customLayer.id)},e.prototype.setMapLight=function(t){this._obj.setLight(t)},e.prototype.mapAnimaUpdata=function(){this._animaUpdata=!0,this._updata()},e.prototype._updata=function(){for(var t=0;t<this._obj.style._order.length;t++){var e=this._obj.style._order[t];-1==e.indexOf("city_normal")&&"background"!==e&&-1==e.indexOf("OverlayLayer")&&this._obj.style._layers[e].updateTransitions(this._obj._parameters)}this._animaUpdata&&window.requestAnimationFrame(this._updata.bind(this))},e.prototype.enablePitchMaxControl=function(t){!(this._obj.transform.pitchMaxControl=t)&&60<this._obj.getPitch()&&this._obj.setPitch(60)},e.prototype.enableSkyBox=function(){this._obj.getLayer("sky")||this._obj.addLayer({id:"sky",type:"sky",paint:{"sky-opacity":["interpolate",["linear"],["zoom"],0,0,5,.3,8,1],"sky-type":"atmosphere","sky-atmosphere-sun":this._getSunPosition(),"sky-atmosphere-sun-intensity":5}})},e.prototype._getSunPosition=function(t){var e=this._obj.getCenter(),e=ZenMap.Utils.SunCalc.getPosition(t||Date.now(),e.lat,e.lng);return[180+180*e.azimuth/Math.PI,90-180*e.altitude/Math.PI]},e.prototype.updateSunPosition=function(t){this._obj.getLayer("sky")&&(t=this._getSunPosition(t),this._obj.setPaintProperty("sky","sky-atmosphere-sun",t))},e.prototype.setFogColor=function(t){},e.prototype.setSkyColor=function(t){},e.prototype.backgroundVisible=function(t){for(var e=Object.getOwnPropertyNames(this._obj.style._layers),i=0;i<e.length;i++){var o=this._obj.style._layers[e[i]];"background"===o.type&&(t?this._obj.setPaintProperty(o.id,"background-opacity",1):this._obj.setPaintProperty(o.id,"background-opacity",0))}}}(),function(){var t=ZenMap.Overlay=function(){this.CLASS_NAME="ZenMap.Overlay",this.id=ZenMap.Utils.BaseUtils.uuid(),this.overlayType=ZenMap.OVERLAY_TYPE_UNKNOWN,this.title="",this._visible=!0,this._apiObj=null,this._data={},this.isEnableEdit=!1,this.isEnableContextMenu=!1,this.MenuList="",this._graphicZIndex=0,this._rotation=null,this.layer};t.prototype.isVisible=function(){return this._visible},t.prototype.show=function(){if(this.layer){this._visible=!0;var t=this.layer.getFeature(this.id);if("ZenMap.Symbols.Marker"==this.CLASS_NAME)t.properties["icon-opacity"]=this._visible?this._icon.opacity:0,t.properties["text-opacity"]=this._label?this._label._visible?this._label.getOpacity():0:null,t.properties.visible=!0;else if("ZenMap.Symbols.Label"==this.CLASS_NAME)t.properties["text-opacity"]=this.getOpacity(),t.properties.visible=!0;else if("ZenMap.Geometry.Polyline"==this.CLASS_NAME)t.properties.opacity=this._opacity,t.properties.visible=!0;else if(t instanceof Array)for(var e=0;e<t.length;e++)"Polygon"==t[e].geometry.type&&(t[e].properties.fillOpacity=this._fillOpacity),t[e].properties.opacity=this._opacity,t[e].properties.visible=!0;else t.properties.opacity=this._opacity,t.properties.fillOpacity=this._fillOpacity,t.properties.visible=!0;this.layer.refresh()}},t.prototype.hide=function(){if(this.layer){this._visible=!1;var t=this.layer.getFeature(this.id);if(this._modify&&(this._modify.disableEdit(),this._modify=null),"ZenMap.Symbols.Marker"==this.CLASS_NAME)t.properties["icon-opacity"]=0,t.properties["text-opacity"]=0,t.properties.visible=!1;else if("ZenMap.Symbols.Label"==this.CLASS_NAME)t.properties["text-opacity"]=0,t.properties.visible=!1;else if("ZenMap.Geometry.Polyline"==this.CLASS_NAME)t.properties.opacity=0,t.properties.visible=!1;else if(t instanceof Array)for(var e=0;e<t.length;e++)"Polygon"==t[e].geometry.type&&(t[e].properties.fillOpacity=0),t[e].properties.opacity=0,t[e].properties.visible=!1;else t.properties.opacity=0,t.properties.fillOpacity=0,t.properties.visible=!1;this.layer.refresh()}},t.prototype.flash=function(){this.flash2(3)},t.prototype.flash2=function(t){var e,i,o;this.layer&&this._visible&&(i=0,(e=this).timer&&(window.clearTimeout(this.timer),this.show(),this.timer=null),(o=function(){++i%2?e.hide():e.show(),e.timer=i<2*t?window.setTimeout(o,500):null})())},t.prototype.flashStop=function(){this.timer&&(window.clearTimeout(this.timer),this.show(),this.timer=null)},t.prototype.rotate=function(t){},t.prototype.resetIcon=function(t){},t.prototype.setData=function(t){this._data=t},t.prototype.getData=function(){return this._data},t.prototype.refresh=function(){this.layer&&this.layer.refresh()},t.prototype.showMenu=function(){this.isEnableContextMenu=!0},t.prototype.removeMenu=function(){this.isEnableContextMenu=!1},t.prototype.enableEditing=function(t,e){this.isEnableEdit=!0,this.virtualStyle=e?e.virtualStyle:null,e&&e.isActive&&this.layer&&this.layer._map&&this.layer._map._setActiveEditeOverlay(this)},t.prototype.disableEditing=function(){this.isEnableEdit=!1,this._modify&&(this._modify.disableEdit(),this._modify=null)},t.prototype.getTop=function(){},t.prototype.getId=function(){return this.id},t.prototype.getBounds=function(){},t.prototype.getLayer=function(){return this.layer},t.prototype.getCentroid=function(){},t.prototype.setZStyle=function(t){}}(),function(){var t=ZenMap.Layer=function(){this.CLASS_NAME="ZenMap.Layer",this.isAddToMap=!0,this.id=ZenMap.Utils.BaseUtils.uuid(),this.mapId=null,this.url,this.name="Not Set",this.visible=!0,this.minLevel=0,this.maxLevel=0,this._map=null};t.prototype.getUrl=function(){return this.url},t.prototype.isVisible=function(){return this.visible},t.prototype.setName=function(t){this.name=t},t.prototype.getName=function(){return this.name},t.prototype.setMinLevel=function(t){this.minLevel=t},t.prototype.getMinLevel=function(){return this.minLevel},t.prototype.setMaxLevel=function(t){this.maxLevel=t},t.prototype.getMaxLevel=function(){return this.maxLevel},t.prototype.setMap=function(t){this.map=t},t.prototype.getVisible=function(){return this.visible},t.prototype.refresh=function(){}}(),function(){var t=ZenMap.Geometry.Size=function(t,e){this.width=parseFloat(t),this.height=parseFloat(e),this.CLASS_NAME="ZenMap.Geometry.Size"};t.prototype.equals=function(t){return t instanceof ZenMap.Geometry.Size&&(this.width===t.width&&this.height===t.height)},t.prototype.toArray=function(){return[this.width,this.height]}}(),ZenMap.Control=function(){this.CLASS_NAME="ZenMap.Control",this.id=-1,this.controlType=ZenMap.CONTROL_TYPE_UNKNOWN,this.offset=new ZenMap.Geometry.Size(0,0),this.visible=!1,this.mapId=-1,this.anchor},ZenMap.Control.prototype={isVisible:function(){return this.visible},getOffset:function(){return this.position?new ZenMap.Geometry.Size(this.position.x,this.position.y):this.offset},getAnchor:function(){return this.anchor}},function(){var o,t=ZenMap.Menu=function(t,e,i){this._map=t,this._pixel=e,this._menuList=i,this._div=null,this._container=this._map.getContainer(),o=this};function s(t,e){this.name=t,this.func=e}t.prototype.draw=function(){var t=this,e=[];if(this._menuList instanceof Array){this._div=document.createElement("div"),this._div.style.left=this._pixel.x+"px",this._div.style.top=this._pixel.y+"px",this._div.style.left=this._pixel.x+"px",this._div.style.top=this._pixel.y+"px",this._div.style.position="absolute",this._div.style.backgroundColor="rgb(240, 240, 240)",this._div.style.opacity=1,this._div.style.border="0px";for(var i=0;i<this._menuList.length;i++){var o=this._menuList[i];for(j in o)o.hasOwnProperty(j)&&e.push(new s(j,o[j]));e.push(null)}if(0<e.length)for(i=0;i<e.length;i++){var r=document.createElement("div");this._div.appendChild(r);var n=e[i];null!=n?(r.style.width="100px",r.style.paddingLeft="8px",r.style.paddingRight="8px",r.style.paddingBottom="2px",r.style.paddingTop="2px",r.style.marginLeft="10px",r.style.fontSize="12px",r.innerHTML=n.name,r.func=n.func,r.onmouseover=function(){this.style.backgroundColor="#d3e3fe",this.style.cursor="pointer"},r.onmouseout=function(){this.style.backgroundColor="rgb(240, 240, 240)"},r.onclick=function(){t.hide(),this.func(t._map.pixelToPoint(t._pixel))}):r.style.border="#cccccc 1px solid"}}else this._div=this._menuList;return this._div},t.prototype.show=function(){this._div=this.draw(),this._container.appendChild(this._div),this._map.addEventListener("movestart",this.hide),this._map.addEventListener("click",this.hide)},t.prototype.hide=function(){o._div&&(o._container.removeChild(o._div),o._div=null),o._map.removeEventListener("movestart",o.hide),o._map.removeEventListener("click",o.hide)},t.prototype.destroy=function(){this._div&&(this._container.removeChild(this._div),this._div=null),this._pixel=null,this._menuList=null}}(),function(){var t=ZenMap.Controls.NavigationControl=function(t,e){this.controlType=ZenMap.CONTROL_TYPE_NAVIGATION,this.anchor=ZenMap.CONTROL_ANCHOR_TOP_LEFT,this.CLASS_NAME="ZenMap.Controls.NavigationControl",this._levelBarVisible=!1,this.opts=t||{},this._map=e,this.opts.position&&(this.position=this.opts.position),this._obj=new zmapboxgl.NavigationControl({position:this.position})};(t.prototype=new ZenMap.Control).showLevelBar=function(){},t.prototype.hideLevelBar=function(){},t.prototype.show=function(){this.visible||this._map&&this._map.addControl(this)},t.prototype.hide=function(){this.visible&&this._map&&this._map.removeControl(this)},t.prototype.setOffset=function(t){},t.prototype.setAnchor=function(t){}}(),function(){var t=ZenMap.Controls.ScaleControl=function(t){this.controlType=ZenMap.CONTROL_TYPE_SCALE,this.anchor=ZenMap.CONTROL_ANCHOR_BOTTOM_RIGHT,this._map=t,this._unit=ZenMap.MAP_UNITS_KILOMETERS,this.CLASS_NAME="ZenMap.Controls.ScaleControl",this._obj=new zmapboxgl.ScaleControl({maxWidth:100,unit:""})};(t.prototype=new ZenMap.Control).getUnit=function(){return this._unit},t.prototype.setUnit=function(t){},t.prototype.show=function(){this.visible||this._map&&this._map.addControl(this)},t.prototype.hide=function(){this.visible&&this._map&&this._map.removeControl(this)},t.prototype.setOffset=function(t){this.offset=t},t.prototype.setAnchor=function(t){}}(),function(){var t=ZenMap.Controls.OverviewControl=function(t){this.controlType=ZenMap.CONTROL_TYPE_OVERVIEW,this.anchor=ZenMap.CONTROL_ANCHOR_BOTTOM_RIGHT,this.options=t||{},this._isOpen=!1,this.CLASS_NAME="ZenMap.Controls.OverviewControl"};(t.prototype=new ZenMap.Control).changeView=function(t){this._isOpen=t,this._obj&&this._obj.setVisible(t)},t.prototype.show=function(){this.visible||this._map&&this._map.addControl(this)},t.prototype.hide=function(){this.visible&&this._map&&this._map.removeControl(this)},t.prototype.setOffset=function(t){},t.prototype.setAnchor=function(t){}}(),function(){var t=ZenMap.Controls.MousePositionControl=function(t,e){this.controlType=ZenMap.CONTROL_TYPE_MOUSEPOSITION,this.anchor=ZenMap.CONTROL_ANCHOR_BOTTOM_RIGHT,this.type=t,this._obj,this._map=e,this.CLASS_NAME="ZenMap.Controls.MousePositionControl",this._obj=new zmapboxgl.MouseControl};(t.prototype=new ZenMap.Control).show=function(){this.visible||this._map&&this._map.addControl(this)},t.prototype.hide=function(){this.visible&&this._map&&this._map.removeControl(this)}}(),function(){var t=ZenMap.Controls.CopyRightControl=function(t,e){this._map=e,this.controlType=ZenMap.CONTROL_TYPE_COPYRIGHT,this.anchor=ZenMap.CONTROL_ANCHOR_BOTTOM_LEFT,this.CLASS_NAME="ZenMap.Controls.CopyRightControl",this._info=t||"ZenView",this._obj=new zmapboxgl.LogoControl({logoInfo:this._info})};(t.prototype=new ZenMap.Control).setInfo=function(t){},t.prototype.getInfo=function(){return this._info},t.prototype.show=function(){this.visible||this._map&&this._map.addControl(this)},t.prototype.hide=function(){this.visible&&this._map&&this._map.removeControl(this)},t.prototype.setOffset=function(t){},t.prototype.setAnchor=function(t){}}(),function(){var t=ZenMap.Controls.MouseContextControl=function(t,e,i){this.controlType=ZenMap.CONTROL_TYPE_MOUSECONTEXT,this._map=t,this.context=e,this.offset=i,this.element,this.CLASS_NAME="ZenMap.Controls.MouseContextControl",this.element||(this.element=document.createElement("div"),this.element.style.zIndex=9999,this.element.style.left="2000px",this.element.filter="alpha(opacity=50)",this.element.style.width="130px",this.element.style.height="40px",this.element.style.border="1px solid red",this.element.style.background="#fff",this.element.style.position="absolute",this._map.getContainer().appendChild(this.element),this.context||(this.context="<span style='font-size: 12px'>,<br></span>",this.element.innerHTML=this.context),this.element.innerHTML=this.context)};(t.prototype=new ZenMap.Control).setContext=function(t){this.context="<span style='font-size: 12px'>"+t+"</span>",this.element&&(this.element.innerHTML=this.context)},t.prototype.getContext=function(){if(this.element)return this.element},t.prototype.setContextSize=function(t,e){this.element&&(this.element.style.width=t+"px",this.element.style.height=e+"px")},t.prototype.setContextStyle=function(t){if(t&&this.element)for(var e in t)this.element.style[e]=t[e]},t.prototype.getContextStyle=function(){if(this.element)return this.element.style},t.prototype._moveContextFun=function(t){var e;null==t||this.element&&(this.element.style.visibility="visible",e=t.offsetX+5,t=t.offsetY+3,this.offset||(this.offset={x:0,y:0}),this.element.style.top=t+this.offset.y+5+"px",this.element.style.left=e+this.offset.x+"px")},t.prototype._hideContextFun=function(t){this.element&&(this.element.style.visibility="hidden")},t.prototype.active=function(){this._map._obj.getCanvas().onmousemove=this._moveContextFun.bind(this),this._map._obj.getCanvas().onmouseout=this._hideContextFun.bind(this)},t.prototype.disactive=function(){this._map._obj.getCanvas().onmousemove=null,this._map._obj.getCanvas().onmouseout=null,this.element.style.visibility="hidden"},t.prototype.destroy=function(){this.disactive(),this.element.remove(),this._map=null}}(),function(){var t=ZenMap.Controls.ModifyFeatureControl=function(t,e){this.feature=e,this.mode=t,this._layer=e.layer||e.container.layer,this._map=this._layer._map,this._virtualStyle=ZenMap.Utils.MapUtil.extend(e.virtualStyle,{pointRadius:6,fillColor:"red",fillOpacity:1,strokeOpacity:1,strokeColor:"red",strokeWidth:1}),this.labelStyle=ZenMap.Utils.MapUtil.extend(e.labelStyle,{color:"#000000",fontSize:12,fontFamily:"Microsoft YaHei",opacity:1,offset:[0,-1]}),this.source={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.pointLayer={id:"ZenMap_edit_point",type:"circle",source:"edit_source",paint:{"circle-color":this._virtualStyle.fillColor,"circle-opacity":this._virtualStyle.fillOpacity,"circle-radius":this._virtualStyle.pointRadius,"circle-stroke-width":this._virtualStyle.strokeWidth,"circle-stroke-color":this._virtualStyle.strokeColor,"circle-stroke-opacity":this._virtualStyle.strokeOpacity},filter:[">","edgePoint",0]},this.middlePointLayer={id:"ZenMap_edit_middle_point",type:"circle",source:"edit_source",paint:{"circle-color":this._virtualStyle.fillColor,"circle-opacity":this._virtualStyle.fillOpacity,"circle-radius":this._virtualStyle.pointRadius,"circle-stroke-width":this._virtualStyle.strokeWidth,"circle-stroke-color":this._virtualStyle.strokeColor,"circle-stroke-opacity":this._virtualStyle.strokeOpacity},filter:["==","edgePoint",0]},this.labelLayer={id:"ZenMap_draw_label",type:"symbol",source:"edit_source",layout:{"text-field":"{title}","text-font":[this.labelStyle.fontFamily],"text-allow-overlap":!0,"text-offset":this.labelStyle.offset,"text-size":this.labelStyle.fontSize},paint:{"text-color":this.labelStyle.color,"text-opacity":this.labelStyle.opacity},filter:["all",["any",["==","$type","Point"],["==","type","label"]]]},this.enableEdit(),e._modify=this};t.prototype.enableEdit=function(){var n,s,e,r,a,l,h=this;this.action={},this._layer&&("ZenMap.Symbols.Marker"!==this.feature.CLASS_NAME&&"ZenMap.Geometry.Star"!==this.feature.CLASS_NAME&&"ZenMap.Symbols.Label"!==this.feature.CLASS_NAME&&"ZenMap.Symbols.ClusterMarker"!==this.feature.CLASS_NAME&&"ZenMap.Geometry.CircleSector"!==this.feature.CLASS_NAME&&(this._map._obj.addSource("edit_source",this.source),this._map._obj.addLayer(this.pointLayer),this._map._obj.addLayer(this.middlePointLayer),this.feature.showRadius&&this._map._obj.addLayer(this.labelLayer),this._editFeature(this.mode,this.feature),this._active=!0),e=function(t){if(h._map.isDrawing)h._map._obj.on("mouseup",l);else{if(t.preventDefault(),h._startPosition=t.point,"ZenMap.Symbols.Marker"!==h.feature.CLASS_NAME&&"ZenMap.Geometry.Star"!==h.feature.CLASS_NAME&&"ZenMap.Symbols.Label"!==h.feature.CLASS_NAME&&"ZenMap.Symbols.ClusterMarker"!==h.feature.CLASS_NAME){if(s=t.features[0].properties.index,n=t.features[0],("ZenMap.Geometry.Polyline"==h.feature.CLASS_NAME||"ZenMap.Geometry.Polygon"==h.feature.CLASS_NAME)&&0==n.properties.edgePoint){var t=ZenMap.T.getPoint(h._map,{lon:t.lngLat.lng,lat:t.lngLat.lat}),e=new ZenMap.Geometry.Point(t.lon,t.lat),i=h.feature.getPath();if(0<i.length&&0<i[0].length)for(var o=0;o<i.length;o++)0<i[o].length&&i[o].splice(s,0,e);else i.splice(s,0,e);h.feature.setPath(i)}}else h._active=!0,h.feature._events&&(h.feature._events.triggerEvt("mousedown",h.feature),h.feature._events.triggerEvt("dragstart",h.feature));h._map._obj.on("mousemove",r),h._map._obj.on("mouseup",a)}},r=function(t){if(t.point.x!=h._startPosition.x||t.point.y!=h._startPosition.y){var e=ZenMap.T.getPoint(h._map,{lon:t.lngLat.lng,lat:t.lngLat.lat});if(h._map._obj.getCanvas().style.cursor="pointer","ZenMap.Symbols.Marker"==h.feature.CLASS_NAME||"ZenMap.Geometry.Star"==h.feature.CLASS_NAME||"ZenMap.Symbols.Label"==h.feature.CLASS_NAME||"ZenMap.Symbols.ClusterMarker"==h.feature.CLASS_NAME)e=new ZenMap.Geometry.Point(e.lon,e.lat),h.feature.setPosition(e);else if("ZenMap.Geometry.Circle"==h.feature.CLASS_NAME){var i=h.feature.getCenter(),i=ZenMap.T.helper.webMoctorJW2PM(i.lon,i.lat),t=ZenMap.T.helper.webMoctorJW2PM(e.lon,e.lat),t=Math.sqrt(Math.pow(t.lon-i.lon,2)+Math.pow(t.lat-i.lat,2));h.feature.setRadius(t);i=h.feature.getExtent(),e=new ZenMap.Geometry.Point(i.right,h.feature.getCenter().lat);h._updatePoints(e,t)}else{h._map._obj.setLayoutProperty("ZenMap_edit_middle_point","visibility","none");var o=h.feature.getPath();if("ZenMap.Geometry.Rectangle"==h.feature.CLASS_NAME)1==n.properties.edgePoint?(o[s].lon=e.lon,o[s].lat=e.lat,0==s&&(o[o.length-1].lat=e.lat,o[o.length-1].lon=e.lon,o[o.length-2].lat=e.lat,o[s+1].lon=e.lon),1==s&&(o[s-1].lon=e.lon,o[o.length-1].lon=e.lon,o[s+1].lat=e.lat),2==s&&(o[s-1].lat=e.lat,o[s+1].lon=e.lon),3==s&&(o[s-1].lon=e.lon,o[0].lat=e.lat,o[o.length-1].lat=e.lat),4==s&&(o[s-1].lat=e.lat,o[0].lat=e.lat,o[0].lon=e.lon,o[1].lon=e.lon)):(1==s&&(o[0].lon=e.lon,o[o.length-1].lon=e.lon,o[s].lon=e.lon),2==s&&(o[s-1].lat=e.lat,o[s].lat=e.lat),3==s&&(o[s-1].lon=e.lon,o[s].lon=e.lon),4==s&&(o[s-1].lat=e.lat,o[s].lat=e.lat,o[0].lat=e.lat));else if(0<o.length&&0<o[0].length)for(var r=0;r<o.length;r++)o[r][s].lon=e.lon,o[r][s].lat=e.lat;else o[s].lon=e.lon,o[s].lat=e.lat;"ZenMap.Geometry.Polygon"==h.feature.CLASS_NAME&&0===s&&(o[o.length-1].lon=e.lon,o[o.length-1].lat=e.lat),h.feature.setPath(o),h._updatePoints(o)}h.feature._events&&h.feature._events.triggerEvt("draging",h.feature)}},a=function(t){"ZenMap.Symbols.Marker"!==h.feature.CLASS_NAME&&"ZenMap.Geometry.Star"!==h.feature.CLASS_NAME&&"ZenMap.Symbols.Label"!==h.feature.CLASS_NAME&&"ZenMap.Symbols.ClusterMarker"!==h.feature.CLASS_NAME?h._map._obj.setLayoutProperty("ZenMap_edit_middle_point","visibility","visible"):(h.disableEdit(),h._active=!1),h.feature._events&&h.feature._events.triggerEvt("dragend",h.feature),h._map._obj.off("mousedown",e),h._map._obj.off("mousemove",r),h._map._obj.off("mouseup",a)},"ZenMap.Symbols.Marker"==h.feature.CLASS_NAME||"ZenMap.Geometry.Star"==h.feature.CLASS_NAME||"ZenMap.Symbols.Label"==h.feature.CLASS_NAME||"ZenMap.Symbols.ClusterMarker"==h.feature.CLASS_NAME?(this._map._obj.off("mousedown",e),this._map._obj.on("mousedown",e)):(this._map._obj.on("mousedown","ZenMap_edit_point",e),this._map._obj.on("mousedown","ZenMap_edit_middle_point",e)),this._map._obj.on("click",l=function(t){h.action&&(h.disableEdit(),h._map._obj.off("click",l))}),this.action.downFun=e,this.action.upFun=a,this.action.moveFun=r,this.action.clickFun=l)},t.prototype.disableEdit=function(){this._active=!1,this._map._obj.getCanvas().style.cursor="",this.action&&(this._map._obj.off("mousedown","ZenMap_edit_point",this.action.downFun),this._map._obj.off("mousedown","ZenMap_edit_middle_point",this.action.downFun),this._map._obj.off("mousedown",this.action.downFun),this._map._obj.off("mousemove",this.action.moveFun),this._map._obj.off("mouseup",this.action.upFun),this._map._obj.off("click",this.action.clickFun)),this._map._obj.getLayer("ZenMap_edit_point")&&this._map._obj.removeLayer("ZenMap_edit_point"),this._map._obj.getLayer("ZenMap_edit_middle_point")&&this._map._obj.removeLayer("ZenMap_edit_middle_point"),this._map._obj.getLayer("ZenMap_draw_label")&&this._map._obj.removeLayer("ZenMap_draw_label"),this._map._obj.getSource("edit_source")&&this._map._obj.removeSource("edit_source"),this.action=null},t.prototype._editFeature=function(t,e){var i,o;"ZenMap.Geometry.Circle"==e.CLASS_NAME?(i=e.getExtent(),o=e.getCenter(),o=new ZenMap.Geometry.Point(i.right,o.lat),this._updatePoints(o,e._radius)):(e=e.getPath(),this._updatePoints(e))},t.prototype._updatePoints=function(t,e){if(this.source.data.features=[],"ZenMap.Geometry.Circle"==this.feature.CLASS_NAME){var i,o,r=ZenMap.T.setPoint(this._map,t);this.feature.showRadius&&(i={type:"Feature",geometry:{type:"Point",coordinates:[]},properties:{type:"label"}},o=this.feature.getCenter(),o=ZenMap.T.setPoint(this._map,o),i.geometry.coordinates=[o.lon,o.lat],i.properties.title="r="+Math.round(e)+"m",this.source.data.features.push(i)),this.source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[r.lon,r.lat]},properties:{edgePoint:1}})}else{var n=0;if("ZenMap.Geometry.Polygon"==this.feature.CLASS_NAME&&(n=1),0<t.length&&0<t[0].length)for(var s=0;s<t.length;s++){var a=ZenMap.T.setPoints(this._map,t[s]);this._updateTPoints(a,n)}else{r=ZenMap.T.setPoints(this._map,t);this._updateTPoints(r,n)}}this._map._obj.getSource("edit_source").setData(this.source.data)},t.prototype._updateTPoints=function(t,e){if(0<t.length)for(var i=0;i<t.length;i++)(1==e&&i<t.length-1||0===e)&&this.source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[t[i].lon,t[i].lat]},properties:{edgePoint:1,index:i}}),0<i&&this.source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[(t[i].lon+t[i-1].lon)/2,(t[i].lat+t[i-1].lat)/2]},properties:{edgePoint:0,index:i}})}}(),function(){var t=ZenMap.Controls.NorthControl=function(t,e){this.controlType=ZenMap.CONTROL_TYPE_NORTH,this.anchor=ZenMap.CONTROL_ANCHOR_TOP_LEFT,this.CLASS_NAME="ZenMap.Controls.NorthControl",this.opts=t||{},this._map=e,this.opts.position&&(this.position=this.opts.position),this._obj=new zmapboxgl.NorthControl({position:this.position})};(t.prototype=new ZenMap.Control).show=function(){this.visible||this._map&&this._map.addControl(this)},t.prototype.hide=function(){this.visible&&this._map&&this._map.removeControl(this)}}(),function(){var t=ZenMap.Geometry.Extent=function(t,e,i,o){if(this.sw,this.ne,this.top,this.left,this.bottom,this.right,2===arguments.length){if(!(t instanceof ZenMap.Geometry.Point&&e instanceof ZenMap.Geometry.Point))return ZenMap.Utils.BaseUtils("Argument exception");this.sw=t,this.ne=e}else 4===arguments.length&&(this.sw=new ZenMap.Geometry.Point(t,e),this.ne=new ZenMap.Geometry.Point(i,o));this.sw&&(this.left=this.sw.lon,this.bottom=this.sw.lat),this.ne&&(this.right=this.ne.lon,this.top=this.ne.lat),this.CLASS_NAME="ZenMap.Geometry.Extent"};(t.prototype=new ZenMap.Overlay).equals=function(t){return t instanceof ZenMap.Geometry.Extent&&(this.sw.lon===t.sw.lon&&this.sw.lat===t.sw.lat&&this.ne.lon===t.ne.lon&&this.ne.lat===t.ne.lat)},t.prototype.containsPoint=function(t){return this.sw.lon<=t.lon&&this.ne.lon>=t.lon&&this.sw.lat<=t.lat&&this.ne.lat>=t.lat},t.prototype.containsExtent=function(t){return this.left<=t.left&&this.bottom<=t.bottom&&this.right>=t.right&&this.top>=t.top},t.prototype.intersects=function(t,e){var i;(e=(e="boolean"==typeof e?{inclusive:e}:e)||{}).worldBounds?(i=this.wrapDateLine(e.worldBounds),t=t.wrapDateLine(e.worldBounds)):i=this,null==e.inclusive&&(e.inclusive=!0);var o,r,n,s=!1,a=i.left===t.right||i.right===t.left||i.top===t.bottom||i.bottom===t.top;return!e.inclusive&&a||(a=t.bottom>=i.bottom&&t.bottom<=i.top||i.bottom>=t.bottom&&i.bottom<=t.top,n=t.top>=i.bottom&&t.top<=i.top||i.top>t.bottom&&i.top<t.top,o=t.left>=i.left&&t.left<=i.right||i.left>=t.left&&i.left<=t.right,r=t.right>=i.left&&t.right<=i.right||i.right>=t.left&&i.right<=t.right,s=(a||n)&&(o||r)),e.worldBounds&&!s&&(o=(n=e.worldBounds).getWidth(),r=!n.containsBounds(i),n=!n.containsBounds(t),r&&!n?(t=t.add(-o,0),s=i.intersectsBounds(t,{inclusive:e.inclusive})):n&&!r&&(i=i.add(-o,0),s=t.intersectsBounds(i,{inclusive:e.inclusive}))),s},t.prototype.extend=function(t){},t.prototype.getCenter=function(){var t=(this.sw.lat+this.ne.lat)/2,e=(this.sw.lon+this.ne.lon)/2;return new ZenMap.Geometry.Point(e,t)},t.prototype.isEmpty=function(){return!1},t.prototype.getSouthWest=function(){return this.sw},t.prototype.getNorthEast=function(){return this.ne},t.prototype.toString=function(){return[this.left,this.bottom,this.right,this.top].join(",")}}(),function(){var t=ZenMap.Geometry.Point=function(t,e){this.overlayType=ZenMap.OVERLAY_TYPE_POINT,this.id=ZenMap.Utils.BaseUtils.uuid(),this.lon=parseFloat(t),this.lat=parseFloat(e),this.CLASS_NAME="ZenMap.Geometry.Point"};(t.prototype=new ZenMap.Overlay).equals=function(t){return t instanceof ZenMap.Geometry.Point&&(this.lon===t.lon&&this.lat===t.lat)},t.prototype.clone=function(){return new ZenMap.Geometry.Point(this.lon,this.lat)},t.prototype.transform=function(t,e){return this},t.prototype.toString=function(){return this.lon+","+this.lat},t.prototype.toGeoJson=function(){return{type:"Point",coordinates:[this.lon,this.lat]}}}(),function(){var t=ZenMap.Geometry.Star=function(t,e){this.overlayType=ZenMap.OVERLAY_TYPE_STAR,this.id=ZenMap.Utils.BaseUtils.uuid(),this._position=t,this.CLASS_NAME="ZenMap.Geometry.Star",this._radius=(e=e||{}).radius||5,this._color=e.color||"#ff0000",this._events=new ZenMap.Events(this,["click","mouseover","mouseout","draging","dragend","dragstart"]),this._visible=!0,this.opacity=1,this.title=""};(t.prototype=new ZenMap.Overlay).setPosition=function(t){this._position=t,this.layer&&(t=this.layer._map?ZenMap.T.setPoint(this.layer._map,this._position):this._position,this.layer.getFeature(this.id).geometry.coordinates=[t.lon,t.lat],this.layer.refresh())},t.prototype.setStyle=function(t){t&&t.radius&&(this._radius=t.radius),t&&t.color&&(this._color=t.color),this.layer&&((t=this.layer.getFeature(this.id)).properties["circle-radius"]=this._radius,t.properties.minRadius=this._radius,t.properties.maxRadius=this._radius,t.properties["circle-color"]=this._color,this.layer.refresh())}}(),function(){var t=ZenMap.Geometry.Pixel=function(t,e){this.x=t,this.y=e,this.CLASS_NAME="ZenMap.Geometry.Pixel"};t.prototype.equals=function(t){return t instanceof ZenMap.Geometry.Pixel&&(this.x===t.x&&this.y===t.y)},t.prototype.toString=function(){return this.x+","+this.y}}(),function(){var e=ZenMap.Utils.JSON=function(){this.indent="    ",this.space=" ",this.newline="\n",this.level=0,this.pretty=!1,this.nativeJSON=!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify),this.CLASS_NAME="ZenMap.Utils.JSON"};e.prototype.read=function(json,filter){var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{function walk(t,e){if(e&&"object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&(e[i]=walk(i,e[i]));return filter(t,e)}/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter&&(object=walk("",object)))}catch(e){}return object},e.prototype.write=function(t,e){this.pretty=!!e;var i=null,e=typeof t;if(this.serialize[e])try{i=!this.pretty&&this.nativeJSON?JSON.stringify(t):this.serialize[e].apply(this,[t])}catch(t){OpenLayers.Console.error("Trouble serializing: "+t)}return i},e.prototype.writeIndent=function(){var t=[];if(this.pretty)for(var e=0;e<this.level;++e)t.push(this.indent);return t.join("")},e.prototype.writeNewline=function(){return this.pretty?this.newline:""},e.prototype.writeSpace=function(){return this.pretty?this.space:""},e.prototype.serialize={object:function(t){if(null==t)return"null";if(t.constructor==Date)return this.serialize.date.apply(this,[t]);if(t.constructor==Array)return this.serialize.array.apply(this,[t]);var e,i,o,r=["{"];this.level+=1;var n=!1;for(e in t)t.hasOwnProperty(e)&&(i=OpenLayers.Format.JSON.prototype.write.apply(this,[e,this.pretty]),o=OpenLayers.Format.JSON.prototype.write.apply(this,[t[e],this.pretty]),null!=i&&null!=o&&(n&&r.push(","),r.push(this.writeNewline(),this.writeIndent(),i,":",this.writeSpace(),o),n=!0));return--this.level,r.push(this.writeNewline(),this.writeIndent(),"}"),r.join("")},array:function(t){var e,i=["["];this.level+=1;for(var o=0,r=t.length;o<r;++o)null!=(e=OpenLayers.Format.JSON.prototype.write.apply(this,[t[o],this.pretty]))&&(0<o&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),e));return--this.level,i.push(this.writeNewline(),this.writeIndent(),"]"),i.join("")},string:function(t){var o={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(t)?'"'+t.replace(/([\x00-\x1f\\"])/g,function(t,e){var i=o[e];return i||(i=e.charCodeAt(),"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16))})+'"':'"'+t+'"'},number:function(t){return isFinite(t)?String(t):"null"},boolean:function(t){return String(t)},date:function(t){function e(t){return t<10?"0"+t:t}return'"'+t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+"T"+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+'"'}}}(),function(){window.GeoJSON=function(){},window.GeoJSON.defaults={},window.GeoJSON.write=function(t){var e,i={type:"Feature",geometry:{},properties:t.getData()};return"ZenMap.Geometry.Point"==t.CLASS_NAME||"ZenMap.Symbols.Marker"==t.CLASS_NAME||"ZenMap.Geometry.Star"==t.CLASS_NAME?(e="ZenMap.Geometry.Point"==t.CLASS_NAME?t:t._position,i.geometry.type="Point",i.geometry.coordinates=[e.lon,e.lat]):"ZenMap.Geometry.Circle"==t.CLASS_NAME||"ZenMap.Symbols.CircleSector"==t.CLASS_NAME||"ZenMap.Geometry.Ellipse"==t.CLASS_NAME||"ZenMap.Geometry.Polygon"==t.CLASS_NAME||"ZenMap.Geometry.Rectangle"==t.CLASS_NAME?(i.geometry.type=t.polygonType||"Polygon",i.geometry.coordinates=t._getCoordinates()):"ZenMap.Geometry.Polyline"==t.CLASS_NAME&&(i.geometry.type=t._lineType,i.geometry.coordinates=t._getCoordinates()),(new ZenMap.Utils.JSON).write(i)},window.GeoJSON.read=function(t,e){e=e||"FeatureCollection";var i=null;if((i="string"==typeof t?ZenMap.Utils.JSON.prototype.read.apply(this,[t,null]):t)&&c(i,e))switch(i.type){case"MultiLineString":return a(i);case"LineString":return l(i);case"Point":return p(i);case"MultiPoint":return s(i);case"Polygon":return h(i);case"MultiPolygon":return n(i);case"Feature":return window.GeoJSON.read(i.geometry);case"Polyline":if(i.type="MultiLineString",0<(o=a(i)).length)return o[0];case"FeatureCollection":for(var o=[],r=0;r<i.features.length;r++)o.push(window.GeoJSON.read(i.features[r].geometry));return o}};var n=function(t){for(var e=[],i=0;i<t.coordinates.length;i++){for(var o=[],r=0;r<t.coordinates[i].length;r++){ps=[];for(var n=0;n<t.coordinates[i][r].length;n++){var s=t.coordinates[i][r][n];ps.push(new ZenMap.Geometry.Point(s[0],s[1]))}o.push(ps)}e.push(o)}var a=new ZenMap.Geometry.Polygon(e);return a.polygonType="MultiPolygon",a},s=function(t){for(var e=[],i=0;i<t.coordinates.length;i++)e.push(new ZenMap.Geometry.Point(t.coordinates[i][0],t.coordinates[i][1]));return e},a=function(t){for(var e=[],i=[],o=0;o<t.coordinates.length;o++){for(var e=[],r=0;r<t.coordinates[o].length;r++){var n=t.coordinates[o][r];e.push(new ZenMap.Geometry.Point(n[0],n[1]))}i.push(e)}return new ZenMap.Geometry.Polyline(i)},l=function(t){for(var e=[],i=0;i<t.coordinates.length;i++){var o=t.coordinates[i];e.push(new ZenMap.Geometry.Point(o[0],o[1]))}return new ZenMap.Geometry.Polyline(e)},h=function(t){var e=[];if(1==t.coordinates.length)for(var i=0;i<t.coordinates[0].length;i++){var o=t.coordinates[0][i];e.push(new ZenMap.Geometry.Point(o[0],o[1]))}else for(var r=0;r<t.coordinates.length;r++){for(var n=[],i=0;i<t.coordinates[r].length;i++){o=t.coordinates[r][i];n.push(new ZenMap.Geometry.Point(o[0],o[1]))}e.push(n)}return new ZenMap.Geometry.Polygon(e)},p=function(t){return new ZenMap.Geometry.Point(t.coordinates[0],t.coordinates[1])},c=function(t,e){var i=!1;switch(e){case"Geometry":-1==ZenMap.Utils.BaseUtils.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],t.type)||(i=!0);break;case"FeatureCollection":i=!0;break;default:t.type==e&&(i=!0)}return i}}(window.GeoJSON={}),ZenMap.Utils.extend=function(t){for(var e=1;e<arguments.length;e++){var i,o=arguments[e];for(i in o)t[i]=o[i]}return t},ZenMap.Utils.deepClone=function(t,e){var i,e=e||{},o=Object.prototype.toString;for(i in t)t.hasOwnProperty(i)&&("null"!==t[i]&&"object"==typeof t[i]?(e[i]="[object Array]"==o.call(t[i])?[]:{},e[i]=ZenMap.Utils.deepClone(t[i],e[i])):e[i]=t[i]);return e},ZenMap.Utils.MapUtil=function(){},ZenMap.Utils.MapUtil.ContainsPoint=function(t,e){function i(t,e,i,o){var r={x:t.lon-i.lon,y:t.lat-i.lat},n={x:e.lon-i.lon,y:e.lat-i.lat},s=l(r,a={x:o.lon-i.lon,y:o.lat-i.lat})*l(n,a),r={x:i.lon-t.lon,y:i.lat-t.lat},n={x:o.lon-t.lon,y:o.lat-t.lat},a={x:e.lon-t.lon,y:e.lat-t.lat};return s<=0&&l(r,a)*l(n,a)<=0}function l(t,e){return t.x*e.y-t.y*e.x}var o=e,r={lon:-1e3,lat:e.lat},n=0;if(t[0].lon){for(var s=0;s<t.length-1;s++)1==i(o,r,t[s],t[s+1])&&n++;return 1==i(o,r,t[t.length-1],t[0])&&n++,n%2!=0}for(var a=0,h=0;h<t.length;h++){for(var n=0,p=t[h],s=0;s<p.length-1;s++)1==i(o,r,p[s],p[s+1])&&n++;1==i(o,r,p[p.length-1],p[0])&&n++,n%2!=0&&a++}return a%2!=0},ZenMap.Utils.MapUtil.createRegularPolygon=function(t,e,i,o){var r,n,s=Math.PI*(1/i-.5);o&&(s+=o/180*Math.PI);for(var a=[],l=0;l<i;++l)n=s+2*l*Math.PI/i,r=t.lon+e*Math.cos(n),n=t.lat+e*Math.sin(n),a.push(new ZenMap.Geometry.Point(r,n));return a.push(a[0]),a},ZenMap.Utils.MapUtil.createCircleSector=function(t,e,i,o,r,n){var s,a,l=[];r=r*Math.PI/180,o=o*Math.PI/180,!1!==n&&l.push(new ZenMap.Geometry.Point(t.lon,t.lat));for(var h=0;h<i+1;h++)a=r+o/i*h,s=t.lon+e*Math.cos(a),a=t.lat+e*Math.sin(a),l.push(new ZenMap.Geometry.Point(s,a));return!1!==n&&l.push(new ZenMap.Geometry.Point(t.lon,t.lat)),l},ZenMap.Utils.MapUtil.createEllipsePolygon=function(t,e,i){var o=[],r=(t.lon+e.lon)/2,n=(t.lat+e.lat)/2,s=Math.sqrt(Math.pow(t.lon-e.lon,2)+Math.pow(t.lat-e.lat,2)),a=i/2,l=Math.sqrt(i/2*(i/2)-s/2*(s/2)),i=new ZenMap.Geometry.Point(t.lon,n),i=Math.sqrt(Math.pow(t.lon-i.lon,2)+Math.pow(t.lat-i.lat,2)),h=Math.asin(i/(s/2))/Math.PI*180;(t.lon-e.lon)*(t.lat-e.lat)<0&&(h=180-h);var p=new ZenMap.Geometry.Point(r,n),c=ZenMap.Utils.MapUtil.createRegularPolygon(p,l,60,h);h*=Math.PI/180;for(var u=0;u<c.length;++u){var d=null==(d=a/l)?1:d,f=p.lon+ +d*(c[u].lon-p.lon),g=p.lat+(c[u].lat-p.lat),d=Math.sqrt(Math.pow(f-p.lon,2)+Math.pow(g-p.lat,2)),f=h+Math.atan2(g-p.lat,f-p.lon);x1=p.lon+d*Math.cos(f),y1=p.lat+d*Math.sin(f),o.push(new ZenMap.Geometry.Point(x1,y1))}return o.push(new ZenMap.Geometry.Point(o[0].lon,o[0].lat)),o},ZenMap.Utils.MapUtil.createRectangle=function(t,e,i){var o=[],r=t.lon,n=t.lat+i,s=t.lon+e,a=n,i=s,e=t.lat;return o.push(new ZenMap.Geometry.Point(t.lon,t.lat)),o.push(new ZenMap.Geometry.Point(r,n)),o.push(new ZenMap.Geometry.Point(s,a)),o.push(new ZenMap.Geometry.Point(i,e)),o.push(new ZenMap.Geometry.Point(t.lon,t.lat)),o},ZenMap.Utils.MapUtil.getNewPointByCenter=function(t,e,i){var o=[],r=(e.lat-t.lat)/(e.lon-t.lon),n=Math.sqrt(Math.pow(t.lon-e.lon,2)+Math.pow(t.lat-e.lat,2)),t=i.lon-n/2/Math.sqrt(r*r+1),e=i.lat-r*(i.lon-t),i=n/Math.sqrt(r*r+1)+t,n=r*(i-t)+e,r=Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2));return console.log(r),o.push(new ZenMap.Geometry.Point(t,e)),o.push(new ZenMap.Geometry.Point(i,n)),o},ZenMap.Utils.MapUtil.extend=function(t,e){var i={};if(t)for(var o in t)i[o]||(i[o]=t[o]);if(e)for(var o in e)i[o]||(i[o]=e[o]);return i},ZenMap.Utils.MapUtil.colorRgb=function(t){if((t=t.toLowerCase())&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){if(4===t.length){for(var e="#",i=1;i<4;i+=1)e+=t.slice(i,i+1).concat(t.slice(i,i+1));t=e}for(var o=[],i=1;i<7;i+=2)o.push(parseInt("0x"+t.slice(i,i+2)));return o}var r=(t=t.substr(t.indexOf("(")+1,t.indexOf(")")-t.indexOf("(")-1)).split(",");return[parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])]},ZenMap.Utils.MapUtil.colorHex=function(t){if(/^(rgb|RGB)/.test(t)){for(var e=t.replace(/(?:(|)|rgb|RGB)*/g,"").split(","),i="#",o=0;o<e.length;o++){var r=Number(e[o]).toString(16);"0"===(r=r<10?"0"+r:r)&&(r+=r),i+=r}return i=7!==i.length?t:i}if(!/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t))return t;var n=t.replace(/#/,"").split("");if(6===n.length)return t;if(3===n.length){for(var s="#",o=0;o<n.length;o+=1)s+=n[o]+n[o];return s}},ZenMap.Utils.MapUtil.gradientColor=function(t,e,i,o){startRGB=ZenMap.Utils.MapUtil.colorRgb(t),startR=startRGB[0],startG=startRGB[1],startB=startRGB[2],endRGB=ZenMap.Utils.MapUtil.colorRgb(e),endR=endRGB[0],endG=endRGB[1],endB=endRGB[2],sR=(endR-startR)/i,sG=(endG-startG)/i,sB=(endB-startB)/i;for(var r,n=[],s=0;s<i;s++)o?n.push({r:parseInt(sR*s+startR),g:parseInt(sG*s+startG),b:parseInt(sB*s+startB)}):(r=ZenMap.Utils.MapUtil.colorHex("rgb("+parseInt(sR*s+startR)+","+parseInt(sG*s+startG)+","+parseInt(sB*s+startB)+")"),n.push(r));return n},ZenMap.Utils.MapUtil.getArea=function(t){var h=6378137;function r(t){var e=0;if(t&&0<t.length){e+=Math.abs(o(t[0]));for(var i=1;i<t.length;i++)e-=Math.abs(o(t[i]))}return e}function o(t){var e,i,o,r,n,s,a=0,l=t.length;if(2<l){for(s=0;s<l;s++)n=s===l-2?(o=l-2,r=l-1,0):s===l-1?(o=l-1,r=0,1):(r=(o=s)+1,s+2),e=t[o],i=t[r],a+=(p(t[n][0])-p(e[0]))*Math.sin(p(i[1]));a=a*h*h/2}return a}function p(t){return t*Math.PI/180}function e(t,n,s){var a=s;return function(t,e){for(var i,o,r,n,s,a,l,h,p,c=0,u="FeatureCollection"===t.type,d="Feature"===t.type,f=u?t.features.length:1,g=0;g<f;g++){for(s=u?t.features[g].geometry:d?t.geometry:t,l=u?t.features[g].properties:d?t.properties:{},h=u?t.features[g].bbox:d?t.bbox:void 0,p=u?t.features[g].id:d?t.id:void 0,n=(a=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<n;o++)if(null!==(r=a?s.geometries[o]:s))switch(r.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":e(r,c,l,h,p);break;case"GeometryCollection":for(i=0;i<r.geometries.length;i++)e(r.geometries[i],c,l,h,p);break;default:throw new Error("Unknown Geometry Type")}else e(null,c,l,h,p);c++}}(t,function(t,e,i,o,r){a=0===e&&void 0===s?t:n(a,t,e,i,o,r)}),a}return e(t,function(t,e){return t+function t(e){var i,o=0;switch(e.type){case"Polygon":return r(e.coordinates);case"MultiPolygon":for(i=0;i<e.coordinates.length;i++)o+=r(e.coordinates[i]);return o;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(i=0;i<e.geometries.length;i++)o+=t(e.geometries[i]);return o}}(e)},0)},ZenMap.Utils.MapUtil.getDistance=function(t,e,i){var o=6371008.8,n={meters:o,metres:o,millimeters:1e3*o,millimetres:1e3*o,centimeters:100*o,centimetres:100*o,kilometers:o/1e3,kilometres:o/1e3,miles:o/1609.344,nauticalmiles:o/1852,inches:39.37*o,yards:o/1.0936,feet:3.28084*o,radians:1,degrees:o/111325};function r(t){if(!t)throw new Error("obj is required");var e;if(t.length?e=t:t.coordinates?e=t.coordinates:t.geometry&&t.geometry.coordinates&&(e=t.geometry.coordinates),e)return function t(e){if(1<e.length&&l(e[0])&&l(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return t(e[0]);throw new Error("coordinates must only contain numbers")}(e),e;throw new Error("No valid coordinates")}function s(t){if(null==t)throw new Error("degrees is required");return t%360*Math.PI/180}function a(t){if(!t)throw new Error("obj is required");t=r(t);if(1<t.length&&l(t[0])&&l(t[1]))return t;throw new Error("Coordinate is not a valid Point")}function l(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}return function(t,e,i){if(!(r=i=i||{})||r.constructor!==Object)throw new Error("options is invalid");var o=i.units,r=a(t),t=s((i=a(e))[1]-r[1]),e=s(i[0]-r[0]),r=s(r[1]),i=s(i[1]),i=Math.pow(Math.sin(t/2),2)+Math.pow(Math.sin(e/2),2)*Math.cos(r)*Math.cos(i);return function(t,e){if(null==t)throw new Error("radians is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var i=n[e||"kilometers"];if(!i)throw new Error(e+" units is invalid");return t*i}(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),o)}(t,e,i)},ZenMap.Utils.MapUtil.lineDistance=function(t,e){function h(t){return t&&t.constructor===Object}function d(t,e,i){if(!h(i=i||{}))throw new Error("options is invalid");var o=i.bbox,r=i.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");o&&function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!f(t))throw new Error("bbox must only contain numbers")})}(o),r&&function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}(r);i={type:"Feature"};return r&&(i.id=r),o&&(i.bbox=o),i.properties=e||{},i.geometry=t,i}function f(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}return function(t,i){if(!h(i=i||{}))throw new Error("options is invalid");if(!t)throw new Error("geojson is required");return a=s=0,l=!(n=function(t,e){e=e.geometry.coordinates;return t+ZenMap.Utils.MapUtil.getDistance(e[0],e[1],i)}),function(t,u){!function(t,a){!function(t,e){var i,o,r,n,s,a,l,h,p,c,u=0,d="FeatureCollection"===t.type,f="Feature"===t.type,g=d?t.features.length:1;for(i=0;i<g;i++){for(a=d?t.features[i].geometry:f?t.geometry:t,h=d?t.features[i].properties:f?t.properties:{},p=d?t.features[i].bbox:f?t.bbox:void 0,c=d?t.features[i].id:f?t.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<s;r++)if(null!==(n=l?a.geometries[r]:a))switch(n.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":e(n,u,h,p,c);break;case"GeometryCollection":for(o=0;o<n.geometries.length;o++)e(n.geometries[o],u,h,p,c);break;default:throw new Error("Unknown Geometry Type")}else e(null,u,h,p,c);u++}}(t,function(t,i,o,e,r){var n,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return a(d(t,o,{bbox:e,id:r}),i,0),0}switch(s){case"MultiPoint":n="Point";break;case"MultiLineString":n="LineString";break;case"MultiPolygon":n="Polygon"}t.coordinates.forEach(function(t,e){a(d({type:n,coordinates:t},o),i,e)})})}(t,function(s,a,l){var t,n,h,e,p,c=0;!s.geometry||"Point"!==(t=s.geometry.type)&&"MultiPoint"!==t&&(n=function(t,e,i,o,r,n){t=function(t,e,i){if(!t)throw new Error("coordinates is required");if(t.length<2)throw new Error("coordinates must be an array of two or more positions");if(!f(t[0][1])||!f(t[0][1]))throw new Error("coordinates must contain numbers");return d({type:"LineString",coordinates:t},e,i)}([t,e],s.properties);return u(t,a,l,n,c),c++,e},p=h,function t(e,i,o){if(null!==e)for(var r,n,s,a,l,h,p,c,u=0,d=0,f=e.type,g="FeatureCollection"===f,y="Feature"===f,m=g?e.features.length:1,_=0;_<m;_++){l=(c=!!(p=g?e.features[_].geometry:y?e.geometry:e)&&"GeometryCollection"===p.type)?p.geometries.length:1;for(var v=0;v<l;v++){var b=0,x=0;if(null!==(a=c?p.geometries[v]:p)){h=a.coordinates;var w=a.type;switch(u=!o||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":i(h,d,_,b,x),d++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<h.length;r++)i(h[r],d,_,b,x),d++,"MultiPoint"===w&&b++;"LineString"===w&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<h.length;r++){for(n=0;n<h[r].length-u;n++)i(h[r][n],d,_,b,x),d++;"MultiLineString"===w&&b++,"Polygon"===w&&x++}"Polygon"===w&&b++;break;case"MultiPolygon":for(r=0;r<h.length;r++){for("MultiPolygon"===w&&(x=0),n=0;n<h[r].length;n++){for(s=0;s<h[r][n].length-u;s++)i(h[r][n][s],d,_,b,x),d++;x++}b++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)t(a.geometries[r],i,o);break;default:throw new Error("Unknown Geometry Type")}}}}}(s,function(t,e,i,o,r){p=0===e&&void 0===h?t:n(p,t,e,i,o,r)},e))})}(t,function(t,e,i,o,r){a=!1===l&&void 0===s?t:n(a,t,e,i,o,r),l=!0}),a;var n,s,a,l}(t,e)},ZenMap.GisToolKit=function(){},ZenMap.GisToolKit.prototype.getDistanceByProjection=function(t,e){return t},ZenMap.GisToolKit.prototype.getDistanceByProjection2=function(t,e){return t},ZenMap.GisToolKit.prototype.getPlatDistanceByProjection2=function(t,e){return t},ZenMap.GisToolKit.prototype.getPlatDistanceByProjection=function(t,e){return t},ZenMap.GisToolKit.prototype.covertLine=function(t,e){e=e||160;var i=[];i.push(t[0]);for(var o,r,n,s,a,l=1;l<t.length-1;l++){var h,p,c=i[i.length-1],u=t[l];c.lon==u.lon&&c.lat==u.lat||(h=t[l+1],c=ZenMap.T.helper.webMoctorJW2PM(c.lon,c.lat),p=ZenMap.T.helper.webMoctorJW2PM(u.lon,u.lat),h=ZenMap.T.helper.webMoctorJW2PM(h.lon,h.lat),o=c.lon-p.lon,r=c.lat-p.lat,n=h.lon-p.lon,s=h.lat-p.lat,a=void 0,a=o*n+r*s,n=o*s-r*n,h=a||n?Math.atan2(n,a)/Math.PI*180:90,p=(c.lon-p.lon)*(c.lon-p.lon)+(c.lat-p.lat)*(c.lat-p.lat),(0<=h&&h<e||h<0&&0-e<h)&&10<p&&i.push(u))}return i.push(t[t.length-1]),i},function(){var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function i(t){var e,i,o,r,n="",s=0,a=/[^A-Za-z0-9\+\/\=]/g;if(!t||a.exec(t))return t;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");e=l.indexOf(t.charAt(s++))<<2|(i=l.indexOf(t.charAt(s++)))>>4,i=(15&i)<<4|(a=l.indexOf(t.charAt(s++)))>>2,o=(3&a)<<6|(r=l.indexOf(t.charAt(s++))),n+=String.fromCharCode(e),64!=a&&(n+=String.fromCharCode(i)),64!=r&&(n+=String.fromCharCode(o)),s<t.length;);return n}function o(t){return"string"==typeof t}function r(t,e){return isNaN(t)&&(t=i(t),t=isNaN(t)?0:t),o(t)&&(t=parseFloat(t)),isNaN(e)&&(e=i(e),e=isNaN(e)?0:e),o(e)&&(e=parseFloat(e)),{lng:this.lng=t,lat:this.lat=e}}var t={$O:6370996.81,lG:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],Au:[75,60,45,30,15,0],fP:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],iG:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],p:null,j:void 0,JD:function(t,e,i){for(;i<t;)t-=i-e;for(;t<e;)t+=i-e;return t},ND:function(t,e,i){return null!=e&&(t=Math.max(t,e)),t=null!=i?Math.min(t,i):t},Fb:function(t){var e;t.lng=t.lon||t.lng,t.lat=t.lat,t.lng=this.JD(t.lng,-180,180),t.lat=this.ND(t.lat,-74,74);for(var i=new r(t.lng,t.lat),o=0;o<this.Au.length;o++)if(i.lat>=this.Au[o]){e=this.iG[o];break}if(!e)for(o=0;o<this.Au.length;o++)if(i.lat<=-this.Au[o]){e=this.iG[o];break}return t=new r((t=this.gK(t,e)).lng,t.lat),new ZenMap.Geometry.Point(t.lng,t.lat)},gK:function(t,e){if(t&&e){var i=e[0]+e[1]*Math.abs(t.lng),o=Math.abs(t.lat)/e[9],o=e[2]+e[3]*o+e[4]*o*o+e[5]*o*o*o+e[6]*o*o*o*o+e[7]*o*o*o*o*o+e[8]*o*o*o*o*o*o;return new r(i=i*(t.lng<0?-1:1),o=o*(t.lat<0?-1:1))}},ToLL:function(t){if(t===this.p||t===this.j)return new r(0,0);t.lng=t.lon||t.lng;for(var e,i=new r(Math.abs(t.lng),Math.abs(t.lat)),o=0;o<this.lG.length;o++)if(i.lat>=this.lG[o]){e=this.fP[o];break}return t=this.gK(t,e),new ZenMap.Geometry.Point(t.lng.toFixed(6),t.lat.toFixed(6))}},n=ZenMap.T={};n.Baidu=t;var s=new function(){var v=3.141592653589793,b=.006693421622965943,o=52.35987755982988,x=6378245,t={transform:function(t,e){t=parseFloat(t),e=parseFloat(e);var i={};if(this.outofChina(e,t))return i.lon=t,i.lat=e,i;var o=this.transformLat(t-105,e-35),r=this.transformLon(t-105,e-35),n=e/180*v,s=Math.sin(n),s=1-b*s*s,a=Math.sqrt(s),o=180*o/(x*(1-b)/(s*a)*v),r=180*r/(x/a*Math.cos(n)*v),o=e+o;return i.lon=t+r,i.lat=o,i},outofChina:function(t,e){return e<72.004||137.8347<e||(t<.8293||55.8271<t)},transformLat:function(t,e){var i=2*t-100+3*e+.2*e*e+.1*t*e+.2*Math.sqrt(Math.abs(t));return i+=2*(20*Math.sin(6*t*v)+20*Math.sin(2*t*v))/3,i+=2*(20*Math.sin(e*v)+40*Math.sin(e/3*v))/3,i+=2*(160*Math.sin(e/12*v)+320*Math.sin(e*v/30))/3},transformLon:function(t,e){e=300+t+2*e+.1*t*t+.1*t*e+.1*Math.sqrt(Math.abs(t));return e+=2*(20*Math.sin(6*t*v)+20*Math.sin(2*t*v))/3,e+=2*(20*Math.sin(t*v)+40*Math.sin(t/3*v))/3,e+=2*(150*Math.sin(t/12*v)+300*Math.sin(t/30*v))/3},gcj2wgs:function(t,e){for(var i=t,o=e,r=0;++r<1e3;){var n=i-105,s=o-35,a=300+n+2*s+.1*n*n+.1*n*s+.1*Math.sqrt(Math.abs(n));a+=2*(20*Math.sin(6*n*v)+20*Math.sin(2*n*v))/3,a+=2*(20*Math.sin(n*v)+40*Math.sin(n/3*v))/3,a+=2*(150*Math.sin(n/12*v)+300*Math.sin(n*v/30))/3;var l=2*n-100+3*s+.2*s*s+.1*n*s+.2*Math.sqrt(Math.abs(n));l+=2*(20*Math.sin(6*n*v)+20*Math.sin(2*n*v))/3,l+=2*(20*Math.sin(s*v)+40*Math.sin(s/3*v))/3,l+=2*(160*Math.sin(s/12*v)+320*Math.sin(s*v/30))/3;var h=0,h=0<n?.05/Math.sqrt(n):n<0?-.05/Math.sqrt(-n):0,p=v*n,c=v*s,u=1+.2*n+.1*s+h+2*(120*v*Math.cos(6*p)+40*v*Math.cos(2*p)+(20*v*Math.cos(p)+40*v/3*Math.cos(p/3))+(12.5*v*Math.cos(p/12)+10*v*Math.cos(p/30)))/3,d=2+.1*n,f=2+.1*s+2*h+2*(120*v*Math.cos(6*p)+40*v*Math.cos(2*p))/3,g=3+.4*s+.1*n+2*(20*v*Math.cos(c)+40*v/3*Math.cos(c/3)+(40*v/3*Math.cos(c/12)+32*v/3*Math.cos(c/30)))/3,y=o/180*v,m=Math.sin(y),_=Math.cos(y),h=1-b*m*m,p=Math.sqrt(h),s=x/p,n=-v*b*m*_/(180*p),c=-x*n/h,y=v*s*_,u=1+180*u/y,m=180*d/y-180*a*v*(c*_-v*s*m/180)/(y*y),y=v*s*(1-b),f=180*h*f/y,c=1+180*(s*(g*h+2*l*p*n)-l*h*c)/(s*y),s=this.transform(i,o),y=t-s.lon,c=(y*f-(e-s.lat)*u)/(m*f-c*u),u=(y-m*c)/u;if(Math.abs(c)<1e-9&&Math.abs(u)<1e-9)break;i+=u,o+=c}return{lon:i,lat:o}},bd_encrypt:function(t,e){var i=t,t=e,e=Math.sqrt(i*i+t*t)+2e-5*Math.sin(t*o),i=Math.atan2(t,i)+3e-6*Math.cos(i*o);return{lon:e*Math.cos(i)+.0065,lat:e*Math.sin(i)+.006}},bd_decrypt:function(t,e){var i=t-.0065,t=e-.006,e=Math.sqrt(i*i+t*t)-2e-5*Math.sin(t*o),i=Math.atan2(t,i)-3e-6*Math.cos(i*o);return{lon:e*Math.cos(i),lat:e*Math.sin(i)}},webMoctorJW2PM:function(t,e){var i={lon:0,lat:0};t=parseFloat(t),e=parseFloat(e),i.lon=t/180*20037508.34,(e=85.05112<e?85.05112:e)<-85.05112&&(e=-85.05112),e=Math.PI/180*e;e=Math.PI/4+e/2;return i.lat=20037508.34*Math.log(Math.tan(e))/Math.PI,i},inverseMercator:function(t,e){return{lon:t=180*t/20037508.34,lat:e=180/Math.PI*(2*Math.atan(Math.exp(e/20037508.34*Math.PI))-Math.PI/2)}}};return t};(n.helper=s).H=r,n.setPoint=function(t,i){var o,i={lon:i.lon,lat:i.lat};return ZenMap.ISPOINTCONVERT&&("baidu"==t._project&&(e=ZenMap.ISWGS84?s.transform(i.lon,i.lat):i,e=s.bd_encrypt(e.lon,e.lat),e=ZenMap.T.Baidu.Fb(e),e.lon=.5972238881227077*e.lon,e.lat=.5936023592948914*e.lat,i={lon:(o=t._mapCRS&&t._mapCRS.coordtransform.toViewCoord(e.lon,e.lat))[0],lat:o[1]}),"GCJ-02"==t._project&&ZenMap.ISWGS84&&(e=s.transform(i.lon,i.lat),i=e),"WGS84"!=t._project||ZenMap.ISWGS84||(e=s.gcj2wgs(i.lon,i.lat),i=e),ZenMap.USETDMAP&&(o=i.lon/180*20037508.34,t=i.lat/i.lon*o,i=s.inverseMercator(o,t))),i},n.setPoints=function(t,e){for(var i=[],o=0;o<e.length;o++)i.push(ZenMap.T.setPoint(t,e[o]));return i},n.getPoint=function(t,i){var o,i={lon:i.lon,lat:i.lat};return ZenMap.ISPOINTCONVERT&&(ZenMap.USETDMAP&&(o=s.webMoctorJW2PM(i.lon,i.lat),i.lon=180*o.lon/20037508.34,i.lat=180*o.lat/20037508.34),"baidu"==t._project&&(o=t._mapCRS&&t._mapCRS.coordtransform.fromViewCoord(i.lon,i.lat),i.lon=1.6744139340162103*o[0],i.lat=o[1]*(33554432/19917990),i=ZenMap.T.Baidu.ToLL(i),e=s.bd_decrypt(i.lon,i.lat),ZenMap.ISWGS84&&(e=s.gcj2wgs(e.lon,e.lat)),i=e),"GCJ-02"==t._project&&ZenMap.ISWGS84&&(e=s.gcj2wgs(i.lon,i.lat),i=e),"wgs84"!=t._project||ZenMap.ISWGS84||(e=s.transform(i.lon,i.lat),i=e)),i},n.getPoints=function(t,e){for(var i=[],o=0;o<e.length;o++)i.push(ZenMap.T.getPoint(t,e[o]));return i},n.setExtent=function(t,e){var i=ZenMap.T.setPoint(t,{lon:e.left,lat:e.top}),e=ZenMap.T.setPoint(t,{lon:e.right,lat:e.bottom});return new ZenMap.Geometry.Extent(i.lon,e.lat,e.lon,i.lat)},n.getExtent=function(t,e){var i=ZenMap.T.getPoint(t,{lon:e.left,lat:e.top}),e=ZenMap.T.getPoint(t,{lon:e.right,lat:e.bottom});return new ZenMap.Geometry.Extent(i.lon,e.lat,e.lon,i.lat)}}(),ZenMap.Utils.Request=function(){},ZenMap.Utils.Request.Post=function(t,e,i,o,r){var n=new XMLHttpRequest;n.open("POST",t),n.setRequestHeader("Content-Type",e["Content-Type"]),n.onreadystatechange=function(){4==n.readyState&&(200==n.status||304==n.status?o&&o(n.responseText):r&&r("HTTP"+n.status))},n.send(i)},ZenMap.Utils.Request.Get=function(t,e,i,o,r){var n=new XMLHttpRequest,e=this.getParams(e);n.open("GET",t+"?"+e,r=void 0===r?!0:r),n.onreadystatechange=function(){4==n.readyState&&(200==n.status||304==n.status?i&&i(n.responseText):o&&o("HTTP"+n.status))},n.send(null)},ZenMap.Utils.Request.getParams=function(t){var e,i=[];for(e in t){var o,r=t[e];if(null!=r&&"function"!=typeof r){if("object"==typeof r&&r.constructor==Array){for(var n,s=[],a=0,l=r.length;a<l;a++)n=r[a],s.push(encodeURIComponent(null==n?"":n));o=s.join(",")}else o=encodeURIComponent(r);i.push(encodeURIComponent(e)+"="+o)}}return i.join("&")},window.WKT={},window.WKT=function(){},window.WKT.defaults={},window.WKT.write=function(t){var e=new ZenMap.Utils.WKT,i=[];if(t instanceof Array){for(var o=0;o<t.length;o++){var r=window.WKT._createFeature(t[o]);i.push(r)}return e.write(i)}return e.write(window.WKT._createFeature(t))},window.WKT._createFeature=function(t){if(t){var e={type:"Feature",geometry:{},properties:{}};return"ZenMap.Geometry.Star"==t.CLASS_NAME||"ZenMap.Symbols.Marker"==t.CLASS_NAME||"ZenMap.Symbols.Label"==t.CLASS_NAME?(e.geometry.type="Point",e.geometry.coordinates=[t._position.lon,t._position.lat]):"ZenMap.Geometry.Point"==t.CLASS_NAME?(e.geometry.type="Point",e.geometry.coordinates=[t.lon,t.lat]):("ZenMap.Geometry.Polyline"==t.CLASS_NAME?e.geometry.type=t._lineType:e.geometry.type=t.polygonType,e.geometry.coordinates=t._getCoordinates()),e}},window.WKT.read=function(t){return(new ZenMap.Utils.WKT).read(t)},function(){var t=ZenMap.Utils.WKT=function(){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/}};t.prototype.read=function(t){var e;t=t.replace(/[\n\r]/g," ");var i=this.regExes.typeStr.exec(t);return i&&(t=i[1].toLowerCase(),i=i[2],this.parse[t]&&(e=this.parse[t].apply(this,[i]))),e},t.prototype.write=function(t){var e,i,o=t.constructor==Array?(e=t,!0):!(e=[t]),r=[];o&&r.push("GEOMETRYCOLLECTION(");for(var n=0,s=e.length;n<s;++n)o&&0<n&&r.push(","),i=e[n].geometry,r.push(this.extractGeometry(i));return o&&r.push(")"),r.join("")},t.prototype.extractGeometry=function(t){var e=t.type.toLowerCase();if(!this.extract[e])return null;var i="collection"==e?"GEOMETRYCOLLECTION":e.toUpperCase();return"POLYGON"==i?i+"(("+this.extract[e].apply(this,[t])+"))":i+"("+this.extract[e].apply(this,[t])+")"},t.prototype.extract={point:function(t){return t.type&&"Point"==t.type?t.coordinates[0]+" "+t.coordinates[1]:t[0]+" "+t[1]},linestring:function(t){for(var e=[],i=0,o=t.coordinates.length;i<o;++i)e.push(this.extract.point.apply(this.extract.linestring,[t.coordinates[i]]));return e.join(",")},multilinestring:function(t){for(var e=[],i=0,o=t.coordinates.length;i<o;++i){for(var r=[],n=0;n<t.coordinates[i].length;n++)r.push(this.extract.point.apply(this.extract.linestring,[t.coordinates[i][n]]));e.push("("+r.join(",")+")")}return e.join(",")},polygon:function(t){for(var e=[],i=0,o=t.coordinates[0].length;i<o;++i)e.push(this.extract.point.apply(this.extract.polygon,[t.coordinates[0][i]]));return e.join(",")},multipolygon:function(t){for(var e=[],i=0,o=t.coordinates.length;i<o;++i){for(var r=[],n=0;n<t.coordinates[i].length;n++){for(var s=[],a=0;a<t.coordinates[i][n].length;a++)s.push(this.extract.point.apply(this.extract.multipolygon,[t.coordinates[i][n][a]]));r.push("("+s.join(",")+")")}e.push("("+r.join(",")+")")}return e.join(",")}},t.prototype.parse={point:function(t){t=t.trim().split(this.regExes.spaces);return new ZenMap.Geometry.Point(t[0],t[1])},linestring:function(t){for(var e=t.trim().split(","),i=[],o=0,r=e.length;o<r;++o){var n=e[o].trim().split(this.regExes.spaces);i.push(new ZenMap.Geometry.Point(parseFloat(n[0]),parseFloat(n[1])))}return new ZenMap.Geometry.Polyline(i)},multilinestring:function(t){for(var e=[],i=t.trim().split(this.regExes.parenComma),o=0,r=i.length;o<r;++o){for(var n=[],s=i[o].replace(this.regExes.trimParens,"$1").trim().split(","),a=0,l=s.length;a<l;++a){point=s[a].replace(this.regExes.trimParens,"$1");var h=point.trim().split(this.regExes.spaces);n.push(new ZenMap.Geometry.Point(parseFloat(h[0]),parseFloat(h[1])))}e.push(n)}return new ZenMap.Geometry.Polyline(e)},polygon:function(t){for(var e=[],i=t.trim().split(this.regExes.parenComma),o=0,r=i.length;o<r;++o){var n=[];ring=i[o].replace(this.regExes.trimParens,"$1");for(var s=ring.trim().split(","),a=0,l=s.length;a<l;++a){point=s[a].replace(this.regExes.trimParens,"$1");var h=point.trim().split(this.regExes.spaces);n.push(new ZenMap.Geometry.Point(parseFloat(h[0]),parseFloat(h[1])))}e.push(n)}return 1===i.length?new ZenMap.Geometry.Polygon(e[0]):new ZenMap.Geometry.Polygon(e)},multipolygon:function(t){for(var e=[],i=t.trim().split(this.regExes.parenComma),o=0,r=i.length;o<r;++o){var n=[];ring=i[o].replace(this.regExes.trimParens,"$1");for(var s=ring.trim().split(","),a=0,l=s.length;a<l;++a){point=s[a].replace(this.regExes.trimParens,"$1");var h=point.trim().split(this.regExes.spaces);n.push(new ZenMap.Geometry.Point(parseFloat(h[0]),parseFloat(h[1])))}e.push(n)}return 1===i.length?new ZenMap.Geometry.Polygon(e[0]):new ZenMap.Geometry.Polygon(e)}}}(),ZenMap.POLYGON_EVENT_CLICK="click",ZenMap.POLYGON_EVENT_DBLCLICK="dblclick",ZenMap.POLYGON_EVENT_RIGHT_CLICK="rightclick",ZenMap.POLYGON_EVENT_MOUSE_DOWN="mousedown",ZenMap.POLYGON_EVENT_MOUSE_UP="mouseup",ZenMap.POLYGON_EVENT_MOUSE_OVER="mouseover",ZenMap.POLYGON_EVENT_MOUSE_OUT="mouseout",ZenMap.POLYGON_EVENT_LINE_UPDATE="lineupdate",ZenMap.POLYGON_EVENT_MODIFIED="dragend",ZenMap.POLYGON_EVENT_DRAG_START="dragstart",ZenMap.POLYGON_EVENT_DRAG_END="dragend",function(){var t=ZenMap.Geometry.Polygon=function(t,e){this.CLASS_NAME="ZenMap.Geometry.Polygon",this.overlayType=ZenMap.OVERLAY_TYPE_POLYGON,this.id=ZenMap.Utils.BaseUtils.uuid(),this._points=t,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this._fillOpacity=.5,this._lineStyle=ZenMap.LINE_TYPE_SOLID,this._enableEditing=!1,this._enableClicking=!0,this._events=new ZenMap.Events(this,["click","mouseover","mouseout","draging","dragend","dragstart"]),this._text="",this.fontSize=12,this.title="",this._graphicZIndex=-1,this.polygonType=this.getType(),e&&(e.color&&(this._color=e.color),e.fillColor&&(this._fillColor=e.fillColor),void 0!==e.weight&&(this._weight=e.weight),0<=e.opacity&&e.opacity<=1&&(this._opacity=e.opacity),0<=e.fillOpacity&&e.fillOpacity<=1&&(this._fillOpacity=e.fillOpacity),e.lineStyle&&(this._lineStyle=e.lineStyle),e.enableEditing&&(this._enableEditing=e.enableEditing),e.enableClicking&&(this._enableClicking=e.enableClicking),e.text&&(this._text=e.text),e.pointRadius&&(this._pointRadius=e.pointRadius))};(t.prototype=new ZenMap.Overlay).getType=function(){return!(0!=this._points.length&&this._points[0]instanceof Array)||1<this._points.length&&ZenMap.Utils.MapUtil.ContainsPoint(this._points[0],this._points[1][0])?"Polygon":"MultiPolygon"},t.prototype.setPath=function(t){if(this._points=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()}},t.prototype.getPath=function(){return this._points},t.prototype.getExtent=function(){var t,e,i,o;if("MultiPolygon"!==this.polygonType)for(var r=0;r<this._points.length;r++)if(this._points[r]instanceof Array)for(var n=this._points[r],s=0;s<n.length;s++)(!t||t>n[s].lon)&&(t=n[s].lon),(!e||e>n[s].lat)&&(e=n[s].lat),(!i||i<n[s].lon)&&(i=n[s].lon),(!o||o<n[s].lat)&&(o=n[s].lat);else(!t||t>this._points[r].lon)&&(t=this._points[r].lon),(!e||e>this._points[r].lat)&&(e=this._points[r].lat),(!i||i<this._points[r].lon)&&(i=this._points[r].lon),(!o||o<this._points[r].lat)&&(o=this._points[r].lat);else for(var a=0;a<this._points.length;a++)for(s=0;s<this._points[a].length;s++)for(n=this._points[a][s],r=0;r<n.length;r++)(!t||t>n[r].lon)&&(t=n[r].lon),(!e||e>n[r].lat)&&(e=n[r].lat),(!i||i<n[r].lon)&&(i=n[r].lon),(!o||o<n[r].lat)&&(o=n[r].lat);return new ZenMap.Geometry.Extent(t,e,i,o)},t.prototype.setColor=function(t){if(this._color=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.color=this._color,this.layer.refresh()}},t.prototype.getColor=function(){return this._color},t.prototype.setFillColor=function(t){if(this._fillColor=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.fillColor=this._fillColor,this.layer.refresh()}},t.prototype.getFillColor=function(){return this._fillColor},t.prototype.setOpacity=function(t){if(!(t<0||1<t)&&(this._opacity=t,this.layer)){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.opacity=this._opacity,this.layer.refresh()}},t.prototype.getOpacity=function(){return this._opacity},t.prototype.setFillOpacity=function(t){if(this._fillOpacity=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.fillOpacity=this._fillOpacity,this.layer.refresh()}},t.prototype.getFillOpacity=function(){return this._fillOpacity},t.prototype.setWeight=function(t){if(!(t<0)&&(this._weight=t,this.layer)){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.width=this._weight,this.layer.refresh()}},t.prototype.getWeight=function(){return this._weight},t.prototype.setLineStyle=function(t){if(this._lineStyle=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,this.layer.refresh()}},t.prototype.getLineStyle=function(){return this._lineStyle},t.prototype.setStyle=function(t){if(t&&(this._color=t.color||this._color,this._fillColor=t.fillColor||this._fillColor,this._fillOpacity=t.fillOpacity||this._fillOpacity,this._lineStyle=t.lineStyle||this._lineStyle,this._weight=t.weight||this._weight,this._opacity=t.opacity||this._opacity,this.layer)){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.color=this._color,e.properties.fillColor=this._fillColor,e.properties.fillOpacity=this._fillOpacity,e.properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,e.properties.width=this._weight,e.properties.opacity=this._opacity,this.layer.refresh()}},t.prototype.setPositionAt=function(t,e){if(!(!this._points||t>this._points.length-1||t<0)&&(this._points.splice(t,0,e),this.layer)){var i=this.layer.getFeature(this.id);if(i instanceof Array)for(var o=0;o<i.length;o++)"Polygon"==i[o].geometry.type&&(i=i[o]);i.geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()}},t.prototype.addEventListener=function(t,e){this._events.register(t,e)},t.prototype.removeEventListener=function(t,e){this._events.unregister(t,e)},t.prototype.setFillText=function(t,e,i){if(this._text){if(this.layer){var o=this.layer.getFeature(this.id);if(o instanceof Array)for(var r=0;r<o.length;r++)"Point"==o[r].geometry.type&&(o=o[r]);i=i||{},o.properties.title=t||this._text.getContent(),o.properties["text-size"]=e||this._text._fontSize,o.properties["text-opacity"]=i.opacity||this._text.getOpacity(),o.properties["text-color"]=i.color||this._text._color}}else{this._text=new ZenMap.Symbols.Label(t),e&&this._text.setFontSize(e),i&&this._text.setStyle(i);var n=ZenMap.T.setPoint(this.layer._map,this.getCenter());this.layer._source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[n.lon,n.lat]},properties:{id:this.id,title:t||"","text-offset":i.offset||[0,0],"text-opacity":i.opacity||1,"text-size":e||12,"text-color":i.color||"red",visible:this._visible}})}this.layer.refresh()},t.prototype.getArea=function(){var t;if(this.layer){if((t=this.layer.getFeature(this.id))instanceof Array)for(var e=0;e<t.length;e++)"Polygon"==t[e].geometry.type&&(t=t[e])}else t={type:"Feature",geometry:{type:"Polygon",coordinates:this._getCoordinates()}};return ZenMap.Utils.MapUtil.getArea(t)/1e6},t.prototype._containsPoint=function(t){if("ZenMap.Geometry.Point"===this._points[0].CLASS_NAME||void 0!==this._points[0].lon||void 0!==this._points[0].lat)return ZenMap.Utils.MapUtil.ContainsPoint(this._points,t);for(var e=0,i=0;i<this._points.length;i++){var o=this._points[i];"ZenMap.Geometry.Point"!==o[0].CLASS_NAME&&void 0===o[0].lon&&void 0===o[0].lat||ZenMap.Utils.MapUtil.ContainsPoint(o,t)&&e++}return e%2!=0},t.prototype.containsPoint=function(t){var e=this.getExtent();return!(t.lon<e.left||t.lon>e.right||t.lat<e.bottom||t.lat>e.top)&&this._containsPoint(t)},t.prototype.containsPoints=function(t){for(var e=[],i=this.getExtent(),o=0;o<t.length;o++){var r=t[o].getPosition();r.lon<i.left||r.lon>i.right||r.lat<i.bottom||r.lat>i.top||this._containsPoint(r)&&e.push(t[o])}return e},t.prototype._getCoordinates=function(t){var e=this._points,i=[];if(0==e.length)return i;if("MultiPolygon"!==this.polygonType)if(0<e.length&&null==e[0].length){for(var o=[],r=0;r<e.length;r++){var n=t?ZenMap.T.setPoint(t,e[r]):e[r];o.push([n.lon,n.lat])}i.push(o)}else for(r=0;r<e.length;r++){for(var s=t?ZenMap.T.setPoints(t,e[r]):e[r],o=[],a=0;a<s.length;a++)o.push([s[a].lon,s[a].lat]);i.push(o)}else for(r=0;r<e.length;r++){for(var l=[],h=0;h<e[r].length;h++){o=[];if((s=e[r][h])instanceof Array){s=t?ZenMap.T.setPoints(t,e[r][h]):e[r][h];for(a=0;a<s.length;a++)o.push([s[a].lon,s[a].lat]);l.push(o)}else s=t?ZenMap.T.setPoint(t,e[r][h]):e[r][h],l.push([s.lon,s.lat])}i.push(l)}return i},t.prototype.getCenter=function(){var t=this.getExtent();return new ZenMap.Geometry.Point((t.left+t.right)/2,(t.top+t.bottom)/2)}}(),ZenMap.POLYLINE_EVENT_CLICK="click",ZenMap.POLYLINE_EVENT_DBLCLICK="dblclick",ZenMap.POLYLINE_EVENT_RIGHT_CLICK="rightclick",ZenMap.POLYLINE_EVENT_MOUSE_DOWN="mousedown",ZenMap.POLYLINE_EVENT_MOUSE_UP="mouseup",ZenMap.POLYLINE_EVENT_MOUSE_OVER="mouseover",ZenMap.POLYLINE_EVENT_MOUSE_OUT="mouseout",ZenMap.POLYLINE_EVENT_LINE_UPDATE="lineupdate",ZenMap.POLYLINE_EVENT_LINE_MODIFIED="dragend",ZenMap.POLYLINE_EVENT_DRAG_START="dragstart",ZenMap.POLYLINE_EVENT_DRAG_END="dragend",function(){var t=ZenMap.Geometry.Polyline=function(t,e){this.CLASS_NAME="ZenMap.Geometry.Polyline",this.overlayType=ZenMap.OVERLAY_TYPE_POLYLINE,this.id=ZenMap.Utils.BaseUtils.uuid(),this._points=t,this._color="#ff0000",this._weight=2,this._opacity=1,this.title="",this._fillColor="#ee9900",this._fillOpacity=.5,this._pointRadius=5,this._lineStyle=ZenMap.LINE_TYPE_SOLID,this._arrowStyle=ZenMap.LINE_ARROW_TYPE_NULL,this._enableEditing=!1,this._enableClicking=!0,this._events=new ZenMap.Events(this,["click","mouseover","mouseout","mousemove","draging","dragend","dragstart"]),this._lineType=this._points&&0<this._points.length&&this._points[0]instanceof Array?"MultiLineString":"LineString",e&&(e.arrowStyle&&(this._arrowStyle=e.arrowStyle),e.color&&(this._color=e.color),e.fillColor&&(this._fillColor=e.fillColor),void 0!==e.weight&&(this._weight=e.weight),0<=e.opacity&&e.opacity<=1&&(this._opacity=e.opacity),0<=e.fillOpacity&&e.fillOpacity<=1&&(this._fillOpacity=e.fillOpacity),e.lineStyle&&(this._lineStyle=e.lineStyle),ZenMap.Utils.BaseUtils.isTypeRight(e.enableEditing,"boolean")&&(this._enableEditing=e.enableEditing),ZenMap.Utils.BaseUtils.isTypeRight(e.enableClicking,"boolean")&&(this._enableClicking=e.enableClicking),e.text&&(this.text=e.text),e.pointRadius&&(this._pointRadius=e.pointRadius),e.arrowIcon&&(this._arrowIcon=e.arrowIcon))};(t.prototype=new ZenMap.Overlay).setPath=function(t,e){this._points=t,this._lineType=this._points&&0<this._points.length&&this._points[0]instanceof Array?"MultiLineString":"LineString",this.layer&&((t=this.layer.getFeature(this.id)).geometry.type=this._lineType,t.geometry.coordinates=this._getCoordinates(this.layer._map),e||this.layer.refresh())},t.prototype.addPoint=function(t){this._points.push(t),this.layer&&(this.layer.getFeature(this.id).geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh())},t.prototype.getExtent=function(){var t,e,i,o;if("LineString"==this._lineType)for(var r=0;r<this._points.length;r++)(!t||t>this._points[r].lon)&&(t=this._points[r].lon),(!e||e>this._points[r].lat)&&(e=this._points[r].lat),(!i||i<this._points[r].lon)&&(i=this._points[r].lon),(!o||o<this._points[r].lat)&&(o=this._points[r].lat);else for(var n=0;n<this._points.length;n++)for(var s=this._points[n],r=0;r<s.length;r++)(!t||t>s[r].lon)&&(t=s[r].lon),(!e||e>s[r].lat)&&(e=s[r].lat),(!i||i<s[r].lon)&&(i=s[r].lon),(!o||o<s[r].lat)&&(o=s[r].lat);return new ZenMap.Geometry.Extent(t,e,i,o)},t.prototype.getPath=function(){return this._points},t.prototype.setStyle=function(t){this._color=t.color||this._color,this._opacity=t.opacity||this._opacity,this._lineStyle=t.lineStyle||this._lineStyle,this._weight=t.weight||this._weight,this.layer&&((t=this.layer.getFeature(this.id)).properties.color=this._color,t.properties.opacity=this._opacity,t.properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,t.properties.width=this._weight,this.layer.refresh())},t.prototype.setColor=function(t){this._color=t,this.layer&&(this.layer.getFeature(this.id).properties.color=this._color,this.layer.refresh())},t.prototype.getColor=function(){return this._color},t.prototype.setOpacity=function(t){t<0||1<t||(this._opacity=t,this.layer&&(this.layer.getFeature(this.id).properties.opacity=this._opacity,this.layer.refresh()))},t.prototype.getOpacity=function(){return this._opacity},t.prototype.setWeight=function(t){t<0||(this._weight=t,this.layer&&(this.layer.getFeature(this.id).properties.width=this._weight,this.layer.refresh()))},t.prototype.getWeight=function(){return this._weight},t.prototype.setLineStyle=function(t){this._lineStyle=t,this.layer&&(this.layer.getFeature(this.id).properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,this.layer.refresh())},t.prototype.getLineStyle=function(){return this._lineStyle},t.prototype.setArrowStyle=function(t){},t.prototype.getArrowStyle=function(){return this._arrowStyle},t.prototype.getStartPoint=function(){return this.getPath()[0]},t.prototype.getEndPoint=function(){var t=this.getPath();return t[t.length-1]},t.prototype.setPositionAt=function(t,e){!this._points||t>this._points.length-1||t<0||(this._points.splice(t,1,e),this.layer&&(this.layer.getFeature(this.id).geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()))},t.prototype.getLength=function(){var t=this.layer?this.layer.getFeature(this.id):{type:"Feature",geometry:{type:this._lineType,coordinates:this._getCoordinates()}};return Math.round(ZenMap.Utils.MapUtil.lineDistance(t))},t.prototype.addEventListener=function(t,e){this._events.register(t,e)},t.prototype.removeEventListener=function(t,e){this._events.unregister(t,e)},t.prototype._getCoordinates=function(t){for(var e=this._points,i=[],o=0;o<e.length;o++){var r=e[o];if(e[0].lon&&e[0].lat){var n=t?ZenMap.T.setPoint(t,e[o]):e[o];i.push([n.lon,n.lat])}else{for(var s=[],a=0;a<r.length;a++){n=t?ZenMap.T.setPoint(t,r[a]):r[a];s.push([n.lon,n.lat])}i.push(s)}}return i}}(),ZenMap.CIRCLE_EVENT_CLICK="click",ZenMap.CIRCLE_EVENT_DBLCLICK="dblclick",ZenMap.CIRCLE_EVENT_RIGHT_CLICK="rightclick",ZenMap.CIRCLE_EVENT_MOUSE_DOWN="mousedown",ZenMap.CIRCLE_EVENT_MOUSE_UP="mouseup",ZenMap.CIRCLE_EVENT_MOUSE_OVER="mouseover",ZenMap.CIRCLE_EVENT_MOUSE_OUT="mouseout",ZenMap.CIRCLE_EVENT_LINE_UPDATE="lineupdate",ZenMap.CIRCLE_EVENT_MODIFIED="dragend",ZenMap.CIRCLE_EVENT_DRAG_START="dragstart",ZenMap.CIRCLE_EVENT_DRAG_END="dragend",function(){var t=ZenMap.Geometry.Circle=function(t,e,i){this.overlayType=ZenMap.OVERLAY_TYPE_CIRCLE,this._center=t,this._radius=e,this._realRadius=e,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this.title="",this._text="",this.id=ZenMap.Utils.BaseUtils.uuid(),this._fillOpacity=.5,this._lineStyle=ZenMap.LINE_TYPE_SOLID,this._enableClicking=!0,this.showRadius=(i=i||{}).showRadius||!1,this.labelStyle=i.labelStyle||null,this._points=[],this.CLASS_NAME="ZenMap.Geometry.Circle",this._events=new ZenMap.Events(this,["click","mouseover","mouseout","draging","dragend","dragstart"]),i.color&&(this._color=i.color),i.fillColor&&(this._fillColor=i.fillColor),void 0!==i.weight&&(this._weight=i.weight),0<=i.opacity&&i.opacity<=1&&(this._opacity=i.opacity),0<=i.fillOpacity&&i.fillOpacity<=1&&(this._fillOpacity=i.fillOpacity),i.lineStyle&&(this._lineStyle=i.lineStyle),i.text&&(this._text=i.text),this._updateGeometry()};(t.prototype=new ZenMap.Overlay)._updateGeometry=function(){this._points=[];for(var t=ZenMap.T.helper.webMoctorJW2PM(this._center.lon,this._center.lat),e=ZenMap.Utils.MapUtil.createRegularPolygon(t,this._radius,60),i=0;i<e.length;i++){var o=ZenMap.T.helper.inverseMercator(e[i].lon,e[i].lat),o=new ZenMap.Geometry.Point(o.lon,o.lat);this._points.push(o)}},t.prototype._getCoordinates=function(t){if(t){var e=[],i=[];this._points=[];for(var o=ZenMap.T.setPoint(t,this._center),o=ZenMap.T.helper.webMoctorJW2PM(o.lon,o.lat),r=ZenMap.Utils.MapUtil.createRegularPolygon(o,this._radius,60),n=0;n<r.length;n++){var s=ZenMap.T.helper.inverseMercator(r[n].lon,r[n].lat),a=ZenMap.T.getPoint(t,s);this._points.push(a),i.push([s.lon,s.lat])}return e.push(i),e}var l=this._points,e=[];if(0==l.length)return e;if(0<l.length){for(i=[],n=0;n<l.length;n++){var h=t?ZenMap.T.setPoint(t,l[n]):l[n];i.push([h.lon,h.lat])}e.push(i)}return e},t.prototype.setCenter=function(t){if(ZenMap.Utils.BaseUtils.isTypeRight(t,"ZenMap.Geometry.Point")&&(this._center=t,this._updateGeometry(),this.layer)){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e[i].geometry.coordinates=this._getCoordinates(this.layer._map)),"Point"==e[i].geometry.type&&(e[i].geometry.coordinates=[this._center.lon,this._center.lat]);this.layer.refresh()}},t.prototype.getCenter=function(){return this._center},t.prototype.setRadius=function(t){if(ZenMap.Utils.BaseUtils.isTypeRight(t,"number")&&(this._radius=t,this._realRadius=t,this._updateGeometry(),this.layer)){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()}},t.prototype.getRadius=function(){return this._radius},t.prototype.getRealRadius=function(){return this._realRadius},t.prototype.getArea=function(){var t;if(this.layer){if((t=this.layer.getFeature(this.id))instanceof Array)for(var e=0;e<t.length;e++)"Polygon"==t[e].geometry.type&&(t=t[e])}else t={type:"Feature",geometry:{type:"Polygon",coordinates:this._getCoordinates()}};return Math.PI*this._radius*this._radius/1e6},t.prototype.setColor=function(t){if(this._color=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.color=this._color,this.layer.refresh()}},t.prototype.getColor=function(){return this._color},t.prototype.setFillColor=function(t){if(this._fillColor=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.fillColor=this._fillColor,this.layer.refresh()}},t.prototype.getFillColor=function(){return this._fillColor},t.prototype.setOpacity=function(t){if(!(t<0||1<t)&&(this._opacity=t,this.layer)){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.opacity=this._opacity,this.layer.refresh()}},t.prototype.getOpacity=function(){return this._opacity},t.prototype.setFillOpacity=function(t){if(this._fillOpacity=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.fillOpacity=this._fillOpacity,this.layer.refresh()}},t.prototype.getFillOpacity=function(){return this._fillOpacity},t.prototype.setWeight=function(t){if(!(t<0)&&(this._weight=t,this.layer)){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.width=this._weight,this.layer.refresh()}},t.prototype.getWeight=function(){return this._weight},t.prototype.setLineStyle=function(t){if(this._lineStyle=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,this.layer.refresh()}},t.prototype.getLineStyle=function(){return this._lineStyle},t.prototype.setStyle=function(t){if(this._color=t.color||this._color,this._fillColor=t.fillColor||this._fillColor,this._fillOpacity=t.fillOpacity||this._fillOpacity,this._lineStyle=t.lineStyle||this._lineStyle,this._weight=t.weight||this._weight,this._opacity=t.opacity||this._opacity,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.color=this._color,e.properties.fillColor=this._fillColor,e.properties.fillOpacity=this._fillOpacity,e.properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,e.properties.width=this._weight,e.properties.opacity=this._opacity,this.layer.refresh()}},t.prototype.getExtent=function(){for(var t,e,i,o,r=0;r<this._points.length;r++)(!t||t>this._points[r].lon)&&(t=this._points[r].lon),(!e||e>this._points[r].lat)&&(e=this._points[r].lat),(!i||i<this._points[r].lon)&&(i=this._points[r].lon),(!o||o<this._points[r].lat)&&(o=this._points[r].lat);return new ZenMap.Geometry.Extent(t,e,i,o)},t.prototype.addEventListener=function(t,e){this._events.register(t,e)},t.prototype.removeEventListener=function(t,e){this._events.unregister(t,e)},t.prototype.setFillText=function(t,e,i){if(this._text){if(this.layer){var o=this.layer.getFeature(this.id);if(o instanceof Array)for(var r=0;r<o.length;r++)"Point"==o[r].geometry.type&&(o=o[r]);i=i||{},o.properties.title=t||this._text.getContent(),o.properties["text-size"]=e||this._text._fontSize,o.properties["text-opacity"]=i.opacity||this._text.getOpacity(),o.properties["text-color"]=i.color||this._text._color}}else{this._text=new ZenMap.Symbols.Label(t),e&&this._text.setFontSize(e),i&&this._text.setStyle(i);var n=ZenMap.T.setPoint(this.layer._map,this.getCenter());this.layer._source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[n.lon,n.lat]},properties:{id:this.id,title:t||"","text-offset":i.offset||[0,0],"text-opacity":i.opacity||1,"text-size":e||12,"text-color":i.color||"red",visible:this._visible}})}this.layer.refresh()},t.prototype.setPath=function(t){if(this._points=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()}},t.prototype.getPath=function(){return this._points}}(),ZenMap.CIRCLESECTOR_EVENT_CLICK="click",ZenMap.CIRCLESECTOR_EVENT_DBLCLICK="dblclick",ZenMap.CIRCLESECTOR_EVENT_RIGHT_CLICK="rightclick",ZenMap.CIRCLESECTOR_EVENT_MOUSE_DOWN="mousedown",ZenMap.CIRCLESECTOR_EVENT_MOUSE_UP="mouseup",ZenMap.CIRCLESECTOR_EVENT_MOUSE_OVER="mouseover",ZenMap.CIRCLESECTOR_EVENT_MOUSE_OUT="mouseout",ZenMap.CIRCLESECTOR_EVENT_LINE_UPDATE="lineupdate",ZenMap.CIRCLESECTOR_EVENT_MODIFIED="dragend",ZenMap.CIRCLESECTOR_EVENT_DRAG_START="dragstart",ZenMap.CIRCLESECTOR_EVENT_DRAG_END="dragend",function(){var t=ZenMap.Geometry.CircleSector=function(t,e,i,o,r,n){this.overlayType=ZenMap.OVERLAY_TYPE_CIRCLESECTOR,this._center=t,this._radius=e,this._sides=i,this._antBearing=o,this._lobeAngle=r,this.title="",this._color="blue",this._fillColor="red",this._opacity=1,this._fillOpacity=.5,this._lineStyle=ZenMap.LINE_TYPE_SOLID,this._weight=2,this._enableClicking=!0,this._points=[],this.id=ZenMap.Utils.BaseUtils.uuid(),this.CLASS_NAME="ZenMap.Geometry.CircleSector",this._events=new ZenMap.Events(this,["click","mouseover","mouseout"]),(n=n||{}).color&&(this._color=n.color),n.fillColor&&(this._fillColor=n.fillColor),void 0!==n.weight&&(this._weight=n.weight),0<=n.opacity&&n.opacity<=1&&(this._opacity=n.opacity),0<=n.fillOpacity&&n.fillOpacity<=1&&(this._fillOpacity=n.fillOpacity),n.lineStyle&&(this._lineStyle=n.lineStyle),this._updateGeometry()};(t.prototype=new ZenMap.Overlay)._updateGeometry=function(){this._points=[];for(var t=ZenMap.T.helper.webMoctorJW2PM(this._center.lon,this._center.lat),e=ZenMap.Utils.MapUtil.createCircleSector(t,this._radius,this._sides,this._antBearing,this._lobeAngle),i=0;i<e.length;i++){var o=ZenMap.T.helper.inverseMercator(e[i].lon,e[i].lat),o=new ZenMap.Geometry.Point(o.lon,o.lat);this._points.push(o)}},t.prototype._getCoordinates=function(t){var e=this._points,i=[];if(0==e.length)return i;if(0<e.length){for(var o=[],r=0;r<e.length;r++){var n=t?ZenMap.T.setPoint(t,e[r]):e[r];o.push([n.lon,n.lat])}i.push(o)}return i},t.prototype.setCenter=function(t){ZenMap.Utils.BaseUtils.isTypeRight(t,"ZenMap.Geometry.Point")&&(this._center=t,this._updateGeometry(),this.layer&&(this.layer.getFeature(this.id).geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()))},t.prototype.getCenter=function(){return this._center},t.prototype.setRadius=function(t){ZenMap.Utils.BaseUtils.isTypeRight(t,"number")&&(this._radius=t,this._updateGeometry(),this.layer&&(this.layer.getFeature(this.id).geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()))},t.prototype.getRadius=function(){return this._radius},t.prototype.setSides=function(t){ZenMap.Utils.BaseUtils.isTypeRight(t,"number")&&(this._sides=t,this._updateGeometry(),this.layer&&(this.layer.getFeature(this.id).geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()))},t.prototype.getSides=function(){return this._sides},t.prototype.setAntBearing=function(t){ZenMap.Utils.BaseUtils.isTypeRight(t,"number")&&(this._antBearing=t,this._updateGeometry(),this.layer&&(this.layer.getFeature(this.id).geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()))},t.prototype.getAntBearing=function(){return this._antBearing},t.prototype.setLobeAngle=function(t){ZenMap.Utils.BaseUtils.isTypeRight(t,"number")&&(this._lobeAngle=t,this._updateGeometry(),this.layer&&(this.layer.getFeature(this.id).geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()))},t.prototype.getLobeAngle=function(){return this._lobeAngle},t.prototype.setColor=function(t){this._color=t,this.layer&&(this.layer.getFeature(this.id).properties.color=this._color,this.layer.refresh())},t.prototype.getColor=function(){return this._color},t.prototype.setFillColor=function(t){this._fillColor=t,this.layer&&(this.layer.getFeature(this.id).properties.fillColor=this._fillColor,this.layer.refresh())},t.prototype.getFillColor=function(){return this._fillColor},t.prototype.setOpacity=function(t){t<0||1<t||(this._opacity=t,this.layer&&(this.layer.getFeature(this.id).properties.opacity=this._opacity,this.layer.refresh()))},t.prototype.getOpacity=function(){return this._opacity},t.prototype.setFillOpacity=function(t){this._fillOpacity=t,this.layer&&(this.layer.getFeature(this.id).properties.fillOpacity=this._fillOpacity,this.layer.refresh())},t.prototype.getFillOpacity=function(){return this._fillOpacity},t.prototype.setWeight=function(t){t<0||(this._weight=t,this.layer&&(this.layer.getFeature(this.id).properties.width=this._weight,this.layer.refresh()))},t.prototype.getWeight=function(){return this._weight},t.prototype.setLineStyle=function(t){this._lineStyle=t,this.layer&&(this.layer.getFeature(this.id).properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,this.layer.refresh())},t.prototype.getLineStyle=function(){return this._lineStyle},t.prototype.setStyle=function(t){this._color=t.color||this._color,this._fillColor=t.fillColor||this._fillColor,this._fillOpacity=t.fillOpacity||this._fillOpacity,this._lineStyle=t.lineStyle||this._lineStyle,this._weight=t.weight||this._weight,this._opacity=t.opacity||this._opacity,this.layer&&((t=this.layer.getFeature(this.id)).properties.color=this._color,t.properties.fillColor=this._fillColor,t.properties.fillOpacity=this._fillOpacity,t.properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,t.properties.width=this._weight,t.properties.opacity=this._opacity,this.layer.refresh())},t.prototype.getArea=function(){this.layer?this.layer.getFeature(this.id):this._getCoordinates();return Math.PI*this._radius*this._radius*this._antBearing/360/1e6},t.prototype.getExtent=function(){for(var t,e,i,o,r=0;r<this._points.length;r++)(!t||t>this._points[r].lon)&&(t=this._points[r].lon),(!e||e>this._points[r].lat)&&(e=this._points[r].lat),(!i||i<this._points[r].lon)&&(i=this._points[r].lon),(!o||o<this._points[r].lat)&&(o=this._points[r].lat);return new ZenMap.Geometry.Extent(t,e,i,o)},t.prototype.addEventListener=function(t,e){this._events.register(t,e)},t.prototype.removeEventListener=function(t,e){this._events.unregister(t,e)},t.prototype.getPath=function(){return this._points}}(),ZenMap.ELLIPSE_EVENT_CLICK="click",ZenMap.ELLIPSE_EVENT_DBLCLICK="dblclick",ZenMap.ELLIPSE_EVENT_RIGHT_CLICK="rightclick",ZenMap.ELLIPSE_EVENT_MOUSE_DOWN="mousedown",ZenMap.ELLIPSE_EVENT_MOUSE_UP="mouseup",ZenMap.ELLIPSE_EVENT_MOUSE_OVER="mouseover",ZenMap.ELLIPSE_EVENT_MOUSE_OUT="mouseout",ZenMap.ELLIPSE_EVENT_LINE_UPDATE="lineupdate",ZenMap.ELLIPSE_EVENT_MODIFIED="dragend",ZenMap.ELLIPSE_EVENT_DRAG_START="dragstart",ZenMap.ELLIPSE_EVENT_DRAG_END="dragend",function(){var t=ZenMap.Geometry.Ellipse=function(t,e,i,o){this.overlayType=ZenMap.OVERLAY_TYPE_ELLIPSE,this._firstPoint=t,this._secondPoint=e;t=(this._firstPoint.lon+this._secondPoint.lon)/2,e=(this._firstPoint.lat+this._secondPoint.lat)/2;this._center=new ZenMap.Geometry.Point(t,e),this._distance=i,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this.title="",this._fillOpacity=.5,this._lineStyle=ZenMap.LINE_TYPE_SOLID,this._enableClicking=!0,this.CLASS_NAME="ZenMap.Geometry.ellipse",this.id=ZenMap.Utils.BaseUtils.uuid(),this._events=new ZenMap.Events(this,["click","mouseover","mouseout"]),this.text="",(o=o||{}).color&&(this._color=o.color),o.fillColor&&(this._fillColor=o.fillColor),void 0!==o.weight&&(this._weight=o.weight),0<=o.opacity&&o.opacity<=1&&(this._opacity=o.opacity),0<=o.fillOpacity&&o.fillOpacity<=1&&(this._fillOpacity=o.fillOpacity),o.lineStyle&&(this._lineStyle=o.lineStyle),this._updateGeometry()};(t.prototype=new ZenMap.Overlay)._updateGeometry=function(){this._points=[];for(var t=ZenMap.T.helper.webMoctorJW2PM(this._firstPoint.lon,this._firstPoint.lat),e=ZenMap.T.helper.webMoctorJW2PM(this._secondPoint.lon,this._secondPoint.lat),i=ZenMap.Utils.MapUtil.createEllipsePolygon(t,e,this._distance),o=0;o<i.length;o++){var r=ZenMap.T.helper.inverseMercator(i[o].lon,i[o].lat),r=new ZenMap.Geometry.Point(r.lon,r.lat);this._points.push(r)}},t.prototype._getCoordinates=function(t){var e=this._points,i=[];if(0==e.length)return i;if(0<e.length){for(var o=[],r=0;r<e.length;r++){var n=t?ZenMap.T.setPoint(t,e[r]):e[r];o.push([n.lon,n.lat])}i.push(o)}return i},t.prototype.setCenter=function(t){if(this._points=[],this._center=t,ZenMap.Utils.BaseUtils.isTypeRight(t,"ZenMap.Geometry.Point")){for(var e=ZenMap.T.helper.webMoctorJW2PM(this._firstPoint.lon,this._firstPoint.lat),i=ZenMap.T.helper.webMoctorJW2PM(this._secondPoint.lon,this._secondPoint.lat),t=ZenMap.T.helper.webMoctorJW2PM(this._center.lon,this._center.lat),t=ZenMap.Utils.MapUtil.getNewPointByCenter(e,i,t),o=ZenMap.Utils.MapUtil.createEllipsePolygon(t[0],t[1],this._distance),r=0;r<o.length;r++){var n=ZenMap.T.helper.inverseMercator(o[r].lon,o[r].lat);this._points.push(n)}this.layer&&(this.layer.getFeature(this.id).geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh())}},t.prototype.getCenter=function(){return this._center},t.prototype.getArea=function(){var t=this.layer?this.layer.getFeature(this.id):{type:"Feature",geometry:{type:"Polygon",coordinates:this._getCoordinates()}};return ZenMap.Utils.MapUtil.getArea(t)/1e6},t.prototype.setColor=function(t){this._color=t,this.layer&&(this.layer.getFeature(this.id).properties.color=this._color,this.layer.refresh())},t.prototype.getColor=function(){return this._color},t.prototype.setFillColor=function(t){this._fillColor=t,this.layer&&(this.layer.getFeature(this.id).properties.fillColor=this._fillColor,this.layer.refresh())},t.prototype.getFillColor=function(){return this._fillColor},t.prototype.setOpacity=function(t){t<0||1<t||(this._opacity=t,this.layer&&(this.layer.getFeature(this.id).properties.opacity=this._opacity,this.layer.refresh()))},t.prototype.getOpacity=function(){return this._opacity},t.prototype.setFillOpacity=function(t){this._fillOpacity=t,this.layer&&(this.layer.getFeature(this.id).properties.fillOpacity=this._fillOpacity,this.layer.refresh())},t.prototype.getFillOpacity=function(){return this._fillOpacity},t.prototype.setWeight=function(t){t<0||(this._weight=t,this.layer&&(this.layer.getFeature(this.id).properties.width=this._weight,this.layer.refresh()))},t.prototype.getWeight=function(){return this._weight},t.prototype.setLineStyle=function(t){this._lineStyle=t,this.layer&&(this.layer.getFeature(this.id).properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,this.layer.refresh())},t.prototype.getLineStyle=function(){return this._lineStyle},t.prototype.setStyle=function(t){this._color=t.color||this._color,this._fillColor=t.fillColor||this._fillColor,this._fillOpacity=t.fillOpacity||this._fillOpacity,this._lineStyle=t.lineStyle||this._lineStyle,this._weight=t.weight||this._weight,this._opacity=t.opacity||this._opacity,this.layer&&((t=this.layer.getFeature(this.id)).properties.color=this._color,t.properties.fillColor=this._fillColor,t.properties.fillOpacity=this._fillOpacity,t.properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,t.properties.width=this._weight,t.properties.opacity=this._opacity,this.layer.refresh())},t.prototype.getExtent=function(){for(var t,e,i,o,r=0;r<this._points.length;r++)(!t||t>this._points[r].lon)&&(t=this._points[r].lon),(!e||e>this._points[r].lat)&&(e=this._points[r].lat),(!i||i<this._points[r].lon)&&(i=this._points[r].lon),(!o||o<this._points[r].lat)&&(o=this._points[r].lat);return new ZenMap.Geometry.Extent(t,e,i,o)},t.prototype.addEventListener=function(t,e){this._events.register(t,e)},t.prototype.removeEventListener=function(t,e){this._events.unregister(t,e)},t.prototype.setFillText=function(t,e){},t.prototype.getPoints=function(){return this._points},t.prototype.getPath=function(){return this._points}}(),ZenMap.RECTANGLE_EVENT_CLICK="click",ZenMap.RECTANGLE_EVENT_DBLCLICK="dblclick",ZenMap.RECTANGLE_EVENT_RIGHT_CLICK="rightclick",ZenMap.RECTANGLE_EVENT_MOUSE_DOWN="mousedown",ZenMap.RECTANGLE_EVENT_MOUSE_UP="mouseup",ZenMap.RECTANGLE_EVENT_MOUSE_OVER="mouseover",ZenMap.RECTANGLE_EVENT_MOUSE_OUT="mouseout",ZenMap.RECTANGLE_EVENT_LINE_UPDATE="lineupdate",ZenMap.RECTANGLE_EVENT_MODIFIED="dragend",ZenMap.RECTANGLE_EVENT_DRAG_START="dragstart",ZenMap.RECTANGLE_EVENT_DRAG_END="dragend",function(){var t=ZenMap.Geometry.Rectangle=function(t,e,i,o){this.CLASS_NAME="ZenMap.Geometry.Rectangle",this.overlayType=ZenMap.OVERLAY_TYPE_POLYGON,this.id=ZenMap.Utils.BaseUtils.uuid(),this._point=t,this._points=[],this._width=e,this._height=i,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this._fillOpacity=.5,this._pointRadius=5,this.title="",this._lineStyle=ZenMap.LINE_TYPE_SOLID,this._enableEditing=!1,this._enableClicking=!0,this._text="",this.fontSize=12,this._graphicZIndex=-1,this._events=new ZenMap.Events(this,["click","mouseover","mouseout","draging","dragend","dragstart"]),(o=o||{}).color&&(this._color=o.color),o.fillColor&&(this._fillColor=o.fillColor),void 0!==o.weight&&(this._weight=o.weight),0<=o.opacity&&o.opacity<=1&&(this._opacity=o.opacity),0<=o.fillOpacity&&o.fillOpacity<=1&&(this._fillOpacity=o.fillOpacity),o.lineStyle&&(this._lineStyle=o.lineStyle),o.enableEditing&&(this._enableEditing=o.enableEditing),o.enableClicking&&(this._enableClicking=o.enableClicking),o.text&&(this._text=o.text),o.pointRadius&&(this._pointRadius=o.pointRadius),this._updateGeometry()};(t.prototype=new ZenMap.Overlay)._updateGeometry=function(){for(var t=ZenMap.T.helper.webMoctorJW2PM(this._point.lon,this._point.lat),e=ZenMap.Utils.MapUtil.createRectangle(t,this._width,this._height),i=0;i<e.length;i++){var o=ZenMap.T.helper.inverseMercator(e[i].lon,e[i].lat),o=new ZenMap.Geometry.Point(o.lon,o.lat);this._points.push(o)}},t.prototype._getCoordinates=function(t){var e=this._points,i=[];if(0==e.length)return i;if(0<e.length){for(var o=[],r=0;r<e.length;r++){var n=t?ZenMap.T.setPoint(t,e[r]):e[r];o.push([n.lon,n.lat])}i.push(o)}return i},t.prototype.setPath=function(t){if(this._points=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()}},t.prototype.getPath=function(){return this._points},t.prototype.getExtent=function(){for(var t,e,i,o,r=0;r<this._points.length;r++)(!t||t>this._points[r].lon)&&(t=this._points[r].lon),(!e||e>this._points[r].lat)&&(e=this._points[r].lat),(!i||i<this._points[r].lon)&&(i=this._points[r].lon),(!o||o<this._points[r].lat)&&(o=this._points[r].lat);return new ZenMap.Geometry.Extent(t,e,i,o)},t.prototype.setColor=function(t){if(this._color=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.color=this._color,this.layer.refresh()}},t.prototype.getColor=function(){return this._color},t.prototype.setFillColor=function(t){if(this._fillColor=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.fillColor=this._fillColor,this.layer.refresh()}},t.prototype.getFillColor=function(){return this._fillColor},t.prototype.setOpacity=function(t){if(!(t<0||1<t)&&(this._opacity=t,this.layer)){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.opacity=this._opacity,this.layer.refresh()}},t.prototype.getOpacity=function(){return this._opacity},t.prototype.setFillOpacity=function(t){if(this._fillOpacity=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.fillOpacity=this._fillOpacity,this.layer.refresh()}},t.prototype.getFillOpacity=function(){return this._fillOpacity},t.prototype.setWeight=function(t){if(!(t<0)&&(this._weight=t,this.layer)){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.width=this._weight,this.layer.refresh()}},t.prototype.getWeight=function(){return this._weight},t.prototype.setLineStyle=function(t){if(this._lineStyle=t,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,this.layer.refresh()}},t.prototype.getLineStyle=function(){return this._lineStyle},t.prototype.setStyle=function(t){if(this._color=t.color||this._color,this._fillColor=t.fillColor||this._fillColor,this._fillOpacity=t.fillOpacity||this._fillOpacity,this._lineStyle=t.lineStyle||this._lineStyle,this._weight=t.weight||this._weight,this._opacity=t.opacity||this._opacity,this.layer){var e=this.layer.getFeature(this.id);if(e instanceof Array)for(var i=0;i<e.length;i++)"Polygon"==e[i].geometry.type&&(e=e[i]);e.properties.color=this._color,e.properties.fillColor=this._fillColor,e.properties.fillOpacity=this._fillOpacity,e.properties.hasDash=this._lineStyle!=ZenMap.LINE_TYPE_SOLID,e.properties.width=this._weight,e.properties.opacity=this._opacity,this.layer.refresh()}},t.prototype.setPositionAt=function(t,e){if(!(!this._points||t>this._points.length-1||t<0)&&(this._points.splice(t,0,e),this.layer)){var i=this.layer.getFeature(this.id);if(i instanceof Array)for(var o=0;o<i.length;o++)"Polygon"==i[o].geometry.type&&(i=i[o]);i.geometry.coordinates=this._getCoordinates(this.layer._map),this.layer.refresh()}},t.prototype.addEventListener=function(t,e){this._events.register(t,e)},t.prototype.removeEventListener=function(t,e){this._events.unregister(t,e)},t.prototype.setFillText=function(t,e,i){if(this._text){if(this.layer){var o=this.layer.getFeature(this.id);if(o instanceof Array)for(var r=0;r<o.length;r++)"Point"==o[r].geometry.type&&(o=o[r]);i=i||{},o.properties.title=t||this._text.getContent(),o.properties["text-size"]=e||this._text._fontSize,o.properties["text-opacity"]=i.opacity||this._text.getOpacity(),o.properties["text-color"]=i.color||this._text._color}}else{this._text=new ZenMap.Symbols.Label(t),e&&this._text.setFontSize(e),i&&this._text.setStyle(i);var n=ZenMap.T.setPoint(this.layer._map,this.getCenter());this.layer._source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[n.lon,n.lat]},properties:{id:this.id,title:t||"","text-offset":i.offset||[0,0],"text-opacity":i.opacity||1,"text-size":e||12,"text-color":i.color||"red",visible:this._visible}})}this.layer.refresh()},t.prototype.getArea=function(){for(var t,e,i,o,r=0;r<this._points.length;r++)(!t||t>this._points[r].lon)&&(t=this._points[r].lon),(!e||e>this._points[r].lat)&&(e=this._points[r].lat),(!i||i<this._points[r].lon)&&(i=this._points[r].lon),(!o||o<this._points[r].lat)&&(o=this._points[r].lat);var n=ZenMap.T.helper.webMoctorJW2PM(t,e),s=ZenMap.T.helper.webMoctorJW2PM(i,o);return(n.lon-s.lon)*(n.lat-s.lat)/1e6},t.prototype._containsPoint=function(t){if("ZenMap.Geometry.Point"===this._points[0].CLASS_NAME)return ZenMap.Utils.MapUtil.ContainsPoint(this._points,t);for(var e=0,i=0;i<this._points.length;i++){var o=this._points[i];"ZenMap.Geometry.Point"===o[0].CLASS_NAME&&ZenMap.Utils.MapUtil.ContainsPoint(o,t)&&e++}return e%2!=0},t.prototype.containsPoint=function(t){var e=this.getExtent();return!(t.lon<e.left||t.lon>e.right||t.lat<e.bottom||t.lat>e.top)&&this._containsPoint(t)},t.prototype.containsPoints=function(t){for(var e=[],i=this.getExtent(),o=0;o<t.length;o++){var r=t[o].getPosition();r.lon<i.left||r.lon>i.right||r.lat<i.bottom||r.lat>i.top||this._containsPoint(r)&&e.push(t[o])}return e},t.prototype.getCenter=function(){var t=this.getExtent();return new ZenMap.Geometry.Point((t.left+t.right)/2,(t.top+t.bottom)/2)}}(),function(){var t=ZenMap.Symbols.Icon=function(t,e,i){this.CLASS_NAME="ZenMap.Symbols.Icon",this.id=-1,this.border=0,this._imageUrl=t,this._imageSize=e||1,this._anchor=new ZenMap.Geometry.Size(0,0),this._showInMap=!1,i&&(i.anchor&&(this._anchor=i.anchor),i.border&&(this.border=i.border),i.showInMap&&(this._showInMap=i.showInMap))};t.prototype.setImageUrl=function(t){"string"==typeof t&&(this._imageUrl=t)},t.prototype.showInMap=function(t){this._showInMap=t},t.prototype.getImageUrl=function(){return this._imageUrl},t.prototype.setImageSize=function(t){t instanceof ZenMap.Geometry.Size&&(this._imageSize=t)},t.prototype.getImageSize=function(){return this._imageSize},t.prototype.setAnchor=function(t){t instanceof ZenMap.Geometry.Size&&(this._anchor=t)},t.prototype.getAnchor=function(){return this._anchor}}(),ZenMap.LABEL_EVENT_CLICK="click",ZenMap.LABEL_EVENT_DBLCLICK="dblclick",ZenMap.LABEL_EVENT_RIGHT_CLICK="rightclick",ZenMap.LABEL_EVENT_MOUSE_DOWN="mousedown",ZenMap.LABEL_EVENT_MOUSE_UP="mouseup",ZenMap.LABEL_EVENT_MOUSE_OVER="mouseover",ZenMap.LABEL_EVENT_MOUSE_OUT="mouseout",ZenMap.LABEL_EVENT_DRAG_START="dragstart",ZenMap.LABEL_EVENT_DRAG_END="dragend",function(){var t=ZenMap.Symbols.Label=function(t,e){this.CLASS_NAME="ZenMap.Symbols.Label",this.overlayType=ZenMap.OVERLAY_TYPE_LABEL,this.id=ZenMap.Utils.BaseUtils.uuid(),this._content=t,this._offset=new ZenMap.Geometry.Size(0,0),this._fontSize=12,this._color="red",this._style={},this._opacity=1,this.title="",this._events=new ZenMap.Events(this,["click","mouseover","mouseout","dragstart","draging","dragend"]),e&&(this.opts=e||{},e.backgroundColor&&(this._bgColor=e.backgroundColor),e.haloWidth&&(this._haloWith=e.haloWidth),e.fontSize&&(this._fontSize=e.fontSize),e.opacity&&(this._opacity=e.opacity),e.color&&(this._color=e.color),e.offset&&(this._offset=e.offset),e.position?this._position=e.position:this._position=new ZenMap.Geometry.Point(0,0))};(t.prototype=new ZenMap.Overlay).setStyle=function(t){t&&(this._style=t||{},t.fontSize&&(this._fontSize=t.fontSize),t.opacity&&(this._opacity=t.opacity),t.color&&(this._color=t.color),t.offset&&(this._offset=t.offset),t.backgroundColor&&(this._bgColor=t.backgroundColor),t.haloWidth&&(this._haloWith=t.haloWidth),this.layer&&((t=this.layer.getFeature(this.id)).properties["text-offset"]=[this._offset.width/this._fontSize,this._offset.height/this._fontSize],t.properties["text-size"]=this._fontSize,t.properties["text-opacity"]=this._opacity,t.properties["text-color"]=this._color,t.properties["text-halo-color"]=this._bgColor,t.properties["text-halo-width"]=this._haloWith,this.layer.refresh()))},t.prototype.getStyle=function(){return{fontSize:this._fontSize,offset:this._offset,color:this._color,opacity:this._opacity}},t.prototype.setContent=function(t){this._content=t,this.layer&&(this.layer.getFeature(this.id).properties.title=this._content,this.layer.refresh())},t.prototype.getContent=function(){return this._content},t.prototype.setPosition=function(t){this._position=t,this.layer&&(this.layer.getFeature(this.id).geometry.coordinates=[this._position.lon,this._position.lat],this.layer.refresh())},t.prototype.getPosition=function(){if(this._position.lon&&this._position.lat)return new ZenMap.Geometry.Point(this._position.lon,this._position.lat)},t.prototype.setOffset=function(t){this._offset=t,this.layer&&(this.layer.getFeature(this.id).properties["text-offset"]=[this._offset.width/this._fontSize,this._offset.height/this._fontSize],this.layer.refresh())},t.prototype.getOffset=function(){return this._offset},t.prototype._getOffset=function(){return new ZenMap.Geometry.Size(this._offset.width/this._fontSize,this._offset.height/this._fontSize)},t.prototype.setTitle=function(t){this._title=t},t.prototype.getTitle=function(){return this._title},t.prototype.setOpacity=function(t){t<0||1<t||(this._opacity=t,this.layer&&(this.layer.getFeature(this.id).properties["text-opacity"]=this._opacity,this.layer.refresh()))},t.prototype.getOpacity=function(){return this._opacity},t.prototype.setFontSize=function(t){this._fontSize=t,this.layer&&(this.layer.getFeature(this.id).properties["text-size"]=this._fontSize,this.layer.refresh())},t.prototype.getFontSize=function(){return this._fontSize},t.prototype.addEventListener=function(t,e){this._events.register(t,e)},t.prototype.removeEventListener=function(t,e){this._events.unregister(t,e)}}(),ZenMap.MARKER_EVENT_CLICK="click",ZenMap.MARKER_EVENT_DBLCLICK="dblclick",ZenMap.MARKER_EVENT_RIGHT_CLICK="rightclick",ZenMap.MARKER_EVENT_MOUSE_DOWN="mousedown",ZenMap.MARKER_EVENT_MOUSE_UP="mouseup",ZenMap.MARKER_EVENT_MOUSE_OVER="mouseover",ZenMap.MARKER_EVENT_MOUSE_OUT="mouseout",ZenMap.MARKER_EVENT_DRAG_START="dragstart",ZenMap.MARKER_EVENT_DRAG_END="dragend",ZenMap.LABEL_EVENT_DRAG_ING="draging",function(){var t=ZenMap.Symbols.Marker=function(t,e){this.CLASS_NAME="ZenMap.Symbols.Marker",this.overlayType=ZenMap.OVERLAY_TYPE_MARKER,this.id=ZenMap.Utils.BaseUtils.uuid(),this._position=t,this._offset=new ZenMap.Geometry.Size(0,0),this._icon,this._label,this.title="",this._opacity=1,this._rotation,this._events=new ZenMap.Events(this,["click","mouseover","mouseout","dragstart","draging","dragend","mousedown","rightclick"]),e&&(this.opts=e||{},e.offset&&(this._offset=e.offset),e.icon&&(this._icon=e.icon),e.title&&(this.title=e.title),e.rotation&&(this._rotation=e.rotation))};(t.prototype=new ZenMap.Overlay).setIcon=function(t){t instanceof ZenMap.Symbols.Icon?this._icon=t:this._icon=new ZenMap.Symbols.Icon(t.imageUrl,new ZenMap.Geometry.Size(t.imageSize.Width,t.imageSize.Height),{anchor:new ZenMap.Geometry.Size(t.anchor.X,t.anchor.Y)}),this.layer&&((t=this.layer.getFeature(this.id)).properties["icon-offset"]=this._icon.getAnchor().toArray(),t.properties.icon=this._icon.getImageUrl(),t.properties["icon-opacity"]=this._visible?1:0,t.properties["icon-rotate"]=this._icon._rotation,t.properties["icon-size"]=this._icon?this._icon.getImageSize():void 0,t.properties["icon-rotation-alignment"]=this._icon._showInMap?"map":"viewport",this.layer.refresh())},t.prototype.getIcon=function(){return this._icon},t.prototype.setPosition=function(t,e){this._position=t,this.layer&&(t=this.layer._map?ZenMap.T.setPoint(this.layer._map,this._position):this._position,this.layer.getFeature(this.id).geometry.coordinates=[t.lon,t.lat],e||this.layer.refresh())},t.prototype.getExtent=function(){return new ZenMap.Geometry.Extent(this._position.lon,this._position.lat,this._position.lon,this._position.lat)},t.prototype.getPosition=function(){if(this._position.lon&&this._position.lat)return new ZenMap.Geometry.Point(this._position.lon,this._position.lat)},t.prototype.setOffset=function(t){this._offset=t,this.layer&&(this.layer.getFeature(this.id).properties["icon-offset"]=(t||this.getIcon().getAnchor()).toArray(),this.layer.refresh())},t.prototype.getOffset=function(){return this._offset},t.prototype.setLabel=function(t){var e;this._label=t,this.layer&&((e=this.layer.getFeature(this.id)).properties.title=t?t.getContent():"",e.properties["text-offset"]=t?t.getOffset().toArray():null,e.properties["text-opacity"]=t?t._visible?t.getOpacity():0:null,e.properties["text-size"]=t?t._fontSize:null,this.layer.refresh())},t.prototype.getLabel=function(){return this._label},t.prototype.showLabel=function(){this._label&&(this._label._visible=!0,this.layer&&(this.layer.getFeature(this.id).properties["text-opacity"]=this._label?this._visible&&this._label._visible?this._label.getOpacity():0:null,this.layer.refresh()))},t.prototype.hideLabel=function(){this._label&&(this._label._visible=!1,this.layer&&(this.layer.getFeature(this.id).properties["text-opacity"]=0,this.layer.refresh()))},t.prototype.setTitle=function(t){this.title=t},t.prototype.getTitle=function(){return this.title},t.prototype.moveTo=function(t,e){this._position=this.layer._map?ZenMap.T.setPoint(this.layer._map,t):t,this.layer&&(this.layer.getFeature(this.id).geometry.coordinates=[this._position.lon,this._position.lat],e||this.layer.refresh())},t.prototype.rotate=function(t,e){this._rotation=t,this.layer&&(this.layer.getFeature(this.id).properties["icon-rotate"]=this._rotation||"",e||this.layer.refresh())},t.prototype.addEventListener=function(t,e){this._events.register(t,e,this)},t.prototype.removeEventListener=function(t,e){this._events.unregister(t,e,this)},t.prototype.removeMenu=function(){this.isEnableContextMenu=!1}}(),ZenMap.INFOWINDOW_EVENT_CLOSE="close",ZenMap.INFOWINDOW_EVENT_OPEN="open",ZenMap.INFOWINDOW_EVENT_HIDE="hide",ZenMap.INFOWINDOW_EVENT_CLICK_CLOSE="clickclose",function(){var t=ZenMap.Symbols.InfoWindow=function(t,e,i,o){this.CLASS_NAME="ZenMap.Symbols.InfoWindow",this.overlayType=ZenMap.OVERLAY_TYPE_INFOWIN,this.id=ZenMap.Utils.BaseUtils.uuid(),this._map=null,this._offset=new ZenMap.Geometry.Size(1,1),this._closeOnClick=!1,this._closeButton=!1,this._isAdaptation=!1,this._events=new ZenMap.Events(this,["open","close"]),this.iscommon=!1;var r=this;this._closeCallback=function(){r.close()},this._title=e?"<h4>"+e+"</h4>":"",i?this._checkHtml(i)||i instanceof HTMLElement?(this._dom=i,this._html=i):(this._dom="<span>"+i+"</span>",this._html=this._dom):(this._dom="",this._html=this._title+this._dom),this.opts=o||{},o.offset&&(this._offset=o.offset),o.iscommon&&(this.iscommon=o.iscommon),o.closeButton&&(this._closeButton=o.closeButton),o.closeOnClick&&(this._closeOnClick=o.closeOnClick),o.isAdaptation&&(this._isAdaptation=o.isAdaptation),o.onlyLeftTop&&(this._onlyLeftTop=o.onlyLeftTop),this._position=t,this._altitude=o.altitude||0,this._obj=new zmapboxgl.Popup({offset:[this._offset.width,this._offset.height],closeButton:this._closeButton,closeOnClick:this._closeOnClick,hasArrow:!this.iscommon,onlyLeftTop:this._onlyLeftTop}).setLngLat([this._position.lon,this._position.lat],this._altitude),this._obj.on("open",function(){r._events.triggerEvt("open")}),this._obj.on("close",function(){r._events.triggerEvt("close")}),this._html instanceof HTMLElement?this._obj.setDOMContent(this._html):this._obj.setHTML(this._html),o.width&&(this._width=o.width,this._obj._content.style.width=this._width+"px"),o.height&&(this._height=o.height,this._obj._content.style.height=this._height+"px")};(t.prototype=new ZenMap.Overlay)._checkHtml=function(t){return/<[^>]+>/g.test(t)},t.prototype.open=function(){this._obj&&this._map&&!this._obj.isOpen()&&this._obj.addTo(this._map._obj);var t,e,i,o,r=this._map?ZenMap.T.setPoint(this._map,this._position):this._position;this._obj.setLngLat([r.lon,r.lat],this._altitude),this._map&&this._isAdaptation&&(t=this._map._obj.project({lng:r.lon,lat:r.lat}),e=this._map._obj.getCanvas().height,i=this._map._obj.getCanvas().width,r=o=0,t.x>i?o=t.x-i+30:t.x<30&&(o=0-Math.abs(t.x)-30),t.y>e?r=t.y-e+30:t.y<30&&(r=0-Math.abs(t.y)-30),(o||r)&&this._map._obj.panBy([o,r]))},t.prototype.close=function(){this._obj&&this._obj.isOpen()&&this._obj.remove()},t.prototype.setPosition=function(t,e){this._position=t;t=this._map?ZenMap.T.setPoint(this._map,this._position):this._position;null==e?this._obj.setLngLat([t.lon,t.lat],0):this._obj.setLngLat([t.lon,t.lat],e)},t.prototype.getBaseDiv=function(){return this._obj._content},t.prototype.getContentDivStyle=function(){var t=this.getBaseDiv();return t.currentStyle||document.defaultView.getComputedStyle(t,null)},t.prototype.getPosition=function(){if(this._position.lon&&this._position.lat)return new ZenMap.Geometry.Point(this._position.lon,this._position.lat)},t.prototype.setOffset=function(t){this._offset=t,this._obj.options.offset=this._offset},t.prototype.getOffset=function(){return this._offset},t.prototype.destroy=function(){this.close(),this._title=null,this._dom=null,this._position=null,this._closeCallback=null,this._obj=null,this._map=null,this._events=null},t.prototype.hide=function(){this.close()},t.prototype.show=function(){this.open()},t.prototype.setWidth=function(t){var e;"number"==typeof t&&((e=this.getContentDivStyle())&&(this._width=e.width,this._height=e.height),this._width=t,t=new ZenMap.Geometry.Size(this._width,this._height),this.setSize(t))},t.prototype.setHeight=function(t){var e;"number"==typeof t&&((e=this.getContentDivStyle())&&(this._width=e.width,this._height=e.height),this._height=t,t=new ZenMap.Geometry.Size(this._width,this._height),this.setSize(t))},t.prototype.setSize=function(t){var e=this.getBaseDiv();this._width=t.width,this._height=t.height,e.style.width=this._width+"px",e.style.height=this._height+"px"},t.prototype.getSize=function(){var t=this.getContentDivStyle();return t&&(this._width=t.width,this._height=t.height),new ZenMap.Geometry.Size(this._width,this._height)},t.prototype.setTitle=function(t){this._title=t,this._dom instanceof HTMLElement||(this._html="<h4>"+this._title+"</h4><span>"+this._dom+"</span>",this._obj.setHTML(this._html))},t.prototype.getTitle=function(){return this._title},t.prototype.setContent=function(t){(this._dom=t)instanceof HTMLElement?this._obj.setDOMContent(this._dom):(this._html="<h4>"+this._title+"</h4><span>"+this._dom+"</span>",this._obj.setHTML(this._html))},t.prototype.getContent=function(){return this._dom},t.prototype.setBackgroundColor=function(t){var e=this.getBaseDiv();this.iscommon||this._obj._container&&(this._obj._container.firstChild.style.borderTopColor=t),e.style.background=t},t.prototype.isOpen=function(){return this._obj.isOpen()},t.prototype.enableCloseOnClick=function(){this._closeOnClick=!0,this._obj.enableCloseOnClick()},t.prototype.disableCloseOnClick=function(){this._closeOnClick=!1,this._obj.disableCloseOnClick()},t.prototype.moveTo=function(t){this.setPosition(t)},t.prototype.setCloseCallback=function(t){this.addEventListener("close",t)},t.prototype.addEventListener=function(t,e){this._events.register(t,e)},t.prototype.removeEventListener=function(t,e){this._events.unregister(t,e)}}(),ZenMap.ANIMATION_EVENT_START="start",ZenMap.ANIMATION_EVENT_PAUSE="pause",ZenMap.ANIMATION_EVENT_STOP="stop",ZenMap.ANIMATION_EVENT_MOVING="moving",ZenMap.ANIMATION_EVENT_MOVED="moved",function(){var t=ZenMap.Symbols.Animation=function(t,e,i){this.id=-1,this.CLASS_NAME="ZenMap.Symbols.Animation",this._points=new Array,ZenMap.Utils.BaseUtils.isTypeRight(e,"ZenMap.Overlay")&&(this._overlay=e),this._listeners={},this._initialize(),this._map=t,i&&(ZenMap.Utils.BaseUtils.isTypeRight(i.speed,"number")&&(this._speed=i.speed),ZenMap.Utils.BaseUtils.isTypeRight(i.isReturn,"boolean")&&(this._isReturn=i.isReturn),ZenMap.Utils.BaseUtils.isTypeRight(i.isRepeat,"boolean")&&(this._isRepeat=i.isRepeat))};t.prototype.setPath=function(t){ZenMap.Utils.BaseUtils.isTypeRight(t,"ZenMap.Geometry.Polyline")&&(this._path=t,this._points=t.getPath())},t.prototype.addPoint=function(t){this._points.push(t),this._path.addPoint(t)},t.prototype.getPath=function(){return this._path},t.prototype.getOverlay=function(){return this._overlay},t.prototype.setRepeat=function(t){ZenMap.Utils.BaseUtils.isTypeRight(t,"boolean")&&(this._isRepeat=t)},t.prototype.setReturn=function(t){ZenMap.Utils.BaseUtils.isTypeRight(t,"boolean")&&(this._isReturn=t)},t.prototype.setSpeed=function(t){ZenMap.Utils.BaseUtils.isTypeRight(t,"number")&&(this._speed=t)},t.prototype.start=function(){var t;this.stop(),!ZenMap.Utils.BaseUtils.isTypeRight(this._overlay,"ZenMap.Overlay")||!ZenMap.Utils.BaseUtils.isTypeRight(this._points,"Array")||this._points.length<=1||(this._interval=100,this._isPause=!1,this._curPointIndex=0,this._overlay.setPosition(this._points[0]),t=this._getAngle(this._points[0],this._points[1]),this._changeAngle(t),this._calculateSegment(this._points[0],this._points[1]),this._triggerEvent(ZenMap.ANIMATION_EVENT_START,this._points[0]),this._startTimer())},t.prototype.pause=function(){this._isPause=!this._isPause,this._triggerEvent(ZenMap.ANIMATION_EVENT_PAUSE,this._points[this._curPointIndex])},t.prototype.stop=function(){this._timer&&window.clearInterval(this._timer),this._triggerEvent(ZenMap.ANIMATION_EVENT_STOP,this._points[this._curPointIndex])},t.prototype.addEventListener=function(t,e){switch(t){case ZenMap.ANIMATION_EVENT_START:this._listeners.start||(this._listeners.start=[]),this._listeners.start.push(e);break;case ZenMap.ANIMATION_EVENT_PAUSE:this._listeners.pause||(this._listeners.pause=[]),this._listeners.pause.push(e);break;case ZenMap.ANIMATION_EVENT_STOP:this._listeners.stop||(this._listeners.stop=[]),this._listeners.stop.push(e);break;case ZenMap.ANIMATION_EVENT_MOVING:this._listeners.moving||(this._listeners.moving=[]),this._listeners.moving.push(e);break;case ZenMap.ANIMATION_EVENT_MOVED:this._listeners.moved||(this._listeners.moved=[]),this._listeners.moved.push(e)}},t.prototype.removeEventListener=function(t,e){var i=this._listeners[t];if(i instanceof Array)for(var o=0;o<i.length;++o)if(i[o].toString()===e.toString()){i.pop(e);break}},t.prototype._initialize=function(){this._angle=0,this._isIncreaseDirection=!0,this._curPointIndex=0,this._interval=100,this._isReturn=!0,this._isRepeat=!0},t.prototype._startTimer=function(){this._timer=setInterval(function(){this._isPause||this._actionStart()}.bind(this),this._interval)},t.prototype._actionStart=function(){this._triggerEvent(ZenMap.ANIMATION_EVENT_MOVING,this._points[this._curPointIndex]);var t,e=this._getNextPoint();if(e&&(t=new ZenMap.Geometry.Point(e.lon,e.lat),this._moveTo(t)),this._triggerEvent(ZenMap.ANIMATION_EVENT_MOVED,t),this._curSegCount>=this._totalSegCount){if(this._points.length-1===this._curPointIndex)if(this._isRepeat&&!this._isReturn)this._curPointIndex=0;else if(!this._isRepeat||!this._isReturn){if(this._isRepeat||!this._isReturn)return void this.stop();this._isHaveReturn=!0}this._isHaveReturn&&0===this._curPointIndex?this.stop():this._turningPoint()}else this._curSegCount++},t.prototype._getNextPoint=function(){return this._curSegCount>=this._totalSegCount?(this._isIncreaseDirection?++this._curPointIndex:--this._curPointIndex,this._points[this._curPointIndex]):this._isIncreaseDirection?this._getPoint(this._points[this._curPointIndex],this._points[this._curPointIndex+1]):this._getPoint(this._points[this._curPointIndex],this._points[this._curPointIndex-1])},t.prototype._getPoint=function(t,e){var i=this._map.pointToPixel(ZenMap.T.setPoint(this._map,t)),o=this._map.pointToPixel(ZenMap.T.setPoint(this._map,e)),t=this._curSegCount/this._totalSegCount,e=(o.x-i.x)*t+i.x,i=(o.y-i.y)*t+i.y,i=new ZenMap.Geometry.Pixel(e,i);return ZenMap.T.getPoint(this._map,this._map.pixelToPoint(i))},t.prototype._turningPoint=function(){var t=this._curPointIndex;(t>=this._points.length-1||t<=0)&&(this._isIncreaseDirection=this._isReturn?this._isIncreaseDirection:!this._isIncreaseDirection),t=this._isIncreaseDirection?(this._calculateSegment(this._points[t],this._points[t+1]),this._getAngle(this._points[t],this._points[t+1])):(this._calculateSegment(this._points[t],this._points[t-1]),this._getAngle(this._points[t],this._points[t-1])),this._changeAngle(t)},t.prototype._calculateSegment=function(t,e){e=this._getDistance(t,e)/(this._speed*this._interval/1e3);this._totalSegCount=Math.ceil(e)-1,this._curSegCount=0},t.prototype._getDistance=function(t,e){return this._map.getDistance(t,e)},t.prototype._moveTo=function(t){this._overlay.moveTo(t)},t.prototype._getAngle=function(t,e){if(t.lon==e.lon&&t.lat==e.lat)return-1;t=180*Math.atan2(e.lat-t.lat,e.lon-t.lon)/Math.PI;return t=0<t?360-t:0-t},t.prototype._changeAngle=function(t){this._angle!=t&&this._overlay instanceof ZenMap.Overlay&&(this._overlay.rotate(t),this._angle=t)},t.prototype._triggerEvent=function(t,e){var i=this._listeners[t];if(i instanceof Array)for(var o=0;o<i.length;++o)i[o].apply(this,e)}}(),ZenMap.Symbols.Animation.Options={speed:100,isReturn:!0,isRepeat:!0},function(){var t=ZenMap.Symbols.AnimationLine=function(t,e,i){this.CLASS_NAME="ZenMap.Symbols.AnimationLine",this.points,this.op_line,this.op_feature,this._layer,this._map=t,this.drawIndex=0,this.drawSpeed,this.isWait=!1,this.isAddPoint=!1,this.segArray,this.segIndex=0,this.panWay=-1,this.status,this.zoomStop=!1,this.interval=40,this.newStart=!0,this.events=new ZenMap.Events(this,["preDraw","afterDraw","afterStep"]),this.headerMarker=null,this.isHeaderRotate=!0,this.timer=null,this.isTrace=!1,this.isViewInMap=!1,this.isRotateMap=!1,this.lineStyle={color:"green"},i&&(i.color&&(this.lineStyle.color=i.color),i.opacity&&(this.lineStyle.opacity=i.opacity),i.weight&&(this.lineStyle.weight=i.weight),i.isViewInMap&&(this.isViewInMap=i.isViewInMap)),this.id=-1,this._points=new Array,this._listeners={},this.layerName="",this.points=e,this.points instanceof Array||(this.points=[]),this.drawSpeed=60/3.6*this.interval/1e3,this.status=0,i&&(this.headerMarker=i.headerMarker,this._layer=i.layer,this.isHeaderRotate=!1!==i.isHeaderRotate,this._refreshLine=!1!==i.refreshLine,i.renderFirst,this._refreshLine||(this.op_line=new ZenMap.Geometry.Polyline(this.points,this.lineStyle),this._layer.addOverlay(this.op_line))),this._init()};t.prototype._initInteractive=function(){var t=this;this._map._events.through=!0,this._map._events.register("zoomstart",this,function(){0<t.status&&(t.stop(),t.zoomStop=!0)}),this._map._events.register("movestart",this,function(){0<t.status&&(t.stop(),t.zoomStop=!0)}),this._map._events.register("moveend",this,function(){t.zoomStop&&(t.start(),t.zoomStop=!1)})},t.prototype.restart=function(){this.op_line&&this._layer.getOverlay(this.op_line.id)&&this._layer.removeOverlay(this.op_line),this.stop(),this._init(),this.start()},t.prototype.start=function(){ZenMap.isAnimat=!0,0<this.status||(this._triggerEvent(ZenMap.ANIMATION_EVENT_START),this.status=1,this._layer||(this._layer=new ZenMap.Layers.OverlayLayer(this.layerName,!1)),this._layer.getOverlay(this.op_line.id)||this._layer.addOverlay(this.op_line),0<=this.panWay&&this._suitView(this.points),this.newStart&&0==this.drawIndex&&0<this.points.length&&(this.headerMarker&&(this._rotateHeaderMarker(!0),this.headerMarker.moveTo(this.points[this.drawIndex],!0)),this.events.triggerEvt("afterDraw",{point:this.points[this.drawIndex],index:this.drawIndex})),this.timer=window.requestAnimationFrame(this._startDraw.bind(this)))},t.prototype.pause=function(){ZenMap.isAnimat=!1,this.status=-1},t.prototype.stop=function(){ZenMap.isAnimat=!1,-1==this.status&&this._triggerEvent(ZenMap.ANIMATION_EVENT_STOP),this.status=0,window.clearTimeout(this.timer)},t.prototype.setSpeed=function(t){var e;t<0||(0==t?(this.isWait=!0,this.isAddPoint=!1,this.drawSpeed=0):(this.isWait=!1,this._rotateHeaderMarker(),this.drawSpeed=t/3.6*this.interval/1e3,(0<this.status||this.status<0)&&this.segArray.length>this.segIndex&&(e=this.status,this.pause(),window.clearTimeout(this.timer),t=this.segArray[this.segIndex],this.points.splice(this.drawIndex+1,0,t),this.drawIndex=this.drawIndex+1,this.segArray=this._calculateSeg(this.drawIndex),this.segIndex=this.segArray.length-1,this.status=e,this._startDraw())))},t.prototype.appendPoints=function(t){t instanceof Array&&!(t.length<=0)&&(this.points=this.points.concat(t),this.op_line||this._init(),0<=this.panWay&&this._suitView(t))},t.prototype.setStyle=function(t){this.lineStyle=this._overwriteObj(this.lineStyle,t),this.op_line&&this._layer&&(this.op_line.setStyle(this.lineStyle),this._redraw())},t.prototype._overwriteObj=function(t,e){if(!t||!e)return t;for(var i in e)i in t&&(t[i]=e[i]);return t},t.prototype._startDraw=function(){if(0!=this.status)if(-1!=this.status)if(this.op_line)if(this._preDraw()){if(this.isWait)return this.isAddPoint||(this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex],!0),this.isAddPoint=!0,this.events.triggerEvt("afterDraw",{point:this.points[this.drawIndex],index:this.drawIndex})),void(this.timer=window.requestAnimationFrame(this._startDraw.bind(this)));this._addPoint(),this._afterDraw()}else this.status=0;else this.status=0;else this._triggerEvent(ZenMap.ANIMATION_EVENT_PAUSE);else this._triggerEvent(ZenMap.ANIMATION_EVENT_STOP)},t.prototype.continus=function(){this.isAddPoint=!1,this.drawIndex++,this.start()},t.prototype.trace=function(t){this.isTrace=!0,this.isRotateMap=t},t.prototype.stopTrace=function(){this.isTrace=!1},t.prototype._preDraw=function(){0==this.drawIndex&&(this.segArray=this._calculateSeg(this.drawIndex));var t=0==this.drawIndex&&0==this.segIndex,e=this.segArray.length;return this.segIndex=this.segIndex+1,t&&this.events.triggerEvt("preDraw",{point:this.points[this.drawIndex],index:this.drawIndex}),(t||this.segIndex>=e-1)&&this._rotateHeaderMarker(),!(this.drawIndex>=this.points.length-1)&&(this.segIndex>=e&&(this.segIndex=0,this.segArray=this._calculateSeg(this.drawIndex)),this.panWay<=0||!this._inView(this.segArray[this.segIndex])&&0<this.panWay&&this._setCenter(this.segArray[this.segIndex]),!0)},t.prototype._addPoint=function(){var t,e=this.segArray[this.segIndex],i=this.op_line.getPath();0==this.segIndex?(t=this.points[this.drawIndex],i.push(t)):i.length-1==this.drawIndex?i.push(e):i[i.length-1]=e,this.isTrace?this._setCenter(i[i.length-1]):this.isViewInMap&&(this._inView(e)||this._setCenter(e)),this._moveHeaderMarker(),this._refreshLine&&this.op_line.setPath(i,!0),this.unRedraw||this._redraw()},t.prototype._afterDraw=function(){0==this.drawIndex&&(1==this.segIndex||this.segIndex);var t=this.segIndex>=this.segArray.length-1;t&&(this.drawIndex++,this.events.triggerEvt("preDraw",{point:this.points[this.drawIndex],index:this.drawIndex})),0<this.drawIndex&&t&&(this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex],!0),this.events.triggerEvt("afterDraw",{point:this.points[this.drawIndex],index:this.drawIndex}));t=this.segIndex;this.segIndex>this.segArray.length-2&&(t=0),this.events.triggerEvt("afterStep",{stepIndex:t,pointIndex:this.drawIndex,point:this.segArray[this.segIndex]}),this.segIndex>this.segArray.length-2&&this.drawIndex>this.points.length-2&&(this.status=0,ZenMap.isAnimat=!1),this.timer=window.requestAnimationFrame(this._startDraw.bind(this))},t.prototype.nextPosition=function(){this.newStart=!1,0<this.drawIndex&&this.drawIndex--,this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex],!0),this._rotateHeaderMarker(),this.segIndex=0,this.segArray=this._calculateSeg(this.drawIndex),this._setLine(this.drawIndex),this.events.triggerEvt("afterStep",{stepIndex:0,pointIndex:this.drawIndex,point:this.segArray[this.segIndex]})},t.prototype.afterPosition=function(){this.drawIndex<this.points.length-1&&(this.drawIndex++,this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex],!0),this._rotateHeaderMarker(),this.segIndex=0,this.segArray=this._calculateSeg(this.drawIndex),this._setLine(this.drawIndex),this.events.triggerEvt("afterStep",{stepIndex:0,pointIndex:this.drawIndex,point:this.segArray[this.segIndex]}))},t.prototype.slicePoints=function(t){this.points=this.points.slice(0,t+1)},t.prototype._setLine=function(t,e){this.op_line._points=[];for(var i=0;i<t+1;i++)this.op_line._points.push(this.points[i]);0<e&&this.op_line._points.push(this.segArray[e]),this._refreshLine&&this.op_line.setPath(this.op_line._points,!0),this._redraw()},t.prototype.setLayer=function(t){this._layer=t},t.prototype._init=function(){this.segArray=[],this.drawIndex=0;var t=[];(this.segIndex=0)<this.points.length&&t.push(this.points[0]),this.op_line=new ZenMap.Geometry.Polyline(t,this.lineStyle)},t.prototype._redraw=function(){this.op_line&&this._layer&&this._layer.refresh()},t.prototype._calculateSeg=function(t){var e=[];if(t+1>=this.points.length)return e.push(0),e;var i,o=this.points[t],r=this.points[t+1],n=this._getDistance(o,r),s=0;0<this.drawSpeed&&(s=Math.round(n/this.drawSpeed));for(var a=1;a<s;a++)i=a/s,x=parseFloat((r.lon-o.lon)*i)+parseFloat(o.lon),y=parseFloat((r.lat-o.lat)*i)+parseFloat(o.lat),i=new ZenMap.Geometry.Point(x,y),e.push(i);return e.push(this.points[t+1]),e},t.prototype._getDistance=function(t,e){t=ZenMap.T.helper.webMoctorJW2PM(t.lon,t.lat),e=ZenMap.T.helper.webMoctorJW2PM(e.lon,e.lat);return Math.sqrt((t.lon-e.lon)*(t.lon-e.lon)+(t.lat-e.lat)*(t.lat-e.lat))},t.prototype._inView=function(t){return this._map.getExtent().containsPoint(t)},t.prototype._setCenter=function(t){t=ZenMap.T.setPoint(this._map,t);this._map._obj.transform.center=new zmapboxgl.LngLat(t.lon,t.lat)},t.prototype._pointToPixel=function(t){return this._map.pointToPixel(t)},t.prototype._pixelToPoint=function(t){return this._map.pixelToPoint(t)},t.prototype._setLayer=function(t){if(t&&t._useCluster)throw"can not use cluster layer";this._layer=t},t.prototype._suitView=function(t){1<t.length&&this._layer&&this._layer.map},t.prototype._rotateHeaderMarker=function(t){var e,i;this.headerMarker&&(!this.isHeaderRotate||0<=(i=this._calculateAngle())&&(this.headerMarker.rotate(i,!0),e=this._map._obj.getBearing(),i=(i+90)%360,this.isTrace&&this.isRotateMap&&(15<=Math.abs(i-e)||t)&&(this._map._obj.isRotating()||this._map._obj.flyTo({bearing:i,speed:3}))))},t.prototype.setPosition=function(t,e){-1<t&&t<this.points.length&&(this.drawIndex=t,t=this._calculateSeg(this.drawIndex),-1<e&&e<t.length?(this.segArray=t,this.segIndex=e):e<0?(this.segArray=t,this.segIndex=0):e>t.length-1&&(this.segArray=t,this.segIndex=t.length-2),1==t.length&&0==t[0]&&this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex],!0),this._rotateHeaderMarker(),0==this.segIndex?this.headerMarker.moveTo(this.points[this.drawIndex],!0):this._moveHeaderMarker(),this._setLine(this.drawIndex,this.segIndex))},t.prototype._calculateAngle=function(){if(this.drawIndex>=this.points.length-1)return-1;var t=this.points[this.drawIndex],e=this.points[this.drawIndex+1];if(t.lon==e.lon&&t.lat==e.lat)return-1;if(this._map.getDistance(t,e)<1)return-1;t=180*Math.atan2(e.lat-t.lat,e.lon-t.lon)/Math.PI;return t=0<t?360-t:0-t},t.prototype._moveHeaderMarker=function(){var t;!this.headerMarker||(t=this.segArray[this.segIndex]).lon&&t.lat&&(t=new ZenMap.Geometry.Point(t.lon,t.lat),this.headerMarker.moveTo(t,!0))},t.prototype.getAllSegCount=function(){for(var t=0,e=0;e<this.points.length;e++)t+=this._calculateSeg(e).length;return t},t.prototype.addEventListener=function(t,e){switch(t){case ZenMap.ANIMATION_EVENT_START:this._listeners.start||(this._listeners.start=[]),this._listeners.start.push(e);break;case ZenMap.ANIMATION_EVENT_PAUSE:this._listeners.pause||(this._listeners.pause=[]),this._listeners.pause.push(e);break;case ZenMap.ANIMATION_EVENT_STOP:this._listeners.stop||(this._listeners.stop=[]),this._listeners.stop.push(e);break;case ZenMap.ANIMATION_EVENT_MOVING:this._listeners.moving||(this._listeners.moving=[]),this._listeners.moving.push(e);break;case ZenMap.ANIMATION_EVENT_MOVED:this._listeners.moved||(this._listeners.moved=[]),this._listeners.moved.push(e);break;case"preDraw":case"afterDraw":case"afterStep":this.events.register(t,e)}},t.prototype.removeEventListener=function(t,e){if("preDraw"!==t&&"afterDraw"!==t&&"afterStep"!==t){var i=this._listeners[t];if(i instanceof Array)for(var o=0;o<i.length;++o)if(i[o].toString()==e.toString()){i.pop(e);break}}else this.events.unregiste(t)},t.prototype._triggerEvent=function(t,e){var i=this._listeners[t];if(i instanceof Array)for(var o=0;o<i.length;++o)i[o].apply(this,e)},t.prototype.remove=function(){this.stop(),this.op_line&&this._layer.getOverlay(this.op_line.id)&&this._layer.removeOverlay(this.op_line),this._layer&&""===this._layer.name&&this._map.removeLayer(this._layer)}}(),ZenMap.Symbols.ClusterPoints=function(t,e){this.CLASS_NAME="ZenMap.Symbols.ClusterPoints",this.overlayType=ZenMap.OVERLAY_TYPE_ClusterPoints,this.id=-1,this.dataJson=t,this.layName="",this.threshold=2,this.distance=200;for(var i=0;i<this.dataJson.length;i++)this.dataJson[i].container=this;e&&(e.distance&&(this.distance=e.distance),e.threshold&&(this.threshold=e.threshold))},ZenMap.Symbols.ClusterPoints.prototype=new ZenMap.Overlay,ZenMap.Symbols.ClusterPoints.prototype.getMarkersByMarkType=function(t){for(var e=[],i=0;i<this.dataJson.length;i++)this.dataJson[i].markType===t&&e.push(this.dataJson[i]);return e},ZenMap.Symbols.ClusterPoints.prototype.getClusterPoints=function(){return this.dataJson},function(){var t=ZenMap.Symbols.ClusterMarker=function(t,e){this.location=t,this.location._visible=!0,this.location.angle=0,this._apiObj=null,this.dragstart=null,this.dragend=null,this.markType=" ",this.isEnableEdit=!1,this._fontSize=12,this._isActive=!1,this.CLASS_NAME="ZenMap.Symbols.ClusterMarker",e&&(this.markType=e.markType||"",this._image=e.image||"",this._extendImage=e.extendImage||"",this._extendIconrotation=e.rotation||0,this._extendIconOffset=e.extendIconOffset||[0,0],this._iconOffset=e.iconOffset||[0,0],this._extendIconSize=e.extendIconSize||1,this._extendIconOpacity=e.extendIconOpacity||1,this._context=e.context||"",this.title=e.title||"",this._fontSize=e.fontSize||12,e.textOffset&&(this._textOffset=[e.textOffset[0]/this._fontSize,e.textOffset[1]/this._fontSize]),this._color=e.color||"#000000"),this.id=ZenMap.Utils.BaseUtils.uuid()};t.prototype.changeStyle=function(t,e){var i=this.container.layer._map;this._apiObj&&this.container.layer&&(t&&t.image&&(this._image=t.image,i&&i._obj.setLayoutProperty(this.container.layer._activeMarkerLayer.id,"icon-image",t.image)),t&&t.context&&(this._context=t.context,i&&i._obj.setLayoutProperty(this.container.layer._activeMarkerLayer.id,"text-field",t.context)),t&&t.iconOffset&&(this._iconOffset=t.iconOffset,i&&i._obj.setLayoutProperty(this.container.layer._activeMarkerLayer.id,"icon-offset",t.iconOffset)),t&&t.fontSize&&(this._fontSize=t.fontSize,i&&i._obj.setLayoutProperty(this.container.layer._activeMarkerLayer.id,"text-size",t.fontSize)),t&&t.textOffset&&(this._textOffset=[t.textOffset[0]/this._fontSize,t.textOffset[1]/this._fontSize],i&&i._obj.setLayoutProperty(this.container.layer._activeMarkerLayer.id,"text-offset",this._textOffset)),t&&t.color&&(this._color=t.color,i&&i._obj.setPaintProperty(this.container.layer._activeMarkerLayer.id,"text-color",t.color)))},t.prototype.setVisible=function(t,e){void 0===e&&(e=!0),this.location._visible=t,this._apiObj&&this.container&&(this._apiObj.properties.visible=t?1:0,e&&this.container.layer.refresh())},t.prototype.flash=function(t){var e,i,o;this._apiObj&&this.location._visible&&(i=0,(e=this).timer&&(window.clearTimeout(this.timer),this.show(),this.timer=null),(o=function(){i++,e._apiObj.properties.visible=i%2?0:1,e.container.layer.refresh(),e.timer=i<2*t?window.setTimeout(o,500):null})())},t.prototype.flashStop=function(){this._apiObj&&this.location._visible&&(window.clearTimeout(this.timer),this._apiObj.properties.visible=1,this.container.layer.refresh(),this.timer=null)},t.prototype.getData=function(){return this.location},t.prototype.enableEditing=function(t,e){this.isEnableEdit=!0},t.prototype.disableEditing=function(){this.isEnableEdit=!1,this._modify&&(this._modify.disableEdit(),this._modify=null)},t.prototype.getPosition=function(){if(this.location.lon&&this.location.lat)return new ZenMap.Geometry.Point(this.location.lon,this.location.lat)},t.prototype.setPosition=function(t){t&&"ZenMap.Geometry.Point"==t.CLASS_NAME&&(this.location.lon=t.lon,this.location.lat=t.lat,this._apiObj&&(t=ZenMap.T.setPoint(this.container.layer._map,this.location),this._apiObj.geometry.coordinates=[t.lon,t.lat],this.container.layer.refresh()))},t.prototype.setAngle=function(t){this.location.angle=t,this._apiObj&&(this._apiObj.properties["icon-rotate"]=this.location.angle||"",this.container.layer.refresh())}}(),function(){var t=ZenMap.Symbols.CircleAnimation=function(t,e){this.layerId=ZenMap.Utils.BaseUtils.uuid(),this._map=t,this._layers=[],this.opts=e||{},this.style,this.timer,this._visible=!0,this.headUrl=ZenMap.Utils.BaseUtils.getHostPath(),this.defaultCircleImages=[],this.defaultLineImages=[],this._events=new ZenMap.Events(this,["click","mouseover","mouseout"]);for(var i=0;i<10;i++)this.defaultCircleImages.push(this.headUrl+"/ZenView/circleImages/work"+(i+1)+".png");for(i=0;i<10;i++)this.defaultLineImages.push(this.headUrl+"/ZenView/blueline/"+(i+1)+".png");this._circleImages=this.opts.circleImages||this.defaultCircleImages,this._lineImages=this.opts.lineImages||this.defaultLineImages;var o=[];this.markerfilename=this.layerId+"_Marker",this.linefilename=this.layerId+"_Line";for(i=0;i<this._circleImages.length;i++)o.push([this.markerfilename+(i+1),this._circleImages[i]]);for(i=0;i<this._lineImages.length;i++)o.push([this.linefilename+(i+1),this._lineImages[i]]);this.tagIcon=this.opts.tagIcon||null,this.tagIcon&&(this.tagName=this.layerId+"_TagMarker",o.push([this.tagName,this.tagIcon])),this.tagTextFontSize=this.opts.tagTextFontSize||12,this.tagTextOffset=this.opts.tagTextOffset||[0,0],this._tagOffset=this.opts.tagOffset||[0,-20],this._windowOffsetY=this.opts.windowOffsetY||-18,this._lineOffset=this.opts.lineOffset||[0,-20],this._map.addImages(o),this.hideLine=this.opts.hideLine||!1,this.fontColor=this.opts.fontColor||"#000000",this.visible=!1!==this.opts.visible||this.opts.visible,this.minSize=this.opts.minSize||.2,this.maxSize=this.opts.maxSize||1,this.minZoom=this.opts.minZoom||0,this.maxZoom=this.opts.maxZoom||22,this.count=3,this.interval=this.opts.interval||100,this._source={type:"geojson",data:{type:"FeatureCollection",features:[]}}};t.prototype.addPoints=function(t){if(!this._map._obj.getSource(this.layerId)){this._markers=[],this._points=t;t=this._points.length>this.count?this.count:this._points.length;t<this.count&&(this.count=t);for(var e=0;e<this._points.length;e++){var i=ZenMap.T.setPoint(this._map,this._points[e]),o=e%this.count;this._source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[i.lon,i.lat]},properties:{id:this._points[e].id,text:this._points[e].getData().text,dataID:this._points[e].getData().id,layertype:o,visible:this.visible}})}this._map._obj.addSource(this.layerId,this._source),this._createCircleLayer(),this.hideLine||this._createLineLayer(),this.tagIcon&&this._createTagIconLayer(),this.timer=!0,this._start()}},t.prototype._createCircleLayer=function(){for(var t=0;t<this.count;t++){var e=this.markerfilename+Math.round(Math.random()*(this._circleImages.length-1)+1),e={id:this.layerId+"_symbol"+t,type:"symbol",source:this.layerId,layout:{"icon-image":e,"icon-size":{stops:[[this.minZoom,this.minSize],[this.maxZoom,this.maxSize]]},"icon-rotation-alignment":"map","icon-ignore-placement":!0},paint:{"icon-opacity":1},filter:["all",["==","layertype",t],["==","visible",!0]],minzoom:this.minZoom,maxzoom:this.maxZoom};this._layers.push(e),this._map._obj.addLayer(e)}},t.prototype._createLineLayer=function(){var t=this.linefilename+Math.round(Math.random()*(this._lineImages.length-1)+1),t={id:this.layerId+"_line",type:"symbol",source:this.layerId,layout:{"icon-image":t,"icon-size":1,"icon-offset":this._lineOffset,"icon-rotation-alignment":"viewport","icon-ignore-placement":!0},filter:["==","visible",!0],paint:{"icon-opacity":1},minzoom:this.minZoom,maxzoom:this.maxZoom};this._layers.push(t),this._map._obj.addLayer(t)},t.prototype._createTagIconLayer=function(){var t={id:this.layerId+"icon_layer",type:"symbol",source:this.layerId,layout:{"icon-image":this.tagName,"icon-size":{stops:[[this.minZoom,this.minSize],[this.maxZoom,this.maxSize]]},"icon-ignore-placement":!0,"icon-offset":this._tagOffset,"text-field":"{text}","text-font":["Microsoft YaHei"],"text-offset":[this.tagTextOffset[0]/this.tagTextFontSize,this.tagTextOffset[1]/this.tagTextFontSize],"text-size":this.tagTextFontSize,"text-ignore-placement":!0},paint:{"icon-opacity":1,"text-color":this.fontColor},minzoom:this.minZoom,maxzoom:this.maxZoom,filter:["==","visible",!0]};this._layers.push(t),this._map._obj.addLayer(t);var r=this;this._map._obj.on("click",this.layerId+"icon_layer",function(t){for(var e=t.features[0],i=0;i<r._points.length;i++)if(e.properties.id===r._points[i].id)return void r._events.triggerEvt("click",r._points[i])}),this._map._obj.on("mouseover",this.layerId+"icon_layer",function(t){for(var e=t.features[0],i=0;i<r._points.length;i++)if(e.properties.id===r._points[i].id){var o=r._map.getPitch()/60*r._tagOffset[1]+r._windowOffsetY*(90-r._map.getPitch())/90,o=(1-(t.target._canvas.height-t.point.y)/t.target._canvas.height/3)*o;return void r._events.triggerEvt("mouseover",{point:r._points[i],offset:[0,o]})}}),this._map._obj.on("mouseout",this.layerId+"icon_layer",function(t){r._events.triggerEvt("mouseout")}),this._map._obj.on("mousemove",this.layerId+"icon_layer",function(t){r._map._obj.getCanvas().style.cursor="pointer"})},t.prototype._start=function(){if(this.timer){for(var t=0;t<this.count;t++){var e=this._map._obj.getLayoutProperty(this.layerId+"_symbol"+t,"icon-image"),i=(parseInt(e.replace(this.markerfilename,""))+1)%this._circleImages.length,e=0==i?this.markerfilename+this._circleImages.length:this.markerfilename+i;this._map._obj.setLayoutProperty(this.layerId+"_symbol"+t,"icon-image",e,{undraw:!0})}var o,r,n=this._map.getPitch()/60*this._tagOffset[1];this.hideLine||(r=this._map._obj.getLayoutProperty(this.layerId+"_line","icon-image"),r=0==(o=(parseInt(r.replace(this.linefilename,""))+1)%this._lineImages.length)?this.linefilename+this._lineImages.length:this.linefilename+o,this._map._obj.setLayoutProperty(this.layerId+"_line","icon-image",r,{undraw:!0}),this._map._obj.setLayoutProperty(this.layerId+"_line","icon-size",this._map.getPitch()/60*1,{undraw:!0}),this._map._obj.getLayer(this.layerId+"icon_layer")&&this._map._obj.setLayoutProperty(this.layerId+"icon_layer","icon-offset",[0,n],{undraw:!0})),this._map._obj._update(!0),this.timer&&setTimeout(this._start.bind(this),this.interval)}},t.prototype.clearPoints=function(){if(this.timer=!1,this._layers.length){for(var t=0;t<this._layers.length;t++)this._map._obj.removeLayer(this._layers[t].id);this._layers.length=0,this._map._obj.removeSource(this.layerId),this._source.data.features=[]}},t.prototype.hide=function(){if(this.timer=!1,this._layers.length&&this._visible){for(var t=0;t<this._layers.length;t++)this._map._obj.setLayoutProperty(this._layers[t].id,"visibility","none");this._visible=!1}},t.prototype.show=function(){if(this._layers.length&&!this._visible){for(var t=0;t<this._layers.length;t++)this._map._obj.setLayoutProperty(this._layers[t].id,"visibility","visible");this.timer=!0,this._start(),this._visible=!0}},t.prototype.setVisibleByPointID=function(t,e){for(var i=0;i<this._source.data.features.length;i++)if(this._source.data.features[i].properties.dataID===t)return void(this._source.data.features[i].properties.visible=e)},t.prototype.refresh=function(){this._map._obj.getSource(this.layerId).setData(this._source.data)},t.prototype.addEventListener=function(t,e){this._events.register(t,e)},t.prototype.removeEventListener=function(t,e){this._events.unregister(t,e)}}(),function(){var t=ZenMap.Symbols.MultiAnimationLine=function(t,e,i){if(this._map=t,this._lines=e,this.id=ZenMap.Utils.BaseUtils.uuid(),this._source={type:"geojson",lineMetrics:!0,data:{type:"FeatureCollection",features:[]}},this._opts=i||{},this._step=this._opts.step||.005,this._segment=this._opts.segment||.3,this._interval=this._opts.interval||20,this._lineWidth=this._opts.lineWidth||3,this._displayWidth=this._opts.displayWidth||null,this._lineColor=this._opts.lineColor||"rgba(255,0,0,1)",this._lineJoin=this._opts.lineJoin||"round",this._lineCap=this._opts.lineCap||"round",this._minZoom=this._opts.minZoom||0,this._maxZoom=this._opts.maxZoom||22,this._lineGradient=this._opts.lineGradient||null,this._beforeLayerID=this._opts.beforeLayerID||"city_normal_building_id",this._lineGradient&&0<this._lineGradient.length)for(var o=0;o<this._lineGradient.length;o++)this._lineGradient[o][1]=this._colorRgb(this._lineGradient[o][1]);this._layerCount=this._lineGradient&&0<this._lineGradient.length?this._lineGradient.length:1,this._useLineGradient=!!(this._lineGradient&&0<this._lineGradient.length),this._layers=[],this._layerIndex={}};t.prototype.load=function(){this._source.data.features=[];for(var t=0;t<this._lines.length;t++){var e=this._lines[t],i=e.getData().value,o=this._useLineGradient?this._getLineTypeByValue(i):0;feature={type:"Feature",geometry:{type:"LineString",coordinates:e._getCoordinates(this._map)},properties:{layertype:o}},this._source.data.features.push(feature)}this._map._obj.addSource(this.id+"_source",this._source);for(var r=0;r<this._layerCount;r++){var o=r,n={id:this.id+"_line"+r,type:"line",source:this.id+"_source",layout:{"line-join":this._lineJoin,"line-cap":this._lineCap},paint:{"line-width":this._lineWidth,"line-blur":3,"line-color":"#FFFF00","line-gradient":["interpolate",["linear"],["line-progress"],0,"rgba(0,0,0,0)",.01,this._useLineGradient?this._lineGradient[r][1]:this._lineColor,.01000001,"rgba(0,0,0,0)",1,"rgba(0,0,0,0)"]},minzoom:this._minZoom,maxzoom:this._maxZoom,filter:["==","layertype",o]};this._displayWidth&&4==this._displayWidth.length&&(n.paint["line-width"]=["interpolate",["linear"],["zoom"],this._displayWidth[0],this._displayWidth[1],this._displayWidth[2],this._displayWidth[3]]),this._map._obj.addLayer(n),this._map._obj.getLayer(this._beforeLayerID)&&this._map._obj.moveLayer(this.id+"_line"+r,this._beforeLayerID),this._layers.push(n),this._layerIndex[n.id]=Math.floor(Math.random()*(1/this._step)+1)}this.timer=!0,this._updata()},t.prototype._getLineTypeByValue=function(t){for(var e=1;e<this._lineGradient.length;e++)if(t>=this._lineGradient[e-1][0]&&t<this._lineGradient[e][0])return e-1;return this._lineGradient.length-1},t.prototype._updata=function(){if(this.timer){for(var t=0;t<this._layerCount;t++){var e,i=++this._layerIndex[this.id+"_line"+t]*this._step,o=this._useLineGradient?this._lineGradient[t][1]:this._lineColor;1<i&&(i=this._step,this._layerIndex[this.id+"_line"+t]=1),i==this._segment?this._map._obj.setPaintProperty(this.id+"_line"+t,"line-gradient",["interpolate",["linear"],["line-progress"],0,"rgba(0,0,0,0)",i,o,i+1e-4,"rgba(0,0,0,0)",1,"rgba(0,0,0,0)"],{undraw:!0}):1==i?this._map._obj.setPaintProperty(this.id+"_line"+t,"line-gradient",["interpolate",["linear"],["line-progress"],0,"rgba(0,0,0,0)",i-this._segment,"rgba(0,0,0,0)",i,o],{undraw:!0}):i>this._segment?this._map._obj.setPaintProperty(this.id+"_line"+t,"line-gradient",["interpolate",["linear"],["line-progress"],0,"rgba(0,0,0,0)",i-this._segment,"rgba(0,0,0,0)",i,o,i+1e-4,"rgba(0,0,0,0)",1,"rgba(0,0,0,0)"],{undraw:!0}):(e=1-i/this._segment,e=o.substring(0,o.lastIndexOf(",")+1)+e+")",this._map._obj.setPaintProperty(this.id+"_line"+t,"line-gradient",["interpolate",["linear"],["line-progress"],0,e,i,o,i+1e-4,"rgba(0,0,0,0)",1-this._segment+i,"rgba(0,0,0,0)",1,e],{undraw:!0}))}this.timer&&setTimeout(this._updata.bind(this),this._interval)}},t.prototype.unLoad=function(){if(this.timer=!1,this._layers.length){for(var t=0;t<this._layers.length;t++)this._map._obj.removeLayer(this._layers[t].id);this._map._obj.removeSource(this.id+"_source")}},t.prototype._colorRgb=function(t){if((t=t.toLowerCase())&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){if(4===t.length){for(var e="#",i=1;i<4;i+=1)e+=t.slice(i,i+1).concat(t.slice(i,i+1));t=e}for(var o=[],i=1;i<7;i+=2)o.push(parseInt("0x"+t.slice(i,i+2)));return"rgba("+o.join(",")+",1)"}return-1<t.indexOf("rgb")&&11==t.length?t.slice(0,t.indexOf(")"))+",1)":t}}(),function(){var t=ZenMap.Symbols.MultiAnimationPoints=function(t,e){this.layerId=ZenMap.Utils.BaseUtils.uuid(),this._map=t,this._layers=[],this.opts=e||{},this.style,this.timer,this._visible=!0,this.minZoom=this.opts.minZoom||0,this.maxZoom=this.opts.maxZoom||22,this.circleColor=this.opts.circleColor||"#ffffff",this.circleStrokeColor=this.opts.circleStrokeColor||"#f2f2f3",this.circleStrokeWidth=this.opts.circleStrokeWidth||1,this.circleRadius=this.opts.circleRadius||2,this.count=this.opts.count||5,this.flashcount=this.opts.flashcount||2,this.flashcount=this.flashcount>this.count?this.count:this.flashcount,this.step=.05,this.currentTimer=null,this.interval=this.opts.interval||100,this._source={type:"geojson",data:{type:"FeatureCollection",features:[]}}};t.prototype.addPoints=function(t){if(!this._map._obj.getSource(this.layerId)&&t.length){this._points=t;t=this._points.length>this.count?this.count:this._points.length;t<this.count&&(this.count=t);for(var e=0;e<this._points.length;e++){var i=ZenMap.T.setPoint(this._map,this._points[e]),o=Math.floor(Math.random()*this.count);this._source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[i.lon,i.lat]},properties:{id:this._points[e].id,layertype:o}})}this._map._obj.addSource(this.layerId,this._source),this._createLayer(),this.timer=!0,this._start()}},t.prototype._createLayer=function(){for(var t=0;t<this.count;t++){var e=.8*Math.random(),e={id:this.layerId+"_point"+t,type:"circle",source:this.layerId,paint:{"circle-radius":this.circleRadius,"circle-color":this.circleColor,"circle-stroke-width":this.circleStrokeWidth,"circle-stroke-color":this.circleStrokeColor,"circle-stroke-opacity":e,"circle-opacity":e,"circle-translate-anchor":"viewport","circle-pitch-scale":"viewport","circle-pitch-alignment":"viewport"},minzoom:this.minZoom,maxzoom:this.maxZoom,filter:["==","layertype",t]};this._layers.push(e),e.step=this.step,this._map._obj.addLayer(e)}},t.prototype._start=function(){if(this.timer&&(!this._map||!this._map._obj)){for(var t=0;t<this.flashcount;t++){var e=this._map._obj.getPaintProperty(this.layerId+"_point"+t,"circle-opacity");.8<(e+=this._layers[t].step)?(e=.8,this._layers[t].step=0-this._layers[t].step,e+=this._layers[t].step):e<0&&(this._layers[t].step=(e=0)-this._layers[t].step,e+=this._layers[t].step),this._map._obj.setPaintProperty(this.layerId+"_point"+t,"circle-opacity",e),this._map._obj.setPaintProperty(this.layerId+"_point"+t,"circle-stroke-opacity",e)}this.timer&&(this.currentTimer=setTimeout(this._start.bind(this),this.interval))}},t.prototype.clearPoints=function(){if(clearTimeout(this.currentTimer),this.timer=!1,this._layers.length){for(var t=0;t<this._layers.length;t++)this._map._obj.removeLayer(this._layers[t].id);this._layers.length=0,this._map._obj.removeSource(this.layerId),this._source.data.features=[]}},t.prototype.hide=function(){if(this.timer=!1,this._layers.length&&this._visible){for(var t=0;t<this._layers.length;t++)this._map._obj.setLayoutProperty(this._layers[t].id,"visibility","none");this._visible=!1}},t.prototype.show=function(){if(this._layers.length&&!this._visible){for(var t=0;t<this._layers.length;t++)this._map._obj.setLayoutProperty(this._layers[t].id,"visibility","visible");this.timer=!0,this._start(),this._visible=!0}}}(),function(){var t=ZenMap.Layers.GaoDeLayer=function(t,e,i){if(this.name=e,this.id=ZenMap.Utils.BaseUtils.uuid(),this.visible=!0,this._opts={fullExtent:[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892],isBaseLayer:!0},i)for(var o in i){var r;!i.hasOwnProperty(o)||void 0!==(r=i[o])&&(this._opts[o]=r)}if(this._opts.minZoom=this._opts.minZoom||0,this._opts.maxZoom=this._opts.maxZoom||18,t instanceof Array){if(this._opts.classic&&"vector"==this._opts.type)for(var n=0;n<t.length;n++)t[n]=t[n]+"&classic=false";this.urls=t}else this.urls=this._opts.classic&&"vector"==this._opts.type?[t+"&classic=true"]:[t];for(n=0;n<this.urls.length;n++)-1==this.urls[n].indexOf("http://")&&-1==this.urls[n].indexOf("https://")&&(this.urls[n]=window.location.origin+this.urls[n]);e=++ZenMap.LayerIndex;this._sourceID="GaoDeLayerSource"+e,this._layerID="GaoDeLayer"+e,this.style=this._getStyle(this._opts),this.CLASS_NAME="ZenMap.Layers.GaoDeLayer"};(t.prototype=new ZenMap.Layer)._getStyle=function(t){if("vector"!=t.type)return(e={version:8,sources:{},sprite:ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/gaode",glyphs:ZenMap.Utils.BaseUtils.getHostPath()+"/lib/fonts/{fontstack}/{range}.pbf",layers:[{id:this._layerID,type:"raster",source:this._sourceID,minzoom:t.minZoom,maxzoom:t.maxZoom}]}).sources[this._sourceID]={type:"raster",tiles:this.urls,tileSize:256},e;var e={sprite:ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/gaode",glyphs:ZenMap.Utils.BaseUtils.getHostPath()+"/lib/fonts/{fontstack}/{range}.pbf",version:8,sources:{},layers:[{id:"background",interactive:!0,paint:{"background-color":"#fcf9f2"},type:"background"},{id:"city_normal_region",type:"fill",source:this._sourceID,"source-layer":"region",layout:{},paint:{"fill-color":["string",["get","style"]],"fill-outline-color":["string",["get","style"]],"fill-opacity":1,"fill-antialias":!0},filter:["in","labels","regions:green","regions:business","regions:edu","regions:public","regions:health","regions:scenicSpot","regions:parkingLot","regions:sports","regions:traffic","water"]},{id:"city_normal_line",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":["string",["get","fillStyle"]],"line-width":["number",["get","width"]],"line-opacity":1},filter:["in","labels","borders:foreign","borders:China","borders:provincial"]},{id:"city_normal_region_subway",type:"fill",source:this._sourceID,"source-layer":"region",layout:{},paint:{"fill-color":["string",["get","style"]],"fill-outline-color":["string",["get","style"]],"fill-opacity":1,"fill-antialias":!0},filter:["==","labels","regions:subway"]},{id:"city_normal_line_underPass",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":["string",["get","fillStyle"]],"line-width":["number",["get","width"]],"line-opacity":1},filter:["==","labels","roads:underPass"]},{id:"city_normal_line_railway_stroke",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":"hsl(4, 1%, 52.0%)","line-width":3,"line-opacity":1},filter:["==","labels","roads:railway"]},{id:"city_normal_line_railway_fill",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":"hsl(0, 0.0%, 100.0%)","line-width":2,"line-opacity":1,"line-dasharray":[6,6]},filter:["==","labels","roads:railway"]},{id:"city_normal_line_highSpeedRailway_stroke",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":"hsl(4, 48.6%, 71.0%)","line-width":3,"line-opacity":1},filter:["==","labels","roads:highSpeedRailway"]},{id:"city_normal_line_highSpeedRailway_fill",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":"hsl(0, 0.0%, 100.0%)","line-width":2,"line-opacity":1,"line-dasharray":[6,6]},filter:["==","labels","roads:highSpeedRailway"]},{id:"city_normal_line_roadsBeingBuilt_fill",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":"hsl(191, 4.0%, 67.0%)","line-width":8,"line-opacity":1,"line-dasharray":[2,2]},minzoom:16,maxzoom:22,filter:["==","labels","roads:roadsBeingBuilt"]},{id:"city_normal_line_roadsBeingBuilt_stroke",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":["string",["get","fillStyle"]],"line-width":["number",["get","width"]],"line-opacity":1},minzoom:16,maxzoom:22,filter:["==","labels","roads:roadsBeingBuilt"]},{id:"city_normal_line_other",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":["string",["get","fillStyle"]],"line-width":["number",["get","width"]],"line-opacity":1},minzoom:16,maxzoom:22,filter:["==","labels","roads:other"]},{id:"city_normal_line_road",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":["string",["get","fillStyle"]],"line-width":["number",["get","width"]],"line-opacity":1},filter:["in","labels","roads:levelFourRoad","roads:levelThreeRoad","roads:secondaryRoad","roads:provincialRoad","roads:nationalRoad","roads:ringRoad","roads:highWay","roads:subway"]},{id:"city_normal_line_subwayBeingBuilt_fill",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":"hsl(191, 4.0%, 67.0%)","line-width":3,"line-opacity":1,"line-dasharray":[4,4]},minzoom:13,maxzoom:22,filter:["==","labels","roads:subwayBeingBuilt"]},{id:"city_normal_line_overPass",type:"line",source:this._sourceID,"source-layer":"road",layout:{"line-join":"bevel","line-cap":"butt"},paint:{"line-color":["string",["get","fillStyle"]],"line-width":12,"line-opacity":1},minzoom:17,maxzoom:22,filter:["==","labels","roads:overPass"]},{id:"city_normal_road_label_id",type:"symbol",source:this._sourceID,"source-layer":"road_label",filter:["all",["!=","labels","roads:guideBoards"],["!=","name",""]],layout:{"text-pitch-alignment":"map","text-rotation-alignment":"map","text-allow-overlap":!0,"text-field":"{name}","text-font":["Microsoft YaHei"],"text-size":{base:13,stops:[[16,13],[20,14]]}},paint:{"text-color":["string",["get","text_color"]],"text-halo-width":.1,"text-halo-color":["string",["get","text_halo_color"]]}},{id:"city_normal_road_label_img_id",type:"symbol",source:this._sourceID,"source-layer":"road_label",filter:["==","labels","roads:guideBoards"],layout:{"text-field":"{name}","text-font":["Microsoft YaHei"],"icon-image":"{icon-image}","text-size":9,"icon-offset":[0,0],"icon-size":1.1},paint:{"text-color":["string",["get","text_color"]],"text-halo-width":1,"text-halo-color":["string",["get","text_halo_color"]]}},{id:"city_normal_building_id",type:"fill-extrusion",source:this._sourceID,"source-layer":"building",layout:{},paint:{"fill-extrusion-color":"rgb(224,226,213)","fill-extrusion-opacity":.8,"fill-extrusion-height":["number",["get","fill-extrusion-height"]],"fill-extrusion-base":0,"fill-extrusion-vertical-gradient":!0},minzoom:12},{id:"city_normal_poi",type:"symbol",source:this._sourceID,"source-layer":"poi",layout:{"text-field":"{name}","text-font":["Microsoft YaHei"],"text-size":{base:13,stops:[[16,13],[20,14]]},"icon-image":"{icon-image}","text-offset":[0,.6],"text-anchor":"top","icon-size":.8},paint:{"text-color":["string",["get","text_color"]],"text-halo-width":1,"text-halo-color":["string",["get","text_halo_color"]]},filter:["all",["in","code","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],["!=","icon-image","24_360"],["!=","icon-image","72_360"]]},{id:"city_normal_subway_kou",type:"symbol",source:this._sourceID,"source-layer":"poi",layout:{"text-field":"{name}","text-font":["Microsoft YaHei"],"text-size":12,"icon-image":"{icon-image}","text-offset":[0,-.6],"text-anchor":"top","icon-size":.8},paint:{"text-color":["string",["get","text_color"]],"text-halo-width":1,"text-halo-color":["string",["get","text_halo_color"]]},filter:["in","icon-image","24_360","72_360"]},{id:"city_normal_district",type:"symbol",source:this._sourceID,"source-layer":"poi",layout:{"text-field":"{name}","text-font":["Microsoft YaHei"],"text-size":13,"icon-offset":[0,-17]},paint:{"text-color":["string",["get","text_color"]],"text-halo-width":1,"text-halo-color":["string",["get","text_halo_color"]]},filter:["in","labels","water","labels:city","labels:district","labels:town","labels:village","labels:aois"]}]};if(t.classic)for(var i=["city_normal_poi_vehicle","city_normal_poi_moto","city_normal_poi_live","city_normal_poi_canyin","city_normal_poi_gouwu","city_normal_poi_other","city_normal_poi_public","city_normal_poi_hotel","city_normal_poi_address"],o=0;o<i.length;o++)for(var r=0;r<e.layers.length;r++)e.layers[r].id==i[o]&&e.layers.splice(r,1);return e.sources[this._sourceID]={type:"vector",tiles:this.urls,maxzoom:t.maxZoom,minzoom:t.minZoom},e},t.prototype.setStyle=function(e){var t,i=this;if(e)if("string"==typeof e){switch(e){case"blue":t="style_blue";break;case"green":t="style_green";break;case"purple":t="style_purple"}var o=ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/"+t+".json";ZenMap.Utils.Request.Get(o,"",function(t){e=JSON.parse(t),i._setMapStyle(e)},function(){console.log("error")},!1)}else e=e.styleJson||e,i._setMapStyle(e)},t.prototype._setMapStyle=function(t){for(var e=0;e<t.length;e++)for(var i=0;i<this.style.layers.length;i++)if(this.style.layers[i].id===t[e].featureType){for(var o in t[e])"featureType"!=o&&"elementType"!=o&&(this.style.layers[i].layout=this.style.layers[i].layout||{},"visibility"===o||"icon-image"===o?this.style.layers[i].layout[o]=t[e][o]:"filter"==o?this.style.layers[i].filter=t[e][o]:("fill-color"==o&&(this.style.layers[i].paint["fill-outline-color"]=t[e][o]),this.style.layers[i].paint[o]=t[e][o]));break}},t.prototype.show=function(){if(this.visible=!0,this._map)if("vector"==this._opts.type)for(var t=this.style.layers,e=0;e<t.length;e++)this._map._obj.setLayoutProperty(t[e].id,"visibility","visible");else this._map._obj.setLayoutProperty(this._layerID,"visibility","visible")},t.prototype.hide=function(){if(this.visible=!1,this._map)if("vector"==this._opts.type)for(var t=this.style.layers,e=0;e<t.length;e++)this._map._obj.setLayoutProperty(t[e].id,"visibility","none");else this._map._obj.setLayoutProperty(this._layerID,"visibility","none")},t.prototype.hideRoomBuild=function(){this._map&&("vector"==this._opts.type&&this._map._obj.getLayer("city_normal_building_id")&&this._map._obj.setFilter("city_normal_building_id",["==","room",0]),"vector"==this._opts.type&&this._map._obj.getLayer("city_normal_buildingTop_id")&&this._map._obj.setFilter("city_normal_buildingTop_id",["==","room",0]))},t.prototype.showAllBuild=function(){this._map&&("vector"==this._opts.type&&this._map._obj.getLayer("city_normal_building_id")&&this._map._obj.setFilter("city_normal_building_id",null),"vector"==this._opts.type&&this._map._obj.getLayer("city_normal_buildingTop_id")&&this._map._obj.setFilter("city_normal_buildingTop_id",null))},t.prototype.showBuilding=function(){if("vector"==this._opts.type)for(var t=this.style.layers,e=0;e<t.length;e++)"city_normal_building_id"===t[e].id&&(t[e].layout.visibility="visible");this._map&&"vector"==this._opts.type&&this._map._obj.getLayer("city_normal_building_id")&&this._map._obj.setLayoutProperty("city_normal_building_id","visibility","visible")},t.prototype.hideBuilding=function(){if("vector"==this._opts.type)for(var t=this.style.layers,e=0;e<t.length;e++)"city_normal_building_id"===t[e].id&&(t[e].layout.visibility="none");this._map&&"vector"==this._opts.type&&this._map._obj.getLayer("city_normal_building_id")&&this._map._obj.setLayoutProperty("city_normal_building_id","visibility","none")},t.prototype.setBuild2D=function(){this._map&&"vector"==this._opts.type&&this._map._obj.getLayer("city_normal_building_id")&&this._map._obj.setPaintProperty("city_normal_building_id","fill-extrusion-height",0)},t.prototype.setBuild3D=function(){this._map&&"vector"==this._opts.type&&this._map._obj.getLayer("city_normal_building_id")&&this._map._obj.setPaintProperty("city_normal_building_id","fill-extrusion-height",["number",["get","fill-extrusion-height"]])},t.prototype.setBuildColor=function(t,e){if(e=e||t,"vector"==this._opts.type)for(var i=this.style.layers,o=0;o<i.length;o++)"city_normal_building_id"===i[o].id&&(i[o].paint["fill-extrusion-color"]=t,i[o].paint["fill-extrusion-basecolor"]=e);this._map&&"vector"==this._opts.type&&this._map._obj.getLayer("city_normal_building_id")&&(this._map._obj.setPaintProperty("city_normal_building_id","fill-extrusion-color",t),this._map._obj.setPaintProperty("city_normal_building_id","fill-extrusion-basecolor",e))},t.prototype.changeBuildStyle=function(t,e){if("vector"===this._opts.type&&this._map._obj.getLayer("city_normal_building_id")){for(var i,o=-1,r=0;r<this.style.layers.length;r++)"city_normal_building_id"==this.style.layers[r].id&&(o=r);-1!=o&&(t&&(t.hightScale&&(this.style.layers[o].paint["fill-extrusion-height"]=["*",t.hightScale,["number",["get","fill-extrusion-height"]]],this._map&&this._map._obj.setPaintProperty("city_normal_building_id","fill-extrusion-height",["*",t.hightScale,["number",["get","fill-extrusion-height"]]])),t.opacity&&(this.style.layers[o].paint["fill-extrusion-opacity"]=t.opacity,this._map&&this._map._obj.setPaintProperty("city_normal_building_id","fill-extrusion-opacity",t.opacity)),t.buildColors&&(t.buildColors instanceof Array?((i=["step",["get","fill-extrusion-height"]]).push.apply(i,t.buildColors),this.style.layers[o].paint["fill-extrusion-color"]=i,this._map&&this._map._obj.setPaintProperty("city_normal_building_id","fill-extrusion-color",i)):(this.style.layers[o].paint["fill-extrusion-color"]=t.buildColors,this._map&&this._map._obj.setPaintProperty("city_normal_building_id","fill-extrusion-color",t.buildColors))),t.buildImages&&(t.buildImages instanceof Array?((i=["step",["get","fill-extrusion-height"]]).push.apply(i,t.buildImages),this.style.layers[o].paint["fill-extrusion-pattern"]=i,this._map&&this._map._obj.setPaintProperty("city_normal_building_id","fill-extrusion-pattern",i)):(this.style.layers[o].paint["fill-extrusion-pattern"]=t.buildImages,this._map&&this._map._obj.setPaintProperty("city_normal_building_id","fill-extrusion-pattern",t.buildImages)))),e?this._map._obj.getLayer("city_normal_buildingTop_id")?(this._map._obj.setPaintProperty("city_normal_buildingTop_id","fill-extrusion-color",this.style.layers[o].paint["fill-extrusion-color"]),this._map._obj.setPaintProperty("city_normal_buildingTop_id","fill-extrusion-opacity",this.style.layers[o].paint["fill-extrusion-opacity"])):(e=t&&t.topHight?t.topHight:0,t={id:"city_normal_buildingTop_id",type:"fill-extrusion",source:this._sourceID,"source-layer":"building",paint:{"fill-extrusion-color":this.style.layers[o].paint["fill-extrusion-color"],"fill-extrusion-opacity":this.style.layers[o].paint["fill-extrusion-opacity"],"fill-extrusion-translate-anchor":"map","fill-extrusion-height":["+",e,t&&t.hightScale?["*",t.hightScale,["number",["get","fill-extrusion-height"]]]:["number",["get","fill-extrusion-height"]]],"fill-extrusion-base":t&&t.hightScale?["*",t.hightScale,["number",["get","fill-extrusion-height"]]]:["number",["get","fill-extrusion-height"]]},minzoom:12},this._map._obj.addLayer(t,this.style.layers[o+1].id)):this._map._obj.getLayer("city_normal_buildingTop_id")&&this._map._obj.removeLayer("city_normal_buildingTop_id"))}}}(),function(){var t=ZenMap.Layers.VectorLayer=function(t,e,i){if(this.name=e,this.id=ZenMap.Utils.BaseUtils.uuid(),this.visible=!0,this._opts={fullExtent:[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892],isBaseLayer:!0},i)for(var o in i){var r;!i.hasOwnProperty(o)||void 0!==(r=i[o])&&(this._opts[o]=r)}this._opts.minZoom=this._opts.minZoom||0,this._opts.maxZoom=this._opts.maxZoom||22;var n,e=++ZenMap.LayerIndex;for(n in this._sourceID=[],this._layerID="VectorLayer"+e,this.style=this._opts.style,this.style.sprite=this.style.sprite||ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/gaode",this.style.glyphs=this.style.glyphs||ZenMap.Utils.BaseUtils.getHostPath()+"/lib/fonts/{fontstack}/{range}.pbf",this.style.sources)if(this.style.sources.hasOwnProperty(n)){this._sourceID.push(n);for(o=0;o<this.style.sources[n].tiles.length;o++)this._opts.scheme&&(this.style.sources[n].scheme=this._opts.scheme),-1==this.style.sources[n].tiles[o].indexOf("http://")&&-1==this.style.sources[n].tiles[o].indexOf("https://")&&(this.style.sources[n].tiles[o]=window.location.origin+this.style.sources[n].tiles[o])}this.CLASS_NAME="ZenMap.Layers.VectorLayer"};(t.prototype=new ZenMap.Layer).show=function(){if(this.visible=!0,this._map)for(var t=0;t<this.style.layers.length;t++)this._map._obj.setLayoutProperty(this.style.layers[t].id,"visibility","visible")},t.prototype.hide=function(){if(this.visible=!1,this._map)for(var t=0;t<this.style.layers.length;t++)this._map._obj.setLayoutProperty(this.style.layers[t].id,"visibility","none")},t.prototype.setStyleLayers=function(i){var o=this;if(i&&i.style&&i.style.sources&&(Object.keys(i.style.sources).forEach(function(t){var e=o._map._obj.getSource(t);e&&e.tiles[0]!==i.style.sources[t].tiles[0]&&(e.tiles=i.style.sources[t].tiles,o._map._obj.style.sourceCaches[t].clearTiles())}),this.style.sources=i.style.sources),this._map)for(var t=0;t<this.style.layers.length;t++)this._map._obj.removeLayer(this.style.layers[t].id);if(this.style.layers=i&&i.style&&i.style.layers?i.style.layers:i,this._map)for(t=0;t<this.style.layers.length;t++)this._map._obj.addLayer(this.style.layers[t])}}(),function(){var t=ZenMap.Layers.GoogleLayer=function(t,e,i){if(this.name=e,this.id=ZenMap.Utils.BaseUtils.uuid(),this.visible=!0,this._opts={fullExtent:[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892],isBaseLayer:!0},i)for(var o in i){var r;!i.hasOwnProperty(o)||void 0!==(r=i[o])&&(this._opts[o]=r)}this._opts.minZoom=this._opts.minZoom||0,this._opts.maxZoom=this._opts.maxZoom||22,t instanceof Array?this.urls=t:this.urls=[t];for(var n=0;n<this.urls.length;n++)-1==this.urls[n].indexOf("http://")&&-1==this.urls[n].indexOf("https://")&&(this.urls[n]=window.location.origin+this.urls[n]);t=++ZenMap.LayerIndex;this._sourceID="GoogleLayerSource"+t,this._layerID="GoogleLayer"+t,this.style=this._getStyle(this._opts),this.CLASS_NAME="ZenMap.Layers.GoogleLayer"};(t.prototype=new ZenMap.Layer)._getStyle=function(t){t={version:8,sources:{},glyphs:ZenMap.Utils.BaseUtils.getHostPath()+"/lib/fonts/{fontstack}/{range}.pbf",layers:[{id:this._layerID,type:"raster",source:this._sourceID,minzoom:t.minZoom,maxzoom:t.maxZoom}]};return t.sources[this._sourceID]={type:"raster",tiles:this.urls,tileSize:256},t},t.prototype.show=function(){this.visible=!0,this._map&&this._map._obj.setLayoutProperty(this._layerID,"visibility","visible")},t.prototype.hide=function(){this.visible=!1,this._map&&this._map._obj.setLayoutProperty(this._layerID,"visibility","none")}}(),function(){var t=ZenMap.Layers.OverlayLayer=function(t,e,i){this.name=t,this.id=ZenMap.Utils.BaseUtils.uuid(),this.opts=i=i||{},this._overlays={},this.useCluster=e,this.onmouseover=i.mouseover||function(){},this.onmouseout=i.mouseout||function(){},this.onSelect=i.click||function(){},this.clusteronmouseover=i.clusteronmouseover||function(){},this.clusterImage=i.clusterImage||"",this.showClusterText=!1!==i.showClusterText,this.maxZoom=i.maxZoom||16,this.distance=i.distance||200,this.selectZoom=i.selectZoom,this.isAsynchronous=!0,this.labelYOffset=null,this.minZoom=null,this.statistics=[],this.groups={},this.minClusterCount=0,this.isCommonCluster=!0,this.customLabelOffset=null,this.visible=!0,this.ModifyFeatureControl,this.context,this._menu,this.CLASS_NAME="ZenMap.Layers.OverlayLayer";t=++ZenMap.LayerIndex;if(this._layerID="OverlayLayer"+t,this.clusterClickModel=i.clusterClickModel||"",this.markerMinZoom=i.markerMinZoom||0,this.markerMaxZoom=i.markerMaxZoom||20,this.circleMinZoom=i.circleMinZoom||0,this.circleMaxZoom=i.circleMaxZoom||20,this._markerTypes={},this._source={type:"geojson",data:{type:"FeatureCollection",features:[]}},this.opts.hasTempPoint&&(this._tempSource={type:"geojson",data:{type:"FeatureCollection",features:[]}}),e){if(this._source.cluster=!0,this._source.clusterMaxZoom=this.maxZoom?this.maxZoom-1:16,this._source.clusterRadius=this.distance,this._clusterLayer={id:this._layerID+"clusters",type:"symbol",source:this._layerID+"_source",filter:["has","point_count"]},this.showClusterText?(i=this.opts.textSize||12,e=this.opts.labelOffset?[this.opts.labelOffset[0]/i,0-this.opts.labelOffset[1]/i]:this.opts.labelYOffset?[0,0-this.opts.labelYOffset/i]:[0,0],this._clusterLayer.layout={"text-field":"{point_count}","text-font":["Microsoft YaHei"],"text-offset":e,"icon-allow-overlap":!0,"text-allow-overlap":!0,"text-size":i,"text-anchor":this.opts.textAnchor||"center"},this._clusterLayer.paint={"text-color":this.opts.textColor||"#000"}):this._clusterLayer.layout={},this.clusterImage instanceof Array){this._clusterLayer.layout["icon-image"]=["step",["get","point_count"]];for(var o=0;o<this.clusterImage.length;o++)this._clusterLayer.layout["icon-image"].push(this.clusterImage[o])}else this._clusterLayer.layout["icon-image"]=this.clusterImage;this._markerLayer={id:this._layerID+"unclustered_point",type:"symbol",source:this._layerID+"_source",filter:["all",["!has","point_count"],["==","visible",1]],layout:{"icon-image":["get","icon"],"text-field":"{title}","text-font":["Microsoft YaHei"],"text-offset":["get","text-offset"],"icon-allow-overlap":!0,"icon-offset":["get","icon-offset"],"icon-rotate":["get","icon-rotate"],"icon-size":["get","icon-size"],"text-size":["get","text-size"],"text-anchor":"center"},paint:{"text-opacity":["get","text-opacity"],"icon-opacity":["get","icon-opacity"],"text-color":["get","text-color"]}},this.opts.hasExendMarker&&(this._mapMarkerLayer={id:this._layerID+"unmapclustered_point",type:"symbol",source:this._layerID+"_source",filter:["all",["!has","point_count"],["==","visible",1]],layout:{"icon-image":["get","extend-icon"],"icon-allow-overlap":!0,"icon-offset":["get","extendIcon-offset"],"icon-rotate":["get","extendIcon-rotate"],"icon-size":["get","extendIcon-size"],"icon-rotation-alignment":"map"},paint:{"icon-opacity":["get","extendIcon-opacity"]}}),this._activeMarkerLayer={id:this._layerID+"unclustered_point_active",type:"symbol",source:this._layerID+"_source",filter:["all",["!has","point_count"],["==","visible",1],["==","id",""]],layout:{"icon-image":["get","icon"],"icon-allow-overlap":!0,"text-field":"{title}","text-font":["Microsoft YaHei"],"text-offset":["get","text-offset"],"icon-offset":["get","icon-offset"],"icon-rotate":["get","icon-rotate"],"icon-size":["get","icon-size"],"text-size":["get","text-size"],"text-anchor":"center"},paint:{"text-opacity":["get","text-opacity"],"icon-opacity":["get","icon-opacity"],"text-color":["get","text-color"]}},this.opts.hasTempPoint&&(this._tempPointLayer={id:this._layerID+"unclustered_point_temp",type:"circle",source:this._layerID+"_tempSource",filter:["all",["!has","point_count"],["==","visible",1]],paint:{"circle-radius":this.opts.circleRadius||5,"circle-color":this.opts.circleColor||"red","circle-opacity":this.opts.circleOpacity||1,"circle-stroke-width":this.opts.circleStrokeWidth||1,"circle-stroke-color":this.opts.circleStrokeColor||"#FFFFFF","circle-stroke-opacity":this.opts.circleStrokeOpacity||1},minzoom:0,maxzoom:22})}else this._markerLayer={id:this._layerID+"_symbol",type:"symbol",source:this._layerID+"_source",layout:{"icon-image":["get","icon"],"text-field":"{title}","text-font":["Microsoft YaHei"],"text-offset":["get","text-offset"],"icon-offset":["get","icon-offset"],"icon-size":["get","icon-size"],"text-size":["get","text-size"],"icon-allow-overlap":!0,"text-allow-overlap":!0,"icon-ignore-placement":!0,"text-ignore-placement":!1,"text-anchor":"center"},paint:{"text-color":["get","text-color"],"text-opacity":["get","text-opacity"],"text-halo-color":["get","text-halo-color"],"text-halo-width":["get","text-halo-width"],"icon-opacity":["get","icon-opacity"]},filter:["all",["==","$type","Point"],["!=","icon-rotation-alignment","map"],["==","visible",!0]],minzoom:this.markerMinZoom,maxzoom:this.markerMaxZoom},this._mapMarkerLayer={id:this._layerID+"_mapsymbol",type:"symbol",source:this._layerID+"_source",layout:{"icon-image":["get","icon"],"text-field":"{title}","text-font":["Microsoft YaHei"],"text-offset":["get","text-offset"],"icon-offset":["get","icon-offset"],"icon-rotate":["get","icon-rotate"],"icon-size":["get","icon-size"],"text-size":["get","text-size"],"icon-allow-overlap":!0,"icon-ignore-placement":!0,"text-allow-overlap":!0,"icon-rotation-alignment":"map","text-anchor":"center"},paint:{"text-color":["get","text-color"],"text-opacity":["get","text-opacity"],"icon-opacity":["get","icon-opacity"]},filter:["all",["==","$type","Point"],["==","icon-rotation-alignment","map"],["==","visible",!0]],minzoom:this.markerMinZoom,maxzoom:this.markerMaxZoom},this._pointLayer={id:this._layerID+"_point",type:"circle",source:this._layerID+"_source",paint:{"circle-radius":["interpolate",["linear"],["zoom"],this.circleMinZoom,["get","minRadius"],this.circleMaxZoom,["get","maxRadius"]],"circle-color":["get","circle-color"],"circle-opacity":["interpolate",["linear"],["zoom"],this.circleMinZoom,["get","circle-opacity"],this.circleMaxZoom,.8],"circle-translate-anchor":"viewport","circle-pitch-scale":"viewport","circle-pitch-alignment":"viewport"},filter:["all",[">","circle-radius",0],["==","$type","Point"],["==","visible",!0]],minzoom:this.circleMinZoom,maxzoom:this.circleMaxZoom},this._lineLayer={id:this._layerID+"_line",type:"line",source:this._layerID+"_source",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","color"],"line-width":["get","width"],"line-opacity":["get","opacity"]},filter:["all",["any",["==","$type","LineString"],["==","$type","Polygon"]],["==","hasDash",!1],["==","visible",!0]]},this._dashlineLayer={id:this._layerID+"_dashline",type:"line",source:this._layerID+"_source",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","color"],"line-width":["get","width"],"line-opacity":["get","opacity"],"line-dasharray":[3,3]},filter:["all",["any",["==","$type","LineString"],["==","$type","Polygon"]],["==","hasDash",!0],["==","visible",!0]]},this._polygonLayer={id:this._layerID+"_polygon",type:"fill",source:this._layerID+"_source",paint:{"fill-color":["get","fillColor"],"fill-opacity":["get","fillOpacity"],"fill-outline-color":["get","color"]},filter:["all",["==","$type","Polygon"],["==","visible",!0]]};this._map=null};(t.prototype=new ZenMap.Layer).setClusterExtentMarkerVisible=function(t){this.opts.hasExendMarker&&this._map?this._map._obj.setLayoutProperty(this._mapMarkerLayer.id,"visibility",t?"visible":"none"):this.opts.hasExendMarker&&(this._mapMarkerLayer.layout.visibility=t?"visible":"none")},t.prototype._addEvents=function(){var i=this;if(!this.useCluster)for(var t=[this._layerID+"_symbol",this._layerID+"_line",this._layerID+"_polygon",this._layerID+"_mapsymbol",this._layerID+"_dashline"],e=0;e<t.length;e++)this._map._obj.on("mousemove",t[e],function(t){var e;t.features[0].properties.visible&&(i._map._obj.getCanvas().style.cursor="pointer",e=t.features[0].properties.id,i._overlays[e]&&(t=ZenMap.T.getPoint(i._map,{lon:t.lngLat.lng,lat:t.lngLat.lat}),i._overlays[e]._events.triggerEvt("mousemove",t)))})},t.prototype._removeEvents=function(){var i=this;if(!this.useCluster)for(var t=[this._layerID+"_symbol",this._layerID+"_line",this._layerID+"_polygon",this._layerID+"_mapsymbol",this._layerID+"_dashline"],e=0;e<t.length;e++)this._map._obj.off("mousemove",t[e],function(t){var e;t.features[0].properties.visible&&(i._map._obj.getCanvas().style.cursor="pointer",e=t.features[0].properties.id,i._overlays[e]&&(t=ZenMap.T.getPoint(i._map,{lon:t.lngLat.lng,lat:t.lngLat.lat}),i._overlays[e]._events.triggerEvt("mousemove",t)))})},t.prototype._clearClusterPoint=function(){this._tempSource&&this._tempSource.data.features&&0<this._tempSource.data.features.length&&(this._tempSource.data.features=[],this._map._obj.getSource(this._layerID+"_tempSource").setData(this._tempSource.data))},t.prototype._clusterClickFun=function(t){var e,i=this._map._getFeatures(t)[0];i.properties.cluster&&(e=ZenMap.T.getPoint(this._map,{lon:i.geometry.coordinates[0],lat:i.geometry.coordinates[1]}),e=new ZenMap.Geometry.Point(e.lon,e.lat),"zoom"==this.clusterClickModel?this.selectZoom?this._map.zoomTo(e,this.selectZoom):(t=this._map.getMaxZoom(),i=this._map.getZoom(),this._map.zoomTo(e,i=t<(i+=1)?t:i)):this._map.zoomTo(e,this._source.clusterMaxZoom+1))},t.prototype._clusterOverFun=function(t){var o,e;this._map.isDrawing||(e=t.properties.id,(o=this)._tempSource&&!e&&t.properties.cluster?(t=t.properties.cluster_id,this._map._obj.getSource(this._layerID+"_source").getClusterLeaves(t,200,0,function(t,e){if(!t){for(var i=0;i<e.length;i++)o._tempSource.data.features.push(e[i]);o._map._obj.getSource(o._layerID+"_tempSource").setData(o._tempSource.data)}})):this._map._obj.setFilter(this._activeMarkerLayer.id,["all",["!has","point_count"],["==","visible",1],["==","id",e]]))},t.prototype._clusterOutFun=function(){this._map._obj.setFilter(this._activeMarkerLayer.id,["all",["!has","point_count"],["==","visible",1],["==","id",""]])},t.prototype.addOverlay=function(t,e,i){if(!this._overlays[t.id]){if(this._overlays[t.id]=t,this.useCluster&&(this._cId=t.id),"ZenMap.Geometry.Star"==t.CLASS_NAME){var o=ZenMap.T.setPoint(this._map,t._position);this._source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[o.lon,o.lat]},properties:{id:t.id,layerId:this._layerID,"circle-radius":t._radius,minRadius:t._radius,maxRadius:t._radius,"circle-opacity":t._visible?t.opacity:0,"circle-color":t._color,visible:t._visible}})}else if("ZenMap.Symbols.Marker"==t.CLASS_NAME){var o=ZenMap.T.setPoint(this._map,t._position),r=t.getLabel();this._source.data.features.unshift({type:"Feature",geometry:{type:"Point",coordinates:[o.lon,o.lat]},properties:{id:t.id,layerId:this._layerID,title:r?r.getContent():"",icon:t.getIcon()?t.getIcon().getImageUrl():void 0,"icon-offset":t.getIcon()?t.getIcon().getAnchor().toArray():void 0,"text-offset":r?r._getOffset().toArray():void 0,"text-opacity":r?t._visible&&r._visible?r.getOpacity():0:void 0,"icon-opacity":t._visible?1:0,"icon-rotate":t._rotation,"icon-size":t.getIcon()?t.getIcon().getImageSize():void 0,"text-size":r?r._fontSize:void 0,"text-halo-color":r?r._bgColor:void 0,"text-halo-width":r?r._haloWith:0,"icon-rotation-alignment":t.getIcon()&&t.getIcon()._showInMap?"map":"viewport","text-color":r?r._color:void 0,visible:t._visible,minRadius:t.opts&&t.opts.circle?t.opts.circle.minRadius||1:null,maxRadius:t.opts&&t.opts.circle?t.opts.circle.maxRadius||5:null,"circle-radius":t.opts&&t.opts.circle?t.opts.circle.defaultRadius||3:null,"circle-opacity":t.opts&&t.opts.circle?t.opts.circle.opacity||.5:null,"circle-color":t.opts&&t.opts.circle?t.opts.circle.color||"red":null}})}else if("ZenMap.Symbols.Label"==t.CLASS_NAME){o=ZenMap.T.setPoint(this._map,t._position);this._source.data.features.unshift({type:"Feature",geometry:{type:"Point",coordinates:[o.lon,o.lat]},properties:{id:t.id,layerId:this._layerID,title:t.getContent(),"text-offset":t._getOffset().toArray(),"text-opacity":t._visible?t.getOpacity():0,"text-size":t._fontSize,"text-color":t._color,"text-halo-color":t._bgColor||void 0,"text-halo-width":t._haloWith||0,visible:t._visible}})}else if("ZenMap.Geometry.Polyline"==t.CLASS_NAME)this._source.data.features.push({type:"Feature",geometry:{type:t._lineType,coordinates:t._getCoordinates(this._map)},properties:{id:t.id,layerId:this._layerID,color:t._color,width:t._weight,hasDash:t._lineStyle!=ZenMap.LINE_TYPE_SOLID,opacity:t._visible?t._opacity:0,join:"round",visible:t._visible}});else if("ZenMap.Geometry.Polygon"==t.CLASS_NAME){o=ZenMap.T.setPoint(this._map,t.getCenter());(n=t._text)&&this._source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[o.lon,o.lat]},properties:{id:t.id,title:n.getContent(),"text-offset":n._getOffset().toArray(),"text-opacity":n._visible?n.getOpacity():0,"text-size":n._fontSize,"text-color":n._color,visible:t._visible}}),this._source.data.features.push({type:"Feature",geometry:{type:"MultiPolygon"!==t.polygonType?"Polygon":"MultiPolygon",coordinates:t._getCoordinates(this._map)},properties:{id:t.id,layerId:this._layerID,color:t._color,width:t._weight,opacity:t._visible?t._opacity:0,hasDash:t._lineStyle!=ZenMap.LINE_TYPE_SOLID,fillColor:t._fillColor,fillOpacity:t._visible?t._fillOpacity:0,visible:t._visible}})}else if("ZenMap.Geometry.Circle"==t.CLASS_NAME){o=ZenMap.T.setPoint(this._map,t.getCenter());(n=t._text)&&this._source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[o.lon,o.lat]},properties:{id:t.id,title:n.getContent(),"text-offset":n._getOffset().toArray(),"text-opacity":n._visible?n.getOpacity():0,"text-size":n._fontSize,"text-color":n._color,visible:t._visible}}),this._source.data.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:t._getCoordinates(this._map)},properties:{id:t.id,layerId:this._layerID,color:t._color,width:t._weight,opacity:t._visible?t._opacity:0,hasDash:t._lineStyle!=ZenMap.LINE_TYPE_SOLID,fillColor:t._fillColor,fillOpacity:t._visible?t._fillOpacity:0,visible:t._visible}})}else if("ZenMap.Geometry.CircleSector"==t.CLASS_NAME)this._source.data.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:t._getCoordinates(this._map)},properties:{id:t.id,layerId:this._layerID,color:t._color,width:t._weight,opacity:t._visible?t._opacity:0,hasDash:t._lineStyle!=ZenMap.LINE_TYPE_SOLID,fillColor:t._fillColor,fillOpacity:t._visible?t._fillOpacity:0,visible:t._visible}});else if("ZenMap.Geometry.ellipse"==t.CLASS_NAME)this._source.data.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:t._getCoordinates(this._map)},properties:{id:t.id,layerId:this._layerID,color:t._color,width:t._weight,opacity:t._visible?t._opacity:0,hasDash:t._lineStyle!=ZenMap.LINE_TYPE_SOLID,fillColor:t._fillColor,fillOpacity:t._visible?t._fillOpacity:0,visible:t._visible}});else if("ZenMap.Geometry.Rectangle"==t.CLASS_NAME){var n,o=ZenMap.T.setPoint(this._map,t.getCenter());(n=t._text)&&this._source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[o.lon,o.lat]},properties:{id:t.id,title:n.getContent(),"text-offset":n._getOffset().toArray(),"text-opacity":n._visible?n.getOpacity():0,"text-size":n._fontSize,"text-color":n._color,visible:t._visible}}),this._source.data.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:t._getCoordinates(this._map)},properties:{id:t.id,layerId:this._layerID,color:t._color,width:t._weight,opacity:t._visible?t._opacity:0,hasDash:t._lineStyle!=ZenMap.LINE_TYPE_SOLID,fillColor:t._fillColor,fillOpacity:t._visible?t._fillOpacity:0,visible:t._visible}})}else if("ZenMap.Symbols.ClusterPoints"==t.CLASS_NAME)for(var s=0;s<t.dataJson.length;s++){var a={type:"Feature",geometry:{type:"Point",coordinates:[(o=ZenMap.T.setPoint(this._map,t.dataJson[s].location)).lon,o.lat]},properties:{id:t.dataJson[s].id,layerId:this._layerID,title:t.dataJson[s]._context,icon:t.dataJson[s]._image,"extend-icon":t.dataJson[s]._extendImage,"icon-offset":t.dataJson[s]._iconOffset,"extendIcon-offset":t.dataJson[s]._extendIconOffset,"text-offset":t.dataJson[s]._textOffset,"text-opacity":t.dataJson[s]._textOpacity,"icon-opacity":t.dataJson[s]._iconOpacity,"icon-rotate":t.dataJson[s]._rotation,"extendIcon-opacity":t.dataJson[s]._extendIconOpacity,"extendIcon-rotate":t.dataJson[s]._extendIconrotation,"extendIcon-size":t.dataJson[s]._extendIconSize,"icon-size":t.dataJson[s]._iconSize,"text-size":t.dataJson[s]._fontSize,"text-color":t.dataJson[s]._color,visible:t.dataJson[s].location._visible?1:0}};this._markerTypes&&!this._markerTypes[t.dataJson[s].markType]&&(this._markerTypes[t.dataJson[s].markType]=!0),this._source.data.features.push(a),t.dataJson[s]._apiObj=a}t.layer=this,!1!==i&&this.refresh(),e&&e instanceof Function&&e()}},t.prototype.addOverlays=function(t){if(ZenMap.Utils.BaseUtils.isTypeRight(t,"Array")){for(var e=0;e<t.length;e++)this.addOverlay(t[e],null,!1);this.refresh()}},t.prototype.getOverlays=function(){return this._overlays},t.prototype.getOverlaysArray=function(){var t,e=[];for(t in this._overlays)this._overlays.hasOwnProperty(t)&&e.push(this._overlays[t]);return e},t.prototype.containFeatures=function(t,e){return t instanceof ZenMap.Geometry.Extent?this._findOverlaysByExtent(t,e):this._findOverlaysByGeometry(t,e)},t.prototype.getOverlay=function(t){return this._overlays[t]},t.prototype.getOverlaysByProperty=function(t,e){var i,o=[];for(i in this._overlays)if(this._overlays.hasOwnProperty(i))if(this._overlays[i]instanceof ZenMap.Symbols.ClusterPoints)for(var r=0;r<this._overlays[i].dataJson.length;r++)this._overlays[i].dataJson[r].getData()[t]===e&&o.push(this._overlays[i].dataJson[r]);else this._overlays[i].getData()&&this._overlays[i].getData()[t]===e&&o.push(this._overlays[i]);return o},t.prototype.showOverlaysByProperty=function(t,e){for(i=0;i<this._source.data.features.length;i++){var o=this._source.data.features[i].properties.id;!this._overlays[o]||this._overlays[o]instanceof ZenMap.Symbols.ClusterPoints||this._overlays[o].getData()[t]===e&&(this._source.data.features[i].properties.visible=!0)}this.refresh()},t.prototype.hideOverlaysByProperty=function(t,e){for(i=0;i<this._source.data.features.length;i++){var o=this._source.data.features[i].properties.id;!this._overlays[o]||this._overlays[o]instanceof ZenMap.Symbols.ClusterPoints||this._overlays[o].getData()[t]===e&&(this._source.data.features[i].properties.visible=!1)}this.refresh()},t.prototype.removeOverlay=function(t,e){var i,o;if(t){if("string"==typeof t&&this._overlays[t])o=this._overlays[i=t];else{if(!t.id||!this._overlays[t.id])return;i=t.id,o=t}if("ZenMap.Symbols.ClusterPoints"===o.CLASS_NAME)this._overlays[i]&&(this._source.data.features=[]);else{o._modify&&(o._modify.disableEdit(),o._modify=null);for(var r=0;r<this._source.data.features.length;r++)this._source.data.features[r].properties.id===i&&(this._source.data.features.splice(r,1),r--)}o.layer=null,delete this._overlays[i],e||this.refresh()}},t.prototype.removeAllOverlays=function(){for(var t in this._source.data.features=[],this._overlays)this._overlays.hasOwnProperty(t)&&(this._overlays[t]._modify&&(this._overlays[t]._modify.disableEdit(),this._overlays[t]._modify=null),this._overlays[t].layer=null,delete this._overlays[t]);this._overlays={},this.refresh()},t.prototype.getFeature=function(t){for(var e=[],i=0;i<this._source.data.features.length;i++)this._source.data.features[i].properties.id===t&&e.push(this._source.data.features[i]);return 1==e.length?e[0]:e},t.prototype._findOverlaysByExtent=function(t,e){e=e||function(t){return!0};var i,o=[];for(i in this._overlays)if(this._overlays.hasOwnProperty(i))if(this._overlays[i]instanceof ZenMap.Symbols.ClusterPoints)for(var r=this._overlays[i].dataJson.length-1;0<=r;r--){var n=this._overlays[i].dataJson[r].location;t.containsPoint(n)&&e(this._overlays[i].dataJson[r])&&o.push(this._overlays[i].dataJson[r])}else this._overlays[i]&&t.containsExtent(this._overlays[i].getExtent())&&e(this._overlays[i])&&o.push(this._overlays[i]);return o},t.prototype._findOverlaysByGeometry=function(t,e){e=e||function(t){return!0};var i,o=[],r=t.getExtent();for(i in this._overlays)if(this._overlays.hasOwnProperty(i))if(this._overlays[i]instanceof ZenMap.Symbols.ClusterPoints)for(var n=this._overlays[i].dataJson.length-1;0<=n;n--){var s=this._overlays[i].dataJson[n].location;s.lon<r.left||s.lon>r.right||s.lat<r.bottom||s.lat>r.top||ZenMap.Utils.MapUtil.ContainsPoint(t.getPath(),s)&&e(this._overlays[i].dataJson[n])&&o.push(this._overlays[i].dataJson[n])}else t.containsPoint(this._overlays[i].getPosition())&&e(this._overlays[i])&&o.push(this._overlays[i]);return o},t.prototype.show=function(){this.visible=!0,this._map&&(this.useCluster?(this._mapMarkerLayer&&this._map._obj.setLayoutProperty(this._mapMarkerLayer.id,"visibility","visible"),this._map._obj.setLayoutProperty(this._clusterLayer.id,"visibility","visible"),this._map._obj.setLayoutProperty(this._activeMarkerLayer.id,"visibility","visible"),this._map._obj.setLayoutProperty(this._markerLayer.id,"visibility","visible"),this._tempPointLayer&&this._map._obj.setLayoutProperty(this._tempPointLayer.id,"visibility","visible")):(this._map._obj.setLayoutProperty(this._layerID+"_symbol","visibility","visible"),this._map._obj.setLayoutProperty(this._layerID+"_mapsymbol","visibility","visible"),this._map._obj.setLayoutProperty(this._layerID+"_line","visibility","visible"),this._map._obj.setLayoutProperty(this._layerID+"_dashline","visibility","visible"),this._map._obj.setLayoutProperty(this._layerID+"_polygon","visibility","visible"),this._map._obj.setLayoutProperty(this._pointLayer.id,"visibility","visible")))},t.prototype.hide=function(){this.visible=!1,this._map&&(this.useCluster?(this._mapMarkerLayer&&this._map._obj.setLayoutProperty(this._mapMarkerLayer.id,"visibility","none"),this._map._obj.setLayoutProperty(this._clusterLayer.id,"visibility","none"),this._map._obj.setLayoutProperty(this._activeMarkerLayer.id,"visibility","none"),this._map._obj.setLayoutProperty(this._markerLayer.id,"visibility","none"),this._tempPointLayer&&this._map._obj.setLayoutProperty(this._tempPointLayer.id,"visibility","none")):(this._map._obj.setLayoutProperty(this._layerID+"_symbol","visibility","none"),this._map._obj.setLayoutProperty(this._layerID+"_mapsymbol","visibility","none"),this._map._obj.setLayoutProperty(this._layerID+"_line","visibility","none"),this._map._obj.setLayoutProperty(this._layerID+"_dashline","visibility","none"),this._map._obj.setLayoutProperty(this._layerID+"_polygon","visibility","none"),this._map._obj.setLayoutProperty(this._pointLayer.id,"visibility","none")))},t.prototype.setMakrerTypeVisiable=function(t,e){if(this.useCluster&&this._overlays[this._cId]&&this._overlays[this._cId].dataJson){this._markerTypes[t]=e,this._source.data.features=[];for(var i,o=0;o<this._overlays[this._cId].dataJson.length;o++)this._markerTypes[t]&&this._overlays[this._cId].dataJson[o].location._visible&&(i={type:"Feature",geometry:{type:"Point",coordinates:[(i=ZenMap.T.setPoint(this._map,this._overlays[this._cId].dataJson[o].location)).lon,i.lat]},properties:{id:this._overlays[this._cId].dataJson[o].id,layerId:this._layerID,title:this._overlays[this._cId].dataJson[o]._context,icon:this._overlays[this._cId].dataJson[o]._image,"extend-icon":this._overlays[this._cId].dataJson[o]._extendImage,"icon-offset":this._overlays[this._cId].dataJson[o]._iconOffset,"extendIcon-offset":this._overlays[this._cId].dataJson[o]._extendIconOffset,"text-offset":this._overlays[this._cId].dataJson[o]._textOffset,"text-opacity":this._overlays[this._cId].dataJson[o]._textOpacity,"icon-opacity":this._overlays[this._cId].dataJson[o]._iconOpacity,"icon-rotate":this._overlays[this._cId].dataJson[o]._rotation,"extendIcon-opacity":this._overlays[this._cId].dataJson[o]._extendIconOpacity,"extendIcon-rotate":this._overlays[this._cId].dataJson[o]._extendIconrotation,"extendIcon-size":this._overlays[this._cId].dataJson[o]._extendIconSize,"icon-size":this._overlays[this._cId].dataJson[o]._iconSize,"text-size":this._overlays[this._cId].dataJson[o]._fontSize,"text-color":this._overlays[this._cId].dataJson[o]._color,visible:1}},this._source.data.features.push(i)),this._overlays[this._cId].dataJson[o]._apiObj=i;this.refresh()}},t.prototype.addClusterPoints=function(t){this._clusterOverFun(t.feature)},t.prototype.removeCluster=function(t){if(this.useCluster&&t){var e=t.id;if(t instanceof ZenMap.Symbols.ClusterMarker){for(var i=0;i<this._source.data.features.length;i++)if(this._source.data.features[i].properties.id===e){this._source.data.features.splice(i,1);break}for(i=0;i<this._overlays[this._cId].dataJson.length;i++)if(this._overlays[this._cId].dataJson[i].id==e){this._overlays[this._cId].dataJson.splice(i,1);break}}this.refresh()}},t.prototype._addCluster=function(t){var e;this.useCluster&&t&&t instanceof ZenMap.Symbols.ClusterMarker&&(e={type:"Feature",geometry:{type:"Point",coordinates:[(e=ZenMap.T.setPoint(this._map,t.location)).lon,e.lat]},properties:{id:t.id,title:t._context,icon:t._image,"icon-offset":t._iconOffset,"text-offset":t._textOffset,"text-opacity":t._textOpacity,"icon-opacity":t._iconOpacity,"icon-rotate":t._rotation,"icon-size":t._iconSize,"text-size":t._fontSize,"text-color":t._color,"extendIcon-opacity":t._extendIconOpacity,"extendIcon-rotate":t._extendIconrotation,"extendIcon-size":t._extendIconSize,visible:t.location._visible?1:0}},void 0===this._markerTypes[t.markType]&&(this._markerTypes[t.markType]=!0),this._source.data.features.push(e),t._apiObj=e,this._overlays[this._cId],t.container=this._overlays[this._cId],this._overlays[this._cId].dataJson.push(t))},t.prototype.addCluster=function(t){this.useCluster&&(this._overlays[this._cId]?(this._addCluster(t),this.refresh()):(t=new ZenMap.Symbols.ClusterPoints([t]),this.addOverlay(t)))},t.prototype.addClusters=function(t){if(this.useCluster){if(t instanceof Array){if(!this._overlays[this._cId]){var e=new ZenMap.Symbols.ClusterPoints(t);return void this.addOverlay(e)}for(var i=0;i<t.length;i++)this._addCluster(t[i])}this.refresh()}},t.prototype.filterClusterMarks=function(t){t=t||function(t){return!0};var e,i=[];for(e in this._overlays)if(this._overlays.hasOwnProperty(e))if(this._overlays[e]instanceof ZenMap.Symbols.ClusterPoints)for(var o=this._overlays[e].dataJson.length-1;0<=o;o--){this._overlays[e].dataJson[o].location;t(this._overlays[e].dataJson[o])&&i.push(this._overlays[e].dataJson[o])}else this._overlays[e]&&t(this._overlays[e])&&i.push(this._overlays[e]);return i},t.prototype.addGroup=function(t){return this.useCluster||""===t?null:(this.groups[t]||(this.groups[t]=new ZenMap.Layers.LayerGroup(t,this)),this.groups[t])},t.prototype.removeGroup=function(t){this.useCluster||this.groups[t]&&(this.groups[t].removeAllOverlays(),delete this.groups[t])},t.prototype.removeAllGroups=function(){if(!this.useCluster){for(var t in this.groups)this.groups.hasOwnProperty(t)&&(this.groups[t].removeAllOverlays(),delete this.groups[t]);this.groups={}}},t.prototype.getAllGroups=function(){return this.useCluster?{}:this.groups},t.prototype.getGroupByName=function(t){return this.groups[t]},t.prototype.refresh=function(){if(this.useCluster){this._source.data.features=[];for(var t=0;t<this._overlays[this._cId].dataJson.length;t++){var e,i=this._overlays[this._cId].dataJson[t].markType;this._markerTypes[i]&&this._overlays[this._cId].dataJson[t].location._visible&&(e={type:"Feature",geometry:{type:"Point",coordinates:[(e=ZenMap.T.setPoint(this._map,this._overlays[this._cId].dataJson[t].location)).lon,e.lat]},properties:{id:this._overlays[this._cId].dataJson[t].id,layerId:this._layerID,title:this._overlays[this._cId].dataJson[t]._context,icon:this._overlays[this._cId].dataJson[t]._image,"extend-icon":this._overlays[this._cId].dataJson[t]._extendImage,"icon-offset":this._overlays[this._cId].dataJson[t]._iconOffset,"extendIcon-offset":this._overlays[this._cId].dataJson[t]._extendIconOffset,"text-offset":this._overlays[this._cId].dataJson[t]._textOffset,"text-opacity":this._overlays[this._cId].dataJson[t]._textOpacity,"icon-opacity":this._overlays[this._cId].dataJson[t]._iconOpacity,"icon-rotate":this._overlays[this._cId].dataJson[t]._rotation,"extendIcon-opacity":this._overlays[this._cId].dataJson[t]._extendIconOpacity,"extendIcon-rotate":this._overlays[this._cId].dataJson[t]._extendIconrotation,"extendIcon-size":this._overlays[this._cId].dataJson[t]._extendIconSize,"icon-size":this._overlays[this._cId].dataJson[t]._iconSize,"text-size":this._overlays[this._cId].dataJson[t]._fontSize,"text-color":this._overlays[this._cId].dataJson[t]._color,visible:1}},this._source.data.features.push(e)),this._overlays[this._cId].dataJson[t]._apiObj=e}}this._map&&this._map._obj.getSource(this._layerID+"_source")&&this._map._obj.getSource(this._layerID+"_source").setData(this._source.data)}}(),function(){var t=ZenMap.Layers.HeatMapLayer=function(t,e){this.name=t,this.id=ZenMap.Utils.BaseUtils.uuid(),this.CLASS_NAME="ZenMap.Layers.HeatMapLayer";t=++ZenMap.LayerIndex;this._layerID="HeatMapLayer"+t,this._minZoom=e&&e.minZoom?e.minZoom:0,this._maxZoom=e&&e.maxZoom?e.maxZoom:20,this._minRadius=e&&e.minRadius?e.minRadius:20,this._maxZoomOpacity=e&&e.maxZoomOpacity?e.maxZoomOpacity:0,this._maxRadius=e&&e.maxRadius?e.maxRadius:80,this._maxValue=e&&e.maxValue?e.maxValue:100,this._legend=e&&e.legend?e.legend:[0,"rgba(0,255,0,0)",.5,"rgba(0,255,0,0.8)",1,"rgba(255,0,0,0.8)"],this._source={type:"geojson",data:{type:"FeatureCollection",features:[]}},e&&e.data&&this.setData(data),this._layer={id:this._layerID,type:"heatmap",source:this._layerID+"_source",minzoom:this._minZoom,maxzoom:this._maxZoom,paint:{"heatmap-weight":["interpolate",["linear"],["get","value"],0,0,this._maxValue,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],this._minZoom,2,this._maxZoom,4],"heatmap-color":["interpolate",["linear"],["heatmap-density"]],"heatmap-radius":["interpolate",["linear"],["zoom"],this._minZoom,this._minRadius,this._maxZoom,this._maxRadius],"heatmap-opacity":["interpolate",["linear"],["zoom"],this._minZoom,1,this._maxZoom,this._maxZoomOpacity]}};for(var i=0;i<this._legend.length;i++)this._layer.paint["heatmap-color"].push(this._legend[i])};(t.prototype=new ZenMap.Layer).setData=function(t){this._source.data.features=[];for(var e=0,i=t.length;e<i;e++){var o=this._map?ZenMap.T.setPoint(this._map,t[e]):t[e];this._source.data.features.push({type:"Feature",geometry:{type:"Point",coordinates:[o.lon,o.lat]},properties:{value:t[e].value||0}})}this._map&&this._map._obj.getSource(this._layerID+"_source").setData(this._source.data)},t.prototype.show=function(){this._map._obj.setLayoutProperty(this._layerID,"visibility","visible")},t.prototype.hide=function(){this._map._obj.setLayoutProperty(this._layerID,"visibility","none")}}(),function(){var t=ZenMap.Layers.GeoJsonLayer=function(t,e){this.id=ZenMap.Utils.BaseUtils.uuid(),this._data=e?e.data:null,this.name=t;t=++ZenMap.LayerIndex;this._handlers={},this._layerID="GeoJsonLayer"+t,this.CLASS_NAME="ZenMap.Layers.GeoJsonLayer",this._source={type:"geojson",data:{type:"FeatureCollection",features:[]}},this._layers=e.layers||[];for(var i=0;i<this._layers.length;i++)this._layers[i].source=this._layerID+"_source";this._data&&this.setData(this._data)};(t.prototype=new ZenMap.Layer).setData=function(t){"geojson"==t.type?this._source=t:"FeatureCollection"==t.type&&(this._source.data=t),this.refresh()},t.prototype.addFeature=function(t){"Feature"==t.type&&this._source.data.features.push(t),this.refresh()},t.prototype.addFeatures=function(t){for(var e=0;e<t.length;e++)"Feature"==t[e].type&&this._source.data.features.push(t[e]);this.refresh()},t.prototype.updataFeatureByID=function(t,e){for(var i=0;i<this._source.data.features.length;i++)this._source.data.features[i].properties.id===t&&(e.properties.id=t,this._source.data.features[i]=e);this.refresh()},t.prototype.clearFeatures=function(){this._source.data.features=[],this.refresh()},t.prototype.delFeatureByID=function(t){for(var e=[],i=0;i<this._source.data.features.length;i++)this._source.data.features[i].properties.id!==t&&e.push(this._source.data.features[i]);this._source.data.features=e,this.refresh()},t.prototype.refresh=function(){this._map&&this._map._obj.getSource(this._layerID+"_source").setData(this._source.data)},t.prototype.addEventLisener=function(t,e){if(this._map){for(var i=[],o=0;o<this._layers.length;o++)i.push(this._layers[o].id);var r=this;this._handlers[t]=function(t){t=r._map._obj.queryRenderedFeatures(t.point,{layers:i});e(0<t.length?t[0]:null)},this._map._obj.on(t,this._handlers[t])}},t.prototype.removeEventLisener=function(t){this._handlers[t]&&this._map._obj.off(t,this._handlers[t])}}(),function(){var t=ZenMap.Layers.LayerGroup=function(t,e){this.CLASS_NAME="ZenMap.Layers.LayerGroup",this.name=t,this.layer=e,this.data=[]};t.prototype.hide=function(){for(var t=0;t<this.data.length;t++)this.data[t].hide()},t.prototype.show=function(){for(var t=0;t<this.data.length;t++)this.data[t].show()},t.prototype.addOverlay=function(t){t.groupName=this.name,this.data.push(t),this.layer.addOverlay(t)},t.prototype.addOverlays=function(t){if(t instanceof Array){for(var e=0;e<t.length;e++)t[e].groupName=this.name,this.data.push(t[e]);this.layer.addOverlays(t)}},t.prototype.removeOverlay=function(t,e){var i=this.data.indexOf(t);if(0<=i){for(var o=0,r=0;o<this.data.length;o++)this.data[o]!==this.data[i]&&(this.data[r++]=this.data[o]);--this.data.length,this.layer.removeOverlay(t,e)}},t.prototype.removeOverlays=function(t){if(t instanceof Array){for(var e=0;e<t.length;e++)this.removeOverlay(t[e],!0);this.layer.refresh()}},t.prototype.removeAllOverlays=function(){for(var t=0;t<this.data.length;t++)this.layer.removeOverlay(this.data[t],!0);this.layer.refresh(),this.data=[]},t.prototype.getAllOverlayers=function(){return this.data},t.prototype.containFeatures=function(t,e){var i=this.layer.containFeatures(t,e),o=[];if(i instanceof Array)for(var r=0;r<i.length;r++)i[r].groupName===this.name&&o.push(i[r]);return o},t.prototype.getOverlaysByProperty=function(t,e){var i=this.layer.getOverlaysByProperty(t,e),o=[];if(i instanceof Array)for(var r=0;r<i.length;r++)i[r].groupName===this.name&&o.push(i[r]);return o},t.prototype.getOverlay=function(t){t=this.layer.getOverlay(t);if(t&&t.groupName===this.name)return t},t.prototype.setZIndex=function(t){for(var e=this.getAllOverlayers(),i=0;i<e.length;i++)e[i].setZIndex(t)},t.prototype.getZIndex=function(){var t=this.getAllOverlayers();if(0!==t.length)return t[0].getZIndex()}}(),function(){var t=ZenMap.Layers.BaiduTileLayer=function(t,e,i){this.id=ZenMap.Utils.BaseUtils.uuid(),this._tileSize=256,this._zoom=void 0,this._opacity=1,this._alreadTiles={},this.visible=!0,this._tileOnlineArr=["http://online0.map.bdimg.com/tile/","http://online1.map.bdimg.com/tile/","http://online2.map.bdimg.com/tile/","http://online3.map.bdimg.com/tile/","http://online4.map.bdimg.com/tile/"];for(var o=0;o<this._tileOnlineArr.length;o++)this._tileOnlineArr[o]+="?qt=tile&x=${x}&y=${y}&z=${z}&styles=pl&udt=20180426";t&&(t instanceof Array?this._tileOnlineArr=t:this._tileOnlineArr=[t]),this.name=e,this.CLASS_NAME="ZenMap.Layers.BaiduTileLayer";e=++ZenMap.LayerIndex;this._sourceID="BaiduTileLayerSource"+e,this._layerID="BaiduTileLayer"+e;var r=this;this.style={version:8,sources:{},glyphs:ZenMap.Utils.BaseUtils.getHostPath()+"/lib/fonts/{fontstack}/{range}.pbf",layers:[]},this.setMap=function(t){this._map=t._obj,this.zoomChanged=!0,this._zoom=t.getZoom(),this._map.on("moveend",this._mapMoveend),this._map.on("load",this._mapMoveend),this._map._loaded&&this._mapMoveend()},this._mapMoveend=function(){var t,e;r.visible&&(e=r.getBdBoundsM(),t=r.getZoomLevelByBoundM(e),r._zoom!=t?r.zoomChanged=!0:r.zoomChanged=!1,e=r.getTilesUrlByBoundM(t,e),r.addImgLayer(e),r._zoom=t)},this.getZoomLevel=function(){return Math.floor(this._map.getZoom())+2},this.getBdBounds=function(){var t=this._map.getBounds();return{sw:this.toBaidu(t._sw),ne:this.toBaidu(t._ne)}},this.toWgs84=function(t){t.lng=t.lng||t.lon;t=ZenMap.T.helper.bd_decrypt(t.lng,t.lat),t=ZenMap.T.helper.gcj2wgs(t.lon,t.lat);return t={lng:t.lon,lat:t.lat}},this.toBaidu=function(t){t.lng=t.lng||t.lon;t=ZenMap.T.helper.transform(t.lng,t.lat),t=ZenMap.T.helper.bd_encrypt(t.lon,t.lat);return t={lng:t.lon,lat:t.lat}},this.getBdBoundsM=function(){var t=this.getBdBounds(),e={lon:t.sw.lng,lat:t.sw.lat},t={lon:t.ne.lng,lat:t.ne.lat};return{sw:{lng:ZenMap.T.Baidu.Fb(e).lon,lat:ZenMap.T.Baidu.Fb(e).lat},ne:{lng:ZenMap.T.Baidu.Fb(t).lon,lat:ZenMap.T.Baidu.Fb(t).lat}}},this.getZoomLevelByBoundM=function(t){return Math.floor(this._map.getZoom())+2},this.getRowColByXY=function(t,e,i){Math.pow(2,18-t);var o=Math.pow(2,18-t)*this._tileSize,e=Math.floor(e/o);return{row:Math.floor(i/o),col:e,level:t}},this.removeLayers=function(){if(this.zoomChanged)for(var t in this._alreadTiles)this._alreadTiles.hasOwnProperty(t)&&(this._alreadTiles[t].used||(this._map.removeLayer(t),this._map.removeSource(t),delete this._alreadTiles[t]));else for(var t in this._alreadTiles){var e,i;this._alreadTiles.hasOwnProperty(t)&&(i=t.split("_"),e=parseInt(i[1]),i=parseInt(i[2]),(2<this.minRC.row-e||2<e-this.maxRC.row||2<this.minRC.col-i||2<i-this.maxRC.col)&&(this._map.removeLayer(t),this._map.removeSource(t),delete this._alreadTiles[t]))}},this.setOpacity=function(t){for(var e in this._opacity=parseFloat(t),this._alreadTiles)this._map.setPaintProperty(e,"raster-opacity",this._opacity)},this.addImgLayer=function(t){for(var e in this._alreadTiles)this._alreadTiles.hasOwnProperty(e)&&(this._alreadTiles[e].used=!1);var i=[];for(e in t){var o=e,r=t[o];this._alreadTiles[o]?this._alreadTiles[o].used=!0:(r={id:o,source:{type:"image",url:this.getTileUrl(r.row,r.col,r.level),coordinates:r.coordinates},type:"raster",paint:{"raster-opacity":this._opacity,"raster-opacity-transition":{duration:0}},used:!0},this._alreadTiles[o]=r,i.push(r))}this._map.addLayers(i);for(var n=this._map.style._order[0],e=0;e<i.length;e++)this._map.moveLayer(i[e].id,n);i.length=0;var s=this;setTimeout(function(){s.removeLayers()},500)},this.getTilesUrlByBoundM=function(t,e){var i=this.getRowColByXY(t,e.sw.lng,e.sw.lat),o=this.getRowColByXY(t,e.ne.lng,e.ne.lat),r=Math.pow(2,18-t)*this._tileSize;this.minRC=i,this.maxRC=o;for(var n={},s=i.row;s<=o.row;s++)for(var a=i.col;a<=o.col;a++){var l=t+"_"+s+"_"+a,h=a*r,p=s*r,c=h+r,u=p+r,d={lng:h,lat:p},f={lng:c,lat:u},p={lng:c,lat:p},u=ZenMap.T.Baidu.ToLL({lng:h,lat:u}),d=ZenMap.T.Baidu.ToLL(d),f=ZenMap.T.Baidu.ToLL(f),p=ZenMap.T.Baidu.ToLL(p),u=this.toWgs84(u),d=this.toWgs84(d),f=this.toWgs84(f),p=this.toWgs84(p);n[l]={row:s,col:a,level:t,coordinates:[[u.lng,u.lat],[f.lng,f.lat],[p.lng,p.lat],[d.lng,d.lat]]}}return n},this.getTileUrl=function(t,e,i){return this._tileOnlineArr[Math.abs(e+t)%this._tileOnlineArr.length].replace("${x}",e).replace("${y}",t).replace("${z}",i)}};t.prototype.show=function(){if(this.visible=!0,this._map)for(var t in this._alreadTiles)this._map.setLayoutProperty(t,"visibility","visible");this._mapMoveend()},t.prototype.hide=function(){if(this.visible=!1,this._map)for(var t in this._alreadTiles)this._map.setLayoutProperty(t,"visibility","none")},t.prototype.clear=function(){if(0!=this._alreadTiles.length){for(var t in this._map.off("moveend",this._mapMoveend),this._map.off("load",this._mapMoveend),this._alreadTiles)this._map.removeLayer(t),this._map.removeSource(t),delete this._alreadTiles[t];this._alreadTiles=[]}}}(),ZenMap.Layers.NPLayer=function(t,e,i){this.url=t,i&&"boolean"==typeof i.isBaseLayer?this.isBaseLayer=i.isBaseLayer:this.isBaseLayer=!0,this.opts=i,this.name=e,this.layerType="tiandi",this.fullExtent=[],this.type="png",this.CLASS_NAME="ZenMap.Layers.NPLayer"},ZenMap.Layers.NPLayer.prototype=new ZenMap.Layer,function(){var r=ZenMap.Layers.ArcgisTileLayer=function(t,e,i){this.id=ZenMap.Utils.BaseUtils.uuid(),this._tileSize=256,this._zoom=void 0,this._opacity=1,this._alreadTiles={},this._url=t,this.CLASS_NAME="ZenMap.Layers.ArcgisTileLayer";t=++ZenMap.LayerIndex;this._sourceID="ArcgisTileSource"+t,this._layerID="ArcgisTileLayer"+t;var o=this;this.style={version:8,sources:{},glyphs:ZenMap.Utils.BaseUtils.getHostPath()+"/lib/fonts/{fontstack}/{range}.pbf",layers:[]},this._tileInfo=i?i.tileInfo:null,this.isLocalMap=i.isLocalMap,this.type=i.type||"png",this.tileOrigin=this._tileInfo?this._tileInfo.origin:null,this.tileSize={w:this._tileInfo.width||this._tileInfo.cols,h:this._tileInfo.height||this._tileInfo.rows},this.setMap=function(t){this._map=t,this.zoomChanged=!0,this._zoom=t.getZoom(),this._map._obj.on("moveend",this._mapMoveend),this._map._obj.on("load",this._mapMoveend),this._map._obj._loaded&&this._mapMoveend()},this._mapMoveend=function(){var t=o._map._obj.getBounds(),e=o.getZoomLevelByBoundM(t);o._zoom!=e?o.zoomChanged=!0:o.zoomChanged=!1,-1<e&&(t=o.getTilesUrlByBoundM(e,t),o.addImgLayer(t),o._zoom=e)},this.addImgLayer=function(t){var e,i=[];for(n in this._alreadTiles)this._alreadTiles.hasOwnProperty(n)&&(this._alreadTiles[n].used=!1);for(e in t){var o=t[e];this._alreadTiles[e]?this._alreadTiles[e].used=!0:(o={id:e,source:{type:"image",url:this.getTileUrl(o.row,o.col,o.level),coordinates:o.coordinates},type:"raster",paint:{"raster-opacity":this._opacity,"raster-opacity-transition":{duration:0}},used:!0},this._alreadTiles[e]=o,i.push(o))}this._map._obj.addLayers(i);for(var r=this._map._obj.style._order[0],n=0;n<i.length;n++)this._map._obj.moveLayer(i[n].id,r);i.length=0;var s=this;setTimeout(function(){s.removeLayers()},500)},this.getRowColByXY=function(t,e,i){var o=this._tileInfo.lods[t].resolution,e=Math.floor(Math.abs((this.tileOrigin.x-e)/(o*this.tileSize.w)));return{row:Math.floor(Math.abs((this.tileOrigin.y-i)/(o*this.tileSize.h))),col:e,level:t,resolution:o}},this.removeLayers=function(){if(this.zoomChanged)for(var t in this._alreadTiles)this._alreadTiles.hasOwnProperty(t)&&(this._alreadTiles[t].used||(this._map._obj.removeLayer(t),this._map._obj.removeSource(t),delete this._alreadTiles[t]));else for(var t in this._alreadTiles){var e,i;this._alreadTiles.hasOwnProperty(t)&&(i=t.split("_"),e=parseInt(i[2]),i=parseInt(i[3]),(2<this.minRC.row-e||2<e-this.maxRC.row||2<this.minRC.col-i||2<i-this.maxRC.col)&&(this._map._obj.removeLayer(t),this._map._obj.removeSource(t),delete this._alreadTiles[t]))}},this._getDistance=function(t,e){var i=t.lon||t.x,o=t.lat||t.y,t=e.lon||e.x,e=e.lat||e.y;return Math.sqrt(Math.pow(i-t,2)+Math.pow(o-e,2))},this.getZoomLevelByBoundM=function(t){for(var e,i=new ZenMap.Geometry.Point(t._sw.lng,(t._sw.lat+t._ne.lat)/2),o=new ZenMap.Geometry.Point(t._ne.lng,(t._sw.lat+t._ne.lat)/2),r=this._map.pointToPixel(o),t=this._map.pointToPixel(i),r=this._getDistance(t,r),n=this._getDistance(i,o)/r,s=0;s<this._tileInfo.lods.length;s++)if(n>=this._tileInfo.lods[s].resolution){e=0<s&&n-this._tileInfo.lods[s].resolution>this._tileInfo.lods[s-1].resolution-n?s-1:s;break}return e=n>2*this._tileInfo.lods[0].resolution?-1:e},this.getTilesUrlByBoundM=function(t,e){var t=Math.round(t),i=this.getRowColByXY(t,e._sw.lng,e._ne.lat),o=this.getRowColByXY(t,e._ne.lng,e._sw.lat),r=this._tileInfo.lods[t].resolution*this._tileSize;this.minRC=i,this.maxRC=o;i.col,this.tileOrigin.x,this.tileOrigin.x,i.row;for(var n={},s=i.col;s<=o.col;s++)for(var a=i.row;a<=o.row;a++){var l=this._layerID+"_"+t+"_"+a+"_"+s,h=s*r+this.tileOrigin.x,p=this.tileOrigin.y-a*r,c=(s+1)*r+this.tileOrigin.x,u=this.tileOrigin.y-(a+1)*r;n[l]={row:a,col:s,level:t,coordinates:[[h,p],[c,p],[c,u],[h,u]]}}return n},this.getTileUrl=function(t,e,i){return this.isLocalMap?this._url+"/L"+i.toString().padStart(2,"0")+"/R"+t.toString(16).padStart(8,"0")+"/C"+e.toString(16).padStart(8,"0")+"."+this.type:this._url+"/tile/"+i+"/"+t+"/"+e},r.prototype.show=function(){if(this.visible=!0,this._map)for(var t in this._alreadTiles)this._map._obj.setLayoutProperty(t,"visibility","visible")},r.prototype.hide=function(){if(this.visible=!1,this._map)for(var t in this._alreadTiles)this._map._obj.setLayoutProperty(t,"visibility","none")},r.prototype.clear=function(){if(0!=this._alreadTiles.length){for(var t in this._map._obj.off("moveend",this._mapMoveend),this._map._obj.off("load",this._mapMoveend),this._alreadTiles)this._map._obj.removeLayer(t),this._map._obj.removeSource(t),delete this._alreadTiles[t];this._alreadTiles=[]}}}}(),function(){var r=ZenMap.Layers.EzMapTileLayer=function(t,e,i){this.id=ZenMap.Utils.BaseUtils.uuid(),this._tileSize=256,this._zoom=void 0,this._opacity=1,this._alreadTiles={},this._zoomOffset=i&&i.zoomOffset?i.zoomOffset:0,this._yOffset=!(!i||!i.yOffset)&&i.yOffset,this._serviceVersion=i&&i.serviceVersion?i.serviceVersion:.3,this._url=t,this.CLASS_NAME="ZenMap.Layers.EzMapTileLayer";t=++ZenMap.LayerIndex;this._sourceID="EzMapTileSource"+t,this._layerID="EzMapTileLayer"+t;var o=this;this.style={version:8,sources:{},glyphs:ZenMap.Utils.BaseUtils.getHostPath()+"/lib/fonts/{fontstack}/{range}.pbf",layers:[]},this.maxResolution=2,this.tileOrigin={x:0,y:0},this.tileSize={w:256,h:256},this.setMap=function(t){this._map=t,this.zoomChanged=!0,this._zoom=t.getZoom(),this._map._obj.on("moveend",this._mapMoveend),this._map._obj.on("load",this._mapMoveend),this._map._obj._loaded&&this._mapMoveend()},this._mapMoveend=function(){var t=o._map._obj.getBounds(),e=o.getZoomLevelByBoundM(t);o._zoom!=e?o.zoomChanged=!0:o.zoomChanged=!1,-1<e&&(t=o.getTilesUrlByBoundM(e,t),o.addImgLayer(t),o._zoom=e)},this.addImgLayer=function(t){var e,i=[];for(n in this._alreadTiles)this._alreadTiles.hasOwnProperty(n)&&(this._alreadTiles[n].used=!1);for(e in t){var o=t[e];this._alreadTiles[e]?this._alreadTiles[e].used=!0:(o={id:e,source:{type:"image",url:this.getTileUrl(o.row,o.col,o.level),coordinates:o.coordinates},type:"raster",paint:{"raster-opacity":this._opacity,"raster-opacity-transition":{duration:0}},used:!0},this._alreadTiles[e]=o,i.push(o))}this._map._obj.addLayers(i);for(var r=this._map._obj.style._order[0],n=0;n<i.length;n++)this._map._obj.moveLayer(i[n].id,r);i.length=0;var s=this;setTimeout(function(){s.removeLayers()},500)},this.getRowColByXY=function(t,e,i){var o=this.maxResolution/Math.pow(2,t),e=Math.round(Math.abs((this.tileOrigin.x-e)/(o*this.tileSize.w)));return{row:Math.round(Math.abs((this.tileOrigin.y-i)/(o*this.tileSize.h))),col:e,level:t,resolution:o}},this.removeLayers=function(){if(this.zoomChanged)for(var t in this._alreadTiles)this._alreadTiles.hasOwnProperty(t)&&(this._alreadTiles[t].used||(this._map._obj.removeLayer(t),this._map._obj.removeSource(t),delete this._alreadTiles[t]));else for(var t in this._alreadTiles){var e,i;this._alreadTiles.hasOwnProperty(t)&&(i=t.split("_"),e=parseInt(i[2]),i=parseInt(i[3]),(2<this.minRC.row-e||2<e-this.maxRC.row||2<this.minRC.col-i||2<i-this.maxRC.col)&&(this._map._obj.removeLayer(t),this._map._obj.removeSource(t),delete this._alreadTiles[t]))}},this._getDistance=function(t,e){var i=t.lon||t.x,o=t.lat||t.y,t=e.lon||e.x,e=e.lat||e.y;return Math.sqrt(Math.pow(i-t,2)+Math.pow(o-e,2))},this.getZoomLevelByBoundM=function(t){for(var e,i=new ZenMap.Geometry.Point(t._sw.lng,(t._sw.lat+t._ne.lat)/2),o=new ZenMap.Geometry.Point(t._ne.lng,(t._sw.lat+t._ne.lat)/2),r=this._map.pointToPixel(o),t=this._map.pointToPixel(i),r=this._getDistance(t,r),n=this._getDistance(i,o)/r,s=0;s<22;s++)if(n>=this.maxResolution/Math.pow(2,s)){e=0<s&&n-this.maxResolution/Math.pow(2,s)>this.maxResolution/Math.pow(2,s-1)-n?s-1:s;break}return e=n>this.maxResolution?-1:e},this.getTilesUrlByBoundM=function(t,e){var t=Math.round(t),i=this.maxResolution/Math.pow(2,t),o=this.getRowColByXY(t,e._sw.lng,e._sw.lat),r=this.getRowColByXY(t,e._ne.lng,e._ne.lat),n=i*this._tileSize;this.minRC=o,this.maxRC=r;for(var s={},a=o.col;a<=r.col;a++)for(var l=o.row;l<=r.row;l++){var h=this._layerID+"_"+t+"_"+l+"_"+a,p=a*n+this.tileOrigin.x,c=this.tileOrigin.y+l*n,u=(a+1)*n+this.tileOrigin.x,d=this.tileOrigin.y+(l+1)*n;s[h]={row:l,col:a,level:t,coordinates:[[p,d],[u,d],[u,c],[p,c]]}}return s},this.getTileUrl=function(t,e,i){return this._yOffset&&(e-=1),-1!=this._url.indexOf("$")?this._url.replace("${x}",t).replace("${y}",e).replace("${z}",i-this._zoomOffset):this._url+"/EzMap?Service=getImage&Type=RGB&ZoomOffset="+this._zoomOffset+"&V="+this._serviceVersion+"&Col="+t+"&Row="+e+"&Zoom="+(i-this._zoomOffset)},r.prototype.show=function(){if(this.visible=!0,this._map)for(var t in this._alreadTiles)this._map._obj.setLayoutProperty(t,"visibility","visible")},r.prototype.hide=function(){if(this.visible=!1,this._map)for(var t in this._alreadTiles)this._map._obj.setLayoutProperty(t,"visibility","none")},r.prototype.clear=function(){if(0!=this._alreadTiles.length){for(var t in this._map._obj.off("moveend",this._mapMoveend),this._map._obj.off("load",this._mapMoveend),this._alreadTiles)this._map._obj.removeLayer(t),this._map._obj.removeSource(t),delete this._alreadTiles[t];this._alreadTiles=[]}}}}(),function(){var t=ZenMap.Layers.WMTSLayer=function(t,e,i){if(this.name=e,this.id=ZenMap.Utils.BaseUtils.uuid(),this.visible=!0,this._opts={isBaseLayer:!0},i)for(var o in i){var r;!i.hasOwnProperty(o)||void 0!==(r=i[o])&&(this._opts[o]=r)}this._opts.minZoom=this._opts.minZoom||0,this._opts.maxZoom=this._opts.maxZoom||18,t instanceof Array?this.urls=t:this.urls=[t];t=++ZenMap.LayerIndex;this._sourceID="WMTSLayerSource"+t,this._layerID="WMTSLayer"+t,this.style=this._getStyle(this._opts),this.CLASS_NAME="ZenMap.Layers.WMTSLayer"};(t.prototype=new ZenMap.Layer)._getStyle=function(t){t={version:8,sources:{},glyphs:ZenMap.Utils.BaseUtils.getHostPath()+"/lib/fonts/{fontstack}/{range}.pbf",layers:[{id:this._layerID,type:"raster",source:this._sourceID,minzoom:t.minZoom,maxzoom:t.maxZoom}]};return t.sources[this._sourceID]={type:"raster",scheme:"wmts",tiles:this.urls,tileSize:256},t},t.prototype.show=function(){this.visible=!0,this._map&&this._map._obj.setLayoutProperty(this._layerID,"visibility","visible")},t.prototype.hide=function(){this.visible=!1,this._map&&this._map._obj.setLayoutProperty(this._layerID,"visibility","none")}}(),function(){var t=ZenMap.Layers.ImageLayer=function(t,e,i){if(this.name=e,this.id=ZenMap.Utils.BaseUtils.uuid(),this.visible=!0,this._opts={fullExtent:[-180,-90,180,90],isBaseLayer:!0},i)for(var o in i){var r;!i.hasOwnProperty(o)||void 0!==(r=i[o])&&(this._opts[o]=r)}this._opts.minZoom=this._opts.minZoom||0,this._opts.maxZoom=this._opts.maxZoom||22,this.url=t;t=++ZenMap.LayerIndex;this._sourceID="ImageLayerSource"+t,this._layerID="ImageLayer"+t,this.style=this._getStyle(this._opts),this.CLASS_NAME="ZenMap.Layers.ImageLayer"};(t.prototype=new ZenMap.Layer)._getStyle=function(t){var e={version:8,sources:{},sprite:ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/gaode",glyphs:ZenMap.Utils.BaseUtils.getHostPath()+"/lib/fonts/{fontstack}/{range}.pbf",layers:[{id:this._layerID,type:"raster",source:this._sourceID,minzoom:t.minZoom,maxzoom:t.maxZoom}]},t=t.coords||[[this._opts.fullExtent[0],this._opts.fullExtent[3]],[this._opts.fullExtent[2],this._opts.fullExtent[3]],[this._opts.fullExtent[2],this._opts.fullExtent[1]],[this._opts.fullExtent[0],this._opts.fullExtent[1]]];return e.sources[this._sourceID]={type:"image",url:this.url,coordinates:t},this._opts.isCanavs&&(e.sources[this._sourceID].type="canvas",e.sources[this._sourceID].canvas=this.url,e.sources[this._sourceID].animate=this._opts.animate),e},t.prototype.show=function(){this.visible=!0,this._map&&this._map._obj.setLayoutProperty(this._layerID,"visibility","visible")},t.prototype.hide=function(){this.visible=!1,this._map&&this._map._obj.setLayoutProperty(this._layerID,"visibility","none")}}(),function(){var t=ZenMap.Layers.ModelLayer=function(t,e){this.id=ZenMap.Utils.BaseUtils.uuid(),this.name=t;t=++ZenMap.LayerIndex;this._layerID="ModelLayer"+t,this.CLASS_NAME="ZenMap.Layers.ModelLayer",this._modelLayers=[],this.visible=!0};(t.prototype=new ZenMap.Layer).addModel=function(t,o,e){if(this._map){var s=ZenMap.T.setPoint(this._map,{lon:t.lon,lat:t.lat}),i=e.z||0,t=e.modelRotate||[0,0,0],a={translateX:zmapboxgl.MercatorCoordinate.fromLngLat([s.lon,s.lat],i).x,translateY:zmapboxgl.MercatorCoordinate.fromLngLat([s.lon,s.lat],i).y,translateZ:zmapboxgl.MercatorCoordinate.fromLngLat([s.lon,s.lat],i).z,rotateX:t[0],rotateY:t[1],rotateZ:t[2],scale:e.scale||3e-8},e={id:ZenMap.Utils.BaseUtils.uuid(),type:"custom",position:s,renderingMode:"3d",onAdd:function(t,e){this.camera=new THREE.PerspectiveCamera,this.scene=new THREE.Scene;var i=new THREE.DirectionalLight(16777215);i.position.set(200,200,200).normalize(),this.scene.add(i);i=new THREE.DirectionalLight(16777215);i.position.set(-200,200,-200).normalize(),this.scene.add(i),(new THREE.GLTFLoader).load(o,function(t){this.scene.add(t.scene)}.bind(this)),this.map=t,this.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:t.getCanvas(),context:e}),this.renderer.autoClear=!1},render:function(t,e){var i,o,r,n=this.map.getBounds();n.getWest()>s.lon||n.getEast()<s.lon||n.getSouth()>s.lat||n.getNorth()<s.lat||(i=(new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(1,0,0),a.rotateX),o=(new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,1,0),a.rotateY),r=(new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),a.rotateZ),n=(new THREE.Matrix4).fromArray(e),r=(new THREE.Matrix4).makeTranslation(a.translateX,a.translateY,a.translateZ).scale(new THREE.Vector3(a.scale,-a.scale,a.scale)).multiply(i).multiply(o).multiply(r),this.camera.projectionMatrix.elements=e,this.camera.projectionMatrix=n.multiply(r),this.renderer.state.reset(),this.renderer.render(this.scene,this.camera),this.map.triggerRepaint())}};return this._map._obj.getLayer("city_normal_building_id")?this._map._obj.addLayer(e,"city_normal_building_id"):this._map._obj.addLayer(e),this._modelLayers.push(e),e.id}},t.prototype.removeModelByID=function(t){this._map._obj.removeLayer(t)},t.prototype.hideModelByID=function(t){this.visible&&this._map._obj.setLayoutProperty(t,"visibility","none")},t.prototype.showModelByID=function(t){this.visible&&this._map._obj.setLayoutProperty(t,"visibility","visible")},t.prototype.removeAllModels=function(){for(var t=0;t<this._modelLayers.length;t++)this._map._obj.removeLayer(this._modelLayers[t].id)},t.prototype.hide=function(){this.visible=!1;for(var t=0;t<this._modelLayers.length;t++)this._map._obj.setLayoutProperty(this._modelLayers[t].id,"visibility","none")},t.prototype.show=function(){this.visible=!0;for(var t=0;t<this._modelLayers.length;t++)this._map._obj.setLayoutProperty(this._modelLayers[t].id,"visibility","visible")}}(),function(){var t=ZenMap.Layers.EchartsLayer=function(t,e){this.id=ZenMap.Utils.BaseUtils.uuid(),this.name=t;t=++ZenMap.LayerIndex;this._layerID="EchartsLayer"+t,this.CLASS_NAME="ZenMap.Layers.EchartsLayer",this._option=i(e||{}),this._obj=null,this._map=null},e={"":[122.22997,40.665866],"":[120.44549,41.574471],"":[122.99012,41.1087],"":[116.88304,20.620163],"":[116.35104,23.546199],"":[113.27529,23.127842],"":[113.58635,24.804382],"":[121.61367,38.913809],"":[121.1301,41.117211],"":[124.37721,40.122705],"":[123.9154,41.873858],"":[123.42295,41.794336],"":[118.76219,32.043582],"":[119.44736,32.206326],"":[120.86036,32.018363],"":[119.01578,33.598888],"":[117.17903,34.263013],"":[120.13498,33.379011],"":[115.03536,35.768204],"":[111.18809,34.77831],"":[114.02045,33.577316],"":[113.82011,34.024469],"":[123.83842,42.288472],"":[81.314916,43.920623],"":[80.262897,41.169726],"":[87.614883,43.791593],"":[76.169801,39.713026],"":[93.511554,42.831725],"":[89.181222,42.946051],"":[110.78258,32.649075],"":[112.13809,32.044418],"":[112.19843,31.037642],"":[111.28517,30.705064],"":[113.92116,30.928892],"":[104.62362,35.580121],"":[104.17085,36.545649],"":[102.54264,24.353519],"":[100.22456,25.59247],"":[100.23189,26.875655],"":[114.28951,35.748307],"":[113.87806,35.303209],"":[114.33554,34.797878],"":[113.30143,33.736682],"":[110.99815,35.023529],"":[107.63363,35.734611],"":[105.82602,32.436042],"":[106.07896,30.797588],"":[106.74952,31.860988],"":[104.39596,31.130131],"":[104.73894,31.466216],"":[104.06322,30.661882],"":[106.62957,30.459174],"":[107.49771,31.211728],"":[105.56791,30.516096],"":[106.7097,26.581865],"":[106.50112,29.535892],"":[106.82084,39.672842],"":[107.41135,40.755943],"":[91.130668,29.663081],"":[118.31086,32.305635],"":[119.30142,26.078388],"":[117.02485,25.094324],"":[119.00282,25.433788],"":[118.58497,24.911854],"":[118.10525,24.493123],"":[117.65698,24.513849],"":[104.24192,23.372186],"":[99.705361,27.830343],"":[99.166221,25.114669],"":[100.97114,22.780313],"":[102.7108,25.043581],"":[101.54462,25.04507],"":[100.08571,23.889156],"":[102.01808,35.518145],"":[118.31215,29.711676],"":[116.50255,31.754921],"":[117.03815,30.511161],"":[118.75287,30.947883],"":[117.01282,32.64956],"":[117.27752,31.863185],"":[116.97862,33.635405],"":[118.37104,31.328173],"":[119.52243,26.662684],"":[98.578207,24.439861],"":[116.39904,39.903585],"":[112.42654,39.3301],"":[113.10689,36.190944],"":[112.72697,38.417109],"":[112.84516,35.497961],"":[112.72998,37.695818],"":[112.00293,27.73141],"":[112.9767,28.197494],"":[110.47497,29.130259],"":[109.97362,27.553459],"":[109.735,28.317685],"":[111.68575,29.043255],"":[113.14593,27.838975],"":[111.46367,27.24109],"":[112.23241,30.329414],"":[114.32354,29.835251],"":[112.93862,27.833178],"":[111.60277,26.43811],"":[113.02649,25.796512],"":[104.84422,26.588291],"":[107.97336,26.586903],"":[107.51297,26.261646],"":[104.89551,25.091229],"":[114.88555,30.399229],"":[115.07157,30.222428],"":[120.85125,40.754123],"":[105.92885,26.249095],"":[105.28178,27.305066],"":[106.7097,26.581865],"":[106.50112,29.535892],"":[108.16583,29.294696],"":[97.177928,31.139215],"":[113.544,22.201901],"":[103.82113,36.058346],"":[104.06322,30.661882],"":[125.31797,43.884426],"":[117.18386,39.124546],"":[102.7108,25.043581],"":[116.39904,39.903585],"":[112.54295,37.856487],"":[109.50417,18.249564],"":[110.32681,20.034018],"":[118.26965,33.964355],"":[119.1732,34.600984],"":[112.42817,34.663993],"":[112.53511,33.001107],"":[114.06914,32.125224],"":[114.01884,32.981995],"":[120.6154,31.301556],"":[119.91043,32.487105],"":[119.41553,32.395043],"":[119.94227,31.774851],"":[120.29706,31.576626],"":[102.10119,36.502851],"":[100.61826,36.280757],"":[97.369981,37.374183],"":[97.008082,33.006182],"":[106.6804,35.543218],"":[105.72106,34.579848],"":[102.63298,37.929715],"":[104.92647,33.39055],"":[102.90928,34.987488],"":[103.20976,35.599808],"":[100.45378,38.932266],"":[114.34642,36.103312],"":[113.23189,35.239526],"":[104.63947,30.125038],"":[103.82965,30.051109],"":[105.06288,29.589641],"":[104.77075,29.355611],"":[103.75905,29.584767],"":[105.43975,28.892164],"":[104.62847,28.763629],"":[102.25725,27.890199],"":[101.71443,26.584016],"":[102.21972,31.902033],"":[102.99921,29.990418],"":[101.96229,30.053479],"":[126.54733,43.841333],"":[125.31797,43.884426],"":[108.31601,22.826785],"":[107.34979,22.406877],"":[108.3415,21.617106],"":[111.29245,23.47737],"":[111.54691,24.417155],"":[110.14987,22.634117],"":[106.281,36.004725],"":[105.18579,37.514381],"":[106.27375,38.465904],"":[122.83524,45.617121],"":[124.81732,45.116275],"":[125.13895,42.90017],"":[124.36454,43.167735],"":[129.50631,42.902371],"":[126.42199,41.940003],"":[125.93084,41.719017],"":[117.18386,39.124546],"":[103.71512,27.340424],"":[103.79582,25.504564],"":[103.38214,23.369279],"":[98.853908,25.854283],"":[100.79681,22.004581],"":[112.54295,37.856487],"":[113.57688,37.860687],"":[111.51175,36.084271],"":[106.37146,39.012477],"":[106.19501,37.98562],"":[117.20939,29.295245],"":[114.92597,27.814277],"":[116.35334,27.986989],"":[117.02866,28.241843],"":[123.17572,41.267261],"":[121.6436,42.009723],"":[122.06407,41.122389],"":[123.76463,41.295818],"":[121.38611,37.538266],"":[122.11133,37.508655],"":[120.35006,36.082736],"":[115.98774,29.714598],"":[114.93553,25.854156],"":[117.96614,28.447765],"":[115.8873,28.679861],"":[114.38581,27.807399],"":[113.84687,27.626353],"":[115.9747,36.45594],"":[114.98141,27.115071],"":[122.1025,30.018281],"":[100.2408,34.475077],"":[101.77698,36.623256],"":[100.8996,36.959477],"":[106.61287,23.900645],"":[109.59795,23.096508],"":[108.62047,21.970049],"":[109.11496,21.475728],"":[110.29451,25.277036],"":[108.05787,24.698676],"":[115.64499,34.438417],"":[109.40709,24.3173],"":[109.22547,23.736408],"":[118.04158,36.814428],"":[119.45552,35.428679],"":[118.32074,35.065772],"":[119.10111,36.708736],"":[118.65906,37.433904],"":[117.55229,34.857401],"":[118.01092,37.382755],"":[116.58195,35.41584],"":[117.12299,36.194736],"":[116.30163,37.453187],"":[87.614883,43.791593],"":[114.29313,30.586779],"":[123.42295,41.794336],"":[116.99507,36.675536],"":[108.94335,34.264736],"":[121.46811,31.233644],"":[113.6593,34.759082],"":[113.27529,23.127842],"":[111.66402,40.816981],"":[126.63649,45.755015],"":[113.04575,23.687492],"":[113.37691,22.523808],"":[109.8347,40.657019],"":[119.75081,49.213388],"":[109.98456,39.816139],"":[105.70219,38.844278],"":[118.95054,42.27332],"":[122.25757,43.615051],"":[114.29313,30.586779],"":[114.87431,30.450385],"":[109.48211,30.285678],"":[117.27752,31.863185],"":[119.30142,26.078388],"":[112.9767,28.197494],"":[110.32681,20.034018],"":[118.76219,32.043582],"":[120.14887,30.289783],"":[122.06411,46.074232],"":[113.10725,41.032306],"":[116.0841,43.941783],"":[120.74654,30.764943],"":[121.54563,29.87097],"":[121.42417,28.664333],"":[120.6681,28.003907],"":[118.86785,28.944833],"":[114.08081,22.549684],"":[113.5489,22.227948],"":[110.36047,21.277271],"":[113.08948,22.593114],"":[111.97005,21.861973],"":[110.91472,21.662531],"":[130.96848,45.297862],"":[125.10566,46.588633],"":[131.14919,46.641212],"":[130.35373,46.807302],"":[115.46349,35.246883],"":[116.99507,36.675536],"":[109.93478,33.869996],"":[108.94335,34.264736],"":[108.97476,34.91756],"":[107.02407,33.079532],"":[109.0244,32.692367],"":[109.7356,38.289641],"":[121.46811,31.233644],"":[106.93342,27.710141],"":[109.18697,27.72162],"":[114.6931,23.748921],"":[116.11274,24.301738],"":[113.74106,23.048948],"":[79.923409,37.111026],"":[88.136272,47.847088],"":[84.871527,45.595072],"":[114.50296,37.067736],"":[114.87797,40.810582],"":[91.130668,29.663081],"":[88.883116,29.270787],"":[91.765308,29.239102],"":[94.361181,29.65738],"":[101.77698,36.623256],"":[108.31601,22.826785],"":[106.27375,38.465904],"":[115.8873,28.679861],"":[121.50513,25.04713],"":[115.35931,22.777137],"":[116.62792,23.664436],"":[112.03911,22.932452],"":[82.982542,46.745574],"":[119.64479,29.092488],"":[119.91738,28.455404],"":[120.14887,30.289783],"":[120.57803,29.999754],"":[120.09753,30.869255],"":[118.1691,39.633795],"":[117.93287,40.974653],"":[116.69847,39.522794],"":[116.8517,38.310055],"":[115.66011,37.734463],"":[119.58079,39.94142],"":[115.47607,38.866808],"":[114.49643,38.044818],"":[114.48477,36.612064],"":[127.49161,50.24788],"":[126.63649,45.755015],"":[123.95129,47.339982],"":[129.61154,44.581016],"":[117.6301,26.268875],"":[113.12689,29.372842],"":[112.34933,28.573208],"":[112.60246,26.903954],"":[109.57276,19.519454],"":[113.36755,31.719381],"":[111.12796,37.523573],"":[113.28825,40.089116],"":[109.4854,36.596437],"":[109.49771,34.500688],"":[108.70045,34.334885],"":[107.14006,34.370592],"":[80.103281,32.505668],"":[116.78926,33.973125],"":[115.81437,32.898973],"":[115.7774,33.87078],"":[117.48368,30.658394],"":[118.50272,31.691358],"":[117.81124,30.932246],"":[117.35741,32.941383],"":[113.6593,34.759082],"":[114.64427,33.622003],"":[114.49643,38.044818],"":[114.16839,22.322804],"":[116.70393,23.373629],"":[113.11723,23.031313],"":[112.46729,23.054184],"":[114.40762,23.081913],"":[111.66402,40.816981],"":[124.7038,52.333852],"":[131.00782,45.769004],"":[130.26967,47.329673],"":[128.89237,47.722572],"":[126.98649,46.635427],"":[118.17347,26.638924],"":[112.34388,16.832651],"":[92.05892,31.478226],"":[82.071484,44.902226],"":[87.300912,44.013269],"":[86.14833,41.767056],"":[75.986185,39.467439],"":[98.276723,39.785709],"":[98.510217,39.743248],"":[102.18589,38.513801],"":[103.82113,36.058346],"":[116.304215,39.954793],"":[117.10577,40.1433537],"":[116.331898,39.727591],"":[116.1893313,39.913335],"":[116.3605787,39.9139303],"":[116.412521,39.916145],"":[116.1329145,39.7341829],"":[116.6312342,40.323157],"":[116.837319,40.3761945],"":[115.978857,40.464066],"":[116.2809212,39.8624028],"":[116.099057,39.9357857],"":[116.647621,40.127827],"":[116.480349,39.9202267],"":[116.9479497,40.0310984],"":[116.4996894,40.3914136]},i=function(t){return t.geo||(t.geo={}),{GLMap:{roam:!0},coordinateSystem:t.geo.map="GLMap",title:t.title,tooltip:t.tooltip,legend:t.legend,geo:t.geo,series:[]}};t.prototype.setMap=function(t){this._obj=new EchartsLayer(t._obj),this._obj.chart.setOption(this._option)},t.prototype.setData=function(t){this._option.series=t,this._obj&&this._obj.chart.setOption(this._option)},t.prototype.getCoordByName=function(t){return e[t]},t.prototype.hide=function(){this._obj&&(this._obj._container.style.display="none")},t.prototype.show=function(){this._obj&&(this._obj._container.style.display="block")}}(),function(){var t=ZenMap.Layers.ThreeLayer=function(t,e){this.id=ZenMap.Utils.BaseUtils.uuid(),this.name=t;t=++ZenMap.LayerIndex;this._layerID="ThreeLayer"+t,this.CLASS_NAME="ZenMap.Layers.ThreeLayer",this.visible=!0;var i=this;this._hander=null,this.selectColor="#ff0000",this.selectMaterial={},this.loader=new THREE.GLTFLoader;t=new THREE.DRACOLoader;t.setDecoderPath(ZenMap.Utils.BaseUtils.getHostPath()+"/lib/draco/"),this.loader.setDRACOLoader(t),this._customLayer={id:this.id,type:"custom",renderingMode:"3d",onAdd:function(t,e){i.tb=new Threebox(t,e,{defaultLights:!0}),i.tb.world.useFog=!0},render:function(t,e){i.tb.update(e)}}};(t.prototype=new ZenMap.Layer).getThreeBox=function(){return this.tb},t.prototype.useFog=function(t){this.tb.world.useFog=t},t.prototype.loadModel=function(t,e,i,o){var r=this;(i=i||{}).units||(i.units="meters");var n=ZenMap.T.setPoint(this._map,{lon:e[0],lat:e[1]});this.loader.load(t,function(t){t=r.tb.addAtCoordinate(t.scene,[n.lon,n.lat,e[2]],{units:i.units});i&&i.rotation&&t.rotation.set(i.rotation[0],i.rotation[1],i.rotation[2]),t.type="model",i&&i.scale&&t.scale.set(i.scale[0],i.scale[1],i.scale[2]),i&&i.name&&(t.name=i.name),i&&i.id&&(t.modelID=i.id),r._map.repaint(),o&&o(t)})},t.prototype.addModel=function(t,e,i){i.units||(i.units="meters");var o=ZenMap.T.setPoint(this._map,{lon:e[0],lat:e[1]}),e=this.tb.addAtCoordinate(t,[o.lon,o.lat,e[2]],{units:i.units});return i&&i.rotation&&e.rotation.set(i.rotation[0],i.rotation[1],i.rotation[2]),e.type="model",i&&i.scale&&e.scale.set(i.scale[0],i.scale[1],i.scale[2]),i&&i.name&&(e.name=i.name),i&&i.id&&(e.modelID=i.id),this._map.repaint(),e.renderOrder=100,e},t.prototype.getAllObjects=function(){if(!this.tb)return[];for(var t=[],e=0;e<this.tb.world.children.length;e++)-1==this.tb.world.children[e].type.indexOf("Light")&&(this.tb.world.children[e].parentObj?t.push(this.tb.world.children[e].parentObj):t.push(this.tb.world.children[e]));return t},t.prototype.getCenterTop=function(t){var o=[];if("Mesh"===t.type&&o.push(t.geometry),function t(e){if(e.children)for(var i=0;i<e.children.length;i++)"Mesh"===e.children[i].type?o.push(e.children[i].geometry):t(e.children[i])}(t),!o.length)return null;o[0].computeBoundingBox();for(var e=o[0].boundingBox.clone(),i=1;i<o.length;i++)o[i].computeBoundingBox(),e=e.union(o[i].boundingBox);var r=this.tb.unprojectFromWorld(t.position);return(r=ZenMap.T.getPoint(this._map,{lon:r[0],lat:r[1]})).h=e.max.y-e.min.y,r.h=r.h+this.tb.utils.unprojectFromWorld(t.position)[2],r},t.prototype.getAllModels=function(){if(!this.tb)return[];for(var t=[],e=0;e<this.tb.world.children.length;e++)this.isModel(this.tb.world.children[e])&&t.push(this.tb.world.children[e]);return t},t.prototype.addSelectEvent=function(i,t){var o=this;this._hander=function(t){var e;o.tb.map._moving||(e=o._intersectModel(o.tb,t.point),i&&i instanceof Function&&i(e,t.point))},this.tb&&this.tb.map.on(t||"click",this._hander)},t.prototype.addClickModelEvent=function(t){var e;this.tb&&(e=this).tb.map.on(event||"click",function(){e.selection&&t&&t instanceof Function&&t(e.selection)})},t.prototype.addPickEvent=function(i){var o=this;this._hander=function(t){var e;o.tb.map._moving||(e=o.pick(t.point),i&&i instanceof Function&&i(e,t.point))},this.tb&&this.tb.map.on("click",this._hander)},t.prototype.pick=function(t){for(var e=this.tb.queryRenderedFeatures(t),i=0;i<e.length;i++){for(var o=e[0].object;o.parent.uuid!==this.tb.world.uuid;)o=o.parent;0}var r=null;if(0<e.length){var o=e[0].object,n=new THREE.Matrix4;n.getInverse(o.matrixWorld);var s=e[0].point;for(s.applyMatrix4(n);o.parent.uuid!==this.tb.world.uuid;)s.x=s.x*o.scale.x,s.y=s.y*o.scale.y,s.z=s.z*o.scale.z,s.applyAxisAngle(new THREE.Vector3(1,0,0),0-o.rotation._x),s.applyAxisAngle(new THREE.Vector3(0,1,0),0-o.rotation._y),s.applyAxisAngle(new THREE.Vector3(0,0,1),0-o.rotation._z),s.x=s.x+o.position.x,s.y=s.y+o.position.y,s.z=s.z+o.position.z,o=o.parent;s.x=s.x*o.scale.x,s.y=s.y*o.scale.y,s.z=s.z*o.scale.z,s.applyAxisAngle(new THREE.Vector3(1,0,0),0-o.rotation._x),s.applyAxisAngle(new THREE.Vector3(0,1,0),0-o.rotation._y),s.applyAxisAngle(new THREE.Vector3(0,0,1),o.rotation._z),s.x=s.x+o.position.x,s.y=s.y+o.position.y,s.z=s.z+o.position.z;n=this.tb.unprojectFromWorld(s),r={lon:n[0],lat:n[1],h:n[2]}}else r={lon:(r=this.tb.map.unproject(t)).lng,lat:r.lat,h:0};t=ZenMap.T.getPoint(this._map,r);return t.h=r.h,t},t.prototype._intersectModel=function(t,e){for(var i=t.queryRenderedFeatures(e),o=0;o<i.length;o++){for(var r=i[0].object;r.parent.uuid!==t.world.uuid;)r=r.parent;return r.parentObj?r.parentObj:r}return null},t.prototype.removeSelectEvent=function(){this.tb&&this._hander&&(this.tb.map.off("click",this._hander),this._hander=null)},t.prototype.hide=function(){this.visible=!1,this._map._obj.setLayoutProperty(this.id,"visibility","none")},t.prototype.show=function(){this.visible=!0,this._map._obj.setLayoutProperty(this.id,"visibility","visible")},t.prototype.setSelection=function(t){var o=this;if(this.clearSelection(),t&&("building"===t.type||"appliances"===t.type||"room"===t.type))for(var e in"Mesh"==(this.selection=t).type&&(t.material.emissive=new THREE.Color(this.selectColor)),function t(e){if(0<e.children.length)for(var i=0;i<e.children.length;i++)"Mesh"==e.children[i].type&&(o.selectMaterial[e.children[i].material.uuid]||(o.selectMaterial[e.children[i].material.uuid]=e.children[i].material)),t(e.children[i])}(t),o.selectMaterial)o.selectMaterial[e].tempcolor=o.selectMaterial[e].color,o.selectMaterial[e].color=new THREE.Color(o.selectColor).lerp(o.selectMaterial[e].tempcolor,.2)},t.prototype.setAllBuildingOpacity=function(t){for(var e=0;e<this.tb.world.children.length;e++)"building"===this.tb.world.children[e].type&&(this.selection&&this.selection.uuid==this.tb.world.children[e].uuid||!function t(e,i){if(0<e.children.length)for(var o=0;o<e.children.length;o++)"Mesh"==e.children[o].type&&(e.children[o].material.opacity=i),t(e.children[o],i)}(this.tb.world.children[e],t))},t.prototype.enableAllBuildingBloom=function(o){for(var t=0;t<this.tb.world.children.length;t++)"building"===this.tb.world.children[t].type&&!function t(e){if(0<e.children.length)for(var i=0;i<e.children.length;i++)"Mesh"==e.children[i].type&&(o?e.children[i].layers.toggle(1):e.children[i].layers.toggle(0)),t(e.children[i])}(this.tb.world.children[t])},t.prototype.setModelEmissiveColor=function(t,o){!function t(e){if("Mesh"==e.type&&(e.material.emissive=new THREE.Color(o)),0<e.children.length)for(var i=0;i<e.children.length;i++)t(e.children[i])}(t)},t.prototype.clearSelection=function(){if(this.selection){for(var t in this.selectMaterial)this.selectMaterial[t].color=this.selectMaterial[t].tempcolor,this.selectMaterial[t].tempcolor=null;this.selectMaterial={},this.selection=null}},t.prototype.setAllModelVisible=function(t,e){for(var i=0;i<this.tb.world.children.length;i++)!e&&this.selection&&this.selection.uuid==this.tb.world.children[i].uuid||-1<this.tb.world.children[i].type.indexOf("Light")||(this.tb.world.children[i].visible=t)},t.prototype.setModelVisibleByType=function(t,e){for(var i=0;i<this.tb.world.children.length;i++)this.tb.world.children[i].type===t&&(this.tb.world.children[i].visible=e)},t.prototype.getModelByType=function(t){for(var e=[],i=0;i<this.tb.world.children.length;i++)this.tb.world.children[i].type===t&&(this.tb.world.children[i].parentObj?e.push(this.tb.world.children[i].parentObj):e.push(this.tb.world.children[i]));return e},t.prototype.enableModelBloom=function(t,o){!function t(e){if(0<e.children.length)for(var i=0;i<e.children.length;i++)"Mesh"==e.children[i].type&&(e.children[i].material.emissive=new THREE.Color(o),e.children[i].material.emissiveMap=e.children[i].material.map,e.children[i].layers.set(1)),t(e.children[i])}(t)},t.prototype.disableModelBloom=function(t){!function t(e){if(0<e.children.length)for(var i=0;i<e.children.length;i++)"Mesh"==e.children[i].type&&(e.children[i].material.emissive=new THREE.Color(0),e.children[i].material.emissiveMap=null,e.children[i].layers.set(0)),t(e.children[i])}(t)},t.prototype.removeObjByName=function(t){if(this.tb){for(var e=[],i=0;i<this.tb.world.children.length;i++)-1==this.tb.world.children[i].type.indexOf("Light")&&this.tb.world.children[i].name===t&&e.push(this.tb.world.children[i]);for(i=0;i<e.length;i++)this.tb.remove(e[i])}},t.prototype.removeObj=function(t){this.tb&&this.tb.remove(t)},t.prototype.removeObjByID=function(t){if(this.tb){for(var e,i=0;i<this.tb.world.children.length;i++)-1==this.tb.world.children[i].type.indexOf("Light")&&this.tb.world.children[i].uuid===t&&(e=this.tb.world.children[i]);e&&this.tb.remove(e)}},t.prototype.getObjByID=function(t){if(this.tb)for(var e=0;e<this.tb.world.children.length;e++)if(-1==this.tb.world.children[e].type.indexOf("Light")&&this.tb.world.children[e].uuid===t)return this.tb.world.children[e].parentObj||this.tb.world.children[e]},t.prototype.getObjByModelID=function(t){if(this.tb)for(var e=0;e<this.tb.world.children.length;e++)if(-1==this.tb.world.children[e].type.indexOf("Light")&&this.tb.world.children[e].modelID===t)return this.tb.world.children[e].parentObj||this.tb.world.children[e]},t.prototype.removeAllModels=function(){if(this.tb){for(var t=[],e=0;e<this.tb.world.children.length;e++)this.isModel(this.tb.world.children[e])&&t.push(this.tb.world.children[e]);for(e=0;e<t.length;e++)this.tb.remove(t[e])}},t.prototype.removeAllObjects=function(){if(this.tb){for(var t=[],e=0;e<this.tb.world.children.length;e++)-1==this.tb.world.children[e].type.indexOf("Light")&&t.push(this.tb.world.children[e]);for(e=0;e<t.length;e++)this.tb.remove(t[e])}},t.prototype.isModel=function(t){return!(!t||"Scene"!==t.type)||!!(t&&0<t.children.length&&"Scene"===t.children[0].type)},t.prototype.addWall=function(t,e,i){ZenMap.Utils.WKT.read(t).getPath()}}(),ZenMap.DRAW_MODE_NONE="1",ZenMap.DRAW_MODE_RECT="2",ZenMap.DRAW_MODE_CIRCLE="3",ZenMap.DRAW_MODE_POLYLINE="4",ZenMap.DRAW_MODE_POLYLGON="5",ZenMap.DRAW_MODE_CIRCLE_DIAMETER="6",ZenMap.DRAW_MODE_FREEHAND="7",function(){var t=ZenMap.Tools.DrawingTool=function(t){this.CLASS_NAME="ZenMap.Tools.DrawingTool",this._mode=ZenMap.DRAW_MODE_POLYLINE,this._map=t,this.fillColor="#ff0000",this.fillOpacity=.2,this.strokeColor="#ff0000",this.strokeWidth=2,this.lineJoin="round",this.lineCap="round",this.strokeOpacity=1,this.lineStyle=ZenMap.LINE_TYPE_SOLID,this.diameterColor="#ff0000",this.diameterWidth=2,this.diameterDasharray=[3,2],this.showRadius=!1,this.labelStyle={color:"#000000",fontSize:12,fontFamily:"Microsoft YaHei",opacity:1,offset:[0,-1]},this._virtualStyle={pointRadius:6,fillColor:"red",fillOpacity:1,strokeOpacity:1,strokeColor:"red",strokeWidth:1}};t.prototype.setMode=function(t,e,i){this.cancleDraw(),this._map.disableDoubleClickZoom(),this._map.isDrawing=!0,i&&(this.fillColor=i.fillColor||this.fillColor,this.fillOpacity=i.fillOpacity||this.fillOpacity,this.strokeColor=i.strokeColor||this.strokeColor,this.strokeWidth=i.strokeWidth||this.strokeWidth,this.strokeOpacity=i.strokeOpacity||this.strokeOpacity,this.lineStyle=i.lineDasharray||this.lineStyle,this.diameterColor=i.diameterColor||this.diameterColor,this.diameterWidth=i.diameterWidth||this.diameterWidth,this.diameterDasharray=i.diameterDasharray||this.diameterDasharray,this.showRadius=i.showRadius||this.showRadius,this.labelStyle=i.labelStyle||this.labelStyle,this._virtualStyle=i.virtualStyle||this._virtualStyle,this.opts={color:this.strokeColor,fillColor:this.fillColor,weight:this.strokeWidth,opacity:this.strokeOpacity,fillOpacity:this.fillOpacity,lineStyle:this.lineStyle,showRadius:t===ZenMap.DRAW_MODE_CIRCLE_DIAMETER&&this.showRadius,labelStyle:t===ZenMap.DRAW_MODE_CIRCLE_DIAMETER?this.labelStyle:null}),t!==ZenMap.DRAW_MODE_NONE&&t!==ZenMap.DRAW_MODE_RECT&&t!==ZenMap.DRAW_MODE_CIRCLE&&t!==ZenMap.DRAW_MODE_POLYLINE&&t!==ZenMap.DRAW_MODE_POLYLGON&&t!==ZenMap.DRAW_MODE_CIRCLE_DIAMETER&&t!==ZenMap.DRAW_MODE_FREEHAND||((this._mode=t)===ZenMap.DRAW_MODE_NONE&&this._map._draw.changeMode(draw.modes.SIMPLE_SELECT,{featureIDs:[]}),t===ZenMap.DRAW_MODE_RECT&&this._drawRect(e,this.opts),t===ZenMap.DRAW_MODE_POLYLINE&&this._drawPolyLine(e,this.opts),t===ZenMap.DRAW_MODE_POLYLGON&&this._drawPolygon(e,this.opts),t===ZenMap.DRAW_MODE_CIRCLE&&this._drawCircle(e,this.opts),t===ZenMap.DRAW_MODE_CIRCLE_DIAMETER&&this._drawCircleDiameter(e,this.opts),t===ZenMap.DRAW_MODE_FREEHAND&&this._drawFreeHander(e,this.opts))},t.prototype.cancleDraw=function(){this._map.isDrawing=!1,this._map._obj.getCanvas().style.cursor="",this._map.enableDoubleClickZoom(),this.drawRect&&(this._map._obj.off("mousedown",this.drawRect.mouseDownFun),this._map._obj.off("mousemove",this.drawRect.mouseMoveFun),this._map._obj.off("mouseup",this.drawRect.mouseUPFun)),this.drawPolyLine&&(this._map._obj.off("click",this.drawPolyLine.clickFun),this._map._obj.off("mousemove",this.drawPolyLine.mouseMoveFun),this._map._obj.off("dblclick",this.drawPolyLine.dblFun),this._map._obj.off("contextmenu",this.drawPolyLine.drawendFun)),this.drawPolygon&&(this._map._obj.off("click",this.drawPolygon.clickFun),this._map._obj.off("mousemove",this.drawPolygon.mouseMoveFun),this._map._obj.off("dblclick",this.drawPolygon.dblFun),this._map._obj.off("contextmenu",this.drawPolygon.rightFun)),this.drawCircle&&(this._map._obj.off("mousedown",this.drawCircle.mouseDownFun),this._map._obj.off("mousemove",this.drawCircle.mouseMoveFun),this._map._obj.off("mouseup",this.drawCircle.mouseUPFun)),this.drawCircleDiameter&&(this._map._obj.off("mousedown",this.drawCircleDiameter.mouseDownFun),this._map._obj.off("mousemove",this.drawCircleDiameter.mouseMoveFun),this._map._obj.off("mouseup",this.drawCircleDiameter.mouseUPFun)),this.drawFreeHander&&(this._map._obj.off("mousedown",this.drawFreeHander.mouseDownFun),this._map._obj.off("mousemove",this.drawFreeHander.mouseMoveFun),this._map._obj.off("mouseup",this.drawFreeHander.mouseUPFun)),this._remove()},t.prototype._remove=function(){this._map._obj.getLayer("ZenMap_draw_Polygon")&&this._map._obj.removeLayer("ZenMap_draw_Polygon"),this._map._obj.getLayer("ZenMap_draw_Point")&&this._map._obj.removeLayer("ZenMap_draw_Point"),this._map._obj.getLayer("ZenMap_draw_Line")&&this._map._obj.removeLayer("ZenMap_draw_Line"),this._map._obj.getLayer("ZenMap_diameter_Line")&&this._map._obj.removeLayer("ZenMap_diameter_Line"),this._map._obj.getLayer("ZenMap_draw_Label")&&this._map._obj.removeLayer("ZenMap_draw_Label"),this._map._obj.getSource("draw_source")&&this._map._obj.removeSource("draw_source")},t.prototype._callback=function(t,e){if(t){var i=t.getExtent(),o=t.getPath();if(console.log(o),"ZenMap.Geometry.Circle"==t.CLASS_NAME){var r=t.getCenter(),n=t.getRadius();t._getCoordinates(this._map);o=t.getPath(),n=r.lon+","+r.lat+","+n;e&&e instanceof Function&&e(i,t,n,o)}else{for(var s="",a=0;a<o.length;a++)s+=o[a].lon+","+o[a].lat,a<o.length-1&&(s+=",");e&&e instanceof Function&&e(i,t,s.substring(0,s.length-1))}}else e&&e instanceof Function&&e(null,null,null)},t.prototype._getDistance=function(t,e){t=ZenMap.T.helper.webMoctorJW2PM(t.lon,t.lat),e=ZenMap.T.helper.webMoctorJW2PM(e.lon,e.lat);return Math.sqrt((t.lon-e.lon)*(t.lon-e.lon)+(t.lat-e.lat)*(t.lat-e.lat))},t.prototype._drawRect=function(o,r){this.drawRect={},this._map._obj.getCanvas().style.cursor="crosshair";function n(t){0<t.originalEvent.button||(l._map._obj.dragPan.disable(),s=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),t=ZenMap.T.getPoint(l._map,s),a=ZenMap.T.helper.webMoctorJW2PM(t.lon,t.lat),l._map._obj.addSource("draw_source",e),l._map._obj.addLayer(i),l._map._obj.addLayer(h),l._map._obj.on("mousemove",p),l._map._obj.on("mouseup",c))}var s,a,l=this,e={type:"geojson",data:{type:"FeatureCollection",features:[]}},i={id:"ZenMap_draw_Polygon",type:"fill",source:"draw_source",paint:{"fill-color":this.fillColor,"fill-opacity":this.fillOpacity},filter:["==","$type","Polygon"]},h={id:"ZenMap_draw_Line",type:"line",source:"draw_source",paint:{"line-color":this.strokeColor,"line-width":this.strokeWidth},filter:["==","$type","LineString"]},p=function(t){var e=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),i={type:"geojson",data:{type:"FeatureCollection",features:[]}},o={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]},properties:{}},t={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{}};o.geometry.coordinates[0].push([s.lon,s.lat]),o.geometry.coordinates[0].push([s.lon,e.lat]),o.geometry.coordinates[0].push([e.lon,e.lat]),o.geometry.coordinates[0].push([e.lon,s.lat]),o.geometry.coordinates[0].push([s.lon,s.lat]),t.geometry.coordinates.push([s.lon,s.lat]),t.geometry.coordinates.push([s.lon,e.lat]),t.geometry.coordinates.push([e.lon,e.lat]),t.geometry.coordinates.push([e.lon,s.lat]),t.geometry.coordinates.push([s.lon,s.lat]),i.data.features.push(o),i.data.features.push(t),l._map._obj.getSource("draw_source").setData(i.data)},c=function(t){l._map._obj.dragPan.enable();var e=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),e=ZenMap.T.getPoint(l._map,e),i=ZenMap.T.helper.webMoctorJW2PM(e.lon,e.lat),t=i.lon-a.lon,e=i.lat-a.lat;l._map._obj.off("mousedown",n),l._map._obj.off("mousemove",p),l._map._obj.off("mouseup",c),l._remove(),l._map._obj.getCanvas().style.cursor="",l._map.isDrawing=!1,0!=t&&0!=e?(i=ZenMap.T.getPoint(l._map,s),e=new ZenMap.Geometry.Rectangle(i,t,e,r),l._callback(e,o)):l._callback(null,o)};this._map._obj.on("mousedown",n),this.drawRect.mouseDownFun=n,this.drawRect.mouseUPFun=c,this.drawRect.mouseMoveFun=p},t.prototype._drawPolyLine=function(n,s){this.drawPolyLine={},this._map._obj.getCanvas().style.cursor="crosshair";var o,a=this,l=[],r={type:"geojson",data:{type:"FeatureCollection",features:[]}},t={id:"ZenMap_draw_Point",type:"circle",source:"draw_source",paint:{"circle-color":this._virtualStyle.fillColor,"circle-radius":this._virtualStyle.pointRadius,"circle-opacity":this._virtualStyle.fillOpacity,"circle-stroke-width":this._virtualStyle.strokeWidth,"circle-stroke-color":this._virtualStyle.strokeColor,"circle-stroke-opacity":this._virtualStyle.strokeOpacity},filter:["==","$type","Point"]},e={id:"ZenMap_draw_Line",type:"line",source:"draw_source",paint:{"line-color":this.strokeColor,"line-width":this.strokeWidth},filter:["==","$type","LineString"]};a._map._obj.addSource("draw_source",r),a._map._obj.addLayer(e),a._map._obj.addLayer(t);function h(t){var e={type:"Feature",geometry:{type:"Point",coordinates:[]},properties:{}},t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat);if(l.push(t),e.geometry.coordinates=[t.lon,t.lat],r.data.features.push(e),c.geometry.coordinates=[],1!=l.length){for(var i=0;i<l.length;i++)c.geometry.coordinates.push([l[i].lon,l[i].lat]);a._map._obj.getSource("draw_source").setData(r.data),o=null}else r.data.features.push(c)}function p(t){if(0!=l.length){o?(o.lon=t.lngLat.lng,o.lat=t.lngLat.lat,i.geometry.coordinates=[t.lngLat.lng,t.lngLat.lat]):(i={type:"Feature",geometry:{type:"Point",coordinates:[]},properties:{}},o=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),i.geometry.coordinates=[t.lngLat.lng,t.lngLat.lat],r.data.features.push(i)),c.geometry.coordinates=[];for(var e=0;e<l.length;e++)c.geometry.coordinates.push([l[e].lon,l[e].lat]);c.geometry.coordinates.push([o.lon,o.lat]),a._map._obj.getSource("draw_source").setData(r.data)}}var i=null,c={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{}},u=function(t){if(a._map._obj.off("click",h),a._map._obj.off("mousemove",p),a._map._obj.off("dblclick",d),a._map._obj.off("contextmenu",u),a._remove(),a._map._obj.getCanvas().style.cursor="",a._map.isDrawing=!1,l.length<2)a._callback(null,n);else{for(var e=ZenMap.T.getPoints(a._map,l),i=[],o=0;o<e.length;o++)i.push(new ZenMap.Geometry.Point(e[o].lon,e[o].lat));var r=new ZenMap.Geometry.Polyline(i,s);a._callback(r,n)}},d=function(t){l.pop(l[l.length-1]),u(),window.setTimeout(function(){a._map.enableDoubleClickZoom()},100)};this._map._obj.on("click",h),this._map._obj.on("mousemove",p),this._map._obj.on("dblclick",d),this._map._obj.on("contextmenu",u),this.drawPolyLine.clickFun=h,this.drawPolyLine.mouseMoveFun=p,this.drawPolyLine.dblFun=d,this.drawPolyLine.drawendFun=u},t.prototype._drawPolygon=function(n,s){this.drawPolygon={},this._map._obj.getCanvas().style.cursor="crosshair";var o,a=this,l=[],r={type:"geojson",data:{type:"FeatureCollection",features:[]}},t={id:"ZenMap_draw_Polygon",type:"fill",source:"draw_source",paint:{"fill-color":this.fillColor,"fill-opacity":this.fillOpacity},filter:["==","$type","Polygon"]},e={id:"ZenMap_draw_Point",type:"circle",source:"draw_source",paint:{"circle-color":this._virtualStyle.fillColor,"circle-radius":this._virtualStyle.pointRadius,"circle-opacity":this._virtualStyle.fillOpacity,"circle-stroke-width":this._virtualStyle.strokeWidth,"circle-stroke-color":this._virtualStyle.strokeColor,"circle-stroke-opacity":this._virtualStyle.strokeOpacity},filter:["==","$type","Point"]},i={id:"ZenMap_draw_Line",type:"line",source:"draw_source",paint:{"line-color":this.strokeColor,"line-width":this.strokeWidth},filter:["==","$type","LineString"]};a._map._obj.addSource("draw_source",r),a._map._obj.addLayer(t),a._map._obj.addLayer(i),a._map._obj.addLayer(e);function h(t){var e={type:"Feature",geometry:{type:"Point",coordinates:[]},properties:{}},t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat);if(l.push(t),e.geometry.coordinates=[t.lon,t.lat],r.data.features.push(e),d.geometry.coordinates=[],f.geometry.coordinates=[[]],1==l.length)return r.data.features.push(d),void r.data.features.push(f);for(var i=0;i<l.length;i++)d.geometry.coordinates.push([l[i].lon,l[i].lat]),f.geometry.coordinates[0].push([l[i].lon,l[i].lat]);d.geometry.coordinates.push([l[0].lon,l[0].lat]),f.geometry.coordinates[0].push([l[0].lon,l[0].lat]),a._map._obj.getSource("draw_source").setData(r.data),o=null}function p(t){if(0!=l.length){o?(o.lon=t.lngLat.lng,o.lat=t.lngLat.lat,u.geometry.coordinates=[t.lngLat.lng,t.lngLat.lat]):(u={type:"Feature",geometry:{type:"Point",coordinates:[]},properties:{}},o=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),u.geometry.coordinates=[t.lngLat.lng,t.lngLat.lat],r.data.features.push(u)),d.geometry.coordinates=[],f.geometry.coordinates=[[]];for(var e=0;e<l.length;e++)d.geometry.coordinates.push([l[e].lon,l[e].lat]),f.geometry.coordinates[0].push([l[e].lon,l[e].lat]);d.geometry.coordinates.push([o.lon,o.lat]),f.geometry.coordinates[0].push([o.lon,o.lat]),d.geometry.coordinates.push([l[0].lon,l[0].lat]),f.geometry.coordinates[0].push([l[0].lon,l[0].lat]),a._map._obj.getSource("draw_source").setData(r.data)}}function c(t){if(a._map._obj.off("click",h),a._map._obj.off("mousemove",p),a._map._obj.off("dblclick",g),a._map._obj.off("contextmenu",y),a._remove(),a._map._obj.getCanvas().style.cursor="",a._map.isDrawing=!1,l.length<4)a._callback(null,n);else{for(var e=ZenMap.T.getPoints(a._map,l),i=[],o=0;o<e.length;o++)i.push(new ZenMap.Geometry.Point(e[o].lon,e[o].lat));var r=new ZenMap.Geometry.Polygon(i,s);a._callback(r,n)}}var u=null,d={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{}},f={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]},properties:{}},g=function(){0<l.length&&(l.pop(l[l.length-1]),l.push(l[0])),c(),window.setTimeout(function(){a._map.enableDoubleClickZoom()},100)},y=function(){0<l.length&&l.push(l[0]),c()};this._map._obj.on("click",h),this._map._obj.on("mousemove",p),this._map._obj.on("dblclick",g),this._map._obj.on("contextmenu",y),this.drawPolygon.clickFun=h,this.drawPolygon.mouseMoveFun=p,this.drawPolygon.dblFun=g,this.drawPolygon.rightFun=y},t.prototype._drawCircle=function(i,o){this.drawCircle={},this._map._obj.getCanvas().style.cursor="crosshair";function r(t){0<t.originalEvent.button||(l._map._obj.dragPan.disable(),s=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),a=ZenMap.T.helper.webMoctorJW2PM(s.lon,s.lat),l._map._obj.addSource("draw_source",e),l._map._obj.addLayer(h),l._map._obj.addLayer(n),l._map._obj.on("mousemove",p),l._map._obj.on("mouseup",c))}var s,a,l=this,e={type:"geojson",data:{type:"FeatureCollection",features:[]}},n={id:"ZenMap_draw_Polygon",type:"fill",source:"draw_source",paint:{"fill-color":this.fillColor,"fill-opacity":this.fillOpacity},filter:["==","$type","Polygon"]},h={id:"ZenMap_draw_Line",type:"line",source:"draw_source",paint:{"line-color":this.strokeColor,"line-width":this.strokeWidth},filter:["==","$type","LineString"]},p=function(t){for(var t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),t=l._getDistance(s,t),e=ZenMap.Utils.MapUtil.createRegularPolygon(a,t,60),t={type:"geojson",data:{type:"FeatureCollection",features:[]}},i={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]},properties:{}},o={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{}},r=0;r<e.length;r++){var n=ZenMap.T.helper.inverseMercator(e[r].lon,e[r].lat);i.geometry.coordinates[0].push([n.lon,n.lat]),o.geometry.coordinates.push([n.lon,n.lat])}t.data.features.push(i),t.data.features.push(o),l._map._obj.getSource("draw_source").setData(t.data)},c=function(t){l._map._obj.dragPan.enable();var e=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),t=l._getDistance(s,e);l._map._obj.off("mousedown",r),l._map._obj.off("mousemove",p),l._map._obj.off("mouseup",c),l._remove(),l._map._obj.getCanvas().style.cursor="",l._map.isDrawing=!1,0!=t?(e=ZenMap.T.getPoint(l._map,s),t=new ZenMap.Geometry.Circle(e,t,o),l._callback(t,i)):l._callback(null,i)};this._map._obj.on("mousedown",r),this.drawCircle.mouseDownFun=r,this.drawCircle.mouseUPFun=c,this.drawCircle.mouseMoveFun=p},t.prototype._drawFreeHander=function(r,n){this.drawFreeHander={},this._map._obj.getCanvas().style.cursor="crosshair";function s(t){0<t.originalEvent.button||(l._map._obj.dragPan.disable(),a=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),l._map._obj.addSource("draw_source",e),l._map._obj.addLayer(i),l._map._obj.addLayer(o),l._map._obj.on("mousemove",p),l._map._obj.on("mouseup",c))}var a,l=this,h=[],e={type:"geojson",data:{type:"FeatureCollection",features:[]}},i={id:"ZenMap_draw_Polygon",type:"fill",source:"draw_source",paint:{"fill-color":this.fillColor,"fill-opacity":this.fillOpacity},filter:["==","$type","Polygon"]},o={id:"ZenMap_draw_Line",type:"line",source:"draw_source",paint:{"line-color":this.strokeColor,"line-width":this.strokeWidth},filter:["==","$type","LineString"]},p=function(t){t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat);h.push(t);for(var t={type:"geojson",data:{type:"FeatureCollection",features:[]}},e={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]},properties:{}},i={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{}},o=0;o<h.length;o++)e.geometry.coordinates[0].push([h[o].lon,h[o].lat]),i.geometry.coordinates.push([h[o].lon,h[o].lat]);e.geometry.coordinates[0].push([a.lon,a.lat]),i.geometry.coordinates.push([a.lon,a.lat]),t.data.features.push(e),t.data.features.push(i),l._map._obj.getSource("draw_source").setData(t.data)},c=function(t){l._map._obj.dragPan.enable();t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat);if(l._map._obj.off("mousedown",s),l._map._obj.off("mousemove",p),l._map._obj.off("mouseup",c),l._remove(),l._map._obj.getCanvas().style.cursor="",l._map.isDrawing=!1,h.length<4)l._callback(null,r);else{0<h.length&&(h.push(t),h.pop(h[h.length-1]),h.push(h[0]));for(var e=ZenMap.T.getPoints(l._map,h),i=[],o=0;o<e.length;o++)i.push(new ZenMap.Geometry.Point(e[o].lon,e[o].lat));t=new ZenMap.Geometry.Polygon(e,n);l._callback(t,r)}};this._map._obj.on("mousedown",s),this.drawFreeHander.mouseDownFun=s,this.drawFreeHander.mouseUPFun=c,this.drawFreeHander.mouseMoveFun=p},t.prototype._drawCircleDiameter=function(i,o){this.drawCircleDiameter={},this._map._obj.getCanvas().style.cursor="crosshair";function r(t){0<t.originalEvent.button||(u._map._obj.dragPan.disable(),c=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),u._map._obj.addSource("draw_source",e),u._map._obj.addLayer(n),u._map._obj.addLayer(s),u._map._obj.addLayer(a),u.showRadius&&u._map._obj.addLayer(l),u._map._obj.on("mousemove",h),u._map._obj.on("mouseup",p))}var c,u=this,e={type:"geojson",data:{type:"FeatureCollection",features:[]}},n={id:"ZenMap_draw_Polygon",type:"fill",source:"draw_source",paint:{"fill-color":this.fillColor,"fill-opacity":this.fillOpacity},filter:["==","$type","Polygon"]},s={id:"ZenMap_diameter_Line",type:"line",source:"draw_source",layout:{"line-join":this.lineJoin,"line-cap":this.lineCap},paint:{"line-color":this.diameterColor,"line-width":this.diameterWidth,"line-dasharray":this.diameterDasharray},filter:["all",["any",["==","$type","LineString"],["==","$type","Polygon"]],["==","isDiameter",!0]]},a={id:"ZenMap_draw_Line",type:"line",source:"draw_source",paint:{"line-color":this.strokeColor,"line-width":this.strokeWidth},filter:["all",["any",["==","$type","LineString"],["==","$type","Polygon"]],["==","isDiameter",!1]]},l={id:"ZenMap_draw_Label",type:"symbol",source:"draw_source",layout:{"text-field":"{title}","text-font":[this.labelStyle.fontFamily],"text-allow-overlap":!0,"text-offset":this.labelStyle.offset,"text-size":this.labelStyle.fontSize},paint:{"text-color":this.labelStyle.color,"text-opacity":this.labelStyle.opacity},filter:["==","$type","Point"]},h=function(t){var e=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),i=u._getDistance(c,e)/2,o=new ZenMap.Geometry.Point((c.lon+e.lon)/2,(c.lat+e.lat)/2);pmCenter=ZenMap.T.helper.webMoctorJW2PM(o.lon,o.lat);var r=ZenMap.Utils.MapUtil.createRegularPolygon(pmCenter,i,60),n={type:"geojson",data:{type:"FeatureCollection",features:[]}},s={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]},properties:{}},a={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{isDiameter:!0}},l={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{isDiameter:!1}};u.showRadius&&((t={type:"Feature",geometry:{type:"Point",coordinates:[]},properties:{}}).geometry.coordinates=[o.lon,o.lat],t.properties.title="EN"==ZenMap.CULTURE?"r=":"="+Math.round(i)+"m",n.data.features.push(t));for(var h=0;h<r.length;h++){var p=ZenMap.T.helper.inverseMercator(r[h].lon,r[h].lat);s.geometry.coordinates[0].push([p.lon,p.lat]),l.geometry.coordinates.push([p.lon,p.lat])}a.geometry.coordinates.push([c.lon,c.lat]),a.geometry.coordinates.push([e.lon,e.lat]),n.data.features.push(s),n.data.features.push(l),n.data.features.push(a),u._map._obj.getSource("draw_source").setData(n.data)},p=function(t){u._map._obj.dragPan.enable();var e=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),t=u._getDistance(c,e)/2;u._map._obj.off("mousedown",r),u._map._obj.off("mousemove",h),u._map._obj.off("mouseup",p),u._remove(),u._map._obj.getCanvas().style.cursor="",u._map.isDrawing=!1,0!=t?(e=new ZenMap.Geometry.Point((c.lon+e.lon)/2,(c.lat+e.lat)/2),e=ZenMap.T.getPoint(u._map,e),t=new ZenMap.Geometry.Circle(e,t,o),u._callback(t,i)):u._callback(null,i)};this._map._obj.on("mousedown",r),this.drawCircleDiameter.mouseDownFun=r,this.drawCircleDiameter.mouseUPFun=p,this.drawCircleDiameter.mouseMoveFun=h}}(),ZenMap.MEASURE_MODE_DISTANCE=0,ZenMap.MEASURE_MODE_AREA=1,ZenMap.MEASURE_MODE_LOCATION=2,function(){var t=ZenMap.Tools.MeasureTool=function(t){this.CLASS_NAME="ZenMap.Tools.MeasureTool",this._lengthUnit=ZenMap.MAP_UNITS_METERS,this._areaUnit=ZenMap.MAP_UNITS_SQUARE_KILOMETERS,this._mode=ZenMap.MEASURE_MODE_DISTANCE,this._isStartUp=!1,this._map=t,this._measureFeatures=[],this._measureMarker=[],this._Centext=[]};t.prototype.setMode=function(t,e,i){this._cancelMeasureEvent(),this._map.disableDoubleClickZoom(),this._map.isDrawing=!0,t!==ZenMap.MEASURE_MODE_DISTANCE&&t!==ZenMap.MEASURE_MODE_AREA&&t!==ZenMap.MEASURE_MODE_LOCATION||((this._mode=t)===ZenMap.MEASURE_MODE_DISTANCE&&this._measureDistance(e,i),t===ZenMap.MEASURE_MODE_AREA&&this._measureArea(e,i),ZenMap.MEASURE_MODE_LOCATION)},t.prototype._measureDistance=function(a,l){this.action={},this._action=!0,this._map._obj.getCanvas().style.cursor="crosshair";var h=new ZenMap.Controls.MouseContextControl(this._map),p=new ZenMap.Controls.MouseContextControl(this._map);this._Centext.push(h),this._Centext.push(p);var r,c,u,d,f,i,g=[],y=[],m=this,_=[];this._measureMarker.push(_);function v(t){var e,i,o;2!=t.originalEvent.button&&"dblclick"!=t.type&&((e=document.createElement("div")).style.border="1px solid rgb(204, 204, 204)",e.style.padding="2px 8px",e.style.fontFamily="",e.style.backgroundColor="rgb(255, 255, 255)",i=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),i=ZenMap.T.getPoint(m._map,i),r=new ZenMap.Geometry.Star(i),y.push(r),g.push(i),m._map.addOverlay(r),m._measureFeatures.push(r),1==g.length?(e.innerHTML="EN"==ZenMap.CULTURE?"starting point":"",o=new zmapboxgl.Marker(e).setLngLat(t.lngLat).setOffset({x:30,y:0}).addTo(m._map._obj),_.push(o)):(2==g.length?(c=new ZenMap.Geometry.Polyline(g),m._map.addOverlay(c),m._measureFeatures.push(c)):c.setPath(g),f=c.layer.getFeature(c.id),_[_.length-1].getLngLat().lng==t.lngLat.lng&&_[_.length-1].getLngLat().lat==t.lngLat.lat||(o=1e3*ZenMap.Utils.MapUtil.lineDistance(f),e.innerHTML=1e3<o?(o/1e3).toFixed(1).toLocaleString()+("EN"==ZenMap.CULTURE?"KM":""):o.toFixed(1).toLocaleString()+("EN"==ZenMap.CULTURE?"M":""),t=new zmapboxgl.Marker(e).setLngLat(t.lngLat).setOffset({x:45,y:0}).addTo(m._map._obj),_.push(t))))}function b(t){h.active();var e={width:"80px",height:"20px",paddingLeft:"5px",border:"1px solid rgb(204, 204, 204)"};"EN"==ZenMap.CULTURE&&(e={width:"200px",height:"20px",paddingLeft:"5px",border:"1px solid rgb(204, 204, 204)"}),h.setContextStyle(e),h.setContext("EN"==ZenMap.CULTURE?"Click to determine the starting point":""),0!=g.length&&(u||(u=new ZenMap.Geometry.Star(ZenMap.T.getPoint(m._map,new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat))),m._map.addOverlay(u),m._activePoint=u),u.setPosition(ZenMap.T.getPoint(m._map,new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat))),t=[g[g.length-1],ZenMap.T.getPoint(m._map,new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat))],d?d.setPath(t):(h.disactive(),d=new ZenMap.Geometry.Polyline(t,{lineStyle:"ZenMap.LINE_TYPE_DASH",weight:2,noTransform:!0}),m._map.addOverlay(d),m._measureFeatures.push(d)),i=d.layer.getFeature(d.id),p.active(),t={width:"160px",height:"40px",paddingLeft:"5px",border:"1px solid rgb(204, 204, 204)"},"EN"==ZenMap.CULTURE&&(t.height="60px"),p.setContextStyle(t),t=f?parseFloat(ZenMap.Utils.MapUtil.lineDistance(i))+parseFloat(ZenMap.Utils.MapUtil.lineDistance(f)):parseFloat(ZenMap.Utils.MapUtil.lineDistance(i).toLocaleString()),1e3<(t*=1e3)?p.setContext(("EN"==ZenMap.CULTURE?"Total length":": ")+t.toFixed(1).toLocaleString()+("EN"==ZenMap.CULTURE?"KM":"")+"<br>"+("EN"==ZenMap.CULTURE?"Click Continue, double click or right click to end":"")):p.setContext(("EN"==ZenMap.CULTURE?"Total length":": ")+t.toFixed(1).toLocaleString()+("EN"==ZenMap.CULTURE?"M":"")+"<br>"+("EN"==ZenMap.CULTURE?"Click Continue, double click or right click to end":"")))}var x=function(t){if(p.disactive(),h.disactive(),m._map._obj.getCanvas().style.cursor="",m._map.isDrawing=!1,m._map._obj.off("mousemove",b),m._map._obj.off("click",v),m._map._obj.off("contextmenu",w),m._map._obj.off("dblclick",x),0==g.length||2==g.length&&g[0].lon==g[1].lon&&g[0].lat==g[1].lat){for(var e=0;e<m._measureFeatures.length;e++)"ZenMap.Geometry.Star"==m._measureFeatures[e].CLASS_NAME&&m._measureFeatures[e]._position.lon==g[0].lon&&m._measureFeatures[e]._position.lat==g[0].lat&&m._map.removeOverlay(m._measureFeatures[e]);m._map.removeOverlay(c);for(e=0;e<m._measureMarker.length;e++)for(var i=0;i<m._measureMarker[e].length;i++)m._measureMarker[e][i]._lngLat.lng==t.lngLat.lng&&m._measureMarker[e][i]._lngLat.lat==t.lngLat.lat&&m._measureMarker[e][i].remove()}else{m._map.removeOverlay(d),m._map.removeOverlay(u),g[g.length-1].lon==g[g.length-2].lon&&g[g.length-1].lat==g[g.length-2].lat&&g.pop(g[g.length-1]),c.setPath(g);var o=document.createElement("div");o.style.border="1px solid rgb(204, 204, 204)",o.style.padding="2px 8px",o.style.fontFamily="",o.style.backgroundColor="rgb(255, 255, 255)";var r=1e3*ZenMap.Utils.MapUtil.lineDistance(f);a&&a instanceof Function&&a(Math.round(r)),o.innerHTML=1e3<r?("EN"==ZenMap.CULTURE?"Total length":": ")+(r/1e3).toFixed(1).toLocaleString()+("EN"==ZenMap.CULTURE?"KM":"")+"<i></i>":("EN"==ZenMap.CULTURE?"Total length":": ")+r.toFixed(1).toLocaleString()+("EN"==ZenMap.CULTURE?"M":"")+"<i></i>";var n=_[_.length-1],r=n.getLngLat();n.remove(),_.pop(),n=new zmapboxgl.Marker(o).setLngLat(r).setOffset({x:80,y:0}).addTo(m._map._obj),_.push(n);var s=n.getElement().children[0];s.style.width="14px",s.style.height="14px",s.style.display="inline-block",s.style.marginLeft="5px",s.style.marginTop="2px",s.style.cursor="pointer",s.style.float="right",s.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/close.png) no-repeat",s.onmouseover=function(){s.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/closehover.png) no-repeat"},s.onmouseout=function(){s.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/close.png) no-repeat"},s.onclick=function(){m._map.removeOverlay(c),m._map.removeOverlays(y);for(var t=0;t<_.length;t++)_[t].remove();_.length=0,l&&l instanceof Function&&l()},setTimeout(function(){m._map.enableDoubleClickZoom()},100),this._action=!1}},w=function(t){if(p.disactive(),h.disactive(),m._map._obj.getCanvas().style.cursor="",m._map.isDrawing=!1,m._map._obj.off("mousemove",b),m._map._obj.off("click",v),m._map._obj.off("contextmenu",w),m._map._obj.off("dblclick",x),0==g.length)for(var e=0;e<m._measureMarker.length;e++)for(var i=0;i<m._measureMarker[e].length;i++)m._measureMarker[e][i]._lngLat.lng==t.lngLat.lng&&m._measureMarker[e][i]._lngLat.lat==t.lngLat.lat&&m._measureMarker[e][i].remove();else{m._map.removeOverlay(d),m._map.removeOverlay(u);var o=document.createElement("div");if(o.style.border="1px solid rgb(204, 204, 204)",o.style.padding="2px 8px",o.style.fontFamily="",o.style.backgroundColor="rgb(255, 255, 255)",f){var r=1e3*ZenMap.Utils.MapUtil.lineDistance(f);a&&a instanceof Function&&a(Math.round(r)),o.innerHTML=1e3<r?("EN"==ZenMap.CULTURE?"Total length":": ")+(r/1e3).toFixed(1).toLocaleString()+("EN"==ZenMap.CULTURE?"KM":"")+"<i></i>":("EN"==ZenMap.CULTURE?"Total length":": ")+r.toFixed(1).toLocaleString()+("EN"==ZenMap.CULTURE?"M":"")+"<i></i>";var n=_[_.length-1],r=n.getLngLat();n.remove(),_.pop(),n=new zmapboxgl.Marker(o).setLngLat(r).setOffset({x:80,y:0}).addTo(m._map._obj),_.push(n);var s=n.getElement().children[0];s.style.width="14px",s.style.height="14px",s.style.display="inline-block",s.style.marginLeft="5px",s.style.marginTop="2px",s.style.cursor="pointer",s.style.float="right",s.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/close.png) no-repeat",s.onmouseover=function(){s.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/closehover.png) no-repeat"},s.onmouseout=function(){s.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/close.png) no-repeat"},s.onclick=function(){m._map.removeOverlay(c),m._map.removeOverlays(y);for(var t=0;t<_.length;t++)_[t].remove();_.length=0,l&&l instanceof Function&&l()},m._map.enableDoubleClickZoom(),this._action=!1}else{m._map.removeOverlays(y);for(e=0;e<_.length;e++)_[e].remove();_.length=0}}};this.action.clickFun=v,this.action.dblFun=x,this.action.moveFun=b,this.action.rightFun=w,this._map._obj.on("click",v),this._map._obj.on("mousemove",b),this._map._obj.on("contextmenu",w),this._map._obj.on("dblclick",x)},t.prototype._measureArea=function(u,d){this.areaAction={};var f=this,g=[],y=[];this._measureMarker.push(y);var t=new ZenMap.Tools.DrawingTool(this._map),m=function(t){t=new ZenMap.Geometry.Point(t.lngLat.lng,t.lngLat.lat),t=new ZenMap.Geometry.Star(ZenMap.T.getPoint(f._map,t));g.push(t),f._map.addOverlay(t),f._measureFeatures.push(t)};f._map._obj.on("click",m),t.setMode(ZenMap.DRAW_MODE_POLYLGON,function(t,e){f._map.removeOverlays(g);var i=e._points;if(i.length<4)return f._map.removeOverlays(g),void f._map._obj.off("click",m);for(var o=[],r=0;r<i.length;r++){var n=new ZenMap.Geometry.Star(i[r]);o.push(n)}e.setStyle({color:"#ff0000",fillColor:"#ff0000",fillOpacity:.2}),f._map.addOverlays(o),f._map.addOverlay(e);for(r=0;r<o.length;r++)f._measureFeatures.push(o[r]);f._measureFeatures.push(e);var s=e.layer.getFeature(e.id),a=document.createElement("div");a.style.border="1px solid rgb(204, 204, 204)",a.style.padding="2px 8px",a.style.fontFamily="",a.style.backgroundColor="rgb(255, 255, 255)";var l=ZenMap.T.setPoint(f._map,i[i.length-2]),h=ZenMap.Utils.MapUtil.getArea(s);a.innerHTML=1e5<h?(h/1e6).toFixed(1).toLocaleString()+("EN"==ZenMap.CULTURE?" Square Kilmeter":"")+"<i></i>":h.toFixed(1).toLocaleString()+("EN"==ZenMap.CULTURE?" Square meter":"")+"<i></i>";var p=new zmapboxgl.Marker(a).setLngLat([l.lon,l.lat]).setOffset({x:80,y:0}).addTo(f._map._obj);y.push(p),u&&u instanceof Function&&u(Math.round(ZenMap.Utils.MapUtil.getArea(s)));var c=p.getElement().children[0];c.style.width="14px",c.style.height="14px",c.style.display="inline-block",c.style.marginLeft="5px",c.style.marginTop="2px",c.style.cursor="pointer",c.style.float="right",c.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/close.png) no-repeat",c.onmouseover=function(){c.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/closehover.png) no-repeat"},c.onmouseout=function(){c.style.background="url("+ZenMap.Utils.BaseUtils.getHostPath()+"/ZenView/close.png) no-repeat"},c.onclick=function(t){t.stopPropagation(),f._map.removeOverlay(e),f._map.removeOverlays(o),f._map.removeOverlays(g),p.remove(),d&&d instanceof Function&&d()},f._map._obj.off("click",m)}),this.areaAction.clickFun=m,this.areaAction.draw=t},t.prototype.cancleMeasure=function(){this._cancelMeasureEvent(),this._activePoint&&this._map.removeOverlay(this._activePoint);for(var t=0;t<this._measureFeatures.length;t++)this._map.removeOverlay(this._measureFeatures[t]);for(t=0;t<this._measureMarker.length;t++)for(var e=0;e<this._measureMarker[t].length;e++)this._measureMarker[t][e].remove()},t.prototype.cancel=function(){this.cancleMeasure()},t.prototype._cancelMeasureEvent=function(){this._map.isDrawing=!1,this.areaAction&&(this._map._obj.off("click",this.areaAction.clickFun),this.areaAction.draw.cancleDraw()),this.action&&(this._map._obj.off("mousemove",this.action.moveFun),this._map._obj.off("click",this.action.clickFun),this._map._obj.off("contextmenu",this.action.rightFun),this._map._obj.off("dblclick",this.action.dblFun));for(var t=0;t<this._Centext.length;t++)this._Centext[t].disactive();this._map._obj.getCanvas().style.cursor="",this._map.enableDoubleClickZoom()}}(),function(){ZenMap.PlotTypes=P.PlotTypes;var i={type:"geojson",data:{type:"FeatureCollection",features:[]}},t=ZenMap.Tools.DrawingPlotTool=function(t){this._map=t,i={type:"geojson",data:{type:"FeatureCollection",features:[]}},this._map._obj.addSource("viewLayerTempSource",i),this._map._obj.addLayer({id:"view-temp-fill-layer",type:"fill",source:"viewLayerTempSource",paint:{"fill-color":["get","fillColor"],"fill-opacity":["get","opacity"]},filter:["==","$type","Polygon"]}),this._map._obj.addLayer({id:"view-temp-line-layer",type:"line",source:"viewLayerTempSource",paint:{"line-color":["get","color"],"line-width":["get","width"]},filter:["any",["==","$type","LineString"],["==","$type","Polygon"]]});var e=this;this.plotDraw=new P.PlotDraw(this._map._obj),this.plotDraw.on(P.Event.PlotDrawEvent.DRAW_END,function(t){i.data.features=[],e._map._obj.getCanvas().style.cursor="",e._map.isDrawing=!1,e._map._obj.getSource("viewLayerTempSource").setData(i.data),e._callback&&e._callback instanceof Function&&(t.feature.properties.color=e.curentStyle.color,t.feature.properties.fillColor=e.curentStyle.fillColor,t.feature.properties.width=e.curentStyle.width,t.feature.properties.opacity=e.curentStyle.opacity,e._callback(t.feature))},!1,this),this.plotDraw.on(P.Event.PlotDrawEvent.DRAW_MOVING,function(t){i.data.features=[],e._map._obj.getCanvas().style.cursor="crosshair",t.feature.properties.color=e.curentStyle.color,t.feature.properties.fillColor=e.curentStyle.fillColor,t.feature.properties.width=e.curentStyle.width,t.feature.properties.opacity=e.curentStyle.opacity,i.data.features.push(t.feature),e._map._obj.getSource("viewLayerTempSource").setData(i.data)},!1,this)};t.prototype.setMode=function(t,e,i){this._map.isDrawing=!0,this.plotDraw.activate(t),this._map._obj.getCanvas().style.cursor="crosshair",this.curentStyle=ZenMap.Utils.extend({color:"#2E8CFF",width:4,fillColor:"#2E8CFF",opacity:.8},i),this._callback=e},t.prototype.cancleDraw=function(){this._map.isDrawing=!1,this._map._obj.getCanvas().style.cursor="",this.plotDraw.deactivate()},t.prototype.destory=function(){this.cancleDraw(),this._map._obj.getLayer("view-temp-fill-layer")&&this._map._obj.removeLayer("view-temp-fill-layer"),this._map._obj.getLayer("view-temp-line-layer")&&this._map._obj.removeLayer("view-temp-line-layer"),this._map._obj.getSource("viewLayerTempSource")&&this._map._obj.removeSource("viewLayerTempSource")}}(),function(){P.PlotEdit.prototype.initControlPoints=function(){if(this.map&&this.zmapboxgl){this.controlPoints=[];for(var t=this.getControlPoints(),e=0;e<t.length;e++){var i=this.Constants.HELPER_CONTROL_POINT_DIV+"-"+e,i=P.DomUtils.get(i),i=new this.zmapboxgl.Marker({draggable:!0,element:i}).setLngLat(t[e]).addTo(this.map);this.controlPoints.push(i),i.on("dragend",function(){window._PlotEdit.dispatchEvent(new P.Event.PlotEditEvent(P.Event.PlotEditEvent.DRAG_POINT_END,window._PlotEdit.handleMarkerDragEvent()))}),i.on("drag",function(){window._PlotEdit.dispatchEvent(new P.Event.PlotEditEvent(P.Event.PlotEditEvent.DRAG_POINT_MOVING,window._PlotEdit.handleMarkerDragEvent()))})}}},P.PlotEdit.prototype.activate=function(t){t.properties.isplot&&(this._activeFeature=t,this.deactivate(),this.plotType=t.properties.plotType,this.activePlot=new ol.Feature(P.PlotFactory.createPlot(t.properties.plotType,JSON.parse(t.properties.coordinates),null)),(window._PlotEdit=this).initHelperDom(),this.initControlPoints(),this.map.on("pointermove",this.plotMouseOverOutHandler))};var t=ZenMap.Tools.EditPlotTool=function(e){this.plotEdit=new P.PlotEdit(e._map._obj,zmapboxgl),this.plotEdit.on(P.Event.PlotEditEvent.DRAG_POINT_MOVING,function(t){t.feature.properties.color=t.g._activeFeature.properties.color,t.feature.properties.fillColor=t.g._activeFeature.properties.fillColor,t.feature.properties.width=t.g._activeFeature.properties.width,t.feature.properties.opacity=t.g._activeFeature.properties.opacity,e.updataFeatureByID(t.g._activeFeature.properties.id,t.feature)},!1,this),this.plotEdit.on(P.Event.PlotEditEvent.DRAG_POINT_END,function(t){t.feature.properties.color=t.g._activeFeature.properties.color,t.feature.properties.fillColor=t.g._activeFeature.properties.fillColor,t.feature.properties.width=t.g._activeFeature.properties.width,t.feature.properties.opacity=t.g._activeFeature.properties.opacity,e.updataFeatureByID(t.g._activeFeature.properties.id,t.feature)},!1,this)};t.prototype.activate=function(t){t?this.plotEdit.activate(t):this.plotEdit.deactivate()},t.prototype.deactivate=function(){this.plotEdit.deactivate()},t.prototype.destroy=function(){this.plotEdit.deactivate(),this.plotEdit=null}}(),function(){var e=ZenMap.Services.BufferService=function(t,e){this.serviceType=e||ZenMap.MAPTYPE_ZENMAP,this.url="",this.map=t,this.CLASS_NAME="ZenMap.Services.BufferService"};e.prototype.buffer=function(t,e,i,o){switch(o=o||function(t){return alert(ZenMap.Utils.BaseUtils.toJson(t)),!1},this.serviceType){case ZenMap.MAPTYPE_ARCGISTILE:return this._bufferArcGIS(t,e,i,o);case ZenMap.MAPTYPE_ZENMAP:default:return this._queryNPGIS(t,e,i,o)}},e.prototype._getStrByPoints=function(t){var e;if(t instanceof Array){for(var i=0;i<t.length;i++){var o=t[i].split(" "),o=ZenMap.T.helper.webMoctorJW2PM(o[0],o[1]);0==i&&(e=o.lon.toString().concat(" ").concat(o.lat.toString())),0<i&&(e=e+","+o.lon.toString().concat(" ").concat(o.lat.toString()))}return e}},e.prototype._queryNPGIS=function(t,e,i,o){this._dataConfig(t,e,i,o);var e=/\)\s*,\s*\(/,r=/^\s*\(?(.*?)\)?\s*$/,o=/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/.exec(this.geometry),n="",s=this;if("GEOMETRYCOLLECTION"==o[1]){for(var a=o[2].split("LINESTRING"),l=1;l<a.length;l++){var h,p=a[l].substring(a[l].indexOf("(")+1,a[l].indexOf(")")).split(",");n+=h="LINESTRING("+this._getStrByPoints(p)+")",l!=a.length-1&&(n+=",")}_=o[1]+"("+n+")"}else if("POLYGON"==o[1])f=o[2].substring(o[2].indexOf("(")+1,o[2].indexOf(")")).split(","),h=this._getStrByPoints(f),_=o[1]+"(("+h+"))";else if("MULTILINESTRING"==o[1]){for(var a=[],c=o[2].trim().split(e),l=0,u=c.length;l<u;++l){var d=[];ring=c[l].replace(r,"$1");for(var f,g=0,y=(f=ring.trim().split(",")).length;g<y;++g)point=f[g].replace(r,"$1"),d.push(point);var m="("+this._getStrByPoints(d)+")";a.push(m)}_=o[1]+"("+a.join(",")+")"}else f=o[2].split(","),h=this._getStrByPoints(f),_=o[1]+"("+h+")";var _="&geometry="+_.toLocaleString()+"&distance="+this.distance+"&srid=900913";return ZenMap.Utils.Request.Post(t,{"Content-Type":"application/x-www-form-urlencoded"},_,function(t){t&&"POLYGON EMPTY"!=t&&(t=WKT.read(t),s._callback(t,i))})},e.prototype._bufferArcGIS=function(url,params,successCallback,errorCallback){var unionResults=!0,geodesic=!1;if(url&&(this.url=url),params.geometry){var projection=this.map.getProjection();switch(projection){case"EPSG:4326":projection=4326;break;case"EPSG:900913":case"EPSG:3857":projection=3857}if(params.geometry instanceof ZenMap.Geometry.Point){this.geometryType="esriGeometryPoint";var points=params.geometry,point={x:points.lon,y:points.lat,spatialReference:{wkid:projection}},points=[];points.push(point);var geometries={geometryType:this.geometryType,geometries:points}}else if(params.geometry instanceof ZenMap.Geometry.Polyline){this.geometryType="esriGeometryPolyline";for(var points=params.geometry.getPath(),paths=[],path=[],i=0;i<points.length;i++)path.push([points[i].lon,points[i].lat]);paths.push(path);var polylines=[],polyline={paths:paths,spatialReference:{wkid:projection}};polylines.push(polyline);var geometries={geometryType:this.geometryType,geometries:polylines}}else if(params.geometry instanceof ZenMap.Geometry.Polygon){this.geometryType="esriGeometryPolygon";for(var points=params.geometry.getPath(),rings=[],ring=[],i=0;i<points.length;i++)ring.push([points[i].lon,points[i].lat]);rings.push(ring);var polygons=[],polygon={rings:rings,spatialReference:{wkid:projection}};polygons.push(polygon);var geometries={geometryType:this.geometryType,geometries:polygons}}else params.geometry instanceof ZenMap.Geometry.Multipoint&&(this.geometryType="esriGeometryMultipoint");geometries=ZenMap.Utils.BaseUtils.toJson(geometries),distance=params.distance,params.geometry instanceof ZenMap.Geometry.Point&&(distance=[distance,10]);var self=this}return ZenMap.Utils.Request.Get(this.url,{f:params.format,unionResults:unionResults,geodesic:geodesic,geometries:geometries,inSR:projection,distances:distance,outSR:projection,bufferSR:projection,AK:window.NPGIS_AUTHKEY},function(reply){var projection=self.map.getProjection(),reply=eval("("+reply.responseText+")"),rings=[];if(!reply.error)for(var temp=[],i=0;i<reply.geometries[0].rings.length;i++){temp=[],ring=reply.geometries[0].rings[i];for(var j=0;j<ring.length;j++){var point=new ZenMap.Geometry.Point(ring[j][0],ring[j][1]);temp.push(point)}rings.push(temp)}var out={rings:rings,spatialReference:projection};"function"==typeof successCallback&&successCallback(out)},function(t){"function"==typeof errorCallback&&errorCallback(t.responseText)})},e.prototype._dataConfig=function(t,e,i,o){t&&(this.url=t),this.distance=e.distance,e.geometry&&(this.geometry=WKT.write(e.geometry,this.map))},e.prototype._callback=function(t,e){var i,o=[];if(t)if(t instanceof Array)o=1===t.length?t[0].getPath():t;else if(0<(i=t.getPath()).length&&null==i[0].length){for(var r=[],n=0;n<i.length;n++){var s=ZenMap.T.helper.inverseMercator(i[n].lon,i[n].lat);r.push(s)}o.push(r)}else for(n=0;n<i.length;n++){for(var r=[],a=0;a<i[n].length;a++){s=ZenMap.T.helper.inverseMercator(i[n][a].lon,i[n][a].lat);r.push(s)}o.push(r)}1==o.length&&(o=o[0]),"function"==typeof e&&e({rings:o})}}(),ZenMap.Services.bufferParams=function(){this.distance=0,this.unit="m",this.quadrantSegments="",this.capStyle="",this.format="json"},function(){var e=ZenMap.Services.QueryService=function(t){this.serviceType=t||ZenMap.MAPTYPE_ZENMAP,this.filter=null,this.CLASS_NAME="ZenMap.Services.QueryService"};e.prototype.query=function(t,e,i,o){switch(o=o||function(t){return alert(ZenMap.Utils.BaseUtils.toJson(t)),!1},this.serviceType){case ZenMap.MAPTYPE_ARCGISTILE:return this._queryArcGIS(t,e,i,o);case ZenMap.MAPTYPE_PGIS:return this._queryPgis(t,e,i,o);case ZenMap.MAPTYPE_ZENMAP:default:return this._queryNPGIS(t,e,i,o)}},e.prototype._queryNPGIS=function(url,params,successCallback,errorCallback){if(params.requestType&&"post"==params.requestType){var params="&"+ZenMap.Utils.Request.getParams(params);return ZenMap.Utils.Request.Post(url,{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},params,function(reply){var result;"function"==typeof successCallback&&(""===reply&&(reply="{}"),result=eval("("+reply+")"),successCallback(result))},function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply+")")):alert("failed")})}return ZenMap.Utils.Request.Get(url,params,function(reply){var result;"function"==typeof successCallback&&(""===reply&&(reply="{}"),result=eval("("+reply+")"),successCallback(result))},function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply+")")):alert("failed")})},e.prototype.updata=function(url,params,successCallback,errorCallback){return errorCallback=errorCallback||function(t){return alert(ZenMap.Utils.BaseUtils.toJson(t)),!1},ZenMap.Utils.Request.Get(url,params,function(reply){var result;"function"==typeof successCallback&&(result=eval("("+reply.responseText+")"),successCallback(result))},function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply.responseText+")")):alert("failed")})},e.prototype._formartGeometryType=function(t){if(t){if("MultiLineString"==t||"esriGeometryPolyline"==t)return"ZenMap.Geometry.Polyline";if("point"==t||"Point"==t||"esriGeometryPoint"==t)return"ZenMap.Geometry.Point"}return""},e.prototype._queryArcGIS=function(url,params,successCallback,errorCallback){url&&(this.url=url);var me=this;return ZenMap.Utils.Request.Get(this.url,{f:params.outputFormat,searchText:params.searchText,contains:params.contains,returnGeometry:params.returnGeometry,layers:params.layers.join(","),searchFields:params.searchFields},function(reply){var result;"function"==typeof successCallback&&(result=eval("("+reply.responseText+")"),successCallback(this.arrangeArcgisData(result.results)))},function(t){"function"==typeof errorCallback&&errorCallback(t.responseText)})},e.prototype.arrangeArcgisData=function(t){for(var e=[],i=0;i<t.length;i++){var o=t[i],r=this._formartGeometryType(o.geometryType);e.push({displayFieldName:o.displayFieldName,foundFieldName:o.foundFieldName,geometryType:r,layerId:o.layerId,layerName:o.layerName,value:o.value,feature:{attributes:o.attributes,geometry:"ZenMap.Geometry.Polyline"==r?o.geometry.paths:{x:o.geometry.x,y:o.geometry.y},featureType:r}})}return e},e.prototype.arrangeGeoserverData=function(t){for(var e=[],i=0;i<t.length;i++){var o=t[i];e.push({displayFieldName:"",foundFieldName:"",geometryType:this._formartGeometryType(o.geometry.type),layerId:o.id,layerName:o.id,value:o.properties.NAME,feature:{attributes:o.properties,geometry:o.geometry.coordinates,featureType:this._formartGeometryType(o.geometry.type)}})}return e},e.prototype.arrangeNpGISData=function(data){for(var result=[],i=0;i<data.length;i++){var item=data[i],geometry=eval("("+item.geometry+")");result.push({attributes:item,feature:{geometry:geometry,featureType:this._formartGeometryType(geometry.type)}})}return result}}(),ZenMap.Services.queryParams=function(){this.returnGeometry=!0,this.searchFields="NAME",this.layers="",this.searchText="",this.contains=!0,this.service="WFS",this.serviceVersion="1.0.0",this.outputFormat="json",this.request="GetFeature"},function(){ZenMap.Services.RouteService=function(t,e){this.map=t,this.serviceType=e||ZenMap.MAPTYPE_ZENMAP,this.url="",this.CLASS_NAME="ZenMap.Services.RouteService"},ZenMap.Services.RouteService.prototype.route=function(t,e,i,o){switch(o=o||function(t){return alert(ZenMap.Utils.BaseUtils.toJson(t)),!1},this.serviceType){case ZenMap.MAPTYPE_ARCGISTILE:return this._routeArcGIS(t,e,i,o);case ZenMap.MAPTYPE_PGIS:return this._routePgis(t,e,i,o);default:return this._routeGeoserver(t,e,i,o)}},ZenMap.Services.RouteService.prototype._routeGeoserver=function(url,params,successCallback,errorCallback){if(params.startStop instanceof ZenMap.Geometry.Point&&params.endStop instanceof ZenMap.Geometry.Point){var stops="",startStop=new ZenMap.Geometry.Point(params.startStop.lon,params.startStop.lat);stops+=WKT.write(startStop,this.map)+"|";var endStop=new ZenMap.Geometry.Point(params.endStop.lon,params.endStop.lat);stops+=WKT.write(endStop,this.map);for(var lang="CN"===ZenMap.CULTURE?"zh_CN":"en_US",lang=params.lang||lang,barries="",i=0;i<params.geoBarriers.length;i++)barries+=""===barries?WKT.write(params.geoBarriers[i],this.map):"|"+WKT.write(params.geoBarriers[i],this.map);return url&&(this.url=url),ZenMap.Utils.Request.Get(url,{service:params.service,version:params.version||"1.0.0",outputFormat:params.outputFormat||"json",request:params.request,graph:params.networkName,algorithm:params.algorithm||"Dijkstra",weighter:params.weighter||"length",stops:stops,restrictField:params.trafficModel||"car",planroadtype:params.planRoadType||"1",geoms:barries,lang:lang,AK:window.NPGIS_AUTHKEY},function(reply){if(!(reply.status<2)){var infos={},infos=eval("("+reply+")");if(infos!={}){var strs=infos.routelatlon;if(""!==strs){var messages=infos.routes||{segments:[]},features=[];""!=strs&&(features=GeoJSON.read(strs));for(var allPoints=0<features.length?features[0].getPath():[],k=0;k<messages.segments.length;k++){var tempfeatures=GeoJSON.read(messages.segments[k].routelatlon);messages.segments[k].features=tempfeatures}messages.endPoint=GeoJSON.read(messages.endPoint),messages.startPoint=GeoJSON.read(messages.startPoint),"function"==typeof successCallback&&successCallback({features:features,params:params,messages:messages,points:allPoints,routelatlon:strs})}}}},function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply+")")):alert("failed")})}},ZenMap.Services.RouteService.prototype.routeByMultPoints=function(url,param,successCallback,errorCallback){var postData="stops="+param.stops;return ZenMap.Utils.Request.Post(url,{"Content-Type":"application/x-www-form-urlencoded"},postData,function(reply){var infos;reply.status<2||(infos=eval("("+reply+")"),"function"==typeof successCallback&&successCallback(infos))},function(reply){"function"==typeof errorCallback&&errorCallback(eval("("+reply+")"))})},ZenMap.Services.RouteService.prototype._routeArcGIS=function(t,f,g,e){var y=["","","","","","","","","","","","","","","","",""];f.RestrictField||(f.RestrictField="car");var i=t+(f.extendURL||"/v3/route/")+f.RestrictField,o=11;switch(f.planRoadType){case"1":o=11;break;case"2":o=12;break;case"3":o=5}t={origin:"116.361437,39.947866",destination:"116.384096,39.903634",output:"json",ak:f.ak,coord_type:"wgs84",out_coord_type:"wgs84",region:f.region,tactics:o,avoidroad:f.params};if(f.startStop instanceof ZenMap.Geometry.Point&&f.endStop instanceof ZenMap.Geometry.Point&&(t.origin=f.startStop.toString(),t.destination=f.endStop.toString()),f.geoBarriers&&0<f.geoBarriers.length){for(var r=[],n=0;n<f.geoBarriers.length;n++){for(var s=f.geoBarriers[n].getPath(),a=[],n=s.length-1;0<=n;n--)a.push(s[n].toString());r.push(a.join(";"))}t.avoidpolygons=r.join("|")}ZenMap.Utils.Request.Get(i,t,function(t){var e=JSON.parse(t);if("0"==e.status&&e.result&&e.result.routes&&0<e.result.routes.length){(t=e.result).routes;for(var i=[],o=0;o<t.routes.length;o++){for(var r=t.routes[o],n=[],s={length:r.distance,time:r.duration,count:r.steps.length,segments:[],endPoint:new ZenMap.Geometry.Point(t.destination.destinationPt.lng,t.destination.destinationPt.lat),startPoint:new ZenMap.Geometry.Point(t.origin.originPt.lng,t.origin.originPt.lat)},a={type:"MultiLineString",coordinates:[]},l=[],h=[],o=0;o<r.steps.length;o++){var p=[],c=r.steps[o];c.path.split(";").map(function(t){2==t.split(",").length&&(p.push(new ZenMap.Geometry.Point(t.split(",")[0],t.split(",")[1])),h.push([t.split(",")[0],t.split(",")[1]]))}),l.push(new ZenMap.Geometry.Polyline(p));var u=c.drive_instruction,d=-1!=y[c.turn].indexOf("")?"straight":-1!=y[c.turn].indexOf("")?"right":"left";s.segments.push({id:o,features:p,strguide:u,instruction:c.instruction,turnAction:d}),n=n.concat(p)}a.coordinates.push(h),i.push({features:l,params:f,messages:s,points:n,routelatlon:JSON.stringify(a)})}"function"==typeof g&&(0<i.length?g(i[0]):g({}))}})},ZenMap.Services.RouteService.prototype._routePgis=function(t,e,i,o){},ZenMap.Services.RouteService.prototype._castPoint=function(t){return new ZenMap.Geometry.Point(t.lon,t.lat)},ZenMap.Services.RouteService.prototype._castPoints=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;++i)e.push(this._castPoint(t[i]));return e},ZenMap.Services.RouteService.prototype._createPolygon=function(t){if(t instanceof ZenMap.Geometry.Polygon||t instanceof ZenMap.Geometry.Circle){var e=t.getPath();if(e&&!(e.length<=0))return new ZenMap.Geometry.Polygon(e)}},ZenMap.Services.RouteService.prototype._createPolyline=function(t){if(t instanceof ZenMap.Geometry.Polyline){t=t.getPath();if(t&&!(t.length<=0))return new ZenMap.Geometry.Polyline(t)}};var each=function(t,e){for(var i=0;i<t.length;i++)e(i,t[i])},arraryContains=function(t,e){for(var i=0;i<t.length;i++)if(t[i].lon==e.lon&&t[i].lon==e.lon)return!0;return!1}}(),ZenMap.Services.routeParams=function(){this.service="na",this.request="getroute",this.networkName="",this.weighter="length",this.startStop,this.endStop,this.trafficModel,this.geoBarriers};